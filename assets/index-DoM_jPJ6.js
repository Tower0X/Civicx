var Ob=t=>{throw TypeError(t)};var Sx=(t,s,u)=>s.has(t)||Ob("Cannot "+u);var ci=(t,s,u)=>(Sx(t,s,"read from private field"),u?u.call(t):s.get(t)),hn=(t,s,u)=>s.has(t)?Ob("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,u),Pr=(t,s,u,d)=>(Sx(t,s,"write to private field"),d?d.call(t,u):s.set(t,u),u),To=(t,s,u)=>(Sx(t,s,"access private method"),u);var r0=(t,s,u,d)=>({set _(_){Pr(t,s,_,u)},get _(){return ci(t,s,d)}});function _mergeNamespaces(t,s){for(var u=0;u<s.length;u++){const d=s[u];if(typeof d!="string"&&!Array.isArray(d)){for(const _ in d)if(_!=="default"&&!(_ in t)){const S=Object.getOwnPropertyDescriptor(d,_);S&&Object.defineProperty(t,_,S.get?S:{enumerable:!0,get:()=>d[_]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))d(_);new MutationObserver(_=>{for(const S of _)if(S.type==="childList")for(const R of S.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&d(R)}).observe(document,{childList:!0,subtree:!0});function u(_){const S={};return _.integrity&&(S.integrity=_.integrity),_.referrerPolicy&&(S.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?S.credentials="include":_.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function d(_){if(_.ep)return;_.ep=!0;const S=u(_);fetch(_.href,S)}})();function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function u(d,_,S){var R=null;if(S!==void 0&&(R=""+S),_.key!==void 0&&(R=""+_.key),"key"in _){S={};for(var a in _)a!=="key"&&(S[a]=_[a])}else S=_;return _=S.ref,{$$typeof:t,type:d,key:R,ref:_!==void 0?_:null,props:S}}return reactJsxRuntime_production.Fragment=s,reactJsxRuntime_production.jsx=u,reactJsxRuntime_production.jsxs=u,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),R=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),O=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),G=Symbol.iterator;function J(Me){return Me===null||typeof Me!="object"?null:(Me=G&&Me[G]||Me["@@iterator"],typeof Me=="function"?Me:null)}var Z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y=Object.assign,le={};function ee(Me,at,ct){this.props=Me,this.context=at,this.refs=le,this.updater=ct||Z}ee.prototype.isReactComponent={},ee.prototype.setState=function(Me,at){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,at,"setState")},ee.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function se(){}se.prototype=ee.prototype;function Q(Me,at,ct){this.props=Me,this.context=at,this.refs=le,this.updater=ct||Z}var oe=Q.prototype=new se;oe.constructor=Q,Y(oe,ee.prototype),oe.isPureReactComponent=!0;var _e=Array.isArray;function Se(){}var ke={H:null,A:null,T:null,S:null},Le=Object.prototype.hasOwnProperty;function lt(Me,at,ct){var Ct=ct.ref;return{$$typeof:t,type:Me,key:at,ref:Ct!==void 0?Ct:null,props:ct}}function qt(Me,at){return lt(Me.type,at,Me.props)}function Yt(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===t}function Ot(Me){var at={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(ct){return at[ct]})}var Bt=/\/+/g;function si(Me,at){return typeof Me=="object"&&Me!==null&&Me.key!=null?Ot(""+Me.key):at.toString(36)}function kt(Me){switch(Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason;default:switch(typeof Me.status=="string"?Me.then(Se,Se):(Me.status="pending",Me.then(function(at){Me.status==="pending"&&(Me.status="fulfilled",Me.value=at)},function(at){Me.status==="pending"&&(Me.status="rejected",Me.reason=at)})),Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason}}throw Me}function xe(Me,at,ct,Ct,li){var mi=typeof Me;(mi==="undefined"||mi==="boolean")&&(Me=null);var bi=!1;if(Me===null)bi=!0;else switch(mi){case"bigint":case"string":case"number":bi=!0;break;case"object":switch(Me.$$typeof){case t:case s:bi=!0;break;case j:return bi=Me._init,xe(bi(Me._payload),at,ct,Ct,li)}}if(bi)return li=li(Me),bi=Ct===""?"."+si(Me,0):Ct,_e(li)?(ct="",bi!=null&&(ct=bi.replace(Bt,"$&/")+"/"),xe(li,at,ct,"",function(Gi){return Gi})):li!=null&&(Yt(li)&&(li=qt(li,ct+(li.key==null||Me&&Me.key===li.key?"":(""+li.key).replace(Bt,"$&/")+"/")+bi)),at.push(li)),1;bi=0;var zi=Ct===""?".":Ct+":";if(_e(Me))for(var vi=0;vi<Me.length;vi++)Ct=Me[vi],mi=zi+si(Ct,vi),bi+=xe(Ct,at,ct,mi,li);else if(vi=J(Me),typeof vi=="function")for(Me=vi.call(Me),vi=0;!(Ct=Me.next()).done;)Ct=Ct.value,mi=zi+si(Ct,vi++),bi+=xe(Ct,at,ct,mi,li);else if(mi==="object"){if(typeof Me.then=="function")return xe(kt(Me),at,ct,Ct,li);throw at=String(Me),Error("Objects are not valid as a React child (found: "+(at==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":at)+"). If you meant to render a collection of children, use an array instead.")}return bi}function Fe(Me,at,ct){if(Me==null)return Me;var Ct=[],li=0;return xe(Me,Ct,"","",function(mi){return at.call(ct,mi,li++)}),Ct}function pe(Me){if(Me._status===-1){var at=Me._result;at=at(),at.then(function(ct){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=ct)},function(ct){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=ct)}),Me._status===-1&&(Me._status=0,Me._result=at)}if(Me._status===1)return Me._result.default;throw Me._result}var Te=typeof reportError=="function"?reportError:function(Me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var at=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Me=="object"&&Me!==null&&typeof Me.message=="string"?String(Me.message):String(Me),error:Me});if(!window.dispatchEvent(at))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Me);return}console.error(Me)},st={map:Fe,forEach:function(Me,at,ct){Fe(Me,function(){at.apply(this,arguments)},ct)},count:function(Me){var at=0;return Fe(Me,function(){at++}),at},toArray:function(Me){return Fe(Me,function(at){return at})||[]},only:function(Me){if(!Yt(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}};return react_production.Activity=V,react_production.Children=st,react_production.Component=ee,react_production.Fragment=u,react_production.Profiler=_,react_production.PureComponent=Q,react_production.StrictMode=d,react_production.Suspense=k,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(Me){return ke.H.useMemoCache(Me)}},react_production.cache=function(Me){return function(){return Me.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(Me,at,ct){if(Me==null)throw Error("The argument must be a React element, but you passed "+Me+".");var Ct=Y({},Me.props),li=Me.key;if(at!=null)for(mi in at.key!==void 0&&(li=""+at.key),at)!Le.call(at,mi)||mi==="key"||mi==="__self"||mi==="__source"||mi==="ref"&&at.ref===void 0||(Ct[mi]=at[mi]);var mi=arguments.length-2;if(mi===1)Ct.children=ct;else if(1<mi){for(var bi=Array(mi),zi=0;zi<mi;zi++)bi[zi]=arguments[zi+2];Ct.children=bi}return lt(Me.type,li,Ct)},react_production.createContext=function(Me){return Me={$$typeof:R,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null},Me.Provider=Me,Me.Consumer={$$typeof:S,_context:Me},Me},react_production.createElement=function(Me,at,ct){var Ct,li={},mi=null;if(at!=null)for(Ct in at.key!==void 0&&(mi=""+at.key),at)Le.call(at,Ct)&&Ct!=="key"&&Ct!=="__self"&&Ct!=="__source"&&(li[Ct]=at[Ct]);var bi=arguments.length-2;if(bi===1)li.children=ct;else if(1<bi){for(var zi=Array(bi),vi=0;vi<bi;vi++)zi[vi]=arguments[vi+2];li.children=zi}if(Me&&Me.defaultProps)for(Ct in bi=Me.defaultProps,bi)li[Ct]===void 0&&(li[Ct]=bi[Ct]);return lt(Me,mi,li)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(Me){return{$$typeof:a,render:Me}},react_production.isValidElement=Yt,react_production.lazy=function(Me){return{$$typeof:j,_payload:{_status:-1,_result:Me},_init:pe}},react_production.memo=function(Me,at){return{$$typeof:O,type:Me,compare:at===void 0?null:at}},react_production.startTransition=function(Me){var at=ke.T,ct={};ke.T=ct;try{var Ct=Me(),li=ke.S;li!==null&&li(ct,Ct),typeof Ct=="object"&&Ct!==null&&typeof Ct.then=="function"&&Ct.then(Se,Te)}catch(mi){Te(mi)}finally{at!==null&&ct.types!==null&&(at.types=ct.types),ke.T=at}},react_production.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},react_production.use=function(Me){return ke.H.use(Me)},react_production.useActionState=function(Me,at,ct){return ke.H.useActionState(Me,at,ct)},react_production.useCallback=function(Me,at){return ke.H.useCallback(Me,at)},react_production.useContext=function(Me){return ke.H.useContext(Me)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(Me,at){return ke.H.useDeferredValue(Me,at)},react_production.useEffect=function(Me,at){return ke.H.useEffect(Me,at)},react_production.useEffectEvent=function(Me){return ke.H.useEffectEvent(Me)},react_production.useId=function(){return ke.H.useId()},react_production.useImperativeHandle=function(Me,at,ct){return ke.H.useImperativeHandle(Me,at,ct)},react_production.useInsertionEffect=function(Me,at){return ke.H.useInsertionEffect(Me,at)},react_production.useLayoutEffect=function(Me,at){return ke.H.useLayoutEffect(Me,at)},react_production.useMemo=function(Me,at){return ke.H.useMemo(Me,at)},react_production.useOptimistic=function(Me,at){return ke.H.useOptimistic(Me,at)},react_production.useReducer=function(Me,at,ct){return ke.H.useReducer(Me,at,ct)},react_production.useRef=function(Me){return ke.H.useRef(Me)},react_production.useState=function(Me){return ke.H.useState(Me)},react_production.useSyncExternalStore=function(Me,at,ct){return ke.H.useSyncExternalStore(Me,at,ct)},react_production.useTransition=function(){return ke.H.useTransition()},react_production.version="19.2.4",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React2=getDefaultExportFromCjs(reactExports),React=_mergeNamespaces({__proto__:null,default:React2},[reactExports]);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(t){function s(xe,Fe){var pe=xe.length;xe.push(Fe);e:for(;0<pe;){var Te=pe-1>>>1,st=xe[Te];if(0<_(st,Fe))xe[Te]=Fe,xe[pe]=st,pe=Te;else break e}}function u(xe){return xe.length===0?null:xe[0]}function d(xe){if(xe.length===0)return null;var Fe=xe[0],pe=xe.pop();if(pe!==Fe){xe[0]=pe;e:for(var Te=0,st=xe.length,Me=st>>>1;Te<Me;){var at=2*(Te+1)-1,ct=xe[at],Ct=at+1,li=xe[Ct];if(0>_(ct,pe))Ct<st&&0>_(li,ct)?(xe[Te]=li,xe[Ct]=pe,Te=Ct):(xe[Te]=ct,xe[at]=pe,Te=at);else if(Ct<st&&0>_(li,pe))xe[Te]=li,xe[Ct]=pe,Te=Ct;else break e}}return Fe}function _(xe,Fe){var pe=xe.sortIndex-Fe.sortIndex;return pe!==0?pe:xe.id-Fe.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var S=performance;t.unstable_now=function(){return S.now()}}else{var R=Date,a=R.now();t.unstable_now=function(){return R.now()-a}}var k=[],O=[],j=1,V=null,G=3,J=!1,Z=!1,Y=!1,le=!1,ee=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;function oe(xe){for(var Fe=u(O);Fe!==null;){if(Fe.callback===null)d(O);else if(Fe.startTime<=xe)d(O),Fe.sortIndex=Fe.expirationTime,s(k,Fe);else break;Fe=u(O)}}function _e(xe){if(Y=!1,oe(xe),!Z)if(u(k)!==null)Z=!0,Se||(Se=!0,Ot());else{var Fe=u(O);Fe!==null&&kt(_e,Fe.startTime-xe)}}var Se=!1,ke=-1,Le=5,lt=-1;function qt(){return le?!0:!(t.unstable_now()-lt<Le)}function Yt(){if(le=!1,Se){var xe=t.unstable_now();lt=xe;var Fe=!0;try{e:{Z=!1,Y&&(Y=!1,se(ke),ke=-1),J=!0;var pe=G;try{t:{for(oe(xe),V=u(k);V!==null&&!(V.expirationTime>xe&&qt());){var Te=V.callback;if(typeof Te=="function"){V.callback=null,G=V.priorityLevel;var st=Te(V.expirationTime<=xe);if(xe=t.unstable_now(),typeof st=="function"){V.callback=st,oe(xe),Fe=!0;break t}V===u(k)&&d(k),oe(xe)}else d(k);V=u(k)}if(V!==null)Fe=!0;else{var Me=u(O);Me!==null&&kt(_e,Me.startTime-xe),Fe=!1}}break e}finally{V=null,G=pe,J=!1}Fe=void 0}}finally{Fe?Ot():Se=!1}}}var Ot;if(typeof Q=="function")Ot=function(){Q(Yt)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,si=Bt.port2;Bt.port1.onmessage=Yt,Ot=function(){si.postMessage(null)}}else Ot=function(){ee(Yt,0)};function kt(xe,Fe){ke=ee(function(){xe(t.unstable_now())},Fe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(xe){xe.callback=null},t.unstable_forceFrameRate=function(xe){0>xe||125<xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Le=0<xe?Math.floor(1e3/xe):5},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_next=function(xe){switch(G){case 1:case 2:case 3:var Fe=3;break;default:Fe=G}var pe=G;G=Fe;try{return xe()}finally{G=pe}},t.unstable_requestPaint=function(){le=!0},t.unstable_runWithPriority=function(xe,Fe){switch(xe){case 1:case 2:case 3:case 4:case 5:break;default:xe=3}var pe=G;G=xe;try{return Fe()}finally{G=pe}},t.unstable_scheduleCallback=function(xe,Fe,pe){var Te=t.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?Te+pe:Te):pe=Te,xe){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=pe+st,xe={id:j++,callback:Fe,priorityLevel:xe,startTime:pe,expirationTime:st,sortIndex:-1},pe>Te?(xe.sortIndex=pe,s(O,xe),u(k)===null&&xe===u(O)&&(Y?(se(ke),ke=-1):Y=!0,kt(_e,pe-Te))):(xe.sortIndex=st,s(k,xe),Z||J||(Z=!0,Se||(Se=!0,Ot()))),xe},t.unstable_shouldYield=qt,t.unstable_wrapCallback=function(xe){var Fe=G;return function(){var pe=G;G=Fe;try{return xe.apply(this,arguments)}finally{G=pe}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var t=requireReact();function s(k){var O="https://react.dev/errors/"+k;if(1<arguments.length){O+="?args[]="+encodeURIComponent(arguments[1]);for(var j=2;j<arguments.length;j++)O+="&args[]="+encodeURIComponent(arguments[j])}return"Minified React error #"+k+"; visit "+O+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(){}var d={d:{f:u,r:function(){throw Error(s(522))},D:u,C:u,L:u,m:u,X:u,S:u,M:u},p:0,findDOMNode:null},_=Symbol.for("react.portal");function S(k,O,j){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_,key:V==null?null:""+V,children:k,containerInfo:O,implementation:j}}var R=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(k,O){if(k==="font")return"";if(typeof O=="string")return O==="use-credentials"?O:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,reactDom_production.createPortal=function(k,O){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O||O.nodeType!==1&&O.nodeType!==9&&O.nodeType!==11)throw Error(s(299));return S(k,O,null,j)},reactDom_production.flushSync=function(k){var O=R.T,j=d.p;try{if(R.T=null,d.p=2,k)return k()}finally{R.T=O,d.p=j,d.d.f()}},reactDom_production.preconnect=function(k,O){typeof k=="string"&&(O?(O=O.crossOrigin,O=typeof O=="string"?O==="use-credentials"?O:"":void 0):O=null,d.d.C(k,O))},reactDom_production.prefetchDNS=function(k){typeof k=="string"&&d.d.D(k)},reactDom_production.preinit=function(k,O){if(typeof k=="string"&&O&&typeof O.as=="string"){var j=O.as,V=a(j,O.crossOrigin),G=typeof O.integrity=="string"?O.integrity:void 0,J=typeof O.fetchPriority=="string"?O.fetchPriority:void 0;j==="style"?d.d.S(k,typeof O.precedence=="string"?O.precedence:void 0,{crossOrigin:V,integrity:G,fetchPriority:J}):j==="script"&&d.d.X(k,{crossOrigin:V,integrity:G,fetchPriority:J,nonce:typeof O.nonce=="string"?O.nonce:void 0})}},reactDom_production.preinitModule=function(k,O){if(typeof k=="string")if(typeof O=="object"&&O!==null){if(O.as==null||O.as==="script"){var j=a(O.as,O.crossOrigin);d.d.M(k,{crossOrigin:j,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0})}}else O==null&&d.d.M(k)},reactDom_production.preload=function(k,O){if(typeof k=="string"&&typeof O=="object"&&O!==null&&typeof O.as=="string"){var j=O.as,V=a(j,O.crossOrigin);d.d.L(k,j,{crossOrigin:V,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0,type:typeof O.type=="string"?O.type:void 0,fetchPriority:typeof O.fetchPriority=="string"?O.fetchPriority:void 0,referrerPolicy:typeof O.referrerPolicy=="string"?O.referrerPolicy:void 0,imageSrcSet:typeof O.imageSrcSet=="string"?O.imageSrcSet:void 0,imageSizes:typeof O.imageSizes=="string"?O.imageSizes:void 0,media:typeof O.media=="string"?O.media:void 0})}},reactDom_production.preloadModule=function(k,O){if(typeof k=="string")if(O){var j=a(O.as,O.crossOrigin);d.d.m(k,{as:typeof O.as=="string"&&O.as!=="script"?O.as:void 0,crossOrigin:j,integrity:typeof O.integrity=="string"?O.integrity:void 0})}else d.d.m(k)},reactDom_production.requestFormReset=function(k){d.d.r(k)},reactDom_production.unstable_batchedUpdates=function(k,O){return k(O)},reactDom_production.useFormState=function(k,O,j){return R.H.useFormState(k,O,j)},reactDom_production.useFormStatus=function(){return R.H.useHostTransitionStatus()},reactDom_production.version="19.2.4",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var t=requireScheduler(),s=requireReact(),u=requireReactDom();function d(f){var x="https://react.dev/errors/"+f;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)x+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+f+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function S(f){var x=f,C=f;if(f.alternate)for(;x.return;)x=x.return;else{f=x;do x=f,(x.flags&4098)!==0&&(C=x.return),f=x.return;while(f)}return x.tag===3?C:null}function R(f){if(f.tag===13){var x=f.memoizedState;if(x===null&&(f=f.alternate,f!==null&&(x=f.memoizedState)),x!==null)return x.dehydrated}return null}function a(f){if(f.tag===31){var x=f.memoizedState;if(x===null&&(f=f.alternate,f!==null&&(x=f.memoizedState)),x!==null)return x.dehydrated}return null}function k(f){if(S(f)!==f)throw Error(d(188))}function O(f){var x=f.alternate;if(!x){if(x=S(f),x===null)throw Error(d(188));return x!==f?null:f}for(var C=f,L=x;;){var q=C.return;if(q===null)break;var te=q.alternate;if(te===null){if(L=q.return,L!==null){C=L;continue}break}if(q.child===te.child){for(te=q.child;te;){if(te===C)return k(q),f;if(te===L)return k(q),x;te=te.sibling}throw Error(d(188))}if(C.return!==L.return)C=q,L=te;else{for(var we=!1,$e=q.child;$e;){if($e===C){we=!0,C=q,L=te;break}if($e===L){we=!0,L=q,C=te;break}$e=$e.sibling}if(!we){for($e=te.child;$e;){if($e===C){we=!0,C=te,L=q;break}if($e===L){we=!0,L=te,C=q;break}$e=$e.sibling}if(!we)throw Error(d(189))}}if(C.alternate!==L)throw Error(d(190))}if(C.tag!==3)throw Error(d(188));return C.stateNode.current===C?f:x}function j(f){var x=f.tag;if(x===5||x===26||x===27||x===6)return f;for(f=f.child;f!==null;){if(x=j(f),x!==null)return x;f=f.sibling}return null}var V=Object.assign,G=Symbol.for("react.element"),J=Symbol.for("react.transitional.element"),Z=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),se=Symbol.for("react.consumer"),Q=Symbol.for("react.context"),oe=Symbol.for("react.forward_ref"),_e=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),ke=Symbol.for("react.memo"),Le=Symbol.for("react.lazy"),lt=Symbol.for("react.activity"),qt=Symbol.for("react.memo_cache_sentinel"),Yt=Symbol.iterator;function Ot(f){return f===null||typeof f!="object"?null:(f=Yt&&f[Yt]||f["@@iterator"],typeof f=="function"?f:null)}var Bt=Symbol.for("react.client.reference");function si(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===Bt?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Y:return"Fragment";case ee:return"Profiler";case le:return"StrictMode";case _e:return"Suspense";case Se:return"SuspenseList";case lt:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case Z:return"Portal";case Q:return f.displayName||"Context";case se:return(f._context.displayName||"Context")+".Consumer";case oe:var x=f.render;return f=f.displayName,f||(f=x.displayName||x.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case ke:return x=f.displayName||null,x!==null?x:si(f.type)||"Memo";case Le:x=f._payload,f=f._init;try{return si(f(x))}catch{}}return null}var kt=Array.isArray,xe=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Fe=u.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pe={pending:!1,data:null,method:null,action:null},Te=[],st=-1;function Me(f){return{current:f}}function at(f){0>st||(f.current=Te[st],Te[st]=null,st--)}function ct(f,x){st++,Te[st]=f.current,f.current=x}var Ct=Me(null),li=Me(null),mi=Me(null),bi=Me(null);function zi(f,x){switch(ct(mi,x),ct(li,f),ct(Ct,null),x.nodeType){case 9:case 11:f=(f=x.documentElement)&&(f=f.namespaceURI)?Hg(f):0;break;default:if(f=x.tagName,x=x.namespaceURI)x=Hg(x),f=Qm(x,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}at(Ct),ct(Ct,f)}function vi(){at(Ct),at(li),at(mi)}function Gi(f){f.memoizedState!==null&&ct(bi,f);var x=Ct.current,C=Qm(x,f.type);x!==C&&(ct(li,f),ct(Ct,C))}function lr(f){li.current===f&&(at(Ct),at(li)),bi.current===f&&(at(bi),Tl._currentValue=pe)}var zr,Ui;function Ci(f){if(zr===void 0)try{throw Error()}catch(C){var x=C.stack.trim().match(/\n( *(at )?)/);zr=x&&x[1]||"",Ui=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zr+f+Ui}var Gn=!1;function Wn(f,x){if(!f||Gn)return"";Gn=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var L={DetermineComponentFrameRoot:function(){try{if(x){var di=function(){throw Error()};if(Object.defineProperty(di.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(di,[])}catch(Jt){var Ht=Jt}Reflect.construct(f,[],di)}else{try{di.call()}catch(Jt){Ht=Jt}f.call(di.prototype)}}else{try{throw Error()}catch(Jt){Ht=Jt}(di=f())&&typeof di.catch=="function"&&di.catch(function(){})}}catch(Jt){if(Jt&&Ht&&typeof Jt.stack=="string")return[Jt.stack,Ht.stack]}return[null,null]}};L.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var q=Object.getOwnPropertyDescriptor(L.DetermineComponentFrameRoot,"name");q&&q.configurable&&Object.defineProperty(L.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var te=L.DetermineComponentFrameRoot(),we=te[0],$e=te[1];if(we&&$e){var mt=we.split(`
`),Gt=$e.split(`
`);for(q=L=0;L<mt.length&&!mt[L].includes("DetermineComponentFrameRoot");)L++;for(;q<Gt.length&&!Gt[q].includes("DetermineComponentFrameRoot");)q++;if(L===mt.length||q===Gt.length)for(L=mt.length-1,q=Gt.length-1;1<=L&&0<=q&&mt[L]!==Gt[q];)q--;for(;1<=L&&0<=q;L--,q--)if(mt[L]!==Gt[q]){if(L!==1||q!==1)do if(L--,q--,0>q||mt[L]!==Gt[q]){var ni=`
`+mt[L].replace(" at new "," at ");return f.displayName&&ni.includes("<anonymous>")&&(ni=ni.replace("<anonymous>",f.displayName)),ni}while(1<=L&&0<=q);break}}}finally{Gn=!1,Error.prepareStackTrace=C}return(C=f?f.displayName||f.name:"")?Ci(C):""}function vn(f,x){switch(f.tag){case 26:case 27:case 5:return Ci(f.type);case 16:return Ci("Lazy");case 13:return f.child!==x&&x!==null?Ci("Suspense Fallback"):Ci("Suspense");case 19:return Ci("SuspenseList");case 0:case 15:return Wn(f.type,!1);case 11:return Wn(f.type.render,!1);case 1:return Wn(f.type,!0);case 31:return Ci("Activity");default:return""}}function Sr(f){try{var x="",C=null;do x+=vn(f,C),C=f,f=f.return;while(f);return x}catch(L){return`
Error generating stack: `+L.message+`
`+L.stack}}var Xr=Object.prototype.hasOwnProperty,es=t.unstable_scheduleCallback,Un=t.unstable_cancelCallback,dn=t.unstable_shouldYield,os=t.unstable_requestPaint,Dr=t.unstable_now,jn=t.unstable_getCurrentPriorityLevel,Rn=t.unstable_ImmediatePriority,ys=t.unstable_UserBlockingPriority,As=t.unstable_NormalPriority,sa=t.unstable_LowPriority,bn=t.unstable_IdlePriority,Al=t.log,_s=t.unstable_setDisableYieldValue,Co=null,Zn=null;function Sn(f){if(typeof Al=="function"&&_s(f),Zn&&typeof Zn.setStrictMode=="function")try{Zn.setStrictMode(Co,f)}catch{}}var $n=Math.clz32?Math.clz32:Ls,Ro=Math.log,ao=Math.LN2;function Ls(f){return f>>>=0,f===0?32:31-(Ro(f)/ao|0)|0}var qa=256,Wa=262144,oo=4194304;function Tr(f){var x=f&42;if(x!==0)return x;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return f&261888;case 262144:case 524288:case 1048576:case 2097152:return f&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function $i(f,x,C){var L=f.pendingLanes;if(L===0)return 0;var q=0,te=f.suspendedLanes,we=f.pingedLanes;f=f.warmLanes;var $e=L&134217727;return $e!==0?(L=$e&~te,L!==0?q=Tr(L):(we&=$e,we!==0?q=Tr(we):C||(C=$e&~f,C!==0&&(q=Tr(C))))):($e=L&~te,$e!==0?q=Tr($e):we!==0?q=Tr(we):C||(C=L&~f,C!==0&&(q=Tr(C)))),q===0?0:x!==0&&x!==q&&(x&te)===0&&(te=q&-q,C=x&-x,te>=C||te===32&&(C&4194048)!==0)?x:q}function Mn(f,x){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&x)===0}function Xn(f,x){switch(f){case 1:case 2:case 4:case 8:case 64:return x+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tn(){var f=oo;return oo<<=1,(oo&62914560)===0&&(oo=4194304),f}function tl(f){for(var x=[],C=0;31>C;C++)x.push(f);return x}function An(f,x){f.pendingLanes|=x,x!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function Pt(f,x,C,L,q,te){var we=f.pendingLanes;f.pendingLanes=C,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=C,f.entangledLanes&=C,f.errorRecoveryDisabledLanes&=C,f.shellSuspendCounter=0;var $e=f.entanglements,mt=f.expirationTimes,Gt=f.hiddenUpdates;for(C=we&~C;0<C;){var ni=31-$n(C),di=1<<ni;$e[ni]=0,mt[ni]=-1;var Ht=Gt[ni];if(Ht!==null)for(Gt[ni]=null,ni=0;ni<Ht.length;ni++){var Jt=Ht[ni];Jt!==null&&(Jt.lane&=-536870913)}C&=~di}L!==0&&ga(f,L,0),te!==0&&q===0&&f.tag!==0&&(f.suspendedLanes|=te&~(we&~x))}function ga(f,x,C){f.pendingLanes|=x,f.suspendedLanes&=~x;var L=31-$n(x);f.entangledLanes|=x,f.entanglements[L]=f.entanglements[L]|1073741824|C&261930}function aa(f,x){var C=f.entangledLanes|=x;for(f=f.entanglements;C;){var L=31-$n(C),q=1<<L;q&x|f[L]&x&&(f[L]|=x),C&=~q}}function Os(f,x){var C=x&-x;return C=(C&42)!==0?1:tr(C),(C&(f.suspendedLanes|x))!==0?0:C}function tr(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function Je(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function me(){var f=Fe.p;return f!==0?f:(f=window.event,f===void 0?32:d_(f.type))}function ve(f,x){var C=Fe.p;try{return Fe.p=f,x()}finally{Fe.p=C}}var De=Math.random().toString(36).slice(2),qe="__reactFiber$"+De,Oe="__reactProps$"+De,Ke="__reactContainer$"+De,ut="__reactEvents$"+De,et="__reactListeners$"+De,dt="__reactHandles$"+De,Ft="__reactResources$"+De,It="__reactMarker$"+De;function ii(f){delete f[qe],delete f[Oe],delete f[ut],delete f[et],delete f[dt]}function yi(f){var x=f[qe];if(x)return x;for(var C=f.parentNode;C;){if(x=C[Ke]||C[qe]){if(C=x.alternate,x.child!==null||C!==null&&C.child!==null)for(f=Xg(f);f!==null;){if(C=f[qe])return C;f=Xg(f)}return x}f=C,C=f.parentNode}return null}function wi(f){if(f=f[qe]||f[Ke]){var x=f.tag;if(x===5||x===6||x===13||x===31||x===26||x===27||x===3)return f}return null}function Li(f){var x=f.tag;if(x===5||x===26||x===27||x===6)return f.stateNode;throw Error(d(33))}function Vi(f){var x=f[Ft];return x||(x=f[Ft]={hoistableStyles:new Map,hoistableScripts:new Map}),x}function xi(f){f[It]=!0}var Pi=new Set,Fr={};function fn(f,x){Wr(f,x),Wr(f+"Capture",x)}function Wr(f,x){for(Fr[f]=x,f=0;f<x.length;f++)Pi.add(x[f])}var wn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),qr={},rr={};function Yr(f){return Xr.call(rr,f)?!0:Xr.call(qr,f)?!1:wn.test(f)?rr[f]=!0:(qr[f]=!0,!1)}function Ar(f,x,C){if(Yr(x))if(C===null)f.removeAttribute(x);else{switch(typeof C){case"undefined":case"function":case"symbol":f.removeAttribute(x);return;case"boolean":var L=x.toLowerCase().slice(0,5);if(L!=="data-"&&L!=="aria-"){f.removeAttribute(x);return}}f.setAttribute(x,""+C)}}function Cr(f,x,C){if(C===null)f.removeAttribute(x);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(x);return}f.setAttribute(x,""+C)}}function Br(f,x,C,L){if(L===null)f.removeAttribute(C);else{switch(typeof L){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(C);return}f.setAttributeNS(x,C,""+L)}}function pn(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function ls(f){var x=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(x==="checkbox"||x==="radio")}function Yn(f,x,C){var L=Object.getOwnPropertyDescriptor(f.constructor.prototype,x);if(!f.hasOwnProperty(x)&&typeof L<"u"&&typeof L.get=="function"&&typeof L.set=="function"){var q=L.get,te=L.set;return Object.defineProperty(f,x,{configurable:!0,get:function(){return q.call(this)},set:function(we){C=""+we,te.call(this,we)}}),Object.defineProperty(f,x,{enumerable:L.enumerable}),{getValue:function(){return C},setValue:function(we){C=""+we},stopTracking:function(){f._valueTracker=null,delete f[x]}}}}function il(f){if(!f._valueTracker){var x=ls(f)?"checked":"value";f._valueTracker=Yn(f,x,""+f[x])}}function zs(f){if(!f)return!1;var x=f._valueTracker;if(!x)return!0;var C=x.getValue(),L="";return f&&(L=ls(f)?f.checked?"true":"false":f.value),f=L,f!==C?(x.setValue(f),!0):!1}function Ws(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var lo=/[\n"\\]/g;function ts(f){return f.replace(lo,function(x){return"\\"+x.charCodeAt(0).toString(16)+" "})}function oa(f,x,C,L,q,te,we,$e){f.name="",we!=null&&typeof we!="function"&&typeof we!="symbol"&&typeof we!="boolean"?f.type=we:f.removeAttribute("type"),x!=null?we==="number"?(x===0&&f.value===""||f.value!=x)&&(f.value=""+pn(x)):f.value!==""+pn(x)&&(f.value=""+pn(x)):we!=="submit"&&we!=="reset"||f.removeAttribute("value"),x!=null?Mo(f,we,pn(x)):C!=null?Mo(f,we,pn(C)):L!=null&&f.removeAttribute("value"),q==null&&te!=null&&(f.defaultChecked=!!te),q!=null&&(f.checked=q&&typeof q!="function"&&typeof q!="symbol"),$e!=null&&typeof $e!="function"&&typeof $e!="symbol"&&typeof $e!="boolean"?f.name=""+pn($e):f.removeAttribute("name")}function Zs(f,x,C,L,q,te,we,$e){if(te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"&&(f.type=te),x!=null||C!=null){if(!(te!=="submit"&&te!=="reset"||x!=null)){il(f);return}C=C!=null?""+pn(C):"",x=x!=null?""+pn(x):C,$e||x===f.value||(f.value=x),f.defaultValue=x}L=L??q,L=typeof L!="function"&&typeof L!="symbol"&&!!L,f.checked=$e?f.checked:!!L,f.defaultChecked=!!L,we!=null&&typeof we!="function"&&typeof we!="symbol"&&typeof we!="boolean"&&(f.name=we),il(f)}function Mo(f,x,C){x==="number"&&Ws(f.ownerDocument)===f||f.defaultValue===""+C||(f.defaultValue=""+C)}function co(f,x,C,L){if(f=f.options,x){x={};for(var q=0;q<C.length;q++)x["$"+C[q]]=!0;for(C=0;C<f.length;C++)q=x.hasOwnProperty("$"+f[C].value),f[C].selected!==q&&(f[C].selected=q),q&&L&&(f[C].defaultSelected=!0)}else{for(C=""+pn(C),x=null,q=0;q<f.length;q++){if(f[q].value===C){f[q].selected=!0,L&&(f[q].defaultSelected=!0);return}x!==null||f[q].disabled||(x=f[q])}x!==null&&(x.selected=!0)}}function ka(f,x,C){if(x!=null&&(x=""+pn(x),x!==f.value&&(f.value=x),C==null)){f.defaultValue!==x&&(f.defaultValue=x);return}f.defaultValue=C!=null?""+pn(C):""}function Du(f,x,C,L){if(x==null){if(L!=null){if(C!=null)throw Error(d(92));if(kt(L)){if(1<L.length)throw Error(d(93));L=L[0]}C=L}C==null&&(C=""),x=C}C=pn(x),f.defaultValue=C,L=f.textContent,L===C&&L!==""&&L!==null&&(f.value=L),il(f)}function rl(f,x){if(x){var C=f.firstChild;if(C&&C===f.lastChild&&C.nodeType===3){C.nodeValue=x;return}}f.textContent=x}var Am=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function np(f,x,C){var L=x.indexOf("--")===0;C==null||typeof C=="boolean"||C===""?L?f.setProperty(x,""):x==="float"?f.cssFloat="":f[x]="":L?f.setProperty(x,C):typeof C!="number"||C===0||Am.has(x)?x==="float"?f.cssFloat=C:f[x]=(""+C).trim():f[x]=C+"px"}function Ud(f,x,C){if(x!=null&&typeof x!="object")throw Error(d(62));if(f=f.style,C!=null){for(var L in C)!C.hasOwnProperty(L)||x!=null&&x.hasOwnProperty(L)||(L.indexOf("--")===0?f.setProperty(L,""):L==="float"?f.cssFloat="":f[L]="");for(var q in x)L=x[q],x.hasOwnProperty(q)&&C[q]!==L&&np(f,q,L)}else for(var te in x)x.hasOwnProperty(te)&&np(f,te,x[te])}function Fh(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Za=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function uo(f){return Za.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}function cs(){}var ho=null;function sc(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Po=null,fo=null;function Cl(f){var x=wi(f);if(x&&(f=x.stateNode)){var C=f[Oe]||null;e:switch(f=x.stateNode,x.type){case"input":if(oa(f,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name),x=C.name,C.type==="radio"&&x!=null){for(C=f;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll('input[name="'+ts(""+x)+'"][type="radio"]'),x=0;x<C.length;x++){var L=C[x];if(L!==f&&L.form===f.form){var q=L[Oe]||null;if(!q)throw Error(d(90));oa(L,q.value,q.defaultValue,q.defaultValue,q.checked,q.defaultChecked,q.type,q.name)}}for(x=0;x<C.length;x++)L=C[x],L.form===f.form&&zs(L)}break e;case"textarea":ka(f,C.value,C.defaultValue);break e;case"select":x=C.value,x!=null&&co(f,!!C.multiple,x,!1)}}}var ku=!1;function sp(f,x,C){if(ku)return f(x,C);ku=!0;try{var L=f(x);return L}finally{if(ku=!1,(Po!==null||fo!==null)&&(Lr(),Po&&(x=Po,f=fo,fo=Po=null,Cl(x),f)))for(x=0;x<f.length;x++)Cl(f[x])}}function Lu(f,x){var C=f.stateNode;if(C===null)return null;var L=C[Oe]||null;if(L===null)return null;C=L[x];e:switch(x){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(L=!L.disabled)||(f=f.type,L=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!L;break e;default:f=!1}if(f)return null;if(C&&typeof C!="function")throw Error(d(231,x,typeof C));return C}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jc=!1;if(Kn)try{var Rl={};Object.defineProperty(Rl,"passive",{get:function(){jc=!0}}),window.addEventListener("test",Rl,Rl),window.removeEventListener("test",Rl,Rl)}catch{jc=!1}var la=null,Nc=null,Gd=null;function $d(){if(Gd)return Gd;var f,x=Nc,C=x.length,L,q="value"in la?la.value:la.textContent,te=q.length;for(f=0;f<C&&x[f]===q[f];f++);var we=C-f;for(L=1;L<=we&&x[C-L]===q[te-L];L++);return Gd=q.slice(f,1<L?1-L:void 0)}function nr(f){var x=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&x===13&&(f=13)):f=x,f===10&&(f=13),32<=f||f===13?f:0}function Ml(){return!0}function Bh(){return!1}function ya(f){function x(C,L,q,te,we){this._reactName=C,this._targetInst=q,this.type=L,this.nativeEvent=te,this.target=we,this.currentTarget=null;for(var $e in f)f.hasOwnProperty($e)&&(C=f[$e],this[$e]=C?C(te):te[$e]);return this.isDefaultPrevented=(te.defaultPrevented!=null?te.defaultPrevented:te.returnValue===!1)?Ml:Bh,this.isPropagationStopped=Bh,this}return V(x.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=Ml)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=Ml)},persist:function(){},isPersistent:Ml}),x}var ac={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oc=ya(ac),po=V({},ac,{view:0,detail:0}),jh=ya(po),Ou,ap,nl,mo=V({},po,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fs,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==nl&&(nl&&f.type==="mousemove"?(Ou=f.screenX-nl.screenX,ap=f.screenY-nl.screenY):ap=Ou=0,nl=f),Ou)},movementY:function(f){return"movementY"in f?f.movementY:ap}}),zu=ya(mo),Cm=V({},mo,{dataTransfer:0}),Vc=ya(Cm),Pl=V({},po,{relatedTarget:0}),Xs=ya(Pl),go=V({},ac,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=ya(go),Rm=V({},ac,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),_r=ya(Rm),lp=V({},ac,{data:0}),cp=ya(lp),Mm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ri={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},up={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uc(f){var x=this.nativeEvent;return x.getModifierState?x.getModifierState(f):(f=up[f])?!!x[f]:!1}function Fs(){return Uc}var qd=V({},po,{key:function(f){if(f.key){var x=Mm[f.key]||f.key;if(x!=="Unidentified")return x}return f.type==="keypress"?(f=nr(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Ri[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fs,charCode:function(f){return f.type==="keypress"?nr(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?nr(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),_a=ya(qd),gi=V({},mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gr=ya(gi),dr=V({},po,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fs}),ca=ya(dr),Fu=V({},ac,{propertyName:0,elapsedTime:0,pseudoElement:0}),wr=ya(Fu),Wd=V({},mo,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Bu=ya(Wd),Gc=V({},ac,{newState:0,oldState:0}),Ys=ya(Gc),Pn=[9,13,27,32],hp=Kn&&"CompositionEvent"in window,Il=null;Kn&&"documentMode"in document&&(Il=document.documentMode);var dp=Kn&&"TextEvent"in window&&!Il,ju=Kn&&(!hp||Il&&8<Il&&11>=Il),Nh=" ",Zd=!1;function Vh(f,x){switch(f){case"keyup":return Pn.indexOf(x.keyCode)!==-1;case"keydown":return x.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bs(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var vs=!1;function xa(f,x){switch(f){case"compositionend":return Bs(x);case"keypress":return x.which!==32?null:(Zd=!0,Nh);case"textInput":return f=x.data,f===Nh&&Zd?null:f;default:return null}}function fp(f,x){if(vs)return f==="compositionend"||!hp&&Vh(f,x)?(f=$d(),Gd=Nc=la=null,vs=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(x.ctrlKey||x.altKey||x.metaKey)||x.ctrlKey&&x.altKey){if(x.char&&1<x.char.length)return x.char;if(x.which)return String.fromCharCode(x.which)}return null;case"compositionend":return ju&&x.locale!=="ko"?null:x.data;default:return null}}var lc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qn(f){var x=f&&f.nodeName&&f.nodeName.toLowerCase();return x==="input"?!!lc[f.type]:x==="textarea"}function Io(f,x,C,L){Po?fo?fo.push(L):fo=[L]:Po=L,x=Yp(x,"onChange"),0<x.length&&(C=new oc("onChange","change",null,C,L),f.push({event:C,listeners:x}))}var Xa=null,In=null;function cc(f){Wp(f,0)}function Ii(f){var x=Li(f);if(zs(x))return f}function fi(f,x){if(f==="change")return x}var $c=!1;if(Kn){var Mi;if(Kn){var Nu="oninput"in document;if(!Nu){var Vu=document.createElement("div");Vu.setAttribute("oninput","return;"),Nu=typeof Vu.oninput=="function"}Mi=Nu}else Mi=!1;$c=Mi&&(!document.documentMode||9<document.documentMode)}function Si(){Xa&&(Xa.detachEvent("onpropertychange",Xd),In=Xa=null)}function Xd(f){if(f.propertyName==="value"&&Ii(In)){var x=[];Io(x,In,f,sc(f)),sp(cc,x)}}function pp(f,x,C){f==="focusin"?(Si(),Xa=x,In=C,Xa.attachEvent("onpropertychange",Xd)):f==="focusout"&&Si()}function sl(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Ii(In)}function Pm(f,x){if(f==="click")return Ii(x)}function Uu(f,x){if(f==="input"||f==="change")return Ii(x)}function va(f,x){return f===x&&(f!==0||1/f===1/x)||f!==f&&x!==x}var ba=typeof Object.is=="function"?Object.is:va;function La(f,x){if(ba(f,x))return!0;if(typeof f!="object"||f===null||typeof x!="object"||x===null)return!1;var C=Object.keys(f),L=Object.keys(x);if(C.length!==L.length)return!1;for(L=0;L<C.length;L++){var q=C[L];if(!Xr.call(x,q)||!ba(f[q],x[q]))return!1}return!0}function Uh(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Ya(f,x){var C=Uh(f);f=0;for(var L;C;){if(C.nodeType===3){if(L=f+C.textContent.length,f<=x&&L>=x)return{node:C,offset:x-f};f=L}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=Uh(C)}}function Dl(f,x){return f&&x?f===x?!0:f&&f.nodeType===3?!1:x&&x.nodeType===3?Dl(f,x.parentNode):"contains"in f?f.contains(x):f.compareDocumentPosition?!!(f.compareDocumentPosition(x)&16):!1:!1}function Im(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var x=Ws(f.document);x instanceof f.HTMLIFrameElement;){try{var C=typeof x.contentWindow.location.href=="string"}catch{C=!1}if(C)f=x.contentWindow;else break;x=Ws(f.document)}return x}function Hc(f){var x=f&&f.nodeName&&f.nodeName.toLowerCase();return x&&(x==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||x==="textarea"||f.contentEditable==="true")}var Gh=Kn&&"documentMode"in document&&11>=document.documentMode,kl=null,Yd=null,ua=null,Kd=!1;function $h(f,x,C){var L=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;Kd||kl==null||kl!==Ws(L)||(L=kl,"selectionStart"in L&&Hc(L)?L={start:L.selectionStart,end:L.selectionEnd}:(L=(L.ownerDocument&&L.ownerDocument.defaultView||window).getSelection(),L={anchorNode:L.anchorNode,anchorOffset:L.anchorOffset,focusNode:L.focusNode,focusOffset:L.focusOffset}),ua&&La(ua,L)||(ua=L,L=Yp(Yd,"onSelect"),0<L.length&&(x=new oc("onSelect","select",null,x,C),f.push({event:x,listeners:L}),x.target=kl)))}function Do(f,x){var C={};return C[f.toLowerCase()]=x.toLowerCase(),C["Webkit"+f]="webkit"+x,C["Moz"+f]="moz"+x,C}var Ka={animationend:Do("Animation","AnimationEnd"),animationiteration:Do("Animation","AnimationIteration"),animationstart:Do("Animation","AnimationStart"),transitionrun:Do("Transition","TransitionRun"),transitionstart:Do("Transition","TransitionStart"),transitioncancel:Do("Transition","TransitionCancel"),transitionend:Do("Transition","TransitionEnd")},mp={},gp={};Kn&&(gp=document.createElement("div").style,"AnimationEvent"in window||(delete Ka.animationend.animation,delete Ka.animationiteration.animation,delete Ka.animationstart.animation),"TransitionEvent"in window||delete Ka.transitionend.transition);function qc(f){if(mp[f])return mp[f];if(!Ka[f])return f;var x=Ka[f],C;for(C in x)if(x.hasOwnProperty(C)&&C in gp)return mp[f]=x[C];return f}var Qd=qc("animationend"),Dm=qc("animationiteration"),al=qc("animationstart"),km=qc("transitionrun"),Lm=qc("transitionstart"),Jd=qc("transitioncancel"),ef=qc("transitionend"),Ll=new Map,ha="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ha.push("scrollEnd");function Qa(f,x){Ll.set(f,x),fn(x,[f])}var Gu=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var x=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(x))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)},Ks=[],ko=0,Hh=0;function Wc(){for(var f=ko,x=Hh=ko=0;x<f;){var C=Ks[x];Ks[x++]=null;var L=Ks[x];Ks[x++]=null;var q=Ks[x];Ks[x++]=null;var te=Ks[x];if(Ks[x++]=null,L!==null&&q!==null){var we=L.pending;we===null?q.next=q:(q.next=we.next,we.next=q),L.pending=q}te!==0&&tf(C,q,te)}}function da(f,x,C,L){Ks[ko++]=f,Ks[ko++]=x,Ks[ko++]=C,Ks[ko++]=L,Hh|=L,f.lanes|=L,f=f.alternate,f!==null&&(f.lanes|=L)}function Zc(f,x,C,L){return da(f,x,C,L),$u(f)}function $t(f,x){return da(f,null,null,x),$u(f)}function tf(f,x,C){f.lanes|=C;var L=f.alternate;L!==null&&(L.lanes|=C);for(var q=!1,te=f.return;te!==null;)te.childLanes|=C,L=te.alternate,L!==null&&(L.childLanes|=C),te.tag===22&&(f=te.stateNode,f===null||f._visibility&1||(q=!0)),f=te,te=te.return;return f.tag===3?(te=f.stateNode,q&&x!==null&&(q=31-$n(C),f=te.hiddenUpdates,L=f[q],L===null?f[q]=[x]:L.push(x),x.lane=C|536870912),te):null}function $u(f){if(50<or)throw or=0,Hr=null,Error(d(185));for(var x=f.return;x!==null;)f=x,x=f.return;return f.tag===3?f.stateNode:null}var ol={};function ll(f,x,C,L){this.tag=f,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wa(f,x,C,L){return new ll(f,x,C,L)}function Ol(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Ea(f,x){var C=f.alternate;return C===null?(C=wa(f.tag,x,f.key,f.mode),C.elementType=f.elementType,C.type=f.type,C.stateNode=f.stateNode,C.alternate=f,f.alternate=C):(C.pendingProps=x,C.type=f.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=f.flags&65011712,C.childLanes=f.childLanes,C.lanes=f.lanes,C.child=f.child,C.memoizedProps=f.memoizedProps,C.memoizedState=f.memoizedState,C.updateQueue=f.updateQueue,x=f.dependencies,C.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},C.sibling=f.sibling,C.index=f.index,C.ref=f.ref,C.refCleanup=f.refCleanup,C}function zl(f,x){f.flags&=65011714;var C=f.alternate;return C===null?(f.childLanes=0,f.lanes=x,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=C.childLanes,f.lanes=C.lanes,f.child=C.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=C.memoizedProps,f.memoizedState=C.memoizedState,f.updateQueue=C.updateQueue,f.type=C.type,x=C.dependencies,f.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext}),f}function Xc(f,x,C,L,q,te){var we=0;if(L=f,typeof f=="function")Ol(f)&&(we=1);else if(typeof f=="string")we=a_(f,C,Ct.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case lt:return f=wa(31,C,x,q),f.elementType=lt,f.lanes=te,f;case Y:return uc(C.children,q,te,x);case le:we=8,q|=24;break;case ee:return f=wa(12,C,x,q|2),f.elementType=ee,f.lanes=te,f;case _e:return f=wa(13,C,x,q),f.elementType=_e,f.lanes=te,f;case Se:return f=wa(19,C,x,q),f.elementType=Se,f.lanes=te,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Q:we=10;break e;case se:we=9;break e;case oe:we=11;break e;case ke:we=14;break e;case Le:we=16,L=null;break e}we=29,C=Error(d(130,f===null?"null":typeof f,"")),L=null}return x=wa(we,C,x,q),x.elementType=f,x.type=L,x.lanes=te,x}function uc(f,x,C,L){return f=wa(7,f,L,x),f.lanes=C,f}function Hu(f,x,C){return f=wa(6,f,null,x),f.lanes=C,f}function Om(f){var x=wa(18,null,null,0);return x.stateNode=f,x}function rf(f,x,C){return x=wa(4,f.children!==null?f.children:[],f.key,x),x.lanes=C,x.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},x}var nf=new WeakMap;function Cs(f,x){if(typeof f=="object"&&f!==null){var C=nf.get(f);return C!==void 0?C:(x={value:f,source:x,stack:Sr(x)},nf.set(f,x),x)}return{value:f,source:x,stack:Sr(x)}}var Ji=[],qu=0,sf=null,qh=0,Oa=[],yo=0,Mr=null,cl=1,Lo="";function Oo(f,x){Ji[qu++]=qh,Ji[qu++]=sf,sf=f,qh=x}function Wh(f,x,C){Oa[yo++]=cl,Oa[yo++]=Lo,Oa[yo++]=Mr,Mr=f;var L=cl;f=Lo;var q=32-$n(L)-1;L&=~(1<<q),C+=1;var te=32-$n(x)+q;if(30<te){var we=q-q%5;te=(L&(1<<we)-1).toString(32),L>>=we,q-=we,cl=1<<32-$n(x)+q|C<<q|L,Lo=te+f}else cl=1<<te|C<<q|L,Lo=f}function Zh(f){f.return!==null&&(Oo(f,1),Wh(f,1,0))}function Fl(f){for(;f===sf;)sf=Ji[--qu],Ji[qu]=null,qh=Ji[--qu],Ji[qu]=null;for(;f===Mr;)Mr=Oa[--yo],Oa[yo]=null,Lo=Oa[--yo],Oa[yo]=null,cl=Oa[--yo],Oa[yo]=null}function Yc(f,x){Oa[yo++]=cl,Oa[yo++]=Lo,Oa[yo++]=Mr,cl=x.id,Lo=x.overflow,Mr=f}var us=null,mn=null,Gr=!1,ul=null,Ja=!1,hc=Error(d(519));function zo(f){var x=Error(d(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Wu(Cs(x,f)),hc}function Xh(f){var x=f.stateNode,C=f.type,L=f.memoizedProps;switch(x[qe]=f,x[Oe]=L,C){case"dialog":Ur("cancel",x),Ur("close",x);break;case"iframe":case"object":case"embed":Ur("load",x);break;case"video":case"audio":for(C=0;C<Th.length;C++)Ur(Th[C],x);break;case"source":Ur("error",x);break;case"img":case"image":case"link":Ur("error",x),Ur("load",x);break;case"details":Ur("toggle",x);break;case"input":Ur("invalid",x),Zs(x,L.value,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name,!0);break;case"select":Ur("invalid",x);break;case"textarea":Ur("invalid",x),Du(x,L.value,L.defaultValue,L.children)}C=L.children,typeof C!="string"&&typeof C!="number"&&typeof C!="bigint"||x.textContent===""+C||L.suppressHydrationWarning===!0||Ky(x.textContent,C)?(L.popover!=null&&(Ur("beforetoggle",x),Ur("toggle",x)),L.onScroll!=null&&Ur("scroll",x),L.onScrollEnd!=null&&Ur("scrollend",x),L.onClick!=null&&(x.onclick=cs),x=!0):x=!1,x||zo(f,!0)}function af(f){for(us=f.return;us;)switch(us.tag){case 5:case 31:case 13:Ja=!1;return;case 27:case 3:Ja=!0;return;default:us=us.return}}function Bl(f){if(f!==us)return!1;if(!Gr)return af(f),Gr=!0,!1;var x=f.tag,C;if((C=x!==3&&x!==27)&&((C=x===5)&&(C=f.type,C=!(C!=="form"&&C!=="button")||Ic(f.type,f.memoizedProps)),C=!C),C&&mn&&zo(f),af(f),x===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(d(317));mn=r_(f)}else if(x===31){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(d(317));mn=r_(f)}else x===27?(x=mn,Yo(f.type)?(f=Qp,Qp=null,mn=f):mn=x):mn=us?El(f.stateNode.nextSibling):null;return!0}function Fo(){mn=us=null,Gr=!1}function of(){var f=ul;return f!==null&&(Xt===null?Xt=f:Xt.push.apply(Xt,f),ul=null),f}function Wu(f){ul===null?ul=[f]:ul.push(f)}var lf=Me(null),_o=null,hl=null;function dc(f,x,C){ct(lf,x._currentValue),x._currentValue=C}function jl(f){f._currentValue=lf.current,at(lf)}function yp(f,x,C){for(;f!==null;){var L=f.alternate;if((f.childLanes&x)!==x?(f.childLanes|=x,L!==null&&(L.childLanes|=x)):L!==null&&(L.childLanes&x)!==x&&(L.childLanes|=x),f===C)break;f=f.return}}function Yh(f,x,C,L){var q=f.child;for(q!==null&&(q.return=f);q!==null;){var te=q.dependencies;if(te!==null){var we=q.child;te=te.firstContext;e:for(;te!==null;){var $e=te;te=q;for(var mt=0;mt<x.length;mt++)if($e.context===x[mt]){te.lanes|=C,$e=te.alternate,$e!==null&&($e.lanes|=C),yp(te.return,C,f),L||(we=null);break e}te=$e.next}}else if(q.tag===18){if(we=q.return,we===null)throw Error(d(341));we.lanes|=C,te=we.alternate,te!==null&&(te.lanes|=C),yp(we,C,f),we=null}else we=q.child;if(we!==null)we.return=q;else for(we=q;we!==null;){if(we===f){we=null;break}if(q=we.sibling,q!==null){q.return=we.return,we=q;break}we=we.return}q=we}}function fc(f,x,C,L){f=null;for(var q=x,te=!1;q!==null;){if(!te){if((q.flags&524288)!==0)te=!0;else if((q.flags&262144)!==0)break}if(q.tag===10){var we=q.alternate;if(we===null)throw Error(d(387));if(we=we.memoizedProps,we!==null){var $e=q.type;ba(q.pendingProps.value,we.value)||(f!==null?f.push($e):f=[$e])}}else if(q===bi.current){if(we=q.alternate,we===null)throw Error(d(387));we.memoizedState.memoizedState!==q.memoizedState.memoizedState&&(f!==null?f.push(Tl):f=[Tl])}q=q.return}f!==null&&Yh(x,f,C,L),x.flags|=262144}function Zu(f){for(f=f.firstContext;f!==null;){if(!ba(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function Nl(f){_o=f,hl=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function js(f){return Kh(_o,f)}function Kc(f,x){return _o===null&&Nl(f),Kh(f,x)}function Kh(f,x){var C=x._currentValue;if(x={context:x,memoizedValue:C,next:null},hl===null){if(f===null)throw Error(d(308));hl=x,f.dependencies={lanes:0,firstContext:x},f.flags|=524288}else hl=hl.next=x;return C}var Xu=typeof AbortController<"u"?AbortController:function(){var f=[],x=this.signal={aborted:!1,addEventListener:function(C,L){f.push(L)}};this.abort=function(){x.aborted=!0,f.forEach(function(C){return C()})}},Qh=t.unstable_scheduleCallback,zm=t.unstable_NormalPriority,en={$$typeof:Q,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Yu(){return{controller:new Xu,data:new Map,refCount:0}}function Vl(f){f.refCount--,f.refCount===0&&Qh(zm,function(){f.controller.abort()})}var eo=null,Ku=0,Ul=0,pc=null;function Qu(f,x){if(eo===null){var C=eo=[];Ku=0,Ul=Hp(),pc={status:"pending",value:void 0,then:function(L){C.push(L)}}}return Ku++,x.then(Ju,Ju),x}function Ju(){if(--Ku===0&&eo!==null){pc!==null&&(pc.status="fulfilled");var f=eo;eo=null,Ul=0,pc=null;for(var x=0;x<f.length;x++)(0,f[x])()}}function Jh(f,x){var C=[],L={status:"pending",value:null,reason:null,then:function(q){C.push(q)}};return f.then(function(){L.status="fulfilled",L.value=x;for(var q=0;q<C.length;q++)(0,C[q])(x)},function(q){for(L.status="rejected",L.reason=q,q=0;q<C.length;q++)(0,C[q])(void 0)}),L}var ed=xe.S;xe.S=function(f,x){Ti=Dr(),typeof x=="object"&&x!==null&&typeof x.then=="function"&&Qu(f,x),ed!==null&&ed(f,x)};var Gl=Me(null);function td(){var f=Gl.current;return f!==null?f:Qe.pooledCache}function eh(f,x){x===null?ct(Gl,Gl.current):ct(Gl,x.pool)}function Qc(){var f=td();return f===null?null:{parent:en._currentValue,pool:f}}var th=Error(d(460)),_p=Error(d(474)),rd=Error(d(542)),nd={then:function(){}};function sd(f){return f=f.status,f==="fulfilled"||f==="rejected"}function Fm(f,x,C){switch(C=f[C],C===void 0?f.push(x):C!==x&&(x.then(cs,cs),x=C),x.status){case"fulfilled":return x.value;case"rejected":throw f=x.reason,mc(f),f;default:if(typeof x.status=="string")x.then(cs,cs);else{if(f=Qe,f!==null&&100<f.shellSuspendCounter)throw Error(d(482));f=x,f.status="pending",f.then(function(L){if(x.status==="pending"){var q=x;q.status="fulfilled",q.value=L}},function(L){if(x.status==="pending"){var q=x;q.status="rejected",q.reason=L}})}switch(x.status){case"fulfilled":return x.value;case"rejected":throw f=x.reason,mc(f),f}throw $l=x,th}}function dl(f){try{var x=f._init;return x(f._payload)}catch(C){throw C!==null&&typeof C=="object"&&typeof C.then=="function"?($l=C,th):C}}var $l=null;function xp(){if($l===null)throw Error(d(459));var f=$l;return $l=null,f}function mc(f){if(f===th||f===rd)throw Error(d(483))}var gc=null,ih=0;function ad(f){var x=ih;return ih+=1,gc===null&&(gc=[]),Fm(gc,f,x)}function Jc(f,x){x=x.props.ref,f.ref=x!==void 0?x:null}function Bo(f,x){throw x.$$typeof===G?Error(d(525)):(f=Object.prototype.toString.call(x),Error(d(31,f==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":f)))}function yc(f){function x(Dt,xt){if(f){var Vt=Dt.deletions;Vt===null?(Dt.deletions=[xt],Dt.flags|=16):Vt.push(xt)}}function C(Dt,xt){if(!f)return null;for(;xt!==null;)x(Dt,xt),xt=xt.sibling;return null}function L(Dt){for(var xt=new Map;Dt!==null;)Dt.key!==null?xt.set(Dt.key,Dt):xt.set(Dt.index,Dt),Dt=Dt.sibling;return xt}function q(Dt,xt){return Dt=Ea(Dt,xt),Dt.index=0,Dt.sibling=null,Dt}function te(Dt,xt,Vt){return Dt.index=Vt,f?(Vt=Dt.alternate,Vt!==null?(Vt=Vt.index,Vt<xt?(Dt.flags|=67108866,xt):Vt):(Dt.flags|=67108866,xt)):(Dt.flags|=1048576,xt)}function we(Dt){return f&&Dt.alternate===null&&(Dt.flags|=67108866),Dt}function $e(Dt,xt,Vt,ui){return xt===null||xt.tag!==6?(xt=Hu(Vt,Dt.mode,ui),xt.return=Dt,xt):(xt=q(xt,Vt),xt.return=Dt,xt)}function mt(Dt,xt,Vt,ui){var ar=Vt.type;return ar===Y?ni(Dt,xt,Vt.props.children,ui,Vt.key):xt!==null&&(xt.elementType===ar||typeof ar=="object"&&ar!==null&&ar.$$typeof===Le&&dl(ar)===xt.type)?(xt=q(xt,Vt.props),Jc(xt,Vt),xt.return=Dt,xt):(xt=Xc(Vt.type,Vt.key,Vt.props,null,Dt.mode,ui),Jc(xt,Vt),xt.return=Dt,xt)}function Gt(Dt,xt,Vt,ui){return xt===null||xt.tag!==4||xt.stateNode.containerInfo!==Vt.containerInfo||xt.stateNode.implementation!==Vt.implementation?(xt=rf(Vt,Dt.mode,ui),xt.return=Dt,xt):(xt=q(xt,Vt.children||[]),xt.return=Dt,xt)}function ni(Dt,xt,Vt,ui,ar){return xt===null||xt.tag!==7?(xt=uc(Vt,Dt.mode,ui,ar),xt.return=Dt,xt):(xt=q(xt,Vt),xt.return=Dt,xt)}function di(Dt,xt,Vt){if(typeof xt=="string"&&xt!==""||typeof xt=="number"||typeof xt=="bigint")return xt=Hu(""+xt,Dt.mode,Vt),xt.return=Dt,xt;if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case J:return Vt=Xc(xt.type,xt.key,xt.props,null,Dt.mode,Vt),Jc(Vt,xt),Vt.return=Dt,Vt;case Z:return xt=rf(xt,Dt.mode,Vt),xt.return=Dt,xt;case Le:return xt=dl(xt),di(Dt,xt,Vt)}if(kt(xt)||Ot(xt))return xt=uc(xt,Dt.mode,Vt,null),xt.return=Dt,xt;if(typeof xt.then=="function")return di(Dt,ad(xt),Vt);if(xt.$$typeof===Q)return di(Dt,Kc(Dt,xt),Vt);Bo(Dt,xt)}return null}function Ht(Dt,xt,Vt,ui){var ar=xt!==null?xt.key:null;if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number"||typeof Vt=="bigint")return ar!==null?null:$e(Dt,xt,""+Vt,ui);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case J:return Vt.key===ar?mt(Dt,xt,Vt,ui):null;case Z:return Vt.key===ar?Gt(Dt,xt,Vt,ui):null;case Le:return Vt=dl(Vt),Ht(Dt,xt,Vt,ui)}if(kt(Vt)||Ot(Vt))return ar!==null?null:ni(Dt,xt,Vt,ui,null);if(typeof Vt.then=="function")return Ht(Dt,xt,ad(Vt),ui);if(Vt.$$typeof===Q)return Ht(Dt,xt,Kc(Dt,Vt),ui);Bo(Dt,Vt)}return null}function Jt(Dt,xt,Vt,ui,ar){if(typeof ui=="string"&&ui!==""||typeof ui=="number"||typeof ui=="bigint")return Dt=Dt.get(Vt)||null,$e(xt,Dt,""+ui,ar);if(typeof ui=="object"&&ui!==null){switch(ui.$$typeof){case J:return Dt=Dt.get(ui.key===null?Vt:ui.key)||null,mt(xt,Dt,ui,ar);case Z:return Dt=Dt.get(ui.key===null?Vt:ui.key)||null,Gt(xt,Dt,ui,ar);case Le:return ui=dl(ui),Jt(Dt,xt,Vt,ui,ar)}if(kt(ui)||Ot(ui))return Dt=Dt.get(Vt)||null,ni(xt,Dt,ui,ar,null);if(typeof ui.then=="function")return Jt(Dt,xt,Vt,ad(ui),ar);if(ui.$$typeof===Q)return Jt(Dt,xt,Vt,Kc(xt,ui),ar);Bo(xt,ui)}return null}function Hi(Dt,xt,Vt,ui){for(var ar=null,an=null,Ki=xt,Or=xt=0,Zr=null;Ki!==null&&Or<Vt.length;Or++){Ki.index>Or?(Zr=Ki,Ki=null):Zr=Ki.sibling;var nn=Ht(Dt,Ki,Vt[Or],ui);if(nn===null){Ki===null&&(Ki=Zr);break}f&&Ki&&nn.alternate===null&&x(Dt,Ki),xt=te(nn,xt,Or),an===null?ar=nn:an.sibling=nn,an=nn,Ki=Zr}if(Or===Vt.length)return C(Dt,Ki),Gr&&Oo(Dt,Or),ar;if(Ki===null){for(;Or<Vt.length;Or++)Ki=di(Dt,Vt[Or],ui),Ki!==null&&(xt=te(Ki,xt,Or),an===null?ar=Ki:an.sibling=Ki,an=Ki);return Gr&&Oo(Dt,Or),ar}for(Ki=L(Ki);Or<Vt.length;Or++)Zr=Jt(Ki,Dt,Or,Vt[Or],ui),Zr!==null&&(f&&Zr.alternate!==null&&Ki.delete(Zr.key===null?Or:Zr.key),xt=te(Zr,xt,Or),an===null?ar=Zr:an.sibling=Zr,an=Zr);return f&&Ki.forEach(function(tc){return x(Dt,tc)}),Gr&&Oo(Dt,Or),ar}function ir(Dt,xt,Vt,ui){if(Vt==null)throw Error(d(151));for(var ar=null,an=null,Ki=xt,Or=xt=0,Zr=null,nn=Vt.next();Ki!==null&&!nn.done;Or++,nn=Vt.next()){Ki.index>Or?(Zr=Ki,Ki=null):Zr=Ki.sibling;var tc=Ht(Dt,Ki,nn.value,ui);if(tc===null){Ki===null&&(Ki=Zr);break}f&&Ki&&tc.alternate===null&&x(Dt,Ki),xt=te(tc,xt,Or),an===null?ar=tc:an.sibling=tc,an=tc,Ki=Zr}if(nn.done)return C(Dt,Ki),Gr&&Oo(Dt,Or),ar;if(Ki===null){for(;!nn.done;Or++,nn=Vt.next())nn=di(Dt,nn.value,ui),nn!==null&&(xt=te(nn,xt,Or),an===null?ar=nn:an.sibling=nn,an=nn);return Gr&&Oo(Dt,Or),ar}for(Ki=L(Ki);!nn.done;Or++,nn=Vt.next())nn=Jt(Ki,Dt,Or,nn.value,ui),nn!==null&&(f&&nn.alternate!==null&&Ki.delete(nn.key===null?Or:nn.key),xt=te(nn,xt,Or),an===null?ar=nn:an.sibling=nn,an=nn);return f&&Ki.forEach(function(x_){return x(Dt,x_)}),Gr&&Oo(Dt,Or),ar}function xn(Dt,xt,Vt,ui){if(typeof Vt=="object"&&Vt!==null&&Vt.type===Y&&Vt.key===null&&(Vt=Vt.props.children),typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case J:e:{for(var ar=Vt.key;xt!==null;){if(xt.key===ar){if(ar=Vt.type,ar===Y){if(xt.tag===7){C(Dt,xt.sibling),ui=q(xt,Vt.props.children),ui.return=Dt,Dt=ui;break e}}else if(xt.elementType===ar||typeof ar=="object"&&ar!==null&&ar.$$typeof===Le&&dl(ar)===xt.type){C(Dt,xt.sibling),ui=q(xt,Vt.props),Jc(ui,Vt),ui.return=Dt,Dt=ui;break e}C(Dt,xt);break}else x(Dt,xt);xt=xt.sibling}Vt.type===Y?(ui=uc(Vt.props.children,Dt.mode,ui,Vt.key),ui.return=Dt,Dt=ui):(ui=Xc(Vt.type,Vt.key,Vt.props,null,Dt.mode,ui),Jc(ui,Vt),ui.return=Dt,Dt=ui)}return we(Dt);case Z:e:{for(ar=Vt.key;xt!==null;){if(xt.key===ar)if(xt.tag===4&&xt.stateNode.containerInfo===Vt.containerInfo&&xt.stateNode.implementation===Vt.implementation){C(Dt,xt.sibling),ui=q(xt,Vt.children||[]),ui.return=Dt,Dt=ui;break e}else{C(Dt,xt);break}else x(Dt,xt);xt=xt.sibling}ui=rf(Vt,Dt.mode,ui),ui.return=Dt,Dt=ui}return we(Dt);case Le:return Vt=dl(Vt),xn(Dt,xt,Vt,ui)}if(kt(Vt))return Hi(Dt,xt,Vt,ui);if(Ot(Vt)){if(ar=Ot(Vt),typeof ar!="function")throw Error(d(150));return Vt=ar.call(Vt),ir(Dt,xt,Vt,ui)}if(typeof Vt.then=="function")return xn(Dt,xt,ad(Vt),ui);if(Vt.$$typeof===Q)return xn(Dt,xt,Kc(Dt,Vt),ui);Bo(Dt,Vt)}return typeof Vt=="string"&&Vt!==""||typeof Vt=="number"||typeof Vt=="bigint"?(Vt=""+Vt,xt!==null&&xt.tag===6?(C(Dt,xt.sibling),ui=q(xt,Vt),ui.return=Dt,Dt=ui):(C(Dt,xt),ui=Hu(Vt,Dt.mode,ui),ui.return=Dt,Dt=ui),we(Dt)):C(Dt,xt)}return function(Dt,xt,Vt,ui){try{ih=0;var ar=xn(Dt,xt,Vt,ui);return gc=null,ar}catch(Ki){if(Ki===th||Ki===rd)throw Ki;var an=wa(29,Ki,null,Dt.mode);return an.lanes=ui,an.return=Dt,an}finally{}}}var fl=yc(!0),vp=yc(!1),Sa=!1;function od(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rh(f,x){f=f.updateQueue,x.updateQueue===f&&(x.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function pl(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function Hl(f,x,C){var L=f.updateQueue;if(L===null)return null;if(L=L.shared,(Xe&2)!==0){var q=L.pending;return q===null?x.next=x:(x.next=q.next,q.next=x),L.pending=x,x=$u(f),tf(f,null,C),x}return da(f,L,x,C),$u(f)}function eu(f,x,C){if(x=x.updateQueue,x!==null&&(x=x.shared,(C&4194048)!==0)){var L=x.lanes;L&=f.pendingLanes,C|=L,x.lanes=C,aa(f,C)}}function nh(f,x){var C=f.updateQueue,L=f.alternate;if(L!==null&&(L=L.updateQueue,C===L)){var q=null,te=null;if(C=C.firstBaseUpdate,C!==null){do{var we={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};te===null?q=te=we:te=te.next=we,C=C.next}while(C!==null);te===null?q=te=x:te=te.next=x}else q=te=x;C={baseState:L.baseState,firstBaseUpdate:q,lastBaseUpdate:te,shared:L.shared,callbacks:L.callbacks},f.updateQueue=C;return}f=C.lastBaseUpdate,f===null?C.firstBaseUpdate=x:f.next=x,C.lastBaseUpdate=x}var cf=!1;function tu(){if(cf){var f=pc;if(f!==null)throw f}}function ql(f,x,C,L){cf=!1;var q=f.updateQueue;Sa=!1;var te=q.firstBaseUpdate,we=q.lastBaseUpdate,$e=q.shared.pending;if($e!==null){q.shared.pending=null;var mt=$e,Gt=mt.next;mt.next=null,we===null?te=Gt:we.next=Gt,we=mt;var ni=f.alternate;ni!==null&&(ni=ni.updateQueue,$e=ni.lastBaseUpdate,$e!==we&&($e===null?ni.firstBaseUpdate=Gt:$e.next=Gt,ni.lastBaseUpdate=mt))}if(te!==null){var di=q.baseState;we=0,ni=Gt=mt=null,$e=te;do{var Ht=$e.lane&-536870913,Jt=Ht!==$e.lane;if(Jt?(tt&Ht)===Ht:(L&Ht)===Ht){Ht!==0&&Ht===Ul&&(cf=!0),ni!==null&&(ni=ni.next={lane:0,tag:$e.tag,payload:$e.payload,callback:null,next:null});e:{var Hi=f,ir=$e;Ht=x;var xn=C;switch(ir.tag){case 1:if(Hi=ir.payload,typeof Hi=="function"){di=Hi.call(xn,di,Ht);break e}di=Hi;break e;case 3:Hi.flags=Hi.flags&-65537|128;case 0:if(Hi=ir.payload,Ht=typeof Hi=="function"?Hi.call(xn,di,Ht):Hi,Ht==null)break e;di=V({},di,Ht);break e;case 2:Sa=!0}}Ht=$e.callback,Ht!==null&&(f.flags|=64,Jt&&(f.flags|=8192),Jt=q.callbacks,Jt===null?q.callbacks=[Ht]:Jt.push(Ht))}else Jt={lane:Ht,tag:$e.tag,payload:$e.payload,callback:$e.callback,next:null},ni===null?(Gt=ni=Jt,mt=di):ni=ni.next=Jt,we|=Ht;if($e=$e.next,$e===null){if($e=q.shared.pending,$e===null)break;Jt=$e,$e=Jt.next,Jt.next=null,q.lastBaseUpdate=Jt,q.shared.pending=null}}while(!0);ni===null&&(mt=di),q.baseState=mt,q.firstBaseUpdate=Gt,q.lastBaseUpdate=ni,te===null&&(q.shared.lanes=0),Lt|=we,f.lanes=we,f.memoizedState=di}}function iu(f,x){if(typeof f!="function")throw Error(d(191,f));f.call(x)}function Bm(f,x){var C=f.callbacks;if(C!==null)for(f.callbacks=null,f=0;f<C.length;f++)iu(C[f],x)}var ru=Me(null),uf=Me(0);function ld(f,x){f=ot,ct(uf,f),ct(ru,x),ot=f|x.baseLanes}function nu(){ct(uf,ot),ct(ru,ru.current)}function ml(){ot=uf.current,at(ru),at(uf)}var Qs=Me(null),Ns=null;function jo(f){var x=f.alternate;ct(hs,hs.current&1),ct(Qs,f),Ns===null&&(x===null||ru.current!==null||x.memoizedState!==null)&&(Ns=f)}function su(f){ct(hs,hs.current),ct(Qs,f),Ns===null&&(Ns=f)}function cd(f){f.tag===22?(ct(hs,hs.current),ct(Qs,f),Ns===null&&(Ns=f)):Js()}function Js(){ct(hs,hs.current),ct(Qs,Qs.current)}function za(f){at(Qs),Ns===f&&(Ns=null),at(hs)}var hs=Me(0);function gl(f){for(var x=f;x!==null;){if(x.tag===13){var C=x.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||Wg(C)||Zg(C)))return x}else if(x.tag===19&&(x.memoizedProps.revealOrder==="forwards"||x.memoizedProps.revealOrder==="backwards"||x.memoizedProps.revealOrder==="unstable_legacy-backwards"||x.memoizedProps.revealOrder==="together")){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===f)break;for(;x.sibling===null;){if(x.return===null||x.return===f)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var xo=0,Ut=null,gn=null,yn=null,vo=!1,au=!1,_c=!1,ou=0,xc=0,vc=null,bp=0;function Dn(){throw Error(d(321))}function bc(f,x){if(x===null)return!1;for(var C=0;C<x.length&&C<f.length;C++)if(!ba(f[C],x[C]))return!1;return!0}function lu(f,x,C,L,q,te){return xo=te,Ut=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,xe.H=f===null||f.memoizedState===null?Ef:vd,_c=!1,te=C(L,q),_c=!1,au&&(te=wp(x,C,L,q)),No(f),te}function No(f){xe.H=Uo;var x=gn!==null&&gn.next!==null;if(xo=0,yn=gn=Ut=null,vo=!1,xc=0,vc=null,x)throw Error(d(300));f===null||is||(f=f.dependencies,f!==null&&Zu(f)&&(is=!0))}function wp(f,x,C,L){Ut=f;var q=0;do{if(au&&(vc=null),xc=0,au=!1,25<=q)throw Error(d(301));if(q+=1,yn=gn=null,f.updateQueue!=null){var te=f.updateQueue;te.lastEffect=null,te.events=null,te.stores=null,te.memoCache!=null&&(te.memoCache.index=0)}xe.H=Lp,te=x(C,L)}while(au);return te}function jm(){var f=xe.H,x=f.useState()[0];return x=typeof x.then=="function"?wc(x):x,f=f.useState()[0],(gn!==null?gn.memoizedState:null)!==f&&(Ut.flags|=1024),x}function hf(){var f=ou!==0;return ou=0,f}function df(f,x,C){x.updateQueue=f.updateQueue,x.flags&=-2053,f.lanes&=~C}function ud(f){if(vo){for(f=f.memoizedState;f!==null;){var x=f.queue;x!==null&&(x.pending=null),f=f.next}vo=!1}xo=0,yn=gn=Ut=null,au=!1,xc=ou=0,vc=null}function bs(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?Ut.memoizedState=yn=f:yn=yn.next=f,yn}function Hn(){if(gn===null){var f=Ut.alternate;f=f!==null?f.memoizedState:null}else f=gn.next;var x=yn===null?Ut.memoizedState:yn.next;if(x!==null)yn=x,gn=f;else{if(f===null)throw Ut.alternate===null?Error(d(467)):Error(d(310));gn=f,f={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},yn===null?Ut.memoizedState=yn=f:yn=yn.next=f}return yn}function sh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function wc(f){var x=xc;return xc+=1,vc===null&&(vc=[]),f=Fm(vc,f,x),x=Ut,(yn===null?x.memoizedState:yn.next)===null&&(x=x.alternate,xe.H=x===null||x.memoizedState===null?Ef:vd),f}function hd(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return wc(f);if(f.$$typeof===Q)return js(f)}throw Error(d(438,String(f)))}function ff(f){var x=null,C=Ut.updateQueue;if(C!==null&&(x=C.memoCache),x==null){var L=Ut.alternate;L!==null&&(L=L.updateQueue,L!==null&&(L=L.memoCache,L!=null&&(x={data:L.data.map(function(q){return q.slice()}),index:0})))}if(x==null&&(x={data:[],index:0}),C===null&&(C=sh(),Ut.updateQueue=C),C.memoCache=x,C=x.data[x.index],C===void 0)for(C=x.data[x.index]=Array(f),L=0;L<f;L++)C[L]=qt;return x.index++,C}function Vo(f,x){return typeof x=="function"?x(f):x}function dd(f){var x=Hn();return fd(x,gn,f)}function fd(f,x,C){var L=f.queue;if(L===null)throw Error(d(311));L.lastRenderedReducer=C;var q=f.baseQueue,te=L.pending;if(te!==null){if(q!==null){var we=q.next;q.next=te.next,te.next=we}x.baseQueue=q=te,L.pending=null}if(te=f.baseState,q===null)f.memoizedState=te;else{x=q.next;var $e=we=null,mt=null,Gt=x,ni=!1;do{var di=Gt.lane&-536870913;if(di!==Gt.lane?(tt&di)===di:(xo&di)===di){var Ht=Gt.revertLane;if(Ht===0)mt!==null&&(mt=mt.next={lane:0,revertLane:0,gesture:null,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null}),di===Ul&&(ni=!0);else if((xo&Ht)===Ht){Gt=Gt.next,Ht===Ul&&(ni=!0);continue}else di={lane:0,revertLane:Gt.revertLane,gesture:null,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null},mt===null?($e=mt=di,we=te):mt=mt.next=di,Ut.lanes|=Ht,Lt|=Ht;di=Gt.action,_c&&C(te,di),te=Gt.hasEagerState?Gt.eagerState:C(te,di)}else Ht={lane:di,revertLane:Gt.revertLane,gesture:Gt.gesture,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null},mt===null?($e=mt=Ht,we=te):mt=mt.next=Ht,Ut.lanes|=di,Lt|=di;Gt=Gt.next}while(Gt!==null&&Gt!==x);if(mt===null?we=te:mt.next=$e,!ba(te,f.memoizedState)&&(is=!0,ni&&(C=pc,C!==null)))throw C;f.memoizedState=te,f.baseState=we,f.baseQueue=mt,L.lastRenderedState=te}return q===null&&(L.lanes=0),[f.memoizedState,L.dispatch]}function pf(f){var x=Hn(),C=x.queue;if(C===null)throw Error(d(311));C.lastRenderedReducer=f;var L=C.dispatch,q=C.pending,te=x.memoizedState;if(q!==null){C.pending=null;var we=q=q.next;do te=f(te,we.action),we=we.next;while(we!==q);ba(te,x.memoizedState)||(is=!0),x.memoizedState=te,x.baseQueue===null&&(x.baseState=te),C.lastRenderedState=te}return[te,L]}function mf(f,x,C){var L=Ut,q=Hn(),te=Gr;if(te){if(C===void 0)throw Error(d(407));C=C()}else C=x();var we=!ba((gn||q).memoizedState,C);if(we&&(q.memoizedState=C,is=!0),q=q.queue,cu(Nm.bind(null,L,q,f),[f]),q.getSnapshot!==x||we||yn!==null&&yn.memoizedState.tag&1){if(L.flags|=2048,Ec(9,{destroy:void 0},yf.bind(null,L,q,C,x),null),Qe===null)throw Error(d(349));te||(xo&127)!==0||gf(L,x,C)}return C}function gf(f,x,C){f.flags|=16384,f={getSnapshot:x,value:C},x=Ut.updateQueue,x===null?(x=sh(),Ut.updateQueue=x,x.stores=[f]):(C=x.stores,C===null?x.stores=[f]:C.push(f))}function yf(f,x,C,L){x.value=C,x.getSnapshot=L,Vm(x)&&Ep(f)}function Nm(f,x,C){return C(function(){Vm(x)&&Ep(f)})}function Vm(f){var x=f.getSnapshot;f=f.value;try{var C=x();return!ba(f,C)}catch{return!0}}function Ep(f){var x=$t(f,2);x!==null&&Oi(x,f,2)}function yl(f){var x=bs();if(typeof f=="function"){var C=f;if(f=C(),_c){Sn(!0);try{C()}finally{Sn(!1)}}}return x.memoizedState=x.baseState=f,x.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:f},x}function Sp(f,x,C,L){return f.baseState=C,fd(f,gn,typeof L=="function"?L:Vo)}function Tp(f,x,C,L,q){if(_d(f))throw Error(d(485));if(f=x.action,f!==null){var te={payload:q,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(we){te.listeners.push(we)}};xe.T!==null?C(!0):te.isTransition=!1,L(te),C=x.pending,C===null?(te.next=x.pending=te,pd(x,te)):(te.next=C.next,x.pending=C.next=te)}}function pd(f,x){var C=x.action,L=x.payload,q=f.state;if(x.isTransition){var te=xe.T,we={};xe.T=we;try{var $e=C(q,L),mt=xe.S;mt!==null&&mt(we,$e),Ap(f,x,$e)}catch(Gt){_l(f,x,Gt)}finally{te!==null&&we.types!==null&&(te.types=we.types),xe.T=te}}else try{te=C(q,L),Ap(f,x,te)}catch(Gt){_l(f,x,Gt)}}function Ap(f,x,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(L){Um(f,x,L)},function(L){return _l(f,x,L)}):Um(f,x,C)}function Um(f,x,C){x.status="fulfilled",x.value=C,fa(x),f.state=C,x=f.pending,x!==null&&(C=x.next,C===x?f.pending=null:(C=C.next,x.next=C,pd(f,C)))}function _l(f,x,C){var L=f.pending;if(f.pending=null,L!==null){L=L.next;do x.status="rejected",x.reason=C,fa(x),x=x.next;while(x!==L)}f.action=null}function fa(f){f=f.listeners;for(var x=0;x<f.length;x++)(0,f[x])()}function Wl(f,x){return x}function ea(f,x){if(Gr){var C=Qe.formState;if(C!==null){e:{var L=Ut;if(Gr){if(mn){t:{for(var q=mn,te=Ja;q.nodeType!==8;){if(!te){q=null;break t}if(q=El(q.nextSibling),q===null){q=null;break t}}te=q.data,q=te==="F!"||te==="F"?q:null}if(q){mn=El(q.nextSibling),L=q.data==="F!";break e}}zo(L)}L=!1}L&&(x=C[0])}}return C=bs(),C.memoizedState=C.baseState=x,L={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wl,lastRenderedState:x},C.queue=L,C=lh.bind(null,Ut,L),L.dispatch=C,L=yl(!1),te=yd.bind(null,Ut,!1,L.queue),L=bs(),q={state:x,dispatch:null,action:f,pending:null},L.queue=q,C=Tp.bind(null,Ut,q,te,C),q.dispatch=C,L.memoizedState=f,[x,C,!1]}function Zl(f){var x=Hn();return Cp(x,gn,f)}function Cp(f,x,C){if(x=fd(f,x,Wl)[0],f=dd(Vo)[0],typeof x=="object"&&x!==null&&typeof x.then=="function")try{var L=wc(x)}catch(we){throw we===th?rd:we}else L=x;x=Hn();var q=x.queue,te=q.dispatch;return C!==x.memoizedState&&(Ut.flags|=2048,Ec(9,{destroy:void 0},Rp.bind(null,q,C),null)),[L,te,f]}function Rp(f,x){f.action=x}function _f(f){var x=Hn(),C=gn;if(C!==null)return Cp(x,C,f);Hn(),x=x.memoizedState,C=Hn();var L=C.queue.dispatch;return C.memoizedState=f,[x,L,!1]}function Ec(f,x,C,L){return f={tag:f,create:C,deps:L,inst:x,next:null},x=Ut.updateQueue,x===null&&(x=sh(),Ut.updateQueue=x),C=x.lastEffect,C===null?x.lastEffect=f.next=f:(L=C.next,C.next=f,f.next=L,x.lastEffect=f),f}function xf(){return Hn().memoizedState}function Fa(f,x,C,L){var q=bs();Ut.flags|=f,q.memoizedState=Ec(1|x,{destroy:void 0},C,L===void 0?null:L)}function xr(f,x,C,L){var q=Hn();L=L===void 0?null:L;var te=q.memoizedState.inst;gn!==null&&L!==null&&bc(L,gn.memoizedState.deps)?q.memoizedState=Ec(x,te,C,L):(Ut.flags|=f,q.memoizedState=Ec(1|x,te,C,L))}function ah(f,x){Fa(8390656,8,f,x)}function cu(f,x){xr(2048,8,f,x)}function oh(f){Ut.flags|=4;var x=Ut.updateQueue;if(x===null)x=sh(),Ut.updateQueue=x,x.events=[f];else{var C=x.events;C===null?x.events=[f]:C.push(f)}}function Mp(f){var x=Hn().memoizedState;return oh({ref:x,nextImpl:f}),function(){if((Xe&2)!==0)throw Error(d(440));return x.impl.apply(void 0,arguments)}}function Pp(f,x){return xr(4,2,f,x)}function vf(f,x){return xr(4,4,f,x)}function Sc(f,x){if(typeof x=="function"){f=f();var C=x(f);return function(){typeof C=="function"?C():x(null)}}if(x!=null)return f=f(),x.current=f,function(){x.current=null}}function ta(f,x,C){C=C!=null?C.concat([f]):null,xr(4,4,Sc.bind(null,x,f),C)}function Nt(){}function Qt(f,x){var C=Hn();x=x===void 0?null:x;var L=C.memoizedState;return x!==null&&bc(x,L[1])?L[0]:(C.memoizedState=[f,x],f)}function uu(f,x){var C=Hn();x=x===void 0?null:x;var L=C.memoizedState;if(x!==null&&bc(x,L[1]))return L[0];if(L=f(),_c){Sn(!0);try{f()}finally{Sn(!1)}}return C.memoizedState=[L,x],L}function Kr(f,x,C){return C===void 0||(xo&1073741824)!==0&&(tt&261930)===0?f.memoizedState=x:(f.memoizedState=C,f=pr(),Ut.lanes|=f,Lt|=f,C)}function it(f,x,C,L){return ba(C,x)?C:ru.current!==null?(f=Kr(f,C,L),ba(f,x)||(is=!0),f):(xo&42)===0||(xo&1073741824)!==0&&(tt&261930)===0?(is=!0,f.memoizedState=C):(f=pr(),Ut.lanes|=f,Lt|=f,x)}function Ip(f,x,C,L,q){var te=Fe.p;Fe.p=te!==0&&8>te?te:8;var we=xe.T,$e={};xe.T=$e,yd(f,!1,x,C);try{var mt=q(),Gt=xe.S;if(Gt!==null&&Gt($e,mt),mt!==null&&typeof mt=="object"&&typeof mt.then=="function"){var ni=Jh(mt,L);Ba(f,x,ni,br(f))}else Ba(f,x,L,br(f))}catch(di){Ba(f,x,{then:function(){},status:"rejected",reason:di},br())}finally{Fe.p=te,we!==null&&$e.types!==null&&(we.types=$e.types),xe.T=we}}function bf(){}function md(f,x,C,L){if(f.tag!==5)throw Error(d(476));var q=wf(f).queue;Ip(f,q,x,pe,C===null?bf:function(){return Dp(f),C(L)})}function wf(f){var x=f.memoizedState;if(x!==null)return x;x={memoizedState:pe,baseState:pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:pe},next:null};var C={};return x.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:C},next:null},f.memoizedState=x,f=f.alternate,f!==null&&(f.memoizedState=x),x}function Dp(f){var x=wf(f);x.next===null&&(x=f.alternate.memoizedState),Ba(f,x.next.queue,{},br())}function gd(){return js(Tl)}function hu(){return Hn().memoizedState}function Gm(){return Hn().memoizedState}function zg(f){for(var x=f.return;x!==null;){switch(x.tag){case 24:case 3:var C=br();f=pl(C);var L=Hl(x,f,C);L!==null&&(Oi(L,x,C),eu(L,x,C)),x={cache:Yu()},f.payload=x;return}x=x.return}}function kp(f,x,C){var L=br();C={lane:L,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},_d(f)?xd(x,C):(C=Zc(f,x,C,L),C!==null&&(Oi(C,f,L),ch(C,x,L)))}function lh(f,x,C){var L=br();Ba(f,x,C,L)}function Ba(f,x,C,L){var q={lane:L,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null};if(_d(f))xd(x,q);else{var te=f.alternate;if(f.lanes===0&&(te===null||te.lanes===0)&&(te=x.lastRenderedReducer,te!==null))try{var we=x.lastRenderedState,$e=te(we,C);if(q.hasEagerState=!0,q.eagerState=$e,ba($e,we))return da(f,x,q,0),Qe===null&&Wc(),!1}catch{}finally{}if(C=Zc(f,x,q,L),C!==null)return Oi(C,f,L),ch(C,x,L),!0}return!1}function yd(f,x,C,L){if(L={lane:2,revertLane:Hp(),gesture:null,action:L,hasEagerState:!1,eagerState:null,next:null},_d(f)){if(x)throw Error(d(479))}else x=Zc(f,C,L,2),x!==null&&Oi(x,f,2)}function _d(f){var x=f.alternate;return f===Ut||x!==null&&x===Ut}function xd(f,x){au=vo=!0;var C=f.pending;C===null?x.next=x:(x.next=C.next,C.next=x),f.pending=x}function ch(f,x,C){if((C&4194048)!==0){var L=x.lanes;L&=f.pendingLanes,C|=L,x.lanes=C,aa(f,C)}}var Uo={readContext:js,use:hd,useCallback:Dn,useContext:Dn,useEffect:Dn,useImperativeHandle:Dn,useLayoutEffect:Dn,useInsertionEffect:Dn,useMemo:Dn,useReducer:Dn,useRef:Dn,useState:Dn,useDebugValue:Dn,useDeferredValue:Dn,useTransition:Dn,useSyncExternalStore:Dn,useId:Dn,useHostTransitionStatus:Dn,useFormState:Dn,useActionState:Dn,useOptimistic:Dn,useMemoCache:Dn,useCacheRefresh:Dn};Uo.useEffectEvent=Dn;var Ef={readContext:js,use:hd,useCallback:function(f,x){return bs().memoizedState=[f,x===void 0?null:x],f},useContext:js,useEffect:ah,useImperativeHandle:function(f,x,C){C=C!=null?C.concat([f]):null,Fa(4194308,4,Sc.bind(null,x,f),C)},useLayoutEffect:function(f,x){return Fa(4194308,4,f,x)},useInsertionEffect:function(f,x){Fa(4,2,f,x)},useMemo:function(f,x){var C=bs();x=x===void 0?null:x;var L=f();if(_c){Sn(!0);try{f()}finally{Sn(!1)}}return C.memoizedState=[L,x],L},useReducer:function(f,x,C){var L=bs();if(C!==void 0){var q=C(x);if(_c){Sn(!0);try{C(x)}finally{Sn(!1)}}}else q=x;return L.memoizedState=L.baseState=q,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:q},L.queue=f,f=f.dispatch=kp.bind(null,Ut,f),[L.memoizedState,f]},useRef:function(f){var x=bs();return f={current:f},x.memoizedState=f},useState:function(f){f=yl(f);var x=f.queue,C=lh.bind(null,Ut,x);return x.dispatch=C,[f.memoizedState,C]},useDebugValue:Nt,useDeferredValue:function(f,x){var C=bs();return Kr(C,f,x)},useTransition:function(){var f=yl(!1);return f=Ip.bind(null,Ut,f.queue,!0,!1),bs().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,x,C){var L=Ut,q=bs();if(Gr){if(C===void 0)throw Error(d(407));C=C()}else{if(C=x(),Qe===null)throw Error(d(349));(tt&127)!==0||gf(L,x,C)}q.memoizedState=C;var te={value:C,getSnapshot:x};return q.queue=te,ah(Nm.bind(null,L,te,f),[f]),L.flags|=2048,Ec(9,{destroy:void 0},yf.bind(null,L,te,C,x),null),C},useId:function(){var f=bs(),x=Qe.identifierPrefix;if(Gr){var C=Lo,L=cl;C=(L&~(1<<32-$n(L)-1)).toString(32)+C,x="_"+x+"R_"+C,C=ou++,0<C&&(x+="H"+C.toString(32)),x+="_"}else C=bp++,x="_"+x+"r_"+C.toString(32)+"_";return f.memoizedState=x},useHostTransitionStatus:gd,useFormState:ea,useActionState:ea,useOptimistic:function(f){var x=bs();x.memoizedState=x.baseState=f;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return x.queue=C,x=yd.bind(null,Ut,!0,C),C.dispatch=x,[f,x]},useMemoCache:ff,useCacheRefresh:function(){return bs().memoizedState=zg.bind(null,Ut)},useEffectEvent:function(f){var x=bs(),C={impl:f};return x.memoizedState=C,function(){if((Xe&2)!==0)throw Error(d(440));return C.impl.apply(void 0,arguments)}}},vd={readContext:js,use:hd,useCallback:Qt,useContext:js,useEffect:cu,useImperativeHandle:ta,useInsertionEffect:Pp,useLayoutEffect:vf,useMemo:uu,useReducer:dd,useRef:xf,useState:function(){return dd(Vo)},useDebugValue:Nt,useDeferredValue:function(f,x){var C=Hn();return it(C,gn.memoizedState,f,x)},useTransition:function(){var f=dd(Vo)[0],x=Hn().memoizedState;return[typeof f=="boolean"?f:wc(f),x]},useSyncExternalStore:mf,useId:hu,useHostTransitionStatus:gd,useFormState:Zl,useActionState:Zl,useOptimistic:function(f,x){var C=Hn();return Sp(C,gn,f,x)},useMemoCache:ff,useCacheRefresh:Gm};vd.useEffectEvent=Mp;var Lp={readContext:js,use:hd,useCallback:Qt,useContext:js,useEffect:cu,useImperativeHandle:ta,useInsertionEffect:Pp,useLayoutEffect:vf,useMemo:uu,useReducer:pf,useRef:xf,useState:function(){return pf(Vo)},useDebugValue:Nt,useDeferredValue:function(f,x){var C=Hn();return gn===null?Kr(C,f,x):it(C,gn.memoizedState,f,x)},useTransition:function(){var f=pf(Vo)[0],x=Hn().memoizedState;return[typeof f=="boolean"?f:wc(f),x]},useSyncExternalStore:mf,useId:hu,useHostTransitionStatus:gd,useFormState:_f,useActionState:_f,useOptimistic:function(f,x){var C=Hn();return gn!==null?Sp(C,gn,f,x):(C.baseState=f,[f,C.queue.dispatch])},useMemoCache:ff,useCacheRefresh:Gm};Lp.useEffectEvent=Mp;function Sf(f,x,C,L){x=f.memoizedState,C=C(L,x),C=C==null?x:V({},x,C),f.memoizedState=C,f.lanes===0&&(f.updateQueue.baseState=C)}var Tf={enqueueSetState:function(f,x,C){f=f._reactInternals;var L=br(),q=pl(L);q.payload=x,C!=null&&(q.callback=C),x=Hl(f,q,L),x!==null&&(Oi(x,f,L),eu(x,f,L))},enqueueReplaceState:function(f,x,C){f=f._reactInternals;var L=br(),q=pl(L);q.tag=1,q.payload=x,C!=null&&(q.callback=C),x=Hl(f,q,L),x!==null&&(Oi(x,f,L),eu(x,f,L))},enqueueForceUpdate:function(f,x){f=f._reactInternals;var C=br(),L=pl(C);L.tag=2,x!=null&&(L.callback=x),x=Hl(f,L,C),x!==null&&(Oi(x,f,C),eu(x,f,C))}};function ia(f,x,C,L,q,te,we){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(L,te,we):x.prototype&&x.prototype.isPureReactComponent?!La(C,L)||!La(q,te):!0}function Op(f,x,C,L){f=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(C,L),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(C,L),x.state!==f&&Tf.enqueueReplaceState(x,x.state,null)}function ja(f,x){var C=x;if("ref"in x){C={};for(var L in x)L!=="ref"&&(C[L]=x[L])}if(f=f.defaultProps){C===x&&(C=V({},C));for(var q in f)C[q]===void 0&&(C[q]=f[q])}return C}function $m(f){Gu(f)}function Nr(f){console.error(f)}function Xi(f){Gu(f)}function bd(f,x){try{var C=f.onUncaughtError;C(x.value,{componentStack:x.stack})}catch(L){setTimeout(function(){throw L})}}function Xl(f,x,C){try{var L=f.onCaughtError;L(C.value,{componentStack:C.stack,errorBoundary:x.tag===1?x.stateNode:null})}catch(q){setTimeout(function(){throw q})}}function Go(f,x,C){return C=pl(C),C.tag=3,C.payload={element:null},C.callback=function(){bd(f,x)},C}function xl(f){return f=pl(f),f.tag=3,f}function ds(f,x,C,L){var q=C.type.getDerivedStateFromError;if(typeof q=="function"){var te=L.value;f.payload=function(){return q(te)},f.callback=function(){Xl(x,C,L)}}var we=C.stateNode;we!==null&&typeof we.componentDidCatch=="function"&&(f.callback=function(){Xl(x,C,L),typeof q!="function"&&(Ai===null?Ai=new Set([this]):Ai.add(this));var $e=L.stack;this.componentDidCatch(L.value,{componentStack:$e!==null?$e:""})})}function uh(f,x,C,L,q){if(C.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){if(x=C.alternate,x!==null&&fc(x,C,q,!0),C=Qs.current,C!==null){switch(C.tag){case 31:case 13:return Ns===null?Ms():C.alternate===null&&bt===0&&(bt=3),C.flags&=-257,C.flags|=65536,C.lanes=q,L===nd?C.flags|=16384:(x=C.updateQueue,x===null?C.updateQueue=new Set([L]):x.add(L),Jl(f,L,q)),!1;case 22:return C.flags|=65536,L===nd?C.flags|=16384:(x=C.updateQueue,x===null?(x={transitions:null,markerInstances:null,retryQueue:new Set([L])},C.updateQueue=x):(C=x.retryQueue,C===null?x.retryQueue=new Set([L]):C.add(L)),Jl(f,L,q)),!1}throw Error(d(435,C.tag))}return Jl(f,L,q),Ms(),!1}if(Gr)return x=Qs.current,x!==null?((x.flags&65536)===0&&(x.flags|=256),x.flags|=65536,x.lanes=q,L!==hc&&(f=Error(d(422),{cause:L}),Wu(Cs(f,C)))):(L!==hc&&(x=Error(d(423),{cause:L}),Wu(Cs(x,C))),f=f.current.alternate,f.flags|=65536,q&=-q,f.lanes|=q,L=Cs(L,C),q=Go(f.stateNode,L,q),nh(f,q),bt!==4&&(bt=2)),!1;var te=Error(d(520),{cause:L});if(te=Cs(te,C),ai===null?ai=[te]:ai.push(te),bt!==4&&(bt=2),x===null)return!0;L=Cs(L,C),C=x;do{switch(C.tag){case 3:return C.flags|=65536,f=q&-q,C.lanes|=f,f=Go(C.stateNode,L,f),nh(C,f),!1;case 1:if(x=C.type,te=C.stateNode,(C.flags&128)===0&&(typeof x.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(Ai===null||!Ai.has(te))))return C.flags|=65536,q&=-q,C.lanes|=q,q=xl(q),ds(q,f,C,L),nh(C,q),!1}C=C.return}while(C!==null);return!1}var wd=Error(d(461)),is=!1;function Rs(f,x,C,L){x.child=f===null?vp(x,null,C,L):fl(x,f.child,C,L)}function to(f,x,C,L,q){C=C.render;var te=x.ref;if("ref"in L){var we={};for(var $e in L)$e!=="ref"&&(we[$e]=L[$e])}else we=L;return Nl(x),L=lu(f,x,C,we,te,q),$e=hf(),f!==null&&!is?(df(f,x,q),qo(f,x,q)):(Gr&&$e&&Zh(x),x.flags|=1,Rs(f,x,L,q),x.child)}function $o(f,x,C,L,q){if(f===null){var te=C.type;return typeof te=="function"&&!Ol(te)&&te.defaultProps===void 0&&C.compare===null?(x.tag=15,x.type=te,du(f,x,te,L,q)):(f=Xc(C.type,null,L,x,x.mode,q),f.ref=x.ref,f.return=x,x.child=f)}if(te=f.child,!yu(f,q)){var we=te.memoizedProps;if(C=C.compare,C=C!==null?C:La,C(we,L)&&f.ref===x.ref)return qo(f,x,q)}return x.flags|=1,f=Ea(te,L),f.ref=x.ref,f.return=x,x.child=f}function du(f,x,C,L,q){if(f!==null){var te=f.memoizedProps;if(La(te,L)&&f.ref===x.ref)if(is=!1,x.pendingProps=L=te,yu(f,q))(f.flags&131072)!==0&&(is=!0);else return x.lanes=f.lanes,qo(f,x,q)}return hh(f,x,C,L,q)}function fu(f,x,C,L){var q=L.children,te=f!==null?f.memoizedState:null;if(f===null&&x.stateNode===null&&(x.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),L.mode==="hidden"){if((x.flags&128)!==0){if(te=te!==null?te.baseLanes|C:C,f!==null){for(L=x.child=f.child,q=0;L!==null;)q=q|L.lanes|L.childLanes,L=L.sibling;L=q&~te}else L=0,x.child=null;return Af(f,x,te,C,L)}if((C&536870912)!==0)x.memoizedState={baseLanes:0,cachePool:null},f!==null&&eh(x,te!==null?te.cachePool:null),te!==null?ld(x,te):nu(),cd(x);else return L=x.lanes=536870912,Af(f,x,te!==null?te.baseLanes|C:C,C,L)}else te!==null?(eh(x,te.cachePool),ld(x,te),Js(),x.memoizedState=null):(f!==null&&eh(x,null),nu(),Js());return Rs(f,x,q,C),x.child}function pu(f,x){return f!==null&&f.tag===22||x.stateNode!==null||(x.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.sibling}function Af(f,x,C,L,q){var te=td();return te=te===null?null:{parent:en._currentValue,pool:te},x.memoizedState={baseLanes:C,cachePool:te},f!==null&&eh(x,null),nu(),cd(x),f!==null&&fc(f,x,L,!0),x.childLanes=q,null}function Ho(f,x){return x=ph({mode:x.mode,children:x.children},f.mode),x.ref=f.ref,f.child=x,x.return=f,x}function Cf(f,x,C){return fl(x,f.child,null,C),f=Ho(x,x.pendingProps),f.flags|=2,za(x),x.memoizedState=null,f}function io(f,x,C){var L=x.pendingProps,q=(x.flags&128)!==0;if(x.flags&=-129,f===null){if(Gr){if(L.mode==="hidden")return f=Ho(x,L),x.lanes=536870912,pu(null,f);if(su(x),(f=mn)?(f=i_(f,Ja),f=f!==null&&f.data==="&"?f:null,f!==null&&(x.memoizedState={dehydrated:f,treeContext:Mr!==null?{id:cl,overflow:Lo}:null,retryLane:536870912,hydrationErrors:null},C=Om(f),C.return=x,x.child=C,us=x,mn=null)):f=null,f===null)throw zo(x);return x.lanes=536870912,null}return Ho(x,L)}var te=f.memoizedState;if(te!==null){var we=te.dehydrated;if(su(x),q)if(x.flags&256)x.flags&=-257,x=Cf(f,x,C);else if(x.memoizedState!==null)x.child=f.child,x.flags|=128,x=null;else throw Error(d(558));else if(is||fc(f,x,C,!1),q=(C&f.childLanes)!==0,is||q){if(L=Qe,L!==null&&(we=Os(L,C),we!==0&&we!==te.retryLane))throw te.retryLane=we,$t(f,we),Oi(L,f,we),wd;Ms(),x=Cf(f,x,C)}else f=te.treeContext,mn=El(we.nextSibling),us=x,Gr=!0,ul=null,Ja=!1,f!==null&&Yc(x,f),x=Ho(x,L),x.flags|=4096;return x}return f=Ea(f.child,{mode:L.mode,children:L.children}),f.ref=x.ref,x.child=f,f.return=x,f}function Tc(f,x){var C=x.ref;if(C===null)f!==null&&f.ref!==null&&(x.flags|=4194816);else{if(typeof C!="function"&&typeof C!="object")throw Error(d(284));(f===null||f.ref!==C)&&(x.flags|=4194816)}}function hh(f,x,C,L,q){return Nl(x),C=lu(f,x,C,L,void 0,q),L=hf(),f!==null&&!is?(df(f,x,q),qo(f,x,q)):(Gr&&L&&Zh(x),x.flags|=1,Rs(f,x,C,q),x.child)}function Ed(f,x,C,L,q,te){return Nl(x),x.updateQueue=null,C=wp(x,L,C,q),No(f),L=hf(),f!==null&&!is?(df(f,x,te),qo(f,x,te)):(Gr&&L&&Zh(x),x.flags|=1,Rs(f,x,C,te),x.child)}function Sd(f,x,C,L,q){if(Nl(x),x.stateNode===null){var te=ol,we=C.contextType;typeof we=="object"&&we!==null&&(te=js(we)),te=new C(L,te),x.memoizedState=te.state!==null&&te.state!==void 0?te.state:null,te.updater=Tf,x.stateNode=te,te._reactInternals=x,te=x.stateNode,te.props=L,te.state=x.memoizedState,te.refs={},od(x),we=C.contextType,te.context=typeof we=="object"&&we!==null?js(we):ol,te.state=x.memoizedState,we=C.getDerivedStateFromProps,typeof we=="function"&&(Sf(x,C,we,L),te.state=x.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof te.getSnapshotBeforeUpdate=="function"||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(we=te.state,typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount(),we!==te.state&&Tf.enqueueReplaceState(te,te.state,null),ql(x,L,te,q),tu(),te.state=x.memoizedState),typeof te.componentDidMount=="function"&&(x.flags|=4194308),L=!0}else if(f===null){te=x.stateNode;var $e=x.memoizedProps,mt=ja(C,$e);te.props=mt;var Gt=te.context,ni=C.contextType;we=ol,typeof ni=="object"&&ni!==null&&(we=js(ni));var di=C.getDerivedStateFromProps;ni=typeof di=="function"||typeof te.getSnapshotBeforeUpdate=="function",$e=x.pendingProps!==$e,ni||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||($e||Gt!==we)&&Op(x,te,L,we),Sa=!1;var Ht=x.memoizedState;te.state=Ht,ql(x,L,te,q),tu(),Gt=x.memoizedState,$e||Ht!==Gt||Sa?(typeof di=="function"&&(Sf(x,C,di,L),Gt=x.memoizedState),(mt=Sa||ia(x,C,mt,L,Ht,Gt,we))?(ni||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount()),typeof te.componentDidMount=="function"&&(x.flags|=4194308)):(typeof te.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=L,x.memoizedState=Gt),te.props=L,te.state=Gt,te.context=we,L=mt):(typeof te.componentDidMount=="function"&&(x.flags|=4194308),L=!1)}else{te=x.stateNode,rh(f,x),we=x.memoizedProps,ni=ja(C,we),te.props=ni,di=x.pendingProps,Ht=te.context,Gt=C.contextType,mt=ol,typeof Gt=="object"&&Gt!==null&&(mt=js(Gt)),$e=C.getDerivedStateFromProps,(Gt=typeof $e=="function"||typeof te.getSnapshotBeforeUpdate=="function")||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(we!==di||Ht!==mt)&&Op(x,te,L,mt),Sa=!1,Ht=x.memoizedState,te.state=Ht,ql(x,L,te,q),tu();var Jt=x.memoizedState;we!==di||Ht!==Jt||Sa||f!==null&&f.dependencies!==null&&Zu(f.dependencies)?(typeof $e=="function"&&(Sf(x,C,$e,L),Jt=x.memoizedState),(ni=Sa||ia(x,C,ni,L,Ht,Jt,mt)||f!==null&&f.dependencies!==null&&Zu(f.dependencies))?(Gt||typeof te.UNSAFE_componentWillUpdate!="function"&&typeof te.componentWillUpdate!="function"||(typeof te.componentWillUpdate=="function"&&te.componentWillUpdate(L,Jt,mt),typeof te.UNSAFE_componentWillUpdate=="function"&&te.UNSAFE_componentWillUpdate(L,Jt,mt)),typeof te.componentDidUpdate=="function"&&(x.flags|=4),typeof te.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof te.componentDidUpdate!="function"||we===f.memoizedProps&&Ht===f.memoizedState||(x.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||we===f.memoizedProps&&Ht===f.memoizedState||(x.flags|=1024),x.memoizedProps=L,x.memoizedState=Jt),te.props=L,te.state=Jt,te.context=mt,L=ni):(typeof te.componentDidUpdate!="function"||we===f.memoizedProps&&Ht===f.memoizedState||(x.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||we===f.memoizedProps&&Ht===f.memoizedState||(x.flags|=1024),L=!1)}return te=L,Tc(f,x),L=(x.flags&128)!==0,te||L?(te=x.stateNode,C=L&&typeof C.getDerivedStateFromError!="function"?null:te.render(),x.flags|=1,f!==null&&L?(x.child=fl(x,f.child,null,q),x.child=fl(x,null,C,q)):Rs(f,x,C,q),x.memoizedState=te.state,f=x.child):f=qo(f,x,q),f}function qn(f,x,C,L){return Fo(),x.flags|=256,Rs(f,x,C,L),x.child}var mu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ac(f){return{baseLanes:f,cachePool:Qc()}}function dh(f,x,C){return f=f!==null?f.childLanes&~C:0,x&&(f|=zt),f}function Cc(f,x,C){var L=x.pendingProps,q=!1,te=(x.flags&128)!==0,we;if((we=te)||(we=f!==null&&f.memoizedState===null?!1:(hs.current&2)!==0),we&&(q=!0,x.flags&=-129),we=(x.flags&32)!==0,x.flags&=-33,f===null){if(Gr){if(q?jo(x):Js(),(f=mn)?(f=i_(f,Ja),f=f!==null&&f.data!=="&"?f:null,f!==null&&(x.memoizedState={dehydrated:f,treeContext:Mr!==null?{id:cl,overflow:Lo}:null,retryLane:536870912,hydrationErrors:null},C=Om(f),C.return=x,x.child=C,us=x,mn=null)):f=null,f===null)throw zo(x);return Zg(f)?x.lanes=32:x.lanes=536870912,null}var $e=L.children;return L=L.fallback,q?(Js(),q=x.mode,$e=ph({mode:"hidden",children:$e},q),L=uc(L,q,C,null),$e.return=x,L.return=x,$e.sibling=L,x.child=$e,L=x.child,L.memoizedState=Ac(C),L.childLanes=dh(f,we,C),x.memoizedState=mu,pu(null,L)):(jo(x),fh(x,$e))}var mt=f.memoizedState;if(mt!==null&&($e=mt.dehydrated,$e!==null)){if(te)x.flags&256?(jo(x),x.flags&=-257,x=gu(f,x,C)):x.memoizedState!==null?(Js(),x.child=f.child,x.flags|=128,x=null):(Js(),$e=L.fallback,q=x.mode,L=ph({mode:"visible",children:L.children},q),$e=uc($e,q,C,null),$e.flags|=2,L.return=x,$e.return=x,L.sibling=$e,x.child=L,fl(x,f.child,null,C),L=x.child,L.memoizedState=Ac(C),L.childLanes=dh(f,we,C),x.memoizedState=mu,x=pu(null,L));else if(jo(x),Zg($e)){if(we=$e.nextSibling&&$e.nextSibling.dataset,we)var Gt=we.dgst;we=Gt,L=Error(d(419)),L.stack="",L.digest=we,Wu({value:L,source:null,stack:null}),x=gu(f,x,C)}else if(is||fc(f,x,C,!1),we=(C&f.childLanes)!==0,is||we){if(we=Qe,we!==null&&(L=Os(we,C),L!==0&&L!==mt.retryLane))throw mt.retryLane=L,$t(f,L),Oi(we,f,L),wd;Wg($e)||Ms(),x=gu(f,x,C)}else Wg($e)?(x.flags|=192,x.child=f.child,x=null):(f=mt.treeContext,mn=El($e.nextSibling),us=x,Gr=!0,ul=null,Ja=!1,f!==null&&Yc(x,f),x=fh(x,L.children),x.flags|=4096);return x}return q?(Js(),$e=L.fallback,q=x.mode,mt=f.child,Gt=mt.sibling,L=Ea(mt,{mode:"hidden",children:L.children}),L.subtreeFlags=mt.subtreeFlags&65011712,Gt!==null?$e=Ea(Gt,$e):($e=uc($e,q,C,null),$e.flags|=2),$e.return=x,L.return=x,L.sibling=$e,x.child=L,pu(null,L),L=x.child,$e=f.child.memoizedState,$e===null?$e=Ac(C):(q=$e.cachePool,q!==null?(mt=en._currentValue,q=q.parent!==mt?{parent:mt,pool:mt}:q):q=Qc(),$e={baseLanes:$e.baseLanes|C,cachePool:q}),L.memoizedState=$e,L.childLanes=dh(f,we,C),x.memoizedState=mu,pu(f.child,L)):(jo(x),C=f.child,f=C.sibling,C=Ea(C,{mode:"visible",children:L.children}),C.return=x,C.sibling=null,f!==null&&(we=x.deletions,we===null?(x.deletions=[f],x.flags|=16):we.push(f)),x.child=C,x.memoizedState=null,C)}function fh(f,x){return x=ph({mode:"visible",children:x},f.mode),x.return=f,f.child=x}function ph(f,x){return f=wa(22,f,null,x),f.lanes=0,f}function gu(f,x,C){return fl(x,f.child,null,C),f=fh(x,x.pendingProps.children),f.flags|=2,x.memoizedState=null,f}function Rc(f,x,C){f.lanes|=x;var L=f.alternate;L!==null&&(L.lanes|=x),yp(f.return,x,C)}function Td(f,x,C,L,q,te){var we=f.memoizedState;we===null?f.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:L,tail:C,tailMode:q,treeForkCount:te}:(we.isBackwards=x,we.rendering=null,we.renderingStartTime=0,we.last=L,we.tail=C,we.tailMode=q,we.treeForkCount=te)}function mh(f,x,C){var L=x.pendingProps,q=L.revealOrder,te=L.tail;L=L.children;var we=hs.current,$e=(we&2)!==0;if($e?(we=we&1|2,x.flags|=128):we&=1,ct(hs,we),Rs(f,x,L,C),L=Gr?qh:0,!$e&&f!==null&&(f.flags&128)!==0)e:for(f=x.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Rc(f,C,x);else if(f.tag===19)Rc(f,C,x);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===x)break e;for(;f.sibling===null;){if(f.return===null||f.return===x)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}switch(q){case"forwards":for(C=x.child,q=null;C!==null;)f=C.alternate,f!==null&&gl(f)===null&&(q=C),C=C.sibling;C=q,C===null?(q=x.child,x.child=null):(q=C.sibling,C.sibling=null),Td(x,!1,q,C,te,L);break;case"backwards":case"unstable_legacy-backwards":for(C=null,q=x.child,x.child=null;q!==null;){if(f=q.alternate,f!==null&&gl(f)===null){x.child=q;break}f=q.sibling,q.sibling=C,C=q,q=f}Td(x,!0,C,null,te,L);break;case"together":Td(x,!1,null,null,void 0,L);break;default:x.memoizedState=null}return x.child}function qo(f,x,C){if(f!==null&&(x.dependencies=f.dependencies),Lt|=x.lanes,(C&x.childLanes)===0)if(f!==null){if(fc(f,x,C,!1),(C&x.childLanes)===0)return null}else return null;if(f!==null&&x.child!==f.child)throw Error(d(153));if(x.child!==null){for(f=x.child,C=Ea(f,f.pendingProps),x.child=C,C.return=x;f.sibling!==null;)f=f.sibling,C=C.sibling=Ea(f,f.pendingProps),C.return=x;C.sibling=null}return x.child}function yu(f,x){return(f.lanes&x)!==0?!0:(f=f.dependencies,!!(f!==null&&Zu(f)))}function zp(f,x,C){switch(x.tag){case 3:zi(x,x.stateNode.containerInfo),dc(x,en,f.memoizedState.cache),Fo();break;case 27:case 5:Gi(x);break;case 4:zi(x,x.stateNode.containerInfo);break;case 10:dc(x,x.type,x.memoizedProps.value);break;case 31:if(x.memoizedState!==null)return x.flags|=128,su(x),null;break;case 13:var L=x.memoizedState;if(L!==null)return L.dehydrated!==null?(jo(x),x.flags|=128,null):(C&x.child.childLanes)!==0?Cc(f,x,C):(jo(x),f=qo(f,x,C),f!==null?f.sibling:null);jo(x);break;case 19:var q=(f.flags&128)!==0;if(L=(C&x.childLanes)!==0,L||(fc(f,x,C,!1),L=(C&x.childLanes)!==0),q){if(L)return mh(f,x,C);x.flags|=128}if(q=x.memoizedState,q!==null&&(q.rendering=null,q.tail=null,q.lastEffect=null),ct(hs,hs.current),L)break;return null;case 22:return x.lanes=0,fu(f,x,C,x.pendingProps);case 24:dc(x,en,f.memoizedState.cache)}return qo(f,x,C)}function Ad(f,x,C){if(f!==null)if(f.memoizedProps!==x.pendingProps)is=!0;else{if(!yu(f,C)&&(x.flags&128)===0)return is=!1,zp(f,x,C);is=(f.flags&131072)!==0}else is=!1,Gr&&(x.flags&1048576)!==0&&Wh(x,qh,x.index);switch(x.lanes=0,x.tag){case 16:e:{var L=x.pendingProps;if(f=dl(x.elementType),x.type=f,typeof f=="function")Ol(f)?(L=ja(f,L),x.tag=1,x=Sd(null,x,f,L,C)):(x.tag=0,x=hh(null,x,f,L,C));else{if(f!=null){var q=f.$$typeof;if(q===oe){x.tag=11,x=to(null,x,f,L,C);break e}else if(q===ke){x.tag=14,x=$o(null,x,f,L,C);break e}}throw x=si(f)||f,Error(d(306,x,""))}}return x;case 0:return hh(f,x,x.type,x.pendingProps,C);case 1:return L=x.type,q=ja(L,x.pendingProps),Sd(f,x,L,q,C);case 3:e:{if(zi(x,x.stateNode.containerInfo),f===null)throw Error(d(387));L=x.pendingProps;var te=x.memoizedState;q=te.element,rh(f,x),ql(x,L,null,C);var we=x.memoizedState;if(L=we.cache,dc(x,en,L),L!==te.cache&&Yh(x,[en],C,!0),tu(),L=we.element,te.isDehydrated)if(te={element:L,isDehydrated:!1,cache:we.cache},x.updateQueue.baseState=te,x.memoizedState=te,x.flags&256){x=qn(f,x,L,C);break e}else if(L!==q){q=Cs(Error(d(424)),x),Wu(q),x=qn(f,x,L,C);break e}else{switch(f=x.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(mn=El(f.firstChild),us=x,Gr=!0,ul=null,Ja=!0,C=vp(x,null,L,C),x.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling}else{if(Fo(),L===q){x=qo(f,x,C);break e}Rs(f,x,L,C)}x=x.child}return x;case 26:return Tc(f,x),f===null?(C=Dc(x.type,null,x.pendingProps,null))?x.memoizedState=C:Gr||(C=x.type,f=x.pendingProps,L=Kp(mi.current).createElement(C),L[qe]=x,L[Oe]=f,Ma(L,C,f),xi(L),x.stateNode=L):x.memoizedState=Dc(x.type,f.memoizedProps,x.pendingProps,f.memoizedState),null;case 27:return Gi(x),f===null&&Gr&&(L=x.stateNode=Of(x.type,x.pendingProps,mi.current),us=x,Ja=!0,q=mn,Yo(x.type)?(Qp=q,mn=El(L.firstChild)):mn=q),Rs(f,x,x.pendingProps.children,C),Tc(f,x),f===null&&(x.flags|=4194304),x.child;case 5:return f===null&&Gr&&((q=L=mn)&&(L=h0(L,x.type,x.pendingProps,Ja),L!==null?(x.stateNode=L,us=x,mn=El(L.firstChild),Ja=!1,q=!0):q=!1),q||zo(x)),Gi(x),q=x.type,te=x.pendingProps,we=f!==null?f.memoizedProps:null,L=te.children,Ic(q,te)?L=null:we!==null&&Ic(q,we)&&(x.flags|=32),x.memoizedState!==null&&(q=lu(f,x,jm,null,null,C),Tl._currentValue=q),Tc(f,x),Rs(f,x,L,C),x.child;case 6:return f===null&&Gr&&((f=C=mn)&&(C=d0(C,x.pendingProps,Ja),C!==null?(x.stateNode=C,us=x,mn=null,f=!0):f=!1),f||zo(x)),null;case 13:return Cc(f,x,C);case 4:return zi(x,x.stateNode.containerInfo),L=x.pendingProps,f===null?x.child=fl(x,null,L,C):Rs(f,x,L,C),x.child;case 11:return to(f,x,x.type,x.pendingProps,C);case 7:return Rs(f,x,x.pendingProps,C),x.child;case 8:return Rs(f,x,x.pendingProps.children,C),x.child;case 12:return Rs(f,x,x.pendingProps.children,C),x.child;case 10:return L=x.pendingProps,dc(x,x.type,L.value),Rs(f,x,L.children,C),x.child;case 9:return q=x.type._context,L=x.pendingProps.children,Nl(x),q=js(q),L=L(q),x.flags|=1,Rs(f,x,L,C),x.child;case 14:return $o(f,x,x.type,x.pendingProps,C);case 15:return du(f,x,x.type,x.pendingProps,C);case 19:return mh(f,x,C);case 31:return io(f,x,C);case 22:return fu(f,x,C,x.pendingProps);case 24:return Nl(x),L=js(en),f===null?(q=td(),q===null&&(q=Qe,te=Yu(),q.pooledCache=te,te.refCount++,te!==null&&(q.pooledCacheLanes|=C),q=te),x.memoizedState={parent:L,cache:q},od(x),dc(x,en,q)):((f.lanes&C)!==0&&(rh(f,x),ql(x,null,null,C),tu()),q=f.memoizedState,te=x.memoizedState,q.parent!==L?(q={parent:L,cache:L},x.memoizedState=q,x.lanes===0&&(x.memoizedState=x.updateQueue.baseState=q),dc(x,en,L)):(L=te.cache,dc(x,en,L),L!==q.cache&&Yh(x,[en],C,!0))),Rs(f,x,x.pendingProps.children,C),x.child;case 29:throw x.pendingProps}throw Error(d(156,x.tag))}function vl(f){f.flags|=4}function Rf(f,x,C,L,q){if((x=(f.mode&32)!==0)&&(x=!1),x){if(f.flags|=16777216,(q&335544128)===q)if(f.stateNode.complete)f.flags|=8192;else if(mr())f.flags|=8192;else throw $l=nd,_p}else f.flags&=-16777217}function Fp(f,x){if(x.type!=="stylesheet"||(x.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!ny(x))if(mr())f.flags|=8192;else throw $l=nd,_p}function Cd(f,x){x!==null&&(f.flags|=4),f.flags&16384&&(x=f.tag!==22?Tn():536870912,f.lanes|=x,hi|=x)}function gh(f,x){if(!Gr)switch(f.tailMode){case"hidden":x=f.tail;for(var C=null;x!==null;)x.alternate!==null&&(C=x),x=x.sibling;C===null?f.tail=null:C.sibling=null;break;case"collapsed":C=f.tail;for(var L=null;C!==null;)C.alternate!==null&&(L=C),C=C.sibling;L===null?x||f.tail===null?f.tail=null:f.tail.sibling=null:L.sibling=null}}function Nn(f){var x=f.alternate!==null&&f.alternate.child===f.child,C=0,L=0;if(x)for(var q=f.child;q!==null;)C|=q.lanes|q.childLanes,L|=q.subtreeFlags&65011712,L|=q.flags&65011712,q.return=f,q=q.sibling;else for(q=f.child;q!==null;)C|=q.lanes|q.childLanes,L|=q.subtreeFlags,L|=q.flags,q.return=f,q=q.sibling;return f.subtreeFlags|=L,f.childLanes=C,x}function Rd(f,x,C){var L=x.pendingProps;switch(Fl(x),x.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(x),null;case 1:return Nn(x),null;case 3:return C=x.stateNode,L=null,f!==null&&(L=f.memoizedState.cache),x.memoizedState.cache!==L&&(x.flags|=2048),jl(en),vi(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(f===null||f.child===null)&&(Bl(x)?vl(x):f===null||f.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,of())),Nn(x),null;case 26:var q=x.type,te=x.memoizedState;return f===null?(vl(x),te!==null?(Nn(x),Fp(x,te)):(Nn(x),Rf(x,q,null,L,C))):te?te!==f.memoizedState?(vl(x),Nn(x),Fp(x,te)):(Nn(x),x.flags&=-16777217):(f=f.memoizedProps,f!==L&&vl(x),Nn(x),Rf(x,q,f,L,C)),null;case 27:if(lr(x),C=mi.current,q=x.type,f!==null&&x.stateNode!=null)f.memoizedProps!==L&&vl(x);else{if(!L){if(x.stateNode===null)throw Error(d(166));return Nn(x),null}f=Ct.current,Bl(x)?Xh(x):(f=Of(q,L,C),x.stateNode=f,vl(x))}return Nn(x),null;case 5:if(lr(x),q=x.type,f!==null&&x.stateNode!=null)f.memoizedProps!==L&&vl(x);else{if(!L){if(x.stateNode===null)throw Error(d(166));return Nn(x),null}if(te=Ct.current,Bl(x))Xh(x);else{var we=Kp(mi.current);switch(te){case 1:te=we.createElementNS("http://www.w3.org/2000/svg",q);break;case 2:te=we.createElementNS("http://www.w3.org/1998/Math/MathML",q);break;default:switch(q){case"svg":te=we.createElementNS("http://www.w3.org/2000/svg",q);break;case"math":te=we.createElementNS("http://www.w3.org/1998/Math/MathML",q);break;case"script":te=we.createElement("div"),te.innerHTML="<script><\/script>",te=te.removeChild(te.firstChild);break;case"select":te=typeof L.is=="string"?we.createElement("select",{is:L.is}):we.createElement("select"),L.multiple?te.multiple=!0:L.size&&(te.size=L.size);break;default:te=typeof L.is=="string"?we.createElement(q,{is:L.is}):we.createElement(q)}}te[qe]=x,te[Oe]=L;e:for(we=x.child;we!==null;){if(we.tag===5||we.tag===6)te.appendChild(we.stateNode);else if(we.tag!==4&&we.tag!==27&&we.child!==null){we.child.return=we,we=we.child;continue}if(we===x)break e;for(;we.sibling===null;){if(we.return===null||we.return===x)break e;we=we.return}we.sibling.return=we.return,we=we.sibling}x.stateNode=te;e:switch(Ma(te,q,L),q){case"button":case"input":case"select":case"textarea":L=!!L.autoFocus;break e;case"img":L=!0;break e;default:L=!1}L&&vl(x)}}return Nn(x),Rf(x,x.type,f===null?null:f.memoizedProps,x.pendingProps,C),null;case 6:if(f&&x.stateNode!=null)f.memoizedProps!==L&&vl(x);else{if(typeof L!="string"&&x.stateNode===null)throw Error(d(166));if(f=mi.current,Bl(x)){if(f=x.stateNode,C=x.memoizedProps,L=null,q=us,q!==null)switch(q.tag){case 27:case 5:L=q.memoizedProps}f[qe]=x,f=!!(f.nodeValue===C||L!==null&&L.suppressHydrationWarning===!0||Ky(f.nodeValue,C)),f||zo(x,!0)}else f=Kp(f).createTextNode(L),f[qe]=x,x.stateNode=f}return Nn(x),null;case 31:if(C=x.memoizedState,f===null||f.memoizedState!==null){if(L=Bl(x),C!==null){if(f===null){if(!L)throw Error(d(318));if(f=x.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(d(557));f[qe]=x}else Fo(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;Nn(x),f=!1}else C=of(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=C),f=!0;if(!f)return x.flags&256?(za(x),x):(za(x),null);if((x.flags&128)!==0)throw Error(d(558))}return Nn(x),null;case 13:if(L=x.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(q=Bl(x),L!==null&&L.dehydrated!==null){if(f===null){if(!q)throw Error(d(318));if(q=x.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(d(317));q[qe]=x}else Fo(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;Nn(x),q=!1}else q=of(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=q),q=!0;if(!q)return x.flags&256?(za(x),x):(za(x),null)}return za(x),(x.flags&128)!==0?(x.lanes=C,x):(C=L!==null,f=f!==null&&f.memoizedState!==null,C&&(L=x.child,q=null,L.alternate!==null&&L.alternate.memoizedState!==null&&L.alternate.memoizedState.cachePool!==null&&(q=L.alternate.memoizedState.cachePool.pool),te=null,L.memoizedState!==null&&L.memoizedState.cachePool!==null&&(te=L.memoizedState.cachePool.pool),te!==q&&(L.flags|=2048)),C!==f&&C&&(x.child.flags|=8192),Cd(x,x.updateQueue),Nn(x),null);case 4:return vi(),f===null&&Zm(x.stateNode.containerInfo),Nn(x),null;case 10:return jl(x.type),Nn(x),null;case 19:if(at(hs),L=x.memoizedState,L===null)return Nn(x),null;if(q=(x.flags&128)!==0,te=L.rendering,te===null)if(q)gh(L,!1);else{if(bt!==0||f!==null&&(f.flags&128)!==0)for(f=x.child;f!==null;){if(te=gl(f),te!==null){for(x.flags|=128,gh(L,!1),f=te.updateQueue,x.updateQueue=f,Cd(x,f),x.subtreeFlags=0,f=C,C=x.child;C!==null;)zl(C,f),C=C.sibling;return ct(hs,hs.current&1|2),Gr&&Oo(x,L.treeForkCount),x.child}f=f.sibling}L.tail!==null&&Dr()>Fi&&(x.flags|=128,q=!0,gh(L,!1),x.lanes=4194304)}else{if(!q)if(f=gl(te),f!==null){if(x.flags|=128,q=!0,f=f.updateQueue,x.updateQueue=f,Cd(x,f),gh(L,!0),L.tail===null&&L.tailMode==="hidden"&&!te.alternate&&!Gr)return Nn(x),null}else 2*Dr()-L.renderingStartTime>Fi&&C!==536870912&&(x.flags|=128,q=!0,gh(L,!1),x.lanes=4194304);L.isBackwards?(te.sibling=x.child,x.child=te):(f=L.last,f!==null?f.sibling=te:x.child=te,L.last=te)}return L.tail!==null?(f=L.tail,L.rendering=f,L.tail=f.sibling,L.renderingStartTime=Dr(),f.sibling=null,C=hs.current,ct(hs,q?C&1|2:C&1),Gr&&Oo(x,L.treeForkCount),f):(Nn(x),null);case 22:case 23:return za(x),ml(),L=x.memoizedState!==null,f!==null?f.memoizedState!==null!==L&&(x.flags|=8192):L&&(x.flags|=8192),L?(C&536870912)!==0&&(x.flags&128)===0&&(Nn(x),x.subtreeFlags&6&&(x.flags|=8192)):Nn(x),C=x.updateQueue,C!==null&&Cd(x,C.retryQueue),C=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),L=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(L=x.memoizedState.cachePool.pool),L!==C&&(x.flags|=2048),f!==null&&at(Gl),null;case 24:return C=null,f!==null&&(C=f.memoizedState.cache),x.memoizedState.cache!==C&&(x.flags|=2048),jl(en),Nn(x),null;case 25:return null;case 30:return null}throw Error(d(156,x.tag))}function Hm(f,x){switch(Fl(x),x.tag){case 1:return f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 3:return jl(en),vi(),f=x.flags,(f&65536)!==0&&(f&128)===0?(x.flags=f&-65537|128,x):null;case 26:case 27:case 5:return lr(x),null;case 31:if(x.memoizedState!==null){if(za(x),x.alternate===null)throw Error(d(340));Fo()}return f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 13:if(za(x),f=x.memoizedState,f!==null&&f.dehydrated!==null){if(x.alternate===null)throw Error(d(340));Fo()}return f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 19:return at(hs),null;case 4:return vi(),null;case 10:return jl(x.type),null;case 22:case 23:return za(x),ml(),f!==null&&at(Gl),f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 24:return jl(en),null;case 25:return null;default:return null}}function Bp(f,x){switch(Fl(x),x.tag){case 3:jl(en),vi();break;case 26:case 27:case 5:lr(x);break;case 4:vi();break;case 31:x.memoizedState!==null&&za(x);break;case 13:za(x);break;case 19:at(hs);break;case 10:jl(x.type);break;case 22:case 23:za(x),ml(),f!==null&&at(Gl);break;case 24:jl(en)}}function Yl(f,x){try{var C=x.updateQueue,L=C!==null?C.lastEffect:null;if(L!==null){var q=L.next;C=q;do{if((C.tag&f)===f){L=void 0;var te=C.create,we=C.inst;L=te(),we.destroy=L}C=C.next}while(C!==q)}}catch($e){Vr(x,x.return,$e)}}function Kl(f,x,C){try{var L=x.updateQueue,q=L!==null?L.lastEffect:null;if(q!==null){var te=q.next;L=te;do{if((L.tag&f)===f){var we=L.inst,$e=we.destroy;if($e!==void 0){we.destroy=void 0,q=x;var mt=C,Gt=$e;try{Gt()}catch(ni){Vr(q,mt,ni)}}}L=L.next}while(L!==te)}}catch(ni){Vr(x,x.return,ni)}}function Mf(f){var x=f.updateQueue;if(x!==null){var C=f.stateNode;try{Bm(x,C)}catch(L){Vr(f,f.return,L)}}}function jp(f,x,C){C.props=ja(f.type,f.memoizedProps),C.state=f.memoizedState;try{C.componentWillUnmount()}catch(L){Vr(f,x,L)}}function yh(f,x){try{var C=f.ref;if(C!==null){switch(f.tag){case 26:case 27:case 5:var L=f.stateNode;break;case 30:L=f.stateNode;break;default:L=f.stateNode}typeof C=="function"?f.refCleanup=C(L):C.current=L}}catch(q){Vr(f,x,q)}}function Wo(f,x){var C=f.ref,L=f.refCleanup;if(C!==null)if(typeof L=="function")try{L()}catch(q){Vr(f,x,q)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(q){Vr(f,x,q)}else C.current=null}function Np(f){var x=f.type,C=f.memoizedProps,L=f.stateNode;try{e:switch(x){case"button":case"input":case"select":case"textarea":C.autoFocus&&L.focus();break e;case"img":C.src?L.src=C.src:C.srcSet&&(L.srcset=C.srcSet)}}catch(q){Vr(f,f.return,q)}}function $r(f,x,C){try{var L=f.stateNode;Qy(L,f.type,C,x),L[Oe]=x}catch(q){Vr(f,f.return,q)}}function Vp(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&Yo(f.type)||f.tag===4}function Pf(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Vp(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&Yo(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Up(f,x,C){var L=f.tag;if(L===5||L===6)f=f.stateNode,x?(C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C).insertBefore(f,x):(x=C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C,x.appendChild(f),C=C._reactRootContainer,C!=null||x.onclick!==null||(x.onclick=cs));else if(L!==4&&(L===27&&Yo(f.type)&&(C=f.stateNode,x=null),f=f.child,f!==null))for(Up(f,x,C),f=f.sibling;f!==null;)Up(f,x,C),f=f.sibling}function If(f,x,C){var L=f.tag;if(L===5||L===6)f=f.stateNode,x?C.insertBefore(f,x):C.appendChild(f);else if(L!==4&&(L===27&&Yo(f.type)&&(C=f.stateNode),f=f.child,f!==null))for(If(f,x,C),f=f.sibling;f!==null;)If(f,x,C),f=f.sibling}function _h(f){var x=f.stateNode,C=f.memoizedProps;try{for(var L=f.type,q=x.attributes;q.length;)x.removeAttributeNode(q[0]);Ma(x,L,C),x[qe]=f,x[Oe]=C}catch(te){Vr(f,f.return,te)}}var bl=!1,rs=!1,_u=!1,bo=typeof WeakSet=="function"?WeakSet:Set,_n=null;function Vn(f,x){if(f=f.containerInfo,Ym=am,f=Im(f),Hc(f)){if("selectionStart"in f)var C={start:f.selectionStart,end:f.selectionEnd};else e:{C=(C=f.ownerDocument)&&C.defaultView||window;var L=C.getSelection&&C.getSelection();if(L&&L.rangeCount!==0){C=L.anchorNode;var q=L.anchorOffset,te=L.focusNode;L=L.focusOffset;try{C.nodeType,te.nodeType}catch{C=null;break e}var we=0,$e=-1,mt=-1,Gt=0,ni=0,di=f,Ht=null;t:for(;;){for(var Jt;di!==C||q!==0&&di.nodeType!==3||($e=we+q),di!==te||L!==0&&di.nodeType!==3||(mt=we+L),di.nodeType===3&&(we+=di.nodeValue.length),(Jt=di.firstChild)!==null;)Ht=di,di=Jt;for(;;){if(di===f)break t;if(Ht===C&&++Gt===q&&($e=we),Ht===te&&++ni===L&&(mt=we),(Jt=di.nextSibling)!==null)break;di=Ht,Ht=di.parentNode}di=Jt}C=$e===-1||mt===-1?null:{start:$e,end:mt}}else C=null}C=C||{start:0,end:0}}else C=null;for(Km={focusedElem:f,selectionRange:C},am=!1,_n=x;_n!==null;)if(x=_n,f=x.child,(x.subtreeFlags&1028)!==0&&f!==null)f.return=x,_n=f;else for(;_n!==null;){switch(x=_n,te=x.alternate,f=x.flags,x.tag){case 0:if((f&4)!==0&&(f=x.updateQueue,f=f!==null?f.events:null,f!==null))for(C=0;C<f.length;C++)q=f[C],q.ref.impl=q.nextImpl;break;case 11:case 15:break;case 1:if((f&1024)!==0&&te!==null){f=void 0,C=x,q=te.memoizedProps,te=te.memoizedState,L=C.stateNode;try{var Hi=ja(C.type,q);f=L.getSnapshotBeforeUpdate(Hi,te),L.__reactInternalSnapshotBeforeUpdate=f}catch(ir){Vr(C,C.return,ir)}}break;case 3:if((f&1024)!==0){if(f=x.stateNode.containerInfo,C=f.nodeType,C===9)Pd(f);else if(C===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":Pd(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(d(163))}if(f=x.sibling,f!==null){f.return=x.return,_n=f;break}_n=x.return}}function Na(f,x,C){var L=C.flags;switch(C.tag){case 0:case 11:case 15:z(f,C),L&4&&Yl(5,C);break;case 1:if(z(f,C),L&4)if(f=C.stateNode,x===null)try{f.componentDidMount()}catch(we){Vr(C,C.return,we)}else{var q=ja(C.type,x.memoizedProps);x=x.memoizedState;try{f.componentDidUpdate(q,x,f.__reactInternalSnapshotBeforeUpdate)}catch(we){Vr(C,C.return,we)}}L&64&&Mf(C),L&512&&yh(C,C.return);break;case 3:if(z(f,C),L&64&&(f=C.updateQueue,f!==null)){if(x=null,C.child!==null)switch(C.child.tag){case 27:case 5:x=C.child.stateNode;break;case 1:x=C.child.stateNode}try{Bm(f,x)}catch(we){Vr(C,C.return,we)}}break;case 27:x===null&&L&4&&_h(C);case 26:case 5:z(f,C),x===null&&L&4&&Np(C),L&512&&yh(C,C.return);break;case 12:z(f,C);break;case 31:z(f,C),L&4&&Fg(f,C);break;case 13:z(f,C),L&4&&m(f,C),L&64&&(f=C.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(C=Gy.bind(null,C),f0(f,C))));break;case 22:if(L=C.memoizedState!==null||bl,!L){x=x!==null&&x.memoizedState!==null||rs,q=bl;var te=rs;bl=L,(rs=x)&&!te?$(f,C,(C.subtreeFlags&8772)!==0):z(f,C),bl=q,rs=te}break;case 30:break;default:z(f,C)}}function xh(f){var x=f.alternate;x!==null&&(f.alternate=null,xh(x)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(x=f.stateNode,x!==null&&ii(x)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var kn=null,Ta=!1;function Ql(f,x,C){for(C=C.child;C!==null;)xu(f,x,C),C=C.sibling}function xu(f,x,C){if(Zn&&typeof Zn.onCommitFiberUnmount=="function")try{Zn.onCommitFiberUnmount(Co,C)}catch{}switch(C.tag){case 26:rs||Wo(C,x),Ql(f,x,C),C.memoizedState?C.memoizedState.count--:C.stateNode&&(C=C.stateNode,C.parentNode.removeChild(C));break;case 27:rs||Wo(C,x);var L=kn,q=Ta;Yo(C.type)&&(kn=C.stateNode,Ta=!1),Ql(f,x,C),Jp(C.stateNode),kn=L,Ta=q;break;case 5:rs||Wo(C,x);case 6:if(L=kn,q=Ta,kn=null,Ql(f,x,C),kn=L,Ta=q,kn!==null)if(Ta)try{(kn.nodeType===9?kn.body:kn.nodeName==="HTML"?kn.ownerDocument.body:kn).removeChild(C.stateNode)}catch(te){Vr(C,x,te)}else try{kn.removeChild(C.stateNode)}catch(te){Vr(C,x,te)}break;case 18:kn!==null&&(Ta?(f=kn,qg(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,C.stateNode),Vf(f)):qg(kn,C.stateNode));break;case 4:L=kn,q=Ta,kn=C.stateNode.containerInfo,Ta=!0,Ql(f,x,C),kn=L,Ta=q;break;case 0:case 11:case 14:case 15:Kl(2,C,x),rs||Kl(4,C,x),Ql(f,x,C);break;case 1:rs||(Wo(C,x),L=C.stateNode,typeof L.componentWillUnmount=="function"&&jp(C,x,L)),Ql(f,x,C);break;case 21:Ql(f,x,C);break;case 22:rs=(L=rs)||C.memoizedState!==null,Ql(f,x,C),rs=L;break;default:Ql(f,x,C)}}function Fg(f,x){if(x.memoizedState===null&&(f=x.alternate,f!==null&&(f=f.memoizedState,f!==null))){f=f.dehydrated;try{Vf(f)}catch(C){Vr(x,x.return,C)}}}function m(f,x){if(x.memoizedState===null&&(f=x.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{Vf(f)}catch(C){Vr(x,x.return,C)}}function i(f){switch(f.tag){case 31:case 13:case 19:var x=f.stateNode;return x===null&&(x=f.stateNode=new bo),x;case 22:return f=f.stateNode,x=f._retryCache,x===null&&(x=f._retryCache=new bo),x;default:throw Error(d(435,f.tag))}}function c(f,x){var C=i(f);x.forEach(function(L){if(!C.has(L)){C.add(L);var q=$y.bind(null,f,L);L.then(q,q)}})}function g(f,x){var C=x.deletions;if(C!==null)for(var L=0;L<C.length;L++){var q=C[L],te=f,we=x,$e=we;e:for(;$e!==null;){switch($e.tag){case 27:if(Yo($e.type)){kn=$e.stateNode,Ta=!1;break e}break;case 5:kn=$e.stateNode,Ta=!1;break e;case 3:case 4:kn=$e.stateNode.containerInfo,Ta=!0;break e}$e=$e.return}if(kn===null)throw Error(d(160));xu(te,we,q),kn=null,Ta=!1,te=q.alternate,te!==null&&(te.return=null),q.return=null}if(x.subtreeFlags&13886)for(x=x.child;x!==null;)A(x,f),x=x.sibling}var E=null;function A(f,x){var C=f.alternate,L=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:g(x,f),M(f),L&4&&(Kl(3,f,f.return),Yl(3,f),Kl(5,f,f.return));break;case 1:g(x,f),M(f),L&512&&(rs||C===null||Wo(C,C.return)),L&64&&bl&&(f=f.updateQueue,f!==null&&(L=f.callbacks,L!==null&&(C=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=C===null?L:C.concat(L))));break;case 26:var q=E;if(g(x,f),M(f),L&512&&(rs||C===null||Wo(C,C.return)),L&4){var te=C!==null?C.memoizedState:null;if(L=f.memoizedState,C===null)if(L===null)if(f.stateNode===null){e:{L=f.type,C=f.memoizedProps,q=q.ownerDocument||q;t:switch(L){case"title":te=q.getElementsByTagName("title")[0],(!te||te[It]||te[qe]||te.namespaceURI==="http://www.w3.org/2000/svg"||te.hasAttribute("itemprop"))&&(te=q.createElement(L),q.head.insertBefore(te,q.querySelector("head > title"))),Ma(te,L,C),te[qe]=f,xi(te),L=te;break e;case"link":var we=Ld("link","href",q).get(L+(C.href||""));if(we){for(var $e=0;$e<we.length;$e++)if(te=we[$e],te.getAttribute("href")===(C.href==null||C.href===""?null:C.href)&&te.getAttribute("rel")===(C.rel==null?null:C.rel)&&te.getAttribute("title")===(C.title==null?null:C.title)&&te.getAttribute("crossorigin")===(C.crossOrigin==null?null:C.crossOrigin)){we.splice($e,1);break t}}te=q.createElement(L),Ma(te,L,C),q.head.appendChild(te);break;case"meta":if(we=Ld("meta","content",q).get(L+(C.content||""))){for($e=0;$e<we.length;$e++)if(te=we[$e],te.getAttribute("content")===(C.content==null?null:""+C.content)&&te.getAttribute("name")===(C.name==null?null:C.name)&&te.getAttribute("property")===(C.property==null?null:C.property)&&te.getAttribute("http-equiv")===(C.httpEquiv==null?null:C.httpEquiv)&&te.getAttribute("charset")===(C.charSet==null?null:C.charSet)){we.splice($e,1);break t}}te=q.createElement(L),Ma(te,L,C),q.head.appendChild(te);break;default:throw Error(d(468,L))}te[qe]=f,xi(te),L=te}f.stateNode=L}else ry(q,f.type,f.stateNode);else f.stateNode=ty(q,L,f.memoizedProps);else te!==L?(te===null?C.stateNode!==null&&(C=C.stateNode,C.parentNode.removeChild(C)):te.count--,L===null?ry(q,f.type,f.stateNode):ty(q,L,f.memoizedProps)):L===null&&f.stateNode!==null&&$r(f,f.memoizedProps,C.memoizedProps)}break;case 27:g(x,f),M(f),L&512&&(rs||C===null||Wo(C,C.return)),C!==null&&L&4&&$r(f,f.memoizedProps,C.memoizedProps);break;case 5:if(g(x,f),M(f),L&512&&(rs||C===null||Wo(C,C.return)),f.flags&32){q=f.stateNode;try{rl(q,"")}catch(Hi){Vr(f,f.return,Hi)}}L&4&&f.stateNode!=null&&(q=f.memoizedProps,$r(f,q,C!==null?C.memoizedProps:q)),L&1024&&(_u=!0);break;case 6:if(g(x,f),M(f),L&4){if(f.stateNode===null)throw Error(d(162));L=f.memoizedProps,C=f.stateNode;try{C.nodeValue=L}catch(Hi){Vr(f,f.return,Hi)}}break;case 3:if(Rh=null,q=E,E=em(x.containerInfo),g(x,f),E=q,M(f),L&4&&C!==null&&C.memoizedState.isDehydrated)try{Vf(x.containerInfo)}catch(Hi){Vr(f,f.return,Hi)}_u&&(_u=!1,D(f));break;case 4:L=E,E=em(f.stateNode.containerInfo),g(x,f),M(f),E=L;break;case 12:g(x,f),M(f);break;case 31:g(x,f),M(f),L&4&&(L=f.updateQueue,L!==null&&(f.updateQueue=null,c(f,L)));break;case 13:g(x,f),M(f),f.child.flags&8192&&f.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(_i=Dr()),L&4&&(L=f.updateQueue,L!==null&&(f.updateQueue=null,c(f,L)));break;case 22:q=f.memoizedState!==null;var mt=C!==null&&C.memoizedState!==null,Gt=bl,ni=rs;if(bl=Gt||q,rs=ni||mt,g(x,f),rs=ni,bl=Gt,M(f),L&8192)e:for(x=f.stateNode,x._visibility=q?x._visibility&-2:x._visibility|1,q&&(C===null||mt||bl||rs||U(f)),C=null,x=f;;){if(x.tag===5||x.tag===26){if(C===null){mt=C=x;try{if(te=mt.stateNode,q)we=te.style,typeof we.setProperty=="function"?we.setProperty("display","none","important"):we.display="none";else{$e=mt.stateNode;var di=mt.memoizedProps.style,Ht=di!=null&&di.hasOwnProperty("display")?di.display:null;$e.style.display=Ht==null||typeof Ht=="boolean"?"":(""+Ht).trim()}}catch(Hi){Vr(mt,mt.return,Hi)}}}else if(x.tag===6){if(C===null){mt=x;try{mt.stateNode.nodeValue=q?"":mt.memoizedProps}catch(Hi){Vr(mt,mt.return,Hi)}}}else if(x.tag===18){if(C===null){mt=x;try{var Jt=mt.stateNode;q?Ah(Jt,!0):Ah(mt.stateNode,!1)}catch(Hi){Vr(mt,mt.return,Hi)}}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===f)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===f)break e;for(;x.sibling===null;){if(x.return===null||x.return===f)break e;C===x&&(C=null),x=x.return}C===x&&(C=null),x.sibling.return=x.return,x=x.sibling}L&4&&(L=f.updateQueue,L!==null&&(C=L.retryQueue,C!==null&&(L.retryQueue=null,c(f,C))));break;case 19:g(x,f),M(f),L&4&&(L=f.updateQueue,L!==null&&(f.updateQueue=null,c(f,L)));break;case 30:break;case 21:break;default:g(x,f),M(f)}}function M(f){var x=f.flags;if(x&2){try{for(var C,L=f.return;L!==null;){if(Vp(L)){C=L;break}L=L.return}if(C==null)throw Error(d(160));switch(C.tag){case 27:var q=C.stateNode,te=Pf(f);If(f,te,q);break;case 5:var we=C.stateNode;C.flags&32&&(rl(we,""),C.flags&=-33);var $e=Pf(f);If(f,$e,we);break;case 3:case 4:var mt=C.stateNode.containerInfo,Gt=Pf(f);Up(f,Gt,mt);break;default:throw Error(d(161))}}catch(ni){Vr(f,f.return,ni)}f.flags&=-3}x&4096&&(f.flags&=-4097)}function D(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var x=f;D(x),x.tag===5&&x.flags&1024&&x.stateNode.reset(),f=f.sibling}}function z(f,x){if(x.subtreeFlags&8772)for(x=x.child;x!==null;)Na(f,x.alternate,x),x=x.sibling}function U(f){for(f=f.child;f!==null;){var x=f;switch(x.tag){case 0:case 11:case 14:case 15:Kl(4,x,x.return),U(x);break;case 1:Wo(x,x.return);var C=x.stateNode;typeof C.componentWillUnmount=="function"&&jp(x,x.return,C),U(x);break;case 27:Jp(x.stateNode);case 26:case 5:Wo(x,x.return),U(x);break;case 22:x.memoizedState===null&&U(x);break;case 30:U(x);break;default:U(x)}f=f.sibling}}function $(f,x,C){for(C=C&&(x.subtreeFlags&8772)!==0,x=x.child;x!==null;){var L=x.alternate,q=f,te=x,we=te.flags;switch(te.tag){case 0:case 11:case 15:$(q,te,C),Yl(4,te);break;case 1:if($(q,te,C),L=te,q=L.stateNode,typeof q.componentDidMount=="function")try{q.componentDidMount()}catch(Gt){Vr(L,L.return,Gt)}if(L=te,q=L.updateQueue,q!==null){var $e=L.stateNode;try{var mt=q.shared.hiddenCallbacks;if(mt!==null)for(q.shared.hiddenCallbacks=null,q=0;q<mt.length;q++)iu(mt[q],$e)}catch(Gt){Vr(L,L.return,Gt)}}C&&we&64&&Mf(te),yh(te,te.return);break;case 27:_h(te);case 26:case 5:$(q,te,C),C&&L===null&&we&4&&Np(te),yh(te,te.return);break;case 12:$(q,te,C);break;case 31:$(q,te,C),C&&we&4&&Fg(q,te);break;case 13:$(q,te,C),C&&we&4&&m(q,te);break;case 22:te.memoizedState===null&&$(q,te,C),yh(te,te.return);break;case 30:break;default:$(q,te,C)}x=x.sibling}}function ie(f,x){var C=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),f=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(f=x.memoizedState.cachePool.pool),f!==C&&(f!=null&&f.refCount++,C!=null&&Vl(C))}function K(f,x){f=null,x.alternate!==null&&(f=x.alternate.memoizedState.cache),x=x.memoizedState.cache,x!==f&&(x.refCount++,f!=null&&Vl(f))}function re(f,x,C,L){if(x.subtreeFlags&10256)for(x=x.child;x!==null;)he(f,x,C,L),x=x.sibling}function he(f,x,C,L){var q=x.flags;switch(x.tag){case 0:case 11:case 15:re(f,x,C,L),q&2048&&Yl(9,x);break;case 1:re(f,x,C,L);break;case 3:re(f,x,C,L),q&2048&&(f=null,x.alternate!==null&&(f=x.alternate.memoizedState.cache),x=x.memoizedState.cache,x!==f&&(x.refCount++,f!=null&&Vl(f)));break;case 12:if(q&2048){re(f,x,C,L),f=x.stateNode;try{var te=x.memoizedProps,we=te.id,$e=te.onPostCommit;typeof $e=="function"&&$e(we,x.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(mt){Vr(x,x.return,mt)}}else re(f,x,C,L);break;case 31:re(f,x,C,L);break;case 13:re(f,x,C,L);break;case 23:break;case 22:te=x.stateNode,we=x.alternate,x.memoizedState!==null?te._visibility&2?re(f,x,C,L):de(f,x):te._visibility&2?re(f,x,C,L):(te._visibility|=2,ce(f,x,C,L,(x.subtreeFlags&10256)!==0||!1)),q&2048&&ie(we,x);break;case 24:re(f,x,C,L),q&2048&&K(x.alternate,x);break;default:re(f,x,C,L)}}function ce(f,x,C,L,q){for(q=q&&((x.subtreeFlags&10256)!==0||!1),x=x.child;x!==null;){var te=f,we=x,$e=C,mt=L,Gt=we.flags;switch(we.tag){case 0:case 11:case 15:ce(te,we,$e,mt,q),Yl(8,we);break;case 23:break;case 22:var ni=we.stateNode;we.memoizedState!==null?ni._visibility&2?ce(te,we,$e,mt,q):de(te,we):(ni._visibility|=2,ce(te,we,$e,mt,q)),q&&Gt&2048&&ie(we.alternate,we);break;case 24:ce(te,we,$e,mt,q),q&&Gt&2048&&K(we.alternate,we);break;default:ce(te,we,$e,mt,q)}x=x.sibling}}function de(f,x){if(x.subtreeFlags&10256)for(x=x.child;x!==null;){var C=f,L=x,q=L.flags;switch(L.tag){case 22:de(C,L),q&2048&&ie(L.alternate,L);break;case 24:de(C,L),q&2048&&K(L.alternate,L);break;default:de(C,L)}x=x.sibling}}var ge=8192;function Ce(f,x,C){if(f.subtreeFlags&ge)for(f=f.child;f!==null;)Ae(f,x,C),f=f.sibling}function Ae(f,x,C){switch(f.tag){case 26:Ce(f,x,C),f.flags&ge&&f.memoizedState!==null&&no(C,E,f.memoizedState,f.memoizedProps);break;case 5:Ce(f,x,C);break;case 3:case 4:var L=E;E=em(f.stateNode.containerInfo),Ce(f,x,C),E=L;break;case 22:f.memoizedState===null&&(L=f.alternate,L!==null&&L.memoizedState!==null?(L=ge,ge=16777216,Ce(f,x,C),ge=L):Ce(f,x,C));break;default:Ce(f,x,C)}}function Ee(f){var x=f.alternate;if(x!==null&&(f=x.child,f!==null)){x.child=null;do x=f.sibling,f.sibling=null,f=x;while(f!==null)}}function Ge(f){var x=f.deletions;if((f.flags&16)!==0){if(x!==null)for(var C=0;C<x.length;C++){var L=x[C];_n=L,ze(L,f)}Ee(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)je(f),f=f.sibling}function je(f){switch(f.tag){case 0:case 11:case 15:Ge(f),f.flags&2048&&Kl(9,f,f.return);break;case 3:Ge(f);break;case 12:Ge(f);break;case 22:var x=f.stateNode;f.memoizedState!==null&&x._visibility&2&&(f.return===null||f.return.tag!==13)?(x._visibility&=-3,Ue(f)):Ge(f);break;default:Ge(f)}}function Ue(f){var x=f.deletions;if((f.flags&16)!==0){if(x!==null)for(var C=0;C<x.length;C++){var L=x[C];_n=L,ze(L,f)}Ee(f)}for(f=f.child;f!==null;){switch(x=f,x.tag){case 0:case 11:case 15:Kl(8,x,x.return),Ue(x);break;case 22:C=x.stateNode,C._visibility&2&&(C._visibility&=-3,Ue(x));break;default:Ue(x)}f=f.sibling}}function ze(f,x){for(;_n!==null;){var C=_n;switch(C.tag){case 0:case 11:case 15:Kl(8,C,x);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var L=C.memoizedState.cachePool.pool;L!=null&&L.refCount++}break;case 24:Vl(C.memoizedState.cache)}if(L=C.child,L!==null)L.return=C,_n=L;else e:for(C=f;_n!==null;){L=_n;var q=L.sibling,te=L.return;if(xh(L),L===C){_n=null;break e}if(q!==null){q.return=te,_n=q;break e}_n=te}}}var Pe={getCacheForType:function(f){var x=js(en),C=x.data.get(f);return C===void 0&&(C=f(),x.data.set(f,C)),C},cacheSignal:function(){return js(en).controller.signal}},We=typeof WeakMap=="function"?WeakMap:Map,Xe=0,Qe=null,rt=null,tt=0,pt=0,wt=null,nt=!1,Ze=!1,_t=!1,ot=0,bt=0,Lt=0,Wt=0,jt=0,zt=0,hi=0,ai=null,Xt=null,oi=!1,_i=0,Ti=0,Fi=1/0,Yi=null,Ai=null,Bi=0,Di=null,ur=null,sr=0,vr=0,er=null,ji=null,or=0,Hr=null;function br(){return(Xe&2)!==0&&tt!==0?tt&-tt:xe.T!==null?Hp():me()}function pr(){if(zt===0)if((tt&536870912)===0||Gr){var f=Wa;Wa<<=1,(Wa&3932160)===0&&(Wa=262144),zt=f}else zt=536870912;return f=Qs.current,f!==null&&(f.flags|=32),zt}function Oi(f,x,C){(f===Qe&&(pt===2||pt===9)||f.cancelPendingCommit!==null)&&(ws(f,0),Er(f,tt,zt,!1)),An(f,C),((Xe&2)===0||f!==Qe)&&(f===Qe&&((Xe&2)===0&&(Wt|=C),bt===4&&Er(f,tt,zt,!1)),Mc(f))}function Ni(f,x,C){if((Xe&6)!==0)throw Error(d(327));var L=!C&&(x&127)===0&&(x&f.expiredLanes)===0||Mn(f,x),q=L?Qr(f,x):Va(f,x,!0),te=L;do{if(q===0){Ze&&!L&&Er(f,x,0,!1);break}else{if(C=f.current.alternate,te&&!sn(C)){q=Va(f,x,!1),te=!1;continue}if(q===2){if(te=x,f.errorRecoveryDisabledLanes&te)var we=0;else we=f.pendingLanes&-536870913,we=we!==0?we:we&536870912?536870912:0;if(we!==0){x=we;e:{var $e=f;q=ai;var mt=$e.current.memoizedState.isDehydrated;if(mt&&(ws($e,we).flags|=256),we=Va($e,we,!1),we!==2){if(_t&&!mt){$e.errorRecoveryDisabledLanes|=te,Wt|=te,q=4;break e}te=Xt,Xt=q,te!==null&&(Xt===null?Xt=te:Xt.push.apply(Xt,te))}q=we}if(te=!1,q!==2)continue}}if(q===1){ws(f,0),Er(f,x,0,!0);break}e:{switch(L=f,te=q,te){case 0:case 1:throw Error(d(345));case 4:if((x&4194048)!==x)break;case 6:Er(L,x,zt,!nt);break e;case 2:Xt=null;break;case 3:case 5:break;default:throw Error(d(329))}if((x&62914560)===x&&(q=_i+300-Dr(),10<q)){if(Er(L,x,zt,!nt),$i(L,0,!0)!==0)break e;sr=x,L.timeoutHandle=Lf(kr.bind(null,L,C,Xt,Yi,oi,x,zt,Wt,hi,nt,te,"Throttled",-0,0),q);break e}kr(L,C,Xt,Yi,oi,x,zt,Wt,hi,nt,te,null,-0,0)}}break}while(!0);Mc(f)}function kr(f,x,C,L,q,te,we,$e,mt,Gt,ni,di,Ht,Jt){if(f.timeoutHandle=-1,di=x.subtreeFlags,di&8192||(di&16785408)===16785408){di={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:cs},Ae(x,te,di);var Hi=(te&62914560)===te?_i-Dr():(te&4194048)===te?Ti-Dr():0;if(Hi=o_(di,Hi),Hi!==null){sr=te,f.cancelPendingCommit=Hi(bh.bind(null,f,x,te,C,L,q,we,$e,mt,ni,di,null,Ht,Jt)),Er(f,te,we,!Gt);return}}bh(f,x,te,C,L,q,we,$e,mt)}function sn(f){for(var x=f;;){var C=x.tag;if((C===0||C===11||C===15)&&x.flags&16384&&(C=x.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var L=0;L<C.length;L++){var q=C[L],te=q.getSnapshot;q=q.value;try{if(!ba(te(),q))return!1}catch{return!1}}if(C=x.child,x.subtreeFlags&16384&&C!==null)C.return=x,x=C;else{if(x===f)break;for(;x.sibling===null;){if(x.return===null||x.return===f)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function Er(f,x,C,L){x&=~jt,x&=~Wt,f.suspendedLanes|=x,f.pingedLanes&=~x,L&&(f.warmLanes|=x),L=f.expirationTimes;for(var q=x;0<q;){var te=31-$n(q),we=1<<te;L[te]=-1,q&=~we}C!==0&&ga(f,C,x)}function Lr(){return(Xe&6)===0?(Sh(0),!1):!0}function Vs(){if(rt!==null){if(pt===0)var f=rt.return;else f=rt,hl=_o=null,ud(f),gc=null,ih=0,f=rt;for(;f!==null;)Bp(f.alternate,f),f=f.return;rt=null}}function ws(f,x){var C=f.timeoutHandle;C!==-1&&(f.timeoutHandle=-1,l0(C)),C=f.cancelPendingCommit,C!==null&&(f.cancelPendingCommit=null,C()),sr=0,Vs(),Qe=f,rt=C=Ea(f.current,null),tt=x,pt=0,wt=null,nt=!1,Ze=Mn(f,x),_t=!1,hi=zt=jt=Wt=Lt=bt=0,Xt=ai=null,oi=!1,(x&8)!==0&&(x|=x&32);var L=f.entangledLanes;if(L!==0)for(f=f.entanglements,L&=x;0<L;){var q=31-$n(L),te=1<<q;x|=f[q],L&=~te}return ot=x,Wc(),C}function ns(f,x){Ut=null,xe.H=Uo,x===th||x===rd?(x=xp(),pt=3):x===_p?(x=xp(),pt=4):pt=x===wd?8:x!==null&&typeof x=="object"&&typeof x.then=="function"?6:1,wt=x,rt===null&&(bt=1,bd(f,Cs(x,f.current)))}function mr(){var f=Qs.current;return f===null?!0:(tt&4194048)===tt?Ns===null:(tt&62914560)===tt||(tt&536870912)!==0?f===Ns:!1}function Aa(){var f=xe.H;return xe.H=Uo,f===null?Uo:f}function Es(){var f=xe.A;return xe.A=Pe,f}function Ms(){bt=4,nt||(tt&4194048)!==tt&&Qs.current!==null||(Ze=!0),(Lt&134217727)===0&&(Wt&134217727)===0||Qe===null||Er(Qe,tt,zt,!1)}function Va(f,x,C){var L=Xe;Xe|=2;var q=Aa(),te=Es();(Qe!==f||tt!==x)&&(Yi=null,ws(f,x)),x=!1;var we=bt;e:do try{if(pt!==0&&rt!==null){var $e=rt,mt=wt;switch(pt){case 8:Vs(),we=6;break e;case 3:case 2:case 9:case 6:Qs.current===null&&(x=!0);var Gt=pt;if(pt=0,wt=null,Jn(f,$e,mt,Gt),C&&Ze){we=0;break e}break;default:Gt=pt,pt=0,wt=null,Jn(f,$e,mt,Gt)}}pa(),we=bt;break}catch(ni){ns(f,ni)}while(!0);return x&&f.shellSuspendCounter++,hl=_o=null,Xe=L,xe.H=q,xe.A=te,rt===null&&(Qe=null,tt=0,Wc()),we}function pa(){for(;rt!==null;)jr(rt)}function Qr(f,x){var C=Xe;Xe|=2;var L=Aa(),q=Es();Qe!==f||tt!==x?(Yi=null,Fi=Dr()+500,ws(f,x)):Ze=Mn(f,x);e:do try{if(pt!==0&&rt!==null){x=rt;var te=wt;t:switch(pt){case 1:pt=0,wt=null,Jn(f,x,te,1);break;case 2:case 9:if(sd(te)){pt=0,wt=null,Ln(x);break}x=function(){pt!==2&&pt!==9||Qe!==f||(pt=7),Mc(f)},te.then(x,x);break e;case 3:pt=7;break e;case 4:pt=5;break e;case 7:sd(te)?(pt=0,wt=null,Ln(x)):(pt=0,wt=null,Jn(f,x,te,7));break;case 5:var we=null;switch(rt.tag){case 26:we=rt.memoizedState;case 5:case 27:var $e=rt;if(we?ny(we):$e.stateNode.complete){pt=0,wt=null;var mt=$e.sibling;if(mt!==null)rt=mt;else{var Gt=$e.return;Gt!==null?(rt=Gt,tn(Gt)):rt=null}break t}}pt=0,wt=null,Jn(f,x,te,5);break;case 6:pt=0,wt=null,Jn(f,x,te,6);break;case 8:Vs(),bt=6;break e;default:throw Error(d(462))}}Cn();break}catch(ni){ns(f,ni)}while(!0);return hl=_o=null,xe.H=L,xe.A=q,Xe=C,rt!==null?0:(Qe=null,tt=0,Wc(),bt)}function Cn(){for(;rt!==null&&!dn();)jr(rt)}function jr(f){var x=Ad(f.alternate,f,ot);f.memoizedProps=f.pendingProps,x===null?tn(f):rt=x}function Ln(f){var x=f,C=x.alternate;switch(x.tag){case 15:case 0:x=Ed(C,x,x.pendingProps,x.type,void 0,tt);break;case 11:x=Ed(C,x,x.pendingProps,x.type.render,x.ref,tt);break;case 5:ud(x);default:Bp(C,x),x=rt=zl(x,ot),x=Ad(C,x,ot)}f.memoizedProps=f.pendingProps,x===null?tn(f):rt=x}function Jn(f,x,C,L){hl=_o=null,ud(x),gc=null,ih=0;var q=x.return;try{if(uh(f,q,x,C,tt)){bt=1,bd(f,Cs(C,f.current)),rt=null;return}}catch(te){if(q!==null)throw rt=q,te;bt=1,bd(f,Cs(C,f.current)),rt=null;return}x.flags&32768?(Gr||L===1?f=!0:Ze||(tt&536870912)!==0?f=!1:(nt=f=!0,(L===2||L===9||L===3||L===6)&&(L=Qs.current,L!==null&&L.tag===13&&(L.flags|=16384))),Ca(x,f)):tn(x)}function tn(f){var x=f;do{if((x.flags&32768)!==0){Ca(x,nt);return}f=x.return;var C=Rd(x.alternate,x,ot);if(C!==null){rt=C;return}if(x=x.sibling,x!==null){rt=x;return}rt=x=f}while(x!==null);bt===0&&(bt=5)}function Ca(f,x){do{var C=Hm(f.alternate,f);if(C!==null){C.flags&=32767,rt=C;return}if(C=f.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!x&&(f=f.sibling,f!==null)){rt=f;return}rt=f=C}while(f!==null);bt=6,rt=null}function bh(f,x,C,L,q,te,we,$e,mt){f.cancelPendingCommit=null;do ro();while(Bi!==0);if((Xe&6)!==0)throw Error(d(327));if(x!==null){if(x===f.current)throw Error(d(177));if(te=x.lanes|x.childLanes,te|=Hh,Pt(f,C,te,we,$e,mt),f===Qe&&(rt=Qe=null,tt=0),ur=x,Di=f,sr=C,vr=te,er=q,ji=L,(x.subtreeFlags&10256)!==0||(x.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,Hy(As,function(){return Xo(),null})):(f.callbackNode=null,f.callbackPriority=0),L=(x.flags&13878)!==0,(x.subtreeFlags&13878)!==0||L){L=xe.T,xe.T=null,q=Fe.p,Fe.p=2,we=Xe,Xe|=4;try{Vn(f,x,C)}finally{Xe=we,Fe.p=q,xe.T=L}}Bi=1,Zo(),vu(),bu()}}function Zo(){if(Bi===1){Bi=0;var f=Di,x=ur,C=(x.flags&13878)!==0;if((x.subtreeFlags&13878)!==0||C){C=xe.T,xe.T=null;var L=Fe.p;Fe.p=2;var q=Xe;Xe|=4;try{A(x,f);var te=Km,we=Im(f.containerInfo),$e=te.focusedElem,mt=te.selectionRange;if(we!==$e&&$e&&$e.ownerDocument&&Dl($e.ownerDocument.documentElement,$e)){if(mt!==null&&Hc($e)){var Gt=mt.start,ni=mt.end;if(ni===void 0&&(ni=Gt),"selectionStart"in $e)$e.selectionStart=Gt,$e.selectionEnd=Math.min(ni,$e.value.length);else{var di=$e.ownerDocument||document,Ht=di&&di.defaultView||window;if(Ht.getSelection){var Jt=Ht.getSelection(),Hi=$e.textContent.length,ir=Math.min(mt.start,Hi),xn=mt.end===void 0?ir:Math.min(mt.end,Hi);!Jt.extend&&ir>xn&&(we=xn,xn=ir,ir=we);var Dt=Ya($e,ir),xt=Ya($e,xn);if(Dt&&xt&&(Jt.rangeCount!==1||Jt.anchorNode!==Dt.node||Jt.anchorOffset!==Dt.offset||Jt.focusNode!==xt.node||Jt.focusOffset!==xt.offset)){var Vt=di.createRange();Vt.setStart(Dt.node,Dt.offset),Jt.removeAllRanges(),ir>xn?(Jt.addRange(Vt),Jt.extend(xt.node,xt.offset)):(Vt.setEnd(xt.node,xt.offset),Jt.addRange(Vt))}}}}for(di=[],Jt=$e;Jt=Jt.parentNode;)Jt.nodeType===1&&di.push({element:Jt,left:Jt.scrollLeft,top:Jt.scrollTop});for(typeof $e.focus=="function"&&$e.focus(),$e=0;$e<di.length;$e++){var ui=di[$e];ui.element.scrollLeft=ui.left,ui.element.scrollTop=ui.top}}am=!!Ym,Km=Ym=null}finally{Xe=q,Fe.p=L,xe.T=C}}f.current=x,Bi=2}}function vu(){if(Bi===2){Bi=0;var f=Di,x=ur,C=(x.flags&8772)!==0;if((x.subtreeFlags&8772)!==0||C){C=xe.T,xe.T=null;var L=Fe.p;Fe.p=2;var q=Xe;Xe|=4;try{Na(f,x.alternate,x)}finally{Xe=q,Fe.p=L,xe.T=C}}Bi=3}}function bu(){if(Bi===4||Bi===3){Bi=0,os();var f=Di,x=ur,C=sr,L=ji;(x.subtreeFlags&10256)!==0||(x.flags&10256)!==0?Bi=5:(Bi=0,ur=Di=null,Ra(f,f.pendingLanes));var q=f.pendingLanes;if(q===0&&(Ai=null),Je(C),x=x.stateNode,Zn&&typeof Zn.onCommitFiberRoot=="function")try{Zn.onCommitFiberRoot(Co,x,void 0,(x.current.flags&128)===128)}catch{}if(L!==null){x=xe.T,q=Fe.p,Fe.p=2,xe.T=null;try{for(var te=f.onRecoverableError,we=0;we<L.length;we++){var $e=L[we];te($e.value,{componentStack:$e.stack})}}finally{xe.T=x,Fe.p=q}}(sr&3)!==0&&ro(),Mc(f),q=f.pendingLanes,(C&261930)!==0&&(q&42)!==0?f===Hr?or++:(or=0,Hr=f):or=0,Sh(0)}}function Ra(f,x){(f.pooledCacheLanes&=x)===0&&(x=f.pooledCache,x!=null&&(f.pooledCache=null,Vl(x)))}function ro(){return Zo(),vu(),bu(),Xo()}function Xo(){if(Bi!==5)return!1;var f=Di,x=vr;vr=0;var C=Je(sr),L=xe.T,q=Fe.p;try{Fe.p=32>C?32:C,xe.T=null,C=er,er=null;var te=Di,we=sr;if(Bi=0,ur=Di=null,sr=0,(Xe&6)!==0)throw Error(d(331));var $e=Xe;if(Xe|=4,je(te.current),he(te,te.current,we,C),Xe=$e,Sh(0,!1),Zn&&typeof Zn.onPostCommitFiberRoot=="function")try{Zn.onPostCommitFiberRoot(Co,te)}catch{}return!0}finally{Fe.p=q,xe.T=L,Ra(f,x)}}function Ua(f,x,C){x=Cs(C,x),x=Go(f.stateNode,x,2),f=Hl(f,x,2),f!==null&&(An(f,2),Mc(f))}function Vr(f,x,C){if(f.tag===3)Ua(f,f,C);else for(;x!==null;){if(x.tag===3){Ua(x,f,C);break}else if(x.tag===1){var L=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Ai===null||!Ai.has(L))){f=Cs(C,f),C=xl(2),L=Hl(x,C,2),L!==null&&(ds(C,L,x,f),An(L,2),Mc(L));break}}x=x.return}}function Jl(f,x,C){var L=f.pingCache;if(L===null){L=f.pingCache=new We;var q=new Set;L.set(x,q)}else q=L.get(x),q===void 0&&(q=new Set,L.set(x,q));q.has(C)||(_t=!0,q.add(C),f=Df.bind(null,f,x,C),x.then(f,f))}function Df(f,x,C){var L=f.pingCache;L!==null&&L.delete(x),f.pingedLanes|=f.suspendedLanes&C,f.warmLanes&=~C,Qe===f&&(tt&C)===C&&(bt===4||bt===3&&(tt&62914560)===tt&&300>Dr()-_i?(Xe&2)===0&&ws(f,0):jt|=C,hi===tt&&(hi=0)),Mc(f)}function Bg(f,x){x===0&&(x=Tn()),f=$t(f,x),f!==null&&(An(f,x),Mc(f))}function Gy(f){var x=f.memoizedState,C=0;x!==null&&(C=x.retryLane),Bg(f,C)}function $y(f,x){var C=0;switch(f.tag){case 31:case 13:var L=f.stateNode,q=f.memoizedState;q!==null&&(C=q.retryLane);break;case 19:L=f.stateNode;break;case 22:L=f.stateNode._retryCache;break;default:throw Error(d(314))}L!==null&&L.delete(x),Bg(f,C)}function Hy(f,x){return es(f,x)}var Gp=null,wl=null,qm=!1,Ps=!1,wh=!1,Eh=0;function Mc(f){f!==wl&&f.next===null&&(wl===null?Gp=wl=f:wl=wl.next=f),Ps=!0,qm||(qm=!0,s0())}function Sh(f,x){if(!wh&&Ps){wh=!0;do for(var C=!1,L=Gp;L!==null;){if(f!==0){var q=L.pendingLanes;if(q===0)var te=0;else{var we=L.suspendedLanes,$e=L.pingedLanes;te=(1<<31-$n(42|f)+1)-1,te&=q&~(we&~$e),te=te&201326741?te&201326741|1:te?te|2:0}te!==0&&(C=!0,Ng(L,te))}else te=tt,te=$i(L,L===Qe?te:0,L.cancelPendingCommit!==null||L.timeoutHandle!==-1),(te&3)===0||Mn(L,te)||(C=!0,Ng(L,te));L=L.next}while(C);wh=!1}}function n0(){jg()}function jg(){Ps=qm=!1;var f=0;Eh!==0&&e_()&&(f=Eh);for(var x=Dr(),C=null,L=Gp;L!==null;){var q=L.next,te=$p(L,x);te===0?(L.next=null,C===null?Gp=q:C.next=q,q===null&&(wl=C)):(C=L,(f!==0||(te&3)!==0)&&(Ps=!0)),L=q}Bi!==0&&Bi!==5||Sh(f),Eh!==0&&(Eh=0)}function $p(f,x){for(var C=f.suspendedLanes,L=f.pingedLanes,q=f.expirationTimes,te=f.pendingLanes&-62914561;0<te;){var we=31-$n(te),$e=1<<we,mt=q[we];mt===-1?(($e&C)===0||($e&L)!==0)&&(q[we]=Xn($e,x)):mt<=x&&(f.expiredLanes|=$e),te&=~$e}if(x=Qe,C=tt,C=$i(f,f===x?C:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),L=f.callbackNode,C===0||f===x&&(pt===2||pt===9)||f.cancelPendingCommit!==null)return L!==null&&L!==null&&Un(L),f.callbackNode=null,f.callbackPriority=0;if((C&3)===0||Mn(f,C)){if(x=C&-C,x===f.callbackPriority)return x;switch(L!==null&&Un(L),Je(C)){case 2:case 8:C=ys;break;case 32:C=As;break;case 268435456:C=bn;break;default:C=As}return L=qy.bind(null,f),C=es(C,L),f.callbackPriority=x,f.callbackNode=C,x}return L!==null&&L!==null&&Un(L),f.callbackPriority=2,f.callbackNode=null,2}function qy(f,x){if(Bi!==0&&Bi!==5)return f.callbackNode=null,f.callbackPriority=0,null;var C=f.callbackNode;if(ro()&&f.callbackNode!==C)return null;var L=tt;return L=$i(f,f===Qe?L:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),L===0?null:(Ni(f,L,x),$p(f,Dr()),f.callbackNode!=null&&f.callbackNode===C?qy.bind(null,f):null)}function Ng(f,x){if(ro())return null;Ni(f,x,!0)}function s0(){c0(function(){(Xe&6)!==0?es(Rn,n0):jg()})}function Hp(){if(Eh===0){var f=Ul;f===0&&(f=qa,qa<<=1,(qa&261888)===0&&(qa=256)),Eh=f}return Eh}function ec(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:uo(""+f)}function Pc(f,x){var C=x.ownerDocument.createElement("input");return C.name=x.name,C.value=x.value,f.id&&C.setAttribute("form",f.id),x.parentNode.insertBefore(C,x),f=new FormData(f),C.parentNode.removeChild(C),f}function Wy(f,x,C,L,q){if(x==="submit"&&C&&C.stateNode===q){var te=ec((q[Oe]||null).action),we=L.submitter;we&&(x=(x=we[Oe]||null)?ec(x.formAction):we.getAttribute("formAction"),x!==null&&(te=x,we=null));var $e=new oc("action","action",null,L,q);f.push({event:$e,listeners:[{instance:null,listener:function(){if(L.defaultPrevented){if(Eh!==0){var mt=we?Pc(q,we):new FormData(q);md(C,{pending:!0,data:mt,method:q.method,action:te},null,mt)}}else typeof te=="function"&&($e.preventDefault(),mt=we?Pc(q,we):new FormData(q),md(C,{pending:!0,data:mt,method:q.method,action:te},te,mt))},currentTarget:q}]})}}for(var Wm=0;Wm<ha.length;Wm++){var kf=ha[Wm],Vg=kf.toLowerCase(),qp=kf[0].toUpperCase()+kf.slice(1);Qa(Vg,"on"+qp)}Qa(Qd,"onAnimationEnd"),Qa(Dm,"onAnimationIteration"),Qa(al,"onAnimationStart"),Qa("dblclick","onDoubleClick"),Qa("focusin","onFocus"),Qa("focusout","onBlur"),Qa(km,"onTransitionRun"),Qa(Lm,"onTransitionStart"),Qa(Jd,"onTransitionCancel"),Qa(ef,"onTransitionEnd"),Wr("onMouseEnter",["mouseout","mouseover"]),Wr("onMouseLeave",["mouseout","mouseover"]),Wr("onPointerEnter",["pointerout","pointerover"]),Wr("onPointerLeave",["pointerout","pointerover"]),fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Th="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Th));function Wp(f,x){x=(x&4)!==0;for(var C=0;C<f.length;C++){var L=f[C],q=L.event;L=L.listeners;e:{var te=void 0;if(x)for(var we=L.length-1;0<=we;we--){var $e=L[we],mt=$e.instance,Gt=$e.currentTarget;if($e=$e.listener,mt!==te&&q.isPropagationStopped())break e;te=$e,q.currentTarget=Gt;try{te(q)}catch(ni){Gu(ni)}q.currentTarget=null,te=mt}else for(we=0;we<L.length;we++){if($e=L[we],mt=$e.instance,Gt=$e.currentTarget,$e=$e.listener,mt!==te&&q.isPropagationStopped())break e;te=$e,q.currentTarget=Gt;try{te(q)}catch(ni){Gu(ni)}q.currentTarget=null,te=mt}}}}function Ur(f,x){var C=x[ut];C===void 0&&(C=x[ut]=new Set);var L=f+"__bubble";C.has(L)||(wu(x,f,2,!1),C.add(L))}function Zp(f,x,C){var L=0;x&&(L|=4),wu(C,f,L,x)}var Xp="_reactListening"+Math.random().toString(36).slice(2);function Zm(f){if(!f[Xp]){f[Xp]=!0,Pi.forEach(function(C){C!=="selectionchange"&&(Zy.has(C)||Zp(C,!1,f),Zp(C,!0,f))});var x=f.nodeType===9?f:f.ownerDocument;x===null||x[Xp]||(x[Xp]=!0,Zp("selectionchange",!1,x))}}function wu(f,x,C,L){switch(d_(x)){case 2:var q=rg;break;case 8:q=h_;break;default:q=Bf}C=q.bind(null,x,C,f),q=void 0,!jc||x!=="touchstart"&&x!=="touchmove"&&x!=="wheel"||(q=!0),L?q!==void 0?f.addEventListener(x,C,{capture:!0,passive:q}):f.addEventListener(x,C,!0):q!==void 0?f.addEventListener(x,C,{passive:q}):f.addEventListener(x,C,!1)}function Xm(f,x,C,L,q){var te=L;if((x&1)===0&&(x&2)===0&&L!==null)e:for(;;){if(L===null)return;var we=L.tag;if(we===3||we===4){var $e=L.stateNode.containerInfo;if($e===q)break;if(we===4)for(we=L.return;we!==null;){var mt=we.tag;if((mt===3||mt===4)&&we.stateNode.containerInfo===q)return;we=we.return}for(;$e!==null;){if(we=yi($e),we===null)return;if(mt=we.tag,mt===5||mt===6||mt===26||mt===27){L=te=we;continue e}$e=$e.parentNode}}L=L.return}sp(function(){var Gt=te,ni=sc(C),di=[];e:{var Ht=Ll.get(f);if(Ht!==void 0){var Jt=oc,Hi=f;switch(f){case"keypress":if(nr(C)===0)break e;case"keydown":case"keyup":Jt=_a;break;case"focusin":Hi="focus",Jt=Xs;break;case"focusout":Hi="blur",Jt=Xs;break;case"beforeblur":case"afterblur":Jt=Xs;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Jt=zu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Jt=Vc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Jt=ca;break;case Qd:case Dm:case al:Jt=Hd;break;case ef:Jt=wr;break;case"scroll":case"scrollend":Jt=jh;break;case"wheel":Jt=Bu;break;case"copy":case"cut":case"paste":Jt=_r;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Jt=gr;break;case"toggle":case"beforetoggle":Jt=Ys}var ir=(x&4)!==0,xn=!ir&&(f==="scroll"||f==="scrollend"),Dt=ir?Ht!==null?Ht+"Capture":null:Ht;ir=[];for(var xt=Gt,Vt;xt!==null;){var ui=xt;if(Vt=ui.stateNode,ui=ui.tag,ui!==5&&ui!==26&&ui!==27||Vt===null||Dt===null||(ui=Lu(xt,Dt),ui!=null&&ir.push(Md(xt,ui,Vt))),xn)break;xt=xt.return}0<ir.length&&(Ht=new Jt(Ht,Hi,null,C,ni),di.push({event:Ht,listeners:ir}))}}if((x&7)===0){e:{if(Ht=f==="mouseover"||f==="pointerover",Jt=f==="mouseout"||f==="pointerout",Ht&&C!==ho&&(Hi=C.relatedTarget||C.fromElement)&&(yi(Hi)||Hi[Ke]))break e;if((Jt||Ht)&&(Ht=ni.window===ni?ni:(Ht=ni.ownerDocument)?Ht.defaultView||Ht.parentWindow:window,Jt?(Hi=C.relatedTarget||C.toElement,Jt=Gt,Hi=Hi?yi(Hi):null,Hi!==null&&(xn=S(Hi),ir=Hi.tag,Hi!==xn||ir!==5&&ir!==27&&ir!==6)&&(Hi=null)):(Jt=null,Hi=Gt),Jt!==Hi)){if(ir=zu,ui="onMouseLeave",Dt="onMouseEnter",xt="mouse",(f==="pointerout"||f==="pointerover")&&(ir=gr,ui="onPointerLeave",Dt="onPointerEnter",xt="pointer"),xn=Jt==null?Ht:Li(Jt),Vt=Hi==null?Ht:Li(Hi),Ht=new ir(ui,xt+"leave",Jt,C,ni),Ht.target=xn,Ht.relatedTarget=Vt,ui=null,yi(ni)===Gt&&(ir=new ir(Dt,xt+"enter",Hi,C,ni),ir.target=Vt,ir.relatedTarget=xn,ui=ir),xn=ui,Jt&&Hi)t:{for(ir=a0,Dt=Jt,xt=Hi,Vt=0,ui=Dt;ui;ui=ir(ui))Vt++;ui=0;for(var ar=xt;ar;ar=ir(ar))ui++;for(;0<Vt-ui;)Dt=ir(Dt),Vt--;for(;0<ui-Vt;)xt=ir(xt),ui--;for(;Vt--;){if(Dt===xt||xt!==null&&Dt===xt.alternate){ir=Dt;break t}Dt=ir(Dt),xt=ir(xt)}ir=null}else ir=null;Jt!==null&&Xy(di,Ht,Jt,ir,!1),Hi!==null&&xn!==null&&Xy(di,xn,Hi,ir,!0)}}e:{if(Ht=Gt?Li(Gt):window,Jt=Ht.nodeName&&Ht.nodeName.toLowerCase(),Jt==="select"||Jt==="input"&&Ht.type==="file")var an=fi;else if(Qn(Ht))if($c)an=Uu;else{an=sl;var Ki=pp}else Jt=Ht.nodeName,!Jt||Jt.toLowerCase()!=="input"||Ht.type!=="checkbox"&&Ht.type!=="radio"?Gt&&Fh(Gt.elementType)&&(an=fi):an=Pm;if(an&&(an=an(f,Gt))){Io(di,an,C,ni);break e}Ki&&Ki(f,Ht,Gt),f==="focusout"&&Gt&&Ht.type==="number"&&Gt.memoizedProps.value!=null&&Mo(Ht,"number",Ht.value)}switch(Ki=Gt?Li(Gt):window,f){case"focusin":(Qn(Ki)||Ki.contentEditable==="true")&&(kl=Ki,Yd=Gt,ua=null);break;case"focusout":ua=Yd=kl=null;break;case"mousedown":Kd=!0;break;case"contextmenu":case"mouseup":case"dragend":Kd=!1,$h(di,C,ni);break;case"selectionchange":if(Gh)break;case"keydown":case"keyup":$h(di,C,ni)}var Or;if(hp)e:{switch(f){case"compositionstart":var Zr="onCompositionStart";break e;case"compositionend":Zr="onCompositionEnd";break e;case"compositionupdate":Zr="onCompositionUpdate";break e}Zr=void 0}else vs?Vh(f,C)&&(Zr="onCompositionEnd"):f==="keydown"&&C.keyCode===229&&(Zr="onCompositionStart");Zr&&(ju&&C.locale!=="ko"&&(vs||Zr!=="onCompositionStart"?Zr==="onCompositionEnd"&&vs&&(Or=$d()):(la=ni,Nc="value"in la?la.value:la.textContent,vs=!0)),Ki=Yp(Gt,Zr),0<Ki.length&&(Zr=new cp(Zr,f,null,C,ni),di.push({event:Zr,listeners:Ki}),Or?Zr.data=Or:(Or=Bs(C),Or!==null&&(Zr.data=Or)))),(Or=dp?xa(f,C):fp(f,C))&&(Zr=Yp(Gt,"onBeforeInput"),0<Zr.length&&(Ki=new cp("onBeforeInput","beforeinput",null,C,ni),di.push({event:Ki,listeners:Zr}),Ki.data=Or)),Wy(di,f,Gt,C,ni)}Wp(di,x)})}function Md(f,x,C){return{instance:f,listener:x,currentTarget:C}}function Yp(f,x){for(var C=x+"Capture",L=[];f!==null;){var q=f,te=q.stateNode;if(q=q.tag,q!==5&&q!==26&&q!==27||te===null||(q=Lu(f,C),q!=null&&L.unshift(Md(f,q,te)),q=Lu(f,x),q!=null&&L.push(Md(f,q,te))),f.tag===3)return L;f=f.return}return[]}function a0(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function Xy(f,x,C,L,q){for(var te=x._reactName,we=[];C!==null&&C!==L;){var $e=C,mt=$e.alternate,Gt=$e.stateNode;if($e=$e.tag,mt!==null&&mt===L)break;$e!==5&&$e!==26&&$e!==27||Gt===null||(mt=Gt,q?(Gt=Lu(C,te),Gt!=null&&we.unshift(Md(C,Gt,mt))):q||(Gt=Lu(C,te),Gt!=null&&we.push(Md(C,Gt,mt)))),C=C.return}we.length!==0&&f.push({event:x,listeners:we})}var o0=/\r\n?/g,Yy=/\u0000|\uFFFD/g;function Ug(f){return(typeof f=="string"?f:""+f).replace(o0,`
`).replace(Yy,"")}function Ky(f,x){return x=Ug(x),Ug(f)===x}function On(f,x,C,L,q,te){switch(C){case"children":typeof L=="string"?x==="body"||x==="textarea"&&L===""||rl(f,L):(typeof L=="number"||typeof L=="bigint")&&x!=="body"&&rl(f,""+L);break;case"className":Cr(f,"class",L);break;case"tabIndex":Cr(f,"tabindex",L);break;case"dir":case"role":case"viewBox":case"width":case"height":Cr(f,C,L);break;case"style":Ud(f,L,te);break;case"data":if(x!=="object"){Cr(f,"data",L);break}case"src":case"href":if(L===""&&(x!=="a"||C!=="href")){f.removeAttribute(C);break}if(L==null||typeof L=="function"||typeof L=="symbol"||typeof L=="boolean"){f.removeAttribute(C);break}L=uo(""+L),f.setAttribute(C,L);break;case"action":case"formAction":if(typeof L=="function"){f.setAttribute(C,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof te=="function"&&(C==="formAction"?(x!=="input"&&On(f,x,"name",q.name,q,null),On(f,x,"formEncType",q.formEncType,q,null),On(f,x,"formMethod",q.formMethod,q,null),On(f,x,"formTarget",q.formTarget,q,null)):(On(f,x,"encType",q.encType,q,null),On(f,x,"method",q.method,q,null),On(f,x,"target",q.target,q,null)));if(L==null||typeof L=="symbol"||typeof L=="boolean"){f.removeAttribute(C);break}L=uo(""+L),f.setAttribute(C,L);break;case"onClick":L!=null&&(f.onclick=cs);break;case"onScroll":L!=null&&Ur("scroll",f);break;case"onScrollEnd":L!=null&&Ur("scrollend",f);break;case"dangerouslySetInnerHTML":if(L!=null){if(typeof L!="object"||!("__html"in L))throw Error(d(61));if(C=L.__html,C!=null){if(q.children!=null)throw Error(d(60));f.innerHTML=C}}break;case"multiple":f.multiple=L&&typeof L!="function"&&typeof L!="symbol";break;case"muted":f.muted=L&&typeof L!="function"&&typeof L!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(L==null||typeof L=="function"||typeof L=="boolean"||typeof L=="symbol"){f.removeAttribute("xlink:href");break}C=uo(""+L),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",C);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":L!=null&&typeof L!="function"&&typeof L!="symbol"?f.setAttribute(C,""+L):f.removeAttribute(C);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":L&&typeof L!="function"&&typeof L!="symbol"?f.setAttribute(C,""):f.removeAttribute(C);break;case"capture":case"download":L===!0?f.setAttribute(C,""):L!==!1&&L!=null&&typeof L!="function"&&typeof L!="symbol"?f.setAttribute(C,L):f.removeAttribute(C);break;case"cols":case"rows":case"size":case"span":L!=null&&typeof L!="function"&&typeof L!="symbol"&&!isNaN(L)&&1<=L?f.setAttribute(C,L):f.removeAttribute(C);break;case"rowSpan":case"start":L==null||typeof L=="function"||typeof L=="symbol"||isNaN(L)?f.removeAttribute(C):f.setAttribute(C,L);break;case"popover":Ur("beforetoggle",f),Ur("toggle",f),Ar(f,"popover",L);break;case"xlinkActuate":Br(f,"http://www.w3.org/1999/xlink","xlink:actuate",L);break;case"xlinkArcrole":Br(f,"http://www.w3.org/1999/xlink","xlink:arcrole",L);break;case"xlinkRole":Br(f,"http://www.w3.org/1999/xlink","xlink:role",L);break;case"xlinkShow":Br(f,"http://www.w3.org/1999/xlink","xlink:show",L);break;case"xlinkTitle":Br(f,"http://www.w3.org/1999/xlink","xlink:title",L);break;case"xlinkType":Br(f,"http://www.w3.org/1999/xlink","xlink:type",L);break;case"xmlBase":Br(f,"http://www.w3.org/XML/1998/namespace","xml:base",L);break;case"xmlLang":Br(f,"http://www.w3.org/XML/1998/namespace","xml:lang",L);break;case"xmlSpace":Br(f,"http://www.w3.org/XML/1998/namespace","xml:space",L);break;case"is":Ar(f,"is",L);break;case"innerText":case"textContent":break;default:(!(2<C.length)||C[0]!=="o"&&C[0]!=="O"||C[1]!=="n"&&C[1]!=="N")&&(C=xs.get(C)||C,Ar(f,C,L))}}function Gg(f,x,C,L,q,te){switch(C){case"style":Ud(f,L,te);break;case"dangerouslySetInnerHTML":if(L!=null){if(typeof L!="object"||!("__html"in L))throw Error(d(61));if(C=L.__html,C!=null){if(q.children!=null)throw Error(d(60));f.innerHTML=C}}break;case"children":typeof L=="string"?rl(f,L):(typeof L=="number"||typeof L=="bigint")&&rl(f,""+L);break;case"onScroll":L!=null&&Ur("scroll",f);break;case"onScrollEnd":L!=null&&Ur("scrollend",f);break;case"onClick":L!=null&&(f.onclick=cs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Fr.hasOwnProperty(C))e:{if(C[0]==="o"&&C[1]==="n"&&(q=C.endsWith("Capture"),x=C.slice(2,q?C.length-7:void 0),te=f[Oe]||null,te=te!=null?te[C]:null,typeof te=="function"&&f.removeEventListener(x,te,q),typeof L=="function")){typeof te!="function"&&te!==null&&(C in f?f[C]=null:f.hasAttribute(C)&&f.removeAttribute(C)),f.addEventListener(x,L,q);break e}C in f?f[C]=L:L===!0?f.setAttribute(C,""):Ar(f,C,L)}}}function Ma(f,x,C){switch(x){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ur("error",f),Ur("load",f);var L=!1,q=!1,te;for(te in C)if(C.hasOwnProperty(te)){var we=C[te];if(we!=null)switch(te){case"src":L=!0;break;case"srcSet":q=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(d(137,x));default:On(f,x,te,we,C,null)}}q&&On(f,x,"srcSet",C.srcSet,C,null),L&&On(f,x,"src",C.src,C,null);return;case"input":Ur("invalid",f);var $e=te=we=q=null,mt=null,Gt=null;for(L in C)if(C.hasOwnProperty(L)){var ni=C[L];if(ni!=null)switch(L){case"name":q=ni;break;case"type":we=ni;break;case"checked":mt=ni;break;case"defaultChecked":Gt=ni;break;case"value":te=ni;break;case"defaultValue":$e=ni;break;case"children":case"dangerouslySetInnerHTML":if(ni!=null)throw Error(d(137,x));break;default:On(f,x,L,ni,C,null)}}Zs(f,te,$e,mt,Gt,we,q,!1);return;case"select":Ur("invalid",f),L=we=te=null;for(q in C)if(C.hasOwnProperty(q)&&($e=C[q],$e!=null))switch(q){case"value":te=$e;break;case"defaultValue":we=$e;break;case"multiple":L=$e;default:On(f,x,q,$e,C,null)}x=te,C=we,f.multiple=!!L,x!=null?co(f,!!L,x,!1):C!=null&&co(f,!!L,C,!0);return;case"textarea":Ur("invalid",f),te=q=L=null;for(we in C)if(C.hasOwnProperty(we)&&($e=C[we],$e!=null))switch(we){case"value":L=$e;break;case"defaultValue":q=$e;break;case"children":te=$e;break;case"dangerouslySetInnerHTML":if($e!=null)throw Error(d(91));break;default:On(f,x,we,$e,C,null)}Du(f,L,q,te);return;case"option":for(mt in C)if(C.hasOwnProperty(mt)&&(L=C[mt],L!=null))switch(mt){case"selected":f.selected=L&&typeof L!="function"&&typeof L!="symbol";break;default:On(f,x,mt,L,C,null)}return;case"dialog":Ur("beforetoggle",f),Ur("toggle",f),Ur("cancel",f),Ur("close",f);break;case"iframe":case"object":Ur("load",f);break;case"video":case"audio":for(L=0;L<Th.length;L++)Ur(Th[L],f);break;case"image":Ur("error",f),Ur("load",f);break;case"details":Ur("toggle",f);break;case"embed":case"source":case"link":Ur("error",f),Ur("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Gt in C)if(C.hasOwnProperty(Gt)&&(L=C[Gt],L!=null))switch(Gt){case"children":case"dangerouslySetInnerHTML":throw Error(d(137,x));default:On(f,x,Gt,L,C,null)}return;default:if(Fh(x)){for(ni in C)C.hasOwnProperty(ni)&&(L=C[ni],L!==void 0&&Gg(f,x,ni,L,C,void 0));return}}for($e in C)C.hasOwnProperty($e)&&(L=C[$e],L!=null&&On(f,x,$e,L,C,null))}function Qy(f,x,C,L){switch(x){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var q=null,te=null,we=null,$e=null,mt=null,Gt=null,ni=null;for(Jt in C){var di=C[Jt];if(C.hasOwnProperty(Jt)&&di!=null)switch(Jt){case"checked":break;case"value":break;case"defaultValue":mt=di;default:L.hasOwnProperty(Jt)||On(f,x,Jt,null,L,di)}}for(var Ht in L){var Jt=L[Ht];if(di=C[Ht],L.hasOwnProperty(Ht)&&(Jt!=null||di!=null))switch(Ht){case"type":te=Jt;break;case"name":q=Jt;break;case"checked":Gt=Jt;break;case"defaultChecked":ni=Jt;break;case"value":we=Jt;break;case"defaultValue":$e=Jt;break;case"children":case"dangerouslySetInnerHTML":if(Jt!=null)throw Error(d(137,x));break;default:Jt!==di&&On(f,x,Ht,Jt,L,di)}}oa(f,we,$e,mt,Gt,ni,te,q);return;case"select":Jt=we=$e=Ht=null;for(te in C)if(mt=C[te],C.hasOwnProperty(te)&&mt!=null)switch(te){case"value":break;case"multiple":Jt=mt;default:L.hasOwnProperty(te)||On(f,x,te,null,L,mt)}for(q in L)if(te=L[q],mt=C[q],L.hasOwnProperty(q)&&(te!=null||mt!=null))switch(q){case"value":Ht=te;break;case"defaultValue":$e=te;break;case"multiple":we=te;default:te!==mt&&On(f,x,q,te,L,mt)}x=$e,C=we,L=Jt,Ht!=null?co(f,!!C,Ht,!1):!!L!=!!C&&(x!=null?co(f,!!C,x,!0):co(f,!!C,C?[]:"",!1));return;case"textarea":Jt=Ht=null;for($e in C)if(q=C[$e],C.hasOwnProperty($e)&&q!=null&&!L.hasOwnProperty($e))switch($e){case"value":break;case"children":break;default:On(f,x,$e,null,L,q)}for(we in L)if(q=L[we],te=C[we],L.hasOwnProperty(we)&&(q!=null||te!=null))switch(we){case"value":Ht=q;break;case"defaultValue":Jt=q;break;case"children":break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(d(91));break;default:q!==te&&On(f,x,we,q,L,te)}ka(f,Ht,Jt);return;case"option":for(var Hi in C)if(Ht=C[Hi],C.hasOwnProperty(Hi)&&Ht!=null&&!L.hasOwnProperty(Hi))switch(Hi){case"selected":f.selected=!1;break;default:On(f,x,Hi,null,L,Ht)}for(mt in L)if(Ht=L[mt],Jt=C[mt],L.hasOwnProperty(mt)&&Ht!==Jt&&(Ht!=null||Jt!=null))switch(mt){case"selected":f.selected=Ht&&typeof Ht!="function"&&typeof Ht!="symbol";break;default:On(f,x,mt,Ht,L,Jt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ir in C)Ht=C[ir],C.hasOwnProperty(ir)&&Ht!=null&&!L.hasOwnProperty(ir)&&On(f,x,ir,null,L,Ht);for(Gt in L)if(Ht=L[Gt],Jt=C[Gt],L.hasOwnProperty(Gt)&&Ht!==Jt&&(Ht!=null||Jt!=null))switch(Gt){case"children":case"dangerouslySetInnerHTML":if(Ht!=null)throw Error(d(137,x));break;default:On(f,x,Gt,Ht,L,Jt)}return;default:if(Fh(x)){for(var xn in C)Ht=C[xn],C.hasOwnProperty(xn)&&Ht!==void 0&&!L.hasOwnProperty(xn)&&Gg(f,x,xn,void 0,L,Ht);for(ni in L)Ht=L[ni],Jt=C[ni],!L.hasOwnProperty(ni)||Ht===Jt||Ht===void 0&&Jt===void 0||Gg(f,x,ni,Ht,L,Jt);return}}for(var Dt in C)Ht=C[Dt],C.hasOwnProperty(Dt)&&Ht!=null&&!L.hasOwnProperty(Dt)&&On(f,x,Dt,null,L,Ht);for(di in L)Ht=L[di],Jt=C[di],!L.hasOwnProperty(di)||Ht===Jt||Ht==null&&Jt==null||On(f,x,di,Ht,L,Jt)}function $g(f){switch(f){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jy(){if(typeof performance.getEntriesByType=="function"){for(var f=0,x=0,C=performance.getEntriesByType("resource"),L=0;L<C.length;L++){var q=C[L],te=q.transferSize,we=q.initiatorType,$e=q.duration;if(te&&$e&&$g(we)){for(we=0,$e=q.responseEnd,L+=1;L<C.length;L++){var mt=C[L],Gt=mt.startTime;if(Gt>$e)break;var ni=mt.transferSize,di=mt.initiatorType;ni&&$g(di)&&(mt=mt.responseEnd,we+=ni*(mt<$e?1:($e-Gt)/(mt-Gt)))}if(--L,x+=8*(te+we)/(q.duration/1e3),f++,10<f)break}}if(0<f)return x/f/1e6}return navigator.connection&&(f=navigator.connection.downlink,typeof f=="number")?f:5}var Ym=null,Km=null;function Kp(f){return f.nodeType===9?f:f.ownerDocument}function Hg(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qm(f,x){if(f===0)switch(x){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&x==="foreignObject"?0:f}function Ic(f,x){return f==="textarea"||f==="noscript"||typeof x.children=="string"||typeof x.children=="number"||typeof x.children=="bigint"||typeof x.dangerouslySetInnerHTML=="object"&&x.dangerouslySetInnerHTML!==null&&x.dangerouslySetInnerHTML.__html!=null}var Ss=null;function e_(){var f=window.event;return f&&f.type==="popstate"?f===Ss?!1:(Ss=f,!0):(Ss=null,!1)}var Lf=typeof setTimeout=="function"?setTimeout:void 0,l0=typeof clearTimeout=="function"?clearTimeout:void 0,t_=typeof Promise=="function"?Promise:void 0,c0=typeof queueMicrotask=="function"?queueMicrotask:typeof t_<"u"?function(f){return t_.resolve(null).then(f).catch(u0)}:Lf;function u0(f){setTimeout(function(){throw f})}function Yo(f){return f==="head"}function qg(f,x){var C=x,L=0;do{var q=C.nextSibling;if(f.removeChild(C),q&&q.nodeType===8)if(C=q.data,C==="/$"||C==="/&"){if(L===0){f.removeChild(q),Vf(x);return}L--}else if(C==="$"||C==="$?"||C==="$~"||C==="$!"||C==="&")L++;else if(C==="html")Jp(f.ownerDocument.documentElement);else if(C==="head"){C=f.ownerDocument.head,Jp(C);for(var te=C.firstChild;te;){var we=te.nextSibling,$e=te.nodeName;te[It]||$e==="SCRIPT"||$e==="STYLE"||$e==="LINK"&&te.rel.toLowerCase()==="stylesheet"||C.removeChild(te),te=we}}else C==="body"&&Jp(f.ownerDocument.body);C=q}while(C);Vf(x)}function Ah(f,x){var C=f;f=0;do{var L=C.nextSibling;if(C.nodeType===1?x?(C._stashedDisplay=C.style.display,C.style.display="none"):(C.style.display=C._stashedDisplay||"",C.getAttribute("style")===""&&C.removeAttribute("style")):C.nodeType===3&&(x?(C._stashedText=C.nodeValue,C.nodeValue=""):C.nodeValue=C._stashedText||""),L&&L.nodeType===8)if(C=L.data,C==="/$"){if(f===0)break;f--}else C!=="$"&&C!=="$?"&&C!=="$~"&&C!=="$!"||f++;C=L}while(C)}function Pd(f){var x=f.firstChild;for(x&&x.nodeType===10&&(x=x.nextSibling);x;){var C=x;switch(x=x.nextSibling,C.nodeName){case"HTML":case"HEAD":case"BODY":Pd(C),ii(C);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(C.rel.toLowerCase()==="stylesheet")continue}f.removeChild(C)}}function h0(f,x,C,L){for(;f.nodeType===1;){var q=C;if(f.nodeName.toLowerCase()!==x.toLowerCase()){if(!L&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(L){if(!f[It])switch(x){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(te=f.getAttribute("rel"),te==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(te!==q.rel||f.getAttribute("href")!==(q.href==null||q.href===""?null:q.href)||f.getAttribute("crossorigin")!==(q.crossOrigin==null?null:q.crossOrigin)||f.getAttribute("title")!==(q.title==null?null:q.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(te=f.getAttribute("src"),(te!==(q.src==null?null:q.src)||f.getAttribute("type")!==(q.type==null?null:q.type)||f.getAttribute("crossorigin")!==(q.crossOrigin==null?null:q.crossOrigin))&&te&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(x==="input"&&f.type==="hidden"){var te=q.name==null?null:""+q.name;if(q.type==="hidden"&&f.getAttribute("name")===te)return f}else return f;if(f=El(f.nextSibling),f===null)break}return null}function d0(f,x,C){if(x==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!C||(f=El(f.nextSibling),f===null))return null;return f}function i_(f,x){for(;f.nodeType!==8;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!x||(f=El(f.nextSibling),f===null))return null;return f}function Wg(f){return f.data==="$?"||f.data==="$~"}function Zg(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState!=="loading"}function f0(f,x){var C=f.ownerDocument;if(f.data==="$~")f._reactRetry=x;else if(f.data!=="$?"||C.readyState!=="loading")x();else{var L=function(){x(),C.removeEventListener("DOMContentLoaded",L)};C.addEventListener("DOMContentLoaded",L),f._reactRetry=L}}function El(f){for(;f!=null;f=f.nextSibling){var x=f.nodeType;if(x===1||x===3)break;if(x===8){if(x=f.data,x==="$"||x==="$!"||x==="$?"||x==="$~"||x==="&"||x==="F!"||x==="F")break;if(x==="/$"||x==="/&")return null}}return f}var Qp=null;function r_(f){f=f.nextSibling;for(var x=0;f;){if(f.nodeType===8){var C=f.data;if(C==="/$"||C==="/&"){if(x===0)return El(f.nextSibling);x--}else C!=="$"&&C!=="$!"&&C!=="$?"&&C!=="$~"&&C!=="&"||x++}f=f.nextSibling}return null}function Xg(f){f=f.previousSibling;for(var x=0;f;){if(f.nodeType===8){var C=f.data;if(C==="$"||C==="$!"||C==="$?"||C==="$~"||C==="&"){if(x===0)return f;x--}else C!=="/$"&&C!=="/&"||x++}f=f.previousSibling}return null}function Of(f,x,C){switch(x=Kp(C),f){case"html":if(f=x.documentElement,!f)throw Error(d(452));return f;case"head":if(f=x.head,!f)throw Error(d(453));return f;case"body":if(f=x.body,!f)throw Error(d(454));return f;default:throw Error(d(451))}}function Jp(f){for(var x=f.attributes;x.length;)f.removeAttributeNode(x[0]);ii(f)}var rn=new Map,Id=new Set;function em(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var Sl=Fe.d;Fe.d={f:Jm,r:tm,D:im,C:Kg,L:rm,m:p0,X:Qg,S:n_,M:Jg};function Jm(){var f=Sl.f(),x=Lr();return f||x}function tm(f){var x=wi(f);x!==null&&x.tag===5&&x.type==="form"?Dp(x):Sl.r(f)}var Dd=typeof document>"u"?null:document;function Yg(f,x,C){var L=Dd;if(L&&typeof x=="string"&&x){var q=ts(x);q='link[rel="'+f+'"][href="'+q+'"]',typeof C=="string"&&(q+='[crossorigin="'+C+'"]'),Id.has(q)||(Id.add(q),f={rel:f,crossOrigin:C,href:x},L.querySelector(q)===null&&(x=L.createElement("link"),Ma(x,"link",f),xi(x),L.head.appendChild(x)))}}function im(f){Sl.D(f),Yg("dns-prefetch",f,null)}function Kg(f,x){Sl.C(f,x),Yg("preconnect",f,x)}function rm(f,x,C){Sl.L(f,x,C);var L=Dd;if(L&&f&&x){var q='link[rel="preload"][as="'+ts(x)+'"]';x==="image"&&C&&C.imageSrcSet?(q+='[imagesrcset="'+ts(C.imageSrcSet)+'"]',typeof C.imageSizes=="string"&&(q+='[imagesizes="'+ts(C.imageSizes)+'"]')):q+='[href="'+ts(f)+'"]';var te=q;switch(x){case"style":te=zf(f);break;case"script":te=Ch(f)}rn.has(te)||(f=V({rel:"preload",href:x==="image"&&C&&C.imageSrcSet?void 0:f,as:x},C),rn.set(te,f),L.querySelector(q)!==null||x==="style"&&L.querySelector(ra(te))||x==="script"&&L.querySelector(kd(te))||(x=L.createElement("link"),Ma(x,"link",f),xi(x),L.head.appendChild(x)))}}function p0(f,x){Sl.m(f,x);var C=Dd;if(C&&f){var L=x&&typeof x.as=="string"?x.as:"script",q='link[rel="modulepreload"][as="'+ts(L)+'"][href="'+ts(f)+'"]',te=q;switch(L){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":te=Ch(f)}if(!rn.has(te)&&(f=V({rel:"modulepreload",href:f},x),rn.set(te,f),C.querySelector(q)===null)){switch(L){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(C.querySelector(kd(te)))return}L=C.createElement("link"),Ma(L,"link",f),xi(L),C.head.appendChild(L)}}}function n_(f,x,C){Sl.S(f,x,C);var L=Dd;if(L&&f){var q=Vi(L).hoistableStyles,te=zf(f);x=x||"default";var we=q.get(te);if(!we){var $e={loading:0,preload:null};if(we=L.querySelector(ra(te)))$e.loading=5;else{f=V({rel:"stylesheet",href:f,"data-precedence":x},C),(C=rn.get(te))&&iy(f,C);var mt=we=L.createElement("link");xi(mt),Ma(mt,"link",f),mt._p=new Promise(function(Gt,ni){mt.onload=Gt,mt.onerror=ni}),mt.addEventListener("load",function(){$e.loading|=1}),mt.addEventListener("error",function(){$e.loading|=2}),$e.loading|=4,na(we,x,L)}we={type:"stylesheet",instance:we,count:1,state:$e},q.set(te,we)}}}function Qg(f,x){Sl.X(f,x);var C=Dd;if(C&&f){var L=Vi(C).hoistableScripts,q=Ch(f),te=L.get(q);te||(te=C.querySelector(kd(q)),te||(f=V({src:f,async:!0},x),(x=rn.get(q))&&sm(f,x),te=C.createElement("script"),xi(te),Ma(te,"link",f),C.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},L.set(q,te))}}function Jg(f,x){Sl.M(f,x);var C=Dd;if(C&&f){var L=Vi(C).hoistableScripts,q=Ch(f),te=L.get(q);te||(te=C.querySelector(kd(q)),te||(f=V({src:f,async:!0,type:"module"},x),(x=rn.get(q))&&sm(f,x),te=C.createElement("script"),xi(te),Ma(te,"link",f),C.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},L.set(q,te))}}function Dc(f,x,C,L){var q=(q=mi.current)?em(q):null;if(!q)throw Error(d(446));switch(f){case"meta":case"title":return null;case"style":return typeof C.precedence=="string"&&typeof C.href=="string"?(x=zf(C.href),C=Vi(q).hoistableStyles,L=C.get(x),L||(L={type:"style",instance:null,count:0,state:null},C.set(x,L)),L):{type:"void",instance:null,count:0,state:null};case"link":if(C.rel==="stylesheet"&&typeof C.href=="string"&&typeof C.precedence=="string"){f=zf(C.href);var te=Vi(q).hoistableStyles,we=te.get(f);if(we||(q=q.ownerDocument||q,we={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},te.set(f,we),(te=q.querySelector(ra(f)))&&!te._p&&(we.instance=te,we.state.loading=5),rn.has(f)||(C={rel:"preload",as:"style",href:C.href,crossOrigin:C.crossOrigin,integrity:C.integrity,media:C.media,hrefLang:C.hrefLang,referrerPolicy:C.referrerPolicy},rn.set(f,C),te||ey(q,f,C,we.state))),x&&L===null)throw Error(d(528,""));return we}if(x&&L!==null)throw Error(d(529,""));return null;case"script":return x=C.async,C=C.src,typeof C=="string"&&x&&typeof x!="function"&&typeof x!="symbol"?(x=Ch(C),C=Vi(q).hoistableScripts,L=C.get(x),L||(L={type:"script",instance:null,count:0,state:null},C.set(x,L)),L):{type:"void",instance:null,count:0,state:null};default:throw Error(d(444,f))}}function zf(f){return'href="'+ts(f)+'"'}function ra(f){return'link[rel="stylesheet"]['+f+"]"}function s_(f){return V({},f,{"data-precedence":f.precedence,precedence:null})}function ey(f,x,C,L){f.querySelector('link[rel="preload"][as="style"]['+x+"]")?L.loading=1:(x=f.createElement("link"),L.preload=x,x.addEventListener("load",function(){return L.loading|=1}),x.addEventListener("error",function(){return L.loading|=2}),Ma(x,"link",C),xi(x),f.head.appendChild(x))}function Ch(f){return'[src="'+ts(f)+'"]'}function kd(f){return"script[async]"+f}function ty(f,x,C){if(x.count++,x.instance===null)switch(x.type){case"style":var L=f.querySelector('style[data-href~="'+ts(C.href)+'"]');if(L)return x.instance=L,xi(L),L;var q=V({},C,{"data-href":C.href,"data-precedence":C.precedence,href:null,precedence:null});return L=(f.ownerDocument||f).createElement("style"),xi(L),Ma(L,"style",q),na(L,C.precedence,f),x.instance=L;case"stylesheet":q=zf(C.href);var te=f.querySelector(ra(q));if(te)return x.state.loading|=4,x.instance=te,xi(te),te;L=s_(C),(q=rn.get(q))&&iy(L,q),te=(f.ownerDocument||f).createElement("link"),xi(te);var we=te;return we._p=new Promise(function($e,mt){we.onload=$e,we.onerror=mt}),Ma(te,"link",L),x.state.loading|=4,na(te,C.precedence,f),x.instance=te;case"script":return te=Ch(C.src),(q=f.querySelector(kd(te)))?(x.instance=q,xi(q),q):(L=C,(q=rn.get(te))&&(L=V({},C),sm(L,q)),f=f.ownerDocument||f,q=f.createElement("script"),xi(q),Ma(q,"link",L),f.head.appendChild(q),x.instance=q);case"void":return null;default:throw Error(d(443,x.type))}else x.type==="stylesheet"&&(x.state.loading&4)===0&&(L=x.instance,x.state.loading|=4,na(L,C.precedence,f));return x.instance}function na(f,x,C){for(var L=C.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),q=L.length?L[L.length-1]:null,te=q,we=0;we<L.length;we++){var $e=L[we];if($e.dataset.precedence===x)te=$e;else if(te!==q)break}te?te.parentNode.insertBefore(f,te.nextSibling):(x=C.nodeType===9?C.head:C,x.insertBefore(f,x.firstChild))}function iy(f,x){f.crossOrigin==null&&(f.crossOrigin=x.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=x.referrerPolicy),f.title==null&&(f.title=x.title)}function sm(f,x){f.crossOrigin==null&&(f.crossOrigin=x.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=x.referrerPolicy),f.integrity==null&&(f.integrity=x.integrity)}var Rh=null;function Ld(f,x,C){if(Rh===null){var L=new Map,q=Rh=new Map;q.set(C,L)}else q=Rh,L=q.get(C),L||(L=new Map,q.set(C,L));if(L.has(f))return L;for(L.set(f,null),C=C.getElementsByTagName(f),q=0;q<C.length;q++){var te=C[q];if(!(te[It]||te[qe]||f==="link"&&te.getAttribute("rel")==="stylesheet")&&te.namespaceURI!=="http://www.w3.org/2000/svg"){var we=te.getAttribute(x)||"";we=f+we;var $e=L.get(we);$e?$e.push(te):L.set(we,[te])}}return L}function ry(f,x,C){f=f.ownerDocument||f,f.head.insertBefore(C,x==="title"?f.querySelector("head > title"):null)}function a_(f,x,C){if(C===1||x.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof x.precedence!="string"||typeof x.href!="string"||x.href==="")break;return!0;case"link":if(typeof x.rel!="string"||typeof x.href!="string"||x.href===""||x.onLoad||x.onError)break;switch(x.rel){case"stylesheet":return f=x.disabled,typeof x.precedence=="string"&&f==null;default:return!0}case"script":if(x.async&&typeof x.async!="function"&&typeof x.async!="symbol"&&!x.onLoad&&!x.onError&&x.src&&typeof x.src=="string")return!0}return!1}function ny(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}function no(f,x,C,L){if(C.type==="stylesheet"&&(typeof L.media!="string"||matchMedia(L.media).matches!==!1)&&(C.state.loading&4)===0){if(C.instance===null){var q=zf(L.href),te=x.querySelector(ra(q));if(te){x=te._p,x!==null&&typeof x=="object"&&typeof x.then=="function"&&(f.count++,f=Eu.bind(f),x.then(f,f)),C.state.loading|=4,C.instance=te,xi(te);return}te=x.ownerDocument||x,L=s_(L),(q=rn.get(q))&&iy(L,q),te=te.createElement("link"),xi(te);var we=te;we._p=new Promise(function($e,mt){we.onload=$e,we.onerror=mt}),Ma(te,"link",L),C.instance=te}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(C,x),(x=C.state.preload)&&(C.state.loading&3)===0&&(f.count++,C=Eu.bind(f),x.addEventListener("load",C),x.addEventListener("error",C))}}var Od=0;function o_(f,x){return f.stylesheets&&f.count===0&&Ff(f,f.stylesheets),0<f.count||0<f.imgCount?function(C){var L=setTimeout(function(){if(f.stylesheets&&Ff(f,f.stylesheets),f.unsuspend){var te=f.unsuspend;f.unsuspend=null,te()}},6e4+x);0<f.imgBytes&&Od===0&&(Od=62500*Jy());var q=setTimeout(function(){if(f.waitingForImages=!1,f.count===0&&(f.stylesheets&&Ff(f,f.stylesheets),f.unsuspend)){var te=f.unsuspend;f.unsuspend=null,te()}},(f.imgBytes>Od?50:800)+x);return f.unsuspend=C,function(){f.unsuspend=null,clearTimeout(L),clearTimeout(q)}}:null}function Eu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ff(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var Ko=null;function Ff(f,x){f.stylesheets=null,f.unsuspend!==null&&(f.count++,Ko=new Map,x.forEach(Mh,f),Ko=null,Eu.call(f))}function Mh(f,x){if(!(x.state.loading&4)){var C=Ko.get(f);if(C)var L=C.get(null);else{C=new Map,Ko.set(f,C);for(var q=f.querySelectorAll("link[data-precedence],style[data-precedence]"),te=0;te<q.length;te++){var we=q[te];(we.nodeName==="LINK"||we.getAttribute("media")!=="not all")&&(C.set(we.dataset.precedence,we),L=we)}L&&C.set(null,L)}q=x.instance,we=q.getAttribute("data-precedence"),te=C.get(we)||L,te===L&&C.set(null,q),C.set(we,q),this.count++,L=Eu.bind(this),q.addEventListener("load",L),q.addEventListener("error",L),te?te.parentNode.insertBefore(q,te.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(q,f.firstChild)),x.state.loading|=4}}var Tl={$$typeof:Q,Provider:null,Consumer:null,_currentValue:pe,_currentValue2:pe,_threadCount:0};function eg(f,x,C,L,q,te,we,$e,mt){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tl(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tl(0),this.hiddenUpdates=tl(null),this.identifierPrefix=L,this.onUncaughtError=q,this.onCaughtError=te,this.onRecoverableError=we,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=mt,this.incompleteTransitions=new Map}function tg(f,x,C,L,q,te,we,$e,mt,Gt,ni,di){return f=new eg(f,x,C,we,mt,Gt,ni,di,$e),x=1,te===!0&&(x|=24),te=wa(3,null,null,x),f.current=te,te.stateNode=f,x=Yu(),x.refCount++,f.pooledCache=x,x.refCount++,te.memoizedState={element:L,isDehydrated:C,cache:x},od(te),f}function ig(f){return f?(f=ol,f):ol}function l_(f,x,C,L,q,te){q=ig(q),L.context===null?L.context=q:L.pendingContext=q,L=pl(x),L.payload={element:C},te=te===void 0?null:te,te!==null&&(L.callback=te),C=Hl(f,L,x),C!==null&&(Oi(C,f,x),eu(C,f,x))}function c_(f,x){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var C=f.retryLane;f.retryLane=C!==0&&C<x?C:x}}function sy(f,x){c_(f,x),(f=f.alternate)&&c_(f,x)}function u_(f){if(f.tag===13||f.tag===31){var x=$t(f,67108864);x!==null&&Oi(x,f,67108864),sy(f,67108864)}}function ay(f){if(f.tag===13||f.tag===31){var x=br();x=tr(x);var C=$t(f,x);C!==null&&Oi(C,f,x),sy(f,x)}}var am=!0;function rg(f,x,C,L){var q=xe.T;xe.T=null;var te=Fe.p;try{Fe.p=2,Bf(f,x,C,L)}finally{Fe.p=te,xe.T=q}}function h_(f,x,C,L){var q=xe.T;xe.T=null;var te=Fe.p;try{Fe.p=8,Bf(f,x,C,L)}finally{Fe.p=te,xe.T=q}}function Bf(f,x,C,L){if(am){var q=ng(L);if(q===null)Xm(f,x,L,zd,C),lm(f,L);else if(p_(q,f,x,C,L))L.stopPropagation();else if(lm(f,L),x&4&&-1<f_.indexOf(f)){for(;q!==null;){var te=wi(q);if(te!==null)switch(te.tag){case 3:if(te=te.stateNode,te.current.memoizedState.isDehydrated){var we=Tr(te.pendingLanes);if(we!==0){var $e=te;for($e.pendingLanes|=2,$e.entangledLanes|=2;we;){var mt=1<<31-$n(we);$e.entanglements[1]|=mt,we&=~mt}Mc(te),(Xe&6)===0&&(Fi=Dr()+500,Sh(0))}}break;case 31:case 13:$e=$t(te,2),$e!==null&&Oi($e,te,2),Lr(),sy(te,2)}if(te=ng(L),te===null&&Xm(f,x,L,zd,C),te===q)break;q=te}q!==null&&L.stopPropagation()}else Xm(f,x,L,null,C)}}function ng(f){return f=sc(f),oy(f)}var zd=null;function oy(f){if(zd=null,f=yi(f),f!==null){var x=S(f);if(x===null)f=null;else{var C=x.tag;if(C===13){if(f=R(x),f!==null)return f;f=null}else if(C===31){if(f=a(x),f!==null)return f;f=null}else if(C===3){if(x.stateNode.current.memoizedState.isDehydrated)return x.tag===3?x.stateNode.containerInfo:null;f=null}else x!==f&&(f=null)}}return zd=f,null}function d_(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(jn()){case Rn:return 2;case ys:return 8;case As:case sa:return 32;case bn:return 268435456;default:return 32}default:return 32}}var om=!1,Su=null,kc=null,Lc=null,jf=new Map,Nf=new Map,Tu=[],f_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lm(f,x){switch(f){case"focusin":case"focusout":Su=null;break;case"dragenter":case"dragleave":kc=null;break;case"mouseover":case"mouseout":Lc=null;break;case"pointerover":case"pointerout":jf.delete(x.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nf.delete(x.pointerId)}}function wo(f,x,C,L,q,te){return f===null||f.nativeEvent!==te?(f={blockedOn:x,domEventName:C,eventSystemFlags:L,nativeEvent:te,targetContainers:[q]},x!==null&&(x=wi(x),x!==null&&u_(x)),f):(f.eventSystemFlags|=L,x=f.targetContainers,q!==null&&x.indexOf(q)===-1&&x.push(q),f)}function p_(f,x,C,L,q){switch(x){case"focusin":return Su=wo(Su,f,x,C,L,q),!0;case"dragenter":return kc=wo(kc,f,x,C,L,q),!0;case"mouseover":return Lc=wo(Lc,f,x,C,L,q),!0;case"pointerover":var te=q.pointerId;return jf.set(te,wo(jf.get(te)||null,f,x,C,L,q)),!0;case"gotpointercapture":return te=q.pointerId,Nf.set(te,wo(Nf.get(te)||null,f,x,C,L,q)),!0}return!1}function m_(f){var x=yi(f.target);if(x!==null){var C=S(x);if(C!==null){if(x=C.tag,x===13){if(x=R(C),x!==null){f.blockedOn=x,ve(f.priority,function(){ay(C)});return}}else if(x===31){if(x=a(C),x!==null){f.blockedOn=x,ve(f.priority,function(){ay(C)});return}}else if(x===3&&C.stateNode.current.memoizedState.isDehydrated){f.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}f.blockedOn=null}function sg(f){if(f.blockedOn!==null)return!1;for(var x=f.targetContainers;0<x.length;){var C=ng(f.nativeEvent);if(C===null){C=f.nativeEvent;var L=new C.constructor(C.type,C);ho=L,C.target.dispatchEvent(L),ho=null}else return x=wi(C),x!==null&&u_(x),f.blockedOn=C,!1;x.shift()}return!0}function g_(f,x,C){sg(f)&&C.delete(x)}function m0(){om=!1,Su!==null&&sg(Su)&&(Su=null),kc!==null&&sg(kc)&&(kc=null),Lc!==null&&sg(Lc)&&(Lc=null),jf.forEach(g_),Nf.forEach(g_)}function ag(f,x){f.blockedOn===x&&(f.blockedOn=null,om||(om=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,m0)))}var og=null;function y_(f){og!==f&&(og=f,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){og===f&&(og=null);for(var x=0;x<f.length;x+=3){var C=f[x],L=f[x+1],q=f[x+2];if(typeof L!="function"){if(oy(L||C)===null)continue;break}var te=wi(C);te!==null&&(f.splice(x,3),x-=3,md(te,{pending:!0,data:q,method:C.method,action:L},L,q))}}))}function Vf(f){function x(mt){return ag(mt,f)}Su!==null&&ag(Su,f),kc!==null&&ag(kc,f),Lc!==null&&ag(Lc,f),jf.forEach(x),Nf.forEach(x);for(var C=0;C<Tu.length;C++){var L=Tu[C];L.blockedOn===f&&(L.blockedOn=null)}for(;0<Tu.length&&(C=Tu[0],C.blockedOn===null);)m_(C),C.blockedOn===null&&Tu.shift();if(C=(f.ownerDocument||f).$$reactFormReplay,C!=null)for(L=0;L<C.length;L+=3){var q=C[L],te=C[L+1],we=q[Oe]||null;if(typeof te=="function")we||y_(C);else if(we){var $e=null;if(te&&te.hasAttribute("formAction")){if(q=te,we=te[Oe]||null)$e=we.formAction;else if(oy(q)!==null)continue}else $e=we.action;typeof $e=="function"?C[L+1]=$e:(C.splice(L,3),L-=3),y_(C)}}}function Uf(){function f(te){te.canIntercept&&te.info==="react-transition"&&te.intercept({handler:function(){return new Promise(function(we){return q=we})},focusReset:"manual",scroll:"manual"})}function x(){q!==null&&(q(),q=null),L||setTimeout(C,20)}function C(){if(!L&&!navigation.transition){var te=navigation.currentEntry;te&&te.url!=null&&navigation.navigate(te.url,{state:te.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var L=!1,q=null;return navigation.addEventListener("navigate",f),navigation.addEventListener("navigatesuccess",x),navigation.addEventListener("navigateerror",x),setTimeout(C,100),function(){L=!0,navigation.removeEventListener("navigate",f),navigation.removeEventListener("navigatesuccess",x),navigation.removeEventListener("navigateerror",x),q!==null&&(q(),q=null)}}}function ly(f){this._internalRoot=f}cm.prototype.render=ly.prototype.render=function(f){var x=this._internalRoot;if(x===null)throw Error(d(409));var C=x.current,L=br();l_(C,L,f,x,null,null)},cm.prototype.unmount=ly.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var x=f.containerInfo;l_(f.current,2,null,f,null,null),Lr(),x[Ke]=null}};function cm(f){this._internalRoot=f}cm.prototype.unstable_scheduleHydration=function(f){if(f){var x=me();f={blockedOn:null,target:f,priority:x};for(var C=0;C<Tu.length&&x!==0&&x<Tu[C].priority;C++);Tu.splice(C,0,f),C===0&&m_(f)}};var um=s.version;if(um!=="19.2.4")throw Error(d(527,um,"19.2.4"));Fe.findDOMNode=function(f){var x=f._reactInternals;if(x===void 0)throw typeof f.render=="function"?Error(d(188)):(f=Object.keys(f).join(","),Error(d(268,f)));return f=O(x),f=f!==null?j(f):null,f=f===null?null:f.stateNode,f};var __={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:xe,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gf.isDisabled&&Gf.supportsFiber)try{Co=Gf.inject(__),Zn=Gf}catch{}}return reactDomClient_production.createRoot=function(f,x){if(!_(f))throw Error(d(299));var C=!1,L="",q=$m,te=Nr,we=Xi;return x!=null&&(x.unstable_strictMode===!0&&(C=!0),x.identifierPrefix!==void 0&&(L=x.identifierPrefix),x.onUncaughtError!==void 0&&(q=x.onUncaughtError),x.onCaughtError!==void 0&&(te=x.onCaughtError),x.onRecoverableError!==void 0&&(we=x.onRecoverableError)),x=tg(f,1,!1,null,null,C,L,null,q,te,we,Uf),f[Ke]=x.current,Zm(f),new ly(x)},reactDomClient_production.hydrateRoot=function(f,x,C){if(!_(f))throw Error(d(299));var L=!1,q="",te=$m,we=Nr,$e=Xi,mt=null;return C!=null&&(C.unstable_strictMode===!0&&(L=!0),C.identifierPrefix!==void 0&&(q=C.identifierPrefix),C.onUncaughtError!==void 0&&(te=C.onUncaughtError),C.onCaughtError!==void 0&&(we=C.onCaughtError),C.onRecoverableError!==void 0&&($e=C.onRecoverableError),C.formState!==void 0&&(mt=C.formState)),x=tg(f,1,!0,x,C??null,L,q,mt,te,we,$e,Uf),x.context=ig(null),C=x.current,L=br(),L=tr(L),q=pl(L),q.callback=null,Hl(C,q,L),C=L,x.current.lanes=C,An(x,C),Mc(x),f[Ke]=x.current,Zm(f),new cm(x)},reactDomClient_production.version="19.2.4",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient(),Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},defaultTimeoutProvider={setTimeout:(t,s)=>setTimeout(t,s),clearTimeout:t=>clearTimeout(t),setInterval:(t,s)=>setInterval(t,s),clearInterval:t=>clearInterval(t)},Kf,Tx,zb,TimeoutManager=(zb=class{constructor(){hn(this,Kf,defaultTimeoutProvider);hn(this,Tx,!1)}setTimeoutProvider(t){Pr(this,Kf,t)}setTimeout(t,s){return ci(this,Kf).setTimeout(t,s)}clearTimeout(t){ci(this,Kf).clearTimeout(t)}setInterval(t,s){return ci(this,Kf).setInterval(t,s)}clearInterval(t){ci(this,Kf).clearInterval(t)}},Kf=new WeakMap,Tx=new WeakMap,zb),timeoutManager=new TimeoutManager;function systemSetTimeoutZero(t){setTimeout(t,0)}var isServer=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(t,s){return typeof t=="function"?t(s):t}function isValidTimeout(t){return typeof t=="number"&&t>=0&&t!==1/0}function timeUntilStale(t,s){return Math.max(t+(s||0)-Date.now(),0)}function resolveStaleTime(t,s){return typeof t=="function"?t(s):t}function resolveEnabled(t,s){return typeof t=="function"?t(s):t}function matchQuery(t,s){const{type:u="all",exact:d,fetchStatus:_,predicate:S,queryKey:R,stale:a}=t;if(R){if(d){if(s.queryHash!==hashQueryKeyByOptions(R,s.options))return!1}else if(!partialMatchKey(s.queryKey,R))return!1}if(u!=="all"){const k=s.isActive();if(u==="active"&&!k||u==="inactive"&&k)return!1}return!(typeof a=="boolean"&&s.isStale()!==a||_&&_!==s.state.fetchStatus||S&&!S(s))}function matchMutation(t,s){const{exact:u,status:d,predicate:_,mutationKey:S}=t;if(S){if(!s.options.mutationKey)return!1;if(u){if(hashKey(s.options.mutationKey)!==hashKey(S))return!1}else if(!partialMatchKey(s.options.mutationKey,S))return!1}return!(d&&s.state.status!==d||_&&!_(s))}function hashQueryKeyByOptions(t,s){return((s==null?void 0:s.queryKeyHashFn)||hashKey)(t)}function hashKey(t){return JSON.stringify(t,(s,u)=>isPlainObject(u)?Object.keys(u).sort().reduce((d,_)=>(d[_]=u[_],d),{}):u)}function partialMatchKey(t,s){return t===s?!0:typeof t!=typeof s?!1:t&&s&&typeof t=="object"&&typeof s=="object"?Object.keys(s).every(u=>partialMatchKey(t[u],s[u])):!1}var hasOwn=Object.prototype.hasOwnProperty;function replaceEqualDeep(t,s,u=0){if(t===s)return t;if(u>500)return s;const d=isPlainArray(t)&&isPlainArray(s);if(!d&&!(isPlainObject(t)&&isPlainObject(s)))return s;const S=(d?t:Object.keys(t)).length,R=d?s:Object.keys(s),a=R.length,k=d?new Array(a):{};let O=0;for(let j=0;j<a;j++){const V=d?j:R[j],G=t[V],J=s[V];if(G===J){k[V]=G,(d?j<S:hasOwn.call(t,V))&&O++;continue}if(G===null||J===null||typeof G!="object"||typeof J!="object"){k[V]=J;continue}const Z=replaceEqualDeep(G,J,u+1);k[V]=Z,Z===G&&O++}return S===a&&O===S?t:k}function isPlainArray(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function isPlainObject(t){if(!hasObjectPrototype(t))return!1;const s=t.constructor;if(s===void 0)return!0;const u=s.prototype;return!(!hasObjectPrototype(u)||!u.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function hasObjectPrototype(t){return Object.prototype.toString.call(t)==="[object Object]"}function sleep(t){return new Promise(s=>{timeoutManager.setTimeout(s,t)})}function replaceData(t,s,u){return typeof u.structuralSharing=="function"?u.structuralSharing(t,s):u.structuralSharing!==!1?replaceEqualDeep(t,s):s}function addToEnd(t,s,u=0){const d=[...t,s];return u&&d.length>u?d.slice(1):d}function addToStart(t,s,u=0){const d=[s,...t];return u&&d.length>u?d.slice(0,-1):d}var skipToken=Symbol();function ensureQueryFn(t,s){return!t.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!t.queryFn||t.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function addConsumeAwareSignal(t,s,u){let d=!1,_;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(_??(_=s()),d||(d=!0,_.aborted?u():_.addEventListener("abort",u,{once:!0})),_)}),t}var vm,Qf,Rg,Fb,FocusManager=(Fb=class extends Subscribable{constructor(){super();hn(this,vm);hn(this,Qf);hn(this,Rg);Pr(this,Rg,s=>{if(!isServer&&window.addEventListener){const u=()=>s();return window.addEventListener("visibilitychange",u,!1),()=>{window.removeEventListener("visibilitychange",u)}}})}onSubscribe(){ci(this,Qf)||this.setEventListener(ci(this,Rg))}onUnsubscribe(){var s;this.hasListeners()||((s=ci(this,Qf))==null||s.call(this),Pr(this,Qf,void 0))}setEventListener(s){var u;Pr(this,Rg,s),(u=ci(this,Qf))==null||u.call(this),Pr(this,Qf,s(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()}))}setFocused(s){ci(this,vm)!==s&&(Pr(this,vm,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(u=>{u(s)})}isFocused(){var s;return typeof ci(this,vm)=="boolean"?ci(this,vm):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},vm=new WeakMap,Qf=new WeakMap,Rg=new WeakMap,Fb),focusManager=new FocusManager;function pendingThenable(){let t,s;const u=new Promise((_,S)=>{t=_,s=S});u.status="pending",u.catch(()=>{});function d(_){Object.assign(u,_),delete u.resolve,delete u.reject}return u.resolve=_=>{d({status:"fulfilled",value:_}),t(_)},u.reject=_=>{d({status:"rejected",reason:_}),s(_)},u}var defaultScheduler=systemSetTimeoutZero;function createNotifyManager(){let t=[],s=0,u=a=>{a()},d=a=>{a()},_=defaultScheduler;const S=a=>{s?t.push(a):_(()=>{u(a)})},R=()=>{const a=t;t=[],a.length&&_(()=>{d(()=>{a.forEach(k=>{u(k)})})})};return{batch:a=>{let k;s++;try{k=a()}finally{s--,s||R()}return k},batchCalls:a=>(...k)=>{S(()=>{a(...k)})},schedule:S,setNotifyFunction:a=>{u=a},setBatchNotifyFunction:a=>{d=a},setScheduler:a=>{_=a}}}var notifyManager=createNotifyManager(),Mg,Jf,Pg,Bb,OnlineManager=(Bb=class extends Subscribable{constructor(){super();hn(this,Mg,!0);hn(this,Jf);hn(this,Pg);Pr(this,Pg,s=>{if(!isServer&&window.addEventListener){const u=()=>s(!0),d=()=>s(!1);return window.addEventListener("online",u,!1),window.addEventListener("offline",d,!1),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",d)}}})}onSubscribe(){ci(this,Jf)||this.setEventListener(ci(this,Pg))}onUnsubscribe(){var s;this.hasListeners()||((s=ci(this,Jf))==null||s.call(this),Pr(this,Jf,void 0))}setEventListener(s){var u;Pr(this,Pg,s),(u=ci(this,Jf))==null||u.call(this),Pr(this,Jf,s(this.setOnline.bind(this)))}setOnline(s){ci(this,Mg)!==s&&(Pr(this,Mg,s),this.listeners.forEach(d=>{d(s)}))}isOnline(){return ci(this,Mg)}},Mg=new WeakMap,Jf=new WeakMap,Pg=new WeakMap,Bb),onlineManager=new OnlineManager;function defaultRetryDelay(t){return Math.min(1e3*2**t,3e4)}function canFetch(t){return(t??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function createRetryer(t){let s=!1,u=0,d;const _=pendingThenable(),S=()=>_.status!=="pending",R=Y=>{var le;if(!S()){const ee=new CancelledError(Y);G(ee),(le=t.onCancel)==null||le.call(t,ee)}},a=()=>{s=!0},k=()=>{s=!1},O=()=>focusManager.isFocused()&&(t.networkMode==="always"||onlineManager.isOnline())&&t.canRun(),j=()=>canFetch(t.networkMode)&&t.canRun(),V=Y=>{S()||(d==null||d(),_.resolve(Y))},G=Y=>{S()||(d==null||d(),_.reject(Y))},J=()=>new Promise(Y=>{var le;d=ee=>{(S()||O())&&Y(ee)},(le=t.onPause)==null||le.call(t)}).then(()=>{var Y;d=void 0,S()||(Y=t.onContinue)==null||Y.call(t)}),Z=()=>{if(S())return;let Y;const le=u===0?t.initialPromise:void 0;try{Y=le??t.fn()}catch(ee){Y=Promise.reject(ee)}Promise.resolve(Y).then(V).catch(ee=>{var Se;if(S())return;const se=t.retry??(isServer?0:3),Q=t.retryDelay??defaultRetryDelay,oe=typeof Q=="function"?Q(u,ee):Q,_e=se===!0||typeof se=="number"&&u<se||typeof se=="function"&&se(u,ee);if(s||!_e){G(ee);return}u++,(Se=t.onFail)==null||Se.call(t,u,ee),sleep(oe).then(()=>O()?void 0:J()).then(()=>{s?G(ee):Z()})})};return{promise:_,status:()=>_.status,cancel:R,continue:()=>(d==null||d(),_),cancelRetry:a,continueRetry:k,canStart:j,start:()=>(j()?Z():J().then(Z),_)}}var bm,jb,Removable=(jb=class{constructor(){hn(this,bm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&Pr(this,bm,timeoutManager.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(isServer?1/0:300*1e3))}clearGcTimeout(){ci(this,bm)&&(timeoutManager.clearTimeout(ci(this,bm)),Pr(this,bm,void 0))}},bm=new WeakMap,jb),wm,Ig,Bc,Em,Ha,Ny,Sm,Pu,Nd,Nb,Query=(Nb=class extends Removable{constructor(s){super();hn(this,Pu);hn(this,wm);hn(this,Ig);hn(this,Bc);hn(this,Em);hn(this,Ha);hn(this,Ny);hn(this,Sm);Pr(this,Sm,!1),Pr(this,Ny,s.defaultOptions),this.setOptions(s.options),this.observers=[],Pr(this,Em,s.client),Pr(this,Bc,ci(this,Em).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,Pr(this,wm,getDefaultState$1(this.options)),this.state=s.state??ci(this,wm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=ci(this,Ha))==null?void 0:s.promise}setOptions(s){if(this.options={...ci(this,Ny),...s},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const u=getDefaultState$1(this.options);u.data!==void 0&&(this.setState(successState(u.data,u.dataUpdatedAt)),Pr(this,wm,u))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ci(this,Bc).remove(this)}setData(s,u){const d=replaceData(this.state.data,s,this.options);return To(this,Pu,Nd).call(this,{data:d,type:"success",dataUpdatedAt:u==null?void 0:u.updatedAt,manual:u==null?void 0:u.manual}),d}setState(s,u){To(this,Pu,Nd).call(this,{type:"setState",state:s,setStateOptions:u})}cancel(s){var d,_;const u=(d=ci(this,Ha))==null?void 0:d.promise;return(_=ci(this,Ha))==null||_.cancel(s),u?u.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ci(this,wm))}isActive(){return this.observers.some(s=>resolveEnabled(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(s=>resolveStaleTime(s.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(s=0){return this.state.data===void 0?!0:s==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,s)}onFocus(){var u;const s=this.observers.find(d=>d.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(u=ci(this,Ha))==null||u.continue()}onOnline(){var u;const s=this.observers.find(d=>d.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(u=ci(this,Ha))==null||u.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),ci(this,Bc).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(u=>u!==s),this.observers.length||(ci(this,Ha)&&(ci(this,Sm)?ci(this,Ha).cancel({revert:!0}):ci(this,Ha).cancelRetry()),this.scheduleGc()),ci(this,Bc).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||To(this,Pu,Nd).call(this,{type:"invalidate"})}async fetch(s,u){var k,O,j,V,G,J,Z,Y,le,ee,se,Q;if(this.state.fetchStatus!=="idle"&&((k=ci(this,Ha))==null?void 0:k.status())!=="rejected"){if(this.state.data!==void 0&&(u!=null&&u.cancelRefetch))this.cancel({silent:!0});else if(ci(this,Ha))return ci(this,Ha).continueRetry(),ci(this,Ha).promise}if(s&&this.setOptions(s),!this.options.queryFn){const oe=this.observers.find(_e=>_e.options.queryFn);oe&&this.setOptions(oe.options)}const d=new AbortController,_=oe=>{Object.defineProperty(oe,"signal",{enumerable:!0,get:()=>(Pr(this,Sm,!0),d.signal)})},S=()=>{const oe=ensureQueryFn(this.options,u),Se=(()=>{const ke={client:ci(this,Em),queryKey:this.queryKey,meta:this.meta};return _(ke),ke})();return Pr(this,Sm,!1),this.options.persister?this.options.persister(oe,Se,this):oe(Se)},a=(()=>{const oe={fetchOptions:u,options:this.options,queryKey:this.queryKey,client:ci(this,Em),state:this.state,fetchFn:S};return _(oe),oe})();(O=this.options.behavior)==null||O.onFetch(a,this),Pr(this,Ig,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((j=a.fetchOptions)==null?void 0:j.meta))&&To(this,Pu,Nd).call(this,{type:"fetch",meta:(V=a.fetchOptions)==null?void 0:V.meta}),Pr(this,Ha,createRetryer({initialPromise:u==null?void 0:u.initialPromise,fn:a.fetchFn,onCancel:oe=>{oe instanceof CancelledError&&oe.revert&&this.setState({...ci(this,Ig),fetchStatus:"idle"}),d.abort()},onFail:(oe,_e)=>{To(this,Pu,Nd).call(this,{type:"failed",failureCount:oe,error:_e})},onPause:()=>{To(this,Pu,Nd).call(this,{type:"pause"})},onContinue:()=>{To(this,Pu,Nd).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0}));try{const oe=await ci(this,Ha).start();if(oe===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(oe),(J=(G=ci(this,Bc).config).onSuccess)==null||J.call(G,oe,this),(Y=(Z=ci(this,Bc).config).onSettled)==null||Y.call(Z,oe,this.state.error,this),oe}catch(oe){if(oe instanceof CancelledError){if(oe.silent)return ci(this,Ha).promise;if(oe.revert){if(this.state.data===void 0)throw oe;return this.state.data}}throw To(this,Pu,Nd).call(this,{type:"error",error:oe}),(ee=(le=ci(this,Bc).config).onError)==null||ee.call(le,oe,this),(Q=(se=ci(this,Bc).config).onSettled)==null||Q.call(se,this.state.data,oe,this),oe}finally{this.scheduleGc()}}},wm=new WeakMap,Ig=new WeakMap,Bc=new WeakMap,Em=new WeakMap,Ha=new WeakMap,Ny=new WeakMap,Sm=new WeakMap,Pu=new WeakSet,Nd=function(s){const u=d=>{switch(s.type){case"failed":return{...d,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...d,fetchStatus:"paused"};case"continue":return{...d,fetchStatus:"fetching"};case"fetch":return{...d,...fetchState(d.data,this.options),fetchMeta:s.meta??null};case"success":const _={...d,...successState(s.data,s.dataUpdatedAt),dataUpdateCount:d.dataUpdateCount+1,...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Pr(this,Ig,s.manual?_:void 0),_;case"error":const S=s.error;return{...d,error:S,errorUpdateCount:d.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:d.fetchFailureCount+1,fetchFailureReason:S,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...d,isInvalidated:!0};case"setState":return{...d,...s.state}}};this.state=u(this.state),notifyManager.batch(()=>{this.observers.forEach(d=>{d.onQueryUpdate()}),ci(this,Bc).notify({query:this,type:"updated",action:s})})},Nb);function fetchState(t,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(s.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function successState(t,s){return{data:t,dataUpdatedAt:s??Date.now(),error:null,isInvalidated:!1,status:"success"}}function getDefaultState$1(t){const s=typeof t.initialData=="function"?t.initialData():t.initialData,u=s!==void 0,d=u?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:u?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:u?"success":"pending",fetchStatus:"idle"}}function infiniteQueryBehavior(t){return{onFetch:(s,u)=>{var j,V,G,J,Z;const d=s.options,_=(G=(V=(j=s.fetchOptions)==null?void 0:j.meta)==null?void 0:V.fetchMore)==null?void 0:G.direction,S=((J=s.state.data)==null?void 0:J.pages)||[],R=((Z=s.state.data)==null?void 0:Z.pageParams)||[];let a={pages:[],pageParams:[]},k=0;const O=async()=>{let Y=!1;const le=Q=>{addConsumeAwareSignal(Q,()=>s.signal,()=>Y=!0)},ee=ensureQueryFn(s.options,s.fetchOptions),se=async(Q,oe,_e)=>{if(Y)return Promise.reject();if(oe==null&&Q.pages.length)return Promise.resolve(Q);const ke=(()=>{const Yt={client:s.client,queryKey:s.queryKey,pageParam:oe,direction:_e?"backward":"forward",meta:s.options.meta};return le(Yt),Yt})(),Le=await ee(ke),{maxPages:lt}=s.options,qt=_e?addToStart:addToEnd;return{pages:qt(Q.pages,Le,lt),pageParams:qt(Q.pageParams,oe,lt)}};if(_&&S.length){const Q=_==="backward",oe=Q?getPreviousPageParam:getNextPageParam,_e={pages:S,pageParams:R},Se=oe(d,_e);a=await se(_e,Se,Q)}else{const Q=t??S.length;do{const oe=k===0?R[0]??d.initialPageParam:getNextPageParam(d,a);if(k>0&&oe==null)break;a=await se(a,oe),k++}while(k<Q)}return a};s.options.persister?s.fetchFn=()=>{var Y,le;return(le=(Y=s.options).persister)==null?void 0:le.call(Y,O,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},u)}:s.fetchFn=O}}}function getNextPageParam(t,{pages:s,pageParams:u}){const d=s.length-1;return s.length>0?t.getNextPageParam(s[d],s,u[d],u):void 0}function getPreviousPageParam(t,{pages:s,pageParams:u}){var d;return s.length>0?(d=t.getPreviousPageParam)==null?void 0:d.call(t,s[0],s,u[0],u):void 0}var Vy,Lh,Ao,Tm,Oh,Yf,Vb,Mutation=(Vb=class extends Removable{constructor(s){super();hn(this,Oh);hn(this,Vy);hn(this,Lh);hn(this,Ao);hn(this,Tm);Pr(this,Vy,s.client),this.mutationId=s.mutationId,Pr(this,Ao,s.mutationCache),Pr(this,Lh,[]),this.state=s.state||getDefaultState(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){ci(this,Lh).includes(s)||(ci(this,Lh).push(s),this.clearGcTimeout(),ci(this,Ao).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){Pr(this,Lh,ci(this,Lh).filter(u=>u!==s)),this.scheduleGc(),ci(this,Ao).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){ci(this,Lh).length||(this.state.status==="pending"?this.scheduleGc():ci(this,Ao).remove(this))}continue(){var s;return((s=ci(this,Tm))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var R,a,k,O,j,V,G,J,Z,Y,le,ee,se,Q,oe,_e,Se,ke;const u=()=>{To(this,Oh,Yf).call(this,{type:"continue"})},d={client:ci(this,Vy),meta:this.options.meta,mutationKey:this.options.mutationKey};Pr(this,Tm,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(s,d):Promise.reject(new Error("No mutationFn found")),onFail:(Le,lt)=>{To(this,Oh,Yf).call(this,{type:"failed",failureCount:Le,error:lt})},onPause:()=>{To(this,Oh,Yf).call(this,{type:"pause"})},onContinue:u,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ci(this,Ao).canRun(this)}));const _=this.state.status==="pending",S=!ci(this,Tm).canStart();try{if(_)u();else{To(this,Oh,Yf).call(this,{type:"pending",variables:s,isPaused:S}),ci(this,Ao).config.onMutate&&await ci(this,Ao).config.onMutate(s,this,d);const lt=await((a=(R=this.options).onMutate)==null?void 0:a.call(R,s,d));lt!==this.state.context&&To(this,Oh,Yf).call(this,{type:"pending",context:lt,variables:s,isPaused:S})}const Le=await ci(this,Tm).start();return await((O=(k=ci(this,Ao).config).onSuccess)==null?void 0:O.call(k,Le,s,this.state.context,this,d)),await((V=(j=this.options).onSuccess)==null?void 0:V.call(j,Le,s,this.state.context,d)),await((J=(G=ci(this,Ao).config).onSettled)==null?void 0:J.call(G,Le,null,this.state.variables,this.state.context,this,d)),await((Y=(Z=this.options).onSettled)==null?void 0:Y.call(Z,Le,null,s,this.state.context,d)),To(this,Oh,Yf).call(this,{type:"success",data:Le}),Le}catch(Le){try{await((ee=(le=ci(this,Ao).config).onError)==null?void 0:ee.call(le,Le,s,this.state.context,this,d))}catch(lt){Promise.reject(lt)}try{await((Q=(se=this.options).onError)==null?void 0:Q.call(se,Le,s,this.state.context,d))}catch(lt){Promise.reject(lt)}try{await((_e=(oe=ci(this,Ao).config).onSettled)==null?void 0:_e.call(oe,void 0,Le,this.state.variables,this.state.context,this,d))}catch(lt){Promise.reject(lt)}try{await((ke=(Se=this.options).onSettled)==null?void 0:ke.call(Se,void 0,Le,s,this.state.context,d))}catch(lt){Promise.reject(lt)}throw To(this,Oh,Yf).call(this,{type:"error",error:Le}),Le}finally{ci(this,Ao).runNext(this)}}},Vy=new WeakMap,Lh=new WeakMap,Ao=new WeakMap,Tm=new WeakMap,Oh=new WeakSet,Yf=function(s){const u=d=>{switch(s.type){case"failed":return{...d,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...d,isPaused:!0};case"continue":return{...d,isPaused:!1};case"pending":return{...d,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...d,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...d,data:void 0,error:s.error,failureCount:d.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=u(this.state),notifyManager.batch(()=>{ci(this,Lh).forEach(d=>{d.onMutationUpdate(s)}),ci(this,Ao).notify({mutation:this,type:"updated",action:s})})},Vb);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Vd,Iu,Uy,Ub,MutationCache=(Ub=class extends Subscribable{constructor(s={}){super();hn(this,Vd);hn(this,Iu);hn(this,Uy);this.config=s,Pr(this,Vd,new Set),Pr(this,Iu,new Map),Pr(this,Uy,0)}build(s,u,d){const _=new Mutation({client:s,mutationCache:this,mutationId:++r0(this,Uy)._,options:s.defaultMutationOptions(u),state:d});return this.add(_),_}add(s){ci(this,Vd).add(s);const u=scopeFor(s);if(typeof u=="string"){const d=ci(this,Iu).get(u);d?d.push(s):ci(this,Iu).set(u,[s])}this.notify({type:"added",mutation:s})}remove(s){if(ci(this,Vd).delete(s)){const u=scopeFor(s);if(typeof u=="string"){const d=ci(this,Iu).get(u);if(d)if(d.length>1){const _=d.indexOf(s);_!==-1&&d.splice(_,1)}else d[0]===s&&ci(this,Iu).delete(u)}}this.notify({type:"removed",mutation:s})}canRun(s){const u=scopeFor(s);if(typeof u=="string"){const d=ci(this,Iu).get(u),_=d==null?void 0:d.find(S=>S.state.status==="pending");return!_||_===s}else return!0}runNext(s){var d;const u=scopeFor(s);if(typeof u=="string"){const _=(d=ci(this,Iu).get(u))==null?void 0:d.find(S=>S!==s&&S.state.isPaused);return(_==null?void 0:_.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{ci(this,Vd).forEach(s=>{this.notify({type:"removed",mutation:s})}),ci(this,Vd).clear(),ci(this,Iu).clear()})}getAll(){return Array.from(ci(this,Vd))}find(s){const u={exact:!0,...s};return this.getAll().find(d=>matchMutation(u,d))}findAll(s={}){return this.getAll().filter(u=>matchMutation(s,u))}notify(s){notifyManager.batch(()=>{this.listeners.forEach(u=>{u(s)})})}resumePausedMutations(){const s=this.getAll().filter(u=>u.state.isPaused);return notifyManager.batch(()=>Promise.all(s.map(u=>u.continue().catch(noop$2))))}},Vd=new WeakMap,Iu=new WeakMap,Uy=new WeakMap,Ub);function scopeFor(t){var s;return(s=t.options.scope)==null?void 0:s.id}var zh,Gb,QueryCache=(Gb=class extends Subscribable{constructor(s={}){super();hn(this,zh);this.config=s,Pr(this,zh,new Map)}build(s,u,d){const _=u.queryKey,S=u.queryHash??hashQueryKeyByOptions(_,u);let R=this.get(S);return R||(R=new Query({client:s,queryKey:_,queryHash:S,options:s.defaultQueryOptions(u),state:d,defaultOptions:s.getQueryDefaults(_)}),this.add(R)),R}add(s){ci(this,zh).has(s.queryHash)||(ci(this,zh).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const u=ci(this,zh).get(s.queryHash);u&&(s.destroy(),u===s&&ci(this,zh).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return ci(this,zh).get(s)}getAll(){return[...ci(this,zh).values()]}find(s){const u={exact:!0,...s};return this.getAll().find(d=>matchQuery(u,d))}findAll(s={}){const u=this.getAll();return Object.keys(s).length>0?u.filter(d=>matchQuery(s,d)):u}notify(s){notifyManager.batch(()=>{this.listeners.forEach(u=>{u(s)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},zh=new WeakMap,Gb),qs,ep,tp,Dg,kg,rp,Lg,Og,$b,QueryClient=($b=class{constructor(t={}){hn(this,qs);hn(this,ep);hn(this,tp);hn(this,Dg);hn(this,kg);hn(this,rp);hn(this,Lg);hn(this,Og);Pr(this,qs,t.queryCache||new QueryCache),Pr(this,ep,t.mutationCache||new MutationCache),Pr(this,tp,t.defaultOptions||{}),Pr(this,Dg,new Map),Pr(this,kg,new Map),Pr(this,rp,0)}mount(){r0(this,rp)._++,ci(this,rp)===1&&(Pr(this,Lg,focusManager.subscribe(async t=>{t&&(await this.resumePausedMutations(),ci(this,qs).onFocus())})),Pr(this,Og,onlineManager.subscribe(async t=>{t&&(await this.resumePausedMutations(),ci(this,qs).onOnline())})))}unmount(){var t,s;r0(this,rp)._--,ci(this,rp)===0&&((t=ci(this,Lg))==null||t.call(this),Pr(this,Lg,void 0),(s=ci(this,Og))==null||s.call(this),Pr(this,Og,void 0))}isFetching(t){return ci(this,qs).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return ci(this,ep).findAll({...t,status:"pending"}).length}getQueryData(t){var u;const s=this.defaultQueryOptions({queryKey:t});return(u=ci(this,qs).get(s.queryHash))==null?void 0:u.state.data}ensureQueryData(t){const s=this.defaultQueryOptions(t),u=ci(this,qs).build(this,s),d=u.state.data;return d===void 0?this.fetchQuery(t):(t.revalidateIfStale&&u.isStaleByTime(resolveStaleTime(s.staleTime,u))&&this.prefetchQuery(s),Promise.resolve(d))}getQueriesData(t){return ci(this,qs).findAll(t).map(({queryKey:s,state:u})=>{const d=u.data;return[s,d]})}setQueryData(t,s,u){const d=this.defaultQueryOptions({queryKey:t}),_=ci(this,qs).get(d.queryHash),S=_==null?void 0:_.state.data,R=functionalUpdate(s,S);if(R!==void 0)return ci(this,qs).build(this,d).setData(R,{...u,manual:!0})}setQueriesData(t,s,u){return notifyManager.batch(()=>ci(this,qs).findAll(t).map(({queryKey:d})=>[d,this.setQueryData(d,s,u)]))}getQueryState(t){var u;const s=this.defaultQueryOptions({queryKey:t});return(u=ci(this,qs).get(s.queryHash))==null?void 0:u.state}removeQueries(t){const s=ci(this,qs);notifyManager.batch(()=>{s.findAll(t).forEach(u=>{s.remove(u)})})}resetQueries(t,s){const u=ci(this,qs);return notifyManager.batch(()=>(u.findAll(t).forEach(d=>{d.reset()}),this.refetchQueries({type:"active",...t},s)))}cancelQueries(t,s={}){const u={revert:!0,...s},d=notifyManager.batch(()=>ci(this,qs).findAll(t).map(_=>_.cancel(u)));return Promise.all(d).then(noop$2).catch(noop$2)}invalidateQueries(t,s={}){return notifyManager.batch(()=>(ci(this,qs).findAll(t).forEach(u=>{u.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},s)))}refetchQueries(t,s={}){const u={...s,cancelRefetch:s.cancelRefetch??!0},d=notifyManager.batch(()=>ci(this,qs).findAll(t).filter(_=>!_.isDisabled()&&!_.isStatic()).map(_=>{let S=_.fetch(void 0,u);return u.throwOnError||(S=S.catch(noop$2)),_.state.fetchStatus==="paused"?Promise.resolve():S}));return Promise.all(d).then(noop$2)}fetchQuery(t){const s=this.defaultQueryOptions(t);s.retry===void 0&&(s.retry=!1);const u=ci(this,qs).build(this,s);return u.isStaleByTime(resolveStaleTime(s.staleTime,u))?u.fetch(s):Promise.resolve(u.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(noop$2).catch(noop$2)}fetchInfiniteQuery(t){return t.behavior=infiniteQueryBehavior(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(t){return t.behavior=infiniteQueryBehavior(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return onlineManager.isOnline()?ci(this,ep).resumePausedMutations():Promise.resolve()}getQueryCache(){return ci(this,qs)}getMutationCache(){return ci(this,ep)}getDefaultOptions(){return ci(this,tp)}setDefaultOptions(t){Pr(this,tp,t)}setQueryDefaults(t,s){ci(this,Dg).set(hashKey(t),{queryKey:t,defaultOptions:s})}getQueryDefaults(t){const s=[...ci(this,Dg).values()],u={};return s.forEach(d=>{partialMatchKey(t,d.queryKey)&&Object.assign(u,d.defaultOptions)}),u}setMutationDefaults(t,s){ci(this,kg).set(hashKey(t),{mutationKey:t,defaultOptions:s})}getMutationDefaults(t){const s=[...ci(this,kg).values()],u={};return s.forEach(d=>{partialMatchKey(t,d.mutationKey)&&Object.assign(u,d.defaultOptions)}),u}defaultQueryOptions(t){if(t._defaulted)return t;const s={...ci(this,tp).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return s.queryHash||(s.queryHash=hashQueryKeyByOptions(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===skipToken&&(s.enabled=!1),s}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...ci(this,tp).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){ci(this,qs).clear(),ci(this,ep).clear()}},qs=new WeakMap,ep=new WeakMap,tp=new WeakMap,Dg=new WeakMap,kg=new WeakMap,rp=new WeakMap,Lg=new WeakMap,Og=new WeakMap,$b),QueryClientContext=reactExports.createContext(void 0),QueryClientProvider=({client:t,children:s})=>(reactExports.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:t,children:s}));/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var PopStateEventType="popstate";function createBrowserHistory(t={}){function s(d,_){let{pathname:S,search:R,hash:a}=d.location;return createLocation("",{pathname:S,search:R,hash:a},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function u(d,_){return typeof _=="string"?_:createPath(_)}return getUrlBasedHistory(s,u,null,t)}function invariant$1(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function warning(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(t,s){return{usr:t.state,key:t.key,idx:s}}function createLocation(t,s,u=null,d){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?parsePath(s):s,state:u,key:s&&s.key||d||createKey()}}function createPath({pathname:t="/",search:s="",hash:u=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),u&&u!=="#"&&(t+=u.charAt(0)==="#"?u:"#"+u),t}function parsePath(t){let s={};if(t){let u=t.indexOf("#");u>=0&&(s.hash=t.substring(u),t=t.substring(0,u));let d=t.indexOf("?");d>=0&&(s.search=t.substring(d),t=t.substring(0,d)),t&&(s.pathname=t)}return s}function getUrlBasedHistory(t,s,u,d={}){let{window:_=document.defaultView,v5Compat:S=!1}=d,R=_.history,a="POP",k=null,O=j();O==null&&(O=0,R.replaceState({...R.state,idx:O},""));function j(){return(R.state||{idx:null}).idx}function V(){a="POP";let le=j(),ee=le==null?null:le-O;O=le,k&&k({action:a,location:Y.location,delta:ee})}function G(le,ee){a="PUSH";let se=createLocation(Y.location,le,ee);O=j()+1;let Q=getHistoryState(se,O),oe=Y.createHref(se);try{R.pushState(Q,"",oe)}catch(_e){if(_e instanceof DOMException&&_e.name==="DataCloneError")throw _e;_.location.assign(oe)}S&&k&&k({action:a,location:Y.location,delta:1})}function J(le,ee){a="REPLACE";let se=createLocation(Y.location,le,ee);O=j();let Q=getHistoryState(se,O),oe=Y.createHref(se);R.replaceState(Q,"",oe),S&&k&&k({action:a,location:Y.location,delta:0})}function Z(le){return createBrowserURLImpl(le)}let Y={get action(){return a},get location(){return t(_,R)},listen(le){if(k)throw new Error("A history only accepts one active listener");return _.addEventListener(PopStateEventType,V),k=le,()=>{_.removeEventListener(PopStateEventType,V),k=null}},createHref(le){return s(_,le)},createURL:Z,encodeLocation(le){let ee=Z(le);return{pathname:ee.pathname,search:ee.search,hash:ee.hash}},push:G,replace:J,go(le){return R.go(le)}};return Y}function createBrowserURLImpl(t,s=!1){let u="http://localhost";typeof window<"u"&&(u=window.location.origin!=="null"?window.location.origin:window.location.href),invariant$1(u,"No window.location.(origin|href) available to create URL");let d=typeof t=="string"?t:createPath(t);return d=d.replace(/ $/,"%20"),!s&&d.startsWith("//")&&(d=u+d),new URL(d,u)}function matchRoutes(t,s,u="/"){return matchRoutesImpl(t,s,u,!1)}function matchRoutesImpl(t,s,u,d){let _=typeof s=="string"?parsePath(s):s,S=stripBasename(_.pathname||"/",u);if(S==null)return null;let R=flattenRoutes(t);rankRouteBranches(R);let a=null;for(let k=0;a==null&&k<R.length;++k){let O=decodePath(S);a=matchRouteBranch(R[k],O,d)}return a}function flattenRoutes(t,s=[],u=[],d="",_=!1){let S=(R,a,k=_,O)=>{let j={relativePath:O===void 0?R.path||"":O,caseSensitive:R.caseSensitive===!0,childrenIndex:a,route:R};if(j.relativePath.startsWith("/")){if(!j.relativePath.startsWith(d)&&k)return;invariant$1(j.relativePath.startsWith(d),`Absolute route path "${j.relativePath}" nested under path "${d}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),j.relativePath=j.relativePath.slice(d.length)}let V=joinPaths([d,j.relativePath]),G=u.concat(j);R.children&&R.children.length>0&&(invariant$1(R.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${V}".`),flattenRoutes(R.children,s,G,V,k)),!(R.path==null&&!R.index)&&s.push({path:V,score:computeScore(V,R.index),routesMeta:G})};return t.forEach((R,a)=>{var k;if(R.path===""||!((k=R.path)!=null&&k.includes("?")))S(R,a);else for(let O of explodeOptionalSegments(R.path))S(R,a,!0,O)}),s}function explodeOptionalSegments(t){let s=t.split("/");if(s.length===0)return[];let[u,...d]=s,_=u.endsWith("?"),S=u.replace(/\?$/,"");if(d.length===0)return _?[S,""]:[S];let R=explodeOptionalSegments(d.join("/")),a=[];return a.push(...R.map(k=>k===""?S:[S,k].join("/"))),_&&a.push(...R),a.map(k=>t.startsWith("/")&&k===""?"/":k)}function rankRouteBranches(t){t.sort((s,u)=>s.score!==u.score?u.score-s.score:compareIndexes(s.routesMeta.map(d=>d.childrenIndex),u.routesMeta.map(d=>d.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=t=>t==="*";function computeScore(t,s){let u=t.split("/"),d=u.length;return u.some(isSplat)&&(d+=splatPenalty),s&&(d+=indexRouteValue),u.filter(_=>!isSplat(_)).reduce((_,S)=>_+(paramRe.test(S)?dynamicSegmentValue:S===""?emptySegmentValue:staticSegmentValue),d)}function compareIndexes(t,s){return t.length===s.length&&t.slice(0,-1).every((d,_)=>d===s[_])?t[t.length-1]-s[s.length-1]:0}function matchRouteBranch(t,s,u=!1){let{routesMeta:d}=t,_={},S="/",R=[];for(let a=0;a<d.length;++a){let k=d[a],O=a===d.length-1,j=S==="/"?s:s.slice(S.length)||"/",V=matchPath({path:k.relativePath,caseSensitive:k.caseSensitive,end:O},j),G=k.route;if(!V&&O&&u&&!d[d.length-1].route.index&&(V=matchPath({path:k.relativePath,caseSensitive:k.caseSensitive,end:!1},j)),!V)return null;Object.assign(_,V.params),R.push({params:_,pathname:joinPaths([S,V.pathname]),pathnameBase:normalizePathname(joinPaths([S,V.pathnameBase])),route:G}),V.pathnameBase!=="/"&&(S=joinPaths([S,V.pathnameBase]))}return R}function matchPath(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[u,d]=compilePath(t.path,t.caseSensitive,t.end),_=s.match(u);if(!_)return null;let S=_[0],R=S.replace(/(.)\/+$/,"$1"),a=_.slice(1);return{params:d.reduce((O,{paramName:j,isOptional:V},G)=>{if(j==="*"){let Z=a[G]||"";R=S.slice(0,S.length-Z.length).replace(/(.)\/+$/,"$1")}const J=a[G];return V&&!J?O[j]=void 0:O[j]=(J||"").replace(/%2F/g,"/"),O},{}),pathname:S,pathnameBase:R,pattern:t}}function compilePath(t,s=!1,u=!0){warning(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let d=[],_="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,a,k)=>(d.push({paramName:a,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(d.push({paramName:"*"}),_+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?_+="\\/*$":t!==""&&t!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,s?void 0:"i"),d]}function decodePath(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return warning(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function stripBasename(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let u=s.endsWith("/")?s.length-1:s.length,d=t.charAt(u);return d&&d!=="/"?null:t.slice(u)||"/"}var ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function resolvePath(t,s="/"){let{pathname:u,search:d="",hash:_=""}=typeof t=="string"?parsePath(t):t,S;return u?(u=u.replace(/\/\/+/g,"/"),u.startsWith("/")?S=resolvePathname(u.substring(1),"/"):S=resolvePathname(u,s)):S=s,{pathname:S,search:normalizeSearch(d),hash:normalizeHash(_)}}function resolvePathname(t,s){let u=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(_=>{_===".."?u.length>1&&u.pop():_!=="."&&u.push(_)}),u.length>1?u.join("/"):"/"}function getInvalidPathError(t,s,u,d){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(d)}].  Please separate it out to the \`to.${u}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(t){return t.filter((s,u)=>u===0||s.route.path&&s.route.path.length>0)}function getResolveToMatches(t){let s=getPathContributingMatches(t);return s.map((u,d)=>d===s.length-1?u.pathname:u.pathnameBase)}function resolveTo(t,s,u,d=!1){let _;typeof t=="string"?_=parsePath(t):(_={...t},invariant$1(!_.pathname||!_.pathname.includes("?"),getInvalidPathError("?","pathname","search",_)),invariant$1(!_.pathname||!_.pathname.includes("#"),getInvalidPathError("#","pathname","hash",_)),invariant$1(!_.search||!_.search.includes("#"),getInvalidPathError("#","search","hash",_)));let S=t===""||_.pathname==="",R=S?"/":_.pathname,a;if(R==null)a=u;else{let V=s.length-1;if(!d&&R.startsWith("..")){let G=R.split("/");for(;G[0]==="..";)G.shift(),V-=1;_.pathname=G.join("/")}a=V>=0?s[V]:"/"}let k=resolvePath(_,a),O=R&&R!=="/"&&R.endsWith("/"),j=(S||R===".")&&u.endsWith("/");return!k.pathname.endsWith("/")&&(O||j)&&(k.pathname+="/"),k}var joinPaths=t=>t.join("/").replace(/\/\/+/g,"/"),normalizePathname=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,normalizeHash=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,ErrorResponseImpl=class{constructor(t,s,u,d=!1){this.status=t,this.statusText=s||"",this.internal=d,u instanceof Error?(this.data=u.toString(),this.error=u):this.data=u}};function isRouteErrorResponse(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function getRoutePattern(t){return t.map(s=>s.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var isBrowser$2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function parseToInfo(t,s){let u=t;if(typeof u!="string"||!ABSOLUTE_URL_REGEX.test(u))return{absoluteURL:void 0,isExternal:!1,to:u};let d=u,_=!1;if(isBrowser$2)try{let S=new URL(window.location.href),R=u.startsWith("//")?new URL(S.protocol+u):new URL(u),a=stripBasename(R.pathname,s);R.origin===S.origin&&a!=null?u=a+R.search+R.hash:_=!0}catch{warning(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:d,isExternal:_,to:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";var RSCRouterContext=reactExports.createContext(!1),ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);RouteErrorContext.displayName="RouteError";var ERROR_DIGEST_BASE="REACT_ROUTER_ERROR",ERROR_DIGEST_REDIRECT="REDIRECT",ERROR_DIGEST_ROUTE_ERROR_RESPONSE="ROUTE_ERROR_RESPONSE";function decodeRedirectErrorDigest(t){if(t.startsWith(`${ERROR_DIGEST_BASE}:${ERROR_DIGEST_REDIRECT}:{`))try{let s=JSON.parse(t.slice(28));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.location=="string"&&typeof s.reloadDocument=="boolean"&&typeof s.replace=="boolean")return s}catch{}}function decodeRouteErrorResponseDigest(t){if(t.startsWith(`${ERROR_DIGEST_BASE}:${ERROR_DIGEST_ROUTE_ERROR_RESPONSE}:{`))try{let s=JSON.parse(t.slice(40));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string")return new ErrorResponseImpl(s.status,s.statusText,s.data)}catch{}}function useHref(t,{relative:s}={}){invariant$1(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:u,navigator:d}=reactExports.useContext(NavigationContext),{hash:_,pathname:S,search:R}=useResolvedPath(t,{relative:s}),a=S;return u!=="/"&&(a=S==="/"?u:joinPaths([u,S])),d.createHref({pathname:a,search:R,hash:_})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return invariant$1(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect$2(t){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(t)}function useNavigate(){let{isDataRoute:t}=reactExports.useContext(RouteContext);return t?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant$1(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let t=reactExports.useContext(DataRouterContext),{basename:s,navigator:u}=reactExports.useContext(NavigationContext),{matches:d}=reactExports.useContext(RouteContext),{pathname:_}=useLocation(),S=JSON.stringify(getResolveToMatches(d)),R=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{R.current=!0}),reactExports.useCallback((k,O={})=>{if(warning(R.current,navigateEffectWarning),!R.current)return;if(typeof k=="number"){u.go(k);return}let j=resolveTo(k,JSON.parse(S),_,O.relative==="path");t==null&&s!=="/"&&(j.pathname=j.pathname==="/"?s:joinPaths([s,j.pathname])),(O.replace?u.replace:u.push)(j,O.state,O)},[s,u,S,_,t])}reactExports.createContext(null);function useResolvedPath(t,{relative:s}={}){let{matches:u}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),_=JSON.stringify(getResolveToMatches(u));return reactExports.useMemo(()=>resolveTo(t,JSON.parse(_),d,s==="path"),[t,_,d,s])}function useRoutes(t,s){return useRoutesImpl(t,s)}function useRoutesImpl(t,s,u,d,_){var se;invariant$1(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:S}=reactExports.useContext(NavigationContext),{matches:R}=reactExports.useContext(RouteContext),a=R[R.length-1],k=a?a.params:{},O=a?a.pathname:"/",j=a?a.pathnameBase:"/",V=a&&a.route;{let Q=V&&V.path||"";warningOnce(O,!V||Q.endsWith("*")||Q.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${O}" (under <Route path="${Q}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Q}"> to <Route path="${Q==="/"?"*":`${Q}/*`}">.`)}let G=useLocation(),J;if(s){let Q=typeof s=="string"?parsePath(s):s;invariant$1(j==="/"||((se=Q.pathname)==null?void 0:se.startsWith(j)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${j}" but pathname "${Q.pathname}" was given in the \`location\` prop.`),J=Q}else J=G;let Z=J.pathname||"/",Y=Z;if(j!=="/"){let Q=j.replace(/^\//,"").split("/");Y="/"+Z.replace(/^\//,"").split("/").slice(Q.length).join("/")}let le=matchRoutes(t,{pathname:Y});warning(V||le!=null,`No routes matched location "${J.pathname}${J.search}${J.hash}" `),warning(le==null||le[le.length-1].route.element!==void 0||le[le.length-1].route.Component!==void 0||le[le.length-1].route.lazy!==void 0,`Matched leaf route at location "${J.pathname}${J.search}${J.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ee=_renderMatches(le&&le.map(Q=>Object.assign({},Q,{params:Object.assign({},k,Q.params),pathname:joinPaths([j,S.encodeLocation?S.encodeLocation(Q.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Q.pathname]),pathnameBase:Q.pathnameBase==="/"?j:joinPaths([j,S.encodeLocation?S.encodeLocation(Q.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Q.pathnameBase])})),R,u,d,_);return s&&ee?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...J},navigationType:"POP"}},ee):ee}function DefaultErrorComponent(){let t=useRouteError(),s=isRouteErrorResponse(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),u=t instanceof Error?t.stack:null,d="rgba(200,200,200, 0.5)",_={padding:"0.5rem",backgroundColor:d},S={padding:"2px 4px",backgroundColor:d},R=null;return console.error("Error handled by React Router default ErrorBoundary:",t),R=reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("p",null," Hey developer "),reactExports.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",reactExports.createElement("code",{style:S},"ErrorBoundary")," or"," ",reactExports.createElement("code",{style:S},"errorElement")," prop on your route.")),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},s),u?reactExports.createElement("pre",{style:_},u):null,R)}var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){this.props.onError?this.props.onError(t,s):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const u=decodeRouteErrorResponseDigest(t.digest);u&&(t=u)}let s=t!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?reactExports.createElement(RSCErrorHandler,{error:t},s):s}};RenderErrorBoundary.contextType=RSCRouterContext;var errorRedirectHandledMap=new WeakMap;function RSCErrorHandler({children:t,error:s}){let{basename:u}=reactExports.useContext(NavigationContext);if(typeof s=="object"&&s&&"digest"in s&&typeof s.digest=="string"){let d=decodeRedirectErrorDigest(s.digest);if(d){let _=errorRedirectHandledMap.get(s);if(_)throw _;let S=parseToInfo(d.location,u);if(isBrowser$2&&!errorRedirectHandledMap.get(s))if(S.isExternal||d.reloadDocument)window.location.href=S.absoluteURL||S.to;else{const R=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(S.to,{replace:d.replace}));throw errorRedirectHandledMap.set(s,R),R}return reactExports.createElement("meta",{httpEquiv:"refresh",content:`0;url=${S.absoluteURL||S.to}`})}}return t}function RenderedRoute({routeContext:t,match:s,children:u}){let d=reactExports.useContext(DataRouterContext);return d&&d.static&&d.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=s.route.id),reactExports.createElement(RouteContext.Provider,{value:t},u)}function _renderMatches(t,s=[],u=null,d=null,_=null){if(t==null){if(!u)return null;if(u.errors)t=u.matches;else if(s.length===0&&!u.initialized&&u.matches.length>0)t=u.matches;else return null}let S=t,R=u==null?void 0:u.errors;if(R!=null){let j=S.findIndex(V=>V.route.id&&(R==null?void 0:R[V.route.id])!==void 0);invariant$1(j>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(R).join(",")}`),S=S.slice(0,Math.min(S.length,j+1))}let a=!1,k=-1;if(u)for(let j=0;j<S.length;j++){let V=S[j];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(k=j),V.route.id){let{loaderData:G,errors:J}=u,Z=V.route.loader&&!G.hasOwnProperty(V.route.id)&&(!J||J[V.route.id]===void 0);if(V.route.lazy||Z){a=!0,k>=0?S=S.slice(0,k+1):S=[S[0]];break}}}let O=u&&d?(j,V)=>{var G,J;d(j,{location:u.location,params:((J=(G=u.matches)==null?void 0:G[0])==null?void 0:J.params)??{},unstable_pattern:getRoutePattern(u.matches),errorInfo:V})}:void 0;return S.reduceRight((j,V,G)=>{let J,Z=!1,Y=null,le=null;u&&(J=R&&V.route.id?R[V.route.id]:void 0,Y=V.route.errorElement||defaultErrorElement,a&&(k<0&&G===0?(warningOnce("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Z=!0,le=null):k===G&&(Z=!0,le=V.route.hydrateFallbackElement||null)));let ee=s.concat(S.slice(0,G+1)),se=()=>{let Q;return J?Q=Y:Z?Q=le:V.route.Component?Q=reactExports.createElement(V.route.Component,null):V.route.element?Q=V.route.element:Q=j,reactExports.createElement(RenderedRoute,{match:V,routeContext:{outlet:j,matches:ee,isDataRoute:u!=null},children:Q})};return u&&(V.route.ErrorBoundary||V.route.errorElement||G===0)?reactExports.createElement(RenderErrorBoundary,{location:u.location,revalidation:u.revalidation,component:Y,error:J,children:se(),routeContext:{outlet:null,matches:ee,isDataRoute:!0},onError:O}):se()},null)}function getDataRouterConsoleError(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(t){let s=reactExports.useContext(DataRouterContext);return invariant$1(s,getDataRouterConsoleError(t)),s}function useDataRouterState(t){let s=reactExports.useContext(DataRouterStateContext);return invariant$1(s,getDataRouterConsoleError(t)),s}function useRouteContext(t){let s=reactExports.useContext(RouteContext);return invariant$1(s,getDataRouterConsoleError(t)),s}function useCurrentRouteId(t){let s=useRouteContext(t),u=s.matches[s.matches.length-1];return invariant$1(u.route.id,`${t} can only be used on routes that contain a unique "id"`),u.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){var d;let t=reactExports.useContext(RouteErrorContext),s=useDataRouterState("useRouteError"),u=useCurrentRouteId("useRouteError");return t!==void 0?t:(d=s.errors)==null?void 0:d[u]}function useNavigateStable(){let{router:t}=useDataRouterContext("useNavigate"),s=useCurrentRouteId("useNavigate"),u=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{u.current=!0}),reactExports.useCallback(async(_,S={})=>{warning(u.current,navigateEffectWarning),u.current&&(typeof _=="number"?await t.navigate(_):await t.navigate(_,{fromRouteId:s,...S}))},[t,s])}var alreadyWarned={};function warningOnce(t,s,u){!s&&!alreadyWarned[t]&&(alreadyWarned[t]=!0,warning(!1,u))}reactExports.memo(DataRoutes);function DataRoutes({routes:t,future:s,state:u,onError:d}){return useRoutesImpl(t,void 0,u,d,s)}function Navigate({to:t,replace:s,state:u,relative:d}){invariant$1(useInRouterContext(),"<Navigate> may be used only in the context of a <Router> component.");let{static:_}=reactExports.useContext(NavigationContext);warning(!_,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:S}=reactExports.useContext(RouteContext),{pathname:R}=useLocation(),a=useNavigate(),k=resolveTo(t,getResolveToMatches(S),R,d==="path"),O=JSON.stringify(k);return reactExports.useEffect(()=>{a(JSON.parse(O),{replace:s,state:u,relative:d})},[a,O,d,s,u]),null}function Route(t){invariant$1(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:t="/",children:s=null,location:u,navigationType:d="POP",navigator:_,static:S=!1,unstable_useTransitions:R}){invariant$1(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),k=reactExports.useMemo(()=>({basename:a,navigator:_,static:S,unstable_useTransitions:R,future:{}}),[a,_,S,R]);typeof u=="string"&&(u=parsePath(u));let{pathname:O="/",search:j="",hash:V="",state:G=null,key:J="default"}=u,Z=reactExports.useMemo(()=>{let Y=stripBasename(O,a);return Y==null?null:{location:{pathname:Y,search:j,hash:V,state:G,key:J},navigationType:d}},[a,O,j,V,G,J,d]);return warning(Z!=null,`<Router basename="${a}"> is not able to match the URL "${O}${j}${V}" because it does not start with the basename, so the <Router> won't render anything.`),Z==null?null:reactExports.createElement(NavigationContext.Provider,{value:k},reactExports.createElement(LocationContext.Provider,{children:s,value:Z}))}function Routes({children:t,location:s}){return useRoutes(createRoutesFromChildren(t),s)}function createRoutesFromChildren(t,s=[]){let u=[];return reactExports.Children.forEach(t,(d,_)=>{if(!reactExports.isValidElement(d))return;let S=[...s,_];if(d.type===reactExports.Fragment){u.push.apply(u,createRoutesFromChildren(d.props.children,S));return}invariant$1(d.type===Route,`[${typeof d.type=="string"?d.type:d.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant$1(!d.props.index||!d.props.children,"An index route cannot have child routes.");let R={id:d.props.id||S.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,middleware:d.props.middleware,loader:d.props.loader,action:d.props.action,hydrateFallbackElement:d.props.hydrateFallbackElement,HydrateFallback:d.props.HydrateFallback,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.hasErrorBoundary===!0||d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(R.children=createRoutesFromChildren(d.props.children,S)),u.push(R)}),u}var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function isButtonElement(t){return isHtmlElement(t)&&t.tagName.toLowerCase()==="button"}function isFormElement(t){return isHtmlElement(t)&&t.tagName.toLowerCase()==="form"}function isInputElement(t){return isHtmlElement(t)&&t.tagName.toLowerCase()==="input"}function isModifiedEvent(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function shouldProcessLinkClick(t,s){return t.button===0&&(!s||s==="_self")&&!isModifiedEvent(t)}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(_formDataSupportsSubmitter===null)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch{_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(t){return t!=null&&!supportedFormEncTypes.has(t)?(warning(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null):t}function getFormSubmissionInfo(t,s){let u,d,_,S,R;if(isFormElement(t)){let a=t.getAttribute("action");d=a?stripBasename(a,s):null,u=t.getAttribute("method")||defaultMethod,_=getFormEncType(t.getAttribute("enctype"))||defaultEncType,S=new FormData(t)}else if(isButtonElement(t)||isInputElement(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let k=t.getAttribute("formaction")||a.getAttribute("action");if(d=k?stripBasename(k,s):null,u=t.getAttribute("formmethod")||a.getAttribute("method")||defaultMethod,_=getFormEncType(t.getAttribute("formenctype"))||getFormEncType(a.getAttribute("enctype"))||defaultEncType,S=new FormData(a,t),!isFormDataSubmitterSupported()){let{name:O,type:j,value:V}=t;if(j==="image"){let G=O?`${O}.`:"";S.append(`${G}x`,"0"),S.append(`${G}y`,"0")}else O&&S.append(O,V)}}else{if(isHtmlElement(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');u=defaultMethod,d=null,_=defaultEncType,R=t}return S&&_==="text/plain"&&(R=S,S=void 0),{action:d,method:u.toLowerCase(),encType:_,formData:S,body:R}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function invariant2(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function singleFetchUrl(t,s,u,d){let _=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return u?_.pathname.endsWith("/")?_.pathname=`${_.pathname}_.${d}`:_.pathname=`${_.pathname}.${d}`:_.pathname==="/"?_.pathname=`_root.${d}`:s&&stripBasename(_.pathname,s)==="/"?_.pathname=`${s.replace(/\/$/,"")}/_root.${d}`:_.pathname=`${_.pathname.replace(/\/$/,"")}.${d}`,_}async function loadRouteModule(t,s){if(t.id in s)return s[t.id];try{let u=await import(t.module);return s[t.id]=u,u}catch(u){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(u),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function getKeyedPrefetchLinks(t,s,u){let d=await Promise.all(t.map(async _=>{let S=s.routes[_.route.id];if(S){let R=await loadRouteModule(S,u);return R.links?R.links():[]}return[]}));return dedupeLinkDescriptors(d.flat(1).filter(isHtmlLinkDescriptor).filter(_=>_.rel==="stylesheet"||_.rel==="preload").map(_=>_.rel==="stylesheet"?{..._,rel:"prefetch",as:"style"}:{..._,rel:"prefetch"}))}function getNewMatchesForLinks(t,s,u,d,_,S){let R=(k,O)=>u[O]?k.route.id!==u[O].route.id:!0,a=(k,O)=>{var j;return u[O].pathname!==k.pathname||((j=u[O].route.path)==null?void 0:j.endsWith("*"))&&u[O].params["*"]!==k.params["*"]};return S==="assets"?s.filter((k,O)=>R(k,O)||a(k,O)):S==="data"?s.filter((k,O)=>{var V;let j=d.routes[k.route.id];if(!j||!j.hasLoader)return!1;if(R(k,O)||a(k,O))return!0;if(k.route.shouldRevalidate){let G=k.route.shouldRevalidate({currentUrl:new URL(_.pathname+_.search+_.hash,window.origin),currentParams:((V=u[0])==null?void 0:V.params)||{},nextUrl:new URL(t,window.origin),nextParams:k.params,defaultShouldRevalidate:!0});if(typeof G=="boolean")return G}return!0}):[]}function getModuleLinkHrefs(t,s,{includeHydrateFallback:u}={}){return dedupeHrefs(t.map(d=>{let _=s.routes[d.route.id];if(!_)return[];let S=[_.module];return _.clientActionModule&&(S=S.concat(_.clientActionModule)),_.clientLoaderModule&&(S=S.concat(_.clientLoaderModule)),u&&_.hydrateFallbackModule&&(S=S.concat(_.hydrateFallbackModule)),_.imports&&(S=S.concat(_.imports)),S}).flat(1))}function dedupeHrefs(t){return[...new Set(t)]}function sortKeys(t){let s={},u=Object.keys(t).sort();for(let d of u)s[d]=t[d];return s}function dedupeLinkDescriptors(t,s){let u=new Set;return new Set(s),t.reduce((d,_)=>{let S=JSON.stringify(sortKeys(_));return u.has(S)||(u.add(S),d.push({key:S,link:_})),d},[])}function useDataRouterContext2(){let t=reactExports.useContext(DataRouterContext);return invariant2(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function useDataRouterStateContext(){let t=reactExports.useContext(DataRouterStateContext);return invariant2(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var FrameworkContext=reactExports.createContext(void 0);FrameworkContext.displayName="FrameworkContext";function useFrameworkContext(){let t=reactExports.useContext(FrameworkContext);return invariant2(t,"You must render this element inside a <HydratedRouter> element"),t}function usePrefetchBehavior(t,s){let u=reactExports.useContext(FrameworkContext),[d,_]=reactExports.useState(!1),[S,R]=reactExports.useState(!1),{onFocus:a,onBlur:k,onMouseEnter:O,onMouseLeave:j,onTouchStart:V}=s,G=reactExports.useRef(null);reactExports.useEffect(()=>{if(t==="render"&&R(!0),t==="viewport"){let Y=ee=>{ee.forEach(se=>{R(se.isIntersecting)})},le=new IntersectionObserver(Y,{threshold:.5});return G.current&&le.observe(G.current),()=>{le.disconnect()}}},[t]),reactExports.useEffect(()=>{if(d){let Y=setTimeout(()=>{R(!0)},100);return()=>{clearTimeout(Y)}}},[d]);let J=()=>{_(!0)},Z=()=>{_(!1),R(!1)};return u?t!=="intent"?[S,G,{}]:[S,G,{onFocus:composeEventHandlers$1(a,J),onBlur:composeEventHandlers$1(k,Z),onMouseEnter:composeEventHandlers$1(O,J),onMouseLeave:composeEventHandlers$1(j,Z),onTouchStart:composeEventHandlers$1(V,J)}]:[!1,G,{}]}function composeEventHandlers$1(t,s){return u=>{t&&t(u),u.defaultPrevented||s(u)}}function PrefetchPageLinks({page:t,...s}){let{router:u}=useDataRouterContext2(),d=reactExports.useMemo(()=>matchRoutes(u.routes,t,u.basename),[u.routes,t,u.basename]);return d?reactExports.createElement(PrefetchPageLinksImpl,{page:t,matches:d,...s}):null}function useKeyedPrefetchLinks(t){let{manifest:s,routeModules:u}=useFrameworkContext(),[d,_]=reactExports.useState([]);return reactExports.useEffect(()=>{let S=!1;return getKeyedPrefetchLinks(t,s,u).then(R=>{S||_(R)}),()=>{S=!0}},[t,s,u]),d}function PrefetchPageLinksImpl({page:t,matches:s,...u}){let d=useLocation(),{future:_,manifest:S,routeModules:R}=useFrameworkContext(),{basename:a}=useDataRouterContext2(),{loaderData:k,matches:O}=useDataRouterStateContext(),j=reactExports.useMemo(()=>getNewMatchesForLinks(t,s,O,S,d,"data"),[t,s,O,S,d]),V=reactExports.useMemo(()=>getNewMatchesForLinks(t,s,O,S,d,"assets"),[t,s,O,S,d]),G=reactExports.useMemo(()=>{if(t===d.pathname+d.search+d.hash)return[];let Y=new Set,le=!1;if(s.forEach(se=>{var oe;let Q=S.routes[se.route.id];!Q||!Q.hasLoader||(!j.some(_e=>_e.route.id===se.route.id)&&se.route.id in k&&((oe=R[se.route.id])!=null&&oe.shouldRevalidate)||Q.hasClientLoader?le=!0:Y.add(se.route.id))}),Y.size===0)return[];let ee=singleFetchUrl(t,a,_.unstable_trailingSlashAwareDataRequests,"data");return le&&Y.size>0&&ee.searchParams.set("_routes",s.filter(se=>Y.has(se.route.id)).map(se=>se.route.id).join(",")),[ee.pathname+ee.search]},[a,_.unstable_trailingSlashAwareDataRequests,k,d,S,j,s,t,R]),J=reactExports.useMemo(()=>getModuleLinkHrefs(V,S),[V,S]),Z=useKeyedPrefetchLinks(V);return reactExports.createElement(reactExports.Fragment,null,G.map(Y=>reactExports.createElement("link",{key:Y,rel:"prefetch",as:"fetch",href:Y,...u})),J.map(Y=>reactExports.createElement("link",{key:Y,rel:"modulepreload",href:Y,...u})),Z.map(({key:Y,link:le})=>reactExports.createElement("link",{key:Y,nonce:u.nonce,...le,crossOrigin:le.crossOrigin??u.crossOrigin})))}function mergeRefs(...t){return s=>{t.forEach(u=>{typeof u=="function"?u(s):u!=null&&(u.current=s)})}}var isBrowser2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{isBrowser2&&(window.__reactRouterVersion="7.13.0")}catch{}function BrowserRouter({basename:t,children:s,unstable_useTransitions:u,window:d}){let _=reactExports.useRef();_.current==null&&(_.current=createBrowserHistory({window:d,v5Compat:!0}));let S=_.current,[R,a]=reactExports.useState({action:S.action,location:S.location}),k=reactExports.useCallback(O=>{u===!1?a(O):reactExports.startTransition(()=>a(O))},[u]);return reactExports.useLayoutEffect(()=>S.listen(k),[S,k]),reactExports.createElement(Router,{basename:t,children:s,location:R.location,navigationType:R.action,navigator:S,unstable_useTransitions:u})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function({onClick:s,discover:u="render",prefetch:d="none",relative:_,reloadDocument:S,replace:R,state:a,target:k,to:O,preventScrollReset:j,viewTransition:V,unstable_defaultShouldRevalidate:G,...J},Z){let{basename:Y,unstable_useTransitions:le}=reactExports.useContext(NavigationContext),ee=typeof O=="string"&&ABSOLUTE_URL_REGEX2.test(O),se=parseToInfo(O,Y);O=se.to;let Q=useHref(O,{relative:_}),[oe,_e,Se]=usePrefetchBehavior(d,J),ke=useLinkClickHandler(O,{replace:R,state:a,target:k,preventScrollReset:j,relative:_,viewTransition:V,unstable_defaultShouldRevalidate:G,unstable_useTransitions:le});function Le(qt){s&&s(qt),qt.defaultPrevented||ke(qt)}let lt=reactExports.createElement("a",{...J,...Se,href:se.absoluteURL||Q,onClick:se.isExternal||S?s:Le,ref:mergeRefs(Z,_e),target:k,"data-discover":!ee&&u==="render"?"true":void 0});return oe&&!ee?reactExports.createElement(reactExports.Fragment,null,lt,reactExports.createElement(PrefetchPageLinks,{page:Q})):lt});Link.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":s="page",caseSensitive:u=!1,className:d="",end:_=!1,style:S,to:R,viewTransition:a,children:k,...O},j){let V=useResolvedPath(R,{relative:O.relative}),G=useLocation(),J=reactExports.useContext(DataRouterStateContext),{navigator:Z,basename:Y}=reactExports.useContext(NavigationContext),le=J!=null&&useViewTransitionState(V)&&a===!0,ee=Z.encodeLocation?Z.encodeLocation(V).pathname:V.pathname,se=G.pathname,Q=J&&J.navigation&&J.navigation.location?J.navigation.location.pathname:null;u||(se=se.toLowerCase(),Q=Q?Q.toLowerCase():null,ee=ee.toLowerCase()),Q&&Y&&(Q=stripBasename(Q,Y)||Q);const oe=ee!=="/"&&ee.endsWith("/")?ee.length-1:ee.length;let _e=se===ee||!_&&se.startsWith(ee)&&se.charAt(oe)==="/",Se=Q!=null&&(Q===ee||!_&&Q.startsWith(ee)&&Q.charAt(ee.length)==="/"),ke={isActive:_e,isPending:Se,isTransitioning:le},Le=_e?s:void 0,lt;typeof d=="function"?lt=d(ke):lt=[d,_e?"active":null,Se?"pending":null,le?"transitioning":null].filter(Boolean).join(" ");let qt=typeof S=="function"?S(ke):S;return reactExports.createElement(Link,{...O,"aria-current":Le,className:lt,ref:j,style:qt,to:R,viewTransition:a},typeof k=="function"?k(ke):k)});NavLink.displayName="NavLink";var Form=reactExports.forwardRef(({discover:t="render",fetcherKey:s,navigate:u,reloadDocument:d,replace:_,state:S,method:R=defaultMethod,action:a,onSubmit:k,relative:O,preventScrollReset:j,viewTransition:V,unstable_defaultShouldRevalidate:G,...J},Z)=>{let{unstable_useTransitions:Y}=reactExports.useContext(NavigationContext),le=useSubmit(),ee=useFormAction(a,{relative:O}),se=R.toLowerCase()==="get"?"get":"post",Q=typeof a=="string"&&ABSOLUTE_URL_REGEX2.test(a),oe=_e=>{if(k&&k(_e),_e.defaultPrevented)return;_e.preventDefault();let Se=_e.nativeEvent.submitter,ke=(Se==null?void 0:Se.getAttribute("formmethod"))||R,Le=()=>le(Se||_e.currentTarget,{fetcherKey:s,method:ke,navigate:u,replace:_,state:S,relative:O,preventScrollReset:j,viewTransition:V,unstable_defaultShouldRevalidate:G});Y&&u!==!1?reactExports.startTransition(()=>Le()):Le()};return reactExports.createElement("form",{ref:Z,method:se,action:ee,onSubmit:d?k:oe,...J,"data-discover":!Q&&t==="render"?"true":void 0})});Form.displayName="Form";function getDataRouterConsoleError2(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(t){let s=reactExports.useContext(DataRouterContext);return invariant$1(s,getDataRouterConsoleError2(t)),s}function useLinkClickHandler(t,{target:s,replace:u,state:d,preventScrollReset:_,relative:S,viewTransition:R,unstable_defaultShouldRevalidate:a,unstable_useTransitions:k}={}){let O=useNavigate(),j=useLocation(),V=useResolvedPath(t,{relative:S});return reactExports.useCallback(G=>{if(shouldProcessLinkClick(G,s)){G.preventDefault();let J=u!==void 0?u:createPath(j)===createPath(V),Z=()=>O(t,{replace:J,state:d,preventScrollReset:_,relative:S,viewTransition:R,unstable_defaultShouldRevalidate:a});k?reactExports.startTransition(()=>Z()):Z()}},[j,O,V,u,d,s,t,_,S,R,a,k])}var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:t}=useDataRouterContext3("useSubmit"),{basename:s}=reactExports.useContext(NavigationContext),u=useRouteId(),d=t.fetch,_=t.navigate;return reactExports.useCallback(async(S,R={})=>{let{action:a,method:k,encType:O,formData:j,body:V}=getFormSubmissionInfo(S,s);if(R.navigate===!1){let G=R.fetcherKey||getUniqueFetcherId();await d(G,u,R.action||a,{unstable_defaultShouldRevalidate:R.unstable_defaultShouldRevalidate,preventScrollReset:R.preventScrollReset,formData:j,body:V,formMethod:R.method||k,formEncType:R.encType||O,flushSync:R.flushSync})}else await _(R.action||a,{unstable_defaultShouldRevalidate:R.unstable_defaultShouldRevalidate,preventScrollReset:R.preventScrollReset,formData:j,body:V,formMethod:R.method||k,formEncType:R.encType||O,replace:R.replace,state:R.state,fromRouteId:u,flushSync:R.flushSync,viewTransition:R.viewTransition})},[d,_,s,u])}function useFormAction(t,{relative:s}={}){let{basename:u}=reactExports.useContext(NavigationContext),d=reactExports.useContext(RouteContext);invariant$1(d,"useFormAction must be used inside a RouteContext");let[_]=d.matches.slice(-1),S={...useResolvedPath(t||".",{relative:s})},R=useLocation();if(t==null){S.search=R.search;let a=new URLSearchParams(S.search),k=a.getAll("index");if(k.some(j=>j==="")){a.delete("index"),k.filter(V=>V).forEach(V=>a.append("index",V));let j=a.toString();S.search=j?`?${j}`:""}}return(!t||t===".")&&_.route.index&&(S.search=S.search?S.search.replace(/^\?/,"?index&"):"?index"),u!=="/"&&(S.pathname=S.pathname==="/"?u:joinPaths([u,S.pathname])),createPath(S)}function useViewTransitionState(t,{relative:s}={}){let u=reactExports.useContext(ViewTransitionContext);invariant$1(u!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:d}=useDataRouterContext3("useViewTransitionState"),_=useResolvedPath(t,{relative:s});if(!u.isTransitioning)return!1;let S=stripBasename(u.currentLocation.pathname,d)||u.currentLocation.pathname,R=stripBasename(u.nextLocation.pathname,d)||u.nextLocation.pathname;return matchPath(_.pathname,R)!=null||matchPath(_.pathname,S)!=null}var reactDomExports=requireReactDom();const ReactDOM=getDefaultExportFromCjs(reactDomExports),VITE_BACKEND_URL="https://civic-issue-reporter-application.onrender.com",AuthContext=reactExports.createContext(void 0),useAuth=()=>{const t=reactExports.useContext(AuthContext);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},AuthProvider=({children:t})=>{const[s,u]=reactExports.useState(null),[d,_]=reactExports.useState(null),[S,R]=reactExports.useState(!0),a=async()=>{try{const G=localStorage.getItem("auth_token"),J=localStorage.getItem("auth_role"),Z=localStorage.getItem("auth_user_id");if(!G||!J||!Z){console.warn("Missing token or user info in localStorage");return}const Y=J==="admin"?`admin/profile/${Z}`:`citizen/profile/${Z}`,le=await fetch(`${VITE_BACKEND_URL}/api/v1/${Y}`,{headers:{Authorization:`Bearer ${G}`,"Content-Type":"application/json"}}),ee=await le.json();le.ok?(u(ee),localStorage.setItem("auth_user",JSON.stringify(ee))):console.error("Failed to fetch profile:",ee.message)}catch(G){console.error("Error fetching profile:",G)}};reactExports.useEffect(()=>{const G=localStorage.getItem("auth_token"),J=localStorage.getItem("auth_user");if(G&&J&&J!=="undefined")try{_(G);const Z=JSON.parse(J);u(Z),a().finally(()=>{R(!1)})}catch(Z){console.error("Failed to parse user from localStorage:",Z),j(),R(!1)}R(!1)},[]);const k=async(G,J,Z,Y)=>{R(!0);try{const le=Z==="admin"?"admin/signin":"citizen/signin",ee={email:G,password:J};if(!G||!J)return alert("Email and password are required."),!1;if(Z==="admin"&&!Y)return alert("Admin access code is required for admin login."),!1;Z==="admin"&&Y&&(ee.adminAccessCode=Y);const se=await fetch(`${VITE_BACKEND_URL}/api/v1/${le}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)}),Q=await se.json();if(console.log("Login API response:",Q),!se.ok||!Q.token||!Q.user)return console.error("Invalid login response:",Q),alert(Q.message||"Login failed. Please check your credentials."),!1;const oe={id:Q.user.id,email:Q.user.email,fullName:Q.user.fullName||"Guest",role:Q.user.role,phonenumber:Q.user.phonenumber||"",department:Q.user.department||"",adminAccessCode:Q.user.adminAccessCode||""};return _(Q.token),u(oe),localStorage.setItem("auth_token",Q.token),localStorage.setItem("auth_user",JSON.stringify(oe)),console.log("Auth User After Login:",oe),!0}catch(le){return console.error("Login Error:",le),!1}finally{R(!1)}},O=async(G,J)=>{R(!0);try{const Y=await fetch(`${VITE_BACKEND_URL}/api/v1/${J==="admin"?"admin/signup":"citizen/signup"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)}),le=await Y.json();if(!Y.ok)throw new Error(le.message||"Registration failed");_(le.token),u(le.user),localStorage.setItem("auth_token",le.token),localStorage.setItem("auth_user",JSON.stringify(le.user))}finally{R(!1)}},j=()=>{u(null),_(null),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")},V=async G=>{R(!0);try{if(!d||!s)throw new Error("User is not authenticated");const J=s.id,Z=s.role==="admin"?`admin/${J}`:`citizen/${J}`,Y=await fetch(`${VITE_BACKEND_URL}/api/v1/${Z}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(G)}),le=await Y.json();if(!Y.ok)throw new Error(le.message||"Profile update failed");const ee={...s,...G};return u(ee),localStorage.setItem("auth_user",JSON.stringify(ee)),le}catch(J){throw console.error("Update profile error:",J),J}finally{R(!1)}};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{user:s,token:d,login:k,register:O,logout:j,updateUserProfile:V,isLoading:S},children:t})},LoaderContext=reactExports.createContext({loading:!1,showLoader:()=>{},hideLoader:()=>{}});function useLoader(){return reactExports.useContext(LoaderContext)}function LoaderProvider({children:t}){const[s,u]=reactExports.useState(!1),d=()=>u(!0),_=()=>u(!1);return jsxRuntimeExports.jsx(LoaderContext.Provider,{value:{loading:s,showLoader:d,hideLoader:_},children:t})}var lottie$2={exports:{}},lottie$1=lottie$2.exports,hasRequiredLottie;function requireLottie(){return hasRequiredLottie||(hasRequiredLottie=1,(function(module,exports$1){typeof document<"u"&&typeof navigator<"u"&&(function(t,s){module.exports=s()})(lottie$1,(function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(s){_useWebWorker=!!s},getWebWorker=function(){return _useWebWorker},setLocationHref=function(s){locationHref=s},getLocationHref=function(){return locationHref};function createTag(t){return document.createElement(t)}function extendPrototype(t,s){var u,d=t.length,_;for(u=0;u<d;u+=1){_=t[u].prototype;for(var S in _)Object.prototype.hasOwnProperty.call(_,S)&&(s.prototype[S]=_[S])}}function getDescriptor(t,s){return Object.getOwnPropertyDescriptor(t,s)}function createProxyFunction(t){function s(){}return s.prototype=t,s}var audioControllerFactory=(function(){function t(s){this.audios=[],this.audioFactory=s,this._volume=1,this._isMuted=!1}return t.prototype={addAudio:function(u){this.audios.push(u)},pause:function(){var u,d=this.audios.length;for(u=0;u<d;u+=1)this.audios[u].pause()},resume:function(){var u,d=this.audios.length;for(u=0;u<d;u+=1)this.audios[u].resume()},setRate:function(u){var d,_=this.audios.length;for(d=0;d<_;d+=1)this.audios[d].setRate(u)},createAudio:function(u){return this.audioFactory?this.audioFactory(u):window.Howl?new window.Howl({src:[u]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(u){this.audioFactory=u},setVolume:function(u){this._volume=u,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var u,d=this.audios.length;for(u=0;u<d;u+=1)this.audios[u].volume(this._volume*(this._isMuted?0:1))}},function(){return new t}})(),createTypedArray=(function(){function t(u,d){var _=0,S=[],R;switch(u){case"int16":case"uint8c":R=1;break;default:R=1.1;break}for(_=0;_<d;_+=1)S.push(R);return S}function s(u,d){return u==="float32"?new Float32Array(d):u==="int16"?new Int16Array(d):u==="uint8c"?new Uint8ClampedArray(d):t(u,d)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?s:t})();function createSizedArray(t){return Array.apply(null,{length:t})}function _typeof$6(t){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$6(t)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var t=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],s,u=t.length;for(s=0;s<u;s+=1)BMMath[t[s]]=Math[t[s]]})(),BMMath.random=Math.random,BMMath.abs=function(t){var s=_typeof$6(t);if(s==="object"&&t.length){var u=createSizedArray(t.length),d,_=t.length;for(d=0;d<_;d+=1)u[d]=Math.abs(t[d]);return u}return Math.abs(t)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(t){t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.display="block",t.style.transformOrigin="0 0",t.style.webkitTransformOrigin="0 0",t.style.backfaceVisibility="visible",t.style.webkitBackfaceVisibility="visible",t.style.transformStyle="preserve-3d",t.style.webkitTransformStyle="preserve-3d",t.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(t,s,u,d){this.type=t,this.currentTime=s,this.totalTime=u,this.direction=d<0?-1:1}function BMCompleteEvent(t,s){this.type=t,this.direction=s<0?-1:1}function BMCompleteLoopEvent(t,s,u,d){this.type=t,this.currentLoop=u,this.totalLoops=s,this.direction=d<0?-1:1}function BMSegmentStartEvent(t,s,u){this.type=t,this.firstFrame=s,this.totalFrames=u}function BMDestroyEvent(t,s){this.type=t,this.target=s}function BMRenderFrameErrorEvent(t,s){this.type="renderFrameError",this.nativeError=t,this.currentTime=s}function BMConfigErrorEvent(t){this.type="configError",this.nativeError=t}var createElementID=(function(){var t=0;return function(){return t+=1,idPrefix$1+"__lottie_element_"+t}})();function HSVtoRGB(t,s,u){var d,_,S,R,a,k,O,j;switch(R=Math.floor(t*6),a=t*6-R,k=u*(1-s),O=u*(1-a*s),j=u*(1-(1-a)*s),R%6){case 0:d=u,_=j,S=k;break;case 1:d=O,_=u,S=k;break;case 2:d=k,_=u,S=j;break;case 3:d=k,_=O,S=u;break;case 4:d=j,_=k,S=u;break;case 5:d=u,_=k,S=O;break}return[d,_,S]}function RGBtoHSV(t,s,u){var d=Math.max(t,s,u),_=Math.min(t,s,u),S=d-_,R,a=d===0?0:S/d,k=d/255;switch(d){case _:R=0;break;case t:R=s-u+S*(s<u?6:0),R/=6*S;break;case s:R=u-t+S*2,R/=6*S;break;case u:R=t-s+S*4,R/=6*S;break}return[R,a,k]}function addSaturationToRGB(t,s){var u=RGBtoHSV(t[0]*255,t[1]*255,t[2]*255);return u[1]+=s,u[1]>1?u[1]=1:u[1]<=0&&(u[1]=0),HSVtoRGB(u[0],u[1],u[2])}function addBrightnessToRGB(t,s){var u=RGBtoHSV(t[0]*255,t[1]*255,t[2]*255);return u[2]+=s,u[2]>1?u[2]=1:u[2]<0&&(u[2]=0),HSVtoRGB(u[0],u[1],u[2])}function addHueToRGB(t,s){var u=RGBtoHSV(t[0]*255,t[1]*255,t[2]*255);return u[0]+=s/360,u[0]>1?u[0]-=1:u[0]<0&&(u[0]+=1),HSVtoRGB(u[0],u[1],u[2])}var rgbToHex=(function(){var t=[],s,u;for(s=0;s<256;s+=1)u=s.toString(16),t[s]=u.length===1?"0"+u:u;return function(d,_,S){return d<0&&(d=0),_<0&&(_=0),S<0&&(S=0),"#"+t[d]+t[_]+t[S]}})(),setSubframeEnabled=function(s){subframeEnabled=!!s},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(s){expressionsPlugin=s},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(s){expressionsInterfaces=s},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(s){defaultCurveSegments=s},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(s){idPrefix$1=s};function createNS(t){return document.createElementNS(svgNS,t)}function _typeof$5(t){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$5(t)}var dataManager=(function(){var t=1,s=[],u,d,_={onmessage:function(){},postMessage:function(J){u({data:J})}},S={postMessage:function(J){_.onmessage({data:J})}};function R(G){if(window.Worker&&window.Blob&&getWebWorker()){var J=new Blob(["var _workerSelf = self; self.onmessage = ",G.toString()],{type:"text/javascript"}),Z=URL.createObjectURL(J);return new Worker(Z)}return u=G,_}function a(){d||(d=R(function(J){function Z(){function le(kt,xe){var Fe,pe,Te=kt.length,st,Me,at,ct;for(pe=0;pe<Te;pe+=1)if(Fe=kt[pe],"ks"in Fe&&!Fe.completed){if(Fe.completed=!0,Fe.hasMask){var Ct=Fe.masksProperties;for(Me=Ct.length,st=0;st<Me;st+=1)if(Ct[st].pt.k.i)_e(Ct[st].pt.k);else for(ct=Ct[st].pt.k.length,at=0;at<ct;at+=1)Ct[st].pt.k[at].s&&_e(Ct[st].pt.k[at].s[0]),Ct[st].pt.k[at].e&&_e(Ct[st].pt.k[at].e[0])}Fe.ty===0?(Fe.layers=Q(Fe.refId,xe),le(Fe.layers,xe)):Fe.ty===4?oe(Fe.shapes):Fe.ty===5&&Bt(Fe)}}function ee(kt,xe){if(kt){var Fe=0,pe=kt.length;for(Fe=0;Fe<pe;Fe+=1)kt[Fe].t===1&&(kt[Fe].data.layers=Q(kt[Fe].data.refId,xe),le(kt[Fe].data.layers,xe))}}function se(kt,xe){for(var Fe=0,pe=xe.length;Fe<pe;){if(xe[Fe].id===kt)return xe[Fe];Fe+=1}return null}function Q(kt,xe){var Fe=se(kt,xe);return Fe?Fe.layers.__used?JSON.parse(JSON.stringify(Fe.layers)):(Fe.layers.__used=!0,Fe.layers):null}function oe(kt){var xe,Fe=kt.length,pe,Te;for(xe=Fe-1;xe>=0;xe-=1)if(kt[xe].ty==="sh")if(kt[xe].ks.k.i)_e(kt[xe].ks.k);else for(Te=kt[xe].ks.k.length,pe=0;pe<Te;pe+=1)kt[xe].ks.k[pe].s&&_e(kt[xe].ks.k[pe].s[0]),kt[xe].ks.k[pe].e&&_e(kt[xe].ks.k[pe].e[0]);else kt[xe].ty==="gr"&&oe(kt[xe].it)}function _e(kt){var xe,Fe=kt.i.length;for(xe=0;xe<Fe;xe+=1)kt.i[xe][0]+=kt.v[xe][0],kt.i[xe][1]+=kt.v[xe][1],kt.o[xe][0]+=kt.v[xe][0],kt.o[xe][1]+=kt.v[xe][1]}function Se(kt,xe){var Fe=xe?xe.split("."):[100,100,100];return kt[0]>Fe[0]?!0:Fe[0]>kt[0]?!1:kt[1]>Fe[1]?!0:Fe[1]>kt[1]?!1:kt[2]>Fe[2]?!0:Fe[2]>kt[2]?!1:null}var ke=(function(){var kt=[4,4,14];function xe(pe){var Te=pe.t.d;pe.t.d={k:[{s:Te,t:0}]}}function Fe(pe){var Te,st=pe.length;for(Te=0;Te<st;Te+=1)pe[Te].ty===5&&xe(pe[Te])}return function(pe){if(Se(kt,pe.v)&&(Fe(pe.layers),pe.assets)){var Te,st=pe.assets.length;for(Te=0;Te<st;Te+=1)pe.assets[Te].layers&&Fe(pe.assets[Te].layers)}}})(),Le=(function(){var kt=[4,7,99];return function(xe){if(xe.chars&&!Se(kt,xe.v)){var Fe,pe=xe.chars.length;for(Fe=0;Fe<pe;Fe+=1){var Te=xe.chars[Fe];Te.data&&Te.data.shapes&&(oe(Te.data.shapes),Te.data.ip=0,Te.data.op=99999,Te.data.st=0,Te.data.sr=1,Te.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},xe.chars[Fe].t||(Te.data.shapes.push({ty:"no"}),Te.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}})(),lt=(function(){var kt=[5,7,15];function xe(pe){var Te=pe.t.p;typeof Te.a=="number"&&(Te.a={a:0,k:Te.a}),typeof Te.p=="number"&&(Te.p={a:0,k:Te.p}),typeof Te.r=="number"&&(Te.r={a:0,k:Te.r})}function Fe(pe){var Te,st=pe.length;for(Te=0;Te<st;Te+=1)pe[Te].ty===5&&xe(pe[Te])}return function(pe){if(Se(kt,pe.v)&&(Fe(pe.layers),pe.assets)){var Te,st=pe.assets.length;for(Te=0;Te<st;Te+=1)pe.assets[Te].layers&&Fe(pe.assets[Te].layers)}}})(),qt=(function(){var kt=[4,1,9];function xe(pe){var Te,st=pe.length,Me,at;for(Te=0;Te<st;Te+=1)if(pe[Te].ty==="gr")xe(pe[Te].it);else if(pe[Te].ty==="fl"||pe[Te].ty==="st")if(pe[Te].c.k&&pe[Te].c.k[0].i)for(at=pe[Te].c.k.length,Me=0;Me<at;Me+=1)pe[Te].c.k[Me].s&&(pe[Te].c.k[Me].s[0]/=255,pe[Te].c.k[Me].s[1]/=255,pe[Te].c.k[Me].s[2]/=255,pe[Te].c.k[Me].s[3]/=255),pe[Te].c.k[Me].e&&(pe[Te].c.k[Me].e[0]/=255,pe[Te].c.k[Me].e[1]/=255,pe[Te].c.k[Me].e[2]/=255,pe[Te].c.k[Me].e[3]/=255);else pe[Te].c.k[0]/=255,pe[Te].c.k[1]/=255,pe[Te].c.k[2]/=255,pe[Te].c.k[3]/=255}function Fe(pe){var Te,st=pe.length;for(Te=0;Te<st;Te+=1)pe[Te].ty===4&&xe(pe[Te].shapes)}return function(pe){if(Se(kt,pe.v)&&(Fe(pe.layers),pe.assets)){var Te,st=pe.assets.length;for(Te=0;Te<st;Te+=1)pe.assets[Te].layers&&Fe(pe.assets[Te].layers)}}})(),Yt=(function(){var kt=[4,4,18];function xe(pe){var Te,st=pe.length,Me,at;for(Te=st-1;Te>=0;Te-=1)if(pe[Te].ty==="sh")if(pe[Te].ks.k.i)pe[Te].ks.k.c=pe[Te].closed;else for(at=pe[Te].ks.k.length,Me=0;Me<at;Me+=1)pe[Te].ks.k[Me].s&&(pe[Te].ks.k[Me].s[0].c=pe[Te].closed),pe[Te].ks.k[Me].e&&(pe[Te].ks.k[Me].e[0].c=pe[Te].closed);else pe[Te].ty==="gr"&&xe(pe[Te].it)}function Fe(pe){var Te,st,Me=pe.length,at,ct,Ct,li;for(st=0;st<Me;st+=1){if(Te=pe[st],Te.hasMask){var mi=Te.masksProperties;for(ct=mi.length,at=0;at<ct;at+=1)if(mi[at].pt.k.i)mi[at].pt.k.c=mi[at].cl;else for(li=mi[at].pt.k.length,Ct=0;Ct<li;Ct+=1)mi[at].pt.k[Ct].s&&(mi[at].pt.k[Ct].s[0].c=mi[at].cl),mi[at].pt.k[Ct].e&&(mi[at].pt.k[Ct].e[0].c=mi[at].cl)}Te.ty===4&&xe(Te.shapes)}}return function(pe){if(Se(kt,pe.v)&&(Fe(pe.layers),pe.assets)){var Te,st=pe.assets.length;for(Te=0;Te<st;Te+=1)pe.assets[Te].layers&&Fe(pe.assets[Te].layers)}}})();function Ot(kt){kt.__complete||(qt(kt),ke(kt),Le(kt),lt(kt),Yt(kt),le(kt.layers,kt.assets),ee(kt.chars,kt.assets),kt.__complete=!0)}function Bt(kt){kt.t.a.length===0&&"m"in kt.t.p}var si={};return si.completeData=Ot,si.checkColors=qt,si.checkChars=Le,si.checkPathProperties=lt,si.checkShapes=Yt,si.completeLayers=le,si}if(S.dataManager||(S.dataManager=Z()),S.assetLoader||(S.assetLoader=(function(){function le(se){var Q=se.getResponseHeader("content-type");return Q&&se.responseType==="json"&&Q.indexOf("json")!==-1||se.response&&_typeof$5(se.response)==="object"?se.response:se.response&&typeof se.response=="string"?JSON.parse(se.response):se.responseText?JSON.parse(se.responseText):null}function ee(se,Q,oe,_e){var Se,ke=new XMLHttpRequest;try{ke.responseType="json"}catch{}ke.onreadystatechange=function(){if(ke.readyState===4)if(ke.status===200)Se=le(ke),oe(Se);else try{Se=le(ke),oe(Se)}catch(Le){_e&&_e(Le)}};try{ke.open(["G","E","T"].join(""),se,!0)}catch{ke.open(["G","E","T"].join(""),Q+"/"+se,!0)}ke.send()}return{load:ee}})()),J.data.type==="loadAnimation")S.assetLoader.load(J.data.path,J.data.fullPath,function(le){S.dataManager.completeData(le),S.postMessage({id:J.data.id,payload:le,status:"success"})},function(){S.postMessage({id:J.data.id,status:"error"})});else if(J.data.type==="complete"){var Y=J.data.animation;S.dataManager.completeData(Y),S.postMessage({id:J.data.id,payload:Y,status:"success"})}else J.data.type==="loadData"&&S.assetLoader.load(J.data.path,J.data.fullPath,function(le){S.postMessage({id:J.data.id,payload:le,status:"success"})},function(){S.postMessage({id:J.data.id,status:"error"})})}),d.onmessage=function(G){var J=G.data,Z=J.id,Y=s[Z];s[Z]=null,J.status==="success"?Y.onComplete(J.payload):Y.onError&&Y.onError()})}function k(G,J){t+=1;var Z="processId_"+t;return s[Z]={onComplete:G,onError:J},Z}function O(G,J,Z){a();var Y=k(J,Z);d.postMessage({type:"loadAnimation",path:G,fullPath:window.location.origin+window.location.pathname,id:Y})}function j(G,J,Z){a();var Y=k(J,Z);d.postMessage({type:"loadData",path:G,fullPath:window.location.origin+window.location.pathname,id:Y})}function V(G,J,Z){a();var Y=k(J,Z);d.postMessage({type:"complete",animation:G,id:Y})}return{loadAnimation:O,loadData:j,completeAnimation:V}})(),ImagePreloader=(function(){var t=(function(){var ee=createTag("canvas");ee.width=1,ee.height=1;var se=ee.getContext("2d");return se.fillStyle="rgba(0,0,0,0)",se.fillRect(0,0,1,1),ee})();function s(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function u(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function d(ee,se,Q){var oe="";if(ee.e)oe=ee.p;else if(se){var _e=ee.p;_e.indexOf("images/")!==-1&&(_e=_e.split("/")[1]),oe=se+_e}else oe=Q,oe+=ee.u?ee.u:"",oe+=ee.p;return oe}function _(ee){var se=0,Q=setInterval((function(){var oe=ee.getBBox();(oe.width||se>500)&&(this._imageLoaded(),clearInterval(Q)),se+=1}).bind(this),50)}function S(ee){var se=d(ee,this.assetsPath,this.path),Q=createNS("image");isSafari?this.testImageLoaded(Q):Q.addEventListener("load",this._imageLoaded,!1),Q.addEventListener("error",(function(){oe.img=t,this._imageLoaded()}).bind(this),!1),Q.setAttributeNS("http://www.w3.org/1999/xlink","href",se),this._elementHelper.append?this._elementHelper.append(Q):this._elementHelper.appendChild(Q);var oe={img:Q,assetData:ee};return oe}function R(ee){var se=d(ee,this.assetsPath,this.path),Q=createTag("img");Q.crossOrigin="anonymous",Q.addEventListener("load",this._imageLoaded,!1),Q.addEventListener("error",(function(){oe.img=t,this._imageLoaded()}).bind(this),!1),Q.src=se;var oe={img:Q,assetData:ee};return oe}function a(ee){var se={assetData:ee},Q=d(ee,this.assetsPath,this.path);return dataManager.loadData(Q,(function(oe){se.img=oe,this._footageLoaded()}).bind(this),(function(){se.img={},this._footageLoaded()}).bind(this)),se}function k(ee,se){this.imagesLoadedCb=se;var Q,oe=ee.length;for(Q=0;Q<oe;Q+=1)ee[Q].layers||(!ee[Q].t||ee[Q].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(ee[Q]))):ee[Q].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(ee[Q]))))}function O(ee){this.path=ee||""}function j(ee){this.assetsPath=ee||""}function V(ee){for(var se=0,Q=this.images.length;se<Q;){if(this.images[se].assetData===ee)return this.images[se].img;se+=1}return null}function G(){this.imagesLoadedCb=null,this.images.length=0}function J(){return this.totalImages===this.loadedAssets}function Z(){return this.totalFootages===this.loadedFootagesCount}function Y(ee,se){ee==="svg"?(this._elementHelper=se,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function le(){this._imageLoaded=s.bind(this),this._footageLoaded=u.bind(this),this.testImageLoaded=_.bind(this),this.createFootageData=a.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return le.prototype={loadAssets:k,setAssetsPath:j,setPath:O,loadedImages:J,loadedFootages:Z,destroy:G,getAsset:V,createImgData:R,createImageData:S,imageLoaded:s,footageLoaded:u,setCacheType:Y},le})();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(s,u){if(this._cbs[s])for(var d=this._cbs[s],_=0;_<d.length;_+=1)d[_](u)},addEventListener:function(s,u){return this._cbs[s]||(this._cbs[s]=[]),this._cbs[s].push(u),(function(){this.removeEventListener(s,u)}).bind(this)},removeEventListener:function(s,u){if(!u)this._cbs[s]=null;else if(this._cbs[s]){for(var d=0,_=this._cbs[s].length;d<_;)this._cbs[s][d]===u&&(this._cbs[s].splice(d,1),d-=1,_-=1),d+=1;this._cbs[s].length||(this._cbs[s]=null)}}};var markerParser=(function(){function t(s){for(var u=s.split(`\r
`),d={},_,S=0,R=0;R<u.length;R+=1)_=u[R].split(":"),_.length===2&&(d[_[0]]=_[1].trim(),S+=1);if(S===0)throw new Error;return d}return function(s){for(var u=[],d=0;d<s.length;d+=1){var _=s[d],S={time:_.tm,duration:_.dr};try{S.payload=JSON.parse(s[d].cm)}catch{try{S.payload=t(s[d].cm)}catch{S.payload={name:s[d].cm}}}u.push(S)}return u}})(),ProjectInterface=(function(){function t(s){this.compositions.push(s)}return function(){function s(u){for(var d=0,_=this.compositions.length;d<_;){if(this.compositions[d].data&&this.compositions[d].data.nm===u)return this.compositions[d].prepareFrame&&this.compositions[d].data.xt&&this.compositions[d].prepareFrame(this.currentFrame),this.compositions[d].compInterface;d+=1}return null}return s.compositions=[],s.currentFrame=0,s.registerComposition=t,s}})(),renderers={},registerRenderer=function(s,u){renderers[s]=u};function getRenderer(t){return renderers[t]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var t in renderers)if(renderers[t])return t;return""}function _typeof$4(t){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$4(t)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(t){(t.wrapper||t.container)&&(this.wrapper=t.wrapper||t.container);var s="svg";t.animType?s=t.animType:t.renderer&&(s=t.renderer);var u=getRenderer(s);this.renderer=new u(this,t.rendererSettings),this.imagePreloader.setCacheType(s,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=s,t.loop===""||t.loop===null||t.loop===void 0||t.loop===!0?this.loop=!0:t.loop===!1?this.loop=!1:this.loop=parseInt(t.loop,10),this.autoplay="autoplay"in t?t.autoplay:!0,this.name=t.name?t.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(t,"autoloadSegments")?t.autoloadSegments:!0,this.assetsPath=t.assetsPath,this.initialSegment=t.initialSegment,t.audioFactory&&this.audioController.setAudioFactory(t.audioFactory),t.animationData?this.setupAnimation(t.animationData):t.path&&(t.path.lastIndexOf("\\")!==-1?this.path=t.path.substr(0,t.path.lastIndexOf("\\")+1):this.path=t.path.substr(0,t.path.lastIndexOf("/")+1),this.fileName=t.path.substr(t.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(t.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(t){dataManager.completeAnimation(t,this.configAnimation)},AnimationItem.prototype.setData=function(t,s){s&&_typeof$4(s)!=="object"&&(s=JSON.parse(s));var u={wrapper:t,animationData:s},d=t.attributes;u.path=d.getNamedItem("data-animation-path")?d.getNamedItem("data-animation-path").value:d.getNamedItem("data-bm-path")?d.getNamedItem("data-bm-path").value:d.getNamedItem("bm-path")?d.getNamedItem("bm-path").value:"",u.animType=d.getNamedItem("data-anim-type")?d.getNamedItem("data-anim-type").value:d.getNamedItem("data-bm-type")?d.getNamedItem("data-bm-type").value:d.getNamedItem("bm-type")?d.getNamedItem("bm-type").value:d.getNamedItem("data-bm-renderer")?d.getNamedItem("data-bm-renderer").value:d.getNamedItem("bm-renderer")?d.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var _=d.getNamedItem("data-anim-loop")?d.getNamedItem("data-anim-loop").value:d.getNamedItem("data-bm-loop")?d.getNamedItem("data-bm-loop").value:d.getNamedItem("bm-loop")?d.getNamedItem("bm-loop").value:"";_==="false"?u.loop=!1:_==="true"?u.loop=!0:_!==""&&(u.loop=parseInt(_,10));var S=d.getNamedItem("data-anim-autoplay")?d.getNamedItem("data-anim-autoplay").value:d.getNamedItem("data-bm-autoplay")?d.getNamedItem("data-bm-autoplay").value:d.getNamedItem("bm-autoplay")?d.getNamedItem("bm-autoplay").value:!0;u.autoplay=S!=="false",u.name=d.getNamedItem("data-name")?d.getNamedItem("data-name").value:d.getNamedItem("data-bm-name")?d.getNamedItem("data-bm-name").value:d.getNamedItem("bm-name")?d.getNamedItem("bm-name").value:"";var R=d.getNamedItem("data-anim-prerender")?d.getNamedItem("data-anim-prerender").value:d.getNamedItem("data-bm-prerender")?d.getNamedItem("data-bm-prerender").value:d.getNamedItem("bm-prerender")?d.getNamedItem("bm-prerender").value:"";R==="false"&&(u.prerender=!1),u.path?this.setParams(u):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(t){t.op>this.animationData.op&&(this.animationData.op=t.op,this.totalFrames=Math.floor(t.op-this.animationData.ip));var s=this.animationData.layers,u,d=s.length,_=t.layers,S,R=_.length;for(S=0;S<R;S+=1)for(u=0;u<d;){if(s[u].id===_[S].id){s[u]=_[S];break}u+=1}if((t.chars||t.fonts)&&(this.renderer.globalData.fontManager.addChars(t.chars),this.renderer.globalData.fontManager.addFonts(t.fonts,this.renderer.globalData.defs)),t.assets)for(d=t.assets.length,u=0;u<d;u+=1)this.animationData.assets.push(t.assets[u]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(t){this.animationData=t;var s=getExpressionsPlugin();s&&s.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var t=this.animationData.segments;if(!t||t.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var s=t.shift();this.timeCompleted=s.time*this.frameRate;var u=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(u,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var t=this.animationData.segments;t||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(t){if(this.renderer)try{this.animationData=t,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(t),t.assets||(t.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(t.assets),this.markers=markerParser(t.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(s){this.triggerConfigError(s)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(t,s){var u=typeof t=="number"?t:void 0,d=typeof s=="number"?s:void 0;this.renderer.updateContainerSize(u,d)},AnimationItem.prototype.setSubframe=function(t){this.isSubframeEnabled=!!t},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(t){this.triggerRenderFrameError(t)}},AnimationItem.prototype.play=function(t){t&&this.name!==t||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(t){t&&this.name!==t||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(t){t&&this.name!==t||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(t){t&&this.name!==t||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(t){for(var s,u=0;u<this.markers.length;u+=1)if(s=this.markers[u],s.payload&&s.payload.name===t)return s;return null},AnimationItem.prototype.goToAndStop=function(t,s,u){if(!(u&&this.name!==u)){var d=Number(t);if(isNaN(d)){var _=this.getMarkerData(t);_&&this.goToAndStop(_.time,!0)}else s?this.setCurrentRawFrameValue(t):this.setCurrentRawFrameValue(t*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(t,s,u){if(!(u&&this.name!==u)){var d=Number(t);if(isNaN(d)){var _=this.getMarkerData(t);_&&(_.duration?this.playSegments([_.time,_.time+_.duration],!0):this.goToAndStop(_.time,!0))}else this.goToAndStop(d,s,u);this.play()}},AnimationItem.prototype.advanceTime=function(t){if(!(this.isPaused===!0||this.isLoaded===!1)){var s=this.currentRawFrame+t*this.frameModifier,u=!1;s>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(s>this.totalFrames?s%this.totalFrames:0)||(u=!0,s=this.totalFrames-1):s>=this.totalFrames?(this.playCount+=1,this.checkSegments(s%this.totalFrames)||(this.setCurrentRawFrameValue(s%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(s):s<0?this.checkSegments(s%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+s%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(u=!0,s=0)):this.setCurrentRawFrameValue(s),u&&(this.setCurrentRawFrameValue(s),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(t,s){this.playCount=0,t[1]<t[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=t[0]-t[1],this.timeCompleted=this.totalFrames,this.firstFrame=t[1],this.setCurrentRawFrameValue(this.totalFrames-.001-s)):t[1]>t[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=t[1]-t[0],this.timeCompleted=this.totalFrames,this.firstFrame=t[0],this.setCurrentRawFrameValue(.001+s)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(t,s){var u=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<t?u=t:this.currentRawFrame+this.firstFrame>s&&(u=s-t)),this.firstFrame=t,this.totalFrames=s-t,this.timeCompleted=this.totalFrames,u!==-1&&this.goToAndStop(u,!0)},AnimationItem.prototype.playSegments=function(t,s){if(s&&(this.segments.length=0),_typeof$4(t[0])==="object"){var u,d=t.length;for(u=0;u<d;u+=1)this.segments.push(t[u])}else this.segments.push(t);this.segments.length&&s&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(t){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),t&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(t){return this.segments.length?(this.adjustSegment(this.segments.shift(),t),!0):!1},AnimationItem.prototype.destroy=function(t){t&&this.name!==t||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(t){this.currentRawFrame=t,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(t){this.playSpeed=t,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(t){this.playDirection=t<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(t){this.loop=t},AnimationItem.prototype.setVolume=function(t,s){s&&this.name!==s||this.audioController.setVolume(t)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(t){t&&this.name!==t||this.audioController.mute()},AnimationItem.prototype.unmute=function(t){t&&this.name!==t||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(t){var s="";if(t.e)s=t.p;else if(this.assetsPath){var u=t.p;u.indexOf("images/")!==-1&&(u=u.split("/")[1]),s=this.assetsPath+u}else s=this.path,s+=t.u?t.u:"",s+=t.p;return s},AnimationItem.prototype.getAssetData=function(t){for(var s=0,u=this.assets.length;s<u;){if(t===this.assets[s].id)return this.assets[s];s+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(t){return t?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(t,s,u){try{var d=this.renderer.getElementByPath(t);d.updateDocumentData(s,u)}catch{}},AnimationItem.prototype.trigger=function(t){if(this._cbs&&this._cbs[t])switch(t){case"enterFrame":this.triggerEvent(t,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(t,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(t,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(t,new BMCompleteEvent(t,this.frameMult));break;case"segmentStart":this.triggerEvent(t,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(t,new BMDestroyEvent(t,this));break;default:this.triggerEvent(t)}t==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameMult)),t==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult)),t==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(t,this.frameMult)),t==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames)),t==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(t,this))},AnimationItem.prototype.triggerRenderFrameError=function(t){var s=new BMRenderFrameErrorEvent(t,this.currentFrame);this.triggerEvent("error",s),this.onError&&this.onError.call(this,s)},AnimationItem.prototype.triggerConfigError=function(t){var s=new BMConfigErrorEvent(t,this.currentFrame);this.triggerEvent("error",s),this.onError&&this.onError.call(this,s)};var animationManager=(function(){var t={},s=[],u=0,d=0,_=0,S=!0,R=!1;function a(xe){for(var Fe=0,pe=xe.target;Fe<d;)s[Fe].animation===pe&&(s.splice(Fe,1),Fe-=1,d-=1,pe.isPaused||V()),Fe+=1}function k(xe,Fe){if(!xe)return null;for(var pe=0;pe<d;){if(s[pe].elem===xe&&s[pe].elem!==null)return s[pe].animation;pe+=1}var Te=new AnimationItem;return G(Te,xe),Te.setData(xe,Fe),Te}function O(){var xe,Fe=s.length,pe=[];for(xe=0;xe<Fe;xe+=1)pe.push(s[xe].animation);return pe}function j(){_+=1,qt()}function V(){_-=1}function G(xe,Fe){xe.addEventListener("destroy",a),xe.addEventListener("_active",j),xe.addEventListener("_idle",V),s.push({elem:Fe,animation:xe}),d+=1}function J(xe){var Fe=new AnimationItem;return G(Fe,null),Fe.setParams(xe),Fe}function Z(xe,Fe){var pe;for(pe=0;pe<d;pe+=1)s[pe].animation.setSpeed(xe,Fe)}function Y(xe,Fe){var pe;for(pe=0;pe<d;pe+=1)s[pe].animation.setDirection(xe,Fe)}function le(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.play(xe)}function ee(xe){var Fe=xe-u,pe;for(pe=0;pe<d;pe+=1)s[pe].animation.advanceTime(Fe);u=xe,_&&!R?window.requestAnimationFrame(ee):S=!0}function se(xe){u=xe,window.requestAnimationFrame(ee)}function Q(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.pause(xe)}function oe(xe,Fe,pe){var Te;for(Te=0;Te<d;Te+=1)s[Te].animation.goToAndStop(xe,Fe,pe)}function _e(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.stop(xe)}function Se(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.togglePause(xe)}function ke(xe){var Fe;for(Fe=d-1;Fe>=0;Fe-=1)s[Fe].animation.destroy(xe)}function Le(xe,Fe,pe){var Te=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),st,Me=Te.length;for(st=0;st<Me;st+=1)pe&&Te[st].setAttribute("data-bm-type",pe),k(Te[st],xe);if(Fe&&Me===0){pe||(pe="svg");var at=document.getElementsByTagName("body")[0];at.innerText="";var ct=createTag("div");ct.style.width="100%",ct.style.height="100%",ct.setAttribute("data-bm-type",pe),at.appendChild(ct),k(ct,xe)}}function lt(){var xe;for(xe=0;xe<d;xe+=1)s[xe].animation.resize()}function qt(){!R&&_&&S&&(window.requestAnimationFrame(se),S=!1)}function Yt(){R=!0}function Ot(){R=!1,qt()}function Bt(xe,Fe){var pe;for(pe=0;pe<d;pe+=1)s[pe].animation.setVolume(xe,Fe)}function si(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.mute(xe)}function kt(xe){var Fe;for(Fe=0;Fe<d;Fe+=1)s[Fe].animation.unmute(xe)}return t.registerAnimation=k,t.loadAnimation=J,t.setSpeed=Z,t.setDirection=Y,t.play=le,t.pause=Q,t.stop=_e,t.togglePause=Se,t.searchAnimations=Le,t.resize=lt,t.goToAndStop=oe,t.destroy=ke,t.freeze=Yt,t.unfreeze=Ot,t.setVolume=Bt,t.mute=si,t.unmute=kt,t.getRegisteredAnimations=O,t})(),BezierFactory=(function(){var t={};t.getBezierEasing=u;var s={};function u(se,Q,oe,_e,Se){var ke=Se||("bez_"+se+"_"+Q+"_"+oe+"_"+_e).replace(/\./g,"p");if(s[ke])return s[ke];var Le=new ee([se,Q,oe,_e]);return s[ke]=Le,Le}var d=4,_=.001,S=1e-7,R=10,a=11,k=1/(a-1),O=typeof Float32Array=="function";function j(se,Q){return 1-3*Q+3*se}function V(se,Q){return 3*Q-6*se}function G(se){return 3*se}function J(se,Q,oe){return((j(Q,oe)*se+V(Q,oe))*se+G(Q))*se}function Z(se,Q,oe){return 3*j(Q,oe)*se*se+2*V(Q,oe)*se+G(Q)}function Y(se,Q,oe,_e,Se){var ke,Le,lt=0;do Le=Q+(oe-Q)/2,ke=J(Le,_e,Se)-se,ke>0?oe=Le:Q=Le;while(Math.abs(ke)>S&&++lt<R);return Le}function le(se,Q,oe,_e){for(var Se=0;Se<d;++Se){var ke=Z(Q,oe,_e);if(ke===0)return Q;var Le=J(Q,oe,_e)-se;Q-=Le/ke}return Q}function ee(se){this._p=se,this._mSampleValues=O?new Float32Array(a):new Array(a),this._precomputed=!1,this.get=this.get.bind(this)}return ee.prototype={get:function(Q){var oe=this._p[0],_e=this._p[1],Se=this._p[2],ke=this._p[3];return this._precomputed||this._precompute(),oe===_e&&Se===ke?Q:Q===0?0:Q===1?1:J(this._getTForX(Q),_e,ke)},_precompute:function(){var Q=this._p[0],oe=this._p[1],_e=this._p[2],Se=this._p[3];this._precomputed=!0,(Q!==oe||_e!==Se)&&this._calcSampleValues()},_calcSampleValues:function(){for(var Q=this._p[0],oe=this._p[2],_e=0;_e<a;++_e)this._mSampleValues[_e]=J(_e*k,Q,oe)},_getTForX:function(Q){for(var oe=this._p[0],_e=this._p[2],Se=this._mSampleValues,ke=0,Le=1,lt=a-1;Le!==lt&&Se[Le]<=Q;++Le)ke+=k;--Le;var qt=(Q-Se[Le])/(Se[Le+1]-Se[Le]),Yt=ke+qt*k,Ot=Z(Yt,oe,_e);return Ot>=_?le(Q,Yt,oe,_e):Ot===0?Yt:Y(Q,ke,ke+k,oe,_e)}},t})(),pooling=(function(){function t(s){return s.concat(createSizedArray(s.length))}return{double:t}})(),poolFactory=(function(){return function(t,s,u){var d=0,_=t,S=createSizedArray(_),R={newElement:a,release:k};function a(){var O;return d?(d-=1,O=S[d]):O=s(),O}function k(O){d===_&&(S=pooling.double(S),_*=2),u&&u(O),S[d]=O,d+=1}return R}})(),bezierLengthPool=(function(){function t(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,t)})(),segmentsLengthPool=(function(){function t(){return{lengths:[],totalLength:0}}function s(u){var d,_=u.lengths.length;for(d=0;d<_;d+=1)bezierLengthPool.release(u.lengths[d]);u.lengths.length=0}return poolFactory(8,t,s)})();function bezFunction(){var t=Math;function s(G,J,Z,Y,le,ee){var se=G*Y+J*le+Z*ee-le*Y-ee*G-Z*J;return se>-.001&&se<.001}function u(G,J,Z,Y,le,ee,se,Q,oe){if(Z===0&&ee===0&&oe===0)return s(G,J,Y,le,se,Q);var _e=t.sqrt(t.pow(Y-G,2)+t.pow(le-J,2)+t.pow(ee-Z,2)),Se=t.sqrt(t.pow(se-G,2)+t.pow(Q-J,2)+t.pow(oe-Z,2)),ke=t.sqrt(t.pow(se-Y,2)+t.pow(Q-le,2)+t.pow(oe-ee,2)),Le;return _e>Se?_e>ke?Le=_e-Se-ke:Le=ke-Se-_e:ke>Se?Le=ke-Se-_e:Le=Se-_e-ke,Le>-1e-4&&Le<1e-4}var d=(function(){return function(G,J,Z,Y){var le=getDefaultCurveSegments(),ee,se,Q,oe,_e,Se=0,ke,Le=[],lt=[],qt=bezierLengthPool.newElement();for(Q=Z.length,ee=0;ee<le;ee+=1){for(_e=ee/(le-1),ke=0,se=0;se<Q;se+=1)oe=bmPow(1-_e,3)*G[se]+3*bmPow(1-_e,2)*_e*Z[se]+3*(1-_e)*bmPow(_e,2)*Y[se]+bmPow(_e,3)*J[se],Le[se]=oe,lt[se]!==null&&(ke+=bmPow(Le[se]-lt[se],2)),lt[se]=Le[se];ke&&(ke=bmSqrt(ke),Se+=ke),qt.percents[ee]=_e,qt.lengths[ee]=Se}return qt.addedLength=Se,qt}})();function _(G){var J=segmentsLengthPool.newElement(),Z=G.c,Y=G.v,le=G.o,ee=G.i,se,Q=G._length,oe=J.lengths,_e=0;for(se=0;se<Q-1;se+=1)oe[se]=d(Y[se],Y[se+1],le[se],ee[se+1]),_e+=oe[se].addedLength;return Z&&Q&&(oe[se]=d(Y[se],Y[0],le[se],ee[0]),_e+=oe[se].addedLength),J.totalLength=_e,J}function S(G){this.segmentLength=0,this.points=new Array(G)}function R(G,J){this.partialLength=G,this.point=J}var a=(function(){var G={};return function(J,Z,Y,le){var ee=(J[0]+"_"+J[1]+"_"+Z[0]+"_"+Z[1]+"_"+Y[0]+"_"+Y[1]+"_"+le[0]+"_"+le[1]).replace(/\./g,"p");if(!G[ee]){var se=getDefaultCurveSegments(),Q,oe,_e,Se,ke,Le=0,lt,qt,Yt=null;J.length===2&&(J[0]!==Z[0]||J[1]!==Z[1])&&s(J[0],J[1],Z[0],Z[1],J[0]+Y[0],J[1]+Y[1])&&s(J[0],J[1],Z[0],Z[1],Z[0]+le[0],Z[1]+le[1])&&(se=2);var Ot=new S(se);for(_e=Y.length,Q=0;Q<se;Q+=1){for(qt=createSizedArray(_e),ke=Q/(se-1),lt=0,oe=0;oe<_e;oe+=1)Se=bmPow(1-ke,3)*J[oe]+3*bmPow(1-ke,2)*ke*(J[oe]+Y[oe])+3*(1-ke)*bmPow(ke,2)*(Z[oe]+le[oe])+bmPow(ke,3)*Z[oe],qt[oe]=Se,Yt!==null&&(lt+=bmPow(qt[oe]-Yt[oe],2));lt=bmSqrt(lt),Le+=lt,Ot.points[Q]=new R(lt,qt),Yt=qt}Ot.segmentLength=Le,G[ee]=Ot}return G[ee]}})();function k(G,J){var Z=J.percents,Y=J.lengths,le=Z.length,ee=bmFloor((le-1)*G),se=G*J.addedLength,Q=0;if(ee===le-1||ee===0||se===Y[ee])return Z[ee];for(var oe=Y[ee]>se?-1:1,_e=!0;_e;)if(Y[ee]<=se&&Y[ee+1]>se?(Q=(se-Y[ee])/(Y[ee+1]-Y[ee]),_e=!1):ee+=oe,ee<0||ee>=le-1){if(ee===le-1)return Z[ee];_e=!1}return Z[ee]+(Z[ee+1]-Z[ee])*Q}function O(G,J,Z,Y,le,ee){var se=k(le,ee),Q=1-se,oe=t.round((Q*Q*Q*G[0]+(se*Q*Q+Q*se*Q+Q*Q*se)*Z[0]+(se*se*Q+Q*se*se+se*Q*se)*Y[0]+se*se*se*J[0])*1e3)/1e3,_e=t.round((Q*Q*Q*G[1]+(se*Q*Q+Q*se*Q+Q*Q*se)*Z[1]+(se*se*Q+Q*se*se+se*Q*se)*Y[1]+se*se*se*J[1])*1e3)/1e3;return[oe,_e]}var j=createTypedArray("float32",8);function V(G,J,Z,Y,le,ee,se){le<0?le=0:le>1&&(le=1);var Q=k(le,se);ee=ee>1?1:ee;var oe=k(ee,se),_e,Se=G.length,ke=1-Q,Le=1-oe,lt=ke*ke*ke,qt=Q*ke*ke*3,Yt=Q*Q*ke*3,Ot=Q*Q*Q,Bt=ke*ke*Le,si=Q*ke*Le+ke*Q*Le+ke*ke*oe,kt=Q*Q*Le+ke*Q*oe+Q*ke*oe,xe=Q*Q*oe,Fe=ke*Le*Le,pe=Q*Le*Le+ke*oe*Le+ke*Le*oe,Te=Q*oe*Le+ke*oe*oe+Q*Le*oe,st=Q*oe*oe,Me=Le*Le*Le,at=oe*Le*Le+Le*oe*Le+Le*Le*oe,ct=oe*oe*Le+Le*oe*oe+oe*Le*oe,Ct=oe*oe*oe;for(_e=0;_e<Se;_e+=1)j[_e*4]=t.round((lt*G[_e]+qt*Z[_e]+Yt*Y[_e]+Ot*J[_e])*1e3)/1e3,j[_e*4+1]=t.round((Bt*G[_e]+si*Z[_e]+kt*Y[_e]+xe*J[_e])*1e3)/1e3,j[_e*4+2]=t.round((Fe*G[_e]+pe*Z[_e]+Te*Y[_e]+st*J[_e])*1e3)/1e3,j[_e*4+3]=t.round((Me*G[_e]+at*Z[_e]+ct*Y[_e]+Ct*J[_e])*1e3)/1e3;return j}return{getSegmentsLength:_,getNewSegment:V,getPointInSegment:O,buildBezierData:a,pointOnLine2D:s,pointOnLine3D:u}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(t,s){var u=this.offsetTime,d;this.propType==="multidimensional"&&(d=createTypedArray("float32",this.pv.length));for(var _=s.lastIndex,S=_,R=this.keyframes.length-1,a=!0,k,O,j;a;){if(k=this.keyframes[S],O=this.keyframes[S+1],S===R-1&&t>=O.t-u){k.h&&(k=O),_=0;break}if(O.t-u>t){_=S;break}S<R-1?S+=1:(_=0,a=!1)}j=this.keyframesMetadata[S]||{};var V,G,J,Z,Y,le,ee=O.t-u,se=k.t-u,Q;if(k.to){j.bezierData||(j.bezierData=bez.buildBezierData(k.s,O.s||k.e,k.to,k.ti));var oe=j.bezierData;if(t>=ee||t<se){var _e=t>=ee?oe.points.length-1:0;for(G=oe.points[_e].point.length,V=0;V<G;V+=1)d[V]=oe.points[_e].point[V]}else{j.__fnct?le=j.__fnct:(le=BezierFactory.getBezierEasing(k.o.x,k.o.y,k.i.x,k.i.y,k.n).get,j.__fnct=le),J=le((t-se)/(ee-se));var Se=oe.segmentLength*J,ke,Le=s.lastFrame<t&&s._lastKeyframeIndex===S?s._lastAddedLength:0;for(Y=s.lastFrame<t&&s._lastKeyframeIndex===S?s._lastPoint:0,a=!0,Z=oe.points.length;a;){if(Le+=oe.points[Y].partialLength,Se===0||J===0||Y===oe.points.length-1){for(G=oe.points[Y].point.length,V=0;V<G;V+=1)d[V]=oe.points[Y].point[V];break}else if(Se>=Le&&Se<Le+oe.points[Y+1].partialLength){for(ke=(Se-Le)/oe.points[Y+1].partialLength,G=oe.points[Y].point.length,V=0;V<G;V+=1)d[V]=oe.points[Y].point[V]+(oe.points[Y+1].point[V]-oe.points[Y].point[V])*ke;break}Y<Z-1?Y+=1:a=!1}s._lastPoint=Y,s._lastAddedLength=Le-oe.points[Y].partialLength,s._lastKeyframeIndex=S}}else{var lt,qt,Yt,Ot,Bt;if(R=k.s.length,Q=O.s||k.e,this.sh&&k.h!==1)if(t>=ee)d[0]=Q[0],d[1]=Q[1],d[2]=Q[2];else if(t<=se)d[0]=k.s[0],d[1]=k.s[1],d[2]=k.s[2];else{var si=createQuaternion(k.s),kt=createQuaternion(Q),xe=(t-se)/(ee-se);quaternionToEuler(d,slerp(si,kt,xe))}else for(S=0;S<R;S+=1)k.h!==1&&(t>=ee?J=1:t<se?J=0:(k.o.x.constructor===Array?(j.__fnct||(j.__fnct=[]),j.__fnct[S]?le=j.__fnct[S]:(lt=k.o.x[S]===void 0?k.o.x[0]:k.o.x[S],qt=k.o.y[S]===void 0?k.o.y[0]:k.o.y[S],Yt=k.i.x[S]===void 0?k.i.x[0]:k.i.x[S],Ot=k.i.y[S]===void 0?k.i.y[0]:k.i.y[S],le=BezierFactory.getBezierEasing(lt,qt,Yt,Ot).get,j.__fnct[S]=le)):j.__fnct?le=j.__fnct:(lt=k.o.x,qt=k.o.y,Yt=k.i.x,Ot=k.i.y,le=BezierFactory.getBezierEasing(lt,qt,Yt,Ot).get,k.keyframeMetadata=le),J=le((t-se)/(ee-se)))),Q=O.s||k.e,Bt=k.h===1?k.s[S]:k.s[S]+(Q[S]-k.s[S])*J,this.propType==="multidimensional"?d[S]=Bt:d=Bt}return s.lastIndex=_,d}function slerp(t,s,u){var d=[],_=t[0],S=t[1],R=t[2],a=t[3],k=s[0],O=s[1],j=s[2],V=s[3],G,J,Z,Y,le;return J=_*k+S*O+R*j+a*V,J<0&&(J=-J,k=-k,O=-O,j=-j,V=-V),1-J>1e-6?(G=Math.acos(J),Z=Math.sin(G),Y=Math.sin((1-u)*G)/Z,le=Math.sin(u*G)/Z):(Y=1-u,le=u),d[0]=Y*_+le*k,d[1]=Y*S+le*O,d[2]=Y*R+le*j,d[3]=Y*a+le*V,d}function quaternionToEuler(t,s){var u=s[0],d=s[1],_=s[2],S=s[3],R=Math.atan2(2*d*S-2*u*_,1-2*d*d-2*_*_),a=Math.asin(2*u*d+2*_*S),k=Math.atan2(2*u*S-2*d*_,1-2*u*u-2*_*_);t[0]=R/degToRads,t[1]=a/degToRads,t[2]=k/degToRads}function createQuaternion(t){var s=t[0]*degToRads,u=t[1]*degToRads,d=t[2]*degToRads,_=Math.cos(s/2),S=Math.cos(u/2),R=Math.cos(d/2),a=Math.sin(s/2),k=Math.sin(u/2),O=Math.sin(d/2),j=_*S*R-a*k*O,V=a*k*R+_*S*O,G=a*S*R+_*k*O,J=_*k*R-a*S*O;return[V,G,J,j]}function getValueAtCurrentTime(){var t=this.comp.renderedFrame-this.offsetTime,s=this.keyframes[0].t-this.offsetTime,u=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(t===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=u&&t>=u||this._caching.lastFrame<s&&t<s))){this._caching.lastFrame>=t&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var d=this.interpolateValue(t,this._caching);this.pv=d}return this._caching.lastFrame=t,this.pv}function setVValue(t){var s;if(this.propType==="unidimensional")s=t*this.mult,mathAbs(this.v-s)>1e-5&&(this.v=s,this._mdf=!0);else for(var u=0,d=this.v.length;u<d;)s=t[u]*this.mult,mathAbs(this.v[u]-s)>1e-5&&(this.v[u]=s,this._mdf=!0),u+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var t,s=this.effectsSequence.length,u=this.kf?this.pv:this.data.k;for(t=0;t<s;t+=1)u=this.effectsSequence[t](u);this.setVValue(u),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(t){this.effectsSequence.push(t),this.container.addDynamicProperty(this)}function ValueProperty(t,s,u,d){this.propType="unidimensional",this.mult=u||1,this.data=s,this.v=u?s.k*u:s.k,this.pv=s.k,this._mdf=!1,this.elem=t,this.container=d,this.comp=t.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(t,s,u,d){this.propType="multidimensional",this.mult=u||1,this.data=s,this._mdf=!1,this.elem=t,this.container=d,this.comp=t.comp,this.k=!1,this.kf=!1,this.frameId=-1;var _,S=s.k.length;for(this.v=createTypedArray("float32",S),this.pv=createTypedArray("float32",S),this.vel=createTypedArray("float32",S),_=0;_<S;_+=1)this.v[_]=s.k[_]*this.mult,this.pv[_]=s.k[_];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(t,s,u,d){this.propType="unidimensional",this.keyframes=s.k,this.keyframesMetadata=[],this.offsetTime=t.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=s,this.mult=u||1,this.elem=t,this.container=d,this.comp=t.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(t,s,u,d){this.propType="multidimensional";var _,S=s.k.length,R,a,k,O;for(_=0;_<S-1;_+=1)s.k[_].to&&s.k[_].s&&s.k[_+1]&&s.k[_+1].s&&(R=s.k[_].s,a=s.k[_+1].s,k=s.k[_].to,O=s.k[_].ti,(R.length===2&&!(R[0]===a[0]&&R[1]===a[1])&&bez.pointOnLine2D(R[0],R[1],a[0],a[1],R[0]+k[0],R[1]+k[1])&&bez.pointOnLine2D(R[0],R[1],a[0],a[1],a[0]+O[0],a[1]+O[1])||R.length===3&&!(R[0]===a[0]&&R[1]===a[1]&&R[2]===a[2])&&bez.pointOnLine3D(R[0],R[1],R[2],a[0],a[1],a[2],R[0]+k[0],R[1]+k[1],R[2]+k[2])&&bez.pointOnLine3D(R[0],R[1],R[2],a[0],a[1],a[2],a[0]+O[0],a[1]+O[1],a[2]+O[2]))&&(s.k[_].to=null,s.k[_].ti=null),R[0]===a[0]&&R[1]===a[1]&&k[0]===0&&k[1]===0&&O[0]===0&&O[1]===0&&(R.length===2||R[2]===a[2]&&k[2]===0&&O[2]===0)&&(s.k[_].to=null,s.k[_].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=s,this.keyframes=s.k,this.keyframesMetadata=[],this.offsetTime=t.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=u||1,this.elem=t,this.container=d,this.comp=t.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var j=s.k[0].s.length;for(this.v=createTypedArray("float32",j),this.pv=createTypedArray("float32",j),_=0;_<j;_+=1)this.v[_]=initFrame,this.pv[_]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",j)},this.addEffect=addEffect}var PropertyFactory=(function(){function t(u,d,_,S,R){d.sid&&(d=u.globalData.slotManager.getProp(d));var a;if(!d.k.length)a=new ValueProperty(u,d,S,R);else if(typeof d.k[0]=="number")a=new MultiDimensionalProperty(u,d,S,R);else switch(_){case 0:a=new KeyframedValueProperty(u,d,S,R);break;case 1:a=new KeyframedMultidimensionalProperty(u,d,S,R);break}return a.effectsSequence.length&&R.addDynamicProperty(a),a}var s={getProp:t};return s})();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(s){this.dynamicProperties.indexOf(s)===-1&&(this.dynamicProperties.push(s),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var s,u=this.dynamicProperties.length;for(s=0;s<u;s+=1)this.dynamicProperties[s].getValue(),this.dynamicProperties[s]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(s){this.container=s,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=(function(){function t(){return createTypedArray("float32",2)}return poolFactory(8,t)})();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(t,s){this.c=t,this.setLength(s);for(var u=0;u<s;)this.v[u]=pointPool.newElement(),this.o[u]=pointPool.newElement(),this.i[u]=pointPool.newElement(),u+=1},ShapePath.prototype.setLength=function(t){for(;this._maxLength<t;)this.doubleArrayLength();this._length=t},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(t,s,u,d,_){var S;switch(this._length=Math.max(this._length,d+1),this._length>=this._maxLength&&this.doubleArrayLength(),u){case"v":S=this.v;break;case"i":S=this.i;break;case"o":S=this.o;break;default:S=[];break}(!S[d]||S[d]&&!_)&&(S[d]=pointPool.newElement()),S[d][0]=t,S[d][1]=s},ShapePath.prototype.setTripleAt=function(t,s,u,d,_,S,R,a){this.setXYAt(t,s,"v",R,a),this.setXYAt(u,d,"o",R,a),this.setXYAt(_,S,"i",R,a)},ShapePath.prototype.reverse=function(){var t=new ShapePath;t.setPathData(this.c,this._length);var s=this.v,u=this.o,d=this.i,_=0;this.c&&(t.setTripleAt(s[0][0],s[0][1],d[0][0],d[0][1],u[0][0],u[0][1],0,!1),_=1);var S=this._length-1,R=this._length,a;for(a=_;a<R;a+=1)t.setTripleAt(s[S][0],s[S][1],d[S][0],d[S][1],u[S][0],u[S][1],a,!1),S-=1;return t},ShapePath.prototype.length=function(){return this._length};var shapePool=(function(){function t(){return new ShapePath}function s(_){var S=_._length,R;for(R=0;R<S;R+=1)pointPool.release(_.v[R]),pointPool.release(_.i[R]),pointPool.release(_.o[R]),_.v[R]=null,_.i[R]=null,_.o[R]=null;_._length=0,_.c=!1}function u(_){var S=d.newElement(),R,a=_._length===void 0?_.v.length:_._length;for(S.setLength(a),S.c=_.c,R=0;R<a;R+=1)S.setTripleAt(_.v[R][0],_.v[R][1],_.o[R][0],_.o[R][1],_.i[R][0],_.i[R][1],R);return S}var d=poolFactory(4,t,s);return d.clone=u,d})();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(t){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=t,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var t;for(t=0;t<this._length;t+=1)shapePool.release(this.shapes[t]);this._length=0};var shapeCollectionPool=(function(){var t={newShapeCollection:_,release:S},s=0,u=4,d=createSizedArray(u);function _(){var R;return s?(s-=1,R=d[s]):R=new ShapeCollection,R}function S(R){var a,k=R._length;for(a=0;a<k;a+=1)shapePool.release(R.shapes[a]);R._length=0,s===u&&(d=pooling.double(d),u*=2),d[s]=R,s+=1}return t})(),ShapePropertyFactory=(function(){var t=-999999;function s(ee,se,Q){var oe=Q.lastIndex,_e,Se,ke,Le,lt,qt,Yt,Ot,Bt,si=this.keyframes;if(ee<si[0].t-this.offsetTime)_e=si[0].s[0],ke=!0,oe=0;else if(ee>=si[si.length-1].t-this.offsetTime)_e=si[si.length-1].s?si[si.length-1].s[0]:si[si.length-2].e[0],ke=!0;else{for(var kt=oe,xe=si.length-1,Fe=!0,pe,Te,st;Fe&&(pe=si[kt],Te=si[kt+1],!(Te.t-this.offsetTime>ee));)kt<xe-1?kt+=1:Fe=!1;if(st=this.keyframesMetadata[kt]||{},ke=pe.h===1,oe=kt,!ke){if(ee>=Te.t-this.offsetTime)Ot=1;else if(ee<pe.t-this.offsetTime)Ot=0;else{var Me;st.__fnct?Me=st.__fnct:(Me=BezierFactory.getBezierEasing(pe.o.x,pe.o.y,pe.i.x,pe.i.y).get,st.__fnct=Me),Ot=Me((ee-(pe.t-this.offsetTime))/(Te.t-this.offsetTime-(pe.t-this.offsetTime)))}Se=Te.s?Te.s[0]:pe.e[0]}_e=pe.s[0]}for(qt=se._length,Yt=_e.i[0].length,Q.lastIndex=oe,Le=0;Le<qt;Le+=1)for(lt=0;lt<Yt;lt+=1)Bt=ke?_e.i[Le][lt]:_e.i[Le][lt]+(Se.i[Le][lt]-_e.i[Le][lt])*Ot,se.i[Le][lt]=Bt,Bt=ke?_e.o[Le][lt]:_e.o[Le][lt]+(Se.o[Le][lt]-_e.o[Le][lt])*Ot,se.o[Le][lt]=Bt,Bt=ke?_e.v[Le][lt]:_e.v[Le][lt]+(Se.v[Le][lt]-_e.v[Le][lt])*Ot,se.v[Le][lt]=Bt}function u(){var ee=this.comp.renderedFrame-this.offsetTime,se=this.keyframes[0].t-this.offsetTime,Q=this.keyframes[this.keyframes.length-1].t-this.offsetTime,oe=this._caching.lastFrame;return oe!==t&&(oe<se&&ee<se||oe>Q&&ee>Q)||(this._caching.lastIndex=oe<ee?this._caching.lastIndex:0,this.interpolateShape(ee,this.pv,this._caching)),this._caching.lastFrame=ee,this.pv}function d(){this.paths=this.localShapeCollection}function _(ee,se){if(ee._length!==se._length||ee.c!==se.c)return!1;var Q,oe=ee._length;for(Q=0;Q<oe;Q+=1)if(ee.v[Q][0]!==se.v[Q][0]||ee.v[Q][1]!==se.v[Q][1]||ee.o[Q][0]!==se.o[Q][0]||ee.o[Q][1]!==se.o[Q][1]||ee.i[Q][0]!==se.i[Q][0]||ee.i[Q][1]!==se.i[Q][1])return!1;return!0}function S(ee){_(this.v,ee)||(this.v=shapePool.clone(ee),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function R(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var ee;this.kf?ee=this.pv:this.data.ks?ee=this.data.ks.k:ee=this.data.pt.k;var se,Q=this.effectsSequence.length;for(se=0;se<Q;se+=1)ee=this.effectsSequence[se](ee);this.setVValue(ee),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function a(ee,se,Q){this.propType="shape",this.comp=ee.comp,this.container=ee,this.elem=ee,this.data=se,this.k=!1,this.kf=!1,this._mdf=!1;var oe=Q===3?se.pt.k:se.ks.k;this.v=shapePool.clone(oe),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=d,this.effectsSequence=[]}function k(ee){this.effectsSequence.push(ee),this.container.addDynamicProperty(this)}a.prototype.interpolateShape=s,a.prototype.getValue=R,a.prototype.setVValue=S,a.prototype.addEffect=k;function O(ee,se,Q){this.propType="shape",this.comp=ee.comp,this.elem=ee,this.container=ee,this.offsetTime=ee.data.st,this.keyframes=Q===3?se.pt.k:se.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var oe=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,oe),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=t,this.reset=d,this._caching={lastFrame:t,lastIndex:0},this.effectsSequence=[u.bind(this)]}O.prototype.getValue=R,O.prototype.interpolateShape=s,O.prototype.setVValue=S,O.prototype.addEffect=k;var j=(function(){var ee=roundCorner;function se(Q,oe){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=oe.d,this.elem=Q,this.comp=Q.comp,this.frameId=-1,this.initDynamicPropertyContainer(Q),this.p=PropertyFactory.getProp(Q,oe.p,1,0,this),this.s=PropertyFactory.getProp(Q,oe.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return se.prototype={reset:d,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var oe=this.p.v[0],_e=this.p.v[1],Se=this.s.v[0]/2,ke=this.s.v[1]/2,Le=this.d!==3,lt=this.v;lt.v[0][0]=oe,lt.v[0][1]=_e-ke,lt.v[1][0]=Le?oe+Se:oe-Se,lt.v[1][1]=_e,lt.v[2][0]=oe,lt.v[2][1]=_e+ke,lt.v[3][0]=Le?oe-Se:oe+Se,lt.v[3][1]=_e,lt.i[0][0]=Le?oe-Se*ee:oe+Se*ee,lt.i[0][1]=_e-ke,lt.i[1][0]=Le?oe+Se:oe-Se,lt.i[1][1]=_e-ke*ee,lt.i[2][0]=Le?oe+Se*ee:oe-Se*ee,lt.i[2][1]=_e+ke,lt.i[3][0]=Le?oe-Se:oe+Se,lt.i[3][1]=_e+ke*ee,lt.o[0][0]=Le?oe+Se*ee:oe-Se*ee,lt.o[0][1]=_e-ke,lt.o[1][0]=Le?oe+Se:oe-Se,lt.o[1][1]=_e+ke*ee,lt.o[2][0]=Le?oe-Se*ee:oe+Se*ee,lt.o[2][1]=_e+ke,lt.o[3][0]=Le?oe-Se:oe+Se,lt.o[3][1]=_e-ke*ee}},extendPrototype([DynamicPropertyContainer],se),se})(),V=(function(){function ee(se,Q){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=se,this.comp=se.comp,this.data=Q,this.frameId=-1,this.d=Q.d,this.initDynamicPropertyContainer(se),Q.sy===1?(this.ir=PropertyFactory.getProp(se,Q.ir,0,0,this),this.is=PropertyFactory.getProp(se,Q.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(se,Q.pt,0,0,this),this.p=PropertyFactory.getProp(se,Q.p,1,0,this),this.r=PropertyFactory.getProp(se,Q.r,0,degToRads,this),this.or=PropertyFactory.getProp(se,Q.or,0,0,this),this.os=PropertyFactory.getProp(se,Q.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return ee.prototype={reset:d,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var Q=Math.floor(this.pt.v)*2,oe=Math.PI*2/Q,_e=!0,Se=this.or.v,ke=this.ir.v,Le=this.os.v,lt=this.is.v,qt=2*Math.PI*Se/(Q*2),Yt=2*Math.PI*ke/(Q*2),Ot,Bt,si,kt,xe=-Math.PI/2;xe+=this.r.v;var Fe=this.data.d===3?-1:1;for(this.v._length=0,Ot=0;Ot<Q;Ot+=1){Bt=_e?Se:ke,si=_e?Le:lt,kt=_e?qt:Yt;var pe=Bt*Math.cos(xe),Te=Bt*Math.sin(xe),st=pe===0&&Te===0?0:Te/Math.sqrt(pe*pe+Te*Te),Me=pe===0&&Te===0?0:-pe/Math.sqrt(pe*pe+Te*Te);pe+=+this.p.v[0],Te+=+this.p.v[1],this.v.setTripleAt(pe,Te,pe-st*kt*si*Fe,Te-Me*kt*si*Fe,pe+st*kt*si*Fe,Te+Me*kt*si*Fe,Ot,!0),_e=!_e,xe+=oe*Fe}},convertPolygonToPath:function(){var Q=Math.floor(this.pt.v),oe=Math.PI*2/Q,_e=this.or.v,Se=this.os.v,ke=2*Math.PI*_e/(Q*4),Le,lt=-Math.PI*.5,qt=this.data.d===3?-1:1;for(lt+=this.r.v,this.v._length=0,Le=0;Le<Q;Le+=1){var Yt=_e*Math.cos(lt),Ot=_e*Math.sin(lt),Bt=Yt===0&&Ot===0?0:Ot/Math.sqrt(Yt*Yt+Ot*Ot),si=Yt===0&&Ot===0?0:-Yt/Math.sqrt(Yt*Yt+Ot*Ot);Yt+=+this.p.v[0],Ot+=+this.p.v[1],this.v.setTripleAt(Yt,Ot,Yt-Bt*ke*Se*qt,Ot-si*ke*Se*qt,Yt+Bt*ke*Se*qt,Ot+si*ke*Se*qt,Le,!0),lt+=oe*qt}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],ee),ee})(),G=(function(){function ee(se,Q){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=se,this.comp=se.comp,this.frameId=-1,this.d=Q.d,this.initDynamicPropertyContainer(se),this.p=PropertyFactory.getProp(se,Q.p,1,0,this),this.s=PropertyFactory.getProp(se,Q.s,1,0,this),this.r=PropertyFactory.getProp(se,Q.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return ee.prototype={convertRectToPath:function(){var Q=this.p.v[0],oe=this.p.v[1],_e=this.s.v[0]/2,Se=this.s.v[1]/2,ke=bmMin(_e,Se,this.r.v),Le=ke*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(Q+_e,oe-Se+ke,Q+_e,oe-Se+ke,Q+_e,oe-Se+Le,0,!0),this.v.setTripleAt(Q+_e,oe+Se-ke,Q+_e,oe+Se-Le,Q+_e,oe+Se-ke,1,!0),ke!==0?(this.v.setTripleAt(Q+_e-ke,oe+Se,Q+_e-ke,oe+Se,Q+_e-Le,oe+Se,2,!0),this.v.setTripleAt(Q-_e+ke,oe+Se,Q-_e+Le,oe+Se,Q-_e+ke,oe+Se,3,!0),this.v.setTripleAt(Q-_e,oe+Se-ke,Q-_e,oe+Se-ke,Q-_e,oe+Se-Le,4,!0),this.v.setTripleAt(Q-_e,oe-Se+ke,Q-_e,oe-Se+Le,Q-_e,oe-Se+ke,5,!0),this.v.setTripleAt(Q-_e+ke,oe-Se,Q-_e+ke,oe-Se,Q-_e+Le,oe-Se,6,!0),this.v.setTripleAt(Q+_e-ke,oe-Se,Q+_e-Le,oe-Se,Q+_e-ke,oe-Se,7,!0)):(this.v.setTripleAt(Q-_e,oe+Se,Q-_e+Le,oe+Se,Q-_e,oe+Se,2),this.v.setTripleAt(Q-_e,oe-Se,Q-_e,oe-Se+Le,Q-_e,oe-Se,3))):(this.v.setTripleAt(Q+_e,oe-Se+ke,Q+_e,oe-Se+Le,Q+_e,oe-Se+ke,0,!0),ke!==0?(this.v.setTripleAt(Q+_e-ke,oe-Se,Q+_e-ke,oe-Se,Q+_e-Le,oe-Se,1,!0),this.v.setTripleAt(Q-_e+ke,oe-Se,Q-_e+Le,oe-Se,Q-_e+ke,oe-Se,2,!0),this.v.setTripleAt(Q-_e,oe-Se+ke,Q-_e,oe-Se+ke,Q-_e,oe-Se+Le,3,!0),this.v.setTripleAt(Q-_e,oe+Se-ke,Q-_e,oe+Se-Le,Q-_e,oe+Se-ke,4,!0),this.v.setTripleAt(Q-_e+ke,oe+Se,Q-_e+ke,oe+Se,Q-_e+Le,oe+Se,5,!0),this.v.setTripleAt(Q+_e-ke,oe+Se,Q+_e-Le,oe+Se,Q+_e-ke,oe+Se,6,!0),this.v.setTripleAt(Q+_e,oe+Se-ke,Q+_e,oe+Se-ke,Q+_e,oe+Se-Le,7,!0)):(this.v.setTripleAt(Q-_e,oe-Se,Q-_e+Le,oe-Se,Q-_e,oe-Se,1,!0),this.v.setTripleAt(Q-_e,oe+Se,Q-_e,oe+Se-Le,Q-_e,oe+Se,2,!0),this.v.setTripleAt(Q+_e,oe+Se,Q+_e-Le,oe+Se,Q+_e,oe+Se,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:d},extendPrototype([DynamicPropertyContainer],ee),ee})();function J(ee,se,Q){var oe;if(Q===3||Q===4){var _e=Q===3?se.pt:se.ks,Se=_e.k;Se.length?oe=new O(ee,se,Q):oe=new a(ee,se,Q)}else Q===5?oe=new G(ee,se):Q===6?oe=new j(ee,se):Q===7&&(oe=new V(ee,se));return oe.k&&ee.addDynamicProperty(oe),oe}function Z(){return a}function Y(){return O}var le={};return le.getShapeProp=J,le.getConstructorFunction=Z,le.getKeyframedConstructorFunction=Y,le})();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=(function(){var t=Math.cos,s=Math.sin,u=Math.tan,d=Math.round;function _(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function S(pe){if(pe===0)return this;var Te=t(pe),st=s(pe);return this._t(Te,-st,0,0,st,Te,0,0,0,0,1,0,0,0,0,1)}function R(pe){if(pe===0)return this;var Te=t(pe),st=s(pe);return this._t(1,0,0,0,0,Te,-st,0,0,st,Te,0,0,0,0,1)}function a(pe){if(pe===0)return this;var Te=t(pe),st=s(pe);return this._t(Te,0,st,0,0,1,0,0,-st,0,Te,0,0,0,0,1)}function k(pe){if(pe===0)return this;var Te=t(pe),st=s(pe);return this._t(Te,-st,0,0,st,Te,0,0,0,0,1,0,0,0,0,1)}function O(pe,Te){return this._t(1,Te,pe,1,0,0)}function j(pe,Te){return this.shear(u(pe),u(Te))}function V(pe,Te){var st=t(Te),Me=s(Te);return this._t(st,Me,0,0,-Me,st,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,u(pe),1,0,0,0,0,1,0,0,0,0,1)._t(st,-Me,0,0,Me,st,0,0,0,0,1,0,0,0,0,1)}function G(pe,Te,st){return!st&&st!==0&&(st=1),pe===1&&Te===1&&st===1?this:this._t(pe,0,0,0,0,Te,0,0,0,0,st,0,0,0,0,1)}function J(pe,Te,st,Me,at,ct,Ct,li,mi,bi,zi,vi,Gi,lr,zr,Ui){return this.props[0]=pe,this.props[1]=Te,this.props[2]=st,this.props[3]=Me,this.props[4]=at,this.props[5]=ct,this.props[6]=Ct,this.props[7]=li,this.props[8]=mi,this.props[9]=bi,this.props[10]=zi,this.props[11]=vi,this.props[12]=Gi,this.props[13]=lr,this.props[14]=zr,this.props[15]=Ui,this}function Z(pe,Te,st){return st=st||0,pe!==0||Te!==0||st!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,pe,Te,st,1):this}function Y(pe,Te,st,Me,at,ct,Ct,li,mi,bi,zi,vi,Gi,lr,zr,Ui){var Ci=this.props;if(pe===1&&Te===0&&st===0&&Me===0&&at===0&&ct===1&&Ct===0&&li===0&&mi===0&&bi===0&&zi===1&&vi===0)return Ci[12]=Ci[12]*pe+Ci[15]*Gi,Ci[13]=Ci[13]*ct+Ci[15]*lr,Ci[14]=Ci[14]*zi+Ci[15]*zr,Ci[15]*=Ui,this._identityCalculated=!1,this;var Gn=Ci[0],Wn=Ci[1],vn=Ci[2],Sr=Ci[3],Xr=Ci[4],es=Ci[5],Un=Ci[6],dn=Ci[7],os=Ci[8],Dr=Ci[9],jn=Ci[10],Rn=Ci[11],ys=Ci[12],As=Ci[13],sa=Ci[14],bn=Ci[15];return Ci[0]=Gn*pe+Wn*at+vn*mi+Sr*Gi,Ci[1]=Gn*Te+Wn*ct+vn*bi+Sr*lr,Ci[2]=Gn*st+Wn*Ct+vn*zi+Sr*zr,Ci[3]=Gn*Me+Wn*li+vn*vi+Sr*Ui,Ci[4]=Xr*pe+es*at+Un*mi+dn*Gi,Ci[5]=Xr*Te+es*ct+Un*bi+dn*lr,Ci[6]=Xr*st+es*Ct+Un*zi+dn*zr,Ci[7]=Xr*Me+es*li+Un*vi+dn*Ui,Ci[8]=os*pe+Dr*at+jn*mi+Rn*Gi,Ci[9]=os*Te+Dr*ct+jn*bi+Rn*lr,Ci[10]=os*st+Dr*Ct+jn*zi+Rn*zr,Ci[11]=os*Me+Dr*li+jn*vi+Rn*Ui,Ci[12]=ys*pe+As*at+sa*mi+bn*Gi,Ci[13]=ys*Te+As*ct+sa*bi+bn*lr,Ci[14]=ys*st+As*Ct+sa*zi+bn*zr,Ci[15]=ys*Me+As*li+sa*vi+bn*Ui,this._identityCalculated=!1,this}function le(pe){var Te=pe.props;return this.transform(Te[0],Te[1],Te[2],Te[3],Te[4],Te[5],Te[6],Te[7],Te[8],Te[9],Te[10],Te[11],Te[12],Te[13],Te[14],Te[15])}function ee(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function se(pe){for(var Te=0;Te<16;){if(pe.props[Te]!==this.props[Te])return!1;Te+=1}return!0}function Q(pe){var Te;for(Te=0;Te<16;Te+=1)pe.props[Te]=this.props[Te];return pe}function oe(pe){var Te;for(Te=0;Te<16;Te+=1)this.props[Te]=pe[Te]}function _e(pe,Te,st){return{x:pe*this.props[0]+Te*this.props[4]+st*this.props[8]+this.props[12],y:pe*this.props[1]+Te*this.props[5]+st*this.props[9]+this.props[13],z:pe*this.props[2]+Te*this.props[6]+st*this.props[10]+this.props[14]}}function Se(pe,Te,st){return pe*this.props[0]+Te*this.props[4]+st*this.props[8]+this.props[12]}function ke(pe,Te,st){return pe*this.props[1]+Te*this.props[5]+st*this.props[9]+this.props[13]}function Le(pe,Te,st){return pe*this.props[2]+Te*this.props[6]+st*this.props[10]+this.props[14]}function lt(){var pe=this.props[0]*this.props[5]-this.props[1]*this.props[4],Te=this.props[5]/pe,st=-this.props[1]/pe,Me=-this.props[4]/pe,at=this.props[0]/pe,ct=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/pe,Ct=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/pe,li=new Matrix;return li.props[0]=Te,li.props[1]=st,li.props[4]=Me,li.props[5]=at,li.props[12]=ct,li.props[13]=Ct,li}function qt(pe){var Te=this.getInverseMatrix();return Te.applyToPointArray(pe[0],pe[1],pe[2]||0)}function Yt(pe){var Te,st=pe.length,Me=[];for(Te=0;Te<st;Te+=1)Me[Te]=qt(pe[Te]);return Me}function Ot(pe,Te,st){var Me=createTypedArray("float32",6);if(this.isIdentity())Me[0]=pe[0],Me[1]=pe[1],Me[2]=Te[0],Me[3]=Te[1],Me[4]=st[0],Me[5]=st[1];else{var at=this.props[0],ct=this.props[1],Ct=this.props[4],li=this.props[5],mi=this.props[12],bi=this.props[13];Me[0]=pe[0]*at+pe[1]*Ct+mi,Me[1]=pe[0]*ct+pe[1]*li+bi,Me[2]=Te[0]*at+Te[1]*Ct+mi,Me[3]=Te[0]*ct+Te[1]*li+bi,Me[4]=st[0]*at+st[1]*Ct+mi,Me[5]=st[0]*ct+st[1]*li+bi}return Me}function Bt(pe,Te,st){var Me;return this.isIdentity()?Me=[pe,Te,st]:Me=[pe*this.props[0]+Te*this.props[4]+st*this.props[8]+this.props[12],pe*this.props[1]+Te*this.props[5]+st*this.props[9]+this.props[13],pe*this.props[2]+Te*this.props[6]+st*this.props[10]+this.props[14]],Me}function si(pe,Te){if(this.isIdentity())return pe+","+Te;var st=this.props;return Math.round((pe*st[0]+Te*st[4]+st[12])*100)/100+","+Math.round((pe*st[1]+Te*st[5]+st[13])*100)/100}function kt(){for(var pe=0,Te=this.props,st="matrix3d(",Me=1e4;pe<16;)st+=d(Te[pe]*Me)/Me,st+=pe===15?")":",",pe+=1;return st}function xe(pe){var Te=1e4;return pe<1e-6&&pe>0||pe>-1e-6&&pe<0?d(pe*Te)/Te:pe}function Fe(){var pe=this.props,Te=xe(pe[0]),st=xe(pe[1]),Me=xe(pe[4]),at=xe(pe[5]),ct=xe(pe[12]),Ct=xe(pe[13]);return"matrix("+Te+","+st+","+Me+","+at+","+ct+","+Ct+")"}return function(){this.reset=_,this.rotate=S,this.rotateX=R,this.rotateY=a,this.rotateZ=k,this.skew=j,this.skewFromAxis=V,this.shear=O,this.scale=G,this.setTransform=J,this.translate=Z,this.transform=Y,this.multiply=le,this.applyToPoint=_e,this.applyToX=Se,this.applyToY=ke,this.applyToZ=Le,this.applyToPointArray=Bt,this.applyToTriplePoints=Ot,this.applyToPointStringified=si,this.toCSS=kt,this.to2dCSS=Fe,this.clone=Q,this.cloneFromProps=oe,this.equals=se,this.inversePoints=Yt,this.inversePoint=qt,this.getInverseMatrix=lt,this._t=this.transform,this.isIdentity=ee,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}})();function _typeof$3(t){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$3(t)}var lottie={};function setLocation(t){setLocationHref(t)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(t){setSubframeEnabled(t)}function setPrefix(t){setIdPrefix(t)}function loadAnimation(t){return animationManager.loadAnimation(t)}function setQuality(t){if(typeof t=="string")switch(t){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(t)&&t>1&&setDefaultCurveSegments(t)}function inBrowser(){return typeof navigator<"u"}function installPlugin(t,s){t==="expressions"&&setExpressionsPlugin(s)}function getFactory(t){switch(t){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(t){for(var s=queryString.split("&"),u=0;u<s.length;u+=1){var d=s[u].split("=");if(decodeURIComponent(d[0])==t)return decodeURIComponent(d[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports$1)!=="object"&&(window.bodymovin=lottie)}catch(t){}var ShapeModifiers=(function(){var t={},s={};t.registerModifier=u,t.getModifier=d;function u(_,S){s[_]||(s[_]=S)}function d(_,S,R){return new s[_](S,R)}return t})();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(t){if(!this.closed){t.sh.container.addDynamicProperty(t.sh);var s={shape:t.sh,data:t,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(s),this.addShapeToModifier(s),this._isAnimated&&t.setAsAnimated()}},ShapeModifier.prototype.init=function(t,s){this.shapes=[],this.elem=t,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,s),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(t,s){this.s=PropertyFactory.getProp(t,s.s,0,.01,this),this.e=PropertyFactory.getProp(t,s.e,0,.01,this),this.o=PropertyFactory.getProp(t,s.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=s.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(t){t.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(t,s,u,d,_){var S=[];s<=1?S.push({s:t,e:s}):t>=1?S.push({s:t-1,e:s-1}):(S.push({s:t,e:1}),S.push({s:0,e:s-1}));var R=[],a,k=S.length,O;for(a=0;a<k;a+=1)if(O=S[a],!(O.e*_<d||O.s*_>d+u)){var j,V;O.s*_<=d?j=0:j=(O.s*_-d)/u,O.e*_>=d+u?V=1:V=(O.e*_-d)/u,R.push([j,V])}return R.length||R.push([0,0]),R},TrimModifier.prototype.releasePathsData=function(t){var s,u=t.length;for(s=0;s<u;s+=1)segmentsLengthPool.release(t[s]);return t.length=0,t},TrimModifier.prototype.processShapes=function(t){var s,u;if(this._mdf||t){var d=this.o.v%360/360;if(d<0&&(d+=1),this.s.v>1?s=1+d:this.s.v<0?s=0+d:s=this.s.v+d,this.e.v>1?u=1+d:this.e.v<0?u=0+d:u=this.e.v+d,s>u){var _=s;s=u,u=_}s=Math.round(s*1e4)*1e-4,u=Math.round(u*1e4)*1e-4,this.sValue=s,this.eValue=u}else s=this.sValue,u=this.eValue;var S,R,a=this.shapes.length,k,O,j,V,G,J=0;if(u===s)for(R=0;R<a;R+=1)this.shapes[R].localShapeCollection.releaseShapes(),this.shapes[R].shape._mdf=!0,this.shapes[R].shape.paths=this.shapes[R].localShapeCollection,this._mdf&&(this.shapes[R].pathsData.length=0);else if(u===1&&s===0||u===0&&s===1){if(this._mdf)for(R=0;R<a;R+=1)this.shapes[R].pathsData.length=0,this.shapes[R].shape._mdf=!0}else{var Z=[],Y,le;for(R=0;R<a;R+=1)if(Y=this.shapes[R],!Y.shape._mdf&&!this._mdf&&!t&&this.m!==2)Y.shape.paths=Y.localShapeCollection;else{if(S=Y.shape.paths,O=S._length,G=0,!Y.shape._mdf&&Y.pathsData.length)G=Y.totalShapeLength;else{for(j=this.releasePathsData(Y.pathsData),k=0;k<O;k+=1)V=bez.getSegmentsLength(S.shapes[k]),j.push(V),G+=V.totalLength;Y.totalShapeLength=G,Y.pathsData=j}J+=G,Y.shape._mdf=!0}var ee=s,se=u,Q=0,oe;for(R=a-1;R>=0;R-=1)if(Y=this.shapes[R],Y.shape._mdf){for(le=Y.localShapeCollection,le.releaseShapes(),this.m===2&&a>1?(oe=this.calculateShapeEdges(s,u,Y.totalShapeLength,Q,J),Q+=Y.totalShapeLength):oe=[[ee,se]],O=oe.length,k=0;k<O;k+=1){ee=oe[k][0],se=oe[k][1],Z.length=0,se<=1?Z.push({s:Y.totalShapeLength*ee,e:Y.totalShapeLength*se}):ee>=1?Z.push({s:Y.totalShapeLength*(ee-1),e:Y.totalShapeLength*(se-1)}):(Z.push({s:Y.totalShapeLength*ee,e:Y.totalShapeLength}),Z.push({s:0,e:Y.totalShapeLength*(se-1)}));var _e=this.addShapes(Y,Z[0]);if(Z[0].s!==Z[0].e){if(Z.length>1){var Se=Y.shape.paths.shapes[Y.shape.paths._length-1];if(Se.c){var ke=_e.pop();this.addPaths(_e,le),_e=this.addShapes(Y,Z[1],ke)}else this.addPaths(_e,le),_e=this.addShapes(Y,Z[1])}this.addPaths(_e,le)}}Y.shape.paths=le}}},TrimModifier.prototype.addPaths=function(t,s){var u,d=t.length;for(u=0;u<d;u+=1)s.addShape(t[u])},TrimModifier.prototype.addSegment=function(t,s,u,d,_,S,R){_.setXYAt(s[0],s[1],"o",S),_.setXYAt(u[0],u[1],"i",S+1),R&&_.setXYAt(t[0],t[1],"v",S),_.setXYAt(d[0],d[1],"v",S+1)},TrimModifier.prototype.addSegmentFromArray=function(t,s,u,d){s.setXYAt(t[1],t[5],"o",u),s.setXYAt(t[2],t[6],"i",u+1),d&&s.setXYAt(t[0],t[4],"v",u),s.setXYAt(t[3],t[7],"v",u+1)},TrimModifier.prototype.addShapes=function(t,s,u){var d=t.pathsData,_=t.shape.paths.shapes,S,R=t.shape.paths._length,a,k,O=0,j,V,G,J,Z=[],Y,le=!0;for(u?(V=u._length,Y=u._length):(u=shapePool.newElement(),V=0,Y=0),Z.push(u),S=0;S<R;S+=1){for(G=d[S].lengths,u.c=_[S].c,k=_[S].c?G.length:G.length+1,a=1;a<k;a+=1)if(j=G[a-1],O+j.addedLength<s.s)O+=j.addedLength,u.c=!1;else if(O>s.e){u.c=!1;break}else s.s<=O&&s.e>=O+j.addedLength?(this.addSegment(_[S].v[a-1],_[S].o[a-1],_[S].i[a],_[S].v[a],u,V,le),le=!1):(J=bez.getNewSegment(_[S].v[a-1],_[S].v[a],_[S].o[a-1],_[S].i[a],(s.s-O)/j.addedLength,(s.e-O)/j.addedLength,G[a-1]),this.addSegmentFromArray(J,u,V,le),le=!1,u.c=!1),O+=j.addedLength,V+=1;if(_[S].c&&G.length){if(j=G[a-1],O<=s.e){var ee=G[a-1].addedLength;s.s<=O&&s.e>=O+ee?(this.addSegment(_[S].v[a-1],_[S].o[a-1],_[S].i[0],_[S].v[0],u,V,le),le=!1):(J=bez.getNewSegment(_[S].v[a-1],_[S].v[0],_[S].o[a-1],_[S].i[0],(s.s-O)/ee,(s.e-O)/ee,G[a-1]),this.addSegmentFromArray(J,u,V,le),le=!1,u.c=!1)}else u.c=!1;O+=j.addedLength,V+=1}if(u._length&&(u.setXYAt(u.v[Y][0],u.v[Y][1],"i",Y),u.setXYAt(u.v[u._length-1][0],u.v[u._length-1][1],"o",u._length-1)),O>s.e)break;S<R-1&&(u=shapePool.newElement(),le=!0,Z.push(u),V=0)}return Z};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(t,s){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(t,s.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(t,s){var u=s/100,d=[0,0],_=t._length,S=0;for(S=0;S<_;S+=1)d[0]+=t.v[S][0],d[1]+=t.v[S][1];d[0]/=_,d[1]/=_;var R=shapePool.newElement();R.c=t.c;var a,k,O,j,V,G;for(S=0;S<_;S+=1)a=t.v[S][0]+(d[0]-t.v[S][0])*u,k=t.v[S][1]+(d[1]-t.v[S][1])*u,O=t.o[S][0]+(d[0]-t.o[S][0])*-u,j=t.o[S][1]+(d[1]-t.o[S][1])*-u,V=t.i[S][0]+(d[0]-t.i[S][0])*-u,G=t.i[S][1]+(d[1]-t.i[S][1])*-u,R.setTripleAt(a,k,O,j,V,G,S);return R},PuckerAndBloatModifier.prototype.processShapes=function(t){var s,u,d=this.shapes.length,_,S,R=this.amount.v;if(R!==0){var a,k;for(u=0;u<d;u+=1){if(a=this.shapes[u],k=a.localShapeCollection,!(!a.shape._mdf&&!this._mdf&&!t))for(k.releaseShapes(),a.shape._mdf=!0,s=a.shape.paths.shapes,S=a.shape.paths._length,_=0;_<S;_+=1)k.addShape(this.processPath(s[_],R));a.shape.paths=a.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=(function(){var t=[0,0];function s(k){var O=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||O,this.a&&k.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&k.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&k.skewFromAxis(-this.sk.v,this.sa.v),this.r?k.rotate(-this.r.v):k.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?k.translate(this.px.v,this.py.v,-this.pz.v):k.translate(this.px.v,this.py.v,0):k.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function u(k){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||k){var O;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var j,V;if(O=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(j=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/O,0),V=this.p.getValueAtTime(this.p.keyframes[0].t/O,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(j=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/O,0),V=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/O,0)):(j=this.p.pv,V=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/O,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){j=[],V=[];var G=this.px,J=this.py;G._caching.lastFrame+G.offsetTime<=G.keyframes[0].t?(j[0]=G.getValueAtTime((G.keyframes[0].t+.01)/O,0),j[1]=J.getValueAtTime((J.keyframes[0].t+.01)/O,0),V[0]=G.getValueAtTime(G.keyframes[0].t/O,0),V[1]=J.getValueAtTime(J.keyframes[0].t/O,0)):G._caching.lastFrame+G.offsetTime>=G.keyframes[G.keyframes.length-1].t?(j[0]=G.getValueAtTime(G.keyframes[G.keyframes.length-1].t/O,0),j[1]=J.getValueAtTime(J.keyframes[J.keyframes.length-1].t/O,0),V[0]=G.getValueAtTime((G.keyframes[G.keyframes.length-1].t-.01)/O,0),V[1]=J.getValueAtTime((J.keyframes[J.keyframes.length-1].t-.01)/O,0)):(j=[G.pv,J.pv],V[0]=G.getValueAtTime((G._caching.lastFrame+G.offsetTime-.01)/O,G.offsetTime),V[1]=J.getValueAtTime((J._caching.lastFrame+J.offsetTime-.01)/O,J.offsetTime))}else V=t,j=V;this.v.rotate(-Math.atan2(j[1]-V[1],j[0]-V[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function d(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function _(){}function S(k){this._addDynamicProperty(k),this.elem.addDynamicProperty(k),this._isDirty=!0}function R(k,O,j){if(this.elem=k,this.frameId=-1,this.propType="transform",this.data=O,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(j||k),O.p&&O.p.s?(this.px=PropertyFactory.getProp(k,O.p.x,0,0,this),this.py=PropertyFactory.getProp(k,O.p.y,0,0,this),O.p.z&&(this.pz=PropertyFactory.getProp(k,O.p.z,0,0,this))):this.p=PropertyFactory.getProp(k,O.p||{k:[0,0,0]},1,0,this),O.rx){if(this.rx=PropertyFactory.getProp(k,O.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(k,O.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(k,O.rz,0,degToRads,this),O.or.k[0].ti){var V,G=O.or.k.length;for(V=0;V<G;V+=1)O.or.k[V].to=null,O.or.k[V].ti=null}this.or=PropertyFactory.getProp(k,O.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(k,O.r||{k:0},0,degToRads,this);O.sk&&(this.sk=PropertyFactory.getProp(k,O.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(k,O.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(k,O.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(k,O.s||{k:[100,100,100]},1,.01,this),O.o?this.o=PropertyFactory.getProp(k,O.o,0,.01,k):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}R.prototype={applyToMatrix:s,getValue:u,precalculateMatrix:d,autoOrient:_},extendPrototype([DynamicPropertyContainer],R),R.prototype.addDynamicProperty=S,R.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function a(k,O,j){return new R(k,O,j)}return{getTransformProperty:a}})();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(t,s){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(t,s.c,0,null,this),this.o=PropertyFactory.getProp(t,s.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(t,s.tr,this),this.so=PropertyFactory.getProp(t,s.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(t,s.tr.eo,0,.01,this),this.data=s,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(t,s,u,d,_,S){var R=S?-1:1,a=d.s.v[0]+(1-d.s.v[0])*(1-_),k=d.s.v[1]+(1-d.s.v[1])*(1-_);t.translate(d.p.v[0]*R*_,d.p.v[1]*R*_,d.p.v[2]),s.translate(-d.a.v[0],-d.a.v[1],d.a.v[2]),s.rotate(-d.r.v*R*_),s.translate(d.a.v[0],d.a.v[1],d.a.v[2]),u.translate(-d.a.v[0],-d.a.v[1],d.a.v[2]),u.scale(S?1/a:a,S?1/k:k),u.translate(d.a.v[0],d.a.v[1],d.a.v[2])},RepeaterModifier.prototype.init=function(t,s,u,d){for(this.elem=t,this.arr=s,this.pos=u,this.elemsData=d,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,s[u]);u>0;)u-=1,this._elements.unshift(s[u]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(t){var s,u=t.length;for(s=0;s<u;s+=1)t[s]._processed=!1,t[s].ty==="gr"&&this.resetElements(t[s].it)},RepeaterModifier.prototype.cloneElements=function(t){var s=JSON.parse(JSON.stringify(t));return this.resetElements(s),s},RepeaterModifier.prototype.changeGroupRender=function(t,s){var u,d=t.length;for(u=0;u<d;u+=1)t[u]._render=s,t[u].ty==="gr"&&this.changeGroupRender(t[u].it,s)},RepeaterModifier.prototype.processShapes=function(t){var s,u,d,_,S,R=!1;if(this._mdf||t){var a=Math.ceil(this.c.v);if(this._groups.length<a){for(;this._groups.length<a;){var k={it:this.cloneElements(this._elements),ty:"gr"};k.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,k),this._groups.splice(0,0,k),this._currentCopies+=1}this.elem.reloadShapes(),R=!0}S=0;var O;for(d=0;d<=this._groups.length-1;d+=1){if(O=S<a,this._groups[d]._render=O,this.changeGroupRender(this._groups[d].it,O),!O){var j=this.elemsData[d].it,V=j[j.length-1];V.transform.op.v!==0?(V.transform.op._mdf=!0,V.transform.op.v=0):V.transform.op._mdf=!1}S+=1}this._currentCopies=a;var G=this.o.v,J=G%1,Z=G>0?Math.floor(G):Math.ceil(G),Y=this.pMatrix.props,le=this.rMatrix.props,ee=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var se=0;if(G>0){for(;se<Z;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),se+=1;J&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,J,!1),se+=J)}else if(G<0){for(;se>Z;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),se-=1;J&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-J,!0),se-=J)}d=this.data.m===1?0:this._currentCopies-1,_=this.data.m===1?1:-1,S=this._currentCopies;for(var Q,oe;S;){if(s=this.elemsData[d].it,u=s[s.length-1].transform.mProps.v.props,oe=u.length,s[s.length-1].transform.mProps._mdf=!0,s[s.length-1].transform.op._mdf=!0,s[s.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(d/(this._currentCopies-1)),se!==0){for((d!==0&&_===1||d!==this._currentCopies-1&&_===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(le[0],le[1],le[2],le[3],le[4],le[5],le[6],le[7],le[8],le[9],le[10],le[11],le[12],le[13],le[14],le[15]),this.matrix.transform(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5],ee[6],ee[7],ee[8],ee[9],ee[10],ee[11],ee[12],ee[13],ee[14],ee[15]),this.matrix.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5],Y[6],Y[7],Y[8],Y[9],Y[10],Y[11],Y[12],Y[13],Y[14],Y[15]),Q=0;Q<oe;Q+=1)u[Q]=this.matrix.props[Q];this.matrix.reset()}else for(this.matrix.reset(),Q=0;Q<oe;Q+=1)u[Q]=this.matrix.props[Q];se+=1,S-=1,d+=_}}else for(S=this._currentCopies,d=0,_=1;S;)s=this.elemsData[d].it,u=s[s.length-1].transform.mProps.v.props,s[s.length-1].transform.mProps._mdf=!1,s[s.length-1].transform.op._mdf=!1,S-=1,d+=_;return R},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(t,s){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(t,s.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(t,s){var u=shapePool.newElement();u.c=t.c;var d,_=t._length,S,R,a,k,O,j,V=0,G,J,Z,Y,le,ee;for(d=0;d<_;d+=1)S=t.v[d],a=t.o[d],R=t.i[d],S[0]===a[0]&&S[1]===a[1]&&S[0]===R[0]&&S[1]===R[1]?(d===0||d===_-1)&&!t.c?(u.setTripleAt(S[0],S[1],a[0],a[1],R[0],R[1],V),V+=1):(d===0?k=t.v[_-1]:k=t.v[d-1],O=Math.sqrt(Math.pow(S[0]-k[0],2)+Math.pow(S[1]-k[1],2)),j=O?Math.min(O/2,s)/O:0,le=S[0]+(k[0]-S[0])*j,G=le,ee=S[1]-(S[1]-k[1])*j,J=ee,Z=G-(G-S[0])*roundCorner,Y=J-(J-S[1])*roundCorner,u.setTripleAt(G,J,Z,Y,le,ee,V),V+=1,d===_-1?k=t.v[0]:k=t.v[d+1],O=Math.sqrt(Math.pow(S[0]-k[0],2)+Math.pow(S[1]-k[1],2)),j=O?Math.min(O/2,s)/O:0,Z=S[0]+(k[0]-S[0])*j,G=Z,Y=S[1]+(k[1]-S[1])*j,J=Y,le=G-(G-S[0])*roundCorner,ee=J-(J-S[1])*roundCorner,u.setTripleAt(G,J,Z,Y,le,ee,V),V+=1):(u.setTripleAt(t.v[d][0],t.v[d][1],t.o[d][0],t.o[d][1],t.i[d][0],t.i[d][1],V),V+=1);return u},RoundCornersModifier.prototype.processShapes=function(t){var s,u,d=this.shapes.length,_,S,R=this.rd.v;if(R!==0){var a,k;for(u=0;u<d;u+=1){if(a=this.shapes[u],k=a.localShapeCollection,!(!a.shape._mdf&&!this._mdf&&!t))for(k.releaseShapes(),a.shape._mdf=!0,s=a.shape.paths.shapes,S=a.shape.paths._length,_=0;_<S;_+=1)k.addShape(this.processPath(s[_],R));a.shape.paths=a.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(t,s){return Math.abs(t-s)*1e5<=Math.min(Math.abs(t),Math.abs(s))}function floatZero(t){return Math.abs(t)<=1e-5}function lerp(t,s,u){return t*(1-u)+s*u}function lerpPoint(t,s,u){return[lerp(t[0],s[0],u),lerp(t[1],s[1],u)]}function quadRoots(t,s,u){if(t===0)return[];var d=s*s-4*t*u;if(d<0)return[];var _=-s/(2*t);if(d===0)return[_];var S=Math.sqrt(d)/(2*t);return[_-S,_+S]}function polynomialCoefficients(t,s,u,d){return[-t+3*s-3*u+d,3*t-6*s+3*u,-3*t+3*s,t]}function singlePoint(t){return new PolynomialBezier(t,t,t,t,!1)}function PolynomialBezier(t,s,u,d,_){_&&pointEqual(t,s)&&(s=lerpPoint(t,d,1/3)),_&&pointEqual(u,d)&&(u=lerpPoint(t,d,2/3));var S=polynomialCoefficients(t[0],s[0],u[0],d[0]),R=polynomialCoefficients(t[1],s[1],u[1],d[1]);this.a=[S[0],R[0]],this.b=[S[1],R[1]],this.c=[S[2],R[2]],this.d=[S[3],R[3]],this.points=[t,s,u,d]}PolynomialBezier.prototype.point=function(t){return[((this.a[0]*t+this.b[0])*t+this.c[0])*t+this.d[0],((this.a[1]*t+this.b[1])*t+this.c[1])*t+this.d[1]]},PolynomialBezier.prototype.derivative=function(t){return[(3*t*this.a[0]+2*this.b[0])*t+this.c[0],(3*t*this.a[1]+2*this.b[1])*t+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(t){var s=this.derivative(t);return Math.atan2(s[1],s[0])},PolynomialBezier.prototype.normalAngle=function(t){var s=this.derivative(t);return Math.atan2(s[0],s[1])},PolynomialBezier.prototype.inflectionPoints=function(){var t=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(t))return[];var s=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/t,u=s*s-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/t;if(u<0)return[];var d=Math.sqrt(u);return floatZero(d)?d>0&&d<1?[s]:[]:[s-d,s+d].filter(function(_){return _>0&&_<1})},PolynomialBezier.prototype.split=function(t){if(t<=0)return[singlePoint(this.points[0]),this];if(t>=1)return[this,singlePoint(this.points[this.points.length-1])];var s=lerpPoint(this.points[0],this.points[1],t),u=lerpPoint(this.points[1],this.points[2],t),d=lerpPoint(this.points[2],this.points[3],t),_=lerpPoint(s,u,t),S=lerpPoint(u,d,t),R=lerpPoint(_,S,t);return[new PolynomialBezier(this.points[0],s,_,R,!0),new PolynomialBezier(R,S,d,this.points[3],!0)]};function extrema(t,s){var u=t.points[0][s],d=t.points[t.points.length-1][s];if(u>d){var _=d;d=u,u=_}for(var S=quadRoots(3*t.a[s],2*t.b[s],t.c[s]),R=0;R<S.length;R+=1)if(S[R]>0&&S[R]<1){var a=t.point(S[R])[s];a<u?u=a:a>d&&(d=a)}return{min:u,max:d}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var t=this.bounds();return{left:t.x.min,right:t.x.max,top:t.y.min,bottom:t.y.max,width:t.x.max-t.x.min,height:t.y.max-t.y.min,cx:(t.x.max+t.x.min)/2,cy:(t.y.max+t.y.min)/2}};function intersectData(t,s,u){var d=t.boundingBox();return{cx:d.cx,cy:d.cy,width:d.width,height:d.height,bez:t,t:(s+u)/2,t1:s,t2:u}}function splitData(t){var s=t.bez.split(.5);return[intersectData(s[0],t.t1,t.t),intersectData(s[1],t.t,t.t2)]}function boxIntersect(t,s){return Math.abs(t.cx-s.cx)*2<t.width+s.width&&Math.abs(t.cy-s.cy)*2<t.height+s.height}function intersectsImpl(t,s,u,d,_,S){if(boxIntersect(t,s)){if(u>=S||t.width<=d&&t.height<=d&&s.width<=d&&s.height<=d){_.push([t.t,s.t]);return}var R=splitData(t),a=splitData(s);intersectsImpl(R[0],a[0],u+1,d,_,S),intersectsImpl(R[0],a[1],u+1,d,_,S),intersectsImpl(R[1],a[0],u+1,d,_,S),intersectsImpl(R[1],a[1],u+1,d,_,S)}}PolynomialBezier.prototype.intersections=function(t,s,u){s===void 0&&(s=2),u===void 0&&(u=7);var d=[];return intersectsImpl(intersectData(this,0,1),intersectData(t,0,1),0,s,d,u),d},PolynomialBezier.shapeSegment=function(t,s){var u=(s+1)%t.length();return new PolynomialBezier(t.v[s],t.o[s],t.i[u],t.v[u],!0)},PolynomialBezier.shapeSegmentInverted=function(t,s){var u=(s+1)%t.length();return new PolynomialBezier(t.v[u],t.i[u],t.o[s],t.v[s],!0)};function crossProduct(t,s){return[t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0]]}function lineIntersection(t,s,u,d){var _=[t[0],t[1],1],S=[s[0],s[1],1],R=[u[0],u[1],1],a=[d[0],d[1],1],k=crossProduct(crossProduct(_,S),crossProduct(R,a));return floatZero(k[2])?null:[k[0]/k[2],k[1]/k[2]]}function polarOffset(t,s,u){return[t[0]+Math.cos(s)*u,t[1]-Math.sin(s)*u]}function pointDistance(t,s){return Math.hypot(t[0]-s[0],t[1]-s[1])}function pointEqual(t,s){return floatEqual(t[0],s[0])&&floatEqual(t[1],s[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(t,s){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(t,s.s,0,null,this),this.frequency=PropertyFactory.getProp(t,s.r,0,null,this),this.pointsType=PropertyFactory.getProp(t,s.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(t,s,u,d,_,S,R){var a=u-Math.PI/2,k=u+Math.PI/2,O=s[0]+Math.cos(u)*d*_,j=s[1]-Math.sin(u)*d*_;t.setTripleAt(O,j,O+Math.cos(a)*S,j-Math.sin(a)*S,O+Math.cos(k)*R,j-Math.sin(k)*R,t.length())}function getPerpendicularVector(t,s){var u=[s[0]-t[0],s[1]-t[1]],d=-Math.PI*.5,_=[Math.cos(d)*u[0]-Math.sin(d)*u[1],Math.sin(d)*u[0]+Math.cos(d)*u[1]];return _}function getProjectingAngle(t,s){var u=s===0?t.length()-1:s-1,d=(s+1)%t.length(),_=t.v[u],S=t.v[d],R=getPerpendicularVector(_,S);return Math.atan2(0,1)-Math.atan2(R[1],R[0])}function zigZagCorner(t,s,u,d,_,S,R){var a=getProjectingAngle(s,u),k=s.v[u%s._length],O=s.v[u===0?s._length-1:u-1],j=s.v[(u+1)%s._length],V=S===2?Math.sqrt(Math.pow(k[0]-O[0],2)+Math.pow(k[1]-O[1],2)):0,G=S===2?Math.sqrt(Math.pow(k[0]-j[0],2)+Math.pow(k[1]-j[1],2)):0;setPoint(t,s.v[u%s._length],a,R,d,G/((_+1)*2),V/((_+1)*2))}function zigZagSegment(t,s,u,d,_,S){for(var R=0;R<d;R+=1){var a=(R+1)/(d+1),k=_===2?Math.sqrt(Math.pow(s.points[3][0]-s.points[0][0],2)+Math.pow(s.points[3][1]-s.points[0][1],2)):0,O=s.normalAngle(a),j=s.point(a);setPoint(t,j,O,S,u,k/((d+1)*2),k/((d+1)*2)),S=-S}return S}ZigZagModifier.prototype.processPath=function(t,s,u,d){var _=t._length,S=shapePool.newElement();if(S.c=t.c,t.c||(_-=1),_===0)return S;var R=-1,a=PolynomialBezier.shapeSegment(t,0);zigZagCorner(S,t,0,s,u,d,R);for(var k=0;k<_;k+=1)R=zigZagSegment(S,a,s,u,d,-R),k===_-1&&!t.c?a=null:a=PolynomialBezier.shapeSegment(t,(k+1)%_),zigZagCorner(S,t,k+1,s,u,d,R);return S},ZigZagModifier.prototype.processShapes=function(t){var s,u,d=this.shapes.length,_,S,R=this.amplitude.v,a=Math.max(0,Math.round(this.frequency.v)),k=this.pointsType.v;if(R!==0){var O,j;for(u=0;u<d;u+=1){if(O=this.shapes[u],j=O.localShapeCollection,!(!O.shape._mdf&&!this._mdf&&!t))for(j.releaseShapes(),O.shape._mdf=!0,s=O.shape.paths.shapes,S=O.shape.paths._length,_=0;_<S;_+=1)j.addShape(this.processPath(s[_],R,a,k));O.shape.paths=O.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(t,s,u){var d=Math.atan2(s[0]-t[0],s[1]-t[1]);return[polarOffset(t,d,u),polarOffset(s,d,u)]}function offsetSegment(t,s){var u,d,_,S,R,a,k;k=linearOffset(t.points[0],t.points[1],s),u=k[0],d=k[1],k=linearOffset(t.points[1],t.points[2],s),_=k[0],S=k[1],k=linearOffset(t.points[2],t.points[3],s),R=k[0],a=k[1];var O=lineIntersection(u,d,_,S);O===null&&(O=d);var j=lineIntersection(R,a,_,S);return j===null&&(j=R),new PolynomialBezier(u,O,j,a)}function joinLines(t,s,u,d,_){var S=s.points[3],R=u.points[0];if(d===3||pointEqual(S,R))return S;if(d===2){var a=-s.tangentAngle(1),k=-u.tangentAngle(0)+Math.PI,O=lineIntersection(S,polarOffset(S,a+Math.PI/2,100),R,polarOffset(R,a+Math.PI/2,100)),j=O?pointDistance(O,S):pointDistance(S,R)/2,V=polarOffset(S,a,2*j*roundCorner);return t.setXYAt(V[0],V[1],"o",t.length()-1),V=polarOffset(R,k,2*j*roundCorner),t.setTripleAt(R[0],R[1],R[0],R[1],V[0],V[1],t.length()),R}var G=pointEqual(S,s.points[2])?s.points[0]:s.points[2],J=pointEqual(R,u.points[1])?u.points[3]:u.points[1],Z=lineIntersection(G,S,R,J);return Z&&pointDistance(Z,S)<_?(t.setTripleAt(Z[0],Z[1],Z[0],Z[1],Z[0],Z[1],t.length()),Z):S}function getIntersection(t,s){var u=t.intersections(s);return u.length&&floatEqual(u[0][0],1)&&u.shift(),u.length?u[0]:null}function pruneSegmentIntersection(t,s){var u=t.slice(),d=s.slice(),_=getIntersection(t[t.length-1],s[0]);return _&&(u[t.length-1]=t[t.length-1].split(_[0])[0],d[0]=s[0].split(_[1])[1]),t.length>1&&s.length>1&&(_=getIntersection(t[0],s[s.length-1]),_)?[[t[0].split(_[0])[0]],[s[s.length-1].split(_[1])[1]]]:[u,d]}function pruneIntersections(t){for(var s,u=1;u<t.length;u+=1)s=pruneSegmentIntersection(t[u-1],t[u]),t[u-1]=s[0],t[u]=s[1];return t.length>1&&(s=pruneSegmentIntersection(t[t.length-1],t[0]),t[t.length-1]=s[0],t[0]=s[1]),t}function offsetSegmentSplit(t,s){var u=t.inflectionPoints(),d,_,S,R;if(u.length===0)return[offsetSegment(t,s)];if(u.length===1||floatEqual(u[1],1))return S=t.split(u[0]),d=S[0],_=S[1],[offsetSegment(d,s),offsetSegment(_,s)];S=t.split(u[0]),d=S[0];var a=(u[1]-u[0])/(1-u[0]);return S=S[1].split(a),R=S[0],_=S[1],[offsetSegment(d,s),offsetSegment(R,s),offsetSegment(_,s)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(t,s){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(t,s.a,0,null,this),this.miterLimit=PropertyFactory.getProp(t,s.ml,0,null,this),this.lineJoin=s.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(t,s,u,d){var _=shapePool.newElement();_.c=t.c;var S=t.length();t.c||(S-=1);var R,a,k,O=[];for(R=0;R<S;R+=1)k=PolynomialBezier.shapeSegment(t,R),O.push(offsetSegmentSplit(k,s));if(!t.c)for(R=S-1;R>=0;R-=1)k=PolynomialBezier.shapeSegmentInverted(t,R),O.push(offsetSegmentSplit(k,s));O=pruneIntersections(O);var j=null,V=null;for(R=0;R<O.length;R+=1){var G=O[R];for(V&&(j=joinLines(_,V,G[0],u,d)),V=G[G.length-1],a=0;a<G.length;a+=1)k=G[a],j&&pointEqual(k.points[0],j)?_.setXYAt(k.points[1][0],k.points[1][1],"o",_.length()-1):_.setTripleAt(k.points[0][0],k.points[0][1],k.points[1][0],k.points[1][1],k.points[0][0],k.points[0][1],_.length()),_.setTripleAt(k.points[3][0],k.points[3][1],k.points[3][0],k.points[3][1],k.points[2][0],k.points[2][1],_.length()),j=k.points[3]}return O.length&&joinLines(_,V,O[0][0],u,d),_},OffsetPathModifier.prototype.processShapes=function(t){var s,u,d=this.shapes.length,_,S,R=this.amount.v,a=this.miterLimit.v,k=this.lineJoin;if(R!==0){var O,j;for(u=0;u<d;u+=1){if(O=this.shapes[u],j=O.localShapeCollection,!(!O.shape._mdf&&!this._mdf&&!t))for(j.releaseShapes(),O.shape._mdf=!0,s=O.shape.paths.shapes,S=O.shape.paths._length,_=0;_<S;_+=1)j.addShape(this.processPath(s[_],R,k,a));O.shape.paths=O.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(t){for(var s=t.fStyle?t.fStyle.split(" "):[],u="normal",d="normal",_=s.length,S,R=0;R<_;R+=1)switch(S=s[R].toLowerCase(),S){case"italic":d="italic";break;case"bold":u="700";break;case"black":u="900";break;case"medium":u="500";break;case"regular":case"normal":u="400";break;case"light":case"thin":u="200";break}return{style:d,weight:t.fWeight||u}}var FontManager=(function(){var t=5e3,s={w:0,size:0,shapes:[],data:{shapes:[]}},u=[];u=u.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var d=127988,_=917631,S=917601,R=917626,a=65039,k=8205,O=127462,j=127487,V=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function G(xe){var Fe=xe.split(","),pe,Te=Fe.length,st=[];for(pe=0;pe<Te;pe+=1)Fe[pe]!=="sans-serif"&&Fe[pe]!=="monospace"&&st.push(Fe[pe]);return st.join(",")}function J(xe,Fe){var pe=createTag("span");pe.setAttribute("aria-hidden",!0),pe.style.fontFamily=Fe;var Te=createTag("span");Te.innerText="giItT1WQy@!-/#",pe.style.position="absolute",pe.style.left="-10000px",pe.style.top="-10000px",pe.style.fontSize="300px",pe.style.fontVariant="normal",pe.style.fontStyle="normal",pe.style.fontWeight="normal",pe.style.letterSpacing="0",pe.appendChild(Te),document.body.appendChild(pe);var st=Te.offsetWidth;return Te.style.fontFamily=G(xe)+", "+Fe,{node:Te,w:st,parent:pe}}function Z(){var xe,Fe=this.fonts.length,pe,Te,st=Fe;for(xe=0;xe<Fe;xe+=1)this.fonts[xe].loaded?st-=1:this.fonts[xe].fOrigin==="n"||this.fonts[xe].origin===0?this.fonts[xe].loaded=!0:(pe=this.fonts[xe].monoCase.node,Te=this.fonts[xe].monoCase.w,pe.offsetWidth!==Te?(st-=1,this.fonts[xe].loaded=!0):(pe=this.fonts[xe].sansCase.node,Te=this.fonts[xe].sansCase.w,pe.offsetWidth!==Te&&(st-=1,this.fonts[xe].loaded=!0)),this.fonts[xe].loaded&&(this.fonts[xe].sansCase.parent.parentNode.removeChild(this.fonts[xe].sansCase.parent),this.fonts[xe].monoCase.parent.parentNode.removeChild(this.fonts[xe].monoCase.parent)));st!==0&&Date.now()-this.initTime<t?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function Y(xe,Fe){var pe=document.body&&Fe?"svg":"canvas",Te,st=getFontProperties(xe);if(pe==="svg"){var Me=createNS("text");Me.style.fontSize="100px",Me.setAttribute("font-family",xe.fFamily),Me.setAttribute("font-style",st.style),Me.setAttribute("font-weight",st.weight),Me.textContent="1",xe.fClass?(Me.style.fontFamily="inherit",Me.setAttribute("class",xe.fClass)):Me.style.fontFamily=xe.fFamily,Fe.appendChild(Me),Te=Me}else{var at=new OffscreenCanvas(500,500).getContext("2d");at.font=st.style+" "+st.weight+" 100px "+xe.fFamily,Te=at}function ct(Ct){return pe==="svg"?(Te.textContent=Ct,Te.getComputedTextLength()):Te.measureText(Ct).width}return{measureText:ct}}function le(xe,Fe){if(!xe){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=xe.list;return}if(!document.body){this.isLoaded=!0,xe.list.forEach(function(zi){zi.helper=Y(zi),zi.cache={}}),this.fonts=xe.list;return}var pe=xe.list,Te,st=pe.length,Me=st;for(Te=0;Te<st;Te+=1){var at=!0,ct,Ct;if(pe[Te].loaded=!1,pe[Te].monoCase=J(pe[Te].fFamily,"monospace"),pe[Te].sansCase=J(pe[Te].fFamily,"sans-serif"),!pe[Te].fPath)pe[Te].loaded=!0,Me-=1;else if(pe[Te].fOrigin==="p"||pe[Te].origin===3){if(ct=document.querySelectorAll('style[f-forigin="p"][f-family="'+pe[Te].fFamily+'"], style[f-origin="3"][f-family="'+pe[Te].fFamily+'"]'),ct.length>0&&(at=!1),at){var li=createTag("style");li.setAttribute("f-forigin",pe[Te].fOrigin),li.setAttribute("f-origin",pe[Te].origin),li.setAttribute("f-family",pe[Te].fFamily),li.type="text/css",li.innerText="@font-face {font-family: "+pe[Te].fFamily+"; font-style: normal; src: url('"+pe[Te].fPath+"');}",Fe.appendChild(li)}}else if(pe[Te].fOrigin==="g"||pe[Te].origin===1){for(ct=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Ct=0;Ct<ct.length;Ct+=1)ct[Ct].href.indexOf(pe[Te].fPath)!==-1&&(at=!1);if(at){var mi=createTag("link");mi.setAttribute("f-forigin",pe[Te].fOrigin),mi.setAttribute("f-origin",pe[Te].origin),mi.type="text/css",mi.rel="stylesheet",mi.href=pe[Te].fPath,document.body.appendChild(mi)}}else if(pe[Te].fOrigin==="t"||pe[Te].origin===2){for(ct=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Ct=0;Ct<ct.length;Ct+=1)pe[Te].fPath===ct[Ct].src&&(at=!1);if(at){var bi=createTag("link");bi.setAttribute("f-forigin",pe[Te].fOrigin),bi.setAttribute("f-origin",pe[Te].origin),bi.setAttribute("rel","stylesheet"),bi.setAttribute("href",pe[Te].fPath),Fe.appendChild(bi)}}pe[Te].helper=Y(pe[Te],Fe),pe[Te].cache={},this.fonts.push(pe[Te])}Me===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function ee(xe){if(xe){this.chars||(this.chars=[]);var Fe,pe=xe.length,Te,st=this.chars.length,Me;for(Fe=0;Fe<pe;Fe+=1){for(Te=0,Me=!1;Te<st;)this.chars[Te].style===xe[Fe].style&&this.chars[Te].fFamily===xe[Fe].fFamily&&this.chars[Te].ch===xe[Fe].ch&&(Me=!0),Te+=1;Me||(this.chars.push(xe[Fe]),st+=1)}}}function se(xe,Fe,pe){for(var Te=0,st=this.chars.length;Te<st;){if(this.chars[Te].ch===xe&&this.chars[Te].style===Fe&&this.chars[Te].fFamily===pe)return this.chars[Te];Te+=1}return(typeof xe=="string"&&xe.charCodeAt(0)!==13||!xe)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",xe,Fe,pe)),s}function Q(xe,Fe,pe){var Te=this.getFontByName(Fe),st=xe;if(!Te.cache[st]){var Me=Te.helper;if(xe===" "){var at=Me.measureText("|"+xe+"|"),ct=Me.measureText("||");Te.cache[st]=(at-ct)/100}else Te.cache[st]=Me.measureText(xe)/100}return Te.cache[st]*pe}function oe(xe){for(var Fe=0,pe=this.fonts.length;Fe<pe;){if(this.fonts[Fe].fName===xe)return this.fonts[Fe];Fe+=1}return this.fonts[0]}function _e(xe){var Fe=0,pe=xe.charCodeAt(0);if(pe>=55296&&pe<=56319){var Te=xe.charCodeAt(1);Te>=56320&&Te<=57343&&(Fe=(pe-55296)*1024+Te-56320+65536)}return Fe}function Se(xe,Fe){var pe=xe.toString(16)+Fe.toString(16);return V.indexOf(pe)!==-1}function ke(xe){return xe===k}function Le(xe){return xe===a}function lt(xe){var Fe=_e(xe);return Fe>=O&&Fe<=j}function qt(xe){return lt(xe.substr(0,2))&&lt(xe.substr(2,2))}function Yt(xe){return u.indexOf(xe)!==-1}function Ot(xe,Fe){var pe=_e(xe.substr(Fe,2));if(pe!==d)return!1;var Te=0;for(Fe+=2;Te<5;){if(pe=_e(xe.substr(Fe,2)),pe<S||pe>R)return!1;Te+=1,Fe+=2}return _e(xe.substr(Fe,2))===_}function Bt(){this.isLoaded=!0}var si=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};si.isModifier=Se,si.isZeroWidthJoiner=ke,si.isFlagEmoji=qt,si.isRegionalCode=lt,si.isCombinedCharacter=Yt,si.isRegionalFlag=Ot,si.isVariationSelector=Le,si.BLACK_FLAG_CODE_POINT=d;var kt={addChars:ee,addFonts:le,getCharData:se,getFontByName:oe,measureText:Q,checkLoadedFonts:Z,setIsLoaded:Bt};return si.prototype=kt,si})();function SlotManager(t){this.animationData=t}SlotManager.prototype.getProp=function(t){return this.animationData.slots&&this.animationData.slots[t.sid]?Object.assign(t,this.animationData.slots[t.sid].p):t};function slotFactory(t){return new SlotManager(t)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(s){this.renderableComponents.indexOf(s)===-1&&this.renderableComponents.push(s)},removeRenderableComponent:function(s){this.renderableComponents.indexOf(s)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(s),1)},prepareRenderableFrame:function(s){this.checkLayerLimits(s)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(s){this.data.ip-this.data.st<=s&&this.data.op-this.data.st>s?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var s,u=this.renderableComponents.length;for(s=0;s<u;s+=1)this.renderableComponents[s].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=(function(){var t={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(s){return t[s]||""}})();function SliderEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,0,0,u)}function AngleEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,0,0,u)}function ColorEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,1,0,u)}function PointEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,1,0,u)}function LayerIndexEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,0,0,u)}function MaskIndexEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,0,0,u)}function CheckboxEffect(t,s,u){this.p=PropertyFactory.getProp(s,t.v,0,0,u)}function NoValueEffect(){this.p={}}function EffectsManager(t,s){var u=t.ef||[];this.effectElements=[];var d,_=u.length,S;for(d=0;d<_;d+=1)S=new GroupEffect(u[d],s),this.effectElements.push(S)}function GroupEffect(t,s){this.init(t,s)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(t,s){this.data=t,this.effectElements=[],this.initDynamicPropertyContainer(s);var u,d=this.data.ef.length,_,S=this.data.ef;for(u=0;u<d;u+=1){switch(_=null,S[u].ty){case 0:_=new SliderEffect(S[u],s,this);break;case 1:_=new AngleEffect(S[u],s,this);break;case 2:_=new ColorEffect(S[u],s,this);break;case 3:_=new PointEffect(S[u],s,this);break;case 4:case 7:_=new CheckboxEffect(S[u],s,this);break;case 10:_=new LayerIndexEffect(S[u],s,this);break;case 11:_=new MaskIndexEffect(S[u],s,this);break;case 5:_=new EffectsManager(S[u],s);break;default:_=new NoValueEffect(S[u]);break}_&&this.effectElements.push(_)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var s=0,u=this.data.masksProperties.length;s<u;){if(this.data.masksProperties[s].mode!=="n"&&this.data.masksProperties[s].cl!==!1)return!0;s+=1}return!1},initExpressions:function(){var s=getExpressionInterfaces();if(s){var u=s("layer"),d=s("effects"),_=s("shape"),S=s("text"),R=s("comp");this.layerInterface=u(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var a=d.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(a),this.data.ty===0||this.data.xt?this.compInterface=R(this):this.data.ty===4?(this.layerInterface.shapeInterface=_(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=S(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var s=getBlendMode(this.data.bm),u=this.baseElement||this.layerElement;u.style["mix-blend-mode"]=s},initBaseData:function(s,u,d){this.globalData=u,this.comp=d,this.data=s,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(s,u){var d,_=this.dynamicProperties.length;for(d=0;d<_;d+=1)(u||this._isParent&&this.dynamicProperties[d].propType==="transform")&&(this.dynamicProperties[d].getValue(),this.dynamicProperties[d]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(s){this.dynamicProperties.indexOf(s)===-1&&this.dynamicProperties.push(s)}};function FootageElement(t,s,u){this.initFrame(),this.initRenderable(),this.assetData=s.getAssetData(t.refId),this.footageData=s.imageLoader.getAsset(this.assetData),this.initBaseData(t,s,u)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var t=getExpressionInterfaces();if(t){var s=t("footage");this.layerInterface=s(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(t,s,u){this.initFrame(),this.initRenderable(),this.assetData=s.getAssetData(t.refId),this.initBaseData(t,s,u),this._isPlaying=!1,this._canPlay=!1;var d=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(d),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,s.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,t.au&&t.au.lv?t.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(t){if(this.prepareRenderableFrame(t,!0),this.prepareProperties(t,!0),this.tm._placeholder)this._currentTime=t/this.data.sr;else{var s=this.tm.v;this._currentTime=s}this._volume=this.lv.v[0];var u=this._volume*this._volumeMultiplier;this._previousVolume!==u&&(this._previousVolume=u,this.audio.volume(u))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(t){this.audio.rate(t)},AudioElement.prototype.volume=function(t){this._volumeMultiplier=t,this._previousVolume=t*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(t){var s,u=this.layers.length,d;for(this.completeLayers=!0,s=u-1;s>=0;s-=1)this.elements[s]||(d=this.layers[s],d.ip-d.st<=t-this.layers[s].st&&d.op-d.st>t-this.layers[s].st&&this.buildItem(s)),this.completeLayers=this.elements[s]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(t){switch(t.ty){case 2:return this.createImage(t);case 0:return this.createComp(t);case 1:return this.createSolid(t);case 3:return this.createNull(t);case 4:return this.createShape(t);case 5:return this.createText(t);case 6:return this.createAudio(t);case 13:return this.createCamera(t);case 15:return this.createFootage(t);default:return this.createNull(t)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(t){return new AudioElement(t,this.globalData,this)},BaseRenderer.prototype.createFootage=function(t){return new FootageElement(t,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var t,s=this.layers.length;for(t=0;t<s;t+=1)this.buildItem(t);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(t){this.completeLayers=!1;var s,u=t.length,d,_=this.layers.length;for(s=0;s<u;s+=1)for(d=0;d<_;){if(this.layers[d].id===t[s].id){this.layers[d]=t[s];break}d+=1}},BaseRenderer.prototype.setProjectInterface=function(t){this.globalData.projectInterface=t},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(t,s,u){for(var d=this.elements,_=this.layers,S=0,R=_.length;S<R;)_[S].ind==s&&(!d[S]||d[S]===!0?(this.buildItem(S),this.addPendingElement(t)):(u.push(d[S]),d[S].setAsParent(),_[S].parent!==void 0?this.buildElementParenting(t,_[S].parent,u):t.setHierarchy(u))),S+=1},BaseRenderer.prototype.addPendingElement=function(t){this.pendingElements.push(t)},BaseRenderer.prototype.searchExtraCompositions=function(t){var s,u=t.length;for(s=0;s<u;s+=1)if(t[s].xt){var d=this.createComp(t[s]);d.initExpressions(),this.globalData.projectInterface.registerComposition(d)}},BaseRenderer.prototype.getElementById=function(t){var s,u=this.elements.length;for(s=0;s<u;s+=1)if(this.elements[s].data.ind===t)return this.elements[s];return null},BaseRenderer.prototype.getElementByPath=function(t){var s=t.shift(),u;if(typeof s=="number")u=this.elements[s];else{var d,_=this.elements.length;for(d=0;d<_;d+=1)if(this.elements[d].data.nm===s){u=this.elements[d];break}}return t.length===0?u:u.getElementByPath(t)},BaseRenderer.prototype.setupGlobalData=function(t,s){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(t),this.globalData.fontManager.addChars(t.chars),this.globalData.fontManager.addFonts(t.fonts,s),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=t.fr,this.globalData.nm=t.nm,this.globalData.compSize={w:t.w,h:t.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var s=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:s,localMat:s,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var s,u=this.finalTransform.mat,d=0,_=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;d<_;){if(this.hierarchy[d].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}d+=1}if(this.finalTransform._matMdf)for(s=this.finalTransform.mProp.v.props,u.cloneFromProps(s),d=0;d<_;d+=1)u.multiply(this.hierarchy[d].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var s=0,u=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;s<u;)this.localTransforms[s]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[s]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),s+=1;if(this.finalTransform._localMatMdf){var d=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(d),s=1;s<u;s+=1){var _=this.localTransforms[s].matrix;d.multiply(_)}d.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var S=this.finalTransform.localOpacity;for(s=0;s<u;s+=1)S*=this.localTransforms[s].opacity*.01;this.finalTransform.localOpacity=S}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var s=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(s.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var u=0,d=s.length;for(u=0;u<d;u+=1)this.localTransforms.push(s[u])}}},globalToLocal:function(s){var u=[];u.push(this.finalTransform);for(var d=!0,_=this.comp;d;)_.finalTransform?(_.data.hasMask&&u.splice(0,0,_.finalTransform),_=_.comp):d=!1;var S,R=u.length,a;for(S=0;S<R;S+=1)a=u[S].mat.applyToPointArray(0,0,0),s=[s[0]-a[0],s[1]-a[1],0];return s},mHelper:new Matrix};function MaskElement(t,s,u){this.data=t,this.element=s,this.globalData=u,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var d=this.globalData.defs,_,S=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(S),this.solidPath="";var R,a=this.masksProperties,k=0,O=[],j,V,G=createElementID(),J,Z,Y,le,ee="clipPath",se="clip-path";for(_=0;_<S;_+=1)if((a[_].mode!=="a"&&a[_].mode!=="n"||a[_].inv||a[_].o.k!==100||a[_].o.x)&&(ee="mask",se="mask"),(a[_].mode==="s"||a[_].mode==="i")&&k===0?(J=createNS("rect"),J.setAttribute("fill","#ffffff"),J.setAttribute("width",this.element.comp.data.w||0),J.setAttribute("height",this.element.comp.data.h||0),O.push(J)):J=null,R=createNS("path"),a[_].mode==="n")this.viewData[_]={op:PropertyFactory.getProp(this.element,a[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,a[_],3),elem:R,lastPath:""},d.appendChild(R);else{k+=1,R.setAttribute("fill",a[_].mode==="s"?"#000000":"#ffffff"),R.setAttribute("clip-rule","nonzero");var Q;if(a[_].x.k!==0?(ee="mask",se="mask",le=PropertyFactory.getProp(this.element,a[_].x,0,null,this.element),Q=createElementID(),Z=createNS("filter"),Z.setAttribute("id",Q),Y=createNS("feMorphology"),Y.setAttribute("operator","erode"),Y.setAttribute("in","SourceGraphic"),Y.setAttribute("radius","0"),Z.appendChild(Y),d.appendChild(Z),R.setAttribute("stroke",a[_].mode==="s"?"#000000":"#ffffff")):(Y=null,le=null),this.storedData[_]={elem:R,x:le,expan:Y,lastPath:"",lastOperator:"",filterId:Q,lastRadius:0},a[_].mode==="i"){V=O.length;var oe=createNS("g");for(j=0;j<V;j+=1)oe.appendChild(O[j]);var _e=createNS("mask");_e.setAttribute("mask-type","alpha"),_e.setAttribute("id",G+"_"+k),_e.appendChild(R),d.appendChild(_e),oe.setAttribute("mask","url("+getLocationHref()+"#"+G+"_"+k+")"),O.length=0,O.push(oe)}else O.push(R);a[_].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[_]={elem:R,lastPath:"",op:PropertyFactory.getProp(this.element,a[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,a[_],3),invRect:J},this.viewData[_].prop.k||this.drawPath(a[_],this.viewData[_].prop.v,this.viewData[_])}for(this.maskElement=createNS(ee),S=O.length,_=0;_<S;_+=1)this.maskElement.appendChild(O[_]);k>0&&(this.maskElement.setAttribute("id",G),this.element.maskedElement.setAttribute(se,"url("+getLocationHref()+"#"+G+")"),d.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(t){return this.viewData[t].prop},MaskElement.prototype.renderFrame=function(t){var s=this.element.finalTransform.mat,u,d=this.masksProperties.length;for(u=0;u<d;u+=1)if((this.viewData[u].prop._mdf||t)&&this.drawPath(this.masksProperties[u],this.viewData[u].prop.v,this.viewData[u]),(this.viewData[u].op._mdf||t)&&this.viewData[u].elem.setAttribute("fill-opacity",this.viewData[u].op.v),this.masksProperties[u].mode!=="n"&&(this.viewData[u].invRect&&(this.element.finalTransform.mProp._mdf||t)&&this.viewData[u].invRect.setAttribute("transform",s.getInverseMatrix().to2dCSS()),this.storedData[u].x&&(this.storedData[u].x._mdf||t))){var _=this.storedData[u].expan;this.storedData[u].x.v<0?(this.storedData[u].lastOperator!=="erode"&&(this.storedData[u].lastOperator="erode",this.storedData[u].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[u].filterId+")")),_.setAttribute("radius",-this.storedData[u].x.v)):(this.storedData[u].lastOperator!=="dilate"&&(this.storedData[u].lastOperator="dilate",this.storedData[u].elem.setAttribute("filter",null)),this.storedData[u].elem.setAttribute("stroke-width",this.storedData[u].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var t="M0,0 ";return t+=" h"+this.globalData.compSize.w,t+=" v"+this.globalData.compSize.h,t+=" h-"+this.globalData.compSize.w,t+=" v-"+this.globalData.compSize.h+" ",t},MaskElement.prototype.drawPath=function(t,s,u){var d=" M"+s.v[0][0]+","+s.v[0][1],_,S;for(S=s._length,_=1;_<S;_+=1)d+=" C"+s.o[_-1][0]+","+s.o[_-1][1]+" "+s.i[_][0]+","+s.i[_][1]+" "+s.v[_][0]+","+s.v[_][1];if(s.c&&S>1&&(d+=" C"+s.o[_-1][0]+","+s.o[_-1][1]+" "+s.i[0][0]+","+s.i[0][1]+" "+s.v[0][0]+","+s.v[0][1]),u.lastPath!==d){var R="";u.elem&&(s.c&&(R=t.inv?this.solidPath+d:d),u.elem.setAttribute("d",R)),u.lastPath=d}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=(function(){var t={};t.createFilter=s,t.createAlphaToLuminanceFilter=u;function s(d,_){var S=createNS("filter");return S.setAttribute("id",d),_!==!0&&(S.setAttribute("filterUnits","objectBoundingBox"),S.setAttribute("x","0%"),S.setAttribute("y","0%"),S.setAttribute("width","100%"),S.setAttribute("height","100%")),S}function u(){var d=createNS("feColorMatrix");return d.setAttribute("type","matrix"),d.setAttribute("color-interpolation-filters","sRGB"),d.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),d}return t})(),featureSupport=(function(){var t={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(t.maskType=!1),/firefox/i.test(navigator.userAgent)&&(t.svgLumaHidden=!1),t})(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(t){var s,u="SourceGraphic",d=t.data.ef?t.data.ef.length:0,_=createElementID(),S=filtersFactory.createFilter(_,!0),R=0;this.filters=[];var a;for(s=0;s<d;s+=1){a=null;var k=t.data.ef[s].ty;if(registeredEffects$1[k]){var O=registeredEffects$1[k].effect;a=new O(S,t.effectsManager.effectElements[s],t,idPrefix+R,u),u=idPrefix+R,registeredEffects$1[k].countsAsEffect&&(R+=1)}a&&this.filters.push(a)}R&&(t.globalData.defs.appendChild(S),t.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+_+")")),this.filters.length&&t.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(t){var s,u=this.filters.length;for(s=0;s<u;s+=1)this.filters[s].renderFrame(t)},SVGEffects.prototype.getEffects=function(t){var s,u=this.filters.length,d=[];for(s=0;s<u;s+=1)this.filters[s].type===t&&d.push(this.filters[s]);return d};function registerEffect$1(t,s,u){registeredEffects$1[t]={effect:s,countsAsEffect:u}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var s=null;if(this.data.td){this.matteMasks={};var u=createNS("g");u.setAttribute("id",this.layerId),u.appendChild(this.layerElement),s=u,this.globalData.defs.appendChild(u)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),s=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var d=createNS("clipPath"),_=createNS("path");_.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var S=createElementID();if(d.setAttribute("id",S),d.appendChild(_),this.globalData.defs.appendChild(d),this.checkMasks()){var R=createNS("g");R.setAttribute("clip-path","url("+getLocationHref()+"#"+S+")"),R.appendChild(this.layerElement),this.transformedElement=R,s?s.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+S+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(s){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[s]){var u=this.layerId+"_"+s,d,_,S,R;if(s===1||s===3){var a=createNS("mask");a.setAttribute("id",u),a.setAttribute("mask-type",s===3?"luminance":"alpha"),S=createNS("use"),S.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),a.appendChild(S),this.globalData.defs.appendChild(a),!featureSupport.maskType&&s===1&&(a.setAttribute("mask-type","luminance"),d=createElementID(),_=filtersFactory.createFilter(d),this.globalData.defs.appendChild(_),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),R=createNS("g"),R.appendChild(S),a.appendChild(R),R.setAttribute("filter","url("+getLocationHref()+"#"+d+")"))}else if(s===2){var k=createNS("mask");k.setAttribute("id",u),k.setAttribute("mask-type","alpha");var O=createNS("g");k.appendChild(O),d=createElementID(),_=filtersFactory.createFilter(d);var j=createNS("feComponentTransfer");j.setAttribute("in","SourceGraphic"),_.appendChild(j);var V=createNS("feFuncA");V.setAttribute("type","table"),V.setAttribute("tableValues","1.0 0.0"),j.appendChild(V),this.globalData.defs.appendChild(_);var G=createNS("rect");G.setAttribute("width",this.comp.data.w),G.setAttribute("height",this.comp.data.h),G.setAttribute("x","0"),G.setAttribute("y","0"),G.setAttribute("fill","#ffffff"),G.setAttribute("opacity","0"),O.setAttribute("filter","url("+getLocationHref()+"#"+d+")"),O.appendChild(G),S=createNS("use"),S.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),O.appendChild(S),featureSupport.maskType||(k.setAttribute("mask-type","luminance"),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),R=createNS("g"),O.appendChild(G),R.appendChild(this.layerElement),O.appendChild(R)),this.globalData.defs.appendChild(k)}this.matteMasks[s]=u}return this.matteMasks[s]},setMatte:function(s){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+s+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(s){this.hierarchy=s},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var t={initElement:function(u,d,_){this.initFrame(),this.initBaseData(u,d,_),this.initTransform(u,d,_),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var u=this.baseElement||this.layerElement;u.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var u=this.baseElement||this.layerElement;u.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(u){this._mdf=!1,this.prepareRenderableFrame(u),this.prepareProperties(u,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(t)],RenderableDOMElement)})();function IImageElement(t,s,u){this.assetData=s.getAssetData(t.refId),this.assetData&&this.assetData.sid&&(this.assetData=s.slotManager.getProp(this.assetData)),this.initElement(t,s,u),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var t=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",t),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(t,s){this.elem=t,this.pos=s}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(s){var u,d=this.shapeModifiers.length;for(u=0;u<d;u+=1)this.shapeModifiers[u].addShape(s)},isShapeInAnimatedModifiers:function(s){for(var u=0,d=this.shapeModifiers.length;u<d;)if(this.shapeModifiers[u].isAnimatedWithShape(s))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var s,u=this.shapes.length;for(s=0;s<u;s+=1)this.shapes[s].sh.reset();u=this.shapeModifiers.length;var d;for(s=u-1;s>=0&&(d=this.shapeModifiers[s].processShapes(this._isFirstFrame),!d);s-=1);}},searchProcessedElement:function(s){for(var u=this.processedElements,d=0,_=u.length;d<_;){if(u[d].elem===s)return u[d].pos;d+=1}return 0},addProcessedElement:function(s,u){for(var d=this.processedElements,_=d.length;_;)if(_-=1,d[_].elem===s){d[_].pos=u;return}d.push(new ProcessedElement(s,u))},prepareFrame:function(s){this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(t,s,u){this.caches=[],this.styles=[],this.transformers=t,this.lStr="",this.sh=u,this.lvl=s,this._isAnimated=!!u.k;for(var d=0,_=t.length;d<_;){if(t[d].mProps.dynamicProperties.length){this._isAnimated=!0;break}d+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(t,s){this.data=t,this.type=t.ty,this.d="",this.lvl=s,this._mdf=!1,this.closed=t.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(t,s,u,d){this.elem=t,this.frameId=-1,this.dataProps=createSizedArray(s.length),this.renderer=u,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",s.length?s.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(d);var _,S=s.length||0,R;for(_=0;_<S;_+=1)R=PropertyFactory.getProp(t,s[_].v,0,0,this),this.k=R.k||this.k,this.dataProps[_]={n:s[_].n,p:R};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(t){if(!(this.elem.globalData.frameId===this.frameId&&!t)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||t,this._mdf)){var s=0,u=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),s=0;s<u;s+=1)this.dataProps[s].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[s].p.v:this.dashArray[s]=this.dataProps[s].p.v:this.dashoffset[0]=this.dataProps[s].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(t,s,u){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,s.o,0,.01,this),this.w=PropertyFactory.getProp(t,s.w,0,null,this),this.d=new DashProperty(t,s.d||{},"svg",this),this.c=PropertyFactory.getProp(t,s.c,1,255,this),this.style=u,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(t,s,u){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,s.o,0,.01,this),this.c=PropertyFactory.getProp(t,s.c,1,255,this),this.style=u}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(t,s,u){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.style=u}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(t,s,u){this.data=s,this.c=createTypedArray("uint8c",s.p*4);var d=s.k.k[0].s?s.k.k[0].s.length-s.p*4:s.k.k.length-s.p*4;this.o=createTypedArray("float32",d),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=d,this.initDynamicPropertyContainer(u),this.prop=PropertyFactory.getProp(t,s.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(t,s){for(var u=0,d=this.o.length/2,_;u<d;){if(_=Math.abs(t[u*4]-t[s*4+u*2]),_>.01)return!1;u+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var t=0,s=this.data.k.k.length;t<s;){if(!this.comparePoints(this.data.k.k[t].s,this.data.p))return!1;t+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(t){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||t){var s,u=this.data.p*4,d,_;for(s=0;s<u;s+=1)d=s%4===0?100:255,_=Math.round(this.prop.v[s]*d),this.c[s]!==_&&(this.c[s]=_,this._cmdf=!t);if(this.o.length)for(u=this.prop.v.length,s=this.data.p*4;s<u;s+=1)d=s%2===0?100:1,_=s%2===0?Math.round(this.prop.v[s]*100):this.prop.v[s],this.o[s-this.data.p*4]!==_&&(this.o[s-this.data.p*4]=_,this._omdf=!t);this._mdf=!t}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(t,s,u){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.initGradientData(t,s,u)}SVGGradientFillStyleData.prototype.initGradientData=function(t,s,u){this.o=PropertyFactory.getProp(t,s.o,0,.01,this),this.s=PropertyFactory.getProp(t,s.s,1,null,this),this.e=PropertyFactory.getProp(t,s.e,1,null,this),this.h=PropertyFactory.getProp(t,s.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(t,s.a||{k:0},0,degToRads,this),this.g=new GradientProperty(t,s.g,this),this.style=u,this.stops=[],this.setGradientData(u.pElem,s),this.setGradientOpacity(s,u),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(t,s){var u=createElementID(),d=createNS(s.t===1?"linearGradient":"radialGradient");d.setAttribute("id",u),d.setAttribute("spreadMethod","pad"),d.setAttribute("gradientUnits","userSpaceOnUse");var _=[],S,R,a;for(a=s.g.p*4,R=0;R<a;R+=4)S=createNS("stop"),d.appendChild(S),_.push(S);t.setAttribute(s.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+u+")"),this.gf=d,this.cst=_},SVGGradientFillStyleData.prototype.setGradientOpacity=function(t,s){if(this.g._hasOpacity&&!this.g._collapsable){var u,d,_,S=createNS("mask"),R=createNS("path");S.appendChild(R);var a=createElementID(),k=createElementID();S.setAttribute("id",k);var O=createNS(t.t===1?"linearGradient":"radialGradient");O.setAttribute("id",a),O.setAttribute("spreadMethod","pad"),O.setAttribute("gradientUnits","userSpaceOnUse"),_=t.g.k.k[0].s?t.g.k.k[0].s.length:t.g.k.k.length;var j=this.stops;for(d=t.g.p*4;d<_;d+=2)u=createNS("stop"),u.setAttribute("stop-color","rgb(255,255,255)"),O.appendChild(u),j.push(u);R.setAttribute(t.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+a+")"),t.ty==="gs"&&(R.setAttribute("stroke-linecap",lineCapEnum[t.lc||2]),R.setAttribute("stroke-linejoin",lineJoinEnum[t.lj||2]),t.lj===1&&R.setAttribute("stroke-miterlimit",t.ml)),this.of=O,this.ms=S,this.ost=j,this.maskId=k,s.msElem=R}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(t,s,u){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(t,s.w,0,null,this),this.d=new DashProperty(t,s.d||{},"svg",this),this.initGradientData(t,s,u),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(t,s,u){this.transform={mProps:t,op:s,container:u},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(s,u,d,_){if(u===0)return"";var S=s.o,R=s.i,a=s.v,k,O=" M"+_.applyToPointStringified(a[0][0],a[0][1]);for(k=1;k<u;k+=1)O+=" C"+_.applyToPointStringified(S[k-1][0],S[k-1][1])+" "+_.applyToPointStringified(R[k][0],R[k][1])+" "+_.applyToPointStringified(a[k][0],a[k][1]);return d&&u&&(O+=" C"+_.applyToPointStringified(S[k-1][0],S[k-1][1])+" "+_.applyToPointStringified(R[0][0],R[0][1])+" "+_.applyToPointStringified(a[0][0],a[0][1]),O+="z"),O},SVGElementsRenderer=(function(){var t=new Matrix,s=new Matrix,u={createRenderFunction:d};function d(V){switch(V.ty){case"fl":return a;case"gf":return O;case"gs":return k;case"st":return j;case"sh":case"el":case"rc":case"sr":return R;case"tr":return _;case"no":return S;default:return null}}function _(V,G,J){(J||G.transform.op._mdf)&&G.transform.container.setAttribute("opacity",G.transform.op.v),(J||G.transform.mProps._mdf)&&G.transform.container.setAttribute("transform",G.transform.mProps.v.to2dCSS())}function S(){}function R(V,G,J){var Z,Y,le,ee,se,Q,oe=G.styles.length,_e=G.lvl,Se,ke,Le,lt;for(Q=0;Q<oe;Q+=1){if(ee=G.sh._mdf||J,G.styles[Q].lvl<_e){for(ke=s.reset(),Le=_e-G.styles[Q].lvl,lt=G.transformers.length-1;!ee&&Le>0;)ee=G.transformers[lt].mProps._mdf||ee,Le-=1,lt-=1;if(ee)for(Le=_e-G.styles[Q].lvl,lt=G.transformers.length-1;Le>0;)ke.multiply(G.transformers[lt].mProps.v),Le-=1,lt-=1}else ke=t;if(Se=G.sh.paths,Y=Se._length,ee){for(le="",Z=0;Z<Y;Z+=1)se=Se.shapes[Z],se&&se._length&&(le+=buildShapeString(se,se._length,se.c,ke));G.caches[Q]=le}else le=G.caches[Q];G.styles[Q].d+=V.hd===!0?"":le,G.styles[Q]._mdf=ee||G.styles[Q]._mdf}}function a(V,G,J){var Z=G.style;(G.c._mdf||J)&&Z.pElem.setAttribute("fill","rgb("+bmFloor(G.c.v[0])+","+bmFloor(G.c.v[1])+","+bmFloor(G.c.v[2])+")"),(G.o._mdf||J)&&Z.pElem.setAttribute("fill-opacity",G.o.v)}function k(V,G,J){O(V,G,J),j(V,G,J)}function O(V,G,J){var Z=G.gf,Y=G.g._hasOpacity,le=G.s.v,ee=G.e.v;if(G.o._mdf||J){var se=V.ty==="gf"?"fill-opacity":"stroke-opacity";G.style.pElem.setAttribute(se,G.o.v)}if(G.s._mdf||J){var Q=V.t===1?"x1":"cx",oe=Q==="x1"?"y1":"cy";Z.setAttribute(Q,le[0]),Z.setAttribute(oe,le[1]),Y&&!G.g._collapsable&&(G.of.setAttribute(Q,le[0]),G.of.setAttribute(oe,le[1]))}var _e,Se,ke,Le;if(G.g._cmdf||J){_e=G.cst;var lt=G.g.c;for(ke=_e.length,Se=0;Se<ke;Se+=1)Le=_e[Se],Le.setAttribute("offset",lt[Se*4]+"%"),Le.setAttribute("stop-color","rgb("+lt[Se*4+1]+","+lt[Se*4+2]+","+lt[Se*4+3]+")")}if(Y&&(G.g._omdf||J)){var qt=G.g.o;for(G.g._collapsable?_e=G.cst:_e=G.ost,ke=_e.length,Se=0;Se<ke;Se+=1)Le=_e[Se],G.g._collapsable||Le.setAttribute("offset",qt[Se*2]+"%"),Le.setAttribute("stop-opacity",qt[Se*2+1])}if(V.t===1)(G.e._mdf||J)&&(Z.setAttribute("x2",ee[0]),Z.setAttribute("y2",ee[1]),Y&&!G.g._collapsable&&(G.of.setAttribute("x2",ee[0]),G.of.setAttribute("y2",ee[1])));else{var Yt;if((G.s._mdf||G.e._mdf||J)&&(Yt=Math.sqrt(Math.pow(le[0]-ee[0],2)+Math.pow(le[1]-ee[1],2)),Z.setAttribute("r",Yt),Y&&!G.g._collapsable&&G.of.setAttribute("r",Yt)),G.s._mdf||G.e._mdf||G.h._mdf||G.a._mdf||J){Yt||(Yt=Math.sqrt(Math.pow(le[0]-ee[0],2)+Math.pow(le[1]-ee[1],2)));var Ot=Math.atan2(ee[1]-le[1],ee[0]-le[0]),Bt=G.h.v;Bt>=1?Bt=.99:Bt<=-1&&(Bt=-.99);var si=Yt*Bt,kt=Math.cos(Ot+G.a.v)*si+le[0],xe=Math.sin(Ot+G.a.v)*si+le[1];Z.setAttribute("fx",kt),Z.setAttribute("fy",xe),Y&&!G.g._collapsable&&(G.of.setAttribute("fx",kt),G.of.setAttribute("fy",xe))}}}function j(V,G,J){var Z=G.style,Y=G.d;Y&&(Y._mdf||J)&&Y.dashStr&&(Z.pElem.setAttribute("stroke-dasharray",Y.dashStr),Z.pElem.setAttribute("stroke-dashoffset",Y.dashoffset[0])),G.c&&(G.c._mdf||J)&&Z.pElem.setAttribute("stroke","rgb("+bmFloor(G.c.v[0])+","+bmFloor(G.c.v[1])+","+bmFloor(G.c.v[2])+")"),(G.o._mdf||J)&&Z.pElem.setAttribute("stroke-opacity",G.o.v),(G.w._mdf||J)&&(Z.pElem.setAttribute("stroke-width",G.w.v),Z.msElem&&Z.msElem.setAttribute("stroke-width",G.w.v))}return u})();function SVGShapeElement(t,s,u){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(t,s,u),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var t,s=this.shapes.length,u,d,_=this.stylesList.length,S,R=[],a=!1;for(d=0;d<_;d+=1){for(S=this.stylesList[d],a=!1,R.length=0,t=0;t<s;t+=1)u=this.shapes[t],u.styles.indexOf(S)!==-1&&(R.push(u),a=u._isAnimated||a);R.length>1&&a&&this.setShapesAsAnimated(R)}},SVGShapeElement.prototype.setShapesAsAnimated=function(t){var s,u=t.length;for(s=0;s<u;s+=1)t[s].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(t,s){var u,d=new SVGStyleData(t,s),_=d.pElem;if(t.ty==="st")u=new SVGStrokeStyleData(this,t,d);else if(t.ty==="fl")u=new SVGFillStyleData(this,t,d);else if(t.ty==="gf"||t.ty==="gs"){var S=t.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;u=new S(this,t,d),this.globalData.defs.appendChild(u.gf),u.maskId&&(this.globalData.defs.appendChild(u.ms),this.globalData.defs.appendChild(u.of),_.setAttribute("mask","url("+getLocationHref()+"#"+u.maskId+")"))}else t.ty==="no"&&(u=new SVGNoStyleData(this,t,d));return(t.ty==="st"||t.ty==="gs")&&(_.setAttribute("stroke-linecap",lineCapEnum[t.lc||2]),_.setAttribute("stroke-linejoin",lineJoinEnum[t.lj||2]),_.setAttribute("fill-opacity","0"),t.lj===1&&_.setAttribute("stroke-miterlimit",t.ml)),t.r===2&&_.setAttribute("fill-rule","evenodd"),t.ln&&_.setAttribute("id",t.ln),t.cl&&_.setAttribute("class",t.cl),t.bm&&(_.style["mix-blend-mode"]=getBlendMode(t.bm)),this.stylesList.push(d),this.addToAnimatedContents(t,u),u},SVGShapeElement.prototype.createGroupElement=function(t){var s=new ShapeGroupData;return t.ln&&s.gr.setAttribute("id",t.ln),t.cl&&s.gr.setAttribute("class",t.cl),t.bm&&(s.gr.style["mix-blend-mode"]=getBlendMode(t.bm)),s},SVGShapeElement.prototype.createTransformElement=function(t,s){var u=TransformPropertyFactory.getTransformProperty(this,t,this),d=new SVGTransformData(u,u.o,s);return this.addToAnimatedContents(t,d),d},SVGShapeElement.prototype.createShapeElement=function(t,s,u){var d=4;t.ty==="rc"?d=5:t.ty==="el"?d=6:t.ty==="sr"&&(d=7);var _=ShapePropertyFactory.getShapeProp(this,t,d,this),S=new SVGShapeData(s,u,_);return this.shapes.push(S),this.addShapeToModifiers(S),this.addToAnimatedContents(t,S),S},SVGShapeElement.prototype.addToAnimatedContents=function(t,s){for(var u=0,d=this.animatedContents.length;u<d;){if(this.animatedContents[u].element===s)return;u+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(t),element:s,data:t})},SVGShapeElement.prototype.setElementStyles=function(t){var s=t.styles,u,d=this.stylesList.length;for(u=0;u<d;u+=1)s.indexOf(this.stylesList[u])===-1&&!this.stylesList[u].closed&&s.push(this.stylesList[u])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var t,s=this.itemsData.length;for(t=0;t<s;t+=1)this.prevViewData[t]=this.itemsData[t];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),s=this.dynamicProperties.length,t=0;t<s;t+=1)this.dynamicProperties[t].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(t,s,u,d,_,S,R){var a=[].concat(S),k,O=t.length-1,j,V,G=[],J=[],Z,Y,le;for(k=O;k>=0;k-=1){if(le=this.searchProcessedElement(t[k]),le?s[k]=u[le-1]:t[k]._render=R,t[k].ty==="fl"||t[k].ty==="st"||t[k].ty==="gf"||t[k].ty==="gs"||t[k].ty==="no")le?s[k].style.closed=t[k].hd:s[k]=this.createStyleElement(t[k],_),t[k]._render&&s[k].style.pElem.parentNode!==d&&d.appendChild(s[k].style.pElem),G.push(s[k].style);else if(t[k].ty==="gr"){if(!le)s[k]=this.createGroupElement(t[k]);else for(V=s[k].it.length,j=0;j<V;j+=1)s[k].prevViewData[j]=s[k].it[j];this.searchShapes(t[k].it,s[k].it,s[k].prevViewData,s[k].gr,_+1,a,R),t[k]._render&&s[k].gr.parentNode!==d&&d.appendChild(s[k].gr)}else t[k].ty==="tr"?(le||(s[k]=this.createTransformElement(t[k],d)),Z=s[k].transform,a.push(Z)):t[k].ty==="sh"||t[k].ty==="rc"||t[k].ty==="el"||t[k].ty==="sr"?(le||(s[k]=this.createShapeElement(t[k],a,_)),this.setElementStyles(s[k])):t[k].ty==="tm"||t[k].ty==="rd"||t[k].ty==="ms"||t[k].ty==="pb"||t[k].ty==="zz"||t[k].ty==="op"?(le?(Y=s[k],Y.closed=!1):(Y=ShapeModifiers.getModifier(t[k].ty),Y.init(this,t[k]),s[k]=Y,this.shapeModifiers.push(Y)),J.push(Y)):t[k].ty==="rp"&&(le?(Y=s[k],Y.closed=!0):(Y=ShapeModifiers.getModifier(t[k].ty),s[k]=Y,Y.init(this,t,k,s),this.shapeModifiers.push(Y),R=!1),J.push(Y));this.addProcessedElement(t[k],k+1)}for(O=G.length,k=0;k<O;k+=1)G[k].closed=!0;for(O=J.length,k=0;k<O;k+=1)J[k].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var t,s=this.stylesList.length;for(t=0;t<s;t+=1)this.stylesList[t].reset();for(this.renderShape(),t=0;t<s;t+=1)(this.stylesList[t]._mdf||this._isFirstFrame)&&(this.stylesList[t].msElem&&(this.stylesList[t].msElem.setAttribute("d",this.stylesList[t].d),this.stylesList[t].d="M0 0"+this.stylesList[t].d),this.stylesList[t].pElem.setAttribute("d",this.stylesList[t].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var t,s=this.animatedContents.length,u;for(t=0;t<s;t+=1)u=this.animatedContents[t],(this._isFirstFrame||u.element._isAnimated)&&u.data!==!0&&u.fn(u.data,u.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(t,s,u,d,_,S){this.o=t,this.sw=s,this.sc=u,this.fc=d,this.m=_,this.p=S,this._mdf={o:!0,sw:!!s,sc:!!u,fc:!!d,m:!0,p:!0}}LetterProps.prototype.update=function(t,s,u,d,_,S){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var R=!1;return this.o!==t&&(this.o=t,this._mdf.o=!0,R=!0),this.sw!==s&&(this.sw=s,this._mdf.sw=!0,R=!0),this.sc!==u&&(this.sc=u,this._mdf.sc=!0,R=!0),this.fc!==d&&(this.fc=d,this._mdf.fc=!0,R=!0),this.m!==_&&(this.m=_,this._mdf.m=!0,R=!0),S.length&&(this.p[0]!==S[0]||this.p[1]!==S[1]||this.p[4]!==S[4]||this.p[5]!==S[5]||this.p[12]!==S[12]||this.p[13]!==S[13])&&(this.p=S,this._mdf.p=!0,R=!0),R};function TextProperty(t,s){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,s.d&&s.d.sid&&(s.d=t.globalData.slotManager.getProp(s.d)),this.data=s,this.elem=t,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(t,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(t[u]=s[u]);return t},TextProperty.prototype.setCurrentData=function(t){t.__complete||this.completeTextData(t),this.currentData=t,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(t){this.effectsSequence.push(t),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(t){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!t)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var s=this.currentData,u=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var d,_=this.effectsSequence.length,S=t||this.data.d.k[this.keysIndex].s;for(d=0;d<_;d+=1)u!==this.keysIndex?S=this.effectsSequence[d](S,S.t):S=this.effectsSequence[d](this.currentData,S.t);s!==S&&this.setCurrentData(S),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var t=this.data.d.k,s=this.elem.comp.renderedFrame,u=0,d=t.length;u<=d-1&&!(u===d-1||t[u+1].t>s);)u+=1;return this.keysIndex!==u&&(this.keysIndex=u),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(t){for(var s=[],u=0,d=t.length,_,S,R=!1,a=!1,k="";u<d;)R=a,a=!1,_=t.charCodeAt(u),k=t.charAt(u),FontManager.isCombinedCharacter(_)?R=!0:_>=55296&&_<=56319?FontManager.isRegionalFlag(t,u)?k=t.substr(u,14):(S=t.charCodeAt(u+1),S>=56320&&S<=57343&&(FontManager.isModifier(_,S)?(k=t.substr(u,2),R=!0):FontManager.isFlagEmoji(t.substr(u,4))?k=t.substr(u,4):k=t.substr(u,2))):_>56319?(S=t.charCodeAt(u+1),FontManager.isVariationSelector(_)&&(R=!0)):FontManager.isZeroWidthJoiner(_)&&(R=!0,a=!0),R?(s[s.length-1]+=k,R=!1):s.push(k),u+=k.length;return s},TextProperty.prototype.completeTextData=function(t){t.__complete=!0;var s=this.elem.globalData.fontManager,u=this.data,d=[],_,S,R,a=0,k,O=u.m.g,j=0,V=0,G=0,J=[],Z=0,Y=0,le,ee,se=s.getFontByName(t.f),Q,oe=0,_e=getFontProperties(se);t.fWeight=_e.weight,t.fStyle=_e.style,t.finalSize=t.s,t.finalText=this.buildFinalText(t.t),S=t.finalText.length,t.finalLineHeight=t.lh;var Se=t.tr/1e3*t.finalSize,ke;if(t.sz)for(var Le=!0,lt=t.sz[0],qt=t.sz[1],Yt,Ot;Le;){Ot=this.buildFinalText(t.t),Yt=0,Z=0,S=Ot.length,Se=t.tr/1e3*t.finalSize;var Bt=-1;for(_=0;_<S;_+=1)ke=Ot[_].charCodeAt(0),R=!1,Ot[_]===" "?Bt=_:(ke===13||ke===3)&&(Z=0,R=!0,Yt+=t.finalLineHeight||t.finalSize*1.2),s.chars?(Q=s.getCharData(Ot[_],se.fStyle,se.fFamily),oe=R?0:Q.w*t.finalSize/100):oe=s.measureText(Ot[_],t.f,t.finalSize),Z+oe>lt&&Ot[_]!==" "?(Bt===-1?S+=1:_=Bt,Yt+=t.finalLineHeight||t.finalSize*1.2,Ot.splice(_,Bt===_?1:0,"\r"),Bt=-1,Z=0):(Z+=oe,Z+=Se);Yt+=se.ascent*t.finalSize/100,this.canResize&&t.finalSize>this.minimumFontSize&&qt<Yt?(t.finalSize-=1,t.finalLineHeight=t.finalSize*t.lh/t.s):(t.finalText=Ot,S=t.finalText.length,Le=!1)}Z=-Se,oe=0;var si=0,kt;for(_=0;_<S;_+=1)if(R=!1,kt=t.finalText[_],ke=kt.charCodeAt(0),ke===13||ke===3?(si=0,J.push(Z),Y=Z>Y?Z:Y,Z=-2*Se,k="",R=!0,G+=1):k=kt,s.chars?(Q=s.getCharData(kt,se.fStyle,s.getFontByName(t.f).fFamily),oe=R?0:Q.w*t.finalSize/100):oe=s.measureText(k,t.f,t.finalSize),kt===" "?si+=oe+Se:(Z+=oe+Se+si,si=0),d.push({l:oe,an:oe,add:j,n:R,anIndexes:[],val:k,line:G,animatorJustifyOffset:0}),O==2){if(j+=oe,k===""||k===" "||_===S-1){for((k===""||k===" ")&&(j-=oe);V<=_;)d[V].an=j,d[V].ind=a,d[V].extra=oe,V+=1;a+=1,j=0}}else if(O==3){if(j+=oe,k===""||_===S-1){for(k===""&&(j-=oe);V<=_;)d[V].an=j,d[V].ind=a,d[V].extra=oe,V+=1;j=0,a+=1}}else d[a].ind=a,d[a].extra=0,a+=1;if(t.l=d,Y=Z>Y?Z:Y,J.push(Z),t.sz)t.boxWidth=t.sz[0],t.justifyOffset=0;else switch(t.boxWidth=Y,t.j){case 1:t.justifyOffset=-t.boxWidth;break;case 2:t.justifyOffset=-t.boxWidth/2;break;default:t.justifyOffset=0}t.lineWidths=J;var xe=u.a,Fe,pe;ee=xe.length;var Te,st,Me=[];for(le=0;le<ee;le+=1){for(Fe=xe[le],Fe.a.sc&&(t.strokeColorAnim=!0),Fe.a.sw&&(t.strokeWidthAnim=!0),(Fe.a.fc||Fe.a.fh||Fe.a.fs||Fe.a.fb)&&(t.fillColorAnim=!0),st=0,Te=Fe.s.b,_=0;_<S;_+=1)pe=d[_],pe.anIndexes[le]=st,(Te==1&&pe.val!==""||Te==2&&pe.val!==""&&pe.val!==" "||Te==3&&(pe.n||pe.val==" "||_==S-1)||Te==4&&(pe.n||_==S-1))&&(Fe.s.rn===1&&Me.push(st),st+=1);u.a[le].s.totalChars=st;var at=-1,ct;if(Fe.s.rn===1)for(_=0;_<S;_+=1)pe=d[_],at!=pe.anIndexes[le]&&(at=pe.anIndexes[le],ct=Me.splice(Math.floor(Math.random()*Me.length),1)[0]),pe.anIndexes[le]=ct}t.yOffset=t.finalLineHeight||t.finalSize*1.2,t.ls=t.ls||0,t.ascent=se.ascent*t.finalSize/100},TextProperty.prototype.updateDocumentData=function(t,s){s=s===void 0?this.keysIndex:s;var u=this.copyData({},this.data.d.k[s].s);u=this.copyData(u,t),this.data.d.k[s].s=u,this.recalculate(s),this.setCurrentData(u),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(t){var s=this.data.d.k[t].s;s.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(s)},TextProperty.prototype.canResizeFont=function(t){this.canResize=t,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(t){this.minimumFontSize=Math.floor(t)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=(function(){var t=Math.max,s=Math.min,u=Math.floor;function d(S,R){this._currentTextLength=-1,this.k=!1,this.data=R,this.elem=S,this.comp=S.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(S),this.s=PropertyFactory.getProp(S,R.s||{k:0},0,0,this),"e"in R?this.e=PropertyFactory.getProp(S,R.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(S,R.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(S,R.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(S,R.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(S,R.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(S,R.a,0,.01,this),this.dynamicProperties.length||this.getValue()}d.prototype={getMult:function(R){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var a=0,k=0,O=1,j=1;this.ne.v>0?a=this.ne.v/100:k=-this.ne.v/100,this.xe.v>0?O=1-this.xe.v/100:j=1+this.xe.v/100;var V=BezierFactory.getBezierEasing(a,k,O,j).get,G=0,J=this.finalS,Z=this.finalE,Y=this.data.sh;if(Y===2)Z===J?G=R>=Z?1:0:G=t(0,s(.5/(Z-J)+(R-J)/(Z-J),1)),G=V(G);else if(Y===3)Z===J?G=R>=Z?0:1:G=1-t(0,s(.5/(Z-J)+(R-J)/(Z-J),1)),G=V(G);else if(Y===4)Z===J?G=0:(G=t(0,s(.5/(Z-J)+(R-J)/(Z-J),1)),G<.5?G*=2:G=1-2*(G-.5)),G=V(G);else if(Y===5){if(Z===J)G=0;else{var le=Z-J;R=s(t(0,R+.5-J),Z-J);var ee=-le/2+R,se=le/2;G=Math.sqrt(1-ee*ee/(se*se))}G=V(G)}else Y===6?(Z===J?G=0:(R=s(t(0,R+.5-J),Z-J),G=(1+Math.cos(Math.PI+Math.PI*2*R/(Z-J)))/2),G=V(G)):(R>=u(J)&&(R-J<0?G=t(0,s(s(Z,1)-(J-R),1)):G=t(0,s(Z-R,1))),G=V(G));if(this.sm.v!==100){var Q=this.sm.v*.01;Q===0&&(Q=1e-8);var oe=.5-Q*.5;G<oe?G=0:(G=(G-oe)/Q,G>1&&(G=1))}return G*this.a.v},getValue:function(R){this.iterateDynamicProperties(),this._mdf=R||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,R&&this.data.r===2&&(this.e.v=this._currentTextLength);var a=this.data.r===2?1:100/this.data.totalChars,k=this.o.v/a,O=this.s.v/a+k,j=this.e.v/a+k;if(O>j){var V=O;O=j,j=V}this.finalS=O,this.finalE=j}},extendPrototype([DynamicPropertyContainer],d);function _(S,R,a){return new d(S,R)}return{getTextSelectorProp:_}})();function TextAnimatorDataProperty(t,s,u){var d={propType:!1},_=PropertyFactory.getProp,S=s.a;this.a={r:S.r?_(t,S.r,0,degToRads,u):d,rx:S.rx?_(t,S.rx,0,degToRads,u):d,ry:S.ry?_(t,S.ry,0,degToRads,u):d,sk:S.sk?_(t,S.sk,0,degToRads,u):d,sa:S.sa?_(t,S.sa,0,degToRads,u):d,s:S.s?_(t,S.s,1,.01,u):d,a:S.a?_(t,S.a,1,0,u):d,o:S.o?_(t,S.o,0,.01,u):d,p:S.p?_(t,S.p,1,0,u):d,sw:S.sw?_(t,S.sw,0,0,u):d,sc:S.sc?_(t,S.sc,1,0,u):d,fc:S.fc?_(t,S.fc,1,0,u):d,fh:S.fh?_(t,S.fh,0,0,u):d,fs:S.fs?_(t,S.fs,0,.01,u):d,fb:S.fb?_(t,S.fb,0,.01,u):d,t:S.t?_(t,S.t,0,0,u):d},this.s=TextSelectorProp.getTextSelectorProp(t,s.s,u),this.s.t=s.s.t}function TextAnimatorProperty(t,s,u){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=t,this._renderType=s,this._elem=u,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(u)}TextAnimatorProperty.prototype.searchProperties=function(){var t,s=this._textData.a.length,u,d=PropertyFactory.getProp;for(t=0;t<s;t+=1)u=this._textData.a[t],this._animatorsData[t]=new TextAnimatorDataProperty(this._elem,u,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:d(this._elem,this._textData.p.a,0,0,this),f:d(this._elem,this._textData.p.f,0,0,this),l:d(this._elem,this._textData.p.l,0,0,this),r:d(this._elem,this._textData.p.r,0,0,this),p:d(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=d(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(t,s){if(this.lettersChangedFlag=s,!(!this._mdf&&!this._isFirstFrame&&!s&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var u=this._moreOptions.alignment.v,d=this._animatorsData,_=this._textData,S=this.mHelper,R=this._renderType,a=this.renderedLetters.length,k,O,j,V,G=t.l,J,Z,Y,le,ee,se,Q,oe,_e,Se,ke,Le,lt,qt,Yt;if(this._hasMaskedPath){if(Yt=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Ot=Yt.v;this._pathData.r.v&&(Ot=Ot.reverse()),J={tLength:0,segments:[]},V=Ot._length-1;var Bt;for(Le=0,j=0;j<V;j+=1)Bt=bez.buildBezierData(Ot.v[j],Ot.v[j+1],[Ot.o[j][0]-Ot.v[j][0],Ot.o[j][1]-Ot.v[j][1]],[Ot.i[j+1][0]-Ot.v[j+1][0],Ot.i[j+1][1]-Ot.v[j+1][1]]),J.tLength+=Bt.segmentLength,J.segments.push(Bt),Le+=Bt.segmentLength;j=V,Yt.v.c&&(Bt=bez.buildBezierData(Ot.v[j],Ot.v[0],[Ot.o[j][0]-Ot.v[j][0],Ot.o[j][1]-Ot.v[j][1]],[Ot.i[0][0]-Ot.v[0][0],Ot.i[0][1]-Ot.v[0][1]]),J.tLength+=Bt.segmentLength,J.segments.push(Bt),Le+=Bt.segmentLength),this._pathData.pi=J}if(J=this._pathData.pi,Z=this._pathData.f.v,Q=0,se=1,le=0,ee=!0,Se=J.segments,Z<0&&Yt.v.c)for(J.tLength<Math.abs(Z)&&(Z=-Math.abs(Z)%J.tLength),Q=Se.length-1,_e=Se[Q].points,se=_e.length-1;Z<0;)Z+=_e[se].partialLength,se-=1,se<0&&(Q-=1,_e=Se[Q].points,se=_e.length-1);_e=Se[Q].points,oe=_e[se-1],Y=_e[se],ke=Y.partialLength}V=G.length,k=0,O=0;var si=t.finalSize*1.2*.714,kt=!0,xe,Fe,pe,Te,st;Te=d.length;var Me,at=-1,ct,Ct,li,mi=Z,bi=Q,zi=se,vi=-1,Gi,lr,zr,Ui,Ci,Gn,Wn,vn,Sr="",Xr=this.defaultPropsArray,es;if(t.j===2||t.j===1){var Un=0,dn=0,os=t.j===2?-.5:-1,Dr=0,jn=!0;for(j=0;j<V;j+=1)if(G[j].n){for(Un&&(Un+=dn);Dr<j;)G[Dr].animatorJustifyOffset=Un,Dr+=1;Un=0,jn=!0}else{for(pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.t.propType&&(jn&&t.j===2&&(dn+=xe.t.v*os),Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),Me.length?Un+=xe.t.v*Me[0]*os:Un+=xe.t.v*Me*os);jn=!1}for(Un&&(Un+=dn);Dr<j;)G[Dr].animatorJustifyOffset=Un,Dr+=1}for(j=0;j<V;j+=1){if(S.reset(),Gi=1,G[j].n)k=0,O+=t.yOffset,O+=kt?1:0,Z=mi,kt=!1,this._hasMaskedPath&&(Q=bi,se=zi,_e=Se[Q].points,oe=_e[se-1],Y=_e[se],ke=Y.partialLength,le=0),Sr="",vn="",Gn="",es="",Xr=this.defaultPropsArray;else{if(this._hasMaskedPath){if(vi!==G[j].line){switch(t.j){case 1:Z+=Le-t.lineWidths[G[j].line];break;case 2:Z+=(Le-t.lineWidths[G[j].line])/2;break}vi=G[j].line}at!==G[j].ind&&(G[at]&&(Z+=G[at].extra),Z+=G[j].an/2,at=G[j].ind),Z+=u[0]*G[j].an*.005;var Rn=0;for(pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.p.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),Me.length?Rn+=xe.p.v[0]*Me[0]:Rn+=xe.p.v[0]*Me),xe.a.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),Me.length?Rn+=xe.a.v[0]*Me[0]:Rn+=xe.a.v[0]*Me);for(ee=!0,this._pathData.a.v&&(Z=G[0].an*.5+(Le-this._pathData.f.v-G[0].an*.5-G[G.length-1].an*.5)*at/(V-1),Z+=this._pathData.f.v);ee;)le+ke>=Z+Rn||!_e?(lt=(Z+Rn-le)/Y.partialLength,Ct=oe.point[0]+(Y.point[0]-oe.point[0])*lt,li=oe.point[1]+(Y.point[1]-oe.point[1])*lt,S.translate(-u[0]*G[j].an*.005,-(u[1]*si)*.01),ee=!1):_e&&(le+=Y.partialLength,se+=1,se>=_e.length&&(se=0,Q+=1,Se[Q]?_e=Se[Q].points:Yt.v.c?(se=0,Q=0,_e=Se[Q].points):(le-=Y.partialLength,_e=null)),_e&&(oe=Y,Y=_e[se],ke=Y.partialLength));ct=G[j].an/2-G[j].add,S.translate(-ct,0,0)}else ct=G[j].an/2-G[j].add,S.translate(-ct,0,0),S.translate(-u[0]*G[j].an*.005,-u[1]*si*.01,0);for(pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.t.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),(k!==0||t.j!==0)&&(this._hasMaskedPath?Me.length?Z+=xe.t.v*Me[0]:Z+=xe.t.v*Me:Me.length?k+=xe.t.v*Me[0]:k+=xe.t.v*Me));for(t.strokeWidthAnim&&(zr=t.sw||0),t.strokeColorAnim&&(t.sc?lr=[t.sc[0],t.sc[1],t.sc[2]]:lr=[0,0,0]),t.fillColorAnim&&t.fc&&(Ui=[t.fc[0],t.fc[1],t.fc[2]]),pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.a.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),Me.length?S.translate(-xe.a.v[0]*Me[0],-xe.a.v[1]*Me[1],xe.a.v[2]*Me[2]):S.translate(-xe.a.v[0]*Me,-xe.a.v[1]*Me,xe.a.v[2]*Me));for(pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.s.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),Me.length?S.scale(1+(xe.s.v[0]-1)*Me[0],1+(xe.s.v[1]-1)*Me[1],1):S.scale(1+(xe.s.v[0]-1)*Me,1+(xe.s.v[1]-1)*Me,1));for(pe=0;pe<Te;pe+=1){if(xe=d[pe].a,Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),xe.sk.propType&&(Me.length?S.skewFromAxis(-xe.sk.v*Me[0],xe.sa.v*Me[1]):S.skewFromAxis(-xe.sk.v*Me,xe.sa.v*Me)),xe.r.propType&&(Me.length?S.rotateZ(-xe.r.v*Me[2]):S.rotateZ(-xe.r.v*Me)),xe.ry.propType&&(Me.length?S.rotateY(xe.ry.v*Me[1]):S.rotateY(xe.ry.v*Me)),xe.rx.propType&&(Me.length?S.rotateX(xe.rx.v*Me[0]):S.rotateX(xe.rx.v*Me)),xe.o.propType&&(Me.length?Gi+=(xe.o.v*Me[0]-Gi)*Me[0]:Gi+=(xe.o.v*Me-Gi)*Me),t.strokeWidthAnim&&xe.sw.propType&&(Me.length?zr+=xe.sw.v*Me[0]:zr+=xe.sw.v*Me),t.strokeColorAnim&&xe.sc.propType)for(Ci=0;Ci<3;Ci+=1)Me.length?lr[Ci]+=(xe.sc.v[Ci]-lr[Ci])*Me[0]:lr[Ci]+=(xe.sc.v[Ci]-lr[Ci])*Me;if(t.fillColorAnim&&t.fc){if(xe.fc.propType)for(Ci=0;Ci<3;Ci+=1)Me.length?Ui[Ci]+=(xe.fc.v[Ci]-Ui[Ci])*Me[0]:Ui[Ci]+=(xe.fc.v[Ci]-Ui[Ci])*Me;xe.fh.propType&&(Me.length?Ui=addHueToRGB(Ui,xe.fh.v*Me[0]):Ui=addHueToRGB(Ui,xe.fh.v*Me)),xe.fs.propType&&(Me.length?Ui=addSaturationToRGB(Ui,xe.fs.v*Me[0]):Ui=addSaturationToRGB(Ui,xe.fs.v*Me)),xe.fb.propType&&(Me.length?Ui=addBrightnessToRGB(Ui,xe.fb.v*Me[0]):Ui=addBrightnessToRGB(Ui,xe.fb.v*Me))}}for(pe=0;pe<Te;pe+=1)xe=d[pe].a,xe.p.propType&&(Fe=d[pe].s,Me=Fe.getMult(G[j].anIndexes[pe],_.a[pe].s.totalChars),this._hasMaskedPath?Me.length?S.translate(0,xe.p.v[1]*Me[0],-xe.p.v[2]*Me[1]):S.translate(0,xe.p.v[1]*Me,-xe.p.v[2]*Me):Me.length?S.translate(xe.p.v[0]*Me[0],xe.p.v[1]*Me[1],-xe.p.v[2]*Me[2]):S.translate(xe.p.v[0]*Me,xe.p.v[1]*Me,-xe.p.v[2]*Me));if(t.strokeWidthAnim&&(Gn=zr<0?0:zr),t.strokeColorAnim&&(Wn="rgb("+Math.round(lr[0]*255)+","+Math.round(lr[1]*255)+","+Math.round(lr[2]*255)+")"),t.fillColorAnim&&t.fc&&(vn="rgb("+Math.round(Ui[0]*255)+","+Math.round(Ui[1]*255)+","+Math.round(Ui[2]*255)+")"),this._hasMaskedPath){if(S.translate(0,-t.ls),S.translate(0,u[1]*si*.01+O,0),this._pathData.p.v){qt=(Y.point[1]-oe.point[1])/(Y.point[0]-oe.point[0]);var ys=Math.atan(qt)*180/Math.PI;Y.point[0]<oe.point[0]&&(ys+=180),S.rotate(-ys*Math.PI/180)}S.translate(Ct,li,0),Z-=u[0]*G[j].an*.005,G[j+1]&&at!==G[j+1].ind&&(Z+=G[j].an/2,Z+=t.tr*.001*t.finalSize)}else{switch(S.translate(k,O,0),t.ps&&S.translate(t.ps[0],t.ps[1]+t.ascent,0),t.j){case 1:S.translate(G[j].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[G[j].line]),0,0);break;case 2:S.translate(G[j].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[G[j].line])/2,0,0);break}S.translate(0,-t.ls),S.translate(ct,0,0),S.translate(u[0]*G[j].an*.005,u[1]*si*.01,0),k+=G[j].l+t.tr*.001*t.finalSize}R==="html"?Sr=S.toCSS():R==="svg"?Sr=S.to2dCSS():Xr=[S.props[0],S.props[1],S.props[2],S.props[3],S.props[4],S.props[5],S.props[6],S.props[7],S.props[8],S.props[9],S.props[10],S.props[11],S.props[12],S.props[13],S.props[14],S.props[15]],es=Gi}a<=j?(st=new LetterProps(es,Gn,Wn,vn,Sr,Xr),this.renderedLetters.push(st),a+=1,this.lettersChangedFlag=!0):(st=this.renderedLetters[j],this.lettersChangedFlag=st.update(es,Gn,Wn,vn,Sr,Xr)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(t,s,u){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(t,s,u),this.textProperty=new TextProperty(this,t.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(t.t,this.renderType,this),this.initTransform(t,s,u),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange)},ITextElement.prototype.createPathShape=function(t,s){var u,d=s.length,_,S="";for(u=0;u<d;u+=1)s[u].ty==="sh"&&(_=s[u].ks.k,S+=buildShapeString(_,_.i.length,!0,t));return S},ITextElement.prototype.updateDocumentData=function(t,s){this.textProperty.updateDocumentData(t,s)},ITextElement.prototype.canResizeFont=function(t){this.textProperty.canResizeFont(t)},ITextElement.prototype.setMinimumFontSize=function(t){this.textProperty.setMinimumFontSize(t)},ITextElement.prototype.applyTextPropertiesToMatrix=function(t,s,u,d,_){switch(t.ps&&s.translate(t.ps[0],t.ps[1]+t.ascent,0),s.translate(0,-t.ls,0),t.j){case 1:s.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[u]),0,0);break;case 2:s.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[u])/2,0,0);break}s.translate(d,_,0)},ITextElement.prototype.buildColor=function(t){return"rgb("+Math.round(t[0]*255)+","+Math.round(t[1]*255)+","+Math.round(t[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(t,s,u){this.textSpans=[],this.renderType="svg",this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(t){for(var s=0,u=t.length,d=[],_="";s<u;)t[s]==="\r"||t[s]===""?(d.push(_),_=""):_+=t[s],s+=1;return d.push(_),d},SVGTextLottieElement.prototype.buildShapeData=function(t,s){if(t.shapes&&t.shapes.length){var u=t.shapes[0];if(u.it){var d=u.it[u.it.length-1];d.s&&(d.s.k[0]=s,d.s.k[1]=s)}}return t},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var t,s,u=this.textProperty.currentData;this.renderedLetters=createSizedArray(u?u.l.length:0),u.fc?this.layerElement.setAttribute("fill",this.buildColor(u.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),u.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(u.sc)),this.layerElement.setAttribute("stroke-width",u.sw)),this.layerElement.setAttribute("font-size",u.finalSize);var d=this.globalData.fontManager.getFontByName(u.f);if(d.fClass)this.layerElement.setAttribute("class",d.fClass);else{this.layerElement.setAttribute("font-family",d.fFamily);var _=u.fWeight,S=u.fStyle;this.layerElement.setAttribute("font-style",S),this.layerElement.setAttribute("font-weight",_)}this.layerElement.setAttribute("aria-label",u.t);var R=u.l||[],a=!!this.globalData.fontManager.chars;s=R.length;var k,O=this.mHelper,j="",V=this.data.singleShape,G=0,J=0,Z=!0,Y=u.tr*.001*u.finalSize;if(V&&!a&&!u.sz){var le=this.textContainer,ee="start";switch(u.j){case 1:ee="end";break;case 2:ee="middle";break;default:ee="start";break}le.setAttribute("text-anchor",ee),le.setAttribute("letter-spacing",Y);var se=this.buildTextContents(u.finalText);for(s=se.length,J=u.ps?u.ps[1]+u.ascent:0,t=0;t<s;t+=1)k=this.textSpans[t].span||createNS("tspan"),k.textContent=se[t],k.setAttribute("x",0),k.setAttribute("y",J),k.style.display="inherit",le.appendChild(k),this.textSpans[t]||(this.textSpans[t]={span:null,glyph:null}),this.textSpans[t].span=k,J+=u.finalLineHeight;this.layerElement.appendChild(le)}else{var Q=this.textSpans.length,oe;for(t=0;t<s;t+=1){if(this.textSpans[t]||(this.textSpans[t]={span:null,childSpan:null,glyph:null}),!a||!V||t===0){if(k=Q>t?this.textSpans[t].span:createNS(a?"g":"text"),Q<=t){if(k.setAttribute("stroke-linecap","butt"),k.setAttribute("stroke-linejoin","round"),k.setAttribute("stroke-miterlimit","4"),this.textSpans[t].span=k,a){var _e=createNS("g");k.appendChild(_e),this.textSpans[t].childSpan=_e}this.textSpans[t].span=k,this.layerElement.appendChild(k)}k.style.display="inherit"}if(O.reset(),V&&(R[t].n&&(G=-Y,J+=u.yOffset,J+=Z?1:0,Z=!1),this.applyTextPropertiesToMatrix(u,O,R[t].line,G,J),G+=R[t].l||0,G+=Y),a){oe=this.globalData.fontManager.getCharData(u.finalText[t],d.fStyle,this.globalData.fontManager.getFontByName(u.f).fFamily);var Se;if(oe.t===1)Se=new SVGCompElement(oe.data,this.globalData,this);else{var ke=emptyShapeData;oe.data&&oe.data.shapes&&(ke=this.buildShapeData(oe.data,u.finalSize)),Se=new SVGShapeElement(ke,this.globalData,this)}if(this.textSpans[t].glyph){var Le=this.textSpans[t].glyph;this.textSpans[t].childSpan.removeChild(Le.layerElement),Le.destroy()}this.textSpans[t].glyph=Se,Se._debug=!0,Se.prepareFrame(0),Se.renderFrame(),this.textSpans[t].childSpan.appendChild(Se.layerElement),oe.t===1&&this.textSpans[t].childSpan.setAttribute("transform","scale("+u.finalSize/100+","+u.finalSize/100+")")}else V&&k.setAttribute("transform","translate("+O.props[12]+","+O.props[13]+")"),k.textContent=R[t].val,k.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}V&&k&&k.setAttribute("d",j)}for(;t<this.textSpans.length;)this.textSpans[t].span.style.display="none",t+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var t=this.layerElement.getBBox();this.bbox={top:t.y,left:t.x,width:t.width,height:t.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var t,s=this.textSpans.length,u;for(this.renderedFrame=this.comp.renderedFrame,t=0;t<s;t+=1)u=this.textSpans[t].glyph,u&&(u.prepareFrame(this.comp.renderedFrame-this.data.st),u._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var t,s,u=this.textAnimator.renderedLetters,d=this.textProperty.currentData.l;s=d.length;var _,S,R;for(t=0;t<s;t+=1)d[t].n||(_=u[t],S=this.textSpans[t].span,R=this.textSpans[t].glyph,R&&R.renderFrame(),_._mdf.m&&S.setAttribute("transform",_.m),_._mdf.o&&S.setAttribute("opacity",_.o),_._mdf.sw&&S.setAttribute("stroke-width",_.sw),_._mdf.sc&&S.setAttribute("stroke",_.sc),_._mdf.fc&&S.setAttribute("fill",_.fc))}};function ISolidElement(t,s,u){this.initElement(t,s,u)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var t=createNS("rect");t.setAttribute("width",this.data.sw),t.setAttribute("height",this.data.sh),t.setAttribute("fill",this.data.sc),this.layerElement.appendChild(t)};function NullElement(t,s,u){this.initFrame(),this.initBaseData(t,s,u),this.initFrame(),this.initTransform(t,s,u),this.initHierarchy()}NullElement.prototype.prepareFrame=function(t){this.prepareProperties(t,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(t){return new NullElement(t,this.globalData,this)},SVGRendererBase.prototype.createShape=function(t){return new SVGShapeElement(t,this.globalData,this)},SVGRendererBase.prototype.createText=function(t){return new SVGTextLottieElement(t,this.globalData,this)},SVGRendererBase.prototype.createImage=function(t){return new IImageElement(t,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(t){return new ISolidElement(t,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(t){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+t.w+" "+t.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",t.w),this.svgElement.setAttribute("height",t.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var s=this.globalData.defs;this.setupGlobalData(t,s),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=t;var u=createNS("clipPath"),d=createNS("rect");d.setAttribute("width",t.w),d.setAttribute("height",t.h),d.setAttribute("x",0),d.setAttribute("y",0);var _=createElementID();u.setAttribute("id",_),u.appendChild(d),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+_+")"),s.appendChild(u),this.layers=t.layers,this.elements=createSizedArray(t.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var t,s=this.layers?this.layers.length:0;for(t=0;t<s;t+=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(t){var s=0,u=this.layers.length;for(s=0;s<u;s+=1)if(this.layers[s].ind===t)return s;return-1},SVGRendererBase.prototype.buildItem=function(t){var s=this.elements;if(!(s[t]||this.layers[t].ty===99)){s[t]=!0;var u=this.createItem(this.layers[t]);if(s[t]=u,getExpressionsPlugin()&&(this.layers[t].ty===0&&this.globalData.projectInterface.registerComposition(u),u.initExpressions()),this.appendElementInPos(u,t),this.layers[t].tt){var d="tp"in this.layers[t]?this.findIndexByInd(this.layers[t].tp):t-1;if(d===-1)return;if(!this.elements[d]||this.elements[d]===!0)this.buildItem(d),this.addPendingElement(u);else{var _=s[d],S=_.getMatte(this.layers[t].tt);u.setMatte(S)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var t=this.pendingElements.pop();if(t.checkParenting(),t.data.tt)for(var s=0,u=this.elements.length;s<u;){if(this.elements[s]===t){var d="tp"in t.data?this.findIndexByInd(t.data.tp):s-1,_=this.elements[d],S=_.getMatte(this.layers[s].tt);t.setMatte(S);break}s+=1}}},SVGRendererBase.prototype.renderFrame=function(t){if(!(this.renderedFrame===t||this.destroyed)){t===null?t=this.renderedFrame:this.renderedFrame=t,this.globalData.frameNum=t,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=t,this.globalData._mdf=!1;var s,u=this.layers.length;for(this.completeLayers||this.checkLayers(t),s=u-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(t-this.layers[s].st);if(this.globalData._mdf)for(s=0;s<u;s+=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(t,s){var u=t.getBaseElement();if(u){for(var d=0,_;d<s;)this.elements[d]&&this.elements[d]!==!0&&this.elements[d].getBaseElement()&&(_=this.elements[d].getBaseElement()),d+=1;_?this.layerElement.insertBefore(u,_):this.layerElement.appendChild(u)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(t,s,u){this.initFrame(),this.initBaseData(t,s,u),this.initTransform(t,s,u),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!s.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(t){if(this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=t/this.data.sr;else{var s=this.tm.v;s===this.data.op&&(s=this.data.op-1),this.renderedFrame=s}var u,d=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),u=d-1;u>=0;u-=1)(this.completeLayers||this.elements[u])&&(this.elements[u].prepareFrame(this.renderedFrame-this.layers[u].st),this.elements[u]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var t,s=this.layers.length;for(t=0;t<s;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()},ICompElement.prototype.setElements=function(t){this.elements=t},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var t,s=this.layers.length;for(t=0;t<s;t+=1)this.elements[t]&&this.elements[t].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(t,s,u){this.layers=t.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(t,s,u),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(t){return new SVGCompElement(t,this.globalData,this)};function SVGRenderer(t,s){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var u="";if(s&&s.title){var d=createNS("title"),_=createElementID();d.setAttribute("id",_),d.textContent=s.title,this.svgElement.appendChild(d),u+=_}if(s&&s.description){var S=createNS("desc"),R=createElementID();S.setAttribute("id",R),S.textContent=s.description,this.svgElement.appendChild(S),u+=" "+R}u&&this.svgElement.setAttribute("aria-labelledby",u);var a=createNS("defs");this.svgElement.appendChild(a);var k=createNS("g");this.svgElement.appendChild(k),this.layerElement=k,this.renderConfig={preserveAspectRatio:s&&s.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:s&&s.contentVisibility||"visible",progressiveLoad:s&&s.progressiveLoad||!1,hideOnTransparent:!(s&&s.hideOnTransparent===!1),viewBoxOnly:s&&s.viewBoxOnly||!1,viewBoxSize:s&&s.viewBoxSize||!1,className:s&&s.className||"",id:s&&s.id||"",focusable:s&&s.focusable,filterSize:{width:s&&s.filterSize&&s.filterSize.width||"100%",height:s&&s.filterSize&&s.filterSize.height||"100%",x:s&&s.filterSize&&s.filterSize.x||"0%",y:s&&s.filterSize&&s.filterSize.y||"0%"},width:s&&s.width,height:s&&s.height,runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:a,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(t){return new SVGCompElement(t,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(s){var u,d=s.length,_="_";for(u=0;u<d;u+=1)_+=s[u].transform.key+"_";var S=this.sequences[_];return S||(S={transforms:[].concat(s),finalTransform:new Matrix,_mdf:!1},this.sequences[_]=S,this.sequenceList.push(S)),S},processSequence:function(s,u){for(var d=0,_=s.transforms.length,S=u;d<_&&!u;){if(s.transforms[d].transform.mProps._mdf){S=!0;break}d+=1}if(S)for(s.finalTransform.reset(),d=_-1;d>=0;d-=1)s.finalTransform.multiply(s.transforms[d].transform.mProps.v);s._mdf=S},processSequences:function(s){var u,d=this.sequenceList.length;for(u=0;u<d;u+=1)this.processSequence(this.sequenceList[u],s)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var s="__lottie_element_luma_buffer",u=null,d=null,_=null;function S(){var k=createNS("svg"),O=createNS("filter"),j=createNS("feColorMatrix");return O.setAttribute("id",s),j.setAttribute("type","matrix"),j.setAttribute("color-interpolation-filters","sRGB"),j.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),O.appendChild(j),k.appendChild(O),k.setAttribute("id",s+"_svg"),featureSupport.svgLumaHidden&&(k.style.display="none"),k}function R(){u||(_=S(),document.body.appendChild(_),u=createTag("canvas"),d=u.getContext("2d"),d.filter="url(#"+s+")",d.fillStyle="rgba(0,0,0,0)",d.fillRect(0,0,1,1))}function a(k){return u||R(),u.width=k.width,u.height=k.height,d.filter="url(#"+s+")",u}return{load:R,get:a}};function createCanvas(t,s){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(t,s);var u=createTag("canvas");return u.width=t,u.height=s,u}var assetLoader=(function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}})(),registeredEffects={};function CVEffects(t){var s,u=t.data.ef?t.data.ef.length:0;this.filters=[];var d;for(s=0;s<u;s+=1){d=null;var _=t.data.ef[s].ty;if(registeredEffects[_]){var S=registeredEffects[_].effect;d=new S(t.effectsManager.effectElements[s],t)}d&&this.filters.push(d)}this.filters.length&&t.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(t){var s,u=this.filters.length;for(s=0;s<u;s+=1)this.filters[s].renderFrame(t)},CVEffects.prototype.getEffects=function(t){var s,u=this.filters.length,d=[];for(s=0;s<u;s+=1)this.filters[s].type===t&&d.push(this.filters[s]);return d};function registerEffect(t,s){registeredEffects[t]={effect:s}}function CVMaskElement(t,s){this.data=t,this.element=s,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var u,d=this.masksProperties.length,_=!1;for(u=0;u<d;u+=1)this.masksProperties[u].mode!=="n"&&(_=!0),this.viewData[u]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[u],3);this.hasMasks=_,_&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var t=this.element.finalTransform.mat,s=this.element.canvasContext,u,d=this.masksProperties.length,_,S,R;for(s.beginPath(),u=0;u<d;u+=1)if(this.masksProperties[u].mode!=="n"){this.masksProperties[u].inv&&(s.moveTo(0,0),s.lineTo(this.element.globalData.compSize.w,0),s.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),s.lineTo(0,this.element.globalData.compSize.h),s.lineTo(0,0)),R=this.viewData[u].v,_=t.applyToPointArray(R.v[0][0],R.v[0][1],0),s.moveTo(_[0],_[1]);var a,k=R._length;for(a=1;a<k;a+=1)S=t.applyToTriplePoints(R.o[a-1],R.i[a],R.v[a]),s.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]);S=t.applyToTriplePoints(R.o[a-1],R.i[0],R.v[0]),s.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5])}this.element.globalData.renderer.save(!0),s.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var s=this.globalData.canvasContext,u=assetLoader.createCanvas(s.canvas.width,s.canvas.height);this.buffers.push(u);var d=assetLoader.createCanvas(s.canvas.width,s.canvas.height);this.buffers.push(d),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var s=this.globalData;if(s.blendMode!==this.data.bm){s.blendMode=this.data.bm;var u=getBlendMode(this.data.bm);s.canvasContext.globalCompositeOperation=u}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(s){s.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var s=this.buffers[0],u=s.getContext("2d");this.clearCanvas(u),u.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var s=this.buffers[1],u=s.getContext("2d");this.clearCanvas(u),u.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var d=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(d.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var _=assetLoader.getLumaCanvas(this.canvasContext.canvas),S=_.getContext("2d");S.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(_,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(s,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(s){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!s)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var u=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(u),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(u),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(t,s,u,d){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var _=4;s.ty==="rc"?_=5:s.ty==="el"?_=6:s.ty==="sr"&&(_=7),this.sh=ShapePropertyFactory.getShapeProp(t,s,_,t);var S,R=u.length,a;for(S=0;S<R;S+=1)u[S].closed||(a={transforms:d.addTransformSequence(u[S].transforms),trNodes:[]},this.styledShapes.push(a),u[S].elements.push(a))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(t,s,u){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(t,s){var u={data:t,type:t.ty,preTransforms:this.transformsManager.addTransformSequence(s),transforms:[],elements:[],closed:t.hd===!0},d={};if(t.ty==="fl"||t.ty==="st"?(d.c=PropertyFactory.getProp(this,t.c,1,255,this),d.c.k||(u.co="rgb("+bmFloor(d.c.v[0])+","+bmFloor(d.c.v[1])+","+bmFloor(d.c.v[2])+")")):(t.ty==="gf"||t.ty==="gs")&&(d.s=PropertyFactory.getProp(this,t.s,1,null,this),d.e=PropertyFactory.getProp(this,t.e,1,null,this),d.h=PropertyFactory.getProp(this,t.h||{k:0},0,.01,this),d.a=PropertyFactory.getProp(this,t.a||{k:0},0,degToRads,this),d.g=new GradientProperty(this,t.g,this)),d.o=PropertyFactory.getProp(this,t.o,0,.01,this),t.ty==="st"||t.ty==="gs"){if(u.lc=lineCapEnum[t.lc||2],u.lj=lineJoinEnum[t.lj||2],t.lj==1&&(u.ml=t.ml),d.w=PropertyFactory.getProp(this,t.w,0,null,this),d.w.k||(u.wi=d.w.v),t.d){var _=new DashProperty(this,t.d,"canvas",this);d.d=_,d.d.k||(u.da=d.d.dashArray,u.do=d.d.dashoffset[0])}}else u.r=t.r===2?"evenodd":"nonzero";return this.stylesList.push(u),d.style=u,d},CVShapeElement.prototype.createGroupElement=function(){var t={it:[],prevViewData:[]};return t},CVShapeElement.prototype.createTransformElement=function(t){var s={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,t.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,t,this)}};return s},CVShapeElement.prototype.createShapeElement=function(t){var s=new CVShapeData(this,t,this.stylesList,this.transformsManager);return this.shapes.push(s),this.addShapeToModifiers(s),s},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var t,s=this.itemsData.length;for(t=0;t<s;t+=1)this.prevViewData[t]=this.itemsData[t];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),s=this.dynamicProperties.length,t=0;t<s;t+=1)this.dynamicProperties[t].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(t){var s,u=this.stylesList.length;for(s=0;s<u;s+=1)this.stylesList[s].closed||this.stylesList[s].transforms.push(t)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var t,s=this.stylesList.length;for(t=0;t<s;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.pop()},CVShapeElement.prototype.closeStyles=function(t){var s,u=t.length;for(s=0;s<u;s+=1)t[s].closed=!0},CVShapeElement.prototype.searchShapes=function(t,s,u,d,_){var S,R=t.length-1,a,k,O=[],j=[],V,G,J,Z=[].concat(_);for(S=R;S>=0;S-=1){if(V=this.searchProcessedElement(t[S]),V?s[S]=u[V-1]:t[S]._shouldRender=d,t[S].ty==="fl"||t[S].ty==="st"||t[S].ty==="gf"||t[S].ty==="gs")V?s[S].style.closed=!1:s[S]=this.createStyleElement(t[S],Z),O.push(s[S].style);else if(t[S].ty==="gr"){if(!V)s[S]=this.createGroupElement(t[S]);else for(k=s[S].it.length,a=0;a<k;a+=1)s[S].prevViewData[a]=s[S].it[a];this.searchShapes(t[S].it,s[S].it,s[S].prevViewData,d,Z)}else t[S].ty==="tr"?(V||(J=this.createTransformElement(t[S]),s[S]=J),Z.push(s[S]),this.addTransformToStyleList(s[S])):t[S].ty==="sh"||t[S].ty==="rc"||t[S].ty==="el"||t[S].ty==="sr"?V||(s[S]=this.createShapeElement(t[S])):t[S].ty==="tm"||t[S].ty==="rd"||t[S].ty==="pb"||t[S].ty==="zz"||t[S].ty==="op"?(V?(G=s[S],G.closed=!1):(G=ShapeModifiers.getModifier(t[S].ty),G.init(this,t[S]),s[S]=G,this.shapeModifiers.push(G)),j.push(G)):t[S].ty==="rp"&&(V?(G=s[S],G.closed=!0):(G=ShapeModifiers.getModifier(t[S].ty),s[S]=G,G.init(this,t,S,s),this.shapeModifiers.push(G),d=!1),j.push(G));this.addProcessedElement(t[S],S+1)}for(this.removeTransformFromStyleList(),this.closeStyles(O),R=j.length,S=0;S<R;S+=1)j[S].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(t,s){(t._opMdf||s.op._mdf||this._isFirstFrame)&&(s.opacity=t.opacity,s.opacity*=s.op.v,s._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var t,s=this.stylesList.length,u,d,_,S,R,a,k=this.globalData.renderer,O=this.globalData.canvasContext,j,V;for(t=0;t<s;t+=1)if(V=this.stylesList[t],j=V.type,!((j==="st"||j==="gs")&&V.wi===0||!V.data._shouldRender||V.coOp===0||this.globalData.currentGlobalAlpha===0)){for(k.save(),R=V.elements,j==="st"||j==="gs"?(k.ctxStrokeStyle(j==="st"?V.co:V.grd),k.ctxLineWidth(V.wi),k.ctxLineCap(V.lc),k.ctxLineJoin(V.lj),k.ctxMiterLimit(V.ml||0)):k.ctxFillStyle(j==="fl"?V.co:V.grd),k.ctxOpacity(V.coOp),j!=="st"&&j!=="gs"&&O.beginPath(),k.ctxTransform(V.preTransforms.finalTransform.props),d=R.length,u=0;u<d;u+=1){for((j==="st"||j==="gs")&&(O.beginPath(),V.da&&(O.setLineDash(V.da),O.lineDashOffset=V.do)),a=R[u].trNodes,S=a.length,_=0;_<S;_+=1)a[_].t==="m"?O.moveTo(a[_].p[0],a[_].p[1]):a[_].t==="c"?O.bezierCurveTo(a[_].pts[0],a[_].pts[1],a[_].pts[2],a[_].pts[3],a[_].pts[4],a[_].pts[5]):O.closePath();(j==="st"||j==="gs")&&(k.ctxStroke(),V.da&&O.setLineDash(this.dashResetter))}j!=="st"&&j!=="gs"&&this.globalData.renderer.ctxFill(V.r),k.restore()}},CVShapeElement.prototype.renderShape=function(t,s,u,d){var _,S=s.length-1,R;for(R=t,_=S;_>=0;_-=1)s[_].ty==="tr"?(R=u[_].transform,this.renderShapeTransform(t,R)):s[_].ty==="sh"||s[_].ty==="el"||s[_].ty==="rc"||s[_].ty==="sr"?this.renderPath(s[_],u[_]):s[_].ty==="fl"?this.renderFill(s[_],u[_],R):s[_].ty==="st"?this.renderStroke(s[_],u[_],R):s[_].ty==="gf"||s[_].ty==="gs"?this.renderGradientFill(s[_],u[_],R):s[_].ty==="gr"?this.renderShape(R,s[_].it,u[_].it):s[_].ty;d&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(t,s){if(this._isFirstFrame||s._mdf||t.transforms._mdf){var u=t.trNodes,d=s.paths,_,S,R,a=d._length;u.length=0;var k=t.transforms.finalTransform;for(R=0;R<a;R+=1){var O=d.shapes[R];if(O&&O.v){for(S=O._length,_=1;_<S;_+=1)_===1&&u.push({t:"m",p:k.applyToPointArray(O.v[0][0],O.v[0][1],0)}),u.push({t:"c",pts:k.applyToTriplePoints(O.o[_-1],O.i[_],O.v[_])});S===1&&u.push({t:"m",p:k.applyToPointArray(O.v[0][0],O.v[0][1],0)}),O.c&&S&&(u.push({t:"c",pts:k.applyToTriplePoints(O.o[_-1],O.i[0],O.v[0])}),u.push({t:"z"}))}}t.trNodes=u}},CVShapeElement.prototype.renderPath=function(t,s){if(t.hd!==!0&&t._shouldRender){var u,d=s.styledShapes.length;for(u=0;u<d;u+=1)this.renderStyledShape(s.styledShapes[u],s.sh)}},CVShapeElement.prototype.renderFill=function(t,s,u){var d=s.style;(s.c._mdf||this._isFirstFrame)&&(d.co="rgb("+bmFloor(s.c.v[0])+","+bmFloor(s.c.v[1])+","+bmFloor(s.c.v[2])+")"),(s.o._mdf||u._opMdf||this._isFirstFrame)&&(d.coOp=s.o.v*u.opacity)},CVShapeElement.prototype.renderGradientFill=function(t,s,u){var d=s.style,_;if(!d.grd||s.g._mdf||s.s._mdf||s.e._mdf||t.t!==1&&(s.h._mdf||s.a._mdf)){var S=this.globalData.canvasContext,R=s.s.v,a=s.e.v;if(t.t===1)_=S.createLinearGradient(R[0],R[1],a[0],a[1]);else{var k=Math.sqrt(Math.pow(R[0]-a[0],2)+Math.pow(R[1]-a[1],2)),O=Math.atan2(a[1]-R[1],a[0]-R[0]),j=s.h.v;j>=1?j=.99:j<=-1&&(j=-.99);var V=k*j,G=Math.cos(O+s.a.v)*V+R[0],J=Math.sin(O+s.a.v)*V+R[1];_=S.createRadialGradient(G,J,0,R[0],R[1],k)}var Z,Y=t.g.p,le=s.g.c,ee=1;for(Z=0;Z<Y;Z+=1)s.g._hasOpacity&&s.g._collapsable&&(ee=s.g.o[Z*2+1]),_.addColorStop(le[Z*4]/100,"rgba("+le[Z*4+1]+","+le[Z*4+2]+","+le[Z*4+3]+","+ee+")");d.grd=_}d.coOp=s.o.v*u.opacity},CVShapeElement.prototype.renderStroke=function(t,s,u){var d=s.style,_=s.d;_&&(_._mdf||this._isFirstFrame)&&(d.da=_.dashArray,d.do=_.dashoffset[0]),(s.c._mdf||this._isFirstFrame)&&(d.co="rgb("+bmFloor(s.c.v[0])+","+bmFloor(s.c.v[1])+","+bmFloor(s.c.v[2])+")"),(s.o._mdf||u._opMdf||this._isFirstFrame)&&(d.coOp=s.o.v*u.opacity),(s.w._mdf||this._isFirstFrame)&&(d.wi=s.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(t,s,u){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t.l?t.l.length:0);var s=!1;t.fc?(s=!0,this.values.fill=this.buildColor(t.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=s;var u=!1;t.sc&&(u=!0,this.values.stroke=this.buildColor(t.sc),this.values.sWidth=t.sw);var d=this.globalData.fontManager.getFontByName(t.f),_,S,R=t.l,a=this.mHelper;this.stroke=u,this.values.fValue=t.finalSize+"px "+this.globalData.fontManager.getFontByName(t.f).fFamily,S=t.finalText.length;var k,O,j,V,G,J,Z,Y,le,ee,se=this.data.singleShape,Q=t.tr*.001*t.finalSize,oe=0,_e=0,Se=!0,ke=0;for(_=0;_<S;_+=1){k=this.globalData.fontManager.getCharData(t.finalText[_],d.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily),O=k&&k.data||{},a.reset(),se&&R[_].n&&(oe=-Q,_e+=t.yOffset,_e+=Se?1:0,Se=!1),G=O.shapes?O.shapes[0].it:[],Z=G.length,a.scale(t.finalSize/100,t.finalSize/100),se&&this.applyTextPropertiesToMatrix(t,a,R[_].line,oe,_e),le=createSizedArray(Z-1);var Le=0;for(J=0;J<Z;J+=1)if(G[J].ty==="sh"){for(V=G[J].ks.k.i.length,Y=G[J].ks.k,ee=[],j=1;j<V;j+=1)j===1&&ee.push(a.applyToX(Y.v[0][0],Y.v[0][1],0),a.applyToY(Y.v[0][0],Y.v[0][1],0)),ee.push(a.applyToX(Y.o[j-1][0],Y.o[j-1][1],0),a.applyToY(Y.o[j-1][0],Y.o[j-1][1],0),a.applyToX(Y.i[j][0],Y.i[j][1],0),a.applyToY(Y.i[j][0],Y.i[j][1],0),a.applyToX(Y.v[j][0],Y.v[j][1],0),a.applyToY(Y.v[j][0],Y.v[j][1],0));ee.push(a.applyToX(Y.o[j-1][0],Y.o[j-1][1],0),a.applyToY(Y.o[j-1][0],Y.o[j-1][1],0),a.applyToX(Y.i[0][0],Y.i[0][1],0),a.applyToY(Y.i[0][0],Y.i[0][1],0),a.applyToX(Y.v[0][0],Y.v[0][1],0),a.applyToY(Y.v[0][0],Y.v[0][1],0)),le[Le]=ee,Le+=1}se&&(oe+=R[_].l,oe+=Q),this.textSpans[ke]?this.textSpans[ke].elem=le:this.textSpans[ke]={elem:le},ke+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var t=this.canvasContext;t.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var s,u,d,_,S,R,a=this.textAnimator.renderedLetters,k=this.textProperty.currentData.l;u=k.length;var O,j=null,V=null,G=null,J,Z,Y=this.globalData.renderer;for(s=0;s<u;s+=1)if(!k[s].n){if(O=a[s],O&&(Y.save(),Y.ctxTransform(O.p),Y.ctxOpacity(O.o)),this.fill){for(O&&O.fc?j!==O.fc&&(Y.ctxFillStyle(O.fc),j=O.fc):j!==this.values.fill&&(j=this.values.fill,Y.ctxFillStyle(this.values.fill)),J=this.textSpans[s].elem,_=J.length,this.globalData.canvasContext.beginPath(),d=0;d<_;d+=1)for(Z=J[d],R=Z.length,this.globalData.canvasContext.moveTo(Z[0],Z[1]),S=2;S<R;S+=6)this.globalData.canvasContext.bezierCurveTo(Z[S],Z[S+1],Z[S+2],Z[S+3],Z[S+4],Z[S+5]);this.globalData.canvasContext.closePath(),Y.ctxFill()}if(this.stroke){for(O&&O.sw?G!==O.sw&&(G=O.sw,Y.ctxLineWidth(O.sw)):G!==this.values.sWidth&&(G=this.values.sWidth,Y.ctxLineWidth(this.values.sWidth)),O&&O.sc?V!==O.sc&&(V=O.sc,Y.ctxStrokeStyle(O.sc)):V!==this.values.stroke&&(V=this.values.stroke,Y.ctxStrokeStyle(this.values.stroke)),J=this.textSpans[s].elem,_=J.length,this.globalData.canvasContext.beginPath(),d=0;d<_;d+=1)for(Z=J[d],R=Z.length,this.globalData.canvasContext.moveTo(Z[0],Z[1]),S=2;S<R;S+=6)this.globalData.canvasContext.bezierCurveTo(Z[S],Z[S+1],Z[S+2],Z[S+3],Z[S+4],Z[S+5]);this.globalData.canvasContext.closePath(),Y.ctxStroke()}O&&this.globalData.renderer.restore()}};function CVImageElement(t,s,u){this.assetData=s.getAssetData(t.refId),this.img=s.imageLoader.getAsset(this.assetData),this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var t=createTag("canvas");t.width=this.assetData.w,t.height=this.assetData.h;var s=t.getContext("2d"),u=this.img.width,d=this.img.height,_=u/d,S=this.assetData.w/this.assetData.h,R,a,k=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;_>S&&k==="xMidYMid slice"||_<S&&k!=="xMidYMid slice"?(a=d,R=a*S):(R=u,a=R/S),s.drawImage(this.img,(u-R)/2,(d-a)/2,R,a,0,0,this.assetData.w,this.assetData.h),this.img=t}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(t,s,u){this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(t){return new CVShapeElement(t,this.globalData,this)},CanvasRendererBase.prototype.createText=function(t){return new CVTextElement(t,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(t){return new CVImageElement(t,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(t){return new CVSolidElement(t,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(t){t[0]===1&&t[1]===0&&t[4]===0&&t[5]===1&&t[12]===0&&t[13]===0||this.canvasContext.transform(t[0],t[1],t[4],t[5],t[12],t[13])},CanvasRendererBase.prototype.ctxOpacity=function(t){this.canvasContext.globalAlpha*=t<0?0:t},CanvasRendererBase.prototype.ctxFillStyle=function(t){this.canvasContext.fillStyle=t},CanvasRendererBase.prototype.ctxStrokeStyle=function(t){this.canvasContext.strokeStyle=t},CanvasRendererBase.prototype.ctxLineWidth=function(t){this.canvasContext.lineWidth=t},CanvasRendererBase.prototype.ctxLineCap=function(t){this.canvasContext.lineCap=t},CanvasRendererBase.prototype.ctxLineJoin=function(t){this.canvasContext.lineJoin=t},CanvasRendererBase.prototype.ctxMiterLimit=function(t){this.canvasContext.miterLimit=t},CanvasRendererBase.prototype.ctxFill=function(t){this.canvasContext.fill(t)},CanvasRendererBase.prototype.ctxFillRect=function(t,s,u,d){this.canvasContext.fillRect(t,s,u,d)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(t){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}t&&(this.globalData.blendMode="source-over"),this.contextData.restore(t)},CanvasRendererBase.prototype.configAnimation=function(t){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var s=this.animationItem.container.style;s.width="100%",s.height="100%";var u="0px 0px 0px";s.transformOrigin=u,s.mozTransformOrigin=u,s.webkitTransformOrigin=u,s["-webkit-transform"]=u,s.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=t,this.layers=t.layers,this.transformCanvas={w:t.w,h:t.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(t,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(t.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(t,s){this.reset();var u,d;t?(u=t,d=s,this.canvasContext.canvas.width=u,this.canvasContext.canvas.height=d):(this.animationItem.wrapper&&this.animationItem.container?(u=this.animationItem.wrapper.offsetWidth,d=this.animationItem.wrapper.offsetHeight):(u=this.canvasContext.canvas.width,d=this.canvasContext.canvas.height),this.canvasContext.canvas.width=u*this.renderConfig.dpr,this.canvasContext.canvas.height=d*this.renderConfig.dpr);var _,S;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var R=this.renderConfig.preserveAspectRatio.split(" "),a=R[1]||"meet",k=R[0]||"xMidYMid",O=k.substr(0,4),j=k.substr(4);_=u/d,S=this.transformCanvas.w/this.transformCanvas.h,S>_&&a==="meet"||S<_&&a==="slice"?(this.transformCanvas.sx=u/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=u/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=d/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=d/(this.transformCanvas.h/this.renderConfig.dpr)),O==="xMid"&&(S<_&&a==="meet"||S>_&&a==="slice")?this.transformCanvas.tx=(u-this.transformCanvas.w*(d/this.transformCanvas.h))/2*this.renderConfig.dpr:O==="xMax"&&(S<_&&a==="meet"||S>_&&a==="slice")?this.transformCanvas.tx=(u-this.transformCanvas.w*(d/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,j==="YMid"&&(S>_&&a==="meet"||S<_&&a==="slice")?this.transformCanvas.ty=(d-this.transformCanvas.h*(u/this.transformCanvas.w))/2*this.renderConfig.dpr:j==="YMax"&&(S>_&&a==="meet"||S<_&&a==="slice")?this.transformCanvas.ty=(d-this.transformCanvas.h*(u/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=u/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=d/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var t,s=this.layers?this.layers.length:0;for(t=s-1;t>=0;t-=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(t,s){if(!(this.renderedFrame===t&&this.renderConfig.clearCanvas===!0&&!s||this.destroyed||t===-1)){this.renderedFrame=t,this.globalData.frameNum=t-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||s,this.globalData.projectInterface.currentFrame=t;var u,d=this.layers.length;for(this.completeLayers||this.checkLayers(t),u=d-1;u>=0;u-=1)(this.completeLayers||this.elements[u])&&this.elements[u].prepareFrame(t-this.layers[u].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),u=d-1;u>=0;u-=1)(this.completeLayers||this.elements[u])&&this.elements[u].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(t){var s=this.elements;if(!(s[t]||this.layers[t].ty===99)){var u=this.createItem(this.layers[t],this,this.globalData);s[t]=u,u.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var t=this.pendingElements.pop();t.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var t,s=15;for(t=0;t<s;t+=1){var u=new CanvasContext;this.stack[t]=u}this._length=s,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var t=this._length*2,s=0;for(s=this._length;s<t;s+=1)this.stack[s]=new CanvasContext;this._length=t},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(t){this.cArrPos-=1;var s=this.stack[this.cArrPos],u=s.transform,d,_=this.cTr.props;for(d=0;d<16;d+=1)_[d]=u[d];if(t){this.nativeContext.restore();var S=this.stack[this.cArrPos+1];this.appliedFillStyle=S.fillStyle,this.appliedStrokeStyle=S.strokeStyle,this.appliedLineWidth=S.lineWidth,this.appliedLineCap=S.lineCap,this.appliedLineJoin=S.lineJoin,this.appliedMiterLimit=S.miterLimit}this.nativeContext.setTransform(u[0],u[1],u[4],u[5],u[12],u[13]),(t||s.opacity!==-1&&this.currentOpacity!==s.opacity)&&(this.nativeContext.globalAlpha=s.opacity,this.currentOpacity=s.opacity),this.currentFillStyle=s.fillStyle,this.currentStrokeStyle=s.strokeStyle,this.currentLineWidth=s.lineWidth,this.currentLineCap=s.lineCap,this.currentLineJoin=s.lineJoin,this.currentMiterLimit=s.miterLimit},CVContextData.prototype.save=function(t){t&&this.nativeContext.save();var s=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var u=this.stack[this.cArrPos],d;for(d=0;d<16;d+=1)u.transform[d]=s[d];this.cArrPos+=1;var _=this.stack[this.cArrPos];_.opacity=u.opacity,_.fillStyle=u.fillStyle,_.strokeStyle=u.strokeStyle,_.lineWidth=u.lineWidth,_.lineCap=u.lineCap,_.lineJoin=u.lineJoin,_.miterLimit=u.miterLimit},CVContextData.prototype.setOpacity=function(t){this.stack[this.cArrPos].opacity=t},CVContextData.prototype.setContext=function(t){this.nativeContext=t},CVContextData.prototype.fillStyle=function(t){this.stack[this.cArrPos].fillStyle!==t&&(this.currentFillStyle=t,this.stack[this.cArrPos].fillStyle=t)},CVContextData.prototype.strokeStyle=function(t){this.stack[this.cArrPos].strokeStyle!==t&&(this.currentStrokeStyle=t,this.stack[this.cArrPos].strokeStyle=t)},CVContextData.prototype.lineWidth=function(t){this.stack[this.cArrPos].lineWidth!==t&&(this.currentLineWidth=t,this.stack[this.cArrPos].lineWidth=t)},CVContextData.prototype.lineCap=function(t){this.stack[this.cArrPos].lineCap!==t&&(this.currentLineCap=t,this.stack[this.cArrPos].lineCap=t)},CVContextData.prototype.lineJoin=function(t){this.stack[this.cArrPos].lineJoin!==t&&(this.currentLineJoin=t,this.stack[this.cArrPos].lineJoin=t)},CVContextData.prototype.miterLimit=function(t){this.stack[this.cArrPos].miterLimit!==t&&(this.currentMiterLimit=t,this.stack[this.cArrPos].miterLimit=t)},CVContextData.prototype.transform=function(t){this.transformMat.cloneFromProps(t);var s=this.cTr;this.transformMat.multiply(s),s.cloneFromProps(this.transformMat.props);var u=s.props;this.nativeContext.setTransform(u[0],u[1],u[4],u[5],u[12],u[13])},CVContextData.prototype.opacity=function(t){var s=this.stack[this.cArrPos].opacity;s*=t<0?0:t,this.stack[this.cArrPos].opacity!==s&&(this.currentOpacity!==t&&(this.nativeContext.globalAlpha=t,this.currentOpacity=t),this.stack[this.cArrPos].opacity=s)},CVContextData.prototype.fill=function(t){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(t)},CVContextData.prototype.fillRect=function(t,s,u,d){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(t,s,u,d)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(t,s,u){this.completeLayers=!1,this.layers=t.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(t,s,u),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var t=this.canvasContext;t.beginPath(),t.moveTo(0,0),t.lineTo(this.data.w,0),t.lineTo(this.data.w,this.data.h),t.lineTo(0,this.data.h),t.lineTo(0,0),t.clip();var s,u=this.layers.length;for(s=u-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame()},CVCompElement.prototype.destroy=function(){var t,s=this.layers.length;for(t=s-1;t>=0;t-=1)this.elements[t]&&this.elements[t].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(t){return new CVCompElement(t,this.globalData,this)};function CanvasRenderer(t,s){this.animationItem=t,this.renderConfig={clearCanvas:s&&s.clearCanvas!==void 0?s.clearCanvas:!0,context:s&&s.context||null,progressiveLoad:s&&s.progressiveLoad||!1,preserveAspectRatio:s&&s.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:s&&s.contentVisibility||"visible",className:s&&s.className||"",id:s&&s.id||"",runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.renderConfig.dpr=s&&s.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=s&&s.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(t){return new CVCompElement(t,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var s=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var u=this.finalTransform.mat.toCSS();s.transform=u,s.webkitTransform=u}this.finalTransform._opMdf&&(s.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(t,s,u){this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var t;this.data.hasMask?(t=createNS("rect"),t.setAttribute("width",this.data.sw),t.setAttribute("height",this.data.sh),t.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(t=createTag("div"),t.style.width=this.data.sw+"px",t.style.height=this.data.sh+"px",t.style.backgroundColor=this.data.sc),this.layerElement.appendChild(t)};function HShapeElement(t,s,u){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(t,s,u),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var t;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),t=this.svgElement;else{t=createNS("svg");var s=this.comp.data?this.comp.data:this.globalData.compSize;t.setAttribute("width",s.w),t.setAttribute("height",s.h),t.appendChild(this.shapesContainer),this.layerElement.appendChild(t)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=t},HShapeElement.prototype.getTransformedPoint=function(t,s){var u,d=t.length;for(u=0;u<d;u+=1)s=t[u].mProps.v.applyToPointArray(s[0],s[1],0);return s},HShapeElement.prototype.calculateShapeBoundingBox=function(t,s){var u=t.sh.v,d=t.transformers,_,S=u._length,R,a,k,O;if(!(S<=1)){for(_=0;_<S-1;_+=1)R=this.getTransformedPoint(d,u.v[_]),a=this.getTransformedPoint(d,u.o[_]),k=this.getTransformedPoint(d,u.i[_+1]),O=this.getTransformedPoint(d,u.v[_+1]),this.checkBounds(R,a,k,O,s);u.c&&(R=this.getTransformedPoint(d,u.v[_]),a=this.getTransformedPoint(d,u.o[_]),k=this.getTransformedPoint(d,u.i[0]),O=this.getTransformedPoint(d,u.v[0]),this.checkBounds(R,a,k,O,s))}},HShapeElement.prototype.checkBounds=function(t,s,u,d,_){this.getBoundsOfCurve(t,s,u,d);var S=this.shapeBoundingBox;_.x=bmMin(S.left,_.x),_.xMax=bmMax(S.right,_.xMax),_.y=bmMin(S.top,_.y),_.yMax=bmMax(S.bottom,_.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(t,s,u,d){for(var _=[[t[0],d[0]],[t[1],d[1]]],S,R,a,k,O,j,V,G=0;G<2;++G)R=6*t[G]-12*s[G]+6*u[G],S=-3*t[G]+9*s[G]-9*u[G]+3*d[G],a=3*s[G]-3*t[G],R|=0,S|=0,a|=0,S===0&&R===0||(S===0?(k=-a/R,k>0&&k<1&&_[G].push(this.calculateF(k,t,s,u,d,G))):(O=R*R-4*a*S,O>=0&&(j=(-R+bmSqrt(O))/(2*S),j>0&&j<1&&_[G].push(this.calculateF(j,t,s,u,d,G)),V=(-R-bmSqrt(O))/(2*S),V>0&&V<1&&_[G].push(this.calculateF(V,t,s,u,d,G)))));this.shapeBoundingBox.left=bmMin.apply(null,_[0]),this.shapeBoundingBox.top=bmMin.apply(null,_[1]),this.shapeBoundingBox.right=bmMax.apply(null,_[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,_[1])},HShapeElement.prototype.calculateF=function(t,s,u,d,_,S){return bmPow(1-t,3)*s[S]+3*bmPow(1-t,2)*t*u[S]+3*(1-t)*bmPow(t,2)*d[S]+bmPow(t,3)*_[S]},HShapeElement.prototype.calculateBoundingBox=function(t,s){var u,d=t.length;for(u=0;u<d;u+=1)t[u]&&t[u].sh?this.calculateShapeBoundingBox(t[u],s):t[u]&&t[u].it?this.calculateBoundingBox(t[u].it,s):t[u]&&t[u].style&&t[u].w&&this.expandStrokeBoundingBox(t[u].w,s)},HShapeElement.prototype.expandStrokeBoundingBox=function(t,s){var u=0;if(t.keyframes){for(var d=0;d<t.keyframes.length;d+=1){var _=t.keyframes[d].s;_>u&&(u=_)}u*=t.mult}else u=t.v*t.mult;s.x-=u,s.xMax+=u,s.y-=u,s.yMax+=u},HShapeElement.prototype.currentBoxContains=function(t){return this.currentBBox.x<=t.x&&this.currentBBox.y<=t.y&&this.currentBBox.width+this.currentBBox.x>=t.x+t.width&&this.currentBBox.height+this.currentBBox.y>=t.y+t.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var t=this.tempBoundingBox,s=999999;if(t.x=s,t.xMax=-s,t.y=s,t.yMax=-s,this.calculateBoundingBox(this.itemsData,t),t.width=t.xMax<t.x?0:t.xMax-t.x,t.height=t.yMax<t.y?0:t.yMax-t.y,this.currentBoxContains(t))return;var u=!1;if(this.currentBBox.w!==t.width&&(this.currentBBox.w=t.width,this.shapeCont.setAttribute("width",t.width),u=!0),this.currentBBox.h!==t.height&&(this.currentBBox.h=t.height,this.shapeCont.setAttribute("height",t.height),u=!0),u||this.currentBBox.x!==t.x||this.currentBBox.y!==t.y){this.currentBBox.w=t.width,this.currentBBox.h=t.height,this.currentBBox.x=t.x,this.currentBBox.y=t.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var d=this.shapeCont.style,_="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";d.transform=_,d.webkitTransform=_}}};function HTextElement(t,s,u){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var t=createNS("g");this.maskedElement.appendChild(t),this.innerElem=t}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t.l?t.l.length:0);var s=this.innerElem.style,u=t.fc?this.buildColor(t.fc):"rgba(0,0,0,0)";s.fill=u,s.color=u,t.sc&&(s.stroke=this.buildColor(t.sc),s.strokeWidth=t.sw+"px");var d=this.globalData.fontManager.getFontByName(t.f);if(!this.globalData.fontManager.chars)if(s.fontSize=t.finalSize+"px",s.lineHeight=t.finalSize+"px",d.fClass)this.innerElem.className=d.fClass;else{s.fontFamily=d.fFamily;var _=t.fWeight,S=t.fStyle;s.fontStyle=S,s.fontWeight=_}var R,a,k=t.l;a=k.length;var O,j,V,G=this.mHelper,J,Z="",Y=0;for(R=0;R<a;R+=1){if(this.globalData.fontManager.chars?(this.textPaths[Y]?O=this.textPaths[Y]:(O=createNS("path"),O.setAttribute("stroke-linecap",lineCapEnum[1]),O.setAttribute("stroke-linejoin",lineJoinEnum[2]),O.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[Y]?(j=this.textSpans[Y],V=j.children[0]):(j=createTag("div"),j.style.lineHeight=0,V=createNS("svg"),V.appendChild(O),styleDiv(j)))):this.isMasked?O=this.textPaths[Y]?this.textPaths[Y]:createNS("text"):this.textSpans[Y]?(j=this.textSpans[Y],O=this.textPaths[Y]):(j=createTag("span"),styleDiv(j),O=createTag("span"),styleDiv(O),j.appendChild(O)),this.globalData.fontManager.chars){var le=this.globalData.fontManager.getCharData(t.finalText[R],d.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily),ee;if(le?ee=le.data:ee=null,G.reset(),ee&&ee.shapes&&ee.shapes.length&&(J=ee.shapes[0].it,G.scale(t.finalSize/100,t.finalSize/100),Z=this.createPathShape(G,J),O.setAttribute("d",Z)),this.isMasked)this.innerElem.appendChild(O);else{if(this.innerElem.appendChild(j),ee&&ee.shapes){document.body.appendChild(V);var se=V.getBBox();V.setAttribute("width",se.width+2),V.setAttribute("height",se.height+2),V.setAttribute("viewBox",se.x-1+" "+(se.y-1)+" "+(se.width+2)+" "+(se.height+2));var Q=V.style,oe="translate("+(se.x-1)+"px,"+(se.y-1)+"px)";Q.transform=oe,Q.webkitTransform=oe,k[R].yOffset=se.y-1}else V.setAttribute("width",1),V.setAttribute("height",1);j.appendChild(V)}}else if(O.textContent=k[R].val,O.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(O);else{this.innerElem.appendChild(j);var _e=O.style,Se="translate3d(0,"+-t.finalSize/1.2+"px,0)";_e.transform=Se,_e.webkitTransform=Se}this.isMasked?this.textSpans[Y]=O:this.textSpans[Y]=j,this.textSpans[Y].style.display="block",this.textPaths[Y]=O,Y+=1}for(;Y<this.textSpans.length;)this.textSpans[Y].style.display="none",Y+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var t;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),t=this.svgElement.style;var s="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";t.transform=s,t.webkitTransform=s}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var u,d,_=0,S=this.textAnimator.renderedLetters,R=this.textProperty.currentData.l;d=R.length;var a,k,O;for(u=0;u<d;u+=1)R[u].n?_+=1:(k=this.textSpans[u],O=this.textPaths[u],a=S[_],_+=1,a._mdf.m&&(this.isMasked?k.setAttribute("transform",a.m):(k.style.webkitTransform=a.m,k.style.transform=a.m)),k.style.opacity=a.o,a.sw&&a._mdf.sw&&O.setAttribute("stroke-width",a.sw),a.sc&&a._mdf.sc&&O.setAttribute("stroke",a.sc),a.fc&&a._mdf.fc&&(O.setAttribute("fill",a.fc),O.style.color=a.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var j=this.innerElem.getBBox();this.currentBBox.w!==j.width&&(this.currentBBox.w=j.width,this.svgElement.setAttribute("width",j.width)),this.currentBBox.h!==j.height&&(this.currentBBox.h=j.height,this.svgElement.setAttribute("height",j.height));var V=1;if(this.currentBBox.w!==j.width+V*2||this.currentBBox.h!==j.height+V*2||this.currentBBox.x!==j.x-V||this.currentBBox.y!==j.y-V){this.currentBBox.w=j.width+V*2,this.currentBBox.h=j.height+V*2,this.currentBBox.x=j.x-V,this.currentBBox.y=j.y-V,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),t=this.svgElement.style;var G="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";t.transform=G,t.webkitTransform=G}}}};function HCameraElement(t,s,u){this.initFrame(),this.initBaseData(t,s,u),this.initHierarchy();var d=PropertyFactory.getProp;if(this.pe=d(this,t.pe,0,0,this),t.ks.p.s?(this.px=d(this,t.ks.p.x,1,0,this),this.py=d(this,t.ks.p.y,1,0,this),this.pz=d(this,t.ks.p.z,1,0,this)):this.p=d(this,t.ks.p,1,0,this),t.ks.a&&(this.a=d(this,t.ks.a,1,0,this)),t.ks.or.k.length&&t.ks.or.k[0].to){var _,S=t.ks.or.k.length;for(_=0;_<S;_+=1)t.ks.or.k[_].to=null,t.ks.or.k[_].ti=null}this.or=d(this,t.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=d(this,t.ks.rx,0,degToRads,this),this.ry=d(this,t.ks.ry,0,degToRads,this),this.rz=d(this,t.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var t,s=this.comp.threeDElements.length,u,d,_;for(t=0;t<s;t+=1)if(u=this.comp.threeDElements[t],u.type==="3d"){d=u.perspectiveElem.style,_=u.container.style;var S=this.pe.v+"px",R="0px 0px 0px",a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";d.perspective=S,d.webkitPerspective=S,_.transformOrigin=R,_.mozTransformOrigin=R,_.webkitTransformOrigin=R,d.transform=a,d.webkitTransform=a}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var t=this._isFirstFrame,s,u;if(this.hierarchy)for(u=this.hierarchy.length,s=0;s<u;s+=1)t=this.hierarchy[s].finalTransform.mProp._mdf||t;if(t||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(u=this.hierarchy.length-1,s=u;s>=0;s-=1){var d=this.hierarchy[s].finalTransform.mProp;this.mat.translate(-d.p.v[0],-d.p.v[1],d.p.v[2]),this.mat.rotateX(-d.or.v[0]).rotateY(-d.or.v[1]).rotateZ(d.or.v[2]),this.mat.rotateX(-d.rx.v).rotateY(-d.ry.v).rotateZ(d.rz.v),this.mat.scale(1/d.s.v[0],1/d.s.v[1],1/d.s.v[2]),this.mat.translate(d.a.v[0],d.a.v[1],d.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var _;this.p?_=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:_=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var S=Math.sqrt(Math.pow(_[0],2)+Math.pow(_[1],2)+Math.pow(_[2],2)),R=[_[0]/S,_[1]/S,_[2]/S],a=Math.sqrt(R[2]*R[2]+R[0]*R[0]),k=Math.atan2(R[1],a),O=Math.atan2(R[0],-R[2]);this.mat.rotateY(O).rotateX(-k)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var j=!this._prevMat.equals(this.mat);if((j||this.pe._mdf)&&this.comp.threeDElements){u=this.comp.threeDElements.length;var V,G,J;for(s=0;s<u;s+=1)if(V=this.comp.threeDElements[s],V.type==="3d"){if(j){var Z=this.mat.toCSS();J=V.container.style,J.transform=Z,J.webkitTransform=Z}this.pe._mdf&&(G=V.perspectiveElem.style,G.perspective=this.pe.v+"px",G.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(t){this.prepareProperties(t,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(t,s,u){this.assetData=s.getAssetData(t.refId),this.initElement(t,s,u)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var t=this.globalData.getAssetsPath(this.assetData),s=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",t),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(s),s.crossOrigin="anonymous",s.src=t,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(t,s){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:s&&s.className||"",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(s&&s.hideOnTransparent===!1),filterSize:{width:s&&s.filterSize&&s.filterSize.width||"400%",height:s&&s.filterSize&&s.filterSize.height||"400%",x:s&&s.filterSize&&s.filterSize.x||"-100%",y:s&&s.filterSize&&s.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var t=this.pendingElements.pop();t.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(t,s){var u=t.getBaseElement();if(u){var d=this.layers[s];if(!d.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(u,s);else{for(var _=0,S,R,a;_<s;)this.elements[_]&&this.elements[_]!==!0&&this.elements[_].getBaseElement&&(R=this.elements[_],a=this.layers[_].ddd?this.getThreeDContainerByPos(_):R.getBaseElement(),S=a||S),_+=1;S?(!d.ddd||!this.supports3d)&&this.layerElement.insertBefore(u,S):(!d.ddd||!this.supports3d)&&this.layerElement.appendChild(u)}else this.addTo3dContainer(u,s)}},HybridRendererBase.prototype.createShape=function(t){return this.supports3d?new HShapeElement(t,this.globalData,this):new SVGShapeElement(t,this.globalData,this)},HybridRendererBase.prototype.createText=function(t){return this.supports3d?new HTextElement(t,this.globalData,this):new SVGTextLottieElement(t,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(t){return this.camera=new HCameraElement(t,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(t){return this.supports3d?new HImageElement(t,this.globalData,this):new IImageElement(t,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(t){return this.supports3d?new HSolidElement(t,this.globalData,this):new ISolidElement(t,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(t){for(var s=0,u=this.threeDElements.length;s<u;){if(this.threeDElements[s].startPos<=t&&this.threeDElements[s].endPos>=t)return this.threeDElements[s].perspectiveElem;s+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(t,s){var u=createTag("div"),d,_;styleDiv(u);var S=createTag("div");if(styleDiv(S),s==="3d"){d=u.style,d.width=this.globalData.compSize.w+"px",d.height=this.globalData.compSize.h+"px";var R="50% 50%";d.webkitTransformOrigin=R,d.mozTransformOrigin=R,d.transformOrigin=R,_=S.style;var a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";_.transform=a,_.webkitTransform=a}u.appendChild(S);var k={container:S,perspectiveElem:u,startPos:t,endPos:t,type:s};return this.threeDElements.push(k),k},HybridRendererBase.prototype.build3dContainers=function(){var t,s=this.layers.length,u,d="";for(t=0;t<s;t+=1)this.layers[t].ddd&&this.layers[t].ty!==3?(d!=="3d"&&(d="3d",u=this.createThreeDContainer(t,"3d")),u.endPos=Math.max(u.endPos,t)):(d!=="2d"&&(d="2d",u=this.createThreeDContainer(t,"2d")),u.endPos=Math.max(u.endPos,t));for(s=this.threeDElements.length,t=s-1;t>=0;t-=1)this.resizerElem.appendChild(this.threeDElements[t].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(t,s){for(var u=0,d=this.threeDElements.length;u<d;){if(s<=this.threeDElements[u].endPos){for(var _=this.threeDElements[u].startPos,S;_<s;)this.elements[_]&&this.elements[_].getBaseElement&&(S=this.elements[_].getBaseElement()),_+=1;S?this.threeDElements[u].container.insertBefore(t,S):this.threeDElements[u].container.appendChild(t);break}u+=1}},HybridRendererBase.prototype.configAnimation=function(t){var s=createTag("div"),u=this.animationItem.wrapper,d=s.style;d.width=t.w+"px",d.height=t.h+"px",this.resizerElem=s,styleDiv(s),d.transformStyle="flat",d.mozTransformStyle="flat",d.webkitTransformStyle="flat",this.renderConfig.className&&s.setAttribute("class",this.renderConfig.className),u.appendChild(s),d.overflow="hidden";var _=createNS("svg");_.setAttribute("width","1"),_.setAttribute("height","1"),styleDiv(_),this.resizerElem.appendChild(_);var S=createNS("defs");_.appendChild(S),this.data=t,this.setupGlobalData(t,_),this.globalData.defs=S,this.layers=t.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var t,s=this.layers?this.layers.length:0;for(t=0;t<s;t+=1)this.elements[t]&&this.elements[t].destroy&&this.elements[t].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var t=this.animationItem.wrapper.offsetWidth,s=this.animationItem.wrapper.offsetHeight,u=t/s,d=this.globalData.compSize.w/this.globalData.compSize.h,_,S,R,a;d>u?(_=t/this.globalData.compSize.w,S=t/this.globalData.compSize.w,R=0,a=(s-this.globalData.compSize.h*(t/this.globalData.compSize.w))/2):(_=s/this.globalData.compSize.h,S=s/this.globalData.compSize.h,R=(t-this.globalData.compSize.w*(s/this.globalData.compSize.h))/2,a=0);var k=this.resizerElem.style;k.webkitTransform="matrix3d("+_+",0,0,0,0,"+S+",0,0,0,0,1,0,"+R+","+a+",0,1)",k.transform=k.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var t=this.globalData.compSize.w,s=this.globalData.compSize.h,u,d=this.threeDElements.length;for(u=0;u<d;u+=1){var _=this.threeDElements[u].perspectiveElem.style;_.webkitPerspective=Math.sqrt(Math.pow(t,2)+Math.pow(s,2))+"px",_.perspective=_.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(t){var s,u=t.length,d=createTag("div");for(s=0;s<u;s+=1)if(t[s].xt){var _=this.createComp(t[s],d,this.globalData.comp,null);_.initExpressions(),this.globalData.projectInterface.registerComposition(_)}};function HCompElement(t,s,u){this.layers=t.layers,this.supports3d=!t.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(t,s,u),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(t,s){for(var u=0,d;u<s;)this.elements[u]&&this.elements[u].getBaseElement&&(d=this.elements[u].getBaseElement()),u+=1;d?this.layerElement.insertBefore(t,d):this.layerElement.appendChild(t)},HCompElement.prototype.createComp=function(t){return this.supports3d?new HCompElement(t,this.globalData,this):new SVGCompElement(t,this.globalData,this)};function HybridRenderer(t,s){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:s&&s.className||"",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(s&&s.hideOnTransparent===!1),filterSize:{width:s&&s.filterSize&&s.filterSize.width||"400%",height:s&&s.filterSize&&s.filterSize.height||"400%",x:s&&s.filterSize&&s.filterSize.x||"-100%",y:s&&s.filterSize&&s.filterSize.y||"-100%"},runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(t){return this.supports3d?new HCompElement(t,this.globalData,this):new SVGCompElement(t,this.globalData,this)};var CompExpressionInterface=(function(){return function(t){function s(u){for(var d=0,_=t.layers.length;d<_;){if(t.layers[d].nm===u||t.layers[d].ind===u)return t.elements[d].layerInterface;d+=1}return null}return Object.defineProperty(s,"_name",{value:t.data.nm}),s.layer=s,s.pixelAspect=1,s.height=t.data.h||t.globalData.compSize.h,s.width=t.data.w||t.globalData.compSize.w,s.pixelAspect=1,s.frameDuration=1/t.globalData.frameRate,s.displayStartTime=0,s.numLayers=t.layers.length,s}})();function _typeof$2(t){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$2(t)}function seedRandom(t,s){var u=this,d=256,_=6,S=52,R="random",a=s.pow(d,_),k=s.pow(2,S),O=k*2,j=d-1,V;function G(Q,oe,_e){var Se=[];oe=oe===!0?{entropy:!0}:oe||{};var ke=le(Y(oe.entropy?[Q,se(t)]:Q===null?ee():Q,3),Se),Le=new J(Se),lt=function(){for(var Yt=Le.g(_),Ot=a,Bt=0;Yt<k;)Yt=(Yt+Bt)*d,Ot*=d,Bt=Le.g(1);for(;Yt>=O;)Yt/=2,Ot/=2,Bt>>>=1;return(Yt+Bt)/Ot};return lt.int32=function(){return Le.g(4)|0},lt.quick=function(){return Le.g(4)/4294967296},lt.double=lt,le(se(Le.S),t),(oe.pass||_e||function(qt,Yt,Ot,Bt){return Bt&&(Bt.S&&Z(Bt,Le),qt.state=function(){return Z(Le,{})}),Ot?(s[R]=qt,Yt):qt})(lt,ke,"global"in oe?oe.global:this==s,oe.state)}s["seed"+R]=G;function J(Q){var oe,_e=Q.length,Se=this,ke=0,Le=Se.i=Se.j=0,lt=Se.S=[];for(_e||(Q=[_e++]);ke<d;)lt[ke]=ke++;for(ke=0;ke<d;ke++)lt[ke]=lt[Le=j&Le+Q[ke%_e]+(oe=lt[ke])],lt[Le]=oe;Se.g=function(qt){for(var Yt,Ot=0,Bt=Se.i,si=Se.j,kt=Se.S;qt--;)Yt=kt[Bt=j&Bt+1],Ot=Ot*d+kt[j&(kt[Bt]=kt[si=j&si+Yt])+(kt[si]=Yt)];return Se.i=Bt,Se.j=si,Ot}}function Z(Q,oe){return oe.i=Q.i,oe.j=Q.j,oe.S=Q.S.slice(),oe}function Y(Q,oe){var _e=[],Se=_typeof$2(Q),ke;if(oe&&Se=="object")for(ke in Q)try{_e.push(Y(Q[ke],oe-1))}catch{}return _e.length?_e:Se=="string"?Q:Q+"\0"}function le(Q,oe){for(var _e=Q+"",Se,ke=0;ke<_e.length;)oe[j&ke]=j&(Se^=oe[j&ke]*19)+_e.charCodeAt(ke++);return se(oe)}function ee(){try{var Q=new Uint8Array(d);return(u.crypto||u.msCrypto).getRandomValues(Q),se(Q)}catch{var oe=u.navigator,_e=oe&&oe.plugins;return[+new Date,u,_e,u.screen,se(t)]}}function se(Q){return String.fromCharCode.apply(0,Q)}le(s.random(),t)}function initialize$2(t){seedRandom([],t)}var propTypes={SHAPE:"shape"};function _typeof$1(t){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$1(t)}var ExpressionManager=(function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(t){return t.constructor===Array||t.constructor===Float32Array}function isNumerable(t,s){return t==="number"||s instanceof Number||t==="boolean"||t==="string"}function $bm_neg(t){var s=_typeof$1(t);if(s==="number"||t instanceof Number||s==="boolean")return-t;if($bm_isInstanceOfArray(t)){var u,d=t.length,_=[];for(u=0;u<d;u+=1)_[u]=-t[u];return _}return t.propType?t.v:-t}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(t,s){var u=_typeof$1(t),d=_typeof$1(s);if(isNumerable(u,t)&&isNumerable(d,s)||u==="string"||d==="string")return t+s;if($bm_isInstanceOfArray(t)&&isNumerable(d,s))return t=t.slice(0),t[0]+=s,t;if(isNumerable(u,t)&&$bm_isInstanceOfArray(s))return s=s.slice(0),s[0]=t+s[0],s;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(s)){for(var _=0,S=t.length,R=s.length,a=[];_<S||_<R;)(typeof t[_]=="number"||t[_]instanceof Number)&&(typeof s[_]=="number"||s[_]instanceof Number)?a[_]=t[_]+s[_]:a[_]=s[_]===void 0?t[_]:t[_]||s[_],_+=1;return a}return 0}var add=sum;function sub(t,s){var u=_typeof$1(t),d=_typeof$1(s);if(isNumerable(u,t)&&isNumerable(d,s))return u==="string"&&(t=parseInt(t,10)),d==="string"&&(s=parseInt(s,10)),t-s;if($bm_isInstanceOfArray(t)&&isNumerable(d,s))return t=t.slice(0),t[0]-=s,t;if(isNumerable(u,t)&&$bm_isInstanceOfArray(s))return s=s.slice(0),s[0]=t-s[0],s;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(s)){for(var _=0,S=t.length,R=s.length,a=[];_<S||_<R;)(typeof t[_]=="number"||t[_]instanceof Number)&&(typeof s[_]=="number"||s[_]instanceof Number)?a[_]=t[_]-s[_]:a[_]=s[_]===void 0?t[_]:t[_]||s[_],_+=1;return a}return 0}function mul(t,s){var u=_typeof$1(t),d=_typeof$1(s),_;if(isNumerable(u,t)&&isNumerable(d,s))return t*s;var S,R;if($bm_isInstanceOfArray(t)&&isNumerable(d,s)){for(R=t.length,_=createTypedArray("float32",R),S=0;S<R;S+=1)_[S]=t[S]*s;return _}if(isNumerable(u,t)&&$bm_isInstanceOfArray(s)){for(R=s.length,_=createTypedArray("float32",R),S=0;S<R;S+=1)_[S]=t*s[S];return _}return 0}function div(t,s){var u=_typeof$1(t),d=_typeof$1(s),_;if(isNumerable(u,t)&&isNumerable(d,s))return t/s;var S,R;if($bm_isInstanceOfArray(t)&&isNumerable(d,s)){for(R=t.length,_=createTypedArray("float32",R),S=0;S<R;S+=1)_[S]=t[S]/s;return _}if(isNumerable(u,t)&&$bm_isInstanceOfArray(s)){for(R=s.length,_=createTypedArray("float32",R),S=0;S<R;S+=1)_[S]=t/s[S];return _}return 0}function mod(t,s){return typeof t=="string"&&(t=parseInt(t,10)),typeof s=="string"&&(s=parseInt(s,10)),t%s}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(t,s,u){if(s>u){var d=u;u=s,s=d}return Math.min(Math.max(t,s),u)}function radiansToDegrees(t){return t/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(t){return t*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(t,s){if(typeof t=="number"||t instanceof Number)return s=s||0,Math.abs(t-s);s||(s=helperLengthArray);var u,d=Math.min(t.length,s.length),_=0;for(u=0;u<d;u+=1)_+=Math.pow(s[u]-t[u],2);return Math.sqrt(_)}function normalize(t){return div(t,length(t))}function rgbToHsl(t){var s=t[0],u=t[1],d=t[2],_=Math.max(s,u,d),S=Math.min(s,u,d),R,a,k=(_+S)/2;if(_===S)R=0,a=0;else{var O=_-S;switch(a=k>.5?O/(2-_-S):O/(_+S),_){case s:R=(u-d)/O+(u<d?6:0);break;case u:R=(d-s)/O+2;break;case d:R=(s-u)/O+4;break}R/=6}return[R,a,k,t[3]]}function hue2rgb(t,s,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?t+(s-t)*6*u:u<1/2?s:u<2/3?t+(s-t)*(2/3-u)*6:t}function hslToRgb(t){var s=t[0],u=t[1],d=t[2],_,S,R;if(u===0)_=d,R=d,S=d;else{var a=d<.5?d*(1+u):d+u-d*u,k=2*d-a;_=hue2rgb(k,a,s+1/3),S=hue2rgb(k,a,s),R=hue2rgb(k,a,s-1/3)}return[_,S,R,t[3]]}function linear(t,s,u,d,_){if((d===void 0||_===void 0)&&(d=s,_=u,s=0,u=1),u<s){var S=u;u=s,s=S}if(t<=s)return d;if(t>=u)return _;var R=u===s?0:(t-s)/(u-s);if(!d.length)return d+(_-d)*R;var a,k=d.length,O=createTypedArray("float32",k);for(a=0;a<k;a+=1)O[a]=d[a]+(_[a]-d[a])*R;return O}function random(t,s){if(s===void 0&&(t===void 0?(t=0,s=1):(s=t,t=void 0)),s.length){var u,d=s.length;t||(t=createTypedArray("float32",d));var _=createTypedArray("float32",d),S=BMMath.random();for(u=0;u<d;u+=1)_[u]=t[u]+S*(s[u]-t[u]);return _}t===void 0&&(t=0);var R=BMMath.random();return t+R*(s-t)}function createPath(t,s,u,d){var _,S=t.length,R=shapePool.newElement();R.setPathData(!!d,S);var a=[0,0],k,O;for(_=0;_<S;_+=1)k=s&&s[_]?s[_]:a,O=u&&u[_]?u[_]:a,R.setTripleAt(t[_][0],t[_][1],O[0]+t[_][0],O[1]+t[_][1],k[0]+t[_][0],k[1]+t[_][1],_,!0);return R}function initiateExpression(elem,data,property){function noOp(t){return t}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function t(s,u){var d,_,S=this.pv.length?this.pv.length:1,R=createTypedArray("float32",S);s=5;var a=Math.floor(time*s);for(d=0,_=0;d<a;){for(_=0;_<S;_+=1)R[_]+=-u+u*2*BMMath.random();d+=1}var k=time*s,O=k-Math.floor(k),j=createTypedArray("float32",S);if(S>1){for(_=0;_<S;_+=1)j[_]=this.pv[_]+R[_]+(-u+u*2*BMMath.random())*O;return j}return this.pv+R[0]+(-u+u*2*BMMath.random())*O}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(t,s){return loopIn(t,s,!0)}function loopOutDuration(t,s){return loopOut(t,s,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(t,s){var u=[s[0]-t[0],s[1]-t[1],s[2]-t[2]],d=Math.atan2(u[0],Math.sqrt(u[1]*u[1]+u[2]*u[2]))/degToRads,_=-Math.atan2(u[1],u[2])/degToRads;return[_,d,0]}function easeOut(t,s,u,d,_){return applyEase(easeOutBez,t,s,u,d,_)}function easeIn(t,s,u,d,_){return applyEase(easeInBez,t,s,u,d,_)}function ease(t,s,u,d,_){return applyEase(easeInOutBez,t,s,u,d,_)}function applyEase(t,s,u,d,_,S){_===void 0?(_=u,S=d):s=(s-u)/(d-u),s>1?s=1:s<0&&(s=0);var R=t(s);if($bm_isInstanceOfArray(_)){var a,k=_.length,O=createTypedArray("float32",k);for(a=0;a<k;a+=1)O[a]=(S[a]-_[a])*R+_[a];return O}return(S-_)*R+_}function nearestKey(t){var s,u=data.k.length,d,_;if(!data.k.length||typeof data.k[0]=="number")d=0,_=0;else if(d=-1,t*=elem.comp.globalData.frameRate,t<data.k[0].t)d=1,_=data.k[0].t;else{for(s=0;s<u-1;s+=1)if(t===data.k[s].t){d=s+1,_=data.k[s].t;break}else if(t>data.k[s].t&&t<data.k[s+1].t){t-data.k[s].t>data.k[s+1].t-t?(d=s+2,_=data.k[s+1].t):(d=s+1,_=data.k[s].t);break}d===-1&&(d=s+1,_=data.k[s].t)}var S={};return S.index=d,S.time=_/elem.comp.globalData.frameRate,S}function key(t){var s,u,d;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+t);t-=1,s={time:data.k[t].t/elem.comp.globalData.frameRate,value:[]};var _=Object.prototype.hasOwnProperty.call(data.k[t],"s")?data.k[t].s:data.k[t-1].e;for(d=_.length,u=0;u<d;u+=1)s[u]=_[u],s.value[u]=_[u];return s}function framesToTime(t,s){return s||(s=elem.comp.globalData.frameRate),t/s}function timeToFrames(t,s){return!t&&t!==0&&(t=time),s||(s=elem.comp.globalData.frameRate),t*s}function seedRandom(t){BMMath.seedrandom(randSeed+t)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(t,s){return typeof value=="string"?s===void 0?value.substring(t):value.substring(t,s):""}function substr(t,s){return typeof value=="string"?s===void 0?value.substr(t):value.substr(t,s):""}function posterizeTime(t){time=t===0?0:Math.floor(time*t)/t,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(t){return value=t,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob})(),Expressions=(function(){var t={};t.initExpressions=s,t.resetFrame=ExpressionManager.resetFrame;function s(u){var d=0,_=[];function S(){d+=1}function R(){d-=1,d===0&&k()}function a(O){_.indexOf(O)===-1&&_.push(O)}function k(){var O,j=_.length;for(O=0;O<j;O+=1)_[O].release();_.length=0}u.renderer.compInterface=CompExpressionInterface(u.renderer),u.renderer.globalData.projectInterface.registerComposition(u.renderer),u.renderer.globalData.pushExpression=S,u.renderer.globalData.popExpression=R,u.renderer.globalData.registerExpressionProperty=a}return t})(),MaskManagerInterface=(function(){function t(u,d){this._mask=u,this._data=d}Object.defineProperty(t.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(t.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var s=function(d){var _=createSizedArray(d.viewData.length),S,R=d.viewData.length;for(S=0;S<R;S+=1)_[S]=new t(d.viewData[S],d.masksProperties[S]);var a=function(O){for(S=0;S<R;){if(d.masksProperties[S].nm===O)return _[S];S+=1}return null};return a};return s})(),ExpressionPropertyInterface=(function(){var t={pv:0,v:0,mult:1},s={pv:[0,0,0],v:[0,0,0],mult:1};function u(R,a,k){Object.defineProperty(R,"velocity",{get:function(){return a.getVelocityAtTime(a.comp.currentFrame)}}),R.numKeys=a.keyframes?a.keyframes.length:0,R.key=function(O){if(!R.numKeys)return 0;var j="";"s"in a.keyframes[O-1]?j=a.keyframes[O-1].s:"e"in a.keyframes[O-2]?j=a.keyframes[O-2].e:j=a.keyframes[O-2].s;var V=k==="unidimensional"?new Number(j):Object.assign({},j);return V.time=a.keyframes[O-1].t/a.elem.comp.globalData.frameRate,V.value=k==="unidimensional"?j[0]:j,V},R.valueAtTime=a.getValueAtTime,R.speedAtTime=a.getSpeedAtTime,R.velocityAtTime=a.getVelocityAtTime,R.propertyGroup=a.propertyGroup}function d(R){(!R||!("pv"in R))&&(R=t);var a=1/R.mult,k=R.pv*a,O=new Number(k);return O.value=k,u(O,R,"unidimensional"),function(){return R.k&&R.getValue(),k=R.v*a,O.value!==k&&(O=new Number(k),O.value=k,O[0]=k,u(O,R,"unidimensional")),O}}function _(R){(!R||!("pv"in R))&&(R=s);var a=1/R.mult,k=R.data&&R.data.l||R.pv.length,O=createTypedArray("float32",k),j=createTypedArray("float32",k);return O.value=j,u(O,R,"multidimensional"),function(){R.k&&R.getValue();for(var V=0;V<k;V+=1)j[V]=R.v[V]*a,O[V]=j[V];return O}}function S(){return t}return function(R){return R?R.propType==="unidimensional"?d(R):_(R):S}})(),TransformExpressionInterface=(function(){return function(t){function s(R){switch(R){case"scale":case"Scale":case"ADBE Scale":case 6:return s.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return s.rotation;case"ADBE Rotate X":return s.xRotation;case"ADBE Rotate Y":return s.yRotation;case"position":case"Position":case"ADBE Position":case 2:return s.position;case"ADBE Position_0":return s.xPosition;case"ADBE Position_1":return s.yPosition;case"ADBE Position_2":return s.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return s.anchorPoint;case"opacity":case"Opacity":case 11:return s.opacity;default:return null}}Object.defineProperty(s,"rotation",{get:ExpressionPropertyInterface(t.r||t.rz)}),Object.defineProperty(s,"zRotation",{get:ExpressionPropertyInterface(t.rz||t.r)}),Object.defineProperty(s,"xRotation",{get:ExpressionPropertyInterface(t.rx)}),Object.defineProperty(s,"yRotation",{get:ExpressionPropertyInterface(t.ry)}),Object.defineProperty(s,"scale",{get:ExpressionPropertyInterface(t.s)});var u,d,_,S;return t.p?S=ExpressionPropertyInterface(t.p):(u=ExpressionPropertyInterface(t.px),d=ExpressionPropertyInterface(t.py),t.pz&&(_=ExpressionPropertyInterface(t.pz))),Object.defineProperty(s,"position",{get:function(){return t.p?S():[u(),d(),_?_():0]}}),Object.defineProperty(s,"xPosition",{get:ExpressionPropertyInterface(t.px)}),Object.defineProperty(s,"yPosition",{get:ExpressionPropertyInterface(t.py)}),Object.defineProperty(s,"zPosition",{get:ExpressionPropertyInterface(t.pz)}),Object.defineProperty(s,"anchorPoint",{get:ExpressionPropertyInterface(t.a)}),Object.defineProperty(s,"opacity",{get:ExpressionPropertyInterface(t.o)}),Object.defineProperty(s,"skew",{get:ExpressionPropertyInterface(t.sk)}),Object.defineProperty(s,"skewAxis",{get:ExpressionPropertyInterface(t.sa)}),Object.defineProperty(s,"orientation",{get:ExpressionPropertyInterface(t.or)}),s}})(),LayerExpressionInterface=(function(){function t(O){var j=new Matrix;if(O!==void 0){var V=this._elem.finalTransform.mProp.getValueAtTime(O);V.clone(j)}else{var G=this._elem.finalTransform.mProp;G.applyToMatrix(j)}return j}function s(O,j){var V=this.getMatrix(j);return V.props[12]=0,V.props[13]=0,V.props[14]=0,this.applyPoint(V,O)}function u(O,j){var V=this.getMatrix(j);return this.applyPoint(V,O)}function d(O,j){var V=this.getMatrix(j);return V.props[12]=0,V.props[13]=0,V.props[14]=0,this.invertPoint(V,O)}function _(O,j){var V=this.getMatrix(j);return this.invertPoint(V,O)}function S(O,j){if(this._elem.hierarchy&&this._elem.hierarchy.length){var V,G=this._elem.hierarchy.length;for(V=0;V<G;V+=1)this._elem.hierarchy[V].finalTransform.mProp.applyToMatrix(O)}return O.applyToPointArray(j[0],j[1],j[2]||0)}function R(O,j){if(this._elem.hierarchy&&this._elem.hierarchy.length){var V,G=this._elem.hierarchy.length;for(V=0;V<G;V+=1)this._elem.hierarchy[V].finalTransform.mProp.applyToMatrix(O)}return O.inversePoint(j)}function a(O){var j=new Matrix;if(j.reset(),this._elem.finalTransform.mProp.applyToMatrix(j),this._elem.hierarchy&&this._elem.hierarchy.length){var V,G=this._elem.hierarchy.length;for(V=0;V<G;V+=1)this._elem.hierarchy[V].finalTransform.mProp.applyToMatrix(j);return j.inversePoint(O)}return j.inversePoint(O)}function k(){return[1,1,1,1]}return function(O){var j;function V(Y){J.mask=new MaskManagerInterface(Y,O)}function G(Y){J.effect=Y}function J(Y){switch(Y){case"ADBE Root Vectors Group":case"Contents":case 2:return J.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return j;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return J.effect;case"ADBE Text Properties":return J.textInterface;default:return null}}J.getMatrix=t,J.invertPoint=R,J.applyPoint=S,J.toWorld=u,J.toWorldVec=s,J.fromWorld=_,J.fromWorldVec=d,J.toComp=u,J.fromComp=a,J.sampleImage=k,J.sourceRectAtTime=O.sourceRectAtTime.bind(O),J._elem=O,j=TransformExpressionInterface(O.finalTransform.mProp);var Z=getDescriptor(j,"anchorPoint");return Object.defineProperties(J,{hasParent:{get:function(){return O.hierarchy.length}},parent:{get:function(){return O.hierarchy[0].layerInterface}},rotation:getDescriptor(j,"rotation"),scale:getDescriptor(j,"scale"),position:getDescriptor(j,"position"),opacity:getDescriptor(j,"opacity"),anchorPoint:Z,anchor_point:Z,transform:{get:function(){return j}},active:{get:function(){return O.isInRange}}}),J.startTime=O.data.st,J.index=O.data.ind,J.source=O.data.refId,J.height=O.data.ty===0?O.data.h:100,J.width=O.data.ty===0?O.data.w:100,J.inPoint=O.data.ip/O.comp.globalData.frameRate,J.outPoint=O.data.op/O.comp.globalData.frameRate,J._name=O.data.nm,J.registerMaskInterface=V,J.registerEffectsInterface=G,J}})(),propertyGroupFactory=(function(){return function(t,s){return function(u){return u=u===void 0?1:u,u<=0?t:s(u-1)}}})(),PropertyInterface=(function(){return function(t,s){var u={_name:t};function d(_){return _=_===void 0?1:_,_<=0?u:s(_-1)}return d}})(),EffectsExpressionInterface=(function(){var t={createEffectsInterface:s};function s(_,S){if(_.effectsManager){var R=[],a=_.data.ef,k,O=_.effectsManager.effectElements.length;for(k=0;k<O;k+=1)R.push(u(a[k],_.effectsManager.effectElements[k],S,_));var j=_.data.ef||[],V=function(J){for(k=0,O=j.length;k<O;){if(J===j[k].nm||J===j[k].mn||J===j[k].ix)return R[k];k+=1}return null};return Object.defineProperty(V,"numProperties",{get:function(){return j.length}}),V}return null}function u(_,S,R,a){function k(J){for(var Z=_.ef,Y=0,le=Z.length;Y<le;){if(J===Z[Y].nm||J===Z[Y].mn||J===Z[Y].ix)return Z[Y].ty===5?j[Y]:j[Y]();Y+=1}throw new Error}var O=propertyGroupFactory(k,R),j=[],V,G=_.ef.length;for(V=0;V<G;V+=1)_.ef[V].ty===5?j.push(u(_.ef[V],S.effectElements[V],S.effectElements[V].propertyGroup,a)):j.push(d(S.effectElements[V],_.ef[V].ty,a,O));return _.mn==="ADBE Color Control"&&Object.defineProperty(k,"color",{get:function(){return j[0]()}}),Object.defineProperties(k,{numProperties:{get:function(){return _.np}},_name:{value:_.nm},propertyGroup:{value:O}}),k.enabled=_.en!==0,k.active=k.enabled,k}function d(_,S,R,a){var k=ExpressionPropertyInterface(_.p);function O(){return S===10?R.comp.compInterface(_.p.v):k()}return _.p.setGroupProperty&&_.p.setGroupProperty(PropertyInterface("",a)),O}return t})(),ShapePathInterface=(function(){return function(s,u,d){var _=u.sh;function S(a){return a==="Shape"||a==="shape"||a==="Path"||a==="path"||a==="ADBE Vector Shape"||a===2?S.path:null}var R=propertyGroupFactory(S,d);return _.setGroupProperty(PropertyInterface("Path",R)),Object.defineProperties(S,{path:{get:function(){return _.k&&_.getValue(),_}},shape:{get:function(){return _.k&&_.getValue(),_}},_name:{value:s.nm},ix:{value:s.ix},propertyIndex:{value:s.ix},mn:{value:s.mn},propertyGroup:{value:d}}),S}})(),ShapeExpressionInterface=(function(){function t(Z,Y,le){var ee=[],se,Q=Z?Z.length:0;for(se=0;se<Q;se+=1)Z[se].ty==="gr"?ee.push(u(Z[se],Y[se],le)):Z[se].ty==="fl"?ee.push(d(Z[se],Y[se],le)):Z[se].ty==="st"?ee.push(R(Z[se],Y[se],le)):Z[se].ty==="tm"?ee.push(a(Z[se],Y[se],le)):Z[se].ty==="tr"||(Z[se].ty==="el"?ee.push(O(Z[se],Y[se],le)):Z[se].ty==="sr"?ee.push(j(Z[se],Y[se],le)):Z[se].ty==="sh"?ee.push(ShapePathInterface(Z[se],Y[se],le)):Z[se].ty==="rc"?ee.push(V(Z[se],Y[se],le)):Z[se].ty==="rd"?ee.push(G(Z[se],Y[se],le)):Z[se].ty==="rp"?ee.push(J(Z[se],Y[se],le)):Z[se].ty==="gf"?ee.push(_(Z[se],Y[se],le)):ee.push(S(Z[se],Y[se])));return ee}function s(Z,Y,le){var ee,se=function(_e){for(var Se=0,ke=ee.length;Se<ke;){if(ee[Se]._name===_e||ee[Se].mn===_e||ee[Se].propertyIndex===_e||ee[Se].ix===_e||ee[Se].ind===_e)return ee[Se];Se+=1}return typeof _e=="number"?ee[_e-1]:null};se.propertyGroup=propertyGroupFactory(se,le),ee=t(Z.it,Y.it,se.propertyGroup),se.numProperties=ee.length;var Q=k(Z.it[Z.it.length-1],Y.it[Y.it.length-1],se.propertyGroup);return se.transform=Q,se.propertyIndex=Z.cix,se._name=Z.nm,se}function u(Z,Y,le){var ee=function(_e){switch(_e){case"ADBE Vectors Group":case"Contents":case 2:return ee.content;default:return ee.transform}};ee.propertyGroup=propertyGroupFactory(ee,le);var se=s(Z,Y,ee.propertyGroup),Q=k(Z.it[Z.it.length-1],Y.it[Y.it.length-1],ee.propertyGroup);return ee.content=se,ee.transform=Q,Object.defineProperty(ee,"_name",{get:function(){return Z.nm}}),ee.numProperties=Z.np,ee.propertyIndex=Z.ix,ee.nm=Z.nm,ee.mn=Z.mn,ee}function d(Z,Y,le){function ee(se){return se==="Color"||se==="color"?ee.color:se==="Opacity"||se==="opacity"?ee.opacity:null}return Object.defineProperties(ee,{color:{get:ExpressionPropertyInterface(Y.c)},opacity:{get:ExpressionPropertyInterface(Y.o)},_name:{value:Z.nm},mn:{value:Z.mn}}),Y.c.setGroupProperty(PropertyInterface("Color",le)),Y.o.setGroupProperty(PropertyInterface("Opacity",le)),ee}function _(Z,Y,le){function ee(se){return se==="Start Point"||se==="start point"?ee.startPoint:se==="End Point"||se==="end point"?ee.endPoint:se==="Opacity"||se==="opacity"?ee.opacity:null}return Object.defineProperties(ee,{startPoint:{get:ExpressionPropertyInterface(Y.s)},endPoint:{get:ExpressionPropertyInterface(Y.e)},opacity:{get:ExpressionPropertyInterface(Y.o)},type:{get:function(){return"a"}},_name:{value:Z.nm},mn:{value:Z.mn}}),Y.s.setGroupProperty(PropertyInterface("Start Point",le)),Y.e.setGroupProperty(PropertyInterface("End Point",le)),Y.o.setGroupProperty(PropertyInterface("Opacity",le)),ee}function S(){function Z(){return null}return Z}function R(Z,Y,le){var ee=propertyGroupFactory(ke,le),se=propertyGroupFactory(Se,ee);function Q(Le){Object.defineProperty(Se,Z.d[Le].nm,{get:ExpressionPropertyInterface(Y.d.dataProps[Le].p)})}var oe,_e=Z.d?Z.d.length:0,Se={};for(oe=0;oe<_e;oe+=1)Q(oe),Y.d.dataProps[oe].p.setGroupProperty(se);function ke(Le){return Le==="Color"||Le==="color"?ke.color:Le==="Opacity"||Le==="opacity"?ke.opacity:Le==="Stroke Width"||Le==="stroke width"?ke.strokeWidth:null}return Object.defineProperties(ke,{color:{get:ExpressionPropertyInterface(Y.c)},opacity:{get:ExpressionPropertyInterface(Y.o)},strokeWidth:{get:ExpressionPropertyInterface(Y.w)},dash:{get:function(){return Se}},_name:{value:Z.nm},mn:{value:Z.mn}}),Y.c.setGroupProperty(PropertyInterface("Color",ee)),Y.o.setGroupProperty(PropertyInterface("Opacity",ee)),Y.w.setGroupProperty(PropertyInterface("Stroke Width",ee)),ke}function a(Z,Y,le){function ee(Q){return Q===Z.e.ix||Q==="End"||Q==="end"?ee.end:Q===Z.s.ix?ee.start:Q===Z.o.ix?ee.offset:null}var se=propertyGroupFactory(ee,le);return ee.propertyIndex=Z.ix,Y.s.setGroupProperty(PropertyInterface("Start",se)),Y.e.setGroupProperty(PropertyInterface("End",se)),Y.o.setGroupProperty(PropertyInterface("Offset",se)),ee.propertyIndex=Z.ix,ee.propertyGroup=le,Object.defineProperties(ee,{start:{get:ExpressionPropertyInterface(Y.s)},end:{get:ExpressionPropertyInterface(Y.e)},offset:{get:ExpressionPropertyInterface(Y.o)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}function k(Z,Y,le){function ee(Q){return Z.a.ix===Q||Q==="Anchor Point"?ee.anchorPoint:Z.o.ix===Q||Q==="Opacity"?ee.opacity:Z.p.ix===Q||Q==="Position"?ee.position:Z.r.ix===Q||Q==="Rotation"||Q==="ADBE Vector Rotation"?ee.rotation:Z.s.ix===Q||Q==="Scale"?ee.scale:Z.sk&&Z.sk.ix===Q||Q==="Skew"?ee.skew:Z.sa&&Z.sa.ix===Q||Q==="Skew Axis"?ee.skewAxis:null}var se=propertyGroupFactory(ee,le);return Y.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",se)),Y.transform.mProps.p.setGroupProperty(PropertyInterface("Position",se)),Y.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",se)),Y.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",se)),Y.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",se)),Y.transform.mProps.sk&&(Y.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",se)),Y.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",se))),Y.transform.op.setGroupProperty(PropertyInterface("Opacity",se)),Object.defineProperties(ee,{opacity:{get:ExpressionPropertyInterface(Y.transform.mProps.o)},position:{get:ExpressionPropertyInterface(Y.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(Y.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(Y.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(Y.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(Y.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(Y.transform.mProps.sa)},_name:{value:Z.nm}}),ee.ty="tr",ee.mn=Z.mn,ee.propertyGroup=le,ee}function O(Z,Y,le){function ee(oe){return Z.p.ix===oe?ee.position:Z.s.ix===oe?ee.size:null}var se=propertyGroupFactory(ee,le);ee.propertyIndex=Z.ix;var Q=Y.sh.ty==="tm"?Y.sh.prop:Y.sh;return Q.s.setGroupProperty(PropertyInterface("Size",se)),Q.p.setGroupProperty(PropertyInterface("Position",se)),Object.defineProperties(ee,{size:{get:ExpressionPropertyInterface(Q.s)},position:{get:ExpressionPropertyInterface(Q.p)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}function j(Z,Y,le){function ee(oe){return Z.p.ix===oe?ee.position:Z.r.ix===oe?ee.rotation:Z.pt.ix===oe?ee.points:Z.or.ix===oe||oe==="ADBE Vector Star Outer Radius"?ee.outerRadius:Z.os.ix===oe?ee.outerRoundness:Z.ir&&(Z.ir.ix===oe||oe==="ADBE Vector Star Inner Radius")?ee.innerRadius:Z.is&&Z.is.ix===oe?ee.innerRoundness:null}var se=propertyGroupFactory(ee,le),Q=Y.sh.ty==="tm"?Y.sh.prop:Y.sh;return ee.propertyIndex=Z.ix,Q.or.setGroupProperty(PropertyInterface("Outer Radius",se)),Q.os.setGroupProperty(PropertyInterface("Outer Roundness",se)),Q.pt.setGroupProperty(PropertyInterface("Points",se)),Q.p.setGroupProperty(PropertyInterface("Position",se)),Q.r.setGroupProperty(PropertyInterface("Rotation",se)),Z.ir&&(Q.ir.setGroupProperty(PropertyInterface("Inner Radius",se)),Q.is.setGroupProperty(PropertyInterface("Inner Roundness",se))),Object.defineProperties(ee,{position:{get:ExpressionPropertyInterface(Q.p)},rotation:{get:ExpressionPropertyInterface(Q.r)},points:{get:ExpressionPropertyInterface(Q.pt)},outerRadius:{get:ExpressionPropertyInterface(Q.or)},outerRoundness:{get:ExpressionPropertyInterface(Q.os)},innerRadius:{get:ExpressionPropertyInterface(Q.ir)},innerRoundness:{get:ExpressionPropertyInterface(Q.is)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}function V(Z,Y,le){function ee(oe){return Z.p.ix===oe?ee.position:Z.r.ix===oe?ee.roundness:Z.s.ix===oe||oe==="Size"||oe==="ADBE Vector Rect Size"?ee.size:null}var se=propertyGroupFactory(ee,le),Q=Y.sh.ty==="tm"?Y.sh.prop:Y.sh;return ee.propertyIndex=Z.ix,Q.p.setGroupProperty(PropertyInterface("Position",se)),Q.s.setGroupProperty(PropertyInterface("Size",se)),Q.r.setGroupProperty(PropertyInterface("Rotation",se)),Object.defineProperties(ee,{position:{get:ExpressionPropertyInterface(Q.p)},roundness:{get:ExpressionPropertyInterface(Q.r)},size:{get:ExpressionPropertyInterface(Q.s)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}function G(Z,Y,le){function ee(oe){return Z.r.ix===oe||oe==="Round Corners 1"?ee.radius:null}var se=propertyGroupFactory(ee,le),Q=Y;return ee.propertyIndex=Z.ix,Q.rd.setGroupProperty(PropertyInterface("Radius",se)),Object.defineProperties(ee,{radius:{get:ExpressionPropertyInterface(Q.rd)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}function J(Z,Y,le){function ee(oe){return Z.c.ix===oe||oe==="Copies"?ee.copies:Z.o.ix===oe||oe==="Offset"?ee.offset:null}var se=propertyGroupFactory(ee,le),Q=Y;return ee.propertyIndex=Z.ix,Q.c.setGroupProperty(PropertyInterface("Copies",se)),Q.o.setGroupProperty(PropertyInterface("Offset",se)),Object.defineProperties(ee,{copies:{get:ExpressionPropertyInterface(Q.c)},offset:{get:ExpressionPropertyInterface(Q.o)},_name:{value:Z.nm}}),ee.mn=Z.mn,ee}return function(Z,Y,le){var ee;function se(oe){if(typeof oe=="number")return oe=oe===void 0?1:oe,oe===0?le:ee[oe-1];for(var _e=0,Se=ee.length;_e<Se;){if(ee[_e]._name===oe)return ee[_e];_e+=1}return null}function Q(){return le}return se.propertyGroup=propertyGroupFactory(se,Q),ee=t(Z,Y,se.propertyGroup),se.numProperties=ee.length,se._name="Contents",se}})(),TextExpressionInterface=(function(){return function(t){var s;function u(d){switch(d){case"ADBE Text Document":return u.sourceText;default:return null}}return Object.defineProperty(u,"sourceText",{get:function(){t.textProperty.getValue();var _=t.textProperty.currentData.t;return(!s||_!==s.value)&&(s=new String(_),s.value=_||new String(_),Object.defineProperty(s,"style",{get:function(){return{fillColor:t.textProperty.currentData.fc}}})),s}}),u}})();function _typeof(t){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof(t)}var FootageInterface=(function(){var t=function(d){var _="",S=d.getFootageData();function R(){return _="",S=d.getFootageData(),a}function a(k){if(S[k])return _=k,S=S[k],_typeof(S)==="object"?a:S;var O=k.indexOf(_);if(O!==-1){var j=parseInt(k.substr(O+_.length),10);return S=S[j],_typeof(S)==="object"?a:S}return""}return R},s=function(d){function _(S){return S==="Outline"?_.outlineInterface():null}return _._name="Outline",_.outlineInterface=t(d),_};return function(u){function d(_){return _==="Data"?d.dataInterface:null}return d._name="Data",d.dataInterface=s(u),d}})(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(t){return interfaces[t]||null}var expressionHelpers=(function(){function t(R,a,k){a.x&&(k.k=!0,k.x=!0,k.initiateExpression=ExpressionManager.initiateExpression,k.effectsSequence.push(k.initiateExpression(R,a,k).bind(k)))}function s(R){return R*=this.elem.globalData.frameRate,R-=this.offsetTime,R!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<R?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(R,this._cachingAtTime),this._cachingAtTime.lastFrame=R),this._cachingAtTime.value}function u(R){var a=-.01,k=this.getValueAtTime(R),O=this.getValueAtTime(R+a),j=0;if(k.length){var V;for(V=0;V<k.length;V+=1)j+=Math.pow(O[V]-k[V],2);j=Math.sqrt(j)*100}else j=0;return j}function d(R){if(this.vel!==void 0)return this.vel;var a=-.001,k=this.getValueAtTime(R),O=this.getValueAtTime(R+a),j;if(k.length){j=createTypedArray("float32",k.length);var V;for(V=0;V<k.length;V+=1)j[V]=(O[V]-k[V])/a}else j=(O-k)/a;return j}function _(){return this.pv}function S(R){this.propertyGroup=R}return{searchExpressions:t,getSpeedAtTime:u,getVelocityAtTime:d,getValueAtTime:s,getStaticValueAtTime:_,setGroupProperty:S}})();function addPropertyDecorator(){function t(G,J,Z){if(!this.k||!this.keyframes)return this.pv;G=G?G.toLowerCase():"";var Y=this.comp.renderedFrame,le=this.keyframes,ee=le[le.length-1].t;if(Y<=ee)return this.pv;var se,Q;Z?(J?se=Math.abs(ee-this.elem.comp.globalData.frameRate*J):se=Math.max(0,ee-this.elem.data.ip),Q=ee-se):((!J||J>le.length-1)&&(J=le.length-1),Q=le[le.length-1-J].t,se=ee-Q);var oe,_e,Se;if(G==="pingpong"){var ke=Math.floor((Y-Q)/se);if(ke%2!==0)return this.getValueAtTime((se-(Y-Q)%se+Q)/this.comp.globalData.frameRate,0)}else if(G==="offset"){var Le=this.getValueAtTime(Q/this.comp.globalData.frameRate,0),lt=this.getValueAtTime(ee/this.comp.globalData.frameRate,0),qt=this.getValueAtTime(((Y-Q)%se+Q)/this.comp.globalData.frameRate,0),Yt=Math.floor((Y-Q)/se);if(this.pv.length){for(Se=new Array(Le.length),_e=Se.length,oe=0;oe<_e;oe+=1)Se[oe]=(lt[oe]-Le[oe])*Yt+qt[oe];return Se}return(lt-Le)*Yt+qt}else if(G==="continue"){var Ot=this.getValueAtTime(ee/this.comp.globalData.frameRate,0),Bt=this.getValueAtTime((ee-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Se=new Array(Ot.length),_e=Se.length,oe=0;oe<_e;oe+=1)Se[oe]=Ot[oe]+(Ot[oe]-Bt[oe])*((Y-ee)/this.comp.globalData.frameRate)/5e-4;return Se}return Ot+(Ot-Bt)*((Y-ee)/.001)}return this.getValueAtTime(((Y-Q)%se+Q)/this.comp.globalData.frameRate,0)}function s(G,J,Z){if(!this.k)return this.pv;G=G?G.toLowerCase():"";var Y=this.comp.renderedFrame,le=this.keyframes,ee=le[0].t;if(Y>=ee)return this.pv;var se,Q;Z?(J?se=Math.abs(this.elem.comp.globalData.frameRate*J):se=Math.max(0,this.elem.data.op-ee),Q=ee+se):((!J||J>le.length-1)&&(J=le.length-1),Q=le[J].t,se=Q-ee);var oe,_e,Se;if(G==="pingpong"){var ke=Math.floor((ee-Y)/se);if(ke%2===0)return this.getValueAtTime(((ee-Y)%se+ee)/this.comp.globalData.frameRate,0)}else if(G==="offset"){var Le=this.getValueAtTime(ee/this.comp.globalData.frameRate,0),lt=this.getValueAtTime(Q/this.comp.globalData.frameRate,0),qt=this.getValueAtTime((se-(ee-Y)%se+ee)/this.comp.globalData.frameRate,0),Yt=Math.floor((ee-Y)/se)+1;if(this.pv.length){for(Se=new Array(Le.length),_e=Se.length,oe=0;oe<_e;oe+=1)Se[oe]=qt[oe]-(lt[oe]-Le[oe])*Yt;return Se}return qt-(lt-Le)*Yt}else if(G==="continue"){var Ot=this.getValueAtTime(ee/this.comp.globalData.frameRate,0),Bt=this.getValueAtTime((ee+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Se=new Array(Ot.length),_e=Se.length,oe=0;oe<_e;oe+=1)Se[oe]=Ot[oe]+(Ot[oe]-Bt[oe])*(ee-Y)/.001;return Se}return Ot+(Ot-Bt)*(ee-Y)/.001}return this.getValueAtTime((se-((ee-Y)%se+ee))/this.comp.globalData.frameRate,0)}function u(G,J){if(!this.k)return this.pv;if(G=(G||.4)*.5,J=Math.floor(J||5),J<=1)return this.pv;var Z=this.comp.renderedFrame/this.comp.globalData.frameRate,Y=Z-G,le=Z+G,ee=J>1?(le-Y)/(J-1):1,se=0,Q=0,oe;this.pv.length?oe=createTypedArray("float32",this.pv.length):oe=0;for(var _e;se<J;){if(_e=this.getValueAtTime(Y+se*ee),this.pv.length)for(Q=0;Q<this.pv.length;Q+=1)oe[Q]+=_e[Q];else oe+=_e;se+=1}if(this.pv.length)for(Q=0;Q<this.pv.length;Q+=1)oe[Q]/=J;else oe/=J;return oe}function d(G){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var J=this._transformCachingAtTime.v;if(J.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Z=this.a.getValueAtTime(G);J.translate(-Z[0]*this.a.mult,-Z[1]*this.a.mult,Z[2]*this.a.mult)}if(this.appliedTransformations<2){var Y=this.s.getValueAtTime(G);J.scale(Y[0]*this.s.mult,Y[1]*this.s.mult,Y[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var le=this.sk.getValueAtTime(G),ee=this.sa.getValueAtTime(G);J.skewFromAxis(-le*this.sk.mult,ee*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var se=this.r.getValueAtTime(G);J.rotate(-se*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Q=this.rz.getValueAtTime(G),oe=this.ry.getValueAtTime(G),_e=this.rx.getValueAtTime(G),Se=this.or.getValueAtTime(G);J.rotateZ(-Q*this.rz.mult).rotateY(oe*this.ry.mult).rotateX(_e*this.rx.mult).rotateZ(-Se[2]*this.or.mult).rotateY(Se[1]*this.or.mult).rotateX(Se[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var ke=this.px.getValueAtTime(G),Le=this.py.getValueAtTime(G);if(this.data.p.z){var lt=this.pz.getValueAtTime(G);J.translate(ke*this.px.mult,Le*this.py.mult,-lt*this.pz.mult)}else J.translate(ke*this.px.mult,Le*this.py.mult,0)}else{var qt=this.p.getValueAtTime(G);J.translate(qt[0]*this.p.mult,qt[1]*this.p.mult,-qt[2]*this.p.mult)}return J}function _(){return this.v.clone(new Matrix)}var S=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(G,J,Z){var Y=S(G,J,Z);return Y.dynamicProperties.length?Y.getValueAtTime=d.bind(Y):Y.getValueAtTime=_.bind(Y),Y.setGroupProperty=expressionHelpers.setGroupProperty,Y};var R=PropertyFactory.getProp;PropertyFactory.getProp=function(G,J,Z,Y,le){var ee=R(G,J,Z,Y,le);ee.kf?ee.getValueAtTime=expressionHelpers.getValueAtTime.bind(ee):ee.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(ee),ee.setGroupProperty=expressionHelpers.setGroupProperty,ee.loopOut=t,ee.loopIn=s,ee.smooth=u,ee.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(ee),ee.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(ee),ee.numKeys=J.a===1?J.k.length:0,ee.propertyIndex=J.ix;var se=0;return Z!==0&&(se=createTypedArray("float32",J.a===1?J.k[0].s.length:J.k.length)),ee._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:se},expressionHelpers.searchExpressions(G,J,ee),ee.k&&le.addDynamicProperty(ee),ee};function a(G){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),G*=this.elem.globalData.frameRate,G-=this.offsetTime,G!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<G?this._caching.lastIndex:0,this._cachingAtTime.lastTime=G,this.interpolateShape(G,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var k=ShapePropertyFactory.getConstructorFunction(),O=ShapePropertyFactory.getKeyframedConstructorFunction();function j(){}j.prototype={vertices:function(J,Z){this.k&&this.getValue();var Y=this.v;Z!==void 0&&(Y=this.getValueAtTime(Z,0));var le,ee=Y._length,se=Y[J],Q=Y.v,oe=createSizedArray(ee);for(le=0;le<ee;le+=1)J==="i"||J==="o"?oe[le]=[se[le][0]-Q[le][0],se[le][1]-Q[le][1]]:oe[le]=[se[le][0],se[le][1]];return oe},points:function(J){return this.vertices("v",J)},inTangents:function(J){return this.vertices("i",J)},outTangents:function(J){return this.vertices("o",J)},isClosed:function(){return this.v.c},pointOnPath:function(J,Z){var Y=this.v;Z!==void 0&&(Y=this.getValueAtTime(Z,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(Y));for(var le=this._segmentsLength,ee=le.lengths,se=le.totalLength*J,Q=0,oe=ee.length,_e=0,Se;Q<oe;){if(_e+ee[Q].addedLength>se){var ke=Q,Le=Y.c&&Q===oe-1?0:Q+1,lt=(se-_e)/ee[Q].addedLength;Se=bez.getPointInSegment(Y.v[ke],Y.v[Le],Y.o[ke],Y.i[Le],lt,ee[Q]);break}else _e+=ee[Q].addedLength;Q+=1}return Se||(Se=Y.c?[Y.v[0][0],Y.v[0][1]]:[Y.v[Y._length-1][0],Y.v[Y._length-1][1]]),Se},vectorOnPath:function(J,Z,Y){J==1?J=this.v.c:J==0&&(J=.999);var le=this.pointOnPath(J,Z),ee=this.pointOnPath(J+.001,Z),se=ee[0]-le[0],Q=ee[1]-le[1],oe=Math.sqrt(Math.pow(se,2)+Math.pow(Q,2));if(oe===0)return[0,0];var _e=Y==="tangent"?[se/oe,Q/oe]:[-Q/oe,se/oe];return _e},tangentOnPath:function(J,Z){return this.vectorOnPath(J,Z,"tangent")},normalOnPath:function(J,Z){return this.vectorOnPath(J,Z,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([j],k),extendPrototype([j],O),O.prototype.getValueAtTime=a,O.prototype.initiateExpression=ExpressionManager.initiateExpression;var V=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(G,J,Z,Y,le){var ee=V(G,J,Z,Y,le);return ee.propertyIndex=J.ix,ee.lock=!1,Z===3?expressionHelpers.searchExpressions(G,J.pt,ee):Z===4&&expressionHelpers.searchExpressions(G,J.ks,ee),ee.k&&G.addDynamicProperty(ee),ee}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function t(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(s,u){var d=this.calculateExpression(u);if(s.t!==d){var _={};return this.copyData(_,s),_.t=d.toString(),_.__complete=!1,_}return s},TextProperty.prototype.searchProperty=function(){var s=this.searchKeyframes(),u=this.searchExpressions();return this.kf=s||u,this.kf},TextProperty.prototype.searchExpressions=t}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function t(s,u){var d=createNS("feMerge");d.setAttribute("result",s);var _,S;for(S=0;S<u.length;S+=1)_=createNS("feMergeNode"),_.setAttribute("in",u[S]),d.appendChild(_),d.appendChild(_);return d}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(t,s,u,d,_){this.filterManager=s;var S=createNS("feColorMatrix");S.setAttribute("type","matrix"),S.setAttribute("color-interpolation-filters","linearRGB"),S.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=S,S.setAttribute("result",d+"_tint_1"),t.appendChild(S),S=createNS("feColorMatrix"),S.setAttribute("type","matrix"),S.setAttribute("color-interpolation-filters","sRGB"),S.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),S.setAttribute("result",d+"_tint_2"),t.appendChild(S),this.matrixFilter=S;var R=this.createMergeNode(d,[_,d+"_tint_1",d+"_tint_2"]);t.appendChild(R)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var s=this.filterManager.effectElements[0].p.v,u=this.filterManager.effectElements[1].p.v,d=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+d+" 0"),this.matrixFilter.setAttribute("values",u[0]-s[0]+" 0 0 0 "+s[0]+" "+(u[1]-s[1])+" 0 0 0 "+s[1]+" "+(u[2]-s[2])+" 0 0 0 "+s[2]+" 0 0 0 1 0")}};function SVGFillFilter(t,s,u,d){this.filterManager=s;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),_.setAttribute("result",d),t.appendChild(_),this.matrixFilter=_}SVGFillFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var s=this.filterManager.effectElements[2].p.v,u=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+s[0]+" 0 0 0 0 "+s[1]+" 0 0 0 0 "+s[2]+" 0 0 0 "+u+" 0")}};function SVGStrokeEffect(t,s,u){this.initialized=!1,this.filterManager=s,this.elem=u,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var t=this.elem.layerElement.children||this.elem.layerElement.childNodes,s,u,d,_;for(this.filterManager.effectElements[1].p.v===1?(_=this.elem.maskManager.masksProperties.length,d=0):(d=this.filterManager.effectElements[0].p.v-1,_=d+1),u=createNS("g"),u.setAttribute("fill","none"),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-dashoffset",1),d;d<_;d+=1)s=createNS("path"),u.appendChild(s),this.paths.push({p:s,m:d});if(this.filterManager.effectElements[10].p.v===3){var S=createNS("mask"),R=createElementID();S.setAttribute("id",R),S.setAttribute("mask-type","alpha"),S.appendChild(u),this.elem.globalData.defs.appendChild(S);var a=createNS("g");for(a.setAttribute("mask","url("+getLocationHref()+"#"+R+")");t[0];)a.appendChild(t[0]);this.elem.layerElement.appendChild(a),this.masker=S,u.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(t=this.elem.layerElement.children||this.elem.layerElement.childNodes;t.length;)this.elem.layerElement.removeChild(t[0]);this.elem.layerElement.appendChild(u),this.elem.layerElement.removeAttribute("mask"),u.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=u},SVGStrokeEffect.prototype.renderFrame=function(t){this.initialized||this.initialize();var s,u=this.paths.length,d,_;for(s=0;s<u;s+=1)if(this.paths[s].m!==-1&&(d=this.elem.maskManager.viewData[this.paths[s].m],_=this.paths[s].p,(t||this.filterManager._mdf||d.prop._mdf)&&_.setAttribute("d",d.lastPath),t||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||d.prop._mdf)){var S;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var R=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,a=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,k=_.getTotalLength();S="0 0 0 "+k*R+" ";var O=k*(a-R),j=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,V=Math.floor(O/j),G;for(G=0;G<V;G+=1)S+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";S+="0 "+k*10+" 0 0"}else S="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;_.setAttribute("stroke-dasharray",S)}if((t||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(t||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(t||this.filterManager.effectElements[3].p._mdf)){var J=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(J[0]*255)+","+bmFloor(J[1]*255)+","+bmFloor(J[2]*255)+")")}};function SVGTritoneFilter(t,s,u,d){this.filterManager=s;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","linearRGB"),_.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),t.appendChild(_);var S=createNS("feComponentTransfer");S.setAttribute("color-interpolation-filters","sRGB"),S.setAttribute("result",d),this.matrixFilter=S;var R=createNS("feFuncR");R.setAttribute("type","table"),S.appendChild(R),this.feFuncR=R;var a=createNS("feFuncG");a.setAttribute("type","table"),S.appendChild(a),this.feFuncG=a;var k=createNS("feFuncB");k.setAttribute("type","table"),S.appendChild(k),this.feFuncB=k,t.appendChild(S)}SVGTritoneFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var s=this.filterManager.effectElements[0].p.v,u=this.filterManager.effectElements[1].p.v,d=this.filterManager.effectElements[2].p.v,_=d[0]+" "+u[0]+" "+s[0],S=d[1]+" "+u[1]+" "+s[1],R=d[2]+" "+u[2]+" "+s[2];this.feFuncR.setAttribute("tableValues",_),this.feFuncG.setAttribute("tableValues",S),this.feFuncB.setAttribute("tableValues",R)}};function SVGProLevelsFilter(t,s,u,d){this.filterManager=s;var _=this.filterManager.effectElements,S=createNS("feComponentTransfer");(_[10].p.k||_[10].p.v!==0||_[11].p.k||_[11].p.v!==1||_[12].p.k||_[12].p.v!==1||_[13].p.k||_[13].p.v!==0||_[14].p.k||_[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",S)),(_[17].p.k||_[17].p.v!==0||_[18].p.k||_[18].p.v!==1||_[19].p.k||_[19].p.v!==1||_[20].p.k||_[20].p.v!==0||_[21].p.k||_[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",S)),(_[24].p.k||_[24].p.v!==0||_[25].p.k||_[25].p.v!==1||_[26].p.k||_[26].p.v!==1||_[27].p.k||_[27].p.v!==0||_[28].p.k||_[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",S)),(_[31].p.k||_[31].p.v!==0||_[32].p.k||_[32].p.v!==1||_[33].p.k||_[33].p.v!==1||_[34].p.k||_[34].p.v!==0||_[35].p.k||_[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",S)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(S.setAttribute("color-interpolation-filters","sRGB"),t.appendChild(S)),(_[3].p.k||_[3].p.v!==0||_[4].p.k||_[4].p.v!==1||_[5].p.k||_[5].p.v!==1||_[6].p.k||_[6].p.v!==0||_[7].p.k||_[7].p.v!==1)&&(S=createNS("feComponentTransfer"),S.setAttribute("color-interpolation-filters","sRGB"),S.setAttribute("result",d),t.appendChild(S),this.feFuncRComposed=this.createFeFunc("feFuncR",S),this.feFuncGComposed=this.createFeFunc("feFuncG",S),this.feFuncBComposed=this.createFeFunc("feFuncB",S))}SVGProLevelsFilter.prototype.createFeFunc=function(t,s){var u=createNS(t);return u.setAttribute("type","table"),s.appendChild(u),u},SVGProLevelsFilter.prototype.getTableValue=function(t,s,u,d,_){for(var S=0,R=256,a,k=Math.min(t,s),O=Math.max(t,s),j=Array.call(null,{length:R}),V,G=0,J=_-d,Z=s-t;S<=256;)a=S/256,a<=k?V=Z<0?_:d:a>=O?V=Z<0?d:_:V=d+J*Math.pow((a-t)/Z,1/u),j[G]=V,G+=1,S+=256/(R-1);return j.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var s,u=this.filterManager.effectElements;this.feFuncRComposed&&(t||u[3].p._mdf||u[4].p._mdf||u[5].p._mdf||u[6].p._mdf||u[7].p._mdf)&&(s=this.getTableValue(u[3].p.v,u[4].p.v,u[5].p.v,u[6].p.v,u[7].p.v),this.feFuncRComposed.setAttribute("tableValues",s),this.feFuncGComposed.setAttribute("tableValues",s),this.feFuncBComposed.setAttribute("tableValues",s)),this.feFuncR&&(t||u[10].p._mdf||u[11].p._mdf||u[12].p._mdf||u[13].p._mdf||u[14].p._mdf)&&(s=this.getTableValue(u[10].p.v,u[11].p.v,u[12].p.v,u[13].p.v,u[14].p.v),this.feFuncR.setAttribute("tableValues",s)),this.feFuncG&&(t||u[17].p._mdf||u[18].p._mdf||u[19].p._mdf||u[20].p._mdf||u[21].p._mdf)&&(s=this.getTableValue(u[17].p.v,u[18].p.v,u[19].p.v,u[20].p.v,u[21].p.v),this.feFuncG.setAttribute("tableValues",s)),this.feFuncB&&(t||u[24].p._mdf||u[25].p._mdf||u[26].p._mdf||u[27].p._mdf||u[28].p._mdf)&&(s=this.getTableValue(u[24].p.v,u[25].p.v,u[26].p.v,u[27].p.v,u[28].p.v),this.feFuncB.setAttribute("tableValues",s)),this.feFuncA&&(t||u[31].p._mdf||u[32].p._mdf||u[33].p._mdf||u[34].p._mdf||u[35].p._mdf)&&(s=this.getTableValue(u[31].p.v,u[32].p.v,u[33].p.v,u[34].p.v,u[35].p.v),this.feFuncA.setAttribute("tableValues",s))}};function SVGDropShadowEffect(t,s,u,d,_){var S=s.container.globalData.renderConfig.filterSize,R=s.data.fs||S;t.setAttribute("x",R.x||S.x),t.setAttribute("y",R.y||S.y),t.setAttribute("width",R.width||S.width),t.setAttribute("height",R.height||S.height),this.filterManager=s;var a=createNS("feGaussianBlur");a.setAttribute("in","SourceAlpha"),a.setAttribute("result",d+"_drop_shadow_1"),a.setAttribute("stdDeviation","0"),this.feGaussianBlur=a,t.appendChild(a);var k=createNS("feOffset");k.setAttribute("dx","25"),k.setAttribute("dy","0"),k.setAttribute("in",d+"_drop_shadow_1"),k.setAttribute("result",d+"_drop_shadow_2"),this.feOffset=k,t.appendChild(k);var O=createNS("feFlood");O.setAttribute("flood-color","#00ff00"),O.setAttribute("flood-opacity","1"),O.setAttribute("result",d+"_drop_shadow_3"),this.feFlood=O,t.appendChild(O);var j=createNS("feComposite");j.setAttribute("in",d+"_drop_shadow_3"),j.setAttribute("in2",d+"_drop_shadow_2"),j.setAttribute("operator","in"),j.setAttribute("result",d+"_drop_shadow_4"),t.appendChild(j);var V=this.createMergeNode(d,[d+"_drop_shadow_4",_]);t.appendChild(V)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){if((t||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),t||this.filterManager.effectElements[0].p._mdf){var s=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)))}if((t||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),t||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var u=this.filterManager.effectElements[3].p.v,d=(this.filterManager.effectElements[2].p.v-90)*degToRads,_=u*Math.cos(d),S=u*Math.sin(d);this.feOffset.setAttribute("dx",_),this.feOffset.setAttribute("dy",S)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(t,s,u){this.initialized=!1,this.filterManager=s,this.filterElem=t,this.elem=u,u.matteElement=createNS("g"),u.matteElement.appendChild(u.layerElement),u.matteElement.appendChild(u.transformedElement),u.baseElement=u.matteElement}SVGMatte3Effect.prototype.findSymbol=function(t){for(var s=0,u=_svgMatteSymbols.length;s<u;){if(_svgMatteSymbols[s]===t)return _svgMatteSymbols[s];s+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(t,s){var u=t.layerElement.parentNode;if(u){for(var d=u.children,_=0,S=d.length;_<S&&d[_]!==t.layerElement;)_+=1;var R;_<=S-2&&(R=d[_+1]);var a=createNS("use");a.setAttribute("href","#"+s),R?u.insertBefore(a,R):u.appendChild(a)}},SVGMatte3Effect.prototype.setElementAsMask=function(t,s){if(!this.findSymbol(s)){var u=createElementID(),d=createNS("mask");d.setAttribute("id",s.layerId),d.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(s);var _=t.globalData.defs;_.appendChild(d);var S=createNS("symbol");S.setAttribute("id",u),this.replaceInParent(s,u),S.appendChild(s.layerElement),_.appendChild(S);var R=createNS("use");R.setAttribute("href","#"+u),d.appendChild(R),s.data.hd=!1,s.show()}t.setMatte(s.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var t=this.filterManager.effectElements[0].p.v,s=this.elem.comp.elements,u=0,d=s.length;u<d;)s[u]&&s[u].data.ind===t&&this.setElementAsMask(this.elem,s[u]),u+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(t,s,u,d){t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width","300%"),t.setAttribute("height","300%"),this.filterManager=s;var _=createNS("feGaussianBlur");_.setAttribute("result",d),t.appendChild(_),this.feGaussianBlur=_}SVGGaussianBlurEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var s=.3,u=this.filterManager.effectElements[0].p.v*s,d=this.filterManager.effectElements[1].p.v,_=d==3?0:u,S=d==2?0:u;this.feGaussianBlur.setAttribute("stdDeviation",_+" "+S);var R=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",R)}};function TransformEffect(){}TransformEffect.prototype.init=function(t){this.effectsManager=t,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(t){if(this._opMdf=!1,this._mdf=!1,t||this.effectsManager._mdf){var s=this.effectsManager.effectElements,u=s[0].p.v,d=s[1].p.v,_=s[2].p.v===1,S=s[3].p.v,R=_?S:s[4].p.v,a=s[5].p.v,k=s[6].p.v,O=s[7].p.v;this.matrix.reset(),this.matrix.translate(-u[0],-u[1],u[2]),this.matrix.scale(R*.01,S*.01,1),this.matrix.rotate(-O*degToRads),this.matrix.skewFromAxis(-a*degToRads,(k+90)*degToRads),this.matrix.translate(d[0],d[1],0),this._mdf=!0,this.opacity!==s[8].p.v&&(this.opacity=s[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(t,s){this.init(s)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(t){this.init(t)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie}))})(lottie$2,lottie$2.exports)),lottie$2.exports}var lottieExports=requireLottie();const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(t,s){(s==null||s>t.length)&&(s=t.length);for(var u=0,d=Array(s);u<s;u++)d[u]=t[u];return d}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperty(t,s,u){return(s=_toPropertyKey(s))in t?Object.defineProperty(t,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[s]=u,t}function _iterableToArrayLimit(t,s){var u=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(u!=null){var d,_,S,R,a=[],k=!0,O=!1;try{if(S=(u=u.call(t)).next,s!==0)for(;!(k=(d=S.call(u)).done)&&(a.push(d.value),a.length!==s);k=!0);}catch(j){O=!0,_=j}finally{try{if(!k&&u.return!=null&&(R=u.return(),Object(R)!==R))return}finally{if(O)throw _}}return a}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(t,s){var u=Object.keys(t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);s&&(d=d.filter(function(_){return Object.getOwnPropertyDescriptor(t,_).enumerable})),u.push.apply(u,d)}return u}function _objectSpread2(t){for(var s=1;s<arguments.length;s++){var u=arguments[s]!=null?arguments[s]:{};s%2?ownKeys(Object(u),!0).forEach(function(d){_defineProperty(t,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(u)):ownKeys(Object(u)).forEach(function(d){Object.defineProperty(t,d,Object.getOwnPropertyDescriptor(u,d))})}return t}function _objectWithoutProperties(t,s){if(t==null)return{};var u,d,_=_objectWithoutPropertiesLoose(t,s);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(t);for(d=0;d<S.length;d++)u=S[d],s.includes(u)||{}.propertyIsEnumerable.call(t,u)&&(_[u]=t[u])}return _}function _objectWithoutPropertiesLoose(t,s){if(t==null)return{};var u={};for(var d in t)if({}.hasOwnProperty.call(t,d)){if(s.includes(d))continue;u[d]=t[d]}return u}function _slicedToArray(t,s){return _arrayWithHoles(t)||_iterableToArrayLimit(t,s)||_unsupportedIterableToArray(t,s)||_nonIterableRest()}function _toPrimitive(t,s){if(typeof t!="object"||!t)return t;var u=t[Symbol.toPrimitive];if(u!==void 0){var d=u.call(t,s);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function _toPropertyKey(t){var s=_toPrimitive(t,"string");return typeof s=="symbol"?s:s+""}function _unsupportedIterableToArray(t,s){if(t){if(typeof t=="string")return _arrayLikeToArray(t,s);var u={}.toString.call(t).slice(8,-1);return u==="Object"&&t.constructor&&(u=t.constructor.name),u==="Map"||u==="Set"?Array.from(t):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?_arrayLikeToArray(t,s):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function t(s,u){var d=s.animationData,_=s.loop,S=s.autoplay,R=s.initialSegment,a=s.onComplete,k=s.onLoopComplete,O=s.onEnterFrame,j=s.onSegmentStart,V=s.onConfigReady,G=s.onDataReady,J=s.onDataFailed,Z=s.onLoadedImages,Y=s.onDOMLoaded,le=s.onDestroy;s.lottieRef,s.renderer,s.name,s.assetsPath,s.rendererSettings;var ee=_objectWithoutProperties(s,_excluded$1),se=reactExports.useState(!1),Q=_slicedToArray(se,2),oe=Q[0],_e=Q[1],Se=reactExports.useRef(),ke=reactExports.useRef(null),Le=function(){var at;(at=Se.current)===null||at===void 0||at.play()},lt=function(){var at;(at=Se.current)===null||at===void 0||at.stop()},qt=function(){var at;(at=Se.current)===null||at===void 0||at.pause()},Yt=function(at){var ct;(ct=Se.current)===null||ct===void 0||ct.setSpeed(at)},Ot=function(at,ct){var Ct;(Ct=Se.current)===null||Ct===void 0||Ct.goToAndPlay(at,ct)},Bt=function(at,ct){var Ct;(Ct=Se.current)===null||Ct===void 0||Ct.goToAndStop(at,ct)},si=function(at){var ct;(ct=Se.current)===null||ct===void 0||ct.setDirection(at)},kt=function(at,ct){var Ct;(Ct=Se.current)===null||Ct===void 0||Ct.playSegments(at,ct)},xe=function(at){var ct;(ct=Se.current)===null||ct===void 0||ct.setSubframe(at)},Fe=function(at){var ct;return(ct=Se.current)===null||ct===void 0?void 0:ct.getDuration(at)},pe=function(){var at;(at=Se.current)===null||at===void 0||at.destroy(),Se.current=void 0},Te=function(){var at=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ct;if(ke.current){(ct=Se.current)===null||ct===void 0||ct.destroy();var Ct=_objectSpread2(_objectSpread2(_objectSpread2({},s),at),{},{container:ke.current});return Se.current=lottie.loadAnimation(Ct),_e(!!Se.current),function(){var li;(li=Se.current)===null||li===void 0||li.destroy(),Se.current=void 0}}};reactExports.useEffect(function(){var Me=Te();return function(){return Me==null?void 0:Me()}},[d,_]),reactExports.useEffect(function(){Se.current&&(Se.current.autoplay=!!S)},[S]),reactExports.useEffect(function(){if(Se.current){if(!R){Se.current.resetSegments(!0);return}!Array.isArray(R)||!R.length||((Se.current.currentRawFrame<R[0]||Se.current.currentRawFrame>R[1])&&(Se.current.currentRawFrame=R[0]),Se.current.setSegment(R[0],R[1]))}},[R]),reactExports.useEffect(function(){var Me=[{name:"complete",handler:a},{name:"loopComplete",handler:k},{name:"enterFrame",handler:O},{name:"segmentStart",handler:j},{name:"config_ready",handler:V},{name:"data_ready",handler:G},{name:"data_failed",handler:J},{name:"loaded_images",handler:Z},{name:"DOMLoaded",handler:Y},{name:"destroy",handler:le}],at=Me.filter(function(Ct){return Ct.handler!=null});if(at.length){var ct=at.map(function(Ct){var li;return(li=Se.current)===null||li===void 0||li.addEventListener(Ct.name,Ct.handler),function(){var mi;(mi=Se.current)===null||mi===void 0||mi.removeEventListener(Ct.name,Ct.handler)}});return function(){ct.forEach(function(Ct){return Ct()})}}},[a,k,O,j,V,G,J,Z,Y,le]);var st=React2.createElement("div",_objectSpread2({style:u,ref:ke},ee));return{View:st,play:Le,stop:lt,pause:qt,setSpeed:Yt,goToAndStop:Bt,goToAndPlay:Ot,setDirection:si,playSegments:kt,setSubframe:xe,getDuration:Fe,destroy:pe,animationContainerRef:ke,animationLoaded:oe,animationItem:Se.current}};function getContainerVisibility(t){var s=t.getBoundingClientRect(),u=s.top,d=s.height,_=window.innerHeight-u,S=window.innerHeight+d;return _/S}function getContainerCursorPosition(t,s,u){var d=t.getBoundingClientRect(),_=d.top,S=d.left,R=d.width,a=d.height,k=(s-S)/R,O=(u-_)/a;return{x:k,y:O}}var useInitInteractivity=function t(s){var u=s.wrapperRef,d=s.animationItem,_=s.mode,S=s.actions;reactExports.useEffect(function(){var R=u.current;if(!(!R||!d||!S.length)){d.stop();var a=function(){var j=null,V=function(){var J=getContainerVisibility(R),Z=S.find(function(le){var ee=le.visibility;return ee&&J>=ee[0]&&J<=ee[1]});if(Z){if(Z.type==="seek"&&Z.visibility&&Z.frames.length===2){var Y=Z.frames[0]+Math.ceil((J-Z.visibility[0])/(Z.visibility[1]-Z.visibility[0])*Z.frames[1]);//! goToAndStop must be relative to the start of the current segment
d.goToAndStop(Y-d.firstFrame-1,!0)}Z.type==="loop"&&(j===null||j!==Z.frames||d.isPaused)&&(d.playSegments(Z.frames,!0),j=Z.frames),Z.type==="play"&&d.isPaused&&(d.resetSegments(!0),d.play()),Z.type==="stop"&&d.goToAndStop(Z.frames[0]-d.firstFrame-1,!0)}};return document.addEventListener("scroll",V),function(){document.removeEventListener("scroll",V)}},k=function(){var j=function(Z,Y){var le=Z,ee=Y;if(le!==-1&&ee!==-1){var se=getContainerCursorPosition(R,le,ee);le=se.x,ee=se.y}var Q=S.find(function(Se){var ke=Se.position;return ke&&Array.isArray(ke.x)&&Array.isArray(ke.y)?le>=ke.x[0]&&le<=ke.x[1]&&ee>=ke.y[0]&&ee<=ke.y[1]:ke&&!Number.isNaN(ke.x)&&!Number.isNaN(ke.y)?le===ke.x&&ee===ke.y:!1});if(Q){if(Q.type==="seek"&&Q.position&&Array.isArray(Q.position.x)&&Array.isArray(Q.position.y)&&Q.frames.length===2){var oe=(le-Q.position.x[0])/(Q.position.x[1]-Q.position.x[0]),_e=(ee-Q.position.y[0])/(Q.position.y[1]-Q.position.y[0]);d.playSegments(Q.frames,!0),d.goToAndStop(Math.ceil((oe+_e)/2*(Q.frames[1]-Q.frames[0])),!0)}Q.type==="loop"&&d.playSegments(Q.frames,!0),Q.type==="play"&&(d.isPaused&&d.resetSegments(!1),d.playSegments(Q.frames)),Q.type==="stop"&&d.goToAndStop(Q.frames[0],!0)}},V=function(Z){j(Z.clientX,Z.clientY)},G=function(){j(-1,-1)};return R.addEventListener("mousemove",V),R.addEventListener("mouseout",G),function(){R.removeEventListener("mousemove",V),R.removeEventListener("mouseout",G)}};switch(_){case"scroll":return a();case"cursor":return k()}}},[_,d])},useLottieInteractivity=function t(s){var u=s.actions,d=s.mode,_=s.lottieObj,S=_.animationItem,R=_.View,a=_.animationContainerRef;return useInitInteractivity({actions:u,animationItem:S,mode:d,wrapperRef:a}),R},_excluded=["style","interactivity"],Lottie=function t(s){var u,d,_,S=s.style,R=s.interactivity,a=_objectWithoutProperties(s,_excluded),k=useLottie(a,S),O=k.View,j=k.play,V=k.stop,G=k.pause,J=k.setSpeed,Z=k.goToAndStop,Y=k.goToAndPlay,le=k.setDirection,ee=k.playSegments,se=k.setSubframe,Q=k.getDuration,oe=k.destroy,_e=k.animationContainerRef,Se=k.animationLoaded,ke=k.animationItem;return reactExports.useEffect(function(){s.lottieRef&&(s.lottieRef.current={play:j,stop:V,pause:G,setSpeed:J,goToAndPlay:Y,goToAndStop:Z,setDirection:le,playSegments:ee,setSubframe:se,getDuration:Q,destroy:oe,animationContainerRef:_e,animationLoaded:Se,animationItem:ke})},[(u=s.lottieRef)===null||u===void 0?void 0:u.current]),useLottieInteractivity({lottieObj:{View:O,play:j,stop:V,pause:G,setSpeed:J,goToAndStop:Z,goToAndPlay:Y,setDirection:le,playSegments:ee,setSubframe:se,getDuration:Q,destroy:oe,animationContainerRef:_e,animationLoaded:Se,animationItem:ke},actions:(d=R==null?void 0:R.actions)!==null&&d!==void 0?d:[],mode:(_=R==null?void 0:R.mode)!==null&&_!==void 0?_:"scroll"})};const v$2="4.8.0",meta$1={g:"LottieFiles AE 3.6.0",a:"",k:"",d:"",tc:""},fr$2=60,ip$2=181,op$2=391,w$2=700,h$2=700,nm$2="Goodwin Loader 5",ddd$2=0,assets$2=[{id:"comp_0",layers:[{ddd:0,ind:1,ty:0,nm:"Goodwin Loader 4",refId:"comp_1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[540,250,0],ix:2},a:{a:0,k:[540,250,0],ix:1},s:{a:0,k:[100,-100,100],ix:6}},ao:0,w:1080,h:500,ip:245,op:490,st:245,bm:0},{ddd:0,ind:2,ty:0,nm:"Goodwin Loader 4",refId:"comp_1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[540,250,0],ix:2},a:{a:0,k:[540,250,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,w:1080,h:500,ip:0,op:245,st:0,bm:0}]},{id:"comp_1",layers:[{ddd:0,ind:1,ty:0,nm:"Main Star",refId:"comp_2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[540,250,0],ix:2},a:{a:0,k:[150,150,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,w:300,h:300,ip:0,op:245,st:-9,bm:0},{ddd:0,ind:2,ty:0,nm:"Main Star",parent:12,refId:"comp_2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{s:!0,x:{a:1,k:[{i:{x:[.453],y:[1]},o:{x:[.314],y:[0]},t:0,s:[8]},{i:{x:[.583],y:[1]},o:{x:[.167],y:[0]},t:50,s:[-192]},{i:{x:[.749],y:[1]},o:{x:[.477],y:[0]},t:194,s:[-192]},{t:214,s:[8]}],ix:3},y:{a:0,k:-10,ix:4}},a:{a:0,k:[150,150,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,w:300,h:300,ip:0,op:245,st:0,bm:0},{ddd:0,ind:3,ty:0,nm:"Main Star",parent:11,refId:"comp_2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{s:!0,x:{a:1,k:[{i:{x:[.453],y:[1]},o:{x:[.314],y:[0]},t:0,s:[8]},{i:{x:[.583],y:[1]},o:{x:[.167],y:[0]},t:50,s:[208]},{i:{x:[.749],y:[1]},o:{x:[.477],y:[0]},t:194,s:[208]},{t:214,s:[8]}],ix:3},y:{a:0,k:-10,ix:4}},a:{a:0,k:[150,150,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,w:300,h:300,ip:0,op:245,st:0,bm:0},{ddd:0,ind:11,ty:3,nm:"Rotate 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.493],y:[0]},t:31,s:[0]},{t:191,s:[-180],h:1}],ix:10},p:{a:0,k:[540,250,0],ix:2},a:{a:0,k:[8,-10,0],ix:1},s:{a:1,k:[{i:{x:[.221,.221,.667],y:[1,1,1]},o:{x:[1,1,.333],y:[0,0,0]},t:31,s:[100,100,100]},{i:{x:[.385,.385,.667],y:[1,1,1]},o:{x:[.504,.504,.333],y:[0,0,0]},t:108.104,s:[63,63,100]},{t:203,s:[100,100,100],h:1}],ix:6}},ao:0,ip:0,op:245,st:0,bm:0},{ddd:0,ind:12,ty:3,nm:"Rotate",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.493],y:[0]},t:31,s:[0]},{t:190.998046875,s:[180],h:1}],ix:10},p:{a:0,k:[540,250,0],ix:2},a:{a:0,k:[8,-10,0],ix:1},s:{a:1,k:[{i:{x:[.221,.221,.667],y:[1,1,1]},o:{x:[1,1,.333],y:[0,0,0]},t:31,s:[100,100,100]},{i:{x:[.385,.385,.667],y:[1,1,1]},o:{x:[.504,.504,.333],y:[0,0,0]},t:108.104,s:[63,63,100]},{t:203,s:[100,100,100],h:1}],ix:6}},ao:0,ip:0,op:245,st:0,bm:0}]},{id:"comp_2",layers:[{ddd:0,ind:2,ty:4,nm:"Main Star",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.447],y:[1]},o:{x:[.571],y:[0]},t:15,s:[-180]},{i:{x:[.456],y:[1]},o:{x:[.53],y:[0]},t:107.469,s:[0]},{t:219,s:[180]}],ix:10},p:{s:!0,x:{a:0,k:150.283,ix:3},y:{a:0,k:150,ix:4}},a:{a:0,k:[162.667,191.667,0],ix:1},s:{a:1,k:[{i:{x:[.22,.22,.667],y:[1,1,1]},o:{x:[.659,.659,.333],y:[0,0,0]},t:10,s:[100,100,100]},{i:{x:[.333,.333,.667],y:[1,1,1]},o:{x:[.577,.577,.333],y:[0,0,0]},t:53,s:[80,80,100]},{i:{x:[.342,.342,.667],y:[1,1,1]},o:{x:[.571,.571,.333],y:[0,0,0]},t:108,s:[130,130,100]},{i:{x:[.358,.358,.667],y:[1,1,1]},o:{x:[.559,.559,.333],y:[0,0,0]},t:164.531,s:[80,80,100]},{t:225,s:[100,100,100]}],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-12.343,29.44],[-29.44,-12.343],[12.343,-29.44],[29.44,12.343]],o:[[12.343,29.363],[-29.363,12.343],[-12.343,-29.363],[29.363,-12.343]],v:[[0,-97.167],[65.167,-32],[0,33.167],[-65.167,-32]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:5,s:[.1848,.3687,.4752,1]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:108,s:[0,.5725,.8941,1]},{t:228,s:[.1848,.3687,.4752,1]}],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[162.667,223.667],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:920,st:0,bm:0}]}],layers$2=[{ddd:0,ind:1,ty:0,nm:"Sub star loaders",refId:"comp_0",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.559],y:[0]},t:0,s:[-180]},{i:{x:[.028],y:[1]},o:{x:[.333],y:[0]},t:78,s:[0]},{i:{x:[0],y:[1]},o:{x:[.559],y:[0]},t:227,s:[0]},{i:{x:[.362],y:[1]},o:{x:[.167],y:[0]},t:305,s:[-180]},{i:{x:[.205],y:[1]},o:{x:[.344],y:[0]},t:330,s:[-180]},{t:390,s:[-270]}],ix:10},p:{a:0,k:[350,350,0],ix:2},a:{a:0,k:[540,250,0],ix:1},s:{a:1,k:[{i:{x:[0,0,.667],y:[1,1,1]},o:{x:[.338,.338,.333],y:[0,0,0]},t:181,s:[250,250,100]},{i:{x:[.564,.564,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:221,s:[100,100,100]},{i:{x:[0,0,.667],y:[1,1,1]},o:{x:[.431,.431,.333],y:[0,0,0]},t:340,s:[100,100,100]},{t:380,s:[250,250,100]}],ix:6}},ao:0,tm:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:0,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:370,s:[8.133]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:1070,s:[8.133]},{t:1840,s:[30.667]}],ix:2},w:1080,h:500,ip:0,op:1840,st:0,bm:0}],markers$1=[],starloader={v:v$2,meta:meta$1,fr:fr$2,ip:ip$2,op:op$2,w:w$2,h:h$2,nm:nm$2,ddd:ddd$2,assets:assets$2,layers:layers$2,markers:markers$1},LayoutGroupContext=reactExports.createContext({});function useConstant(t){const s=reactExports.useRef(null);return s.current===null&&(s.current=t()),s.current}const isBrowser$1=typeof window<"u",useIsomorphicLayoutEffect$1=isBrowser$1?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(t,s){t.indexOf(s)===-1&&t.push(s)}function removeItem(t,s){const u=t.indexOf(s);u>-1&&t.splice(u,1)}const clamp$1=(t,s,u)=>u>s?s:u<t?t:u;let invariant=()=>{};const MotionGlobalConfig={},isNumericalString=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function isObject(t){return typeof t=="object"&&t!==null}const isZeroValueString=t=>/^0[^.\s]+$/u.test(t);function memo(t){let s;return()=>(s===void 0&&(s=t()),s)}const noop$1=t=>t,combineFunctions=(t,s)=>u=>s(t(u)),pipe=(...t)=>t.reduce(combineFunctions),progress=(t,s,u)=>{const d=s-t;return d===0?1:(u-t)/d};class SubscriptionManager{constructor(){this.subscriptions=[]}add(s){return addUniqueItem(this.subscriptions,s),()=>removeItem(this.subscriptions,s)}notify(s,u,d){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](s,u,d);else for(let S=0;S<_;S++){const R=this.subscriptions[S];R&&R(s,u,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=t=>t*1e3,millisecondsToSeconds=t=>t/1e3;function velocityPerSecond(t,s){return s?t*(1e3/s):0}const calcBezier=(t,s,u)=>(((1-3*u+3*s)*t+(3*u-6*s))*t+3*s)*t,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(t,s,u,d,_){let S,R,a=0;do R=s+(u-s)/2,S=calcBezier(R,d,_)-t,S>0?u=R:s=R;while(Math.abs(S)>subdivisionPrecision&&++a<subdivisionMaxIterations);return R}function cubicBezier(t,s,u,d){if(t===s&&u===d)return noop$1;const _=S=>binarySubdivide(S,0,1,t,u);return S=>S===0||S===1?S:calcBezier(_(S),s,d)}const mirrorEasing=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,reverseEasing=t=>s=>1-t(1-s),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=t=>(t*=2)<1?.5*backIn(t):.5*(2-Math.pow(2,-10*(t-1))),circIn=t=>1-Math.sin(Math.acos(t)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=t=>Array.isArray(t)&&typeof t[0]!="number",isBezierDefinition=t=>Array.isArray(t)&&typeof t[0]=="number",easingLookup={linear:noop$1,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=t=>typeof t=="string",easingDefinitionToFunction=t=>{if(isBezierDefinition(t)){invariant(t.length===4);const[s,u,d,_]=t;return cubicBezier(s,u,d,_)}else if(isValidEasing(t))return easingLookup[t];return t},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function createRenderStep(t,s){let u=new Set,d=new Set,_=!1,S=!1;const R=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function k(j){R.has(j)&&(O.schedule(j),t()),j(a)}const O={schedule:(j,V=!1,G=!1)=>{const Z=G&&_?u:d;return V&&R.add(j),Z.has(j)||Z.add(j),j},cancel:j=>{d.delete(j),R.delete(j)},process:j=>{if(a=j,_){S=!0;return}_=!0,[u,d]=[d,u],u.forEach(k),u.clear(),_=!1,S&&(S=!1,O.process(j))}};return O}const maxElapsed=40;function createRenderBatcher(t,s){let u=!1,d=!0;const _={delta:0,timestamp:0,isProcessing:!1},S=()=>u=!0,R=stepsOrder.reduce((Q,oe)=>(Q[oe]=createRenderStep(S),Q),{}),{setup:a,read:k,resolveKeyframes:O,preUpdate:j,update:V,preRender:G,render:J,postRender:Z}=R,Y=()=>{const Q=MotionGlobalConfig.useManualTiming?_.timestamp:performance.now();u=!1,MotionGlobalConfig.useManualTiming||(_.delta=d?1e3/60:Math.max(Math.min(Q-_.timestamp,maxElapsed),1)),_.timestamp=Q,_.isProcessing=!0,a.process(_),k.process(_),O.process(_),j.process(_),V.process(_),G.process(_),J.process(_),Z.process(_),_.isProcessing=!1,u&&s&&(d=!1,t(Y))},le=()=>{u=!0,d=!0,_.isProcessing||t(Y)};return{schedule:stepsOrder.reduce((Q,oe)=>{const _e=R[oe];return Q[oe]=(Se,ke=!1,Le=!1)=>(u||le(),_e.schedule(Se,ke,Le)),Q},{}),cancel:Q=>{for(let oe=0;oe<stepsOrder.length;oe++)R[stepsOrder[oe]].cancel(Q)},state:_,steps:R}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop$1,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:t=>{now=t,queueMicrotask(clearTime)}},checkStringStartsWith=t=>s=>typeof s=="string"&&s.startsWith(t),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=t=>startsAsVariableToken(t)?singleCssVariableRegex.test(t.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function containsCSSVariable(t){return typeof t!="string"?!1:t.split("/*")[0].includes("var(--")}const number={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},alpha={...number,transform:t=>clamp$1(0,1,t)},scale={...number,default:1},sanitize=t=>Math.round(t*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(t){return t==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(t,s)=>u=>!!(typeof u=="string"&&singleColorRegex.test(u)&&u.startsWith(t)||s&&!isNullish(u)&&Object.prototype.hasOwnProperty.call(u,s)),splitColor=(t,s,u)=>d=>{if(typeof d!="string")return d;const[_,S,R,a]=d.match(floatRegex);return{[t]:parseFloat(_),[s]:parseFloat(S),[u]:parseFloat(R),alpha:a!==void 0?parseFloat(a):1}},clampRgbUnit=t=>clamp$1(0,255,t),rgbUnit={...number,transform:t=>Math.round(clampRgbUnit(t))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:t,green:s,blue:u,alpha:d=1})=>"rgba("+rgbUnit.transform(t)+", "+rgbUnit.transform(s)+", "+rgbUnit.transform(u)+", "+sanitize(alpha.transform(d))+")"};function parseHex(t){let s="",u="",d="",_="";return t.length>5?(s=t.substring(1,3),u=t.substring(3,5),d=t.substring(5,7),_=t.substring(7,9)):(s=t.substring(1,2),u=t.substring(2,3),d=t.substring(3,4),_=t.substring(4,5),s+=s,u+=u,d+=d,_+=_),{red:parseInt(s,16),green:parseInt(u,16),blue:parseInt(d,16),alpha:_?parseInt(_,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:t=>percent.parse(t)/100,transform:t=>percent.transform(t*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:u,alpha:d=1})=>"hsla("+Math.round(t)+", "+percent.transform(sanitize(s))+", "+percent.transform(sanitize(u))+", "+sanitize(alpha.transform(d))+")"},color={test:t=>rgba.test(t)||hex.test(t)||hsla.test(t),parse:t=>rgba.test(t)?rgba.parse(t):hsla.test(t)?hsla.parse(t):hex.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?rgba.transform(t):hsla.transform(t),getAnimatableNone:t=>{const s=color.parse(t);return s.alpha=0,color.transform(s)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(t){var s,u;return isNaN(t)&&typeof t=="string"&&(((s=t.match(floatRegex))==null?void 0:s.length)||0)+(((u=t.match(colorRegex))==null?void 0:u.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(t){const s=t.toString(),u=[],d={color:[],number:[],var:[]},_=[];let S=0;const a=s.replace(complexRegex,k=>(color.test(k)?(d.color.push(S),_.push(COLOR_TOKEN),u.push(color.parse(k))):k.startsWith(VAR_FUNCTION_TOKEN)?(d.var.push(S),_.push(VAR_TOKEN),u.push(k)):(d.number.push(S),_.push(NUMBER_TOKEN),u.push(parseFloat(k))),++S,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:u,split:a,indexes:d,types:_}}function parseComplexValue(t){return analyseComplexValue(t).values}function createTransformer(t){const{split:s,types:u}=analyseComplexValue(t),d=s.length;return _=>{let S="";for(let R=0;R<d;R++)if(S+=s[R],_[R]!==void 0){const a=u[R];a===NUMBER_TOKEN?S+=sanitize(_[R]):a===COLOR_TOKEN?S+=color.transform(_[R]):S+=_[R]}return S}}const convertNumbersToZero=t=>typeof t=="number"?0:color.test(t)?color.getAnimatableNone(t):t;function getAnimatableNone$1(t){const s=parseComplexValue(t);return createTransformer(t)(s.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(t,s,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?t+(s-t)*6*u:u<1/2?s:u<2/3?t+(s-t)*(2/3-u)*6:t}function hslaToRgba({hue:t,saturation:s,lightness:u,alpha:d}){t/=360,s/=100,u/=100;let _=0,S=0,R=0;if(!s)_=S=R=u;else{const a=u<.5?u*(1+s):u+s-u*s,k=2*u-a;_=hueToRgb(k,a,t+1/3),S=hueToRgb(k,a,t),R=hueToRgb(k,a,t-1/3)}return{red:Math.round(_*255),green:Math.round(S*255),blue:Math.round(R*255),alpha:d}}function mixImmediate(t,s){return u=>u>0?s:t}const mixNumber$1=(t,s,u)=>t+(s-t)*u,mixLinearColor=(t,s,u)=>{const d=t*t,_=u*(s*s-d)+d;return _<0?0:Math.sqrt(_)},colorTypes=[hex,rgba,hsla],getColorType=t=>colorTypes.find(s=>s.test(t));function asRGBA(t){const s=getColorType(t);if(!s)return!1;let u=s.parse(t);return s===hsla&&(u=hslaToRgba(u)),u}const mixColor=(t,s)=>{const u=asRGBA(t),d=asRGBA(s);if(!u||!d)return mixImmediate(t,s);const _={...u};return S=>(_.red=mixLinearColor(u.red,d.red,S),_.green=mixLinearColor(u.green,d.green,S),_.blue=mixLinearColor(u.blue,d.blue,S),_.alpha=mixNumber$1(u.alpha,d.alpha,S),rgba.transform(_))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(t,s){return invisibleValues.has(t)?u=>u<=0?t:s:u=>u>=1?s:t}function mixNumber(t,s){return u=>mixNumber$1(t,s,u)}function getMixer(t){return typeof t=="number"?mixNumber:typeof t=="string"?isCSSVariableToken(t)?mixImmediate:color.test(t)?mixColor:mixComplex:Array.isArray(t)?mixArray:typeof t=="object"?color.test(t)?mixColor:mixObject:mixImmediate}function mixArray(t,s){const u=[...t],d=u.length,_=t.map((S,R)=>getMixer(S)(S,s[R]));return S=>{for(let R=0;R<d;R++)u[R]=_[R](S);return u}}function mixObject(t,s){const u={...t,...s},d={};for(const _ in u)t[_]!==void 0&&s[_]!==void 0&&(d[_]=getMixer(t[_])(t[_],s[_]));return _=>{for(const S in d)u[S]=d[S](_);return u}}function matchOrder(t,s){const u=[],d={color:0,var:0,number:0};for(let _=0;_<s.values.length;_++){const S=s.types[_],R=t.indexes[S][d[S]],a=t.values[R]??0;u[_]=a,d[S]++}return u}const mixComplex=(t,s)=>{const u=complex.createTransformer(s),d=analyseComplexValue(t),_=analyseComplexValue(s);return d.indexes.var.length===_.indexes.var.length&&d.indexes.color.length===_.indexes.color.length&&d.indexes.number.length>=_.indexes.number.length?invisibleValues.has(t)&&!_.values.length||invisibleValues.has(s)&&!d.values.length?mixVisibility(t,s):pipe(mixArray(matchOrder(d,_),_.values),u):mixImmediate(t,s)};function mix(t,s,u){return typeof t=="number"&&typeof s=="number"&&typeof u=="number"?mixNumber$1(t,s,u):getMixer(t)(t,s)}const frameloopDriver=t=>{const s=({timestamp:u})=>t(u);return{start:(u=!0)=>frame.update(s,u),stop:()=>cancelFrame(s),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(t,s,u=10)=>{let d="";const _=Math.max(Math.round(s/u),2);for(let S=0;S<_;S++)d+=Math.round(t(S/(_-1))*1e4)/1e4+", ";return`linear(${d.substring(0,d.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(t){let s=0;const u=50;let d=t.next(s);for(;!d.done&&s<maxGeneratorDuration;)s+=u,d=t.next(s);return s>=maxGeneratorDuration?1/0:s}function createGeneratorEasing(t,s=100,u){const d=u({...t,keyframes:[0,s]}),_=Math.min(calcGeneratorDuration(d),maxGeneratorDuration);return{type:"keyframes",ease:S=>d.next(_*S).value/s,duration:millisecondsToSeconds(_)}}const velocitySampleDuration=5;function calcGeneratorVelocity(t,s,u){const d=Math.max(s-velocitySampleDuration,0);return velocityPerSecond(u-t(d),s-d)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:t=springDefaults.duration,bounce:s=springDefaults.bounce,velocity:u=springDefaults.velocity,mass:d=springDefaults.mass}){let _,S,R=1-s;R=clamp$1(springDefaults.minDamping,springDefaults.maxDamping,R),t=clamp$1(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(t)),R<1?(_=O=>{const j=O*R,V=j*t,G=j-u,J=calcAngularFreq(O,R),Z=Math.exp(-V);return safeMin-G/J*Z},S=O=>{const V=O*R*t,G=V*u+u,J=Math.pow(R,2)*Math.pow(O,2)*t,Z=Math.exp(-V),Y=calcAngularFreq(Math.pow(O,2),R);return(-_(O)+safeMin>0?-1:1)*((G-J)*Z)/Y}):(_=O=>{const j=Math.exp(-O*t),V=(O-u)*t+1;return-safeMin+j*V},S=O=>{const j=Math.exp(-O*t),V=(u-O)*(t*t);return j*V});const a=5/t,k=approximateRoot(_,S,a);if(t=secondsToMilliseconds(t),isNaN(k))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:t};{const O=Math.pow(k,2)*d;return{stiffness:O,damping:R*2*Math.sqrt(d*O),duration:t}}}const rootIterations=12;function approximateRoot(t,s,u){let d=u;for(let _=1;_<rootIterations;_++)d=d-t(d)/s(d);return d}function calcAngularFreq(t,s){return t*Math.sqrt(1-s*s)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(t,s){return s.some(u=>t[u]!==void 0)}function getSpringOptions(t){let s={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...t};if(!isSpringType(t,physicsKeys)&&isSpringType(t,durationKeys))if(t.visualDuration){const u=t.visualDuration,d=2*Math.PI/(u*1.2),_=d*d,S=2*clamp$1(.05,1,1-(t.bounce||0))*Math.sqrt(_);s={...s,mass:springDefaults.mass,stiffness:_,damping:S}}else{const u=findSpring(t);s={...s,...u,mass:springDefaults.mass},s.isResolvedFromDuration=!0}return s}function spring(t=springDefaults.visualDuration,s=springDefaults.bounce){const u=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:d,restDelta:_}=u;const S=u.keyframes[0],R=u.keyframes[u.keyframes.length-1],a={done:!1,value:S},{stiffness:k,damping:O,mass:j,duration:V,velocity:G,isResolvedFromDuration:J}=getSpringOptions({...u,velocity:-millisecondsToSeconds(u.velocity||0)}),Z=G||0,Y=O/(2*Math.sqrt(k*j)),le=R-S,ee=millisecondsToSeconds(Math.sqrt(k/j)),se=Math.abs(le)<5;d||(d=se?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),_||(_=se?springDefaults.restDelta.granular:springDefaults.restDelta.default);let Q;if(Y<1){const _e=calcAngularFreq(ee,Y);Q=Se=>{const ke=Math.exp(-Y*ee*Se);return R-ke*((Z+Y*ee*le)/_e*Math.sin(_e*Se)+le*Math.cos(_e*Se))}}else if(Y===1)Q=_e=>R-Math.exp(-ee*_e)*(le+(Z+ee*le)*_e);else{const _e=ee*Math.sqrt(Y*Y-1);Q=Se=>{const ke=Math.exp(-Y*ee*Se),Le=Math.min(_e*Se,300);return R-ke*((Z+Y*ee*le)*Math.sinh(Le)+_e*le*Math.cosh(Le))/_e}}const oe={calculatedDuration:J&&V||null,next:_e=>{const Se=Q(_e);if(J)a.done=_e>=V;else{let ke=_e===0?Z:0;Y<1&&(ke=_e===0?secondsToMilliseconds(Z):calcGeneratorVelocity(Q,_e,Se));const Le=Math.abs(ke)<=d,lt=Math.abs(R-Se)<=_;a.done=Le&&lt}return a.value=a.done?R:Se,a},toString:()=>{const _e=Math.min(calcGeneratorDuration(oe),maxGeneratorDuration),Se=generateLinearEasing(ke=>oe.next(_e*ke).value,_e,30);return _e+"ms "+Se},toTransition:()=>{}};return oe}spring.applyToOptions=t=>{const s=createGeneratorEasing(t,100,spring);return t.ease=s.ease,t.duration=secondsToMilliseconds(s.duration),t.type="keyframes",t};function inertia({keyframes:t,velocity:s=0,power:u=.8,timeConstant:d=325,bounceDamping:_=10,bounceStiffness:S=500,modifyTarget:R,min:a,max:k,restDelta:O=.5,restSpeed:j}){const V=t[0],G={done:!1,value:V},J=Le=>a!==void 0&&Le<a||k!==void 0&&Le>k,Z=Le=>a===void 0?k:k===void 0||Math.abs(a-Le)<Math.abs(k-Le)?a:k;let Y=u*s;const le=V+Y,ee=R===void 0?le:R(le);ee!==le&&(Y=ee-V);const se=Le=>-Y*Math.exp(-Le/d),Q=Le=>ee+se(Le),oe=Le=>{const lt=se(Le),qt=Q(Le);G.done=Math.abs(lt)<=O,G.value=G.done?ee:qt};let _e,Se;const ke=Le=>{J(G.value)&&(_e=Le,Se=spring({keyframes:[G.value,Z(G.value)],velocity:calcGeneratorVelocity(Q,Le,G.value),damping:_,stiffness:S,restDelta:O,restSpeed:j}))};return ke(0),{calculatedDuration:null,next:Le=>{let lt=!1;return!Se&&_e===void 0&&(lt=!0,oe(Le),ke(Le)),_e!==void 0&&Le>=_e?Se.next(Le-_e):(!lt&&oe(Le),G)}}}function createMixers(t,s,u){const d=[],_=u||MotionGlobalConfig.mix||mix,S=t.length-1;for(let R=0;R<S;R++){let a=_(t[R],t[R+1]);if(s){const k=Array.isArray(s)?s[R]||noop$1:s;a=pipe(k,a)}d.push(a)}return d}function interpolate(t,s,{clamp:u=!0,ease:d,mixer:_}={}){const S=t.length;if(invariant(S===s.length),S===1)return()=>s[0];if(S===2&&s[0]===s[1])return()=>s[1];const R=t[0]===t[1];t[0]>t[S-1]&&(t=[...t].reverse(),s=[...s].reverse());const a=createMixers(s,d,_),k=a.length,O=j=>{if(R&&j<t[0])return s[0];let V=0;if(k>1)for(;V<t.length-2&&!(j<t[V+1]);V++);const G=progress(t[V],t[V+1],j);return a[V](G)};return u?j=>O(clamp$1(t[0],t[S-1],j)):O}function fillOffset(t,s){const u=t[t.length-1];for(let d=1;d<=s;d++){const _=progress(0,s,d);t.push(mixNumber$1(u,1,_))}}function defaultOffset(t){const s=[0];return fillOffset(s,t.length-1),s}function convertOffsetToTimes(t,s){return t.map(u=>u*s)}function defaultEasing(t,s){return t.map(()=>s||easeInOut).splice(0,t.length-1)}function keyframes({duration:t=300,keyframes:s,times:u,ease:d="easeInOut"}){const _=isEasingArray(d)?d.map(easingDefinitionToFunction):easingDefinitionToFunction(d),S={done:!1,value:s[0]},R=convertOffsetToTimes(u&&u.length===s.length?u:defaultOffset(s),t),a=interpolate(R,s,{ease:Array.isArray(_)?_:defaultEasing(s,_)});return{calculatedDuration:t,next:k=>(S.value=a(k),S.done=k>=t,S)}}const isNotNull$2=t=>t!==null;function getFinalKeyframe$1(t,{repeat:s,repeatType:u="loop"},d,_=1){const S=t.filter(isNotNull$2),a=_<0||s&&u!=="loop"&&s%2===1?0:S.length-1;return!a||d===void 0?S[a]:d}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(t){typeof t.type=="string"&&(t.type=transitionTypeMap[t.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,u){return this.finished.then(s,u)}}const percentToProgress=t=>t/100;class JSAnimation extends WithPromise{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var d,_;const{motionValue:u}=this.options;u&&u.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(_=(d=this.options).onStop)==null||_.call(d))},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;replaceTransitionType(s);const{type:u=keyframes,repeat:d=0,repeatDelay:_=0,repeatType:S,velocity:R=0}=s;let{keyframes:a}=s;const k=u||keyframes;k!==keyframes&&typeof a[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(a[0],a[1])),a=[0,100]);const O=k({...s,keyframes:a});S==="mirror"&&(this.mirroredGenerator=k({...s,keyframes:[...a].reverse(),velocity:-R})),O.calculatedDuration===null&&(O.calculatedDuration=calcGeneratorDuration(O));const{calculatedDuration:j}=O;this.calculatedDuration=j,this.resolvedDuration=j+_,this.totalDuration=this.resolvedDuration*(d+1)-_,this.generator=O}updateTime(s){const u=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=u}tick(s,u=!1){const{generator:d,totalDuration:_,mixKeyframes:S,mirroredGenerator:R,resolvedDuration:a,calculatedDuration:k}=this;if(this.startTime===null)return d.next(0);const{delay:O=0,keyframes:j,repeat:V,repeatType:G,repeatDelay:J,type:Z,onUpdate:Y,finalKeyframe:le}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-_/this.speed,this.startTime)),u?this.currentTime=s:this.updateTime(s);const ee=this.currentTime-O*(this.playbackSpeed>=0?1:-1),se=this.playbackSpeed>=0?ee<0:ee>_;this.currentTime=Math.max(ee,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=_);let Q=this.currentTime,oe=d;if(V){const Le=Math.min(this.currentTime,_)/a;let lt=Math.floor(Le),qt=Le%1;!qt&&Le>=1&&(qt=1),qt===1&&lt--,lt=Math.min(lt,V+1),!!(lt%2)&&(G==="reverse"?(qt=1-qt,J&&(qt-=J/a)):G==="mirror"&&(oe=R)),Q=clamp$1(0,1,qt)*a}const _e=se?{done:!1,value:j[0]}:oe.next(Q);S&&(_e.value=S(_e.value));let{done:Se}=_e;!se&&k!==null&&(Se=this.playbackSpeed>=0?this.currentTime>=_:this.currentTime<=0);const ke=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Se);return ke&&Z!==inertia&&(_e.value=getFinalKeyframe$1(j,this.options,le,this.speed)),Y&&Y(_e.value),ke&&this.finish(),_e}then(s,u){return this.finished.then(s,u)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+millisecondsToSeconds(s)}get time(){return millisecondsToSeconds(this.currentTime)}set time(s){var u;s=secondsToMilliseconds(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),(u=this.driver)==null||u.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(time.now());const u=this.playbackSpeed!==s;this.playbackSpeed=s,u&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var _,S;if(this.isStopped)return;const{driver:s=frameloopDriver,startTime:u}=this.options;this.driver||(this.driver=s(R=>this.tick(R))),(S=(_=this.options).onPlay)==null||S.call(_);const d=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=d):this.holdTime!==null?this.startTime=d-this.holdTime:this.startTime||(this.startTime=u??d),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var s,u;this.notifyFinished(),this.teardown(),this.state="finished",(u=(s=this.options).onComplete)==null||u.call(s)}cancel(){var s,u;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(u=(s=this.options).onCancel)==null||u.call(s)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){var u;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(u=this.driver)==null||u.stop(),s.observe(this)}}function fillWildcards(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const radToDeg=t=>t*180/Math.PI,rotate=t=>{const s=radToDeg(Math.atan2(t[1],t[0]));return rebaseAngle(s)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate,rotateZ:rotate,skewX:t=>radToDeg(Math.atan(t[1])),skewY:t=>radToDeg(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},rebaseAngle=t=>(t=t%360,t<0&&(t+=360),t),rotateZ=rotate,scaleX=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),scaleY=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:t=>(scaleX(t)+scaleY(t))/2,rotateX:t=>rebaseAngle(radToDeg(Math.atan2(t[6],t[5]))),rotateY:t=>rebaseAngle(radToDeg(Math.atan2(-t[2],t[0]))),rotateZ,rotate:rotateZ,skewX:t=>radToDeg(Math.atan(t[4])),skewY:t=>radToDeg(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function defaultTransformValue(t){return t.includes("scale")?1:0}function parseValueFromTransform(t,s){if(!t||t==="none")return defaultTransformValue(s);const u=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let d,_;if(u)d=matrix3dParsers,_=u;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);d=matrix2dParsers,_=a}if(!_)return defaultTransformValue(s);const S=d[s],R=_[1].split(",").map(convertTransformToNumber);return typeof S=="function"?S(R):R[S]}const readTransformValue=(t,s)=>{const{transform:u="none"}=getComputedStyle(t);return parseValueFromTransform(u,s)};function convertTransformToNumber(t){return parseFloat(t.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=t=>t===number||t===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(t=>!transformKeys.has(t));function removeNonTranslationalTransform(t){const s=[];return nonTranslationalTransformKeys.forEach(u=>{const d=t.getValue(u);d!==void 0&&(s.push([u,d.get()]),d.set(u.startsWith("scale")?1:0))}),s}const positionalValues={width:({x:t},{paddingLeft:s="0",paddingRight:u="0"})=>t.max-t.min-parseFloat(s)-parseFloat(u),height:({y:t},{paddingTop:s="0",paddingBottom:u="0"})=>t.max-t.min-parseFloat(s)-parseFloat(u),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>parseValueFromTransform(s,"x"),y:(t,{transform:s})=>parseValueFromTransform(s,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const t=Array.from(toResolve).filter(d=>d.needsMeasurement),s=new Set(t.map(d=>d.element)),u=new Map;s.forEach(d=>{const _=removeNonTranslationalTransform(d);_.length&&(u.set(d,_),d.render())}),t.forEach(d=>d.measureInitialState()),s.forEach(d=>{d.render();const _=u.get(d);_&&_.forEach(([S,R])=>{var a;(a=d.getValue(S))==null||a.set(R)})}),t.forEach(d=>d.measureEndState()),t.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(t=>t.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(s,u,d,_,S,R=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=u,this.name=d,this.motionValue=_,this.element=S,this.isAsync=R}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:u,element:d,motionValue:_}=this;if(s[0]===null){const S=_==null?void 0:_.get(),R=s[s.length-1];if(S!==void 0)s[0]=S;else if(d&&u){const a=d.readValue(u,R);a!=null&&(s[0]=a)}s[0]===void 0&&(s[0]=R),_&&S===void 0&&_.set(s[0])}fillWildcards(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=t=>t.startsWith("--");function setStyle(t,s,u){isCSSVar(s)?t.style.setProperty(s,u):t.style[s]=u}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(t,s){const u=memo(t);return()=>supportsFlags[s]??u()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([t,s,u,d])=>`cubic-bezier(${t}, ${s}, ${u}, ${d})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(t,s){if(t)return typeof t=="function"?supportsLinearEasing()?generateLinearEasing(t,s):"ease-out":isBezierDefinition(t)?cubicBezierAsString(t):Array.isArray(t)?t.map(u=>mapEasingToNativeEasing(u,s)||supportedWaapiEasing.easeOut):supportedWaapiEasing[t]}function startWaapiAnimation(t,s,u,{delay:d=0,duration:_=300,repeat:S=0,repeatType:R="loop",ease:a="easeOut",times:k}={},O=void 0){const j={[s]:u};k&&(j.offset=k);const V=mapEasingToNativeEasing(a,_);Array.isArray(V)&&(j.easing=V);const G={delay:d,duration:_,easing:Array.isArray(V)?"linear":V,fill:"both",iterations:S+1,direction:R==="reverse"?"alternate":"normal"};return O&&(G.pseudoElement=O),t.animate(j,G)}function isGenerator(t){return typeof t=="function"&&"applyToOptions"in t}function applyGeneratorOptions({type:t,...s}){return isGenerator(t)&&supportsLinearEasing()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class NativeAnimation extends WithPromise{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!s)return;const{element:u,name:d,keyframes:_,pseudoElement:S,allowFlatten:R=!1,finalKeyframe:a,onComplete:k}=s;this.isPseudoElement=!!S,this.allowFlatten=R,this.options=s,invariant(typeof s.type!="string");const O=applyGeneratorOptions(s);this.animation=startWaapiAnimation(u,d,_,O,S),O.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!S){const j=getFinalKeyframe$1(_,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(j):setStyle(u,d,j),this.animation.cancel()}k==null||k(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var s,u;(u=(s=this.animation).finish)==null||u.call(s)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var u,d,_;const s=(u=this.options)==null?void 0:u.element;!this.isPseudoElement&&(s!=null&&s.isConnected)&&((_=(d=this.animation).commitStyles)==null||_.call(d))}get duration(){var u,d;const s=((d=(u=this.animation.effect)==null?void 0:u.getComputedTiming)==null?void 0:d.call(u).duration)||0;return millisecondsToSeconds(Number(s))}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+millisecondsToSeconds(s)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(s){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(s){this.manualStartTime=this.animation.startTime=s}attachTimeline({timeline:s,observe:u}){var d;return this.allowFlatten&&((d=this.animation.effect)==null||d.updateTiming({easing:"linear"})),this.animation.onfinish=null,s&&supportsScrollTimeline()?(this.animation.timeline=s,noop$1):u(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(t){return t in unsupportedEasingFunctions}function replaceStringEasing(t){typeof t.ease=="string"&&isUnsupportedEase(t.ease)&&(t.ease=unsupportedEasingFunctions[t.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(s){replaceStringEasing(s),replaceTransitionType(s),super(s),s.startTime!==void 0&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:u,onUpdate:d,onComplete:_,element:S,...R}=this.options;if(!u)return;if(s!==void 0){u.set(s);return}const a=new JSAnimation({...R,autoplay:!1}),k=Math.max(sampleDelta,time.now()-this.startTime),O=clamp$1(0,sampleDelta,k-sampleDelta);u.setWithVelocity(a.sample(Math.max(0,k-O)).value,a.sample(k).value,O),a.stop()}}const isAnimatable=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(complex.test(t)||t==="0")&&!t.startsWith("url("));function hasKeyframesChanged(t){const s=t[0];if(t.length===1)return!0;for(let u=0;u<t.length;u++)if(t[u]!==s)return!0}function canAnimate(t,s,u,d){const _=t[0];if(_===null)return!1;if(s==="display"||s==="visibility")return!0;const S=t[t.length-1],R=isAnimatable(_,s),a=isAnimatable(S,s);return!R||!a?!1:hasKeyframesChanged(t)||(u==="spring"||isGenerator(u))&&d}function makeAnimationInstant(t){t.duration=0,t.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(t){var j;const{motionValue:s,name:u,repeatDelay:d,repeatType:_,damping:S,type:R}=t;if(!(((j=s==null?void 0:s.owner)==null?void 0:j.current)instanceof HTMLElement))return!1;const{onUpdate:k,transformTemplate:O}=s.owner.getProps();return supportsWaapi()&&u&&acceleratedValues.has(u)&&(u!=="transform"||!O)&&!k&&!d&&_!=="mirror"&&S!==0&&R!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:s=!0,delay:u=0,type:d="keyframes",repeat:_=0,repeatDelay:S=0,repeatType:R="loop",keyframes:a,name:k,motionValue:O,element:j,...V}){var Z;super(),this.stop=()=>{var Y,le;this._animation&&(this._animation.stop(),(Y=this.stopTimeline)==null||Y.call(this)),(le=this.keyframeResolver)==null||le.cancel()},this.createdAt=time.now();const G={autoplay:s,delay:u,type:d,repeat:_,repeatDelay:S,repeatType:R,name:k,motionValue:O,element:j,...V},J=(j==null?void 0:j.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new J(a,(Y,le,ee)=>this.onKeyframesResolved(Y,le,G,!ee),k,O,j),(Z=this.keyframeResolver)==null||Z.scheduleResolve()}onKeyframesResolved(s,u,d,_){var le,ee;this.keyframeResolver=void 0;const{name:S,type:R,velocity:a,delay:k,isHandoff:O,onUpdate:j}=d;this.resolvedAt=time.now(),canAnimate(s,S,R,a)||((MotionGlobalConfig.instantAnimations||!k)&&(j==null||j(getFinalKeyframe$1(s,d,u))),s[0]=s[s.length-1],makeAnimationInstant(d),d.repeat=0);const G={startTime:_?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:u,...d,keyframes:s},J=!O&&supportsBrowserAnimation(G),Z=(ee=(le=G.motionValue)==null?void 0:le.owner)==null?void 0:ee.current,Y=J?new NativeAnimationExtended({...G,element:Z}):new JSAnimation(G);Y.finished.then(()=>{this.notifyFinished()}).catch(noop$1),this.pendingTimeline&&(this.stopTimeline=Y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Y}get finished(){return this._animation?this.animation.finished:this._finished}then(s,u){return this.finished.finally(s).then(()=>{})}get animation(){var s;return this._animation||((s=this.keyframeResolver)==null||s.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var s;this._animation&&this.animation.cancel(),(s=this.keyframeResolver)==null||s.cancel()}}function calcChildStagger(t,s,u,d=0,_=1){const S=Array.from(t).sort((O,j)=>O.sortNodePosition(j)).indexOf(s),R=t.size,a=(R-1)*d;return typeof u=="function"?u(S,R):_===1?S*d:a-S*d}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(t){const s=splitCSSVariableRegex.exec(t);if(!s)return[,];const[,u,d,_]=s;return[`--${u??d}`,_]}function getVariableValue(t,s,u=1){const[d,_]=parseCSSVariable(t);if(!d)return;const S=window.getComputedStyle(s).getPropertyValue(d);if(S){const R=S.trim();return isNumericalString(R)?parseFloat(R):R}return isCSSVariableToken(_)?getVariableValue(_,s,u+1):_}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(t,{keyframes:s})=>s.length>2?keyframesTransition:transformProps.has(t)?t.startsWith("scale")?criticallyDampedSpring(s[1]):underDampedSpring:ease,isNotNull$1=t=>t!==null;function getFinalKeyframe(t,{repeat:s,repeatType:u="loop"},d){const _=t.filter(isNotNull$1),S=s&&u!=="loop"&&s%2===1?0:_.length-1;return _[S]}function resolveTransition(t,s){if(t!=null&&t.inherit&&s){const{inherit:u,...d}=t;return{...s,...d}}return t}function getValueTransition(t,s){const u=(t==null?void 0:t[s])??(t==null?void 0:t.default)??t;return u!==t?resolveTransition(u,t):u}function isTransitionDefined({when:t,delay:s,delayChildren:u,staggerChildren:d,staggerDirection:_,repeat:S,repeatType:R,repeatDelay:a,from:k,elapsed:O,...j}){return!!Object.keys(j).length}const animateMotionValue=(t,s,u,d={},_,S)=>R=>{const a=getValueTransition(d,t)||{},k=a.delay||d.delay||0;let{elapsed:O=0}=d;O=O-secondsToMilliseconds(k);const j={keyframes:Array.isArray(u)?u:[null,u],ease:"easeOut",velocity:s.getVelocity(),...a,delay:-O,onUpdate:G=>{s.set(G),a.onUpdate&&a.onUpdate(G)},onComplete:()=>{R(),a.onComplete&&a.onComplete()},name:t,motionValue:s,element:S?void 0:_};isTransitionDefined(a)||Object.assign(j,getDefaultTransition(t,j)),j.duration&&(j.duration=secondsToMilliseconds(j.duration)),j.repeatDelay&&(j.repeatDelay=secondsToMilliseconds(j.repeatDelay)),j.from!==void 0&&(j.keyframes[0]=j.from);let V=!1;if((j.type===!1||j.duration===0&&!j.repeatDelay)&&(makeAnimationInstant(j),j.delay===0&&(V=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations||_!=null&&_.shouldSkipAnimations)&&(V=!0,makeAnimationInstant(j),j.delay=0),j.allowFlatten=!a.type&&!a.ease,V&&!S&&s.get()!==void 0){const G=getFinalKeyframe(j.keyframes,a);if(G!==void 0){frame.update(()=>{j.onUpdate(G),j.onComplete()});return}}return a.isSync?new JSAnimation(j):new AsyncMotionValueAnimation(j)};function getValueState(t){const s=[{},{}];return t==null||t.values.forEach((u,d)=>{s[0][d]=u.get(),s[1][d]=u.getVelocity()}),s}function resolveVariantFromProps(t,s,u,d){if(typeof s=="function"){const[_,S]=getValueState(d);s=s(u!==void 0?u:t.custom,_,S)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[_,S]=getValueState(d);s=s(u!==void 0?u:t.custom,_,S)}return s}function resolveVariant(t,s,u){const d=t.getProps();return resolveVariantFromProps(d,s,u!==void 0?u:d.custom,t)}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),MAX_VELOCITY_DELTA=30,isFloat=t=>!isNaN(parseFloat(t));class MotionValue{constructor(s,u={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=d=>{var S;const _=time.now();if(this.updatedAt!==_&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&((S=this.events.change)==null||S.notify(this.current),this.dependents))for(const R of this.dependents)R.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=u.owner}setCurrent(s){this.current=s,this.updatedAt=time.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,u){this.events[s]||(this.events[s]=new SubscriptionManager);const d=this.events[s].add(u);return s==="change"?()=>{d(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,u){this.passiveEffect=s,this.stopPassiveEffect=u}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,u,d){this.set(u),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-d}jump(s,u=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,u&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var s;(s=this.events.change)==null||s.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const u=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),u)}start(s){return this.stop(),new Promise(u=>{this.hasAnimated=!0,this.animation=s(u),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var s,u;(s=this.dependents)==null||s.clear(),(u=this.events.destroy)==null||u.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(t,s){return new MotionValue(t,s)}const isKeyframesTarget=t=>Array.isArray(t);function setMotionValue(t,s,u){t.hasValue(s)?t.getValue(s).set(u):t.addValue(s,motionValue(u))}function resolveFinalValueInKeyframes(t){return isKeyframesTarget(t)?t[t.length-1]||0:t}function setTarget(t,s){const u=resolveVariant(t,s);let{transitionEnd:d={},transition:_={},...S}=u||{};S={...S,...d};for(const R in S){const a=resolveFinalValueInKeyframes(S[R]);setMotionValue(t,R,a)}}const isMotionValue=t=>!!(t&&t.getVelocity);function isWillChangeMotionValue(t){return!!(isMotionValue(t)&&t.add)}function addValueToWillChange(t,s){const u=t.getValue("willChange");if(isWillChangeMotionValue(u))return u.add(s);if(!u&&MotionGlobalConfig.WillChange){const d=new MotionGlobalConfig.WillChange("auto");t.addValue("willChange",d),d.add(s)}}function camelToDash(t){return t.replace(/([A-Z])/g,s=>`-${s.toLowerCase()}`)}const optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId);function getOptimisedAppearId(t){return t.props[optimizedAppearDataAttribute]}function shouldBlockAnimation({protectedKeys:t,needsAnimating:s},u){const d=t.hasOwnProperty(u)&&s[u]!==!0;return s[u]=!1,d}function animateTarget(t,s,{delay:u=0,transitionOverride:d,type:_}={}){let{transition:S,transitionEnd:R,...a}=s;const k=t.getDefaultTransition();S=S?resolveTransition(S,k):k;const O=S==null?void 0:S.reduceMotion;d&&(S=d);const j=[],V=_&&t.animationState&&t.animationState.getState()[_];for(const G in a){const J=t.getValue(G,t.latestValues[G]??null),Z=a[G];if(Z===void 0||V&&shouldBlockAnimation(V,G))continue;const Y={delay:u,...getValueTransition(S||{},G)},le=J.get();if(le!==void 0&&!J.isAnimating&&!Array.isArray(Z)&&Z===le&&!Y.velocity)continue;let ee=!1;if(window.MotionHandoffAnimation){const oe=getOptimisedAppearId(t);if(oe){const _e=window.MotionHandoffAnimation(oe,G,frame);_e!==null&&(Y.startTime=_e,ee=!0)}}addValueToWillChange(t,G);const se=O??t.shouldReduceMotion;J.start(animateMotionValue(G,J,Z,se&&positionalKeys.has(G)?{type:!1}:Y,t,ee));const Q=J.animation;Q&&j.push(Q)}if(R){const G=()=>frame.update(()=>{R&&setTarget(t,R)});j.length?Promise.all(j).then(G):G()}return j}function animateVariant(t,s,u={}){var k;const d=resolveVariant(t,s,u.type==="exit"?(k=t.presenceContext)==null?void 0:k.custom:void 0);let{transition:_=t.getDefaultTransition()||{}}=d||{};u.transitionOverride&&(_=u.transitionOverride);const S=d?()=>Promise.all(animateTarget(t,d,u)):()=>Promise.resolve(),R=t.variantChildren&&t.variantChildren.size?(O=0)=>{const{delayChildren:j=0,staggerChildren:V,staggerDirection:G}=_;return animateChildren(t,s,O,j,V,G,u)}:()=>Promise.resolve(),{when:a}=_;if(a){const[O,j]=a==="beforeChildren"?[S,R]:[R,S];return O().then(()=>j())}else return Promise.all([S(),R(u.delay)])}function animateChildren(t,s,u=0,d=0,_=0,S=1,R){const a=[];for(const k of t.variantChildren)k.notify("AnimationStart",s),a.push(animateVariant(k,s,{...R,delay:u+(typeof d=="function"?0:d)+calcChildStagger(t.variantChildren,k,d,_,S)}).then(()=>k.notify("AnimationComplete",s)));return Promise.all(a)}function animateVisualElement(t,s,u={}){t.notify("AnimationStart",s);let d;if(Array.isArray(s)){const _=s.map(S=>animateVariant(t,S,u));d=Promise.all(_)}else if(typeof s=="string")d=animateVariant(t,s,u);else{const _=typeof s=="function"?resolveVariant(t,s,u.custom):s;d=Promise.all(animateTarget(t,_,u))}return d.then(()=>{t.notify("AnimationComplete",s)})}const auto={test:t=>t==="auto",parse:t=>t},testValueType=t=>s=>s.test(t),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=t=>dimensionValueTypes.find(testValueType(t));function isNone(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||isZeroValueString(t):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(t){const[s,u]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[d]=u.match(floatRegex)||[];if(!d)return t;const _=u.replace(d,"");let S=maxDefaults.has(s)?1:0;return d!==u&&(S*=100),s+"("+S+_+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:t=>{const s=t.match(functionRegex);return s?s.map(applyDefaultFilter).join(" "):t}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,inset:px,insetBlock:px,insetBlockStart:px,insetBlockEnd:px,insetInline:px,insetInlineStart:px,insetInlineEnd:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,paddingBlock:px,paddingBlockStart:px,paddingBlockEnd:px,paddingInline:px,paddingInlineStart:px,paddingInlineEnd:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,marginBlock:px,marginBlockStart:px,marginBlockEnd:px,marginInline:px,marginInlineStart:px,marginInlineEnd:px,fontSize:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=t=>defaultValueTypes[t];function getAnimatableNone(t,s){let u=getDefaultValueType(t);return u!==filter&&(u=complex),u.getAnimatableNone?u.getAnimatableNone(s):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(t,s,u){let d=0,_;for(;d<t.length&&!_;){const S=t[d];typeof S=="string"&&!invalidTemplates.has(S)&&analyseComplexValue(S).values.length&&(_=t[d]),d++}if(_&&u)for(const S of s)t[S]=getAnimatableNone(u,_)}class DOMKeyframesResolver extends KeyframeResolver{constructor(s,u,d,_,S){super(s,u,d,_,S,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:u,name:d}=this;if(!u||!u.current)return;super.readKeyframes();for(let j=0;j<s.length;j++){let V=s[j];if(typeof V=="string"&&(V=V.trim(),isCSSVariableToken(V))){const G=getVariableValue(V,u.current);G!==void 0&&(s[j]=G),j===s.length-1&&(this.finalKeyframe=V)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(d)||s.length!==2)return;const[_,S]=s,R=findDimensionValueType(_),a=findDimensionValueType(S),k=containsCSSVariable(_),O=containsCSSVariable(S);if(k!==O&&positionalValues[d]){this.needsMeasurement=!0;return}if(R!==a)if(isNumOrPxType(R)&&isNumOrPxType(a))for(let j=0;j<s.length;j++){const V=s[j];typeof V=="string"&&(s[j]=parseFloat(V))}else positionalValues[d]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:u}=this,d=[];for(let _=0;_<s.length;_++)(s[_]===null||isNone(s[_]))&&d.push(_);d.length&&makeNoneKeyframesAnimatable(s,d,u)}measureInitialState(){const{element:s,unresolvedKeyframes:u,name:d}=this;if(!s||!s.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[d](s.measureViewportBox(),window.getComputedStyle(s.current)),u[0]=this.measuredOrigin;const _=u[u.length-1];_!==void 0&&s.getValue(d,_).jump(_,!1)}measureEndState(){var a;const{element:s,name:u,unresolvedKeyframes:d}=this;if(!s||!s.current)return;const _=s.getValue(u);_&&_.jump(this.measuredOrigin,!1);const S=d.length-1,R=d[S];d[S]=positionalValues[u](s.measureViewportBox(),window.getComputedStyle(s.current)),R!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=R),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([k,O])=>{s.getValue(k).set(O)}),this.resolveNoneKeyframes()}}function resolveElements(t,s,u){if(t==null)return[];if(t instanceof EventTarget)return[t];if(typeof t=="string"){let d=document;const _=(u==null?void 0:u[t])??d.querySelectorAll(t);return _?Array.from(_):[]}return Array.from(t).filter(d=>d!=null)}const getValueAsType=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function isHTMLElement$1(t){return isObject(t)&&"offsetHeight"in t}const{schedule:microtask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(t){return t==="x"||t==="y"?isDragging[t]?null:(isDragging[t]=!0,()=>{isDragging[t]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(t,s){const u=resolveElements(t),d=new AbortController,_={passive:!0,...s,signal:d.signal};return[u,_,()=>d.abort()]}function isValidHover(t){return!(t.pointerType==="touch"||isDragActive())}function hover(t,s,u={}){const[d,_,S]=setupGesture(t,u);return d.forEach(R=>{let a=!1,k=!1,O;const j=()=>{R.removeEventListener("pointerleave",Z)},V=le=>{O&&(O(le),O=void 0),j()},G=le=>{a=!1,window.removeEventListener("pointerup",G),window.removeEventListener("pointercancel",G),k&&(k=!1,V(le))},J=()=>{a=!0,window.addEventListener("pointerup",G,_),window.addEventListener("pointercancel",G,_)},Z=le=>{if(le.pointerType!=="touch"){if(a){k=!0;return}V(le)}},Y=le=>{if(!isValidHover(le))return;k=!1;const ee=s(R,le);typeof ee=="function"&&(O=ee,R.addEventListener("pointerleave",Z,_))};R.addEventListener("pointerenter",Y,_),R.addEventListener("pointerdown",J,_)}),S}const isNodeOrChild=(t,s)=>s?t===s?!0:isNodeOrChild(t,s.parentElement):!1,isPrimaryPointer=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,keyboardAccessibleElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(t){return keyboardAccessibleElements.has(t.tagName)||t.isContentEditable===!0}const textInputElements=new Set(["INPUT","SELECT","TEXTAREA"]);function isElementTextInput(t){return textInputElements.has(t.tagName)||t.isContentEditable===!0}const isPressing=new WeakSet;function filterEvents(t){return s=>{s.key==="Enter"&&t(s)}}function firePointerEvent(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(t,s)=>{const u=t.currentTarget;if(!u)return;const d=filterEvents(()=>{if(isPressing.has(u))return;firePointerEvent(u,"down");const _=filterEvents(()=>{firePointerEvent(u,"up")}),S=()=>firePointerEvent(u,"cancel");u.addEventListener("keyup",_,s),u.addEventListener("blur",S,s)});u.addEventListener("keydown",d,s),u.addEventListener("blur",()=>u.removeEventListener("keydown",d),s)};function isValidPressEvent(t){return isPrimaryPointer(t)&&!isDragActive()}const claimedPointerDownEvents=new WeakSet;function press(t,s,u={}){const[d,_,S]=setupGesture(t,u),R=a=>{const k=a.currentTarget;if(!isValidPressEvent(a)||claimedPointerDownEvents.has(a))return;isPressing.add(k),u.stopPropagation&&claimedPointerDownEvents.add(a);const O=s(k,a),j=(J,Z)=>{window.removeEventListener("pointerup",V),window.removeEventListener("pointercancel",G),isPressing.has(k)&&isPressing.delete(k),isValidPressEvent(J)&&typeof O=="function"&&O(J,{success:Z})},V=J=>{j(J,k===window||k===document||u.useGlobalTarget||isNodeOrChild(k,J.target))},G=J=>{j(J,!1)};window.addEventListener("pointerup",V,_),window.addEventListener("pointercancel",G,_)};return d.forEach(a=>{(u.useGlobalTarget?window:a).addEventListener("pointerdown",R,_),isHTMLElement$1(a)&&(a.addEventListener("focus",O=>enableKeyboardPress(O,_)),!isElementKeyboardAccessible(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),S}function isSVGElement(t){return isObject(t)&&"ownerSVGElement"in t}const resizeHandlers=new WeakMap;let observer;const getSize=(t,s,u)=>(d,_)=>_&&_[0]?_[0][t+"Size"]:isSVGElement(d)&&"getBBox"in d?d.getBBox()[s]:d[u],getWidth=getSize("inline","width","offsetWidth"),getHeight=getSize("block","height","offsetHeight");function notifyTarget({target:t,borderBoxSize:s}){var u;(u=resizeHandlers.get(t))==null||u.forEach(d=>{d(t,{get width(){return getWidth(t,s)},get height(){return getHeight(t,s)}})})}function notifyAll(t){t.forEach(notifyTarget)}function createResizeObserver(){typeof ResizeObserver>"u"||(observer=new ResizeObserver(notifyAll))}function resizeElement(t,s){observer||createResizeObserver();const u=resolveElements(t);return u.forEach(d=>{let _=resizeHandlers.get(d);_||(_=new Set,resizeHandlers.set(d,_)),_.add(s),observer==null||observer.observe(d)}),()=>{u.forEach(d=>{const _=resizeHandlers.get(d);_==null||_.delete(s),_!=null&&_.size||observer==null||observer.unobserve(d)})}}const windowCallbacks=new Set;let windowResizeHandler;function createWindowResizeHandler(){windowResizeHandler=()=>{const t={get width(){return window.innerWidth},get height(){return window.innerHeight}};windowCallbacks.forEach(s=>s(t))},window.addEventListener("resize",windowResizeHandler)}function resizeWindow(t){return windowCallbacks.add(t),windowResizeHandler||createWindowResizeHandler(),()=>{windowCallbacks.delete(t),!windowCallbacks.size&&typeof windowResizeHandler=="function"&&(window.removeEventListener("resize",windowResizeHandler),windowResizeHandler=void 0)}}function resize(t,s){return typeof t=="function"?resizeWindow(t):resizeElement(t,s)}function isSVGSVGElement(t){return isSVGElement(t)&&t.tagName==="svg"}const valueTypes=[...dimensionValueTypes,color,complex],findValueType=t=>valueTypes.find(testValueType(t)),createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1},isBrowser=typeof window<"u";function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>prefersReducedMotion.current=t.matches;t.addEventListener("change",s),s()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function isAnimationControls(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function isVariantLabel(t){return typeof t=="string"||Array.isArray(t)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(t){return isAnimationControls(t.animate)||variantProps.some(s=>isVariantLabel(t[s]))}function isVariantNode(t){return!!(isControllingVariants(t)||t.variants)}function updateMotionValuesFromProps(t,s,u){for(const d in s){const _=s[d],S=u[d];if(isMotionValue(_))t.addValue(d,_);else if(isMotionValue(S))t.addValue(d,motionValue(_,{owner:t}));else if(S!==_)if(t.hasValue(d)){const R=t.getValue(d);R.liveStyle===!0?R.jump(_):R.hasAnimated||R.set(_)}else{const R=t.getStaticValue(d);t.addValue(d,motionValue(R!==void 0?R:_,{owner:t}))}}for(const d in u)s[d]===void 0&&t.removeValue(d);return s}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let featureDefinitions={};function setFeatureDefinitions(t){featureDefinitions=t}function getFeatureDefinitions(){return featureDefinitions}class VisualElement{scrapeMotionValuesFromProps(s,u,d){return{}}constructor({parent:s,props:u,presenceContext:d,reducedMotionConfig:_,skipAnimations:S,blockInitialAnimation:R,visualState:a},k={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const J=time.now();this.renderScheduledAt<J&&(this.renderScheduledAt=J,frame.render(this.render,!1,!0))};const{latestValues:O,renderState:j}=a;this.latestValues=O,this.baseTarget={...O},this.initialValues=u.initial?{...O}:{},this.renderState=j,this.parent=s,this.props=u,this.presenceContext=d,this.depth=s?s.depth+1:0,this.reducedMotionConfig=_,this.skipAnimationsConfig=S,this.options=k,this.blockInitialAnimation=!!R,this.isControllingVariants=isControllingVariants(u),this.isVariantNode=isVariantNode(u),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:V,...G}=this.scrapeMotionValuesFromProps(u,{},this);for(const J in G){const Z=G[J];O[J]!==void 0&&isMotionValue(Z)&&Z.set(O[J])}}mount(s){var u,d;if(this.hasBeenMounted)for(const _ in this.initialValues)(u=this.values.get(_))==null||u.jump(this.initialValues[_]),this.latestValues[_]=this.initialValues[_];this.current=s,visualElementStore.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((_,S)=>this.bindToMotionValue(S,_)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=prefersReducedMotion.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(d=this.parent)==null||d.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var s;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(u=>u()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(s=this.parent)==null||s.removeChild(this);for(const u in this.events)this.events[u].clear();for(const u in this.features){const d=this.features[u];d&&(d.unmount(),d.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,u){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const d=transformProps.has(s);d&&this.onBindTransform&&this.onBindTransform();const _=u.on("change",R=>{this.latestValues[s]=R,this.props.onUpdate&&frame.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let S;typeof window<"u"&&window.MotionCheckAppearSync&&(S=window.MotionCheckAppearSync(this,s,u)),this.valueSubscriptions.set(s,()=>{_(),S&&S(),u.owner&&u.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in featureDefinitions){const u=featureDefinitions[s];if(!u)continue;const{isEnabled:d,Feature:_}=u;if(!this.features[s]&&_&&d(this.props)&&(this.features[s]=new _(this)),this.features[s]){const S=this.features[s];S.isMounted?S.update():(S.mount(),S.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,u){this.latestValues[s]=u}update(s,u){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=u;for(let d=0;d<propEventHandlers.length;d++){const _=propEventHandlers[d];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const S="on"+_,R=s[S];R&&(this.propEventSubscriptions[_]=this.on(_,R))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(s,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const u=this.getClosestVariantNode();if(u)return u.variantChildren&&u.variantChildren.add(s),()=>u.variantChildren.delete(s)}addValue(s,u){const d=this.values.get(s);u!==d&&(d&&this.removeValue(s),this.bindToMotionValue(s,u),this.values.set(s,u),this.latestValues[s]=u.get())}removeValue(s){this.values.delete(s);const u=this.valueSubscriptions.get(s);u&&(u(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,u){if(this.props.values&&this.props.values[s])return this.props.values[s];let d=this.values.get(s);return d===void 0&&u!==void 0&&(d=motionValue(u===null?void 0:u,{owner:this}),this.addValue(s,d)),d}readValue(s,u){let d=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return d!=null&&(typeof d=="string"&&(isNumericalString(d)||isZeroValueString(d))?d=parseFloat(d):!findValueType(d)&&complex.test(u)&&(d=getAnimatableNone(s,u)),this.setBaseTarget(s,isMotionValue(d)?d.get():d)),isMotionValue(d)?d.get():d}setBaseTarget(s,u){this.baseTarget[s]=u}getBaseTarget(s){var S;const{initial:u}=this.props;let d;if(typeof u=="string"||typeof u=="object"){const R=resolveVariantFromProps(this.props,u,(S=this.presenceContext)==null?void 0:S.custom);R&&(d=R[s])}if(u&&d!==void 0)return d;const _=this.getBaseTargetFromProps(this.props,s);return _!==void 0&&!isMotionValue(_)?_:this.initialValues[s]!==void 0&&d===void 0?void 0:this.baseTarget[s]}on(s,u){return this.events[s]||(this.events[s]=new SubscriptionManager),this.events[s].add(u)}notify(s,...u){this.events[s]&&this.events[s].notify(...u)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(s,u){return s.compareDocumentPosition(u)&2?1:-1}getBaseTargetFromProps(s,u){const d=s.style;return d?d[u]:void 0}removeValueFromRenderState(s,{vars:u,style:d}){delete u[s],delete d[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;isMotionValue(s)&&(this.childSubscription=s.on("change",u=>{this.current&&(this.current.textContent=`${u}`)}))}}class Feature{constructor(s){this.isMounted=!1,this.node=s}update(){}}function convertBoundingBoxToBox({top:t,left:s,right:u,bottom:d}){return{x:{min:s,max:u},y:{min:t,max:d}}}function convertBoxToBoundingBox({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function transformBoxPoints(t,s){if(!s)return t;const u=s({x:t.left,y:t.top}),d=s({x:t.right,y:t.bottom});return{top:u.y,left:u.x,bottom:d.y,right:d.x}}function isIdentityScale(t){return t===void 0||t===1}function hasScale({scale:t,scaleX:s,scaleY:u}){return!isIdentityScale(t)||!isIdentityScale(s)||!isIdentityScale(u)}function hasTransform(t){return hasScale(t)||has2DTranslate(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function has2DTranslate(t){return is2DTranslate(t.x)||is2DTranslate(t.y)}function is2DTranslate(t){return t&&t!=="0%"}function scalePoint(t,s,u){const d=t-u,_=s*d;return u+_}function applyPointDelta(t,s,u,d,_){return _!==void 0&&(t=scalePoint(t,_,d)),scalePoint(t,u,d)+s}function applyAxisDelta(t,s=0,u=1,d,_){t.min=applyPointDelta(t.min,s,u,d,_),t.max=applyPointDelta(t.max,s,u,d,_)}function applyBoxDelta(t,{x:s,y:u}){applyAxisDelta(t.x,s.translate,s.scale,s.originPoint),applyAxisDelta(t.y,u.translate,u.scale,u.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(t,s,u,d=!1){const _=u.length;if(!_)return;s.x=s.y=1;let S,R;for(let a=0;a<_;a++){S=u[a],R=S.projectionDelta;const{visualElement:k}=S.options;k&&k.props.style&&k.props.style.display==="contents"||(d&&S.options.layoutScroll&&S.scroll&&S!==S.root&&transformBox(t,{x:-S.scroll.offset.x,y:-S.scroll.offset.y}),R&&(s.x*=R.x.scale,s.y*=R.y.scale,applyBoxDelta(t,R)),d&&hasTransform(S.latestValues)&&transformBox(t,S.latestValues))}s.x<TREE_SCALE_SNAP_MAX&&s.x>TREE_SCALE_SNAP_MIN&&(s.x=1),s.y<TREE_SCALE_SNAP_MAX&&s.y>TREE_SCALE_SNAP_MIN&&(s.y=1)}function translateAxis(t,s){t.min=t.min+s,t.max=t.max+s}function transformAxis(t,s,u,d,_=.5){const S=mixNumber$1(t.min,t.max,_);applyAxisDelta(t,s,u,S,d)}function transformBox(t,s){transformAxis(t.x,s.x,s.scaleX,s.scale,s.originX),transformAxis(t.y,s.y,s.scaleY,s.scale,s.originY)}function measureViewportBox(t,s){return convertBoundingBoxToBox(transformBoxPoints(t.getBoundingClientRect(),s))}function measurePageBox(t,s,u){const d=measureViewportBox(t,u),{scroll:_}=s;return _&&(translateAxis(d.x,_.offset.x),translateAxis(d.y,_.offset.y)),d}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(t,s,u){let d="",_=!0;for(let S=0;S<numTransforms;S++){const R=transformPropOrder[S],a=t[R];if(a===void 0)continue;let k=!0;if(typeof a=="number")k=a===(R.startsWith("scale")?1:0);else{const O=parseFloat(a);k=R.startsWith("scale")?O===1:O===0}if(!k||u){const O=getValueAsType(a,numberValueTypes[R]);if(!k){_=!1;const j=translateAlias[R]||R;d+=`${j}(${O}) `}u&&(s[R]=O)}}return d=d.trim(),u?d=u(s,_?"":d):_&&(d="none"),d}function buildHTMLStyles(t,s,u){const{style:d,vars:_,transformOrigin:S}=t;let R=!1,a=!1;for(const k in s){const O=s[k];if(transformProps.has(k)){R=!0;continue}else if(isCSSVariableName(k)){_[k]=O;continue}else{const j=getValueAsType(O,numberValueTypes[k]);k.startsWith("origin")?(a=!0,S[k]=j):d[k]=j}}if(s.transform||(R||u?d.transform=buildTransform(s,t.transform,u):d.transform&&(d.transform="none")),a){const{originX:k="50%",originY:O="50%",originZ:j=0}=S;d.transformOrigin=`${k} ${O} ${j}`}}function renderHTML(t,{style:s,vars:u},d,_){const S=t.style;let R;for(R in s)S[R]=s[R];_==null||_.applyProjectionStyles(S,d);for(R in u)S.setProperty(R,u[R])}function pixelsToPercent(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const correctBorderRadius={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(px.test(t))t=parseFloat(t);else return t;const u=pixelsToPercent(t,s.target.x),d=pixelsToPercent(t,s.target.y);return`${u}% ${d}%`}},correctBoxShadow={correct:(t,{treeScale:s,projectionDelta:u})=>{const d=t,_=complex.parse(t);if(_.length>5)return d;const S=complex.createTransformer(t),R=typeof _[0]!="number"?1:0,a=u.x.scale*s.x,k=u.y.scale*s.y;_[0+R]/=a,_[1+R]/=k;const O=mixNumber$1(a,k,.5);return typeof _[2+R]=="number"&&(_[2+R]/=O),typeof _[3+R]=="number"&&(_[3+R]/=O),S(_)}},scaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function isForcedMotionValue(t,{layout:s,layoutId:u}){return transformProps.has(t)||t.startsWith("origin")||(s||u!==void 0)&&(!!scaleCorrectors[t]||t==="opacity")}function scrapeMotionValuesFromProps$1(t,s,u){var R;const d=t.style,_=s==null?void 0:s.style,S={};if(!d)return S;for(const a in d)(isMotionValue(d[a])||_&&isMotionValue(_[a])||isForcedMotionValue(a,t)||((R=u==null?void 0:u.getValue(a))==null?void 0:R.liveStyle)!==void 0)&&(S[a]=d[a]);return S}function getComputedStyle$2(t){return window.getComputedStyle(t)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(s,u){var d;if(transformProps.has(u))return(d=this.projection)!=null&&d.isProjecting?defaultTransformValue(u):readTransformValue(s,u);{const _=getComputedStyle$2(s),S=(isCSSVariableName(u)?_.getPropertyValue(u):_[u])||0;return typeof S=="string"?S.trim():S}}measureInstanceViewportBox(s,{transformPagePoint:u}){return measureViewportBox(s,u)}build(s,u,d){buildHTMLStyles(s,u,d.transformTemplate)}scrapeMotionValuesFromProps(s,u,d){return scrapeMotionValuesFromProps$1(s,u,d)}}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(t,s,u=1,d=0,_=!0){t.pathLength=1;const S=_?dashKeys:camelKeys;t[S.offset]=`${-d}`,t[S.array]=`${s} ${u}`}const cssMotionPathProperties=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function buildSVGAttrs(t,{attrX:s,attrY:u,attrScale:d,pathLength:_,pathSpacing:S=1,pathOffset:R=0,...a},k,O,j){if(buildHTMLStyles(t,a,O),k){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:V,style:G}=t;V.transform&&(G.transform=V.transform,delete V.transform),(G.transform||V.transformOrigin)&&(G.transformOrigin=V.transformOrigin??"50% 50%",delete V.transformOrigin),G.transform&&(G.transformBox=(j==null?void 0:j.transformBox)??"fill-box",delete V.transformBox);for(const J of cssMotionPathProperties)V[J]!==void 0&&(G[J]=V[J],delete V[J]);s!==void 0&&(V.x=s),u!==void 0&&(V.y=u),d!==void 0&&(V.scale=d),_!==void 0&&buildSVGPath(V,_,S,R,!1)}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),isSVGTag=t=>typeof t=="string"&&t.toLowerCase()==="svg";function renderSVG(t,s,u,d){renderHTML(t,s,void 0,d);for(const _ in s.attrs)t.setAttribute(camelCaseAttributes.has(_)?_:camelToDash(_),s.attrs[_])}function scrapeMotionValuesFromProps(t,s,u){const d=scrapeMotionValuesFromProps$1(t,s,u);for(const _ in t)if(isMotionValue(t[_])||isMotionValue(s[_])){const S=transformPropOrder.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;d[S]=t[_]}return d}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(s,u){return s[u]}readValueFromInstance(s,u){if(transformProps.has(u)){const d=getDefaultValueType(u);return d&&d.default||0}return u=camelCaseAttributes.has(u)?u:camelToDash(u),s.getAttribute(u)}scrapeMotionValuesFromProps(s,u,d){return scrapeMotionValuesFromProps(s,u,d)}build(s,u,d){buildSVGAttrs(s,u,this.isSVGTag,d.transformTemplate,d.style)}renderInstance(s,u,d,_){renderSVG(s,u,d,_)}mount(s){this.isSVGTag=isSVGTag(s.tagName),super.mount(s)}}const numVariantProps=variantProps.length;function getVariantContext(t){if(!t)return;if(!t.isControllingVariants){const u=t.parent?getVariantContext(t.parent)||{}:{};return t.props.initial!==void 0&&(u.initial=t.props.initial),u}const s={};for(let u=0;u<numVariantProps;u++){const d=variantProps[u],_=t.props[d];(isVariantLabel(_)||_===!1)&&(s[d]=_)}return s}function shallowCompare(t,s){if(!Array.isArray(s))return!1;const u=s.length;if(u!==t.length)return!1;for(let d=0;d<u;d++)if(s[d]!==t[d])return!1;return!0}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function createAnimateFunction(t){return s=>Promise.all(s.map(({animation:u,options:d})=>animateVisualElement(t,u,d)))}function createAnimationState(t){let s=createAnimateFunction(t),u=createState(),d=!0;const _=k=>(O,j)=>{var G;const V=resolveVariant(t,j,k==="exit"?(G=t.presenceContext)==null?void 0:G.custom:void 0);if(V){const{transition:J,transitionEnd:Z,...Y}=V;O={...O,...Y,...Z}}return O};function S(k){s=k(t)}function R(k){const{props:O}=t,j=getVariantContext(t.parent)||{},V=[],G=new Set;let J={},Z=1/0;for(let le=0;le<numAnimationTypes;le++){const ee=reversePriorityOrder[le],se=u[ee],Q=O[ee]!==void 0?O[ee]:j[ee],oe=isVariantLabel(Q),_e=ee===k?se.isActive:null;_e===!1&&(Z=le);let Se=Q===j[ee]&&Q!==O[ee]&&oe;if(Se&&d&&t.manuallyAnimateOnMount&&(Se=!1),se.protectedKeys={...J},!se.isActive&&_e===null||!Q&&!se.prevProp||isAnimationControls(Q)||typeof Q=="boolean")continue;const ke=checkVariantsDidChange(se.prevProp,Q);let Le=ke||ee===k&&se.isActive&&!Se&&oe||le>Z&&oe,lt=!1;const qt=Array.isArray(Q)?Q:[Q];let Yt=qt.reduce(_(ee),{});_e===!1&&(Yt={});const{prevResolvedValues:Ot={}}=se,Bt={...Ot,...Yt},si=Fe=>{Le=!0,G.has(Fe)&&(lt=!0,G.delete(Fe)),se.needsAnimating[Fe]=!0;const pe=t.getValue(Fe);pe&&(pe.liveStyle=!1)};for(const Fe in Bt){const pe=Yt[Fe],Te=Ot[Fe];if(J.hasOwnProperty(Fe))continue;let st=!1;isKeyframesTarget(pe)&&isKeyframesTarget(Te)?st=!shallowCompare(pe,Te):st=pe!==Te,st?pe!=null?si(Fe):G.add(Fe):pe!==void 0&&G.has(Fe)?si(Fe):se.protectedKeys[Fe]=!0}se.prevProp=Q,se.prevResolvedValues=Yt,se.isActive&&(J={...J,...Yt}),d&&t.blockInitialAnimation&&(Le=!1);const kt=Se&&ke;Le&&(!kt||lt)&&V.push(...qt.map(Fe=>{const pe={type:ee};if(typeof Fe=="string"&&d&&!kt&&t.manuallyAnimateOnMount&&t.parent){const{parent:Te}=t,st=resolveVariant(Te,Fe);if(Te.enteringChildren&&st){const{delayChildren:Me}=st.transition||{};pe.delay=calcChildStagger(Te.enteringChildren,t,Me)}}return{animation:Fe,options:pe}}))}if(G.size){const le={};if(typeof O.initial!="boolean"){const ee=resolveVariant(t,Array.isArray(O.initial)?O.initial[0]:O.initial);ee&&ee.transition&&(le.transition=ee.transition)}G.forEach(ee=>{const se=t.getBaseTarget(ee),Q=t.getValue(ee);Q&&(Q.liveStyle=!0),le[ee]=se??null}),V.push({animation:le})}let Y=!!V.length;return d&&(O.initial===!1||O.initial===O.animate)&&!t.manuallyAnimateOnMount&&(Y=!1),d=!1,Y?s(V):Promise.resolve()}function a(k,O){var V;if(u[k].isActive===O)return Promise.resolve();(V=t.variantChildren)==null||V.forEach(G=>{var J;return(J=G.animationState)==null?void 0:J.setActive(k,O)}),u[k].isActive=O;const j=R(k);for(const G in u)u[G].protectedKeys={};return j}return{animateChanges:R,setActive:a,setAnimateFunction:S,getState:()=>u,reset:()=>{u=createState()}}}function checkVariantsDidChange(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!shallowCompare(s,t):!1}function createTypeState(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}function copyAxisInto(t,s){t.min=s.min,t.max=s.max}function copyBoxInto(t,s){copyAxisInto(t.x,s.x),copyAxisInto(t.y,s.y)}function copyAxisDeltaInto(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(t){return t.max-t.min}function isNear(t,s,u){return Math.abs(t-s)<=u}function calcAxisDelta(t,s,u,d=.5){t.origin=d,t.originPoint=mixNumber$1(s.min,s.max,t.origin),t.scale=calcLength(u)/calcLength(s),t.translate=mixNumber$1(u.min,u.max,t.origin)-t.originPoint,(t.scale>=SCALE_MIN&&t.scale<=SCALE_MAX||isNaN(t.scale))&&(t.scale=1),(t.translate>=TRANSLATE_MIN&&t.translate<=TRANSLATE_MAX||isNaN(t.translate))&&(t.translate=0)}function calcBoxDelta(t,s,u,d){calcAxisDelta(t.x,s.x,u.x,d?d.originX:void 0),calcAxisDelta(t.y,s.y,u.y,d?d.originY:void 0)}function calcRelativeAxis(t,s,u){t.min=u.min+s.min,t.max=t.min+calcLength(s)}function calcRelativeBox(t,s,u){calcRelativeAxis(t.x,s.x,u.x),calcRelativeAxis(t.y,s.y,u.y)}function calcRelativeAxisPosition(t,s,u){t.min=s.min-u.min,t.max=t.min+calcLength(s)}function calcRelativePosition(t,s,u){calcRelativeAxisPosition(t.x,s.x,u.x),calcRelativeAxisPosition(t.y,s.y,u.y)}function removePointDelta(t,s,u,d,_){return t-=s,t=scalePoint(t,1/u,d),_!==void 0&&(t=scalePoint(t,1/_,d)),t}function removeAxisDelta(t,s=0,u=1,d=.5,_,S=t,R=t){if(percent.test(s)&&(s=parseFloat(s),s=mixNumber$1(R.min,R.max,s/100)-R.min),typeof s!="number")return;let a=mixNumber$1(S.min,S.max,d);t===S&&(a-=s),t.min=removePointDelta(t.min,s,u,a,_),t.max=removePointDelta(t.max,s,u,a,_)}function removeAxisTransforms(t,s,[u,d,_],S,R){removeAxisDelta(t,s[u],s[d],s[_],s.scale,S,R)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(t,s,u,d){removeAxisTransforms(t.x,s,xKeys,u?u.x:void 0,d?d.x:void 0),removeAxisTransforms(t.y,s,yKeys,u?u.y:void 0,d?d.y:void 0)}function isAxisDeltaZero(t){return t.translate===0&&t.scale===1}function isDeltaZero(t){return isAxisDeltaZero(t.x)&&isAxisDeltaZero(t.y)}function axisEquals(t,s){return t.min===s.min&&t.max===s.max}function boxEquals(t,s){return axisEquals(t.x,s.x)&&axisEquals(t.y,s.y)}function axisEqualsRounded(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function boxEqualsRounded(t,s){return axisEqualsRounded(t.x,s.x)&&axisEqualsRounded(t.y,s.y)}function aspectRatio(t){return calcLength(t.x)/calcLength(t.y)}function axisDeltaEquals(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}function eachAxis(t){return[t("x"),t("y")]}function buildProjectionTransform(t,s,u){let d="";const _=t.x.translate/s.x,S=t.y.translate/s.y,R=(u==null?void 0:u.z)||0;if((_||S||R)&&(d=`translate3d(${_}px, ${S}px, ${R}px) `),(s.x!==1||s.y!==1)&&(d+=`scale(${1/s.x}, ${1/s.y}) `),u){const{transformPerspective:O,rotate:j,rotateX:V,rotateY:G,skewX:J,skewY:Z}=u;O&&(d=`perspective(${O}px) ${d}`),j&&(d+=`rotate(${j}deg) `),V&&(d+=`rotateX(${V}deg) `),G&&(d+=`rotateY(${G}deg) `),J&&(d+=`skewX(${J}deg) `),Z&&(d+=`skewY(${Z}deg) `)}const a=t.x.scale*s.x,k=t.y.scale*s.y;return(a!==1||k!==1)&&(d+=`scale(${a}, ${k})`),d||"none"}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=t=>typeof t=="string"?parseFloat(t):t,isPx=t=>typeof t=="number"||px.test(t);function mixValues(t,s,u,d,_,S){_?(t.opacity=mixNumber$1(0,u.opacity??1,easeCrossfadeIn(d)),t.opacityExit=mixNumber$1(s.opacity??1,0,easeCrossfadeOut(d))):S&&(t.opacity=mixNumber$1(s.opacity??1,u.opacity??1,d));for(let R=0;R<numBorders;R++){const a=`border${borders[R]}Radius`;let k=getRadius(s,a),O=getRadius(u,a);if(k===void 0&&O===void 0)continue;k||(k=0),O||(O=0),k===0||O===0||isPx(k)===isPx(O)?(t[a]=Math.max(mixNumber$1(asNumber(k),asNumber(O),d),0),(percent.test(O)||percent.test(k))&&(t[a]+="%")):t[a]=O}(s.rotate||u.rotate)&&(t.rotate=mixNumber$1(s.rotate||0,u.rotate||0,d))}function getRadius(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop$1);function compress(t,s,u){return d=>d<t?0:d>s?1:u(progress(t,s,d))}function animateSingleValue(t,s,u){const d=isMotionValue(t)?t:motionValue(t);return d.start(animateMotionValue("",d,s,u)),d.animation}function addDomEvent(t,s,u,d={passive:!0}){return t.addEventListener(s,u,d),()=>t.removeEventListener(s,u)}const compareByDepth=(t,s)=>t.depth-s.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(s){addUniqueItem(this.children,s),this.isDirty=!0}remove(s){removeItem(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(s)}}function delay(t,s){const u=time.now(),d=({timestamp:_})=>{const S=_-u;S>=s&&(cancelFrame(d),t(S-s))};return frame.setup(d,!0),()=>cancelFrame(d)}function resolveMotionValue(t){return isMotionValue(t)?t.get():t}class NodeStack{constructor(){this.members=[]}add(s){addUniqueItem(this.members,s),s.scheduleRender()}remove(s){if(removeItem(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const u=this.members[this.members.length-1];u&&this.promote(u)}}relegate(s){const u=this.members.findIndex(_=>s===_);if(u===0)return!1;let d;for(let _=u;_>=0;_--){const S=this.members[_];if(S.isPresent!==!1){d=S;break}}return d?(this.promote(d),!0):!1}promote(s,u){const d=this.lead;if(s!==d&&(this.prevLead=d,this.lead=s,s.show(),d)){d.instance&&d.scheduleRender(),s.scheduleRender();const _=d.options.layoutDependency,S=s.options.layoutDependency;_!==void 0&&S!==void 0&&_===S||(s.resumeFrom=d,u&&(s.resumeFrom.preserveOpacity=!0),d.snapshot&&(s.snapshot=d.snapshot,s.snapshot.latestValues=d.animationValues||d.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0));const{crossfade:a}=s.options;a===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:u,resumingFrom:d}=s;u.onExitComplete&&u.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1},transformAxes=["","X","Y","Z"],animationTarget=1e3;let id$1=0;function resetDistortingTransform(t,s,u,d){const{latestValues:_}=s;_[t]&&(u[t]=_[t],s.setStaticValue(t,0),d&&(d[t]=0))}function cancelTreeOptimisedTransformAnimations(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const u=getOptimisedAppearId(s);if(window.MotionHasOptimisedAnimation(u,"transform")){const{layout:_,layoutId:S}=t.options;window.MotionCancelOptimisedAnimation(u,"transform",frame,!(_||S))}const{parent:d}=t;d&&!d.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(d)}function createProjectionNode$1({attachResizeListener:t,defaultParent:s,measureScroll:u,checkIsScrollRoot:d,resetTransform:_}){return class{constructor(R={},a=s==null?void 0:s()){this.id=id$1++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=R,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let k=0;k<this.path.length;k++)this.path[k].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(R,a){return this.eventHandlers.has(R)||this.eventHandlers.set(R,new SubscriptionManager),this.eventHandlers.get(R).add(a)}notifyListeners(R,...a){const k=this.eventHandlers.get(R);k&&k.notify(...a)}hasListeners(R){return this.eventHandlers.has(R)}mount(R){if(this.instance)return;this.isSVG=isSVGElement(R)&&!isSVGSVGElement(R),this.instance=R;const{layoutId:a,layout:k,visualElement:O}=this.options;if(O&&!O.current&&O.mount(R),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(k||a)&&(this.isLayoutDirty=!0),t){let j,V=0;const G=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{V=window.innerWidth}),t(R,()=>{const J=window.innerWidth;J!==V&&(V=J,this.root.updateBlockedByResize=!0,j&&j(),j=delay(G,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&O&&(a||k)&&this.addEventListener("didUpdate",({delta:j,hasLayoutChanged:V,hasRelativeLayoutChanged:G,layout:J})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Z=this.options.transition||O.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:Y,onLayoutAnimationComplete:le}=O.getProps(),ee=!this.targetLayout||!boxEqualsRounded(this.targetLayout,J),se=!V&&G;if(this.options.layoutRoot||this.resumeFrom||se||V&&(ee||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Q={...getValueTransition(Z,"layout"),onPlay:Y,onComplete:le};(O.shouldReduceMotion||this.options.layoutRoot)&&(Q.delay=0,Q.type=!1),this.startAnimation(Q),this.setAnimationOrigin(j,se)}else V||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=J})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const R=this.getStack();R&&R.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:R}=this.options;return R&&R.getProps().transformTemplate}willUpdate(R=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let j=0;j<this.path.length;j++){const V=this.path[j];V.shouldResetTransform=!0,V.updateScroll("snapshot"),V.options.layoutRoot&&V.willUpdate(!1)}const{layoutId:a,layout:k}=this.options;if(a===void 0&&!k)return;const O=this.getTransformTemplate();this.prevTransformTemplateValue=O?O(this.latestValues,""):void 0,this.updateSnapshot(),R&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const a=time.now();frameData.delta=clamp$1(0,1e3/60,a-frameData.timestamp),frameData.timestamp=a,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let k=0;k<this.path.length;k++)this.path[k].updateScroll();const R=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,R?R.layoutBox:void 0)}updateScroll(R="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===R&&(a=!1),a&&this.instance){const k=d(this.instance);this.scroll={animationId:this.root.animationId,phase:R,isRoot:k,offset:u(this.instance),wasRoot:this.scroll?this.scroll.isRoot:k}}}resetTransform(){if(!_)return;const R=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!isDeltaZero(this.projectionDelta),k=this.getTransformTemplate(),O=k?k(this.latestValues,""):void 0,j=O!==this.prevTransformTemplateValue;R&&this.instance&&(a||hasTransform(this.latestValues)||j)&&(_(this.instance,O),this.shouldResetTransform=!1,this.scheduleRender())}measure(R=!0){const a=this.measurePageBox();let k=this.removeElementScroll(a);return R&&(k=this.removeTransform(k)),roundBox(k),{animationId:this.root.animationId,measuredBox:a,layoutBox:k,latestValues:{},source:this.id}}measurePageBox(){var O;const{visualElement:R}=this.options;if(!R)return createBox();const a=R.measureViewportBox();if(!(((O=this.scroll)==null?void 0:O.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:j}=this.root;j&&(translateAxis(a.x,j.offset.x),translateAxis(a.y,j.offset.y))}return a}removeElementScroll(R){var k;const a=createBox();if(copyBoxInto(a,R),(k=this.scroll)!=null&&k.wasRoot)return a;for(let O=0;O<this.path.length;O++){const j=this.path[O],{scroll:V,options:G}=j;j!==this.root&&V&&G.layoutScroll&&(V.wasRoot&&copyBoxInto(a,R),translateAxis(a.x,V.offset.x),translateAxis(a.y,V.offset.y))}return a}applyTransform(R,a=!1){const k=createBox();copyBoxInto(k,R);for(let O=0;O<this.path.length;O++){const j=this.path[O];!a&&j.options.layoutScroll&&j.scroll&&j!==j.root&&transformBox(k,{x:-j.scroll.offset.x,y:-j.scroll.offset.y}),hasTransform(j.latestValues)&&transformBox(k,j.latestValues)}return hasTransform(this.latestValues)&&transformBox(k,this.latestValues),k}removeTransform(R){const a=createBox();copyBoxInto(a,R);for(let k=0;k<this.path.length;k++){const O=this.path[k];if(!O.instance||!hasTransform(O.latestValues))continue;hasScale(O.latestValues)&&O.updateSnapshot();const j=createBox(),V=O.measurePageBox();copyBoxInto(j,V),removeBoxTransforms(a,O.latestValues,O.snapshot?O.snapshot.layoutBox:void 0,j)}return hasTransform(this.latestValues)&&removeBoxTransforms(a,this.latestValues),a}setTargetDelta(R){this.targetDelta=R,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(R){this.options={...this.options,...R,crossfade:R.crossfade!==void 0?R.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(R=!1){var J;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const k=!!this.resumingFrom||this!==a;if(!(R||k&&this.isSharedProjectionDirty||this.isProjectionDirty||(J=this.parent)!=null&&J.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:j,layoutId:V}=this.options;if(!this.layout||!(j||V))return;this.resolvedRelativeTargetAt=frameData.timestamp;const G=this.getClosestProjectingParent();G&&this.linkedParentVersion!==G.layoutVersion&&!G.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(G&&G.layout?this.createRelativeTarget(G,this.layout.layoutBox,G.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,G&&!!G.resumingFrom==!!this.resumingFrom&&!G.options.layoutScroll&&G.target&&this.animationProgress!==1?this.createRelativeTarget(G,this.target,G.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(R,a,k){this.relativeParent=R,this.linkedParentVersion=R.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,a,k),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var Z;const R=this.getLead(),a=!!this.resumingFrom||this!==R;let k=!0;if((this.isProjectionDirty||(Z=this.parent)!=null&&Z.isProjectionDirty)&&(k=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(k=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(k=!1),k)return;const{layout:O,layoutId:j}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(O||j))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const V=this.treeScale.x,G=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,a),R.layout&&!R.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(R.target=R.layout.layoutBox,R.targetWithTransforms=createBox());const{target:J}=R;if(!J){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,J,this.latestValues),(this.treeScale.x!==V||this.treeScale.y!==G||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",J))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(R=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),R){const k=this.getStack();k&&k.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(R,a=!1){const k=this.snapshot,O=k?k.latestValues:{},j={...this.latestValues},V=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const G=createBox(),J=k?k.source:void 0,Z=this.layout?this.layout.source:void 0,Y=J!==Z,le=this.getStack(),ee=!le||le.members.length<=1,se=!!(Y&&!ee&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Q;this.mixTargetDelta=oe=>{const _e=oe/1e3;mixAxisDelta(V.x,R.x,_e),mixAxisDelta(V.y,R.y,_e),this.setTargetDelta(V),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(G,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,G,_e),Q&&boxEquals(this.relativeTarget,Q)&&(this.isProjectionDirty=!1),Q||(Q=createBox()),copyBoxInto(Q,this.relativeTarget)),Y&&(this.animationValues=j,mixValues(j,O,this.latestValues,_e,se,ee)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_e},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(R){var a,k,O;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(O=(k=this.resumingFrom)==null?void 0:k.currentAnimation)==null||O.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...R,velocity:0,isSync:!0,onUpdate:j=>{this.mixTargetDelta(j),R.onUpdate&&R.onUpdate(j)},onStop:()=>{},onComplete:()=>{R.onComplete&&R.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const R=this.getStack();R&&R.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const R=this.getLead();let{targetWithTransforms:a,target:k,layout:O,latestValues:j}=R;if(!(!a||!k||!O)){if(this!==R&&this.layout&&O&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,O.layoutBox)){k=this.target||createBox();const V=calcLength(this.layout.layoutBox.x);k.x.min=R.target.x.min,k.x.max=k.x.min+V;const G=calcLength(this.layout.layoutBox.y);k.y.min=R.target.y.min,k.y.max=k.y.min+G}copyBoxInto(a,k),transformBox(a,j),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,a,j)}}registerSharedNode(R,a){this.sharedNodes.has(R)||this.sharedNodes.set(R,new NodeStack),this.sharedNodes.get(R).add(a);const O=a.options.initialPromotionConfig;a.promote({transition:O?O.transition:void 0,preserveFollowOpacity:O&&O.shouldPreserveFollowOpacity?O.shouldPreserveFollowOpacity(a):void 0})}isLead(){const R=this.getStack();return R?R.lead===this:!0}getLead(){var a;const{layoutId:R}=this.options;return R?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:R}=this.options;return R?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:R}=this.options;if(R)return this.root.sharedNodes.get(R)}promote({needsReset:R,transition:a,preserveFollowOpacity:k}={}){const O=this.getStack();O&&O.promote(this,k),R&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const R=this.getStack();return R?R.relegate(this):!1}resetSkewAndRotation(){const{visualElement:R}=this.options;if(!R)return;let a=!1;const{latestValues:k}=R;if((k.z||k.rotate||k.rotateX||k.rotateY||k.rotateZ||k.skewX||k.skewY)&&(a=!0),!a)return;const O={};k.z&&resetDistortingTransform("z",R,O,this.animationValues);for(let j=0;j<transformAxes.length;j++)resetDistortingTransform(`rotate${transformAxes[j]}`,R,O,this.animationValues),resetDistortingTransform(`skew${transformAxes[j]}`,R,O,this.animationValues);R.render();for(const j in O)R.setStaticValue(j,O[j]),this.animationValues&&(this.animationValues[j]=O[j]);R.scheduleRender()}applyProjectionStyles(R,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){R.visibility="hidden";return}const k=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,R.visibility="",R.opacity="",R.pointerEvents=resolveMotionValue(a==null?void 0:a.pointerEvents)||"",R.transform=k?k(this.latestValues,""):"none";return}const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){this.options.layoutId&&(R.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,R.pointerEvents=resolveMotionValue(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(R.transform=k?k({},""):"none",this.hasProjected=!1);return}R.visibility="";const j=O.animationValues||O.latestValues;this.applyTransformsToTarget();let V=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,j);k&&(V=k(j,V)),R.transform=V;const{x:G,y:J}=this.projectionDelta;R.transformOrigin=`${G.origin*100}% ${J.origin*100}% 0`,O.animationValues?R.opacity=O===this?j.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:j.opacityExit:R.opacity=O===this?j.opacity!==void 0?j.opacity:"":j.opacityExit!==void 0?j.opacityExit:0;for(const Z in scaleCorrectors){if(j[Z]===void 0)continue;const{correct:Y,applyTo:le,isCSSVariable:ee}=scaleCorrectors[Z],se=V==="none"?j[Z]:Y(j[Z],O);if(le){const Q=le.length;for(let oe=0;oe<Q;oe++)R[le[oe]]=se}else ee?this.options.visualElement.renderState.vars[Z]=se:R[Z]=se}this.options.layoutId&&(R.pointerEvents=O===this?resolveMotionValue(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(R=>{var a;return(a=R.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(t){t.updateLayout()}function notifyLayoutUpdate(t){var u;const s=((u=t.resumeFrom)==null?void 0:u.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:_}=t.layout,{animationType:S}=t.options,R=s.source!==t.layout.source;S==="size"?eachAxis(V=>{const G=R?s.measuredBox[V]:s.layoutBox[V],J=calcLength(G);G.min=d[V].min,G.max=G.min+J}):shouldAnimatePositionOnly(S,s.layoutBox,d)&&eachAxis(V=>{const G=R?s.measuredBox[V]:s.layoutBox[V],J=calcLength(d[V]);G.max=G.min+J,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[V].max=t.relativeTarget[V].min+J)});const a=createDelta();calcBoxDelta(a,d,s.layoutBox);const k=createDelta();R?calcBoxDelta(k,t.applyTransform(_,!0),s.measuredBox):calcBoxDelta(k,d,s.layoutBox);const O=!isDeltaZero(a);let j=!1;if(!t.resumeFrom){const V=t.getClosestProjectingParent();if(V&&!V.resumeFrom){const{snapshot:G,layout:J}=V;if(G&&J){const Z=createBox();calcRelativePosition(Z,s.layoutBox,G.layoutBox);const Y=createBox();calcRelativePosition(Y,d,J.layoutBox),boxEqualsRounded(Z,Y)||(j=!0),V.options.layoutRoot&&(t.relativeTarget=Y,t.relativeTargetOrigin=Z,t.relativeParent=V)}}}t.notifyListeners("didUpdate",{layout:d,snapshot:s,delta:k,layoutDelta:a,hasLayoutChanged:O,hasRelativeLayoutChanged:j})}else if(t.isLead()){const{onExitComplete:d}=t.options;d&&d()}t.options.transition=void 0}function propagateDirtyNodes(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function cleanDirtyNodes(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function clearSnapshot(t){t.clearSnapshot()}function clearMeasurements(t){t.clearMeasurements()}function clearIsLayoutDirty(t){t.isLayoutDirty=!1}function resetTransformStyle(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function finishAnimation(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function resolveTargetDelta(t){t.resolveTargetDelta()}function calcProjection(t){t.calcProjection()}function resetSkewAndRotation(t){t.resetSkewAndRotation()}function removeLeadSnapshots(t){t.removeLeadSnapshot()}function mixAxisDelta(t,s,u){t.translate=mixNumber$1(s.translate,0,u),t.scale=mixNumber$1(s.scale,1,u),t.origin=s.origin,t.originPoint=s.originPoint}function mixAxis(t,s,u,d){t.min=mixNumber$1(s.min,u.min,d),t.max=mixNumber$1(s.max,u.max,d)}function mixBox(t,s,u,d){mixAxis(t.x,s.x,u.x,d),mixAxis(t.y,s.y,u.y,d)}function hasOpacityCrossfade(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop$1;function roundAxis(t){t.min=roundPoint(t.min),t.max=roundPoint(t.max)}function roundBox(t){roundAxis(t.x),roundAxis(t.y)}function shouldAnimatePositionOnly(t,s,u){return t==="position"||t==="preserve-aspect"&&!isNear(aspectRatio(s),aspectRatio(u),.2)}function checkNodeWasScrollRoot(t){var s;return t!==t.root&&((s=t.scroll)==null?void 0:s.wasRoot)}const DocumentProjectionNode=createProjectionNode$1({attachResizeListener:(t,s)=>addDomEvent(t,"resize",s),measureScroll:()=>{var t,s;return{x:document.documentElement.scrollLeft||((t=document.body)==null?void 0:t.scrollLeft)||0,y:document.documentElement.scrollTop||((s=document.body)==null?void 0:s.scrollTop)||0}},checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode$1({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const t=new DocumentProjectionNode({});t.mount(window),t.setOptions({layoutScroll:!0}),rootProjectionNode.current=t}return rootProjectionNode.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),MotionConfigContext=reactExports.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function setRef$1(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function composeRefs$1(...t){return s=>{let u=!1;const d=t.map(_=>{const S=setRef$1(_,s);return!u&&typeof S=="function"&&(u=!0),S});if(u)return()=>{for(let _=0;_<d.length;_++){const S=d[_];typeof S=="function"?S():setRef$1(t[_],null)}}}}function useComposedRefs$1(...t){return reactExports.useCallback(composeRefs$1(...t),t)}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(s){const u=this.props.childRef.current;if(u&&s.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const d=u.offsetParent,_=isHTMLElement$1(d)&&d.offsetWidth||0,S=isHTMLElement$1(d)&&d.offsetHeight||0,R=this.props.sizeRef.current;R.height=u.offsetHeight||0,R.width=u.offsetWidth||0,R.top=u.offsetTop,R.left=u.offsetLeft,R.right=_-R.width-R.left,R.bottom=S-R.height-R.top}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:t,isPresent:s,anchorX:u,anchorY:d,root:_,pop:S}){var G;const R=reactExports.useId(),a=reactExports.useRef(null),k=reactExports.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:O}=reactExports.useContext(MotionConfigContext),j=((G=t.props)==null?void 0:G.ref)??(t==null?void 0:t.ref),V=useComposedRefs$1(a,j);return reactExports.useInsertionEffect(()=>{const{width:J,height:Z,top:Y,left:le,right:ee,bottom:se}=k.current;if(s||S===!1||!a.current||!J||!Z)return;const Q=u==="left"?`left: ${le}`:`right: ${ee}`,oe=d==="bottom"?`bottom: ${se}`:`top: ${Y}`;a.current.dataset.motionPopId=R;const _e=document.createElement("style");O&&(_e.nonce=O);const Se=_??document.head;return Se.appendChild(_e),_e.sheet&&_e.sheet.insertRule(`
          [data-motion-pop-id="${R}"] {
            position: absolute !important;
            width: ${J}px !important;
            height: ${Z}px !important;
            ${Q}px !important;
            ${oe}px !important;
          }
        `),()=>{Se.contains(_e)&&Se.removeChild(_e)}},[s]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:s,childRef:a,sizeRef:k,pop:S,children:S===!1?t:reactExports.cloneElement(t,{ref:V})})}const PresenceChild=({children:t,initial:s,isPresent:u,onExitComplete:d,custom:_,presenceAffectsLayout:S,mode:R,anchorX:a,anchorY:k,root:O})=>{const j=useConstant(newChildrenMap),V=reactExports.useId();let G=!0,J=reactExports.useMemo(()=>(G=!1,{id:V,initial:s,isPresent:u,custom:_,onExitComplete:Z=>{j.set(Z,!0);for(const Y of j.values())if(!Y)return;d&&d()},register:Z=>(j.set(Z,!1),()=>j.delete(Z))}),[u,j,d]);return S&&G&&(J={...J}),reactExports.useMemo(()=>{j.forEach((Z,Y)=>j.set(Y,!1))},[u]),reactExports.useEffect(()=>{!u&&!j.size&&d&&d()},[u]),t=jsxRuntimeExports.jsx(PopChild,{pop:R==="popLayout",isPresent:u,anchorX:a,anchorY:k,root:O,children:t}),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:J,children:t})};function newChildrenMap(){return new Map}function usePresence$1(t=!0){const s=reactExports.useContext(PresenceContext);if(s===null)return[!0,null];const{isPresent:u,onExitComplete:d,register:_}=s,S=reactExports.useId();reactExports.useEffect(()=>{if(t)return _(S)},[t]);const R=reactExports.useCallback(()=>t&&d&&d(S),[S,d,t]);return!u&&d?[!1,R]:[!0]}const getChildKey=t=>t.key||"";function onlyElements(t){const s=[];return reactExports.Children.forEach(t,u=>{reactExports.isValidElement(u)&&s.push(u)}),s}const AnimatePresence=({children:t,custom:s,initial:u=!0,onExitComplete:d,presenceAffectsLayout:_=!0,mode:S="sync",propagate:R=!1,anchorX:a="left",anchorY:k="top",root:O})=>{const[j,V]=usePresence$1(R),G=reactExports.useMemo(()=>onlyElements(t),[t]),J=R&&!j?[]:G.map(getChildKey),Z=reactExports.useRef(!0),Y=reactExports.useRef(G),le=useConstant(()=>new Map),ee=reactExports.useRef(new Set),[se,Q]=reactExports.useState(G),[oe,_e]=reactExports.useState(G);useIsomorphicLayoutEffect$1(()=>{Z.current=!1,Y.current=G;for(let Le=0;Le<oe.length;Le++){const lt=getChildKey(oe[Le]);J.includes(lt)?(le.delete(lt),ee.current.delete(lt)):le.get(lt)!==!0&&le.set(lt,!1)}},[oe,J.length,J.join("-")]);const Se=[];if(G!==se){let Le=[...G];for(let lt=0;lt<oe.length;lt++){const qt=oe[lt],Yt=getChildKey(qt);J.includes(Yt)||(Le.splice(lt,0,qt),Se.push(qt))}return S==="wait"&&Se.length&&(Le=Se),_e(onlyElements(Le)),Q(G),null}const{forceRender:ke}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:oe.map(Le=>{const lt=getChildKey(Le),qt=R&&!j?!1:G===oe||J.includes(lt),Yt=()=>{if(ee.current.has(lt))return;if(ee.current.add(lt),le.has(lt))le.set(lt,!0);else return;let Ot=!0;le.forEach(Bt=>{Bt||(Ot=!1)}),Ot&&(ke==null||ke(),_e(Y.current),R&&(V==null||V()),d&&d())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:qt,initial:!Z.current||u?void 0:!1,custom:s,presenceAffectsLayout:_,mode:S,root:O,onExitComplete:qt?void 0:Yt,anchorX:a,anchorY:k,children:Le},lt)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let isInitialized=!1;function initFeatureDefinitions(){if(isInitialized)return;const t={};for(const s in featureProps)t[s]={isEnabled:u=>featureProps[s].some(d=>!!u[d])};setFeatureDefinitions(t),isInitialized=!0}function getInitializedFeatureDefinitions(){return initFeatureDefinitions(),getFeatureDefinitions()}function loadFeatures(t){const s=getInitializedFeatureDefinitions();for(const u in t)s[u]={...s[u],...t[u]};setFeatureDefinitions(s)}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function isValidMotionProp(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||validMotionProps.has(t)}let shouldForward=t=>!isValidMotionProp(t);function loadExternalIsValidProp(t){typeof t=="function"&&(shouldForward=s=>s.startsWith("on")?!isValidMotionProp(s):t(s))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(t,s,u){const d={};for(const _ in t)_==="values"&&typeof t.values=="object"||(shouldForward(_)||u===!0&&isValidMotionProp(_)||!s&&!isValidMotionProp(_)||t.draggable&&_.startsWith("onDrag"))&&(d[_]=t[_]);return d}const MotionContext=reactExports.createContext({});function getCurrentTreeVariants(t,s){if(isControllingVariants(t)){const{initial:u,animate:d}=t;return{initial:u===!1||isVariantLabel(u)?u:void 0,animate:isVariantLabel(d)?d:void 0}}return t.inherit!==!1?s:{}}function useCreateMotionContext(t){const{initial:s,animate:u}=getCurrentTreeVariants(t,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:s,animate:u}),[variantLabelsAsDependency(s),variantLabelsAsDependency(u)])}function variantLabelsAsDependency(t){return Array.isArray(t)?t.join(" "):t}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(t,s,u){for(const d in s)!isMotionValue(s[d])&&!isForcedMotionValue(d,u)&&(t[d]=s[d])}function useInitialMotionValues({transformTemplate:t},s){return reactExports.useMemo(()=>{const u=createHtmlRenderState();return buildHTMLStyles(u,s,t),Object.assign({},u.vars,u.style)},[s])}function useStyle(t,s){const u=t.style||{},d={};return copyRawValuesOnly(d,u,t),Object.assign(d,useInitialMotionValues(t,s)),d}function useHTMLProps(t,s){const u={},d=useStyle(t,s);return t.drag&&t.dragListener!==!1&&(u.draggable=!1,d.userSelect=d.WebkitUserSelect=d.WebkitTouchCallout="none",d.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(u.tabIndex=0),u.style=d,u}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}});function useSVGProps(t,s,u,d){const _=reactExports.useMemo(()=>{const S=createSvgRenderState();return buildSVGAttrs(S,s,isSVGTag(d),t.transformTemplate,t.style),{...S.attrs,style:{...S.style}}},[s]);if(t.style){const S={};copyRawValuesOnly(S,t.style,t),_.style={...S,..._.style}}return _}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(t){return typeof t!="string"||t.includes("-")?!1:!!(lowercaseSVGElements.indexOf(t)>-1||/[A-Z]/u.test(t))}function useRender(t,s,u,{latestValues:d},_,S=!1,R){const k=(R??isSVGComponent(t)?useSVGProps:useHTMLProps)(s,d,_,t),O=filterProps(s,typeof t=="string",S),j=t!==reactExports.Fragment?{...O,...k,ref:u}:{},{children:V}=s,G=reactExports.useMemo(()=>isMotionValue(V)?V.get():V,[V]);return reactExports.createElement(t,{...j,children:G})}function makeState({scrapeMotionValuesFromProps:t,createRenderState:s},u,d,_){return{latestValues:makeLatestValues(u,d,_,t),renderState:s()}}function makeLatestValues(t,s,u,d){const _={},S=d(t,{});for(const G in S)_[G]=resolveMotionValue(S[G]);let{initial:R,animate:a}=t;const k=isControllingVariants(t),O=isVariantNode(t);s&&O&&!k&&t.inherit!==!1&&(R===void 0&&(R=s.initial),a===void 0&&(a=s.animate));let j=u?u.initial===!1:!1;j=j||R===!1;const V=j?a:R;if(V&&typeof V!="boolean"&&!isAnimationControls(V)){const G=Array.isArray(V)?V:[V];for(let J=0;J<G.length;J++){const Z=resolveVariantFromProps(t,G[J]);if(Z){const{transitionEnd:Y,transition:le,...ee}=Z;for(const se in ee){let Q=ee[se];if(Array.isArray(Q)){const oe=j?Q.length-1:0;Q=Q[oe]}Q!==null&&(_[se]=Q)}for(const se in Y)_[se]=Y[se]}}}return _}const makeUseVisualState=t=>(s,u)=>{const d=reactExports.useContext(MotionContext),_=reactExports.useContext(PresenceContext),S=()=>makeState(t,s,d,_);return u?S():useConstant(S)},useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState}),useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function useMotionRef(t,s,u){const d=reactExports.useRef(u);reactExports.useInsertionEffect(()=>{d.current=u});const _=reactExports.useRef(null);return reactExports.useCallback(S=>{var a;S&&((a=t.onMount)==null||a.call(t,S)),s&&(S?s.mount(S):s.unmount());const R=d.current;if(typeof R=="function")if(S){const k=R(S);typeof k=="function"&&(_.current=k)}else _.current?(_.current(),_.current=null):R(S);else R&&(R.current=S)},[s])}const SwitchLayoutGroupContext=reactExports.createContext({});function isRefObject(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function useVisualElement(t,s,u,d,_,S){var Q,oe;const{visualElement:R}=reactExports.useContext(MotionContext),a=reactExports.useContext(LazyContext),k=reactExports.useContext(PresenceContext),O=reactExports.useContext(MotionConfigContext),j=O.reducedMotion,V=O.skipAnimations,G=reactExports.useRef(null),J=reactExports.useRef(!1);d=d||a.renderer,!G.current&&d&&(G.current=d(t,{visualState:s,parent:R,props:u,presenceContext:k,blockInitialAnimation:k?k.initial===!1:!1,reducedMotionConfig:j,skipAnimations:V,isSVG:S}),J.current&&G.current&&(G.current.manuallyAnimateOnMount=!0));const Z=G.current,Y=reactExports.useContext(SwitchLayoutGroupContext);Z&&!Z.projection&&_&&(Z.type==="html"||Z.type==="svg")&&createProjectionNode(G.current,u,_,Y);const le=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{Z&&le.current&&Z.update(u,k)});const ee=u[optimizedAppearDataAttribute],se=reactExports.useRef(!!ee&&!((Q=window.MotionHandoffIsComplete)!=null&&Q.call(window,ee))&&((oe=window.MotionHasOptimisedAnimation)==null?void 0:oe.call(window,ee)));return useIsomorphicLayoutEffect$1(()=>{J.current=!0,Z&&(le.current=!0,window.MotionIsMounted=!0,Z.updateFeatures(),Z.scheduleRenderMicrotask(),se.current&&Z.animationState&&Z.animationState.animateChanges())}),reactExports.useEffect(()=>{Z&&(!se.current&&Z.animationState&&Z.animationState.animateChanges(),se.current&&(queueMicrotask(()=>{var _e;(_e=window.MotionHandoffMarkAsComplete)==null||_e.call(window,ee)}),se.current=!1),Z.enteringChildren=void 0)}),Z}function createProjectionNode(t,s,u,d){const{layoutId:_,layout:S,drag:R,dragConstraints:a,layoutScroll:k,layoutRoot:O,layoutCrossfade:j}=s;t.projection=new u(t.latestValues,s["data-framer-portal-id"]?void 0:getClosestProjectingNode(t.parent)),t.projection.setOptions({layoutId:_,layout:S,alwaysMeasureLayout:!!R||a&&isRefObject(a),visualElement:t,animationType:typeof S=="string"?S:"both",initialPromotionConfig:d,crossfade:j,layoutScroll:k,layoutRoot:O})}function getClosestProjectingNode(t){if(t)return t.options.allowProjection!==!1?t.projection:getClosestProjectingNode(t.parent)}function createMotionComponent(t,{forwardMotionProps:s=!1,type:u}={},d,_){d&&loadFeatures(d);const S=u?u==="svg":isSVGComponent(t),R=S?useSVGVisualState:useHTMLVisualState;function a(O,j){let V;const G={...reactExports.useContext(MotionConfigContext),...O,layoutId:useLayoutId(O)},{isStatic:J}=G,Z=useCreateMotionContext(O),Y=R(O,J);if(!J&&isBrowser$1){useStrictMode();const le=getProjectionFunctionality(G);V=le.MeasureLayout,Z.visualElement=useVisualElement(t,Y,G,_,le.ProjectionNode,S)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Z,children:[V&&Z.visualElement?jsxRuntimeExports.jsx(V,{visualElement:Z.visualElement,...G}):null,useRender(t,O,useMotionRef(Y,Z.visualElement,j),Y,J,s,S)]})}a.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const k=reactExports.forwardRef(a);return k[motionComponentSymbol]=t,k}function useLayoutId({layoutId:t}){const s=reactExports.useContext(LayoutGroupContext).id;return s&&t!==void 0?s+"-"+t:t}function useStrictMode(t,s){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(t){const s=getInitializedFeatureDefinitions(),{drag:u,layout:d}=s;if(!u&&!d)return{};const _={...u,...d};return{MeasureLayout:u!=null&&u.isEnabled(t)||d!=null&&d.isEnabled(t)?_.MeasureLayout:void 0,ProjectionNode:_.ProjectionNode}}function createMotionProxy(t,s){if(typeof Proxy>"u")return createMotionComponent;const u=new Map,d=(S,R)=>createMotionComponent(S,R,t,s),_=(S,R)=>d(S,R);return new Proxy(_,{get:(S,R)=>R==="create"?d:(u.has(R)||u.set(R,createMotionComponent(R,void 0,t,s)),u.get(R))})}const createDomVisualElement=(t,s)=>s.isSVG??isSVGComponent(t)?new SVGVisualElement(s):new HTMLVisualElement(s,{allowProjection:t!==reactExports.Fragment});class AnimationFeature extends Feature{constructor(s){super(s),s.animationState||(s.animationState=createAnimationState(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();isAnimationControls(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:u}=this.node.prevProps||{};s!==u&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)==null||s.call(this)}}let id=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:u}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===d)return;const _=this.node.animationState.setActive("exit",!s);u&&!s&&_.then(()=>{u(this.id)})}mount(){const{register:s,onExitComplete:u}=this.node.presenceContext||{};u&&u(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function extractEventInfo(t){return{point:{x:t.pageX,y:t.pageY}}}const addPointerInfo=t=>s=>isPrimaryPointer(s)&&t(s,extractEventInfo(s));function addPointerEvent(t,s,u,d){return addDomEvent(t,s,addPointerInfo(u),d)}const getContextWindow=({current:t})=>t?t.ownerDocument.defaultView:null,distance=(t,s)=>Math.abs(t-s);function distance2D(t,s){const u=distance(t.x,s.x),d=distance(t.y,s.y);return Math.sqrt(u**2+d**2)}const overflowStyles=new Set(["auto","scroll"]);class PanSession{constructor(s,u,{transformPagePoint:d,contextWindow:_=window,dragSnapToOrigin:S=!1,distanceThreshold:R=3,element:a}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=J=>{this.handleScroll(J.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const J=getPanInfo(this.lastMoveEventInfo,this.history),Z=this.startEvent!==null,Y=distance2D(J.offset,{x:0,y:0})>=this.distanceThreshold;if(!Z&&!Y)return;const{point:le}=J,{timestamp:ee}=frameData;this.history.push({...le,timestamp:ee});const{onStart:se,onMove:Q}=this.handlers;Z||(se&&se(this.lastMoveEvent,J),this.startEvent=this.lastMoveEvent),Q&&Q(this.lastMoveEvent,J)},this.handlePointerMove=(J,Z)=>{this.lastMoveEvent=J,this.lastMoveEventInfo=transformPoint(Z,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(J,Z)=>{this.end();const{onEnd:Y,onSessionEnd:le,resumeAnimation:ee}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&ee&&ee(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const se=getPanInfo(J.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(Z,this.transformPagePoint),this.history);this.startEvent&&Y&&Y(J,se),le&&le(J,se)},!isPrimaryPointer(s))return;this.dragSnapToOrigin=S,this.handlers=u,this.transformPagePoint=d,this.distanceThreshold=R,this.contextWindow=_||window;const k=extractEventInfo(s),O=transformPoint(k,this.transformPagePoint),{point:j}=O,{timestamp:V}=frameData;this.history=[{...j,timestamp:V}];const{onSessionStart:G}=u;G&&G(s,getPanInfo(O,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp)),a&&this.startScrollTracking(a)}startScrollTracking(s){let u=s.parentElement;for(;u;){const d=getComputedStyle(u);(overflowStyles.has(d.overflowX)||overflowStyles.has(d.overflowY))&&this.scrollPositions.set(u,{x:u.scrollLeft,y:u.scrollTop}),u=u.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(s){const u=this.scrollPositions.get(s);if(!u)return;const d=s===window,_=d?{x:window.scrollX,y:window.scrollY}:{x:s.scrollLeft,y:s.scrollTop},S={x:_.x-u.x,y:_.y-u.y};S.x===0&&S.y===0||(d?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=S.x,this.lastMoveEventInfo.point.y+=S.y):this.history.length>0&&(this.history[0].x-=S.x,this.history[0].y-=S.y),this.scrollPositions.set(s,_),frame.update(this.updatePoint,!0))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),cancelFrame(this.updatePoint)}}function transformPoint(t,s){return s?{point:s(t.point)}:t}function subtractPoint(t,s){return{x:t.x-s.x,y:t.y-s.y}}function getPanInfo({point:t},s){return{point:t,delta:subtractPoint(t,lastDevicePoint(s)),offset:subtractPoint(t,startDevicePoint(s)),velocity:getVelocity(s,.1)}}function startDevicePoint(t){return t[0]}function lastDevicePoint(t){return t[t.length-1]}function getVelocity(t,s){if(t.length<2)return{x:0,y:0};let u=t.length-1,d=null;const _=lastDevicePoint(t);for(;u>=0&&(d=t[u],!(_.timestamp-d.timestamp>secondsToMilliseconds(s)));)u--;if(!d)return{x:0,y:0};d===t[0]&&t.length>2&&_.timestamp-d.timestamp>secondsToMilliseconds(s)*2&&(d=t[1]);const S=millisecondsToSeconds(_.timestamp-d.timestamp);if(S===0)return{x:0,y:0};const R={x:(_.x-d.x)/S,y:(_.y-d.y)/S};return R.x===1/0&&(R.x=0),R.y===1/0&&(R.y=0),R}function applyConstraints(t,{min:s,max:u},d){return s!==void 0&&t<s?t=d?mixNumber$1(s,t,d.min):Math.max(t,s):u!==void 0&&t>u&&(t=d?mixNumber$1(u,t,d.max):Math.min(t,u)),t}function calcRelativeAxisConstraints(t,s,u){return{min:s!==void 0?t.min+s:void 0,max:u!==void 0?t.max+u-(t.max-t.min):void 0}}function calcRelativeConstraints(t,{top:s,left:u,bottom:d,right:_}){return{x:calcRelativeAxisConstraints(t.x,u,_),y:calcRelativeAxisConstraints(t.y,s,d)}}function calcViewportAxisConstraints(t,s){let u=s.min-t.min,d=s.max-t.max;return s.max-s.min<t.max-t.min&&([u,d]=[d,u]),{min:u,max:d}}function calcViewportConstraints(t,s){return{x:calcViewportAxisConstraints(t.x,s.x),y:calcViewportAxisConstraints(t.y,s.y)}}function calcOrigin(t,s){let u=.5;const d=calcLength(t),_=calcLength(s);return _>d?u=progress(s.min,s.max-d,t.min):d>_&&(u=progress(t.min,t.max-_,s.min)),clamp$1(0,1,u)}function rebaseAxisConstraints(t,s){const u={};return s.min!==void 0&&(u.min=s.min-t.min),s.max!==void 0&&(u.max=s.max-t.min),u}const defaultElastic=.35;function resolveDragElastic(t=defaultElastic){return t===!1?t=0:t===!0&&(t=defaultElastic),{x:resolveAxisElastic(t,"left","right"),y:resolveAxisElastic(t,"top","bottom")}}function resolveAxisElastic(t,s,u){return{min:resolvePointElastic(t,s),max:resolvePointElastic(t,u)}}function resolvePointElastic(t,s){return typeof t=="number"?t:t[s]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:u=!1,distanceThreshold:d}={}){const{presenceContext:_}=this.visualElement;if(_&&_.isPresent===!1)return;const S=V=>{u&&this.snapToCursor(extractEventInfo(V).point),this.stopAnimation()},R=(V,G)=>{const{drag:J,dragPropagation:Z,onDragStart:Y}=this.getProps();if(J&&!Z&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(J),!this.openDragLock))return;this.latestPointerEvent=V,this.latestPanInfo=G,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(ee=>{let se=this.getAxisMotionValue(ee).get()||0;if(percent.test(se)){const{projection:Q}=this.visualElement;if(Q&&Q.layout){const oe=Q.layout.layoutBox[ee];oe&&(se=calcLength(oe)*(parseFloat(se)/100))}}this.originPoint[ee]=se}),Y&&frame.update(()=>Y(V,G),!1,!0),addValueToWillChange(this.visualElement,"transform");const{animationState:le}=this.visualElement;le&&le.setActive("whileDrag",!0)},a=(V,G)=>{this.latestPointerEvent=V,this.latestPanInfo=G;const{dragPropagation:J,dragDirectionLock:Z,onDirectionLock:Y,onDrag:le}=this.getProps();if(!J&&!this.openDragLock)return;const{offset:ee}=G;if(Z&&this.currentDirection===null){this.currentDirection=getCurrentDirection(ee),this.currentDirection!==null&&Y&&Y(this.currentDirection);return}this.updateAxis("x",G.point,ee),this.updateAxis("y",G.point,ee),this.visualElement.render(),le&&frame.update(()=>le(V,G),!1,!0)},k=(V,G)=>{this.latestPointerEvent=V,this.latestPanInfo=G,this.stop(V,G),this.latestPointerEvent=null,this.latestPanInfo=null},O=()=>{const{dragSnapToOrigin:V}=this.getProps();(V||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:j}=this.getProps();this.panSession=new PanSession(s,{onSessionStart:S,onStart:R,onMove:a,onSessionEnd:k,resumeAnimation:O},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:j,distanceThreshold:d,contextWindow:getContextWindow(this.visualElement),element:this.visualElement.current})}stop(s,u){const d=s||this.latestPointerEvent,_=u||this.latestPanInfo,S=this.isDragging;if(this.cancel(),!S||!_||!d)return;const{velocity:R}=_;this.startAnimation(R);const{onDragEnd:a}=this.getProps();a&&frame.postRender(()=>a(d,_))}cancel(){this.isDragging=!1;const{projection:s,animationState:u}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:d}=this.getProps();!d&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),u&&u.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(s,u,d){const{drag:_}=this.getProps();if(!d||!shouldDrag(s,_,this.currentDirection))return;const S=this.getAxisMotionValue(s);let R=this.originPoint[s]+d[s];this.constraints&&this.constraints[s]&&(R=applyConstraints(R,this.constraints[s],this.elastic[s])),S.set(R)}resolveConstraints(){var S;const{dragConstraints:s,dragElastic:u}=this.getProps(),d=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(S=this.visualElement.projection)==null?void 0:S.layout,_=this.constraints;s&&isRefObject(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&d?this.constraints=calcRelativeConstraints(d.layoutBox,s):this.constraints=!1,this.elastic=resolveDragElastic(u),_!==this.constraints&&!isRefObject(s)&&d&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(R=>{this.constraints!==!1&&this.getAxisMotionValue(R)&&(this.constraints[R]=rebaseAxisConstraints(d.layoutBox[R],this.constraints[R]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:u}=this.getProps();if(!s||!isRefObject(s))return!1;const d=s.current,{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const S=measurePageBox(d,_.root,this.visualElement.getTransformPagePoint());let R=calcViewportConstraints(_.layout.layoutBox,S);if(u){const a=u(convertBoxToBoundingBox(R));this.hasMutatedConstraints=!!a,a&&(R=convertBoundingBoxToBox(a))}return R}startAnimation(s){const{drag:u,dragMomentum:d,dragElastic:_,dragTransition:S,dragSnapToOrigin:R,onDragTransitionEnd:a}=this.getProps(),k=this.constraints||{},O=eachAxis(j=>{if(!shouldDrag(j,u,this.currentDirection))return;let V=k&&k[j]||{};R&&(V={min:0,max:0});const G=_?200:1e6,J=_?40:1e7,Z={type:"inertia",velocity:d?s[j]:0,bounceStiffness:G,bounceDamping:J,timeConstant:750,restDelta:1,restSpeed:10,...S,...V};return this.startAxisValueAnimation(j,Z)});return Promise.all(O).then(a)}startAxisValueAnimation(s,u){const d=this.getAxisMotionValue(s);return addValueToWillChange(this.visualElement,s),d.start(animateMotionValue(s,d,0,u,this.visualElement,!1))}stopAnimation(){eachAxis(s=>this.getAxisMotionValue(s).stop())}getAxisMotionValue(s){const u=`_drag${s.toUpperCase()}`,d=this.visualElement.getProps(),_=d[u];return _||this.visualElement.getValue(s,(d.initial?d.initial[s]:void 0)||0)}snapToCursor(s){eachAxis(u=>{const{drag:d}=this.getProps();if(!shouldDrag(u,d,this.currentDirection))return;const{projection:_}=this.visualElement,S=this.getAxisMotionValue(u);if(_&&_.layout){const{min:R,max:a}=_.layout.layoutBox[u],k=S.get()||0;S.set(s[u]-mixNumber$1(R,a,.5)+k)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:u}=this.getProps(),{projection:d}=this.visualElement;if(!isRefObject(u)||!d||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};eachAxis(R=>{const a=this.getAxisMotionValue(R);if(a&&this.constraints!==!1){const k=a.get();_[R]=calcOrigin({min:k,max:k},this.constraints[R])}});const{transformTemplate:S}=this.visualElement.getProps();this.visualElement.current.style.transform=S?S({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.constraints=!1,this.resolveConstraints(),eachAxis(R=>{if(!shouldDrag(R,s,null))return;const a=this.getAxisMotionValue(R),{min:k,max:O}=this.constraints[R];a.set(mixNumber$1(k,O,_[R]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const s=this.visualElement.current,u=addPointerEvent(s,"pointerdown",O=>{const{drag:j,dragListener:V=!0}=this.getProps(),G=O.target,J=G!==s&&isElementTextInput(G);j&&V&&!J&&this.start(O)});let d;const _=()=>{const{dragConstraints:O}=this.getProps();isRefObject(O)&&O.current&&(this.constraints=this.resolveRefConstraints(),d||(d=startResizeObservers(s,O.current,()=>this.scalePositionWithinConstraints())))},{projection:S}=this.visualElement,R=S.addEventListener("measure",_);S&&!S.layout&&(S.root&&S.root.updateScroll(),S.updateLayout()),frame.read(_);const a=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),k=S.addEventListener("didUpdate",(({delta:O,hasLayoutChanged:j})=>{this.isDragging&&j&&(eachAxis(V=>{const G=this.getAxisMotionValue(V);G&&(this.originPoint[V]+=O[V].translate,G.set(G.get()+O[V].translate))}),this.visualElement.render())}));return()=>{a(),u(),R(),k&&k(),d&&d()}}getProps(){const s=this.visualElement.getProps(),{drag:u=!1,dragDirectionLock:d=!1,dragPropagation:_=!1,dragConstraints:S=!1,dragElastic:R=defaultElastic,dragMomentum:a=!0}=s;return{...s,drag:u,dragDirectionLock:d,dragPropagation:_,dragConstraints:S,dragElastic:R,dragMomentum:a}}}function skipFirstCall(t){let s=!0;return()=>{if(s){s=!1;return}t()}}function startResizeObservers(t,s,u){const d=resize(t,skipFirstCall(u)),_=resize(s,skipFirstCall(u));return()=>{d(),_()}}function shouldDrag(t,s,u){return(s===!0||s===t)&&(u===null||u===t)}function getCurrentDirection(t,s=10){let u=null;return Math.abs(t.y)>s?u="y":Math.abs(t.x)>s&&(u="x"),u}class DragGesture extends Feature{constructor(s){super(s),this.removeGroupControls=noop$1,this.removeListeners=noop$1,this.controls=new VisualElementDragControls(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop$1}update(){const{dragControls:s}=this.node.getProps(),{dragControls:u}=this.node.prevProps||{};s!==u&&(this.removeGroupControls(),s&&(this.removeGroupControls=s.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const asyncHandler=t=>(s,u)=>{t&&frame.update(()=>t(s,u),!1,!0)};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop$1}onPointerDown(s){this.session=new PanSession(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:u,onPan:d,onPanEnd:_}=this.node.getProps();return{onSessionStart:asyncHandler(s),onStart:asyncHandler(u),onMove:asyncHandler(d),onEnd:(S,R)=>{delete this.session,_&&frame.postRender(()=>_(S,R))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:s,layoutGroup:u,switchLayoutGroup:d,layoutId:_}=this.props,{projection:S}=s;S&&(u.group&&u.group.add(S),d&&d.register&&_&&d.register(S),hasTakenAnySnapshot&&S.root.didUpdate(),S.addEventListener("animationComplete",()=>{this.safeToRemove()}),S.setOptions({...S.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:u,visualElement:d,drag:_,isPresent:S}=this.props,{projection:R}=d;return R&&(R.isPresent=S,s.layoutDependency!==u&&R.setOptions({...R.options,layoutDependency:u}),hasTakenAnySnapshot=!0,_||s.layoutDependency!==u||u===void 0||s.isPresent!==S?R.willUpdate():this.safeToRemove(),s.isPresent!==S&&(S?R.promote():R.relegate()||frame.postRender(()=>{const a=R.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),microtask.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:u,switchLayoutGroup:d}=this.props,{projection:_}=s;hasTakenAnySnapshot=!0,_&&(_.scheduleCheckAfterUnmount(),u&&u.group&&u.group.remove(_),d&&d.deregister&&d.deregister(_))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function MeasureLayout(t){const[s,u]=usePresence$1(),d=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...t,layoutGroup:d,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:s,safeToRemove:u})}const drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(t,s,u){const{props:d}=t;t.animationState&&d.whileHover&&t.animationState.setActive("whileHover",u==="Start");const _="onHover"+u,S=d[_];S&&frame.postRender(()=>S(s,extractEventInfo(s)))}class HoverGesture extends Feature{mount(){const{current:s}=this.node;s&&(this.unmount=hover(s,(u,d)=>(handleHoverEvent(this.node,d,"Start"),_=>handleHoverEvent(this.node,_,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(t,s,u){const{props:d}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&d.whileTap&&t.animationState.setActive("whileTap",u==="Start");const _="onTap"+(u==="End"?"":u),S=d[_];S&&frame.postRender(()=>S(s,extractEventInfo(s)))}class PressGesture extends Feature{mount(){const{current:s}=this.node;if(!s)return;const{globalTapTarget:u,propagate:d}=this.node.props;this.unmount=press(s,(_,S)=>(handlePressEvent(this.node,S,"Start"),(R,{success:a})=>handlePressEvent(this.node,R,a?"End":"Cancel")),{useGlobalTarget:u,stopPropagation:(d==null?void 0:d.tap)===!1})}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=t=>{const s=observerCallbacks.get(t.target);s&&s(t)},fireAllObserverCallbacks=t=>{t.forEach(fireObserverCallback)};function initIntersectionObserver({root:t,...s}){const u=t||document;observers.has(u)||observers.set(u,{});const d=observers.get(u),_=JSON.stringify(s);return d[_]||(d[_]=new IntersectionObserver(fireAllObserverCallbacks,{root:t,...s})),d[_]}function observeIntersection(t,s,u){const d=initIntersectionObserver(s);return observerCallbacks.set(t,u),d.observe(t),()=>{observerCallbacks.delete(t),d.unobserve(t)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:u,margin:d,amount:_="some",once:S}=s,R={root:u?u.current:void 0,rootMargin:d,threshold:typeof _=="number"?_:thresholdNames[_]},a=k=>{const{isIntersecting:O}=k;if(this.isInView===O||(this.isInView=O,S&&!O&&this.hasEnteredView))return;O&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",O);const{onViewportEnter:j,onViewportLeave:V}=this.node.getProps(),G=O?j:V;G&&G(k)};return observeIntersection(this.node.current,R,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:u}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(s,u))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:t={}},{viewport:s={}}={}){return u=>t[u]!==s[u]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);function LoaderOverlay(){const{loading:t}=useLoader();return t?jsxRuntimeExports.jsx(motion.div,{className:"fixed inset-0 bg-[#f0f7f5] flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},children:jsxRuntimeExports.jsx(Lottie,{autoplay:!0,animationData:starloader,style:{height:"200px",width:"200px"}})}):null}function __insertCSS(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.type="text/css",s.appendChild(u),u.styleSheet?u.styleSheet.cssText=t:u.appendChild(document.createTextNode(t))}const getAsset=t=>{switch(t){case"success":return SuccessIcon;case"info":return InfoIcon;case"warning":return WarningIcon;case"error":return ErrorIcon;default:return null}},bars=Array(12).fill(0),Loader$1=({visible:t,className:s})=>React2.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":t},React2.createElement("div",{className:"sonner-spinner"},bars.map((u,d)=>React2.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${d}`})))),SuccessIcon=React2.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React2.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),WarningIcon=React2.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React2.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),InfoIcon=React2.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React2.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),ErrorIcon=React2.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React2.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),CloseIcon=React2.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React2.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React2.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),useIsDocumentHidden=()=>{const[t,s]=React2.useState(document.hidden);return React2.useEffect(()=>{const u=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",u),()=>window.removeEventListener("visibilitychange",u)},[]),t};let toastsCounter=1;class Observer{constructor(){this.subscribe=s=>(this.subscribers.push(s),()=>{const u=this.subscribers.indexOf(s);this.subscribers.splice(u,1)}),this.publish=s=>{this.subscribers.forEach(u=>u(s))},this.addToast=s=>{this.publish(s),this.toasts=[...this.toasts,s]},this.create=s=>{var u;const{message:d,..._}=s,S=typeof(s==null?void 0:s.id)=="number"||((u=s.id)==null?void 0:u.length)>0?s.id:toastsCounter++,R=this.toasts.find(k=>k.id===S),a=s.dismissible===void 0?!0:s.dismissible;return this.dismissedToasts.has(S)&&this.dismissedToasts.delete(S),R?this.toasts=this.toasts.map(k=>k.id===S?(this.publish({...k,...s,id:S,title:d}),{...k,...s,id:S,dismissible:a,title:d}):k):this.addToast({title:d,..._,dismissible:a,id:S}),S},this.dismiss=s=>(s?(this.dismissedToasts.add(s),requestAnimationFrame(()=>this.subscribers.forEach(u=>u({id:s,dismiss:!0})))):this.toasts.forEach(u=>{this.subscribers.forEach(d=>d({id:u.id,dismiss:!0}))}),s),this.message=(s,u)=>this.create({...u,message:s}),this.error=(s,u)=>this.create({...u,message:s,type:"error"}),this.success=(s,u)=>this.create({...u,type:"success",message:s}),this.info=(s,u)=>this.create({...u,type:"info",message:s}),this.warning=(s,u)=>this.create({...u,type:"warning",message:s}),this.loading=(s,u)=>this.create({...u,type:"loading",message:s}),this.promise=(s,u)=>{if(!u)return;let d;u.loading!==void 0&&(d=this.create({...u,promise:s,type:"loading",message:u.loading,description:typeof u.description!="function"?u.description:void 0}));const _=Promise.resolve(s instanceof Function?s():s);let S=d!==void 0,R;const a=_.then(async O=>{if(R=["resolve",O],React2.isValidElement(O))S=!1,this.create({id:d,type:"default",message:O});else if(isHttpResponse(O)&&!O.ok){S=!1;const V=typeof u.error=="function"?await u.error(`HTTP error! status: ${O.status}`):u.error,G=typeof u.description=="function"?await u.description(`HTTP error! status: ${O.status}`):u.description,Z=typeof V=="object"&&!React2.isValidElement(V)?V:{message:V};this.create({id:d,type:"error",description:G,...Z})}else if(O instanceof Error){S=!1;const V=typeof u.error=="function"?await u.error(O):u.error,G=typeof u.description=="function"?await u.description(O):u.description,Z=typeof V=="object"&&!React2.isValidElement(V)?V:{message:V};this.create({id:d,type:"error",description:G,...Z})}else if(u.success!==void 0){S=!1;const V=typeof u.success=="function"?await u.success(O):u.success,G=typeof u.description=="function"?await u.description(O):u.description,Z=typeof V=="object"&&!React2.isValidElement(V)?V:{message:V};this.create({id:d,type:"success",description:G,...Z})}}).catch(async O=>{if(R=["reject",O],u.error!==void 0){S=!1;const j=typeof u.error=="function"?await u.error(O):u.error,V=typeof u.description=="function"?await u.description(O):u.description,J=typeof j=="object"&&!React2.isValidElement(j)?j:{message:j};this.create({id:d,type:"error",description:V,...J})}}).finally(()=>{S&&(this.dismiss(d),d=void 0),u.finally==null||u.finally.call(u)}),k=()=>new Promise((O,j)=>a.then(()=>R[0]==="reject"?j(R[1]):O(R[1])).catch(j));return typeof d!="string"&&typeof d!="number"?{unwrap:k}:Object.assign(d,{unwrap:k})},this.custom=(s,u)=>{const d=(u==null?void 0:u.id)||toastsCounter++;return this.create({jsx:s(d),id:d,...u}),d},this.getActiveToasts=()=>this.toasts.filter(s=>!this.dismissedToasts.has(s.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const ToastState=new Observer,toastFunction=(t,s)=>{const u=(s==null?void 0:s.id)||toastsCounter++;return ToastState.addToast({title:t,...s,id:u}),u},isHttpResponse=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",basicToast=toastFunction,getHistory=()=>ToastState.toasts,getToasts=()=>ToastState.getActiveToasts(),toast=Object.assign(basicToast,{success:ToastState.success,info:ToastState.info,warning:ToastState.warning,error:ToastState.error,custom:ToastState.custom,message:ToastState.message,promise:ToastState.promise,dismiss:ToastState.dismiss,loading:ToastState.loading},{getHistory,getToasts});__insertCSS("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function isAction(t){return t.label!==void 0}const VISIBLE_TOASTS_AMOUNT=3,VIEWPORT_OFFSET="24px",MOBILE_VIEWPORT_OFFSET="16px",TOAST_LIFETIME=4e3,TOAST_WIDTH=356,GAP=14,SWIPE_THRESHOLD=45,TIME_BEFORE_UNMOUNT=200;function cn$1(...t){return t.filter(Boolean).join(" ")}function getDefaultSwipeDirections(t){const[s,u]=t.split("-"),d=[];return s&&d.push(s),u&&d.push(u),d}const Toast=t=>{var s,u,d,_,S,R,a,k,O;const{invert:j,toast:V,unstyled:G,interacting:J,setHeights:Z,visibleToasts:Y,heights:le,index:ee,toasts:se,expanded:Q,removeToast:oe,defaultRichColors:_e,closeButton:Se,style:ke,cancelButtonStyle:Le,actionButtonStyle:lt,className:qt="",descriptionClassName:Yt="",duration:Ot,position:Bt,gap:si,expandByDefault:kt,classNames:xe,icons:Fe,closeButtonAriaLabel:pe="Close toast"}=t,[Te,st]=React2.useState(null),[Me,at]=React2.useState(null),[ct,Ct]=React2.useState(!1),[li,mi]=React2.useState(!1),[bi,zi]=React2.useState(!1),[vi,Gi]=React2.useState(!1),[lr,zr]=React2.useState(!1),[Ui,Ci]=React2.useState(0),[Gn,Wn]=React2.useState(0),vn=React2.useRef(V.duration||Ot||TOAST_LIFETIME),Sr=React2.useRef(null),Xr=React2.useRef(null),es=ee===0,Un=ee+1<=Y,dn=V.type,os=V.dismissible!==!1,Dr=V.className||"",jn=V.descriptionClassName||"",Rn=React2.useMemo(()=>le.findIndex($i=>$i.toastId===V.id)||0,[le,V.id]),ys=React2.useMemo(()=>{var $i;return($i=V.closeButton)!=null?$i:Se},[V.closeButton,Se]),As=React2.useMemo(()=>V.duration||Ot||TOAST_LIFETIME,[V.duration,Ot]),sa=React2.useRef(0),bn=React2.useRef(0),Al=React2.useRef(0),_s=React2.useRef(null),[Co,Zn]=Bt.split("-"),Sn=React2.useMemo(()=>le.reduce(($i,Mn,Xn)=>Xn>=Rn?$i:$i+Mn.height,0),[le,Rn]),$n=useIsDocumentHidden(),Ro=V.invert||j,ao=dn==="loading";bn.current=React2.useMemo(()=>Rn*si+Sn,[Rn,Sn]),React2.useEffect(()=>{vn.current=As},[As]),React2.useEffect(()=>{Ct(!0)},[]),React2.useEffect(()=>{const $i=Xr.current;if($i){const Mn=$i.getBoundingClientRect().height;return Wn(Mn),Z(Xn=>[{toastId:V.id,height:Mn,position:V.position},...Xn]),()=>Z(Xn=>Xn.filter(Tn=>Tn.toastId!==V.id))}},[Z,V.id]),React2.useLayoutEffect(()=>{if(!ct)return;const $i=Xr.current,Mn=$i.style.height;$i.style.height="auto";const Xn=$i.getBoundingClientRect().height;$i.style.height=Mn,Wn(Xn),Z(Tn=>Tn.find(An=>An.toastId===V.id)?Tn.map(An=>An.toastId===V.id?{...An,height:Xn}:An):[{toastId:V.id,height:Xn,position:V.position},...Tn])},[ct,V.title,V.description,Z,V.id,V.jsx,V.action,V.cancel]);const Ls=React2.useCallback(()=>{mi(!0),Ci(bn.current),Z($i=>$i.filter(Mn=>Mn.toastId!==V.id)),setTimeout(()=>{oe(V)},TIME_BEFORE_UNMOUNT)},[V,oe,Z,bn]);React2.useEffect(()=>{if(V.promise&&dn==="loading"||V.duration===1/0||V.type==="loading")return;let $i;return Q||J||$n?(()=>{if(Al.current<sa.current){const Tn=new Date().getTime()-sa.current;vn.current=vn.current-Tn}Al.current=new Date().getTime()})():(()=>{vn.current!==1/0&&(sa.current=new Date().getTime(),$i=setTimeout(()=>{V.onAutoClose==null||V.onAutoClose.call(V,V),Ls()},vn.current))})(),()=>clearTimeout($i)},[Q,J,V,dn,$n,Ls]),React2.useEffect(()=>{V.delete&&(Ls(),V.onDismiss==null||V.onDismiss.call(V,V))},[Ls,V.delete]);function qa(){var $i;if(Fe!=null&&Fe.loading){var Mn;return React2.createElement("div",{className:cn$1(xe==null?void 0:xe.loader,V==null||(Mn=V.classNames)==null?void 0:Mn.loader,"sonner-loader"),"data-visible":dn==="loading"},Fe.loading)}return React2.createElement(Loader$1,{className:cn$1(xe==null?void 0:xe.loader,V==null||($i=V.classNames)==null?void 0:$i.loader),visible:dn==="loading"})}const Wa=V.icon||(Fe==null?void 0:Fe[dn])||getAsset(dn);var oo,Tr;return React2.createElement("li",{tabIndex:0,ref:Xr,className:cn$1(qt,Dr,xe==null?void 0:xe.toast,V==null||(s=V.classNames)==null?void 0:s.toast,xe==null?void 0:xe.default,xe==null?void 0:xe[dn],V==null||(u=V.classNames)==null?void 0:u[dn]),"data-sonner-toast":"","data-rich-colors":(oo=V.richColors)!=null?oo:_e,"data-styled":!(V.jsx||V.unstyled||G),"data-mounted":ct,"data-promise":!!V.promise,"data-swiped":lr,"data-removed":li,"data-visible":Un,"data-y-position":Co,"data-x-position":Zn,"data-index":ee,"data-front":es,"data-swiping":bi,"data-dismissible":os,"data-type":dn,"data-invert":Ro,"data-swipe-out":vi,"data-swipe-direction":Me,"data-expanded":!!(Q||kt&&ct),"data-testid":V.testId,style:{"--index":ee,"--toasts-before":ee,"--z-index":se.length-ee,"--offset":`${li?Ui:bn.current}px`,"--initial-height":kt?"auto":`${Gn}px`,...ke,...V.style},onDragEnd:()=>{zi(!1),st(null),_s.current=null},onPointerDown:$i=>{$i.button!==2&&(ao||!os||(Sr.current=new Date,Ci(bn.current),$i.target.setPointerCapture($i.pointerId),$i.target.tagName!=="BUTTON"&&(zi(!0),_s.current={x:$i.clientX,y:$i.clientY})))},onPointerUp:()=>{var $i,Mn,Xn;if(vi||!os)return;_s.current=null;const Tn=Number((($i=Xr.current)==null?void 0:$i.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),tl=Number(((Mn=Xr.current)==null?void 0:Mn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),An=new Date().getTime()-((Xn=Sr.current)==null?void 0:Xn.getTime()),Pt=Te==="x"?Tn:tl,ga=Math.abs(Pt)/An;if(Math.abs(Pt)>=SWIPE_THRESHOLD||ga>.11){Ci(bn.current),V.onDismiss==null||V.onDismiss.call(V,V),at(Te==="x"?Tn>0?"right":"left":tl>0?"down":"up"),Ls(),Gi(!0);return}else{var aa,Os;(aa=Xr.current)==null||aa.style.setProperty("--swipe-amount-x","0px"),(Os=Xr.current)==null||Os.style.setProperty("--swipe-amount-y","0px")}zr(!1),zi(!1),st(null)},onPointerMove:$i=>{var Mn,Xn,Tn;if(!_s.current||!os||((Mn=window.getSelection())==null?void 0:Mn.toString().length)>0)return;const An=$i.clientY-_s.current.y,Pt=$i.clientX-_s.current.x;var ga;const aa=(ga=t.swipeDirections)!=null?ga:getDefaultSwipeDirections(Bt);!Te&&(Math.abs(Pt)>1||Math.abs(An)>1)&&st(Math.abs(Pt)>Math.abs(An)?"x":"y");let Os={x:0,y:0};const tr=Je=>1/(1.5+Math.abs(Je)/20);if(Te==="y"){if(aa.includes("top")||aa.includes("bottom"))if(aa.includes("top")&&An<0||aa.includes("bottom")&&An>0)Os.y=An;else{const Je=An*tr(An);Os.y=Math.abs(Je)<Math.abs(An)?Je:An}}else if(Te==="x"&&(aa.includes("left")||aa.includes("right")))if(aa.includes("left")&&Pt<0||aa.includes("right")&&Pt>0)Os.x=Pt;else{const Je=Pt*tr(Pt);Os.x=Math.abs(Je)<Math.abs(Pt)?Je:Pt}(Math.abs(Os.x)>0||Math.abs(Os.y)>0)&&zr(!0),(Xn=Xr.current)==null||Xn.style.setProperty("--swipe-amount-x",`${Os.x}px`),(Tn=Xr.current)==null||Tn.style.setProperty("--swipe-amount-y",`${Os.y}px`)}},ys&&!V.jsx&&dn!=="loading"?React2.createElement("button",{"aria-label":pe,"data-disabled":ao,"data-close-button":!0,onClick:ao||!os?()=>{}:()=>{Ls(),V.onDismiss==null||V.onDismiss.call(V,V)},className:cn$1(xe==null?void 0:xe.closeButton,V==null||(d=V.classNames)==null?void 0:d.closeButton)},(Tr=Fe==null?void 0:Fe.close)!=null?Tr:CloseIcon):null,(dn||V.icon||V.promise)&&V.icon!==null&&((Fe==null?void 0:Fe[dn])!==null||V.icon)?React2.createElement("div",{"data-icon":"",className:cn$1(xe==null?void 0:xe.icon,V==null||(_=V.classNames)==null?void 0:_.icon)},V.promise||V.type==="loading"&&!V.icon?V.icon||qa():null,V.type!=="loading"?Wa:null):null,React2.createElement("div",{"data-content":"",className:cn$1(xe==null?void 0:xe.content,V==null||(S=V.classNames)==null?void 0:S.content)},React2.createElement("div",{"data-title":"",className:cn$1(xe==null?void 0:xe.title,V==null||(R=V.classNames)==null?void 0:R.title)},V.jsx?V.jsx:typeof V.title=="function"?V.title():V.title),V.description?React2.createElement("div",{"data-description":"",className:cn$1(Yt,jn,xe==null?void 0:xe.description,V==null||(a=V.classNames)==null?void 0:a.description)},typeof V.description=="function"?V.description():V.description):null),React2.isValidElement(V.cancel)?V.cancel:V.cancel&&isAction(V.cancel)?React2.createElement("button",{"data-button":!0,"data-cancel":!0,style:V.cancelButtonStyle||Le,onClick:$i=>{isAction(V.cancel)&&os&&(V.cancel.onClick==null||V.cancel.onClick.call(V.cancel,$i),Ls())},className:cn$1(xe==null?void 0:xe.cancelButton,V==null||(k=V.classNames)==null?void 0:k.cancelButton)},V.cancel.label):null,React2.isValidElement(V.action)?V.action:V.action&&isAction(V.action)?React2.createElement("button",{"data-button":!0,"data-action":!0,style:V.actionButtonStyle||lt,onClick:$i=>{isAction(V.action)&&(V.action.onClick==null||V.action.onClick.call(V.action,$i),!$i.defaultPrevented&&Ls())},className:cn$1(xe==null?void 0:xe.actionButton,V==null||(O=V.classNames)==null?void 0:O.actionButton)},V.action.label):null)};function getDocumentDirection(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function assignOffset(t,s){const u={};return[t,s].forEach((d,_)=>{const S=_===1,R=S?"--mobile-offset":"--offset",a=S?MOBILE_VIEWPORT_OFFSET:VIEWPORT_OFFSET;function k(O){["top","right","bottom","left"].forEach(j=>{u[`${R}-${j}`]=typeof O=="number"?`${O}px`:O})}typeof d=="number"||typeof d=="string"?k(d):typeof d=="object"?["top","right","bottom","left"].forEach(O=>{d[O]===void 0?u[`${R}-${O}`]=a:u[`${R}-${O}`]=typeof d[O]=="number"?`${d[O]}px`:d[O]}):k(a)}),u}const Toaster=React2.forwardRef(function t(s,u){const{id:d,invert:_,position:S="bottom-right",hotkey:R=["altKey","KeyT"],expand:a,closeButton:k,className:O,offset:j,mobileOffset:V,theme:G="light",richColors:J,duration:Z,style:Y,visibleToasts:le=VISIBLE_TOASTS_AMOUNT,toastOptions:ee,dir:se=getDocumentDirection(),gap:Q=GAP,icons:oe,containerAriaLabel:_e="Notifications"}=s,[Se,ke]=React2.useState([]),Le=React2.useMemo(()=>d?Se.filter(ct=>ct.toasterId===d):Se.filter(ct=>!ct.toasterId),[Se,d]),lt=React2.useMemo(()=>Array.from(new Set([S].concat(Le.filter(ct=>ct.position).map(ct=>ct.position)))),[Le,S]),[qt,Yt]=React2.useState([]),[Ot,Bt]=React2.useState(!1),[si,kt]=React2.useState(!1),[xe,Fe]=React2.useState(G!=="system"?G:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),pe=React2.useRef(null),Te=R.join("+").replace(/Key/g,"").replace(/Digit/g,""),st=React2.useRef(null),Me=React2.useRef(!1),at=React2.useCallback(ct=>{ke(Ct=>{var li;return(li=Ct.find(mi=>mi.id===ct.id))!=null&&li.delete||ToastState.dismiss(ct.id),Ct.filter(({id:mi})=>mi!==ct.id)})},[]);return React2.useEffect(()=>ToastState.subscribe(ct=>{if(ct.dismiss){requestAnimationFrame(()=>{ke(Ct=>Ct.map(li=>li.id===ct.id?{...li,delete:!0}:li))});return}setTimeout(()=>{ReactDOM.flushSync(()=>{ke(Ct=>{const li=Ct.findIndex(mi=>mi.id===ct.id);return li!==-1?[...Ct.slice(0,li),{...Ct[li],...ct},...Ct.slice(li+1)]:[ct,...Ct]})})})}),[Se]),React2.useEffect(()=>{if(G!=="system"){Fe(G);return}if(G==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Fe("dark"):Fe("light")),typeof window>"u")return;const ct=window.matchMedia("(prefers-color-scheme: dark)");try{ct.addEventListener("change",({matches:Ct})=>{Fe(Ct?"dark":"light")})}catch{ct.addListener(({matches:li})=>{try{Fe(li?"dark":"light")}catch(mi){console.error(mi)}})}},[G]),React2.useEffect(()=>{Se.length<=1&&Bt(!1)},[Se]),React2.useEffect(()=>{const ct=Ct=>{var li;if(R.every(zi=>Ct[zi]||Ct.code===zi)){var bi;Bt(!0),(bi=pe.current)==null||bi.focus()}Ct.code==="Escape"&&(document.activeElement===pe.current||(li=pe.current)!=null&&li.contains(document.activeElement))&&Bt(!1)};return document.addEventListener("keydown",ct),()=>document.removeEventListener("keydown",ct)},[R]),React2.useEffect(()=>{if(pe.current)return()=>{st.current&&(st.current.focus({preventScroll:!0}),st.current=null,Me.current=!1)}},[pe.current]),React2.createElement("section",{ref:u,"aria-label":`${_e} ${Te}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},lt.map((ct,Ct)=>{var li;const[mi,bi]=ct.split("-");return Le.length?React2.createElement("ol",{key:ct,dir:se==="auto"?getDocumentDirection():se,tabIndex:-1,ref:pe,className:O,"data-sonner-toaster":!0,"data-sonner-theme":xe,"data-y-position":mi,"data-x-position":bi,style:{"--front-toast-height":`${((li=qt[0])==null?void 0:li.height)||0}px`,"--width":`${TOAST_WIDTH}px`,"--gap":`${Q}px`,...Y,...assignOffset(j,V)},onBlur:zi=>{Me.current&&!zi.currentTarget.contains(zi.relatedTarget)&&(Me.current=!1,st.current&&(st.current.focus({preventScroll:!0}),st.current=null))},onFocus:zi=>{zi.target instanceof HTMLElement&&zi.target.dataset.dismissible==="false"||Me.current||(Me.current=!0,st.current=zi.relatedTarget)},onMouseEnter:()=>Bt(!0),onMouseMove:()=>Bt(!0),onMouseLeave:()=>{si||Bt(!1)},onDragEnd:()=>Bt(!1),onPointerDown:zi=>{zi.target instanceof HTMLElement&&zi.target.dataset.dismissible==="false"||kt(!0)},onPointerUp:()=>kt(!1)},Le.filter(zi=>!zi.position&&Ct===0||zi.position===ct).map((zi,vi)=>{var Gi,lr;return React2.createElement(Toast,{key:zi.id,icons:oe,index:vi,toast:zi,defaultRichColors:J,duration:(Gi=ee==null?void 0:ee.duration)!=null?Gi:Z,className:ee==null?void 0:ee.className,descriptionClassName:ee==null?void 0:ee.descriptionClassName,invert:_,visibleToasts:le,closeButton:(lr=ee==null?void 0:ee.closeButton)!=null?lr:k,interacting:si,position:ct,style:ee==null?void 0:ee.style,unstyled:ee==null?void 0:ee.unstyled,classNames:ee==null?void 0:ee.classNames,cancelButtonStyle:ee==null?void 0:ee.cancelButtonStyle,actionButtonStyle:ee==null?void 0:ee.actionButtonStyle,closeButtonAriaLabel:ee==null?void 0:ee.closeButtonAriaLabel,removeToast:at,toasts:Le.filter(zr=>zr.position==zi.position),heights:qt.filter(zr=>zr.position==zi.position),setHeights:Yt,expandByDefault:a,gap:Q,expanded:Ot,swipeDirections:s.swipeDirections})})):null}))});function setRef(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function composeRefs(...t){return s=>{let u=!1;const d=t.map(_=>{const S=setRef(_,s);return!u&&typeof S=="function"&&(u=!0),S});if(u)return()=>{for(let _=0;_<d.length;_++){const S=d[_];typeof S=="function"?S():setRef(t[_],null)}}}}function useComposedRefs(...t){return reactExports.useCallback(composeRefs(...t),t)}var REACT_LAZY_TYPE=Symbol.for("react.lazy"),use=React[" use ".trim().toString()];function isPromiseLike(t){return typeof t=="object"&&t!==null&&"then"in t}function isLazyComponent(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===REACT_LAZY_TYPE&&"_payload"in t&&isPromiseLike(t._payload)}function createSlot$c(t){const s=createSlotClone$c(t),u=reactExports.forwardRef((d,_)=>{let{children:S,...R}=d;isLazyComponent(S)&&typeof use=="function"&&(S=use(S._payload));const a=reactExports.Children.toArray(S),k=a.find(isSlottable$c);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}var Slot$1=createSlot$c("Slot");function createSlotClone$c(t){const s=reactExports.forwardRef((u,d)=>{let{children:_,...S}=u;if(isLazyComponent(_)&&typeof use=="function"&&(_=use(_._payload)),reactExports.isValidElement(_)){const R=getElementRef$d(_),a=mergeProps$c(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$c=Symbol("radix.slottable");function isSlottable$c(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$c}function mergeProps$c(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$d(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}function r(t){var s,u,d="";if(typeof t=="string"||typeof t=="number")d+=t;else if(typeof t=="object")if(Array.isArray(t)){var _=t.length;for(s=0;s<_;s++)t[s]&&(u=r(t[s]))&&(d&&(d+=" "),d+=u)}else for(u in t)t[u]&&(d&&(d+=" "),d+=u);return d}function clsx(){for(var t,s,u=0,d="",_=arguments.length;u<_;u++)(t=arguments[u])&&(s=r(t))&&(d&&(d+=" "),d+=s);return d}const falsyToString=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,cx=clsx,cva=(t,s)=>u=>{var d;if((s==null?void 0:s.variants)==null)return cx(t,u==null?void 0:u.class,u==null?void 0:u.className);const{variants:_,defaultVariants:S}=s,R=Object.keys(_).map(O=>{const j=u==null?void 0:u[O],V=S==null?void 0:S[O];if(j===null)return null;const G=falsyToString(j)||falsyToString(V);return _[O][G]}),a=u&&Object.entries(u).reduce((O,j)=>{let[V,G]=j;return G===void 0||(O[V]=G),O},{}),k=s==null||(d=s.compoundVariants)===null||d===void 0?void 0:d.reduce((O,j)=>{let{class:V,className:G,...J}=j;return Object.entries(J).every(Z=>{let[Y,le]=Z;return Array.isArray(le)?le.includes({...S,...a}[Y]):{...S,...a}[Y]===le})?[...O,V,G]:O},[]);return cx(t,R,k,u==null?void 0:u.class,u==null?void 0:u.className)},concatArrays=(t,s)=>{const u=new Array(t.length+s.length);for(let d=0;d<t.length;d++)u[d]=t[d];for(let d=0;d<s.length;d++)u[t.length+d]=s[d];return u},createClassValidatorObject=(t,s)=>({classGroupId:t,validator:s}),createClassPartObject=(t=new Map,s=null,u)=>({nextPart:t,validators:s,classGroupId:u}),CLASS_PART_SEPARATOR="-",EMPTY_CONFLICTS=[],ARBITRARY_PROPERTY_PREFIX="arbitrary..",createClassGroupUtils=t=>{const s=createClassMap(t),{conflictingClassGroups:u,conflictingClassGroupModifiers:d}=t;return{getClassGroupId:R=>{if(R.startsWith("[")&&R.endsWith("]"))return getGroupIdForArbitraryProperty(R);const a=R.split(CLASS_PART_SEPARATOR),k=a[0]===""&&a.length>1?1:0;return getGroupRecursive(a,k,s)},getConflictingClassGroupIds:(R,a)=>{if(a){const k=d[R],O=u[R];return k?O?concatArrays(O,k):k:O||EMPTY_CONFLICTS}return u[R]||EMPTY_CONFLICTS}}},getGroupRecursive=(t,s,u)=>{if(t.length-s===0)return u.classGroupId;const _=t[s],S=u.nextPart.get(_);if(S){const O=getGroupRecursive(t,s+1,S);if(O)return O}const R=u.validators;if(R===null)return;const a=s===0?t.join(CLASS_PART_SEPARATOR):t.slice(s).join(CLASS_PART_SEPARATOR),k=R.length;for(let O=0;O<k;O++){const j=R[O];if(j.validator(a))return j.classGroupId}},getGroupIdForArbitraryProperty=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const s=t.slice(1,-1),u=s.indexOf(":"),d=s.slice(0,u);return d?ARBITRARY_PROPERTY_PREFIX+d:void 0})(),createClassMap=t=>{const{theme:s,classGroups:u}=t;return processClassGroups(u,s)},processClassGroups=(t,s)=>{const u=createClassPartObject();for(const d in t){const _=t[d];processClassesRecursively(_,u,d,s)}return u},processClassesRecursively=(t,s,u,d)=>{const _=t.length;for(let S=0;S<_;S++){const R=t[S];processClassDefinition(R,s,u,d)}},processClassDefinition=(t,s,u,d)=>{if(typeof t=="string"){processStringDefinition(t,s,u);return}if(typeof t=="function"){processFunctionDefinition(t,s,u,d);return}processObjectDefinition(t,s,u,d)},processStringDefinition=(t,s,u)=>{const d=t===""?s:getPart(s,t);d.classGroupId=u},processFunctionDefinition=(t,s,u,d)=>{if(isThemeGetter(t)){processClassesRecursively(t(d),s,u,d);return}s.validators===null&&(s.validators=[]),s.validators.push(createClassValidatorObject(u,t))},processObjectDefinition=(t,s,u,d)=>{const _=Object.entries(t),S=_.length;for(let R=0;R<S;R++){const[a,k]=_[R];processClassesRecursively(k,getPart(s,a),u,d)}},getPart=(t,s)=>{let u=t;const d=s.split(CLASS_PART_SEPARATOR),_=d.length;for(let S=0;S<_;S++){const R=d[S];let a=u.nextPart.get(R);a||(a=createClassPartObject(),u.nextPart.set(R,a)),u=a}return u},isThemeGetter=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,createLruCache=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,u=Object.create(null),d=Object.create(null);const _=(S,R)=>{u[S]=R,s++,s>t&&(s=0,d=u,u=Object.create(null))};return{get(S){let R=u[S];if(R!==void 0)return R;if((R=d[S])!==void 0)return _(S,R),R},set(S,R){S in u?u[S]=R:_(S,R)}}},IMPORTANT_MODIFIER="!",MODIFIER_SEPARATOR=":",EMPTY_MODIFIERS=[],createResultObject=(t,s,u,d,_)=>({modifiers:t,hasImportantModifier:s,baseClassName:u,maybePostfixModifierPosition:d,isExternal:_}),createParseClassName=t=>{const{prefix:s,experimentalParseClassName:u}=t;let d=_=>{const S=[];let R=0,a=0,k=0,O;const j=_.length;for(let Y=0;Y<j;Y++){const le=_[Y];if(R===0&&a===0){if(le===MODIFIER_SEPARATOR){S.push(_.slice(k,Y)),k=Y+1;continue}if(le==="/"){O=Y;continue}}le==="["?R++:le==="]"?R--:le==="("?a++:le===")"&&a--}const V=S.length===0?_:_.slice(k);let G=V,J=!1;V.endsWith(IMPORTANT_MODIFIER)?(G=V.slice(0,-1),J=!0):V.startsWith(IMPORTANT_MODIFIER)&&(G=V.slice(1),J=!0);const Z=O&&O>k?O-k:void 0;return createResultObject(S,J,G,Z)};if(s){const _=s+MODIFIER_SEPARATOR,S=d;d=R=>R.startsWith(_)?S(R.slice(_.length)):createResultObject(EMPTY_MODIFIERS,!1,R,void 0,!0)}if(u){const _=d;d=S=>u({className:S,parseClassName:_})}return d},createSortModifiers=t=>{const s=new Map;return t.orderSensitiveModifiers.forEach((u,d)=>{s.set(u,1e6+d)}),u=>{const d=[];let _=[];for(let S=0;S<u.length;S++){const R=u[S],a=R[0]==="[",k=s.has(R);a||k?(_.length>0&&(_.sort(),d.push(..._),_=[]),d.push(R)):_.push(R)}return _.length>0&&(_.sort(),d.push(..._)),d}},createConfigUtils=t=>({cache:createLruCache(t.cacheSize),parseClassName:createParseClassName(t),sortModifiers:createSortModifiers(t),...createClassGroupUtils(t)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(t,s)=>{const{parseClassName:u,getClassGroupId:d,getConflictingClassGroupIds:_,sortModifiers:S}=s,R=[],a=t.trim().split(SPLIT_CLASSES_REGEX);let k="";for(let O=a.length-1;O>=0;O-=1){const j=a[O],{isExternal:V,modifiers:G,hasImportantModifier:J,baseClassName:Z,maybePostfixModifierPosition:Y}=u(j);if(V){k=j+(k.length>0?" "+k:k);continue}let le=!!Y,ee=d(le?Z.substring(0,Y):Z);if(!ee){if(!le){k=j+(k.length>0?" "+k:k);continue}if(ee=d(Z),!ee){k=j+(k.length>0?" "+k:k);continue}le=!1}const se=G.length===0?"":G.length===1?G[0]:S(G).join(":"),Q=J?se+IMPORTANT_MODIFIER:se,oe=Q+ee;if(R.indexOf(oe)>-1)continue;R.push(oe);const _e=_(ee,le);for(let Se=0;Se<_e.length;++Se){const ke=_e[Se];R.push(Q+ke)}k=j+(k.length>0?" "+k:k)}return k},twJoin=(...t)=>{let s=0,u,d,_="";for(;s<t.length;)(u=t[s++])&&(d=toValue(u))&&(_&&(_+=" "),_+=d);return _},toValue=t=>{if(typeof t=="string")return t;let s,u="";for(let d=0;d<t.length;d++)t[d]&&(s=toValue(t[d]))&&(u&&(u+=" "),u+=s);return u},createTailwindMerge=(t,...s)=>{let u,d,_,S;const R=k=>{const O=s.reduce((j,V)=>V(j),t());return u=createConfigUtils(O),d=u.cache.get,_=u.cache.set,S=a,a(k)},a=k=>{const O=d(k);if(O)return O;const j=mergeClassList(k,u);return _(k,j),j};return S=R,(...k)=>S(twJoin(...k))},fallbackThemeArr=[],fromTheme=t=>{const s=u=>u[t]||fallbackThemeArr;return s.isThemeGetter=!0,s},arbitraryValueRegex=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,arbitraryVariableRegex=/^\((?:(\w[\w-]*):)?(.+)\)$/i,fractionRegex=/^\d+\/\d+$/,tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isFraction=t=>fractionRegex.test(t),isNumber=t=>!!t&&!Number.isNaN(Number(t)),isInteger=t=>!!t&&Number.isInteger(Number(t)),isPercent=t=>t.endsWith("%")&&isNumber(t.slice(0,-1)),isTshirtSize=t=>tshirtUnitRegex.test(t),isAny=()=>!0,isLengthOnly=t=>lengthUnitRegex.test(t)&&!colorFunctionRegex.test(t),isNever=()=>!1,isShadow=t=>shadowRegex.test(t),isImage=t=>imageRegex.test(t),isAnyNonArbitrary=t=>!isArbitraryValue(t)&&!isArbitraryVariable(t),isArbitrarySize=t=>getIsArbitraryValue(t,isLabelSize,isNever),isArbitraryValue=t=>arbitraryValueRegex.test(t),isArbitraryLength=t=>getIsArbitraryValue(t,isLabelLength,isLengthOnly),isArbitraryNumber=t=>getIsArbitraryValue(t,isLabelNumber,isNumber),isArbitraryPosition=t=>getIsArbitraryValue(t,isLabelPosition,isNever),isArbitraryImage=t=>getIsArbitraryValue(t,isLabelImage,isImage),isArbitraryShadow=t=>getIsArbitraryValue(t,isLabelShadow,isShadow),isArbitraryVariable=t=>arbitraryVariableRegex.test(t),isArbitraryVariableLength=t=>getIsArbitraryVariable(t,isLabelLength),isArbitraryVariableFamilyName=t=>getIsArbitraryVariable(t,isLabelFamilyName),isArbitraryVariablePosition=t=>getIsArbitraryVariable(t,isLabelPosition),isArbitraryVariableSize=t=>getIsArbitraryVariable(t,isLabelSize),isArbitraryVariableImage=t=>getIsArbitraryVariable(t,isLabelImage),isArbitraryVariableShadow=t=>getIsArbitraryVariable(t,isLabelShadow,!0),getIsArbitraryValue=(t,s,u)=>{const d=arbitraryValueRegex.exec(t);return d?d[1]?s(d[1]):u(d[2]):!1},getIsArbitraryVariable=(t,s,u=!1)=>{const d=arbitraryVariableRegex.exec(t);return d?d[1]?s(d[1]):u:!1},isLabelPosition=t=>t==="position"||t==="percentage",isLabelImage=t=>t==="image"||t==="url",isLabelSize=t=>t==="length"||t==="size"||t==="bg-size",isLabelLength=t=>t==="length",isLabelNumber=t=>t==="number",isLabelFamilyName=t=>t==="family-name",isLabelShadow=t=>t==="shadow",getDefaultConfig=()=>{const t=fromTheme("color"),s=fromTheme("font"),u=fromTheme("text"),d=fromTheme("font-weight"),_=fromTheme("tracking"),S=fromTheme("leading"),R=fromTheme("breakpoint"),a=fromTheme("container"),k=fromTheme("spacing"),O=fromTheme("radius"),j=fromTheme("shadow"),V=fromTheme("inset-shadow"),G=fromTheme("text-shadow"),J=fromTheme("drop-shadow"),Z=fromTheme("blur"),Y=fromTheme("perspective"),le=fromTheme("aspect"),ee=fromTheme("ease"),se=fromTheme("animate"),Q=()=>["auto","avoid","all","avoid-page","page","left","right","column"],oe=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],_e=()=>[...oe(),isArbitraryVariable,isArbitraryValue],Se=()=>["auto","hidden","clip","visible","scroll"],ke=()=>["auto","contain","none"],Le=()=>[isArbitraryVariable,isArbitraryValue,k],lt=()=>[isFraction,"full","auto",...Le()],qt=()=>[isInteger,"none","subgrid",isArbitraryVariable,isArbitraryValue],Yt=()=>["auto",{span:["full",isInteger,isArbitraryVariable,isArbitraryValue]},isInteger,isArbitraryVariable,isArbitraryValue],Ot=()=>[isInteger,"auto",isArbitraryVariable,isArbitraryValue],Bt=()=>["auto","min","max","fr",isArbitraryVariable,isArbitraryValue],si=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],kt=()=>["start","end","center","stretch","center-safe","end-safe"],xe=()=>["auto",...Le()],Fe=()=>[isFraction,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Le()],pe=()=>[t,isArbitraryVariable,isArbitraryValue],Te=()=>[...oe(),isArbitraryVariablePosition,isArbitraryPosition,{position:[isArbitraryVariable,isArbitraryValue]}],st=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Me=()=>["auto","cover","contain",isArbitraryVariableSize,isArbitrarySize,{size:[isArbitraryVariable,isArbitraryValue]}],at=()=>[isPercent,isArbitraryVariableLength,isArbitraryLength],ct=()=>["","none","full",O,isArbitraryVariable,isArbitraryValue],Ct=()=>["",isNumber,isArbitraryVariableLength,isArbitraryLength],li=()=>["solid","dashed","dotted","double"],mi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],bi=()=>[isNumber,isPercent,isArbitraryVariablePosition,isArbitraryPosition],zi=()=>["","none",Z,isArbitraryVariable,isArbitraryValue],vi=()=>["none",isNumber,isArbitraryVariable,isArbitraryValue],Gi=()=>["none",isNumber,isArbitraryVariable,isArbitraryValue],lr=()=>[isNumber,isArbitraryVariable,isArbitraryValue],zr=()=>[isFraction,"full",...Le()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[isTshirtSize],breakpoint:[isTshirtSize],color:[isAny],container:[isTshirtSize],"drop-shadow":[isTshirtSize],ease:["in","out","in-out"],font:[isAnyNonArbitrary],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[isTshirtSize],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[isTshirtSize],shadow:[isTshirtSize],spacing:["px",isNumber],text:[isTshirtSize],"text-shadow":[isTshirtSize],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",isFraction,isArbitraryValue,isArbitraryVariable,le]}],container:["container"],columns:[{columns:[isNumber,isArbitraryValue,isArbitraryVariable,a]}],"break-after":[{"break-after":Q()}],"break-before":[{"break-before":Q()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:_e()}],overflow:[{overflow:Se()}],"overflow-x":[{"overflow-x":Se()}],"overflow-y":[{"overflow-y":Se()}],overscroll:[{overscroll:ke()}],"overscroll-x":[{"overscroll-x":ke()}],"overscroll-y":[{"overscroll-y":ke()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:lt()}],"inset-x":[{"inset-x":lt()}],"inset-y":[{"inset-y":lt()}],start:[{start:lt()}],end:[{end:lt()}],top:[{top:lt()}],right:[{right:lt()}],bottom:[{bottom:lt()}],left:[{left:lt()}],visibility:["visible","invisible","collapse"],z:[{z:[isInteger,"auto",isArbitraryVariable,isArbitraryValue]}],basis:[{basis:[isFraction,"full","auto",a,...Le()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[isNumber,isFraction,"auto","initial","none",isArbitraryValue]}],grow:[{grow:["",isNumber,isArbitraryVariable,isArbitraryValue]}],shrink:[{shrink:["",isNumber,isArbitraryVariable,isArbitraryValue]}],order:[{order:[isInteger,"first","last","none",isArbitraryVariable,isArbitraryValue]}],"grid-cols":[{"grid-cols":qt()}],"col-start-end":[{col:Yt()}],"col-start":[{"col-start":Ot()}],"col-end":[{"col-end":Ot()}],"grid-rows":[{"grid-rows":qt()}],"row-start-end":[{row:Yt()}],"row-start":[{"row-start":Ot()}],"row-end":[{"row-end":Ot()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Bt()}],"auto-rows":[{"auto-rows":Bt()}],gap:[{gap:Le()}],"gap-x":[{"gap-x":Le()}],"gap-y":[{"gap-y":Le()}],"justify-content":[{justify:[...si(),"normal"]}],"justify-items":[{"justify-items":[...kt(),"normal"]}],"justify-self":[{"justify-self":["auto",...kt()]}],"align-content":[{content:["normal",...si()]}],"align-items":[{items:[...kt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...kt(),{baseline:["","last"]}]}],"place-content":[{"place-content":si()}],"place-items":[{"place-items":[...kt(),"baseline"]}],"place-self":[{"place-self":["auto",...kt()]}],p:[{p:Le()}],px:[{px:Le()}],py:[{py:Le()}],ps:[{ps:Le()}],pe:[{pe:Le()}],pt:[{pt:Le()}],pr:[{pr:Le()}],pb:[{pb:Le()}],pl:[{pl:Le()}],m:[{m:xe()}],mx:[{mx:xe()}],my:[{my:xe()}],ms:[{ms:xe()}],me:[{me:xe()}],mt:[{mt:xe()}],mr:[{mr:xe()}],mb:[{mb:xe()}],ml:[{ml:xe()}],"space-x":[{"space-x":Le()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Le()}],"space-y-reverse":["space-y-reverse"],size:[{size:Fe()}],w:[{w:[a,"screen",...Fe()]}],"min-w":[{"min-w":[a,"screen","none",...Fe()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[R]},...Fe()]}],h:[{h:["screen","lh",...Fe()]}],"min-h":[{"min-h":["screen","lh","none",...Fe()]}],"max-h":[{"max-h":["screen","lh",...Fe()]}],"font-size":[{text:["base",u,isArbitraryVariableLength,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,isArbitraryVariable,isArbitraryNumber]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",isPercent,isArbitraryValue]}],"font-family":[{font:[isArbitraryVariableFamilyName,isArbitraryValue,s]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[_,isArbitraryVariable,isArbitraryValue]}],"line-clamp":[{"line-clamp":[isNumber,"none",isArbitraryVariable,isArbitraryNumber]}],leading:[{leading:[S,...Le()]}],"list-image":[{"list-image":["none",isArbitraryVariable,isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",isArbitraryVariable,isArbitraryValue]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:pe()}],"text-color":[{text:pe()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...li(),"wavy"]}],"text-decoration-thickness":[{decoration:[isNumber,"from-font","auto",isArbitraryVariable,isArbitraryLength]}],"text-decoration-color":[{decoration:pe()}],"underline-offset":[{"underline-offset":[isNumber,"auto",isArbitraryVariable,isArbitraryValue]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Le()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryVariable,isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryVariable,isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Te()}],"bg-repeat":[{bg:st()}],"bg-size":[{bg:Me()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},isInteger,isArbitraryVariable,isArbitraryValue],radial:["",isArbitraryVariable,isArbitraryValue],conic:[isInteger,isArbitraryVariable,isArbitraryValue]},isArbitraryVariableImage,isArbitraryImage]}],"bg-color":[{bg:pe()}],"gradient-from-pos":[{from:at()}],"gradient-via-pos":[{via:at()}],"gradient-to-pos":[{to:at()}],"gradient-from":[{from:pe()}],"gradient-via":[{via:pe()}],"gradient-to":[{to:pe()}],rounded:[{rounded:ct()}],"rounded-s":[{"rounded-s":ct()}],"rounded-e":[{"rounded-e":ct()}],"rounded-t":[{"rounded-t":ct()}],"rounded-r":[{"rounded-r":ct()}],"rounded-b":[{"rounded-b":ct()}],"rounded-l":[{"rounded-l":ct()}],"rounded-ss":[{"rounded-ss":ct()}],"rounded-se":[{"rounded-se":ct()}],"rounded-ee":[{"rounded-ee":ct()}],"rounded-es":[{"rounded-es":ct()}],"rounded-tl":[{"rounded-tl":ct()}],"rounded-tr":[{"rounded-tr":ct()}],"rounded-br":[{"rounded-br":ct()}],"rounded-bl":[{"rounded-bl":ct()}],"border-w":[{border:Ct()}],"border-w-x":[{"border-x":Ct()}],"border-w-y":[{"border-y":Ct()}],"border-w-s":[{"border-s":Ct()}],"border-w-e":[{"border-e":Ct()}],"border-w-t":[{"border-t":Ct()}],"border-w-r":[{"border-r":Ct()}],"border-w-b":[{"border-b":Ct()}],"border-w-l":[{"border-l":Ct()}],"divide-x":[{"divide-x":Ct()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Ct()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...li(),"hidden","none"]}],"divide-style":[{divide:[...li(),"hidden","none"]}],"border-color":[{border:pe()}],"border-color-x":[{"border-x":pe()}],"border-color-y":[{"border-y":pe()}],"border-color-s":[{"border-s":pe()}],"border-color-e":[{"border-e":pe()}],"border-color-t":[{"border-t":pe()}],"border-color-r":[{"border-r":pe()}],"border-color-b":[{"border-b":pe()}],"border-color-l":[{"border-l":pe()}],"divide-color":[{divide:pe()}],"outline-style":[{outline:[...li(),"none","hidden"]}],"outline-offset":[{"outline-offset":[isNumber,isArbitraryVariable,isArbitraryValue]}],"outline-w":[{outline:["",isNumber,isArbitraryVariableLength,isArbitraryLength]}],"outline-color":[{outline:pe()}],shadow:[{shadow:["","none",j,isArbitraryVariableShadow,isArbitraryShadow]}],"shadow-color":[{shadow:pe()}],"inset-shadow":[{"inset-shadow":["none",V,isArbitraryVariableShadow,isArbitraryShadow]}],"inset-shadow-color":[{"inset-shadow":pe()}],"ring-w":[{ring:Ct()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:pe()}],"ring-offset-w":[{"ring-offset":[isNumber,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":pe()}],"inset-ring-w":[{"inset-ring":Ct()}],"inset-ring-color":[{"inset-ring":pe()}],"text-shadow":[{"text-shadow":["none",G,isArbitraryVariableShadow,isArbitraryShadow]}],"text-shadow-color":[{"text-shadow":pe()}],opacity:[{opacity:[isNumber,isArbitraryVariable,isArbitraryValue]}],"mix-blend":[{"mix-blend":[...mi(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":mi()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[isNumber]}],"mask-image-linear-from-pos":[{"mask-linear-from":bi()}],"mask-image-linear-to-pos":[{"mask-linear-to":bi()}],"mask-image-linear-from-color":[{"mask-linear-from":pe()}],"mask-image-linear-to-color":[{"mask-linear-to":pe()}],"mask-image-t-from-pos":[{"mask-t-from":bi()}],"mask-image-t-to-pos":[{"mask-t-to":bi()}],"mask-image-t-from-color":[{"mask-t-from":pe()}],"mask-image-t-to-color":[{"mask-t-to":pe()}],"mask-image-r-from-pos":[{"mask-r-from":bi()}],"mask-image-r-to-pos":[{"mask-r-to":bi()}],"mask-image-r-from-color":[{"mask-r-from":pe()}],"mask-image-r-to-color":[{"mask-r-to":pe()}],"mask-image-b-from-pos":[{"mask-b-from":bi()}],"mask-image-b-to-pos":[{"mask-b-to":bi()}],"mask-image-b-from-color":[{"mask-b-from":pe()}],"mask-image-b-to-color":[{"mask-b-to":pe()}],"mask-image-l-from-pos":[{"mask-l-from":bi()}],"mask-image-l-to-pos":[{"mask-l-to":bi()}],"mask-image-l-from-color":[{"mask-l-from":pe()}],"mask-image-l-to-color":[{"mask-l-to":pe()}],"mask-image-x-from-pos":[{"mask-x-from":bi()}],"mask-image-x-to-pos":[{"mask-x-to":bi()}],"mask-image-x-from-color":[{"mask-x-from":pe()}],"mask-image-x-to-color":[{"mask-x-to":pe()}],"mask-image-y-from-pos":[{"mask-y-from":bi()}],"mask-image-y-to-pos":[{"mask-y-to":bi()}],"mask-image-y-from-color":[{"mask-y-from":pe()}],"mask-image-y-to-color":[{"mask-y-to":pe()}],"mask-image-radial":[{"mask-radial":[isArbitraryVariable,isArbitraryValue]}],"mask-image-radial-from-pos":[{"mask-radial-from":bi()}],"mask-image-radial-to-pos":[{"mask-radial-to":bi()}],"mask-image-radial-from-color":[{"mask-radial-from":pe()}],"mask-image-radial-to-color":[{"mask-radial-to":pe()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":oe()}],"mask-image-conic-pos":[{"mask-conic":[isNumber]}],"mask-image-conic-from-pos":[{"mask-conic-from":bi()}],"mask-image-conic-to-pos":[{"mask-conic-to":bi()}],"mask-image-conic-from-color":[{"mask-conic-from":pe()}],"mask-image-conic-to-color":[{"mask-conic-to":pe()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Te()}],"mask-repeat":[{mask:st()}],"mask-size":[{mask:Me()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",isArbitraryVariable,isArbitraryValue]}],filter:[{filter:["","none",isArbitraryVariable,isArbitraryValue]}],blur:[{blur:zi()}],brightness:[{brightness:[isNumber,isArbitraryVariable,isArbitraryValue]}],contrast:[{contrast:[isNumber,isArbitraryVariable,isArbitraryValue]}],"drop-shadow":[{"drop-shadow":["","none",J,isArbitraryVariableShadow,isArbitraryShadow]}],"drop-shadow-color":[{"drop-shadow":pe()}],grayscale:[{grayscale:["",isNumber,isArbitraryVariable,isArbitraryValue]}],"hue-rotate":[{"hue-rotate":[isNumber,isArbitraryVariable,isArbitraryValue]}],invert:[{invert:["",isNumber,isArbitraryVariable,isArbitraryValue]}],saturate:[{saturate:[isNumber,isArbitraryVariable,isArbitraryValue]}],sepia:[{sepia:["",isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-filter":[{"backdrop-filter":["","none",isArbitraryVariable,isArbitraryValue]}],"backdrop-blur":[{"backdrop-blur":zi()}],"backdrop-brightness":[{"backdrop-brightness":[isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-contrast":[{"backdrop-contrast":[isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-grayscale":[{"backdrop-grayscale":["",isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-invert":[{"backdrop-invert":["",isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-opacity":[{"backdrop-opacity":[isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-saturate":[{"backdrop-saturate":[isNumber,isArbitraryVariable,isArbitraryValue]}],"backdrop-sepia":[{"backdrop-sepia":["",isNumber,isArbitraryVariable,isArbitraryValue]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Le()}],"border-spacing-x":[{"border-spacing-x":Le()}],"border-spacing-y":[{"border-spacing-y":Le()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",isArbitraryVariable,isArbitraryValue]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[isNumber,"initial",isArbitraryVariable,isArbitraryValue]}],ease:[{ease:["linear","initial",ee,isArbitraryVariable,isArbitraryValue]}],delay:[{delay:[isNumber,isArbitraryVariable,isArbitraryValue]}],animate:[{animate:["none",se,isArbitraryVariable,isArbitraryValue]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Y,isArbitraryVariable,isArbitraryValue]}],"perspective-origin":[{"perspective-origin":_e()}],rotate:[{rotate:vi()}],"rotate-x":[{"rotate-x":vi()}],"rotate-y":[{"rotate-y":vi()}],"rotate-z":[{"rotate-z":vi()}],scale:[{scale:Gi()}],"scale-x":[{"scale-x":Gi()}],"scale-y":[{"scale-y":Gi()}],"scale-z":[{"scale-z":Gi()}],"scale-3d":["scale-3d"],skew:[{skew:lr()}],"skew-x":[{"skew-x":lr()}],"skew-y":[{"skew-y":lr()}],transform:[{transform:[isArbitraryVariable,isArbitraryValue,"","none","gpu","cpu"]}],"transform-origin":[{origin:_e()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:zr()}],"translate-x":[{"translate-x":zr()}],"translate-y":[{"translate-y":zr()}],"translate-z":[{"translate-z":zr()}],"translate-none":["translate-none"],accent:[{accent:pe()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:pe()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryVariable,isArbitraryValue]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Le()}],"scroll-mx":[{"scroll-mx":Le()}],"scroll-my":[{"scroll-my":Le()}],"scroll-ms":[{"scroll-ms":Le()}],"scroll-me":[{"scroll-me":Le()}],"scroll-mt":[{"scroll-mt":Le()}],"scroll-mr":[{"scroll-mr":Le()}],"scroll-mb":[{"scroll-mb":Le()}],"scroll-ml":[{"scroll-ml":Le()}],"scroll-p":[{"scroll-p":Le()}],"scroll-px":[{"scroll-px":Le()}],"scroll-py":[{"scroll-py":Le()}],"scroll-ps":[{"scroll-ps":Le()}],"scroll-pe":[{"scroll-pe":Le()}],"scroll-pt":[{"scroll-pt":Le()}],"scroll-pr":[{"scroll-pr":Le()}],"scroll-pb":[{"scroll-pb":Le()}],"scroll-pl":[{"scroll-pl":Le()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryVariable,isArbitraryValue]}],fill:[{fill:["none",...pe()]}],"stroke-w":[{stroke:[isNumber,isArbitraryVariableLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:["none",...pe()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...t){return twMerge(clsx(t))}const buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function Button({className:t,variant:s,size:u,asChild:d=!1,..._}){const S=d?Slot$1:"button";return jsxRuntimeExports.jsx(S,{"data-slot":"button",className:cn(buttonVariants({variant:s,size:u,className:t})),..._})}/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,u,d)=>d?d.toUpperCase():u.toLowerCase()),toPascalCase=t=>{const s=toCamelCase(t);return s.charAt(0).toUpperCase()+s.slice(1)},mergeClasses=(...t)=>t.filter((s,u,d)=>!!s&&s.trim()!==""&&d.indexOf(s)===u).join(" ").trim(),hasA11yProp=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:u=2,absoluteStrokeWidth:d,className:_="",children:S,iconNode:R,...a},k)=>reactExports.createElement("svg",{ref:k,...defaultAttributes,width:s,height:s,stroke:t,strokeWidth:d?Number(u)*24/Number(s):u,className:mergeClasses("lucide",_),...!S&&!hasA11yProp(a)&&{"aria-hidden":"true"},...a},[...R.map(([O,j])=>reactExports.createElement(O,j)),...Array.isArray(S)?S:[S]]));/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(t,s)=>{const u=reactExports.forwardRef(({className:d,..._},S)=>reactExports.createElement(Icon,{ref:S,iconNode:s,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(t))}`,`lucide-${t}`,d),..._}));return u.displayName=toPascalCase(t),u};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$C=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ArrowDown=createLucideIcon("arrow-down",__iconNode$C);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$B=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$B);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$A=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ArrowRight=createLucideIcon("arrow-right",__iconNode$A);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$z=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],ArrowUp=createLucideIcon("arrow-up",__iconNode$z);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$y=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Calendar=createLucideIcon("calendar",__iconNode$y);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$x=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Camera=createLucideIcon("camera",__iconNode$x);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$w=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ChartColumn=createLucideIcon("chart-column",__iconNode$w);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$v=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Check=createLucideIcon("check",__iconNode$v);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$u=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],ChevronsUpDown=createLucideIcon("chevrons-up-down",__iconNode$u);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$t=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],CircleCheckBig=createLucideIcon("circle-check-big",__iconNode$t);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$s=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Circle=createLucideIcon("circle",__iconNode$s);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$r=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Clock=createLucideIcon("clock",__iconNode$r);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$q=[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]],Construction=createLucideIcon("construction",__iconNode$q);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$p=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],EyeOff=createLucideIcon("eye-off",__iconNode$p);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Eye=createLucideIcon("eye",__iconNode$o);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$n=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],FileText=createLucideIcon("file-text",__iconNode$n);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$m=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Github=createLucideIcon("github",__iconNode$m);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$l=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],LayoutDashboard=createLucideIcon("layout-dashboard",__iconNode$l);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$k=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],Linkedin=createLucideIcon("linkedin",__iconNode$k);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$j=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Loader=createLucideIcon("loader",__iconNode$j);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$i=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],LogIn=createLucideIcon("log-in",__iconNode$i);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$h=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],LogOut=createLucideIcon("log-out",__iconNode$h);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$g=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Mail=createLucideIcon("mail",__iconNode$g);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$f=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],MapPin=createLucideIcon("map-pin",__iconNode$f);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$e=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Phone=createLucideIcon("phone",__iconNode$e);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$d=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Plus=createLucideIcon("plus",__iconNode$d);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$c=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$c);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$b=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Send=createLucideIcon("send",__iconNode$b);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$a=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Shield=createLucideIcon("shield",__iconNode$a);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$9=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],SquarePen=createLucideIcon("square-pen",__iconNode$9);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$8=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Trash2=createLucideIcon("trash-2",__iconNode$8);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$7=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],Trash=createLucideIcon("trash",__iconNode$7);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$6=[["path",{d:"M8 19a4 4 0 0 1-2.24-7.32A3.5 3.5 0 0 1 9 6.03V6a3 3 0 1 1 6 0v.04a3.5 3.5 0 0 1 3.24 5.65A4 4 0 0 1 16 19Z",key:"oadzkq"}],["path",{d:"M12 19v3",key:"npa21l"}]],TreeDeciduous=createLucideIcon("tree-deciduous",__iconNode$6);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$5=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Upload=createLucideIcon("upload",__iconNode$5);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$4=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],User=createLucideIcon("user",__iconNode$4);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$3=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Users=createLucideIcon("users",__iconNode$3);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$2=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],Wrench=createLucideIcon("wrench",__iconNode$2);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],X=createLucideIcon("x",__iconNode$1);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Zap=createLucideIcon("zap",__iconNode),civicIssueLogo="/Civicx/assets/civic-issue-DgP26xGd.png",handleSupportClick=()=>{const t="support@gmail.com",s=encodeURIComponent("Support Request - Civic Report"),u=encodeURIComponent(`Hello Support Team,

I need help with the following issue:

[Describe your issue here]

Thank you.`);window.location.href=`mailto:${t}?subject=${s}&body=${u}`},Header$1=({onFeaturesClick:t,onHowItWorksClick:s})=>{const{user:u,logout:d}=useAuth(),_=()=>{d()};return jsxRuntimeExports.jsx("header",{className:`\r
        w-full\r
        fixed top-0 left-0 right-0\r
        z-50\r
        bg-white/30\r
        backdrop-blur-md\r
        border-b border-gray-200/50\r
        supports-[backdrop-filter]:bg-white/30\r
      `,children:jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:jsxRuntimeExports.jsxs("div",{className:"flex h-16 items-center justify-between",children:[jsxRuntimeExports.jsxs(Link,{to:"/",className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-17 h-17 rounded-lg",children:jsxRuntimeExports.jsx("img",{src:civicIssueLogo,alt:"civicIssueLogo"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-xlz font-bold text-foreground",children:"CivicIssueRepoter"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Building Better Communities"})]})]}),jsxRuntimeExports.jsxs("nav",{className:"hidden lg:flex items-center space-x-8",children:[jsxRuntimeExports.jsx("a",{href:"#features",className:`relative text-foreground font-medium transition-all duration-200\r
               after:absolute after:-bottom-1 after:left-0 after:h-[2px] after:w-0 after:bg-cyan-500\r
               after:transition-all after:duration-200\r
               hover:text-cyan-500 hover:after:w-full\r
               focus-visible:text-cyan-500 focus-visible:after:w-full outline-none`,onClick:S=>{S.preventDefault(),t&&t()},children:"Features"}),jsxRuntimeExports.jsx("a",{href:"#how-it-works",className:`relative text-foreground font-medium transition-all duration-200\r
               after:absolute after:-bottom-1 after:left-0 after:h-[2px] after:w-0 after:bg-cyan-500\r
               after:transition-all after:duration-200\r
               hover:text-cyan-500 hover:after:w-full\r
               focus-visible:text-cyan-500 focus-visible:after:w-full outline-none`,onClick:S=>{S.preventDefault(),s&&s()},children:"How It Works"}),jsxRuntimeExports.jsx("a",{href:"#contact",onClick:handleSupportClick,className:`relative text-foreground font-medium transition-all duration-200\r
               after:absolute after:-bottom-1 after:left-0 after:h-[2px] after:w-0 after:bg-cyan-500\r
               after:transition-all after:duration-200\r
               hover:text-cyan-500 hover:after:w-full\r
               focus-visible:text-cyan-500 focus-visible:after:w-full outline-none`,children:"Contact"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-3",children:u?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:block",children:["Welcome,"," ",u!=null&&u.fullName?u.fullName.split(" ")[0]:"Guest","!"]}),jsxRuntimeExports.jsx(Link,{to:u.role==="citizen"?"/citizen":"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 text-blue-700"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:block",children:"Dashboard"})]})}),jsxRuntimeExports.jsxs(Button,{onClick:_,variant:"outline",size:"sm",className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(LogOut,{className:"h-4 w-4 text-blue-700"}),jsxRuntimeExports.jsx("span",{children:"Logout"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Link,{to:"/signin",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"hidden sm:flex items-center space-x-2 text-slate-700",children:[jsxRuntimeExports.jsx(LogIn,{className:"h-4 w-4 text-blue-600"}),jsxRuntimeExports.jsx("span",{children:"Sign In"})]})}),jsxRuntimeExports.jsx(Link,{to:"/signup",children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"flex items-center space-x-2 civic-gradient border-0 text-white hover:opacity-90",children:[jsxRuntimeExports.jsx(Shield,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Sign Up"})]})})]})})]})})})};function Card({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"card",className:cn("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function CardHeader({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"card-header",className:cn("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function CardTitle({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"card-title",className:cn("leading-none font-semibold",t),...s})}function CardDescription({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"card-description",className:cn("text-muted-foreground text-sm",t),...s})}function CardContent({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"card-content",className:cn("px-6",t),...s})}const fadeInUp$1={hidden:{opacity:0,y:50},visible:t=>({opacity:1,y:0,transition:{delay:t*.1,duration:.5}})},Features=()=>{const t=[{icon:Camera,title:"Photo Documentation",description:"Capture and upload high-quality images of infrastructure issues with automatic metadata tagging.",color:"text-blue-600"},{icon:MapPin,title:"GPS Location Tracking",description:"Precise location capture using GPS coordinates ensures accurate issue positioning and faster response.",color:"text-green-600"},{icon:Users,title:"Community Engagement",description:"Connect with neighbors, track issue status, and see the impact of your reports on the community.",color:"text-purple-600"},{icon:Zap,title:"Real-time Updates",description:"Get instant notifications about your reported issues and track resolution progress in real-time.",color:"text-orange-600"},{icon:Shield,title:"Admin Dashboard",description:"Comprehensive administrative tools for managing reports, assigning tasks, and monitoring city-wide issues.",color:"text-red-600"},{icon:ChartColumn,title:"Analytics & Insights",description:"Data-driven insights help administrators prioritize resources and track community improvement trends.",color:"text-indigo-600"}];return jsxRuntimeExports.jsx("section",{id:"features",className:"py-20 bg-muted/30",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-16",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-foreground mb-4",children:"Powerful Features for Better Communities"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Everything you need to report, track, and resolve civic issues efficiently and effectively."})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((s,u)=>jsxRuntimeExports.jsx(motion.div,{variants:fadeInUp$1,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},custom:u,children:jsxRuntimeExports.jsxs(Card,{className:` backdrop-blur-md \r
  bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  transition-transform \r
  hover:scale-[1.02]\r
] \r
   `,children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-background flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300",children:jsxRuntimeExports.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})}),jsxRuntimeExports.jsx(CardTitle,{className:"text-xl text-foreground",children:s.title})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx(CardDescription,{className:"text-muted-foreground leading-relaxed",children:s.description})})]})},s.title))})]})})},fadeInUp={hidden:{opacity:0,y:50},visible:t=>({opacity:1,y:0,transition:{delay:t*.15,duration:.5}})},HowItWorks=()=>{const t=[{icon:Camera,title:"Capture the Issue",description:"Take a clear photo of the infrastructure problem using your mobile device or camera.",color:"bg-blue-500"},{icon:MapPin,title:"Add Location Details",description:"GPS automatically captures the exact location, or manually adjust for precision.",color:"bg-green-500"},{icon:Send,title:"Submit Your Report",description:"Add a brief description and submit your report to the appropriate authorities.",color:"bg-purple-500"},{icon:CircleCheckBig,title:"Track Progress",description:"Monitor the status of your report and receive updates when action is taken.",color:"bg-orange-500"}];return jsxRuntimeExports.jsx("section",{id:"how-it-works",className:"py-20",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-16",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-foreground mb-4",children:"How It Works"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Reporting civic issues is simple and straightforward. Follow these four easy steps to make a difference."})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"hidden lg:block absolute top-1/2 left-0 right-0 h-0.5 bg-border transform -translate-y-1/2"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 relative z-10",children:t.map((s,u)=>jsxRuntimeExports.jsx(motion.div,{variants:fadeInUp,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},custom:u,children:jsxRuntimeExports.jsx(Card,{className:"group  backdrop-blur-md hover:shadow-lg transition-all duration-300 hover:-translate-y-2 bg-white/70 shadow-lg   ",children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6 text-center",children:[jsxRuntimeExports.jsxs("div",{className:"relative mb-6",children:[jsxRuntimeExports.jsx("div",{className:`w-16 h-16 ${s.color} rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300`,children:jsxRuntimeExports.jsx(s.icon,{className:"h-8 w-8 text-white"})}),jsxRuntimeExports.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:u+1})]}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-foreground mb-3",children:s.title}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground leading-relaxed",children:s.description})]})})},s.title))})]})]})})},Hero=()=>{const{user:t}=useAuth();return jsxRuntimeExports.jsx("section",{className:"relative overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-20 lg:py-16 mt-20",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-8 animate-slide-in-left",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-bold text-foreground leading-tight",children:["Report Issues,",jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"text-white bg-clip-text civic-gradient px-2 rounded-lg",children:"Transform"}),jsxRuntimeExports.jsx("br",{}),"Your Community"]}),jsxRuntimeExports.jsx("p",{className:"text-xl text-muted-foreground max-w-lg",children:"Help build safer, cleaner neighborhoods by reporting infrastructure issues. From potholes to broken streetlights, your voice matters."})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[jsxRuntimeExports.jsx(Link,{to:(t==null?void 0:t.role)==="citizen"?"/citizen/create-issue":(t==null?void 0:t.role)==="admin"?"/":"/signin",children:jsxRuntimeExports.jsxs(Button,{size:"lg",className:`relative civic-gradient border-0 text-white flex items-center space-x-2 cursor-pointer \r
             overflow-hidden  px-6 py-3 shadow-lg \r
             transition-all duration-300 ease-out\r
             hover:scale-[1.04] hover:shadow-xl group`,children:[jsxRuntimeExports.jsx("span",{className:`absolute inset-0 bg-white/20 translate-x-[-150%] skew-x-12 \r
                   group-hover:translate-x-[150%] transition-transform duration-700 ease-out`}),jsxRuntimeExports.jsx(Camera,{className:"h-5 w-5 transition-transform duration-300 group-hover:-translate-y-0.5"}),jsxRuntimeExports.jsx("span",{className:"relative z-10",children:"Report an Issue"}),jsxRuntimeExports.jsx(ArrowRight,{className:"h-5 w-5 transition-transform duration-300 group-hover:translate-x-1"})]})}),jsxRuntimeExports.jsx(Link,{to:(t==null?void 0:t.role)==="citizen"?"/citizen":"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"lg",className:"flex items-center space-x-2 cursor-pointer",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-5 w-5 text-green-600"}),jsxRuntimeExports.jsx("span",{children:"View Reports"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-6 pt-8 border-t",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-sky-500",children:"2,847"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground",children:"Issues Resolved"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-sky-500",children:"15,239"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Citizens"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-sky-500",children:"48h"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Response"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"relative animate-slide-in-right",children:jsxRuntimeExports.jsxs("div",{className:"relative group rounded-2xl overflow-hidden shadow-2xl",children:[jsxRuntimeExports.jsx("img",{src:"https://images.unsplash.com/photo-1433086966358-54859d0ed716?q=80&w=800&h=600&fit=crop",alt:"Infrastructure and community",className:`w-full h-[500px] object-cover transition-all duration-700 ease-[cubic-bezier(.2,.8,.2,1)] will-change-transform\r
                 group-hover:scale-[1.06] group-hover:rotate-[0.6deg] group-hover:brightness-95`}),jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-gradient-to-tr from-black/20 via-transparent to-black/10 opacity-0\r
                    transition-opacity duration-700 ease-out group-hover:opacity-100`}),jsxRuntimeExports.jsx("span",{"aria-hidden":!0,className:`pointer-events-none absolute inset-y-0 -left-1/3 w-1/3 skew-x-12 bg-white/10 blur-md opacity-0\r
                 transition-opacity duration-700 group-hover:opacity-100 group-hover:animate-hero-shine`}),jsxRuntimeExports.jsx("div",{className:`absolute top-6 left-6 bg-white/70 backdrop-blur-md border border-white/30 rounded-xl shadow-lg p-4\r
                 transition-all duration-500 ease-out\r
                 group-hover:translate-y-1 group-hover:scale-[1.02]`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full shadow-[0_0_10px_2px_rgba(34,197,94,0.6)]"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Issue Reported"})]})}),jsxRuntimeExports.jsx("div",{className:`absolute bottom-6 right-6 bg-white/70 backdrop-blur-md border border-white/30 rounded-xl shadow-lg p-4\r
                 transition-all duration-500 ease-out delay-100\r
                 group-hover:-translate-y-1 group-hover:scale-[1.02]`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Users,{className:"h-5 w-5 text-primary"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Community Active"})]})}),jsxRuntimeExports.jsx("div",{className:`pointer-events-none absolute inset-0 ring-0 ring-white/0 group-hover:ring-1 group-hover:ring-white/30\r
                    transition-all duration-500`})]})})]})})})},IssueTypes=()=>{const t=[{icon:Construction,title:"Road Infrastructure",description:"Report potholes, damaged roads, broken sidewalks, and street maintenance issues.",image:"https://images.unsplash.com/photo-1547399152-f5bbd6a254b8?q=80&w=1176&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",count:"1,247 reports"},{icon:Trash,title:"Waste Management",description:"Report illegal dumping, overflowing bins, litter, and garbage collection issues.",image:"https://plus.unsplash.com/premium_photo-1663076452996-abef3ccfc4f4?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",count:"892 reports"},{icon:TreeDeciduous,title:"Environmental Issues",description:"Report damaged trees, fallen branches, landscaping problems, and green space issues.",image:"https://plus.unsplash.com/premium_photo-1664298311043-46b3814a511f?w=1000&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8Y2xpbWF0ZSUyMGNoYW5nZXxlbnwwfHwwfHx8MA%3D%3D",count:"534 reports"},{icon:Wrench,title:"Utilities & Infrastructure",description:"Report water leaks, gas issues, electrical problems, and utility infrastructure concerns.",image:"https://images.unsplash.com/photo-1591645321243-3adc1e75cfdc?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fGluZnJhc3RydWN0dXJlfGVufDB8fDB8fHww",count:"678 reports"}];return jsxRuntimeExports.jsx("section",{className:"py-20 bg-muted/30",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-16 animate-fade-in",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-foreground mb-4",children:"What Can You Report?"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Our platform covers a wide range of civic issues to help keep your community safe and well-maintained."})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:t.map((s,u)=>jsxRuntimeExports.jsxs(Card,{className:"group  bg-white/70 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 animate-fade-in overflow-hidden",style:{animationDelay:`${u*.1}s`},children:[jsxRuntimeExports.jsxs("div",{className:"relative h-48 overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),jsxRuntimeExports.jsx("div",{className:"absolute top-4 left-4 w-10 h-10 bg-white/90 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 left-4 text-white",children:jsxRuntimeExports.jsx("div",{className:"text-sm font-medium",children:s.count})})]}),jsxRuntimeExports.jsx(CardHeader,{className:"pb-2",children:jsxRuntimeExports.jsx(CardTitle,{className:"text-lg",children:s.title})}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:s.description})})]},u))})]})})},CTA=()=>jsxRuntimeExports.jsxs("section",{className:"py-20 relative overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 civic-gradient opacity-95"}),jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 relative z-10",children:jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto text-center animate-fade-in",children:[jsxRuntimeExports.jsx("h2",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-6",children:"Ready to Make a Difference?"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-white/90 mb-12 max-w-2xl mx-auto",children:"Join thousands of engaged citizens working together to build safer, cleaner, and better communities. Your report can spark positive change."}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto mb-12",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-6 text-center",children:[jsxRuntimeExports.jsx(Users,{className:"h-12 w-12 text-white mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"For Citizens"}),jsxRuntimeExports.jsx("p",{className:"text-white/80 text-sm mb-4",children:"Report issues, track progress, and engage with your community"}),jsxRuntimeExports.jsx(Link,{to:"/citizen",children:jsxRuntimeExports.jsxs(Button,{variant:"secondary",className:"w-full flex items-center justify-center space-x-2",children:[jsxRuntimeExports.jsx("span",{children:"Get Started"}),jsxRuntimeExports.jsx(ArrowRight,{className:"h-4 w-4"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-6 text-center",children:[jsxRuntimeExports.jsx(Shield,{className:"h-12 w-12 text-white mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"For Administrators"}),jsxRuntimeExports.jsx("p",{className:"text-white/80 text-sm mb-4",children:"Manage reports, coordinate responses, and track city-wide data"}),jsxRuntimeExports.jsx(Link,{to:"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"secondary",className:"w-full flex items-center justify-center space-x-2",children:[jsxRuntimeExports.jsx("span",{children:"Admin Access"}),jsxRuntimeExports.jsx(ArrowRight,{className:"h-4 w-4"})]})})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-white/80 mb-4",children:"Questions? Contact our support team"}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:handleSupportClick,className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:"Get Support"})]})]})})]}),Footer=()=>jsxRuntimeExports.jsx("footer",{className:"bg-background border-t",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg",children:jsxRuntimeExports.jsx("img",{src:civicIssueLogo,alt:"civicIssueLogo"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-foreground",children:"CivicIssueRepoter"})]}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Empowering communities to report and resolve civic issues through technology and civic engagement."}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"p-2",children:jsxRuntimeExports.jsx(X,{className:"h-4 w-4"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"p-2",children:jsxRuntimeExports.jsx(Github,{className:"h-4 w-4"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"p-2",children:jsxRuntimeExports.jsx(Linkedin,{className:"h-4 w-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-lg font-semibold text-foreground",children:"Quick Links"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Link,{to:"/report-issue",children:jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("span",{className:"text-muted-foreground hover:text-primary transition-colors",children:"Report Issue"})})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:"View Reports"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#how-it-works",className:"text-muted-foreground hover:text-primary transition-colors",children:"How It Works"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:"Community Guidelines"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-lg font-semibold text-foreground",children:"Support"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2",children:[jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:"Help Center"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:"Privacy Policy"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:"Terms of Service"})}),jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("a",{href:"#",onClick:handleSupportClick,className:"text-muted-foreground hover:text-primary transition-colors",children:"Contact Us"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-lg font-semibold text-foreground",children:"Contact"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Mail,{className:"h-4 w-4 text-muted-foreground"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"support@civicreport.com"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Phone,{className:"h-4 w-4 text-muted-foreground"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"+91 0123456789"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-4 w-4 text-muted-foreground mt-1"}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:["123 Civic Center",jsxRuntimeExports.jsx("br",{}),"Community City, CC 12345"]})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t mt-12 pt-8 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:" 2024 CivicIssueRepoter. All rights reserved. Building better communities together."})})]})}),Index=()=>{const[t,s]=reactExports.useState(0),[u,d]=reactExports.useState(0),_=()=>{var R;s(a=>a+1),(R=document.getElementById("features"))==null||R.scrollIntoView({behavior:"smooth"})},S=()=>{var R;d(a=>a+1),(R=document.getElementById("how-it-works"))==null||R.scrollIntoView({behavior:"smooth"})};return jsxRuntimeExports.jsxs("div",{className:"relative min-h-screen overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-0 ",style:{backgroundImage:`
    radial-gradient(circle at top left, rgba(255,255,255,0.6) 0%, transparent 35%),
    radial-gradient(circle at bottom right, rgba(255,255,255,0.5) 0%, transparent 35%),
    linear-gradient(135deg, #f2f6f6 0%, #e8ecef 35%, #f9eeee 100%)
  `,backgroundAttachment:"fixed",backgroundBlendMode:"screen"}}),jsxRuntimeExports.jsx("div",{className:"relative z-10",children:jsxRuntimeExports.jsxs(AuthProvider,{children:[jsxRuntimeExports.jsx(Header$1,{onFeaturesClick:_,onHowItWorksClick:S}),jsxRuntimeExports.jsx(Hero,{}),jsxRuntimeExports.jsx(Features,{},`features-${t}`),jsxRuntimeExports.jsx(IssueTypes,{}),jsxRuntimeExports.jsx(HowItWorks,{},`how-${u}`),jsxRuntimeExports.jsx(CTA,{}),jsxRuntimeExports.jsx(Footer,{})]})})]})};function Input({className:t,type:s,...u}){return jsxRuntimeExports.jsx("input",{type:s,"data-slot":"input",className:cn("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...u})}const v$1="4.8.0",meta={g:"LottieFiles AE 1.1.0",a:"",k:"",d:"",tc:""},fr$1=29.9700012207031,ip$1=0,op$1=77.0000031362743,w$1=1e3,h$1=1e3,nm$1="Comp 1",ddd$1=0,assets$1=[],layers$1=JSON.parse('[{"ddd":0,"ind":1,"ty":4,"nm":"Shape Layer 2","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[480,506,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[41,-30],[34,-78],[-36.607,20.098],[40,-43],[-71,185],[26,-28]],"o":[[0,0],[-30.454,22.283],[-34,78],[51,-28],[-61.995,66.645],[70.57,-183.88],[-26,28]],"v":[[-142,44],[-139,140],[-352,106],[-171,308],[-204,227],[-313,168],[-413,67]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":2,"ix":5},"lc":1,"lj":1,"ml":4,"bm":0,"d":[{"n":"d","nm":"dash","v":{"a":0,"k":30,"ix":1}},{"n":"g","nm":"gap","v":{"a":0,"k":1369,"ix":2}},{"n":"o","nm":"offset","v":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":32,"s":[103]},{"t":70.0000028511585,"s":[-1303]}],"ix":7}}],"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":22.0000008960784,"op":1810.00007372281,"st":12.00000048877,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"Shape Layer 1","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[500,500,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[41,-30],[34,-78],[-36.607,20.098],[40,-43],[-71,185],[26,-28]],"o":[[0,0],[-30.454,22.283],[-34,78],[51,-28],[-61.995,66.645],[70.57,-183.88],[-26,28]],"v":[[-142,44],[-139,140],[-352,106],[-171,308],[-204,227],[-313,168],[-413,67]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":2,"ix":5},"lc":1,"lj":1,"ml":4,"bm":0,"d":[{"n":"d","nm":"dash","v":{"a":0,"k":12,"ix":1}},{"n":"g","nm":"gap","v":{"a":0,"k":1369,"ix":2}},{"n":"o","nm":"offset","v":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":20,"s":[103]},{"t":58.0000023623884,"s":[-1303]}],"ix":7}}],"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":22.0000008960784,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"head/boxgirl2 Outlines","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":9,"s":[0]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":45,"s":[-5]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":50,"s":[-5]},{"t":75.0000030548126,"s":[0]}],"ix":10},"p":{"a":0,"k":[504.173,279.4,0],"ix":2},"a":{"a":0,"k":[615.874,302.163,0],"ix":1},"s":{"a":0,"k":[83,83,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0.203,0],[0,0],[0.188,-0.112],[0.266,-0.265],[0.11,-0.275],[-0.203,0],[0,0],[-0.188,0.113],[-0.266,0.266],[-0.11,0.274]],"o":[[0,0],[-0.231,0],[-0.322,0.194],[-0.206,0.206],[-0.041,0.103],[0,0],[0.232,0],[0.322,-0.194],[0.206,-0.205],[0.041,-0.104]],"v":[[3.115,-1.01],[-1.033,-1.01],[-1.711,-0.745],[-2.621,-0.032],[-3.193,0.682],[-3.115,1.01],[1.032,1.01],[1.711,0.745],[2.621,0.031],[3.193,-0.682]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,1,1,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[592.024,140.01],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0.441,0],[0,0],[0.377,-0.376],[-0.441,0],[0,0],[-0.377,0.376]],"o":[[0,0],[-0.571,0],[-0.086,0.085],[0,0],[0.572,0],[0.085,-0.085]],"v":[[4.643,-1.01],[-2.561,-1.01],[-4.149,-0.032],[-4.643,1.01],[2.56,1.01],[4.149,0.032]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,1,1,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[589.932,134.862],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":2,"cix":2,"bm":0,"ix":2,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0.203,0],[0,0],[0.187,-0.112],[0.266,-0.265],[0.109,-0.275],[-0.203,0],[0,0],[-0.188,0.113],[-0.266,0.265],[-0.11,0.274]],"o":[[0,0],[-0.232,0],[-0.323,0.194],[-0.206,0.206],[-0.042,0.103],[0,0],[0.232,0],[0.322,-0.193],[0.206,-0.206],[0.041,-0.104]],"v":[[2.569,-1.01],[-0.487,-1.01],[-1.165,-0.745],[-2.076,-0.032],[-2.647,0.682],[-2.57,1.01],[0.486,1.01],[1.165,0.745],[2.075,0.032],[2.647,-0.682]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,1,1,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[594.189,130.405],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":2,"cix":2,"bm":0,"ix":3,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0.697,0.13],[1.381,-1.402],[-1.277,-1.162],[-0.539,-2.933],[1.291,0.371],[0.599,1.294],[-0.397,-0.857],[-2.347,3.604],[1.566,1.335],[1.014,0.42],[0.075,0.558],[-0.756,-0.141]],"o":[[-1.872,-0.349],[-1.032,1.047],[1.762,1.602],[0.338,1.839],[-1.421,-0.409],[-0.212,-0.458],[1.982,4.281],[1.124,-1.727],[-0.848,-0.723],[-0.383,-0.158],[-0.118,-0.875],[0.82,0.152]],"v":[[2.104,-7.117],[-2.682,-5.892],[-3.188,-2.149],[2.92,2.141],[-0.213,3.831],[-3.175,1.063],[-5.296,3.185],[4.569,3.198],[3.753,-1.848],[0.801,-3.374],[-1.262,-4.469],[0.261,-4.868]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,1,1,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[602.895,136.398],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 4","np":2,"cix":2,"bm":0,"ix":4,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-5.784,2.336]],"o":[[0,0],[0,0]],"v":[[-6.716,-0.848],[6.716,-1.168]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0,0.6509803921568628,0.6,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[605.021,201.209],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 5","np":3,"cix":2,"bm":0,"ix":5,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-5.784,2.336]],"o":[[0,0],[0,0]],"v":[[-6.716,-2.008],[6.716,-0.328]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0,0.6509803921568628,0.6,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[582.244,200.369],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 6","np":3,"cix":2,"bm":0,"ix":6,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0.901,0.241],[8.078,-4.259],[-3.323,-5.913],[-6.748,-0.677],[-6.62,1.477],[0,0]],"o":[[-0.963,-0.223],[-21.25,-5.699],[-6,3.163],[3.324,5.912],[6.748,0.678],[0,0],[0,0]],"v":[[22.043,0.722],[19.248,0.025],[-14.734,-11.997],[-18.914,5.764],[-1.981,15.578],[22.237,12.775],[19.248,0.025]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0,0.6509803921568628,0.6,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[543.515,174.404],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 7","np":3,"cix":2,"bm":0,"ix":7,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[-27.722,-3.24],[2.66,-27.783],[19.547,5.242],[8.078,-4.258],[-3.324,-5.912],[-6.748,-0.677],[-6.62,1.476],[0,0]],"o":[[0,0],[3.818,-27.648],[27.722,3.24],[-63.214,18.371],[-21.25,-5.699],[-6,3.163],[3.323,5.912],[6.748,0.678],[0,0],[0,0]],"v":[[-72.745,16.895],[-29.706,4.359],[30.081,-41.908],[77.588,16.899],[-38.763,28.917],[-72.745,16.895],[-76.924,34.656],[-59.992,44.47],[-35.774,41.668],[-38.763,28.917]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.050980392156862744,0.7764705882352941,0.7215686274509804,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[601.526,145.512],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 8","np":3,"cix":2,"bm":0,"ix":8,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-2.734,-12.941],[-15.624,-0.096],[-3.417,15.247]],"o":[[2.734,12.941],[3.23,15.288],[15.625,0.095],[0,0]],"v":[[-36.33,-25.893],[-31.201,-1.615],[2.397,25.799],[36.33,-1.201]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[602.33,214.252],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 9","np":2,"cix":2,"bm":0,"ix":9,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[6.091,-7.297]],"o":[[-0.924,12.992],[0,0]],"v":[[5.451,-19.487],[-5.451,19.487]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[594.411,259.908],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 10","np":2,"cix":2,"bm":0,"ix":10,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":4,"s":[{"i":[[0,0],[1.404,-13.995],[-7.319,-22.945],[-22.358,-8.953],[-13.565,19.901],[22.678,8.11],[-0.689,25.725],[5.686,1.105]],"o":[[7.301,7.834],[-2.405,23.964],[7.32,22.944],[22.358,8.953],[13.565,-19.9],[-24.231,-8.665],[0.155,-5.79],[-5.686,-1.106]],"v":[[-67.624,-74.46],[-60.836,-50.411],[-55.453,11.567],[-9.899,64.62],[54.789,47.744],[37.918,-12.56],[2.322,-69.611],[-7.677,-82.077]],"c":true}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":34,"s":[{"i":[[0,0],[1.404,-13.995],[-7.319,-22.945],[-22.358,-8.953],[-13.565,19.901],[22.678,8.11],[-0.689,25.725],[5.686,1.105]],"o":[[7.301,7.834],[-2.405,23.964],[7.32,22.944],[22.358,8.953],[13.565,-19.9],[-24.231,-8.665],[0.155,-5.79],[-5.686,-1.106]],"v":[[-67.624,-74.46],[-60.836,-50.411],[-56.182,21.178],[-10.628,74.23],[54.06,57.355],[37.189,-2.949],[2.322,-69.611],[-7.677,-82.077]],"c":true}]},{"t":74.0000030140818,"s":[{"i":[[0,0],[1.404,-13.995],[-7.319,-22.945],[-22.358,-8.953],[-13.565,19.901],[22.678,8.11],[-0.689,25.725],[5.686,1.105]],"o":[[7.301,7.834],[-2.405,23.964],[7.32,22.944],[22.358,8.953],[13.565,-19.9],[-24.231,-8.665],[0.155,-5.79],[-5.686,-1.106]],"v":[[-67.624,-74.46],[-60.836,-50.411],[-55.453,11.567],[-9.899,64.62],[54.789,47.744],[37.918,-12.56],[2.322,-69.611],[-7.677,-82.077]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[1,0.35294117647058826,0.37254901960784315,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[692.302,244.019],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 11","np":3,"cix":2,"bm":0,"ix":11,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":4,"ty":4,"nm":"arms/boxgirl2 Outlines","parent":5,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":7,"s":[-18]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":13.824,"s":[0]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":21,"s":[-18]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":27,"s":[0]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":37,"s":[-18]},{"t":54.0000021994651,"s":[-18]}],"ix":10},"p":{"a":0,"k":[506.439,444.242,0],"ix":2},"a":{"a":0,"k":[534.439,398.222,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,-3.407],[3.407,0],[0,3.407],[-3.407,0]],"o":[[0,3.407],[-3.407,0],[0,-3.407],[3.407,0]],"v":[[6.169,0],[0,6.169],[-6.168,0],[0,-6.169]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[632.081,461.246],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":7,"s":[{"i":[[0,0],[-22.517,-0.724],[-10.788,37.86]],"o":[[25.288,-7.398],[36.098,3.218],[0,0]],"v":[[-38.207,26.791],[38.078,30.823],[87.513,-6.807]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":14,"s":[{"i":[[0,0],[-22.888,-13.053],[-2.749,18.008]],"o":[[25.288,-7.398],[-17.303,-28.448],[0,0]],"v":[[-38.207,26.791],[38.207,35.761],[21.086,-17.93]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":21,"s":[{"i":[[0,0],[-22.517,-0.724],[-10.788,37.86]],"o":[[25.288,-7.398],[36.098,3.218],[0,0]],"v":[[-38.207,26.791],[38.078,30.823],[87.513,-6.807]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":27.176,"s":[{"i":[[0,0],[-22.888,-13.053],[-2.749,18.008]],"o":[[25.288,-7.398],[-17.303,-28.448],[0,0]],"v":[[-38.207,26.791],[38.207,35.761],[21.086,-17.93]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":37,"s":[{"i":[[0,0],[-22.517,-0.724],[-10.788,37.86]],"o":[[25.288,-7.398],[36.098,3.218],[0,0]],"v":[[-38.207,26.791],[38.078,30.823],[87.513,-6.807]],"c":false}]},{"t":54.0000021994651,"s":[{"i":[[0,0],[-22.517,-0.724],[-10.788,37.86]],"o":[[25.288,-7.398],[36.098,3.218],[0,0]],"v":[[-38.207,26.791],[38.078,30.823],[87.513,-6.807]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[636.453,358.075],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":2,"cix":2,"bm":0,"ix":2,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-2.991,-1.935],[1.393,-9.397],[3.254,-8.925],[-1.049,-10.002],[0,0],[-11.042,-10.598],[20.008,35.512]],"o":[[3.543,-0.536],[7.976,5.16],[-1.392,9.397],[-3.253,8.925],[0,0],[0.418,10.558],[7.218,-35.73],[0,0]],"v":[[-34.042,-55.116],[-23.763,-53.142],[-14.661,-27.77],[-23.79,-0.843],[-27.997,28.159],[-28.105,26.975],[6.752,55.652],[14.035,-54.499]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.050980392156862744,0.7764705882352941,0.7215686274509804,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[635.71,439.352],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":3,"cix":2,"bm":0,"ix":3,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[-19.251,-20.715],[19.252,-11.749],[12.525,20.715],[-9.779,13.975]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":3,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.40784313725490196,0.9529411764705882,0.9098039215686274,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[617.497,415.331],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 4","np":3,"cix":2,"bm":0,"ix":4,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0.037,-6.22],[4.993,-23.691],[-34.033,29.139],[0,0]],"o":[[0,0],[0,0],[-4.999,-3.701],[0,0],[-3.982,18.892],[0,0],[0,0]],"v":[[55.805,-7.473],[11.559,-17.777],[-4.366,-29.569],[-16.488,-23.507],[-52.904,-14.08],[1.026,8.632],[56.886,25.512]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[554.414,404.877],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 5","np":3,"cix":2,"bm":0,"ix":5,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-7.976,-5.16],[1.393,-9.397],[3.254,-8.925],[-1.049,-10.001],[2.982,11.029]],"o":[[0.571,-9.482],[7.975,5.161],[-1.393,9.396],[-3.254,8.925],[-2.982,-11.029],[0,0]],"v":[[-16.19,-29.242],[5.695,-38.07],[14.797,-12.698],[5.668,14.229],[1.461,43.23],[-8.484,4.143]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0,0.6509803921568628,0.6,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[606.252,424.28],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 6","np":3,"cix":2,"bm":0,"ix":6,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":1},"o":{"x":0.333,"y":0},"t":7,"s":[{"i":[[0,0],[76.287,8.852],[17.248,1.993]],"o":[[77.45,65.728],[-17.247,-2.001],[0,0]],"v":[[63.279,-99.083],[-7.091,82.071],[-65.557,72.343]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":14,"s":[{"i":[[0,0],[84.904,4.88],[17.248,1.993]],"o":[[83.039,26.063],[-17.334,-0.997],[0,0]],"v":[[-26.996,-99.139],[-19.347,87.726],[-65.557,72.343]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.333,"y":0},"t":21,"s":[{"i":[[0,0],[76.287,8.852],[17.248,1.993]],"o":[[77.45,65.728],[-17.247,-2.001],[0,0]],"v":[[63.279,-99.083],[-7.091,82.071],[-65.557,72.343]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.167,"y":0},"t":27,"s":[{"i":[[0,0],[84.904,4.88],[17.248,1.993]],"o":[[88.231,6.819],[-17.334,-0.997],[0,0]],"v":[[-46.273,-107.574],[-19.347,87.726],[-65.557,72.343]],"c":false}]},{"i":{"x":0.833,"y":1},"o":{"x":0.333,"y":0},"t":37,"s":[{"i":[[0,0],[76.287,8.852],[17.248,1.993]],"o":[[77.45,65.728],[-17.247,-2.001],[0,0]],"v":[[63.279,-99.083],[-7.091,82.071],[-65.557,72.343]],"c":false}]},{"t":54.0000021994651,"s":[{"i":[[0,0],[76.287,8.852],[17.248,1.993]],"o":[[77.45,65.728],[-17.247,-2.001],[0,0]],"v":[[63.279,-99.083],[-7.091,82.071],[-65.557,72.343]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.050980392156862744,0.7764705882352941,0.7215686274509804,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[717.313,386.909],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 7","np":3,"cix":2,"bm":0,"ix":7,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":5,"ty":4,"nm":"BOX/boxgirl2 Outlines","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":7,"s":[-11]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":14.961,"s":[0]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":21.216,"s":[-11]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":26.903,"s":[0]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":36.569,"s":[-11]},{"t":76.0000030955435,"s":[-11]}],"ix":10},"p":{"s":true,"x":{"a":0,"k":497.232,"ix":3},"y":{"a":1,"k":[{"i":{"x":[0.525],"y":[0.999]},"o":{"x":[0.167],"y":[0.012]},"t":7,"s":[534.782]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.714],"y":[-0.001]},"t":14.961,"s":[473.393]},{"i":{"x":[0.086],"y":[1.001]},"o":{"x":[0.333],"y":[0]},"t":20.648,"s":[554.791]},{"i":{"x":[0.345],"y":[1.257]},"o":{"x":[0.475],"y":[0.001]},"t":26.903,"s":[484.088]},{"i":{"x":[0.058],"y":[8.039]},"o":{"x":[0.207],"y":[-15.641]},"t":37.138,"s":[534.782]},{"t":76.0000030955435,"s":[534.782]}],"ix":4}},"a":{"a":0,"k":[572.5,586.5,0],"ix":1},"s":{"a":0,"k":[83,83,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[4.345,-40.918],[0,0],[0,0],[0,0]],"o":[[0,0],[5.794,-40.405],[0,0],[0,0]],"v":[[2.264,43.63],[-8.285,42.896],[-2.262,-43.63],[8.286,-42.896]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[1,1,1,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[307.842,426.297],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[5.221,1.428]],"o":[[0,0],[0,0]],"v":[[0.841,-83.44],[-2.611,82.013]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[306.142,427.058],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":2,"cix":2,"bm":0,"ix":2,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-69.992,1.014]],"o":[[69.993,-1.014],[0,0]],"v":[[-112.026,3.123],[112.026,-3.123]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[477.19,351.902],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":2,"cix":2,"bm":0,"ix":3,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-38.969,-5.99],[1.82,-62.867]],"o":[[41.66,9.085],[-1.821,62.868],[0,0]],"v":[[-56.581,-95.724],[56.581,-72.475],[52.313,95.724]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.866666726505,0.737254901961,0.549019607843,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[308.254,427.051],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 4","np":3,"cix":2,"bm":0,"ix":4,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-43.799,3.2],[-73.661,-9.244],[-9.976,-73.578],[68.598,2.806],[42.988,11.764],[6.219,42.049]],"o":[[64.703,16],[-14.075,53.761],[-67.608,11.939],[-42.988,-11.764],[7.574,-63.979],[43.799,-3.2]],"v":[[-15.044,-99.102],[169.981,-81.65],[161.058,90.364],[-59.207,94.101],[-169.981,65.062],[-167.562,-99.102]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.866666726505,0.737254901961,0.549019607843,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[419.236,430.43],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 5","np":3,"cix":2,"bm":0,"ix":5,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":17.235,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.475],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20,"s":[{"i":[[0,0],[18.337,-0.432],[53.327,11.084],[-23.981,4.669]],"o":[[-25.774,-4.099],[-48.63,-17.126],[24.904,-3.29],[0,0]],"v":[[81.443,-11.521],[31.961,-12.457],[-76.764,-40.908],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":22.921,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":28.608,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":31,"s":[{"i":[[0,0],[18.337,-0.432],[53.327,11.084],[-23.981,4.669]],"o":[[-25.774,-4.099],[-48.63,-17.126],[24.904,-3.29],[0,0]],"v":[[81.443,-11.521],[31.961,-12.457],[-76.764,-40.909],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.667,"y":1},"o":{"x":0.167,"y":0.167},"t":46,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":62,"s":[{"i":[[0,0],[5.295,-25.538],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[68.394,55.122],[-39.877,9.497],[-29.331,-40.56]],"c":false}]},{"t":77.0000031362743,"s":[{"i":[[0,0],[4.29,-26.25],[54.595,20.476],[-5.348,26.556]],"o":[[-5.881,28.24],[-48.63,-17.126],[7.005,-28.32],[0,0]],"v":[[81.443,-11.521],[72.476,56.222],[-39.877,9.497],[-29.331,-40.56]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.866666726505,0.737254901961,0.549019607843,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[278.586,536.051],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 6","np":3,"cix":2,"bm":0,"ix":6,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.976],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.352,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":8,"s":[{"i":[[0,0],[-7.408,-22.677],[85.647,-5.975],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.353,-34.341],[110.216,25.436],[-110.292,41.803],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":16.666,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.975],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.353,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20,"s":[{"i":[[0,0],[-29.356,-13.941],[84.442,-5.729],[19.387,14.399]],"o":[[13.559,13.713],[-83.638,8.019],[-32.035,-13.191],[0,0]],"v":[[96.353,-34.341],[136.329,-10.87],[-68.498,3.481],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":22.921,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.976],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.352,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":28.608,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.976],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.352,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":31,"s":[{"i":[[0,0],[-29.356,-13.941],[84.442,-5.729],[19.387,14.399]],"o":[[13.559,13.713],[-83.638,8.019],[-32.035,-13.191],[0,0]],"v":[[96.353,-34.341],[136.329,-10.87],[-68.498,3.481],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.667,"y":1},"o":{"x":0.167,"y":0.167},"t":46,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.976],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.352,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":52,"s":[{"i":[[0,0],[4.341,-23.172],[85.647,-5.976],[-5.305,25.866]],"o":[[-4.364,20.108],[-80.626,8.376],[3.168,-26.192],[0,0]],"v":[[96.352,-34.341],[83.496,23.989],[-128.163,39.03],[-118.704,-27.565]],"c":false}]},{"t":77.0000031362743,"s":[{"i":[[0,0],[-3.518,-24.757],[85.647,-5.976],[4.373,25.634]],"o":[[1.938,21.197],[-80.626,8.376],[-2.305,-27.236],[0,0]],"v":[[96.352,-34.341],[106.656,24.809],[-115.038,40.968],[-118.704,-27.565]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.866666726505,0.737254901961,0.549019607843,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[483.54,552.116],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 7","np":3,"cix":2,"bm":0,"ix":7,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":6,"ty":4,"nm":"Legs/boxgirl2 Outlines","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[477.232,513.782,0],"ix":2},"a":{"a":0,"k":[572.5,586.5,0],"ix":1},"s":{"a":0,"k":[83,83,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-0.742,-7.41],[-14.493,-3.584],[-25.452,2.565]],"o":[[-5.443,5.57],[2.029,20.261],[13.455,3.327],[0,0]],"v":[[-48.474,-30.191],[-57.779,-10.254],[-0.625,23.639],[58.521,27.626]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[647.342,989.901],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-8.064,5.222]],"o":[[0,0],[0,0]],"v":[[-11.624,-6.953],[11.624,1.731]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[618.704,1014.636],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":3,"cix":2,"bm":0,"ix":2,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,3.45],[0,0],[0,0],[0,0],[0,0],[3.45,0]],"o":[[-3.45,0],[0,0],[0,0],[0,0],[0,0],[0,3.45],[0,0]],"v":[[-66.997,10.39],[-73.244,4.143],[-73.244,-10.39],[-70.416,-10.39],[73.244,-10.39],[73.244,4.143],[66.997,10.39]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[630.328,1057.988],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":3,"cix":2,"bm":0,"ix":3,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0.745,2.543],[-7.412,2.56],[0,0],[0,0]],"o":[[0,0],[0,0],[-2.561,-2.245],[-2.206,-7.525],[0,0],[0,0],[0,0]],"v":[[74.419,-1.574],[75.315,23.542],[-68.346,23.542],[-73.109,16.217],[-63.465,-1.762],[-21.177,-16.372],[-11.369,-23.542]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[628.258,1024.055],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 4","np":3,"cix":2,"bm":0,"ix":4,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-1.406,-7.312],[-14.756,-2.265],[-25.117,4.846]],"o":[[0,20.776],[3.845,19.996],[13.701,2.102],[0,0]],"v":[[-30.309,-32.271],[-58.915,0.168],[1.056,28.779],[60.321,27.425]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[561.487,975.205],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 5","np":2,"cix":2,"bm":0,"ix":5,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[-7.561,5.927]],"o":[[0,0],[0,0]],"v":[[-11.967,-6.242],[11.968,0.315]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[519.21,1005.327],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 6","np":2,"cix":2,"bm":0,"ix":6,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0],[-3.437,0.31]],"o":[[0,0],[0,0],[0,0],[0.311,3.436],[0,0]],"v":[[74.051,5],[71.843,-16.903],[-74.051,-3.715],[-72.448,10.933],[-65.663,16.593]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[535.094,1047.055],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 7","np":2,"cix":2,"bm":0,"ix":7,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[1.577,12.468],[-1.576,-12.468]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[605.36,1017.685],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 8","np":2,"cix":2,"bm":0,"ix":8,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[-2.874,-7.296],[-2.753,-2.005]],"o":[[0,0],[0,0],[-7.151,3.218],[0.971,2.467],[0,0]],"v":[[30.393,-26.012],[21.269,-17.987],[-19.532,0.37],[-27.519,19.143],[-22.114,26.012]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[485.974,1017.073],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 9","np":2,"cix":2,"bm":0,"ix":9,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":10.98,"s":[{"i":[[0,0],[-3.442,-105.571]],"o":[[-18.704,112.217],[0,0]],"v":[[-9.493,-158.357],[9.494,158.357]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":14.393,"s":[{"i":[[0,0],[-3.442,-105.571]],"o":[[3.442,105.571],[0,0]],"v":[[-9.493,-158.357],[9.494,158.357]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20.648,"s":[{"i":[[0,0],[-3.442,-105.571]],"o":[[-18.704,112.217],[0,0]],"v":[[-9.493,-158.357],[9.494,158.357]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25.765,"s":[{"i":[[0,0],[-3.442,-105.571]],"o":[[3.442,105.571],[0,0]],"v":[[-9.493,-158.357],[9.494,158.357]],"c":false}]},{"t":32.588751327367,"s":[{"i":[[0,0],[-3.442,-105.571]],"o":[[-18.704,112.217],[0,0]],"v":[[-9.493,-158.357],[9.494,158.357]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[519.695,753.384],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 10","np":2,"cix":2,"bm":0,"ix":10,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":10.98,"s":[{"i":[[0,0],[3.081,-104.652]],"o":[[-11.201,108.609],[0,0]],"v":[[2.06,-160.308],[6.06,160.309]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":14.393,"s":[{"i":[[0,0],[3.081,-104.652]],"o":[[5.242,106.157],[0,0]],"v":[[2.06,-160.308],[6.06,160.309]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20.648,"s":[{"i":[[0,0],[3.081,-104.652]],"o":[[-11.201,108.609],[0,0]],"v":[[2.06,-160.308],[6.06,160.309]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25.765,"s":[{"i":[[0,0],[3.081,-104.652]],"o":[[5.242,106.156],[0,0]],"v":[[2.06,-160.308],[6.06,160.309]],"c":false}]},{"t":32.588751327367,"s":[{"i":[[0,0],[3.081,-104.652]],"o":[[-11.201,108.609],[0,0]],"v":[[2.06,-160.308],[6.06,160.309]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[591.424,810.794],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 11","np":2,"cix":2,"bm":0,"ix":11,"mn":"ADBE Vector Group","hd":false},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":10.98,"s":[{"i":[[0,0],[-21.928,-106.278]],"o":[[-33.777,91.486],[0,0]],"v":[[12.646,-187.238],[21.131,187.238]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":14.393,"s":[{"i":[[0,0],[-10.66,-108.482]],"o":[[-4.585,92.5],[0,0]],"v":[[12.646,-187.238],[21.131,187.238]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20.648,"s":[{"i":[[0,0],[-21.928,-106.278]],"o":[[-33.777,91.486],[0,0]],"v":[[12.646,-187.238],[21.131,187.238]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25.765,"s":[{"i":[[0,0],[-10.66,-108.482]],"o":[[-4.585,92.5],[0,0]],"v":[[12.646,-187.238],[21.131,187.238]],"c":false}]},{"t":32.588751327367,"s":[{"i":[[0,0],[-21.928,-106.278]],"o":[[-33.777,91.486],[0,0]],"v":[[12.646,-187.238],[21.131,187.238]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[685.846,756.199],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 12","np":2,"cix":2,"bm":0,"ix":12,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":7,"ty":4,"nm":"Body/boxgirl2 Outlines","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":10.98,"s":[477.232,513.782,0],"to":[0,-1.167,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":14.393,"s":[477.232,506.782,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20.648,"s":[477.232,513.782,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25.765,"s":[477.232,506.782,0],"to":[0,0,0],"ti":[0,-1.167,0]},{"t":32.588751327367,"s":[477.232,513.782,0]}],"ix":2},"a":{"a":0,"k":[572.5,586.5,0],"ix":1},"s":{"a":0,"k":[83,83,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":11,"s":[{"i":[[0,0],[-1.842,-18.593],[20.162,4.991],[50.908,0.473],[-108.373,217.759],[-16.355,0],[0,0],[0,0],[-16.432,-8.614]],"o":[[6.366,18.406],[2.049,20.67],[-36.237,-8.969],[0,0],[10.336,-20.768],[0,0],[0,0],[18.522,-12.748],[0,0]],"v":[[132.53,-11.826],[161.147,106.417],[106.529,126.902],[-0.019,112.697],[-47.61,-79.325],[-1.019,-144.415],[23.696,-102.197],[71.999,-130.707],[125.265,-134.421]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":15,"s":[{"i":[[0,0],[-1.842,-18.593],[20.162,4.991],[50.908,0.473],[-104.743,241.812],[-16.355,0],[0,0],[0,0],[-16.432,-8.614]],"o":[[6.366,18.406],[2.049,20.67],[-36.237,-8.969],[0,0],[9.221,-21.286],[0,0],[0,0],[18.522,-12.748],[0,0]],"v":[[132.53,-11.826],[161.147,106.417],[106.529,126.902],[-0.019,112.697],[-75.32,-116.675],[-1.019,-144.415],[23.696,-102.197],[71.999,-130.707],[125.265,-134.421]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20,"s":[{"i":[[0,0],[-1.842,-18.593],[20.162,4.991],[50.908,0.473],[-108.373,217.759],[-16.355,0],[0,0],[0,0],[-16.432,-8.614]],"o":[[6.366,18.406],[2.049,20.67],[-36.237,-8.969],[0,0],[10.336,-20.768],[0,0],[0,0],[18.522,-12.748],[0,0]],"v":[[132.53,-11.826],[161.147,106.417],[106.529,126.902],[-0.019,112.697],[-47.61,-88.964],[-1.019,-144.415],[23.696,-102.197],[71.999,-130.707],[125.265,-134.421]],"c":false}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":26,"s":[{"i":[[0,0],[-1.842,-18.593],[20.162,4.991],[50.908,0.473],[-108.373,217.759],[-16.355,0],[0,0],[0,0],[-16.432,-8.614]],"o":[[6.366,18.406],[2.049,20.67],[-36.237,-8.969],[0,0],[10.336,-20.768],[0,0],[0,0],[18.522,-12.748],[0,0]],"v":[[132.53,-11.826],[161.147,106.417],[106.529,126.902],[-0.019,112.697],[-63.272,-105.831],[-1.019,-144.415],[23.696,-102.197],[71.999,-130.707],[125.265,-134.421]],"c":false}]},{"t":33.0000013441176,"s":[{"i":[[0,0],[-1.842,-18.593],[20.162,4.991],[50.908,0.473],[-108.373,217.759],[-16.355,0],[0,0],[0,0],[-16.432,-8.614]],"o":[[6.366,18.406],[2.049,20.67],[-36.237,-8.969],[0,0],[10.336,-20.768],[0,0],[0,0],[18.522,-12.748],[0,0]],"v":[[132.53,-11.826],[161.147,106.417],[106.529,126.902],[-0.019,112.697],[-47.61,-79.325],[-1.019,-144.415],[23.696,-102.197],[71.999,-130.707],[125.265,-134.421]],"c":false}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0,0,0,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":5,"ix":5},"lc":2,"lj":1,"ml":10,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.050980392156862744,0.7764705882352941,0.7215686274509804,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[559.529,428.725],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0},{"ddd":0,"ind":8,"ty":4,"nm":"Layer 8/boxgirl2 Outlines","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[477.232,513.782,0],"ix":2},"a":{"a":0,"k":[572.5,586.5,0],"ix":1},"s":{"a":0,"k":[83,83,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[47.878,-14.752],[3.234,-71.293],[-5.895,-75.093],[33.038,-81.93],[-85.728,-107.22],[-68.517,107.681],[-69.828,139.983],[-38.029,115.117],[46.807,57.257],[162.699,89.342]],"o":[[-55.539,17.112],[-3.198,70.52],[6.233,79.398],[-49.442,122.608],[99.596,124.565],[62.205,-97.761],[57.996,-116.263],[25.413,-76.926],[-71.866,-87.91],[-72.635,-39.886]],"v":[[-164.114,-536.141],[-273.101,-369.18],[-225.408,-209.28],[-297.757,-3.278],[-280.381,426.328],[113.978,424.615],[140.88,74.349],[340.696,-142.095],[303.58,-375.651],[-19.035,-471.694]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[0.796078431372549,1,0.984313725490196,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[655.005,614.237],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1798.00007323404,"st":0,"bm":0}]'),markers=[],emptyAnimation$1={v:v$1,meta,fr:fr$1,ip:ip$1,op:op$1,w:w$1,h:h$1,nm:nm$1,ddd:ddd$1,assets:assets$1,layers:layers$1,markers},Header=()=>{const{user:t,logout:s}=useAuth(),u=()=>{s()};return jsxRuntimeExports.jsx("header",{className:`\r
        w-full\r
        fixed top-0 left-0 right-0\r
        z-50\r
        bg-white/30\r
        backdrop-blur-md\r
        border-b border-gray-200/50\r
        supports-[backdrop-filter]:bg-white/30\r
      `,children:jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:jsxRuntimeExports.jsxs("div",{className:"flex h-16 items-center justify-between",children:[jsxRuntimeExports.jsxs(Link,{to:"/",className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-17 h-17 rounded-lg",children:jsxRuntimeExports.jsx("img",{src:civicIssueLogo,alt:"civicIssueLogo"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"CivicIssueRepoter"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Building Better Communities"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-3",children:t?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:block",children:["Welcome,"," ",t!=null&&t.fullName?t.fullName.split(" ")[0]:"Guest","!"]}),jsxRuntimeExports.jsx(Link,{to:t.role==="citizen"?"/citizen":"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"flex items-center space-x-2 text-slate-500",children:[jsxRuntimeExports.jsx(LayoutDashboard,{className:"h-4 w-4 text-blue-700"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:block",children:"Dashboard"})]})}),jsxRuntimeExports.jsxs(Button,{onClick:u,variant:"outline",size:"sm",className:"flex items-center space-x-2 text-slate-500",children:[jsxRuntimeExports.jsx(LogOut,{className:"h-4 w-4 text-blue-700"}),jsxRuntimeExports.jsx("span",{className:"hidden sm:block",children:"Logout"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Link,{to:"/signin",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"hidden sm:flex items-center space-x-2",children:[jsxRuntimeExports.jsx(LogIn,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Sign In"})]})}),jsxRuntimeExports.jsx(Link,{to:"/signup",children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"flex items-center space-x-2 civic-gradient border-0 text-white hover:opacity-90",children:[jsxRuntimeExports.jsx(Shield,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Sign Up"})]})})]})})]})})})},MIN_LOADER_DURATION=2500,CitizenHome=()=>{const[t,s]=reactExports.useState(""),[u,d]=reactExports.useState([]),[_,S]=reactExports.useState(!0),{hideLoader:R}=useLoader();reactExports.useEffect(()=>{(async()=>{const j=Date.now();try{const G=await(await fetch(`${VITE_BACKEND_URL}/api/v1/all-issues`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();Array.isArray(G.issues)?d(G.issues):d([])}catch(V){console.error("Error fetching issues:",V)}finally{const V=Date.now()-j,G=Math.max(MIN_LOADER_DURATION-V,0);setTimeout(()=>{S(!1),R()},G)}})()},[R]);const a=t?u.filter(O=>{var j;return(j=O.location)==null?void 0:j.address.toLowerCase().includes(t.toLowerCase())}):u,k=O=>{switch(O){case"Rejected":return"bg-red-200/70 text-red-900";case"Pending":return"bg-yellow-200/70 text-yellow-900";case"Resolved":return"bg-green-200/70 text-green-900";case"In Progress":return"bg-blue-200/70 text-blue-900";default:return"bg-gray-200/70 text-gray-900"}};return _?jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-white",children:[jsxRuntimeExports.jsx(Lottie,{autoplay:!0,loop:!0,animationData:starloader,style:{height:"200px",width:"200px"}}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-4",children:"Fetching issues..."})]}):jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"min-h-screen bg-[#f3f6f8]",children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#f3f6f8]",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-20 space-y-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl font-extrabold text-[#0577b7] tracking-wide",children:"Welcome, Citizen!"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 mt-2 text-base",children:"Help improve your community by reporting issues"})]}),jsxRuntimeExports.jsx(Link,{to:"/citizen/profile",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"flex items-center space-x-2 rounded-full shadow-sm hover:shadow-md transition-all text-slate-500",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 text-purple-700"}),jsxRuntimeExports.jsx("span",{children:"My Profile"})]})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-semibold text-slate-600 mb-4",children:"Search Issues by Location"}),jsxRuntimeExports.jsxs("div",{className:"relative max-w-md",children:[jsxRuntimeExports.jsx(Search,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 z-20","aria-hidden":"true"}),jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Enter city name...",value:t,onChange:O=>s(O.target.value),className:"pl-10 bg-white/70 backdrop-blur-md border border-gray-200 rounded-full placeholder:text-gray-400"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsxs("h2",{className:"text-2xl font-semibold text-sky-600",children:["Recent Issues",t&&jsxRuntimeExports.jsxs("span",{className:"text-lg font-normal text-gray-400 ml-2",children:["in ",t]})]}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-400",children:[a.length," issue",a.length!==1?"s":""," found"]})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-h-[600px] overflow-y-auto",children:a.map(O=>jsxRuntimeExports.jsxs(Card,{className:`rounded-2xl bg-white/70 backdrop-blur-md border border-gray-200 shadow-md hover:shadow-xl hover:scale-[1.02] transition-all ${O.status==="Rejected"?"opacity-30 grayscale":"opacity-100"}`,children:[jsxRuntimeExports.jsxs("div",{className:"relative h-48 overflow-hidden rounded-t-2xl",children:[jsxRuntimeExports.jsx("img",{src:O.image||"/placeholder.jpg",alt:O.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"}),jsxRuntimeExports.jsx("div",{className:`absolute top-3 right-3 px-3 py-1 rounded-full text-xs font-semibold ${k(O.status)}`,children:O.status})]}),jsxRuntimeExports.jsx(CardHeader,{className:"pb-2",children:jsxRuntimeExports.jsx(CardTitle,{className:"text-lg text-gray-800",children:O.title})}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm mb-3 line-clamp-2",children:O.description}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-xs text-gray-500",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-3 w-3 text-gray-400"}),jsxRuntimeExports.jsx("span",{children:O.location.address}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-teal-600",children:[" ",O.type]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(User,{className:"h-3 w-3 text-gray-400"}),jsxRuntimeExports.jsxs("span",{children:["Reported by ",O.reportedBy]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Clock,{className:"h-3 w-3 text-gray-400"}),jsxRuntimeExports.jsx("span",{children:O.reportedAt})]})]})]})]},O._id))}),a.length===0&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"flex flex-col items-center justify-center text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"max-w-xs mx-auto mb-4",children:jsxRuntimeExports.jsx(Lottie,{autoplay:!0,loop:!0,animationData:emptyAnimation$1,style:{height:"180px",width:"180px"}})}),jsxRuntimeExports.jsx("p",{className:"text-gray-400",children:t?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["No issues found for"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold",children:t})]}):"No issues available at the moment."})]})]}),jsxRuntimeExports.jsx("div",{className:"fixed bottom-8 right-8 z-50",children:jsxRuntimeExports.jsx(Link,{to:"/citizen/create-issue",children:jsxRuntimeExports.jsxs(Button,{size:"lg",className:`civic-gradient text-white border-0 h-14 px-6 rounded-full \r
                shadow-lg hover:shadow-2xl hover:scale-105 \r
                transition-transform duration-300`,children:[jsxRuntimeExports.jsx(Plus,{className:"h-5 w-5 mr-2"}),"Report New Issue"]})})})]})]})})};var NODES$b=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$b=NODES$b.reduce((t,s)=>{const u=createSlot$c(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),NAME$2="Label",Label$2=reactExports.forwardRef((t,s)=>jsxRuntimeExports.jsx(Primitive$b.label,{...t,ref:s,onMouseDown:u=>{var _;u.target.closest("button, input, select, textarea")||((_=t.onMouseDown)==null||_.call(t,u),!u.defaultPrevented&&u.detail>1&&u.preventDefault())}}));Label$2.displayName=NAME$2;var Root$4=Label$2;function Label$1({className:t,...s}){return jsxRuntimeExports.jsx(Root$4,{"data-slot":"label",className:cn("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}const badgeVariants=cva("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Badge({className:t,variant:s,asChild:u=!1,...d}){const _=u?Slot$1:"span";return jsxRuntimeExports.jsx(_,{"data-slot":"badge",className:cn(badgeVariants({variant:s}),t),...d})}function createContextScope$8(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R);a.displayName=S+"Context";const k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$8(_,...s)]}function composeContextScopes$8(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function useCallbackRef$1(t){const s=reactExports.useRef(t);return reactExports.useEffect(()=>{s.current=t}),reactExports.useMemo(()=>(...u)=>{var d;return(d=s.current)==null?void 0:d.call(s,...u)},[])}var useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},shim={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production;function requireUseSyncExternalStoreShim_production(){if(hasRequiredUseSyncExternalStoreShim_production)return useSyncExternalStoreShim_production;hasRequiredUseSyncExternalStoreShim_production=1;var t=requireReact();function s(V,G){return V===G&&(V!==0||1/V===1/G)||V!==V&&G!==G}var u=typeof Object.is=="function"?Object.is:s,d=t.useState,_=t.useEffect,S=t.useLayoutEffect,R=t.useDebugValue;function a(V,G){var J=G(),Z=d({inst:{value:J,getSnapshot:G}}),Y=Z[0].inst,le=Z[1];return S(function(){Y.value=J,Y.getSnapshot=G,k(Y)&&le({inst:Y})},[V,J,G]),_(function(){return k(Y)&&le({inst:Y}),V(function(){k(Y)&&le({inst:Y})})},[V]),R(J),J}function k(V){var G=V.getSnapshot;V=V.value;try{var J=G();return!u(V,J)}catch{return!0}}function O(V,G){return G()}var j=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?O:a;return useSyncExternalStoreShim_production.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:j,useSyncExternalStoreShim_production}var hasRequiredShim;function requireShim(){return hasRequiredShim||(hasRequiredShim=1,shim.exports=requireUseSyncExternalStoreShim_production()),shim.exports}var shimExports=requireShim();function useIsHydrated(){return shimExports.useSyncExternalStore(subscribe,()=>!0,()=>!1)}function subscribe(){return()=>{}}var AVATAR_NAME="Avatar",[createAvatarContext]=createContextScope$8(AVATAR_NAME),[AvatarProvider,useAvatarContext]=createAvatarContext(AVATAR_NAME),Avatar$1=reactExports.forwardRef((t,s)=>{const{__scopeAvatar:u,...d}=t,[_,S]=reactExports.useState("idle");return jsxRuntimeExports.jsx(AvatarProvider,{scope:u,imageLoadingStatus:_,onImageLoadingStatusChange:S,children:jsxRuntimeExports.jsx(Primitive$b.span,{...d,ref:s})})});Avatar$1.displayName=AVATAR_NAME;var IMAGE_NAME="AvatarImage",AvatarImage$1=reactExports.forwardRef((t,s)=>{const{__scopeAvatar:u,src:d,onLoadingStatusChange:_=()=>{},...S}=t,R=useAvatarContext(IMAGE_NAME,u),a=useImageLoadingStatus(d,S),k=useCallbackRef$1(O=>{_(O),R.onImageLoadingStatusChange(O)});return useLayoutEffect2(()=>{a!=="idle"&&k(a)},[a,k]),a==="loaded"?jsxRuntimeExports.jsx(Primitive$b.img,{...S,ref:s,src:d}):null});AvatarImage$1.displayName=IMAGE_NAME;var FALLBACK_NAME="AvatarFallback",AvatarFallback$1=reactExports.forwardRef((t,s)=>{const{__scopeAvatar:u,delayMs:d,..._}=t,S=useAvatarContext(FALLBACK_NAME,u),[R,a]=reactExports.useState(d===void 0);return reactExports.useEffect(()=>{if(d!==void 0){const k=window.setTimeout(()=>a(!0),d);return()=>window.clearTimeout(k)}},[d]),R&&S.imageLoadingStatus!=="loaded"?jsxRuntimeExports.jsx(Primitive$b.span,{..._,ref:s}):null});AvatarFallback$1.displayName=FALLBACK_NAME;function resolveLoadingStatus(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function useImageLoadingStatus(t,{referrerPolicy:s,crossOrigin:u}){const d=useIsHydrated(),_=reactExports.useRef(null),S=d?(_.current||(_.current=new window.Image),_.current):null,[R,a]=reactExports.useState(()=>resolveLoadingStatus(S,t));return useLayoutEffect2(()=>{a(resolveLoadingStatus(S,t))},[S,t]),useLayoutEffect2(()=>{const k=V=>()=>{a(V)};if(!S)return;const O=k("loaded"),j=k("error");return S.addEventListener("load",O),S.addEventListener("error",j),s&&(S.referrerPolicy=s),typeof u=="string"&&(S.crossOrigin=u),()=>{S.removeEventListener("load",O),S.removeEventListener("error",j)}},[S,u,s]),R}var Root$3=Avatar$1,Image$1=AvatarImage$1,Fallback=AvatarFallback$1;function Avatar({className:t,...s}){return jsxRuntimeExports.jsx(Root$3,{"data-slot":"avatar",className:cn("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function AvatarImage({className:t,...s}){return jsxRuntimeExports.jsx(Image$1,{"data-slot":"avatar-image",className:cn("aspect-square size-full",t),...s})}function AvatarFallback({className:t,...s}){return jsxRuntimeExports.jsx(Fallback,{"data-slot":"avatar-fallback",className:cn("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}var NAME$1="Separator",DEFAULT_ORIENTATION="horizontal",ORIENTATIONS=["horizontal","vertical"],Separator$2=reactExports.forwardRef((t,s)=>{const{decorative:u,orientation:d=DEFAULT_ORIENTATION,..._}=t,S=isValidOrientation(d)?d:DEFAULT_ORIENTATION,a=u?{role:"none"}:{"aria-orientation":S==="vertical"?S:void 0,role:"separator"};return jsxRuntimeExports.jsx(Primitive$b.div,{"data-orientation":S,...a,..._,ref:s})});Separator$2.displayName=NAME$1;function isValidOrientation(t){return ORIENTATIONS.includes(t)}var Root$2=Separator$2;function Separator$1({className:t,orientation:s="horizontal",decorative:u=!0,...d}){return jsxRuntimeExports.jsx(Root$2,{"data-slot":"separator",decorative:u,orientation:s,className:cn("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...d})}const CitizenProfile=()=>{const{user:t,updateUserProfile:s,token:u,isLoading:d}=useAuth(),[_,S]=reactExports.useState(!1),[R,a]=reactExports.useState([]),[k,O]=reactExports.useState(!0),[j,V]=reactExports.useState({fullName:(t==null?void 0:t.fullName)||"",email:(t==null?void 0:t.email)||"",phonenumber:(t==null?void 0:t.phonenumber)||""});if(d)return jsxRuntimeExports.jsx("p",{className:"text-center mt-10",children:"Loading profile..."});if(!t)return jsxRuntimeExports.jsx("p",{className:"text-center mt-10",children:"Loading profile..."});const G=async()=>{try{await s({fullName:j.fullName,email:j.email,phonenumber:j.phonenumber}),toast.success("Profile updated successfully!"),S(!1)}catch(Z){console.error("Update error:",Z),toast.error("Failed to update profile")}};reactExports.useEffect(()=>{if(!u)return;(async()=>{try{O(!0);const Y=await fetch(`${VITE_BACKEND_URL}/api/v1/citizen/issues`,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}),le=await Y.json();if(Y.status===401){toast.error("Unauthorized! Please log in again.");return}Y.ok&&Array.isArray(le.issues)?a(le.issues):(console.error("Failed to fetch issues:",le.message),toast.error(le.message||"Failed to load issues"))}catch(Y){console.error("Error fetching my issues:",Y),toast.error("Error loading your issues")}finally{O(!1)}})()},[u]);const J=Z=>{switch(Z){case"Rejected":return"bg-red-200/70 text-red-900";case"Pending":return"bg-yellow-200/70 text-yellow-900";case"Resolved":return"bg-green-200/70 text-green-900";case"In Progress":return"bg-blue-200/70 text-blue-900";default:return"bg-gray-200/70 text-gray-900"}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#f3f6f8]",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("div",{className:"pt-20 container mx-auto my-9 max-w-4xl space-y-6 px-4",children:[jsxRuntimeExports.jsxs(Card,{className:`bg-white/80 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  `,children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsxs(Avatar,{className:"h-20 w-20",children:[jsxRuntimeExports.jsx(AvatarImage,{src:"/placeholder.svg"}),jsxRuntimeExports.jsx(AvatarFallback,{className:"text-lg bg-[#bedbff]",children:j.fullName.split(" ").map(Z=>Z[0]).join("")})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(CardTitle,{className:"text-2xl text-slate-600",children:"Citizen Profile"}),jsxRuntimeExports.jsx(CardDescription,{children:"Manage your profile and view your reported issues"})]})]}),jsxRuntimeExports.jsxs(Button,{variant:_?"default":"outline",className:"text-slate-500 active:bg-gray-200 focus:bg-gray-200 active:ring-0 focus:ring-0",onClick:_?G:()=>S(!0),children:[jsxRuntimeExports.jsx(SquarePen,{className:"h-4 w-4  text-purple-700"}),jsxRuntimeExports.jsx("div",{className:"hidden sm:block",children:_?"Save Changes":"Edit Profile"})]})]})}),jsxRuntimeExports.jsx(CardContent,{className:"space-y-4",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"name",children:"Full Name"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"name",value:j.fullName,onChange:Z=>V({...j,fullName:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.fullName})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"email",children:"Email"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Mail,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"email",type:"email",value:j.email,onChange:Z=>V({...j,email:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.email})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"phone",children:"Phone Number"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Phone,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"phone",value:j.phonenumber,onChange:Z=>V({...j,phonenumber:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.phonenumber})]})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
 `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold",children:R.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Issues Reported"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
  `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.filter(Z=>Z.status==="Resolved").length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Resolved"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
`,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-blue-600",children:R.filter(Z=>Z.status==="In Progress").length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"In Progress"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
  `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:R.filter(Z=>Z.status==="Pending").length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending"})]})})]}),jsxRuntimeExports.jsxs(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  `,children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center space-x-2 text-slate-700",children:[jsxRuntimeExports.jsx(FileText,{className:"h-5 w-5 text-indigo-500 hover:text-indigo-700  transition duration-300"}),jsxRuntimeExports.jsx("span",{children:"My Reported Issues"})]}),jsxRuntimeExports.jsx(CardDescription,{children:"Track the status of all issues you've reported"})]}),jsxRuntimeExports.jsx(CardContent,{children:k?jsxRuntimeExports.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"Loading your issues..."}):R.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"You havent reported any issues yet."}):jsxRuntimeExports.jsx("div",{className:"space-y-4",children:R.map(Z=>jsxRuntimeExports.jsxs("div",{className:"border rounded-lg p-4 space-y-3 shadow-sm bg-yellow-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold",children:Z.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Z.description})]}),jsxRuntimeExports.jsx(Badge,{className:J(Z.status),children:Z.status})]}),Z.file&&jsxRuntimeExports.jsx("img",{src:Z.file,alt:"Issue",className:"w-full h-40 object-cover rounded-md"}),jsxRuntimeExports.jsx(Separator$1,{}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1  gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-4 w-4 text-blue-600"}),jsxRuntimeExports.jsx("span",{children:Z.location.address})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-4 w-4 text-pink-500"}),jsxRuntimeExports.jsxs("span",{children:["Reported:"," ",new Date(Z.createdAt).toLocaleDateString()]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(FileText,{className:"h-4 w-4 text-purple-600"}),jsxRuntimeExports.jsxs("span",{children:["Type: ",Z.issueType]})]})]})]},Z._id))})})]})]})]})};function Textarea({className:t,...s}){return jsxRuntimeExports.jsx("textarea",{"data-slot":"textarea",className:cn("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}function composeEventHandlers(t,s,{checkForDefaultPrevented:u=!0}={}){return function(_){if(t==null||t(_),u===!1||!_.defaultPrevented)return s==null?void 0:s(_)}}function createContextScope$7(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$7(_,...s)]}function composeContextScopes$7(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$b(t){const s=createSlotClone$b(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$b);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$b(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$c(_),a=mergeProps$b(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$b=Symbol("radix.slottable");function isSlottable$b(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$b}function mergeProps$b(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$c(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$a=NODES$a.reduce((t,s)=>{const u=createSlot$b(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{});function createContextScope$6(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$6(_,...s)]}function composeContextScopes$6(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$a(t){const s=createSlotClone$a(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$a);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$a(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$b(_),a=mergeProps$a(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$a=Symbol("radix.slottable");function isSlottable$a(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$a}function mergeProps$a(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$b(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}function createCollection(t){const s=t+"CollectionProvider",[u,d]=createContextScope$6(s),[_,S]=u(s,{collectionRef:{current:null},itemMap:new Map}),R=Y=>{const{scope:le,children:ee}=Y,se=React2.useRef(null),Q=React2.useRef(new Map).current;return jsxRuntimeExports.jsx(_,{scope:le,itemMap:Q,collectionRef:se,children:ee})};R.displayName=s;const a=t+"CollectionSlot",k=createSlot$a(a),O=React2.forwardRef((Y,le)=>{const{scope:ee,children:se}=Y,Q=S(a,ee),oe=useComposedRefs(le,Q.collectionRef);return jsxRuntimeExports.jsx(k,{ref:oe,children:se})});O.displayName=a;const j=t+"CollectionItemSlot",V="data-radix-collection-item",G=createSlot$a(j),J=React2.forwardRef((Y,le)=>{const{scope:ee,children:se,...Q}=Y,oe=React2.useRef(null),_e=useComposedRefs(le,oe),Se=S(j,ee);return React2.useEffect(()=>(Se.itemMap.set(oe,{ref:oe,...Q}),()=>void Se.itemMap.delete(oe))),jsxRuntimeExports.jsx(G,{[V]:"",ref:_e,children:se})});J.displayName=j;function Z(Y){const le=S(t+"CollectionConsumer",Y);return React2.useCallback(()=>{const se=le.collectionRef.current;if(!se)return[];const Q=Array.from(se.querySelectorAll(`[${V}]`));return Array.from(le.itemMap.values()).sort((Se,ke)=>Q.indexOf(Se.ref.current)-Q.indexOf(ke.ref.current))},[le.collectionRef,le.itemMap])}return[{Provider:R,Slot:O,ItemSlot:J},Z,d]}function createContextScope$5(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$5(_,...s)]}function composeContextScopes$5(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}var useReactId=React[" useId ".trim().toString()]||(()=>{}),count$1=0;function useId(t){const[s,u]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{u(d=>d??String(count$1++))},[t]),t||(s?`radix-${s}`:"")}function createSlot$9(t){const s=createSlotClone$9(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$9);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$9(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$a(_),a=mergeProps$9(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$9=Symbol("radix.slottable");function isSlottable$9(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$9}function mergeProps$9(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$a(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$9=NODES$9.reduce((t,s)=>{const u=createSlot$9(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),useInsertionEffect=React[" useInsertionEffect ".trim().toString()]||useLayoutEffect2;function useControllableState({prop:t,defaultProp:s,onChange:u=()=>{},caller:d}){const[_,S,R]=useUncontrolledState({defaultProp:s,onChange:u}),a=t!==void 0,k=a?t:_;{const j=reactExports.useRef(t!==void 0);reactExports.useEffect(()=>{const V=j.current;V!==a&&console.warn(`${d} is changing from ${V?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),j.current=a},[a,d])}const O=reactExports.useCallback(j=>{var V;if(a){const G=isFunction$1(j)?j(t):j;G!==t&&((V=R.current)==null||V.call(R,G))}else S(j)},[a,t,S,R]);return[k,O]}function useUncontrolledState({defaultProp:t,onChange:s}){const[u,d]=reactExports.useState(t),_=reactExports.useRef(u),S=reactExports.useRef(s);return useInsertionEffect(()=>{S.current=s},[s]),reactExports.useEffect(()=>{var R;_.current!==u&&((R=S.current)==null||R.call(S,u),_.current=u)},[u,_]),[u,d,S]}function isFunction$1(t){return typeof t=="function"}var DirectionContext=reactExports.createContext(void 0);function useDirection(t){const s=reactExports.useContext(DirectionContext);return t||s||"ltr"}var ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",EVENT_OPTIONS$1={bubbles:!1,cancelable:!0},GROUP_NAME$2="RovingFocusGroup",[Collection$1,useCollection$1,createCollectionScope$1]=createCollection(GROUP_NAME$2),[createRovingFocusGroupContext,createRovingFocusGroupScope]=createContextScope$5(GROUP_NAME$2,[createCollectionScope$1]),[RovingFocusProvider,useRovingFocusContext]=createRovingFocusGroupContext(GROUP_NAME$2),RovingFocusGroup=reactExports.forwardRef((t,s)=>jsxRuntimeExports.jsx(Collection$1.Provider,{scope:t.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(Collection$1.Slot,{scope:t.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(RovingFocusGroupImpl,{...t,ref:s})})}));RovingFocusGroup.displayName=GROUP_NAME$2;var RovingFocusGroupImpl=reactExports.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:u,orientation:d,loop:_=!1,dir:S,currentTabStopId:R,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:k,onEntryFocus:O,preventScrollOnEntryFocus:j=!1,...V}=t,G=reactExports.useRef(null),J=useComposedRefs(s,G),Z=useDirection(S),[Y,le]=useControllableState({prop:R,defaultProp:a??null,onChange:k,caller:GROUP_NAME$2}),[ee,se]=reactExports.useState(!1),Q=useCallbackRef$1(O),oe=useCollection$1(u),_e=reactExports.useRef(!1),[Se,ke]=reactExports.useState(0);return reactExports.useEffect(()=>{const Le=G.current;if(Le)return Le.addEventListener(ENTRY_FOCUS,Q),()=>Le.removeEventListener(ENTRY_FOCUS,Q)},[Q]),jsxRuntimeExports.jsx(RovingFocusProvider,{scope:u,orientation:d,dir:Z,loop:_,currentTabStopId:Y,onItemFocus:reactExports.useCallback(Le=>le(Le),[le]),onItemShiftTab:reactExports.useCallback(()=>se(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>ke(Le=>Le+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>ke(Le=>Le-1),[]),children:jsxRuntimeExports.jsx(Primitive$9.div,{tabIndex:ee||Se===0?-1:0,"data-orientation":d,...V,ref:J,style:{outline:"none",...t.style},onMouseDown:composeEventHandlers(t.onMouseDown,()=>{_e.current=!0}),onFocus:composeEventHandlers(t.onFocus,Le=>{const lt=!_e.current;if(Le.target===Le.currentTarget&&lt&&!ee){const qt=new CustomEvent(ENTRY_FOCUS,EVENT_OPTIONS$1);if(Le.currentTarget.dispatchEvent(qt),!qt.defaultPrevented){const Yt=oe().filter(xe=>xe.focusable),Ot=Yt.find(xe=>xe.active),Bt=Yt.find(xe=>xe.id===Y),kt=[Ot,Bt,...Yt].filter(Boolean).map(xe=>xe.ref.current);focusFirst$2(kt,j)}}_e.current=!1}),onBlur:composeEventHandlers(t.onBlur,()=>se(!1))})})}),ITEM_NAME$3="RovingFocusGroupItem",RovingFocusGroupItem=reactExports.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:u,focusable:d=!0,active:_=!1,tabStopId:S,children:R,...a}=t,k=useId(),O=S||k,j=useRovingFocusContext(ITEM_NAME$3,u),V=j.currentTabStopId===O,G=useCollection$1(u),{onFocusableItemAdd:J,onFocusableItemRemove:Z,currentTabStopId:Y}=j;return reactExports.useEffect(()=>{if(d)return J(),()=>Z()},[d,J,Z]),jsxRuntimeExports.jsx(Collection$1.ItemSlot,{scope:u,id:O,focusable:d,active:_,children:jsxRuntimeExports.jsx(Primitive$9.span,{tabIndex:V?0:-1,"data-orientation":j.orientation,...a,ref:s,onMouseDown:composeEventHandlers(t.onMouseDown,le=>{d?j.onItemFocus(O):le.preventDefault()}),onFocus:composeEventHandlers(t.onFocus,()=>j.onItemFocus(O)),onKeyDown:composeEventHandlers(t.onKeyDown,le=>{if(le.key==="Tab"&&le.shiftKey){j.onItemShiftTab();return}if(le.target!==le.currentTarget)return;const ee=getFocusIntent(le,j.orientation,j.dir);if(ee!==void 0){if(le.metaKey||le.ctrlKey||le.altKey||le.shiftKey)return;le.preventDefault();let Q=G().filter(oe=>oe.focusable).map(oe=>oe.ref.current);if(ee==="last")Q.reverse();else if(ee==="prev"||ee==="next"){ee==="prev"&&Q.reverse();const oe=Q.indexOf(le.currentTarget);Q=j.loop?wrapArray$1(Q,oe+1):Q.slice(oe+1)}setTimeout(()=>focusFirst$2(Q))}}),children:typeof R=="function"?R({isCurrentTabStop:V,hasTabStop:Y!=null}):R})})});RovingFocusGroupItem.displayName=ITEM_NAME$3;var MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function getDirectionAwareKey(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function getFocusIntent(t,s,u){const d=getDirectionAwareKey(t.key,u);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(d))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(d)))return MAP_KEY_TO_FOCUS_INTENT[d]}function focusFirst$2(t,s=!1){const u=document.activeElement;for(const d of t)if(d===u||(d.focus({preventScroll:s}),document.activeElement!==u))return}function wrapArray$1(t,s){return t.map((u,d)=>t[(s+d)%t.length])}var Root$1=RovingFocusGroup,Item=RovingFocusGroupItem;function useSize(t){const[s,u]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(t){u({width:t.offsetWidth,height:t.offsetHeight});const d=new ResizeObserver(_=>{if(!Array.isArray(_)||!_.length)return;const S=_[0];let R,a;if("borderBoxSize"in S){const k=S.borderBoxSize,O=Array.isArray(k)?k[0]:k;R=O.inlineSize,a=O.blockSize}else R=t.offsetWidth,a=t.offsetHeight;u({width:R,height:a})});return d.observe(t,{box:"border-box"}),()=>d.unobserve(t)}else u(void 0)},[t]),s}function usePrevious(t){const s=reactExports.useRef({value:t,previous:t});return reactExports.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}function useStateMachine(t,s){return reactExports.useReducer((u,d)=>s[u][d]??u,t)}var Presence=t=>{const{present:s,children:u}=t,d=usePresence(s),_=typeof u=="function"?u({present:d.isPresent}):reactExports.Children.only(u),S=useComposedRefs(d.ref,getElementRef$9(_));return typeof u=="function"||d.isPresent?reactExports.cloneElement(_,{ref:S}):null};Presence.displayName="Presence";function usePresence(t){const[s,u]=reactExports.useState(),d=reactExports.useRef(null),_=reactExports.useRef(t),S=reactExports.useRef("none"),R=t?"mounted":"unmounted",[a,k]=useStateMachine(R,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const O=getAnimationName(d.current);S.current=a==="mounted"?O:"none"},[a]),useLayoutEffect2(()=>{const O=d.current,j=_.current;if(j!==t){const G=S.current,J=getAnimationName(O);t?k("MOUNT"):J==="none"||(O==null?void 0:O.display)==="none"?k("UNMOUNT"):k(j&&G!==J?"ANIMATION_OUT":"UNMOUNT"),_.current=t}},[t,k]),useLayoutEffect2(()=>{if(s){let O;const j=s.ownerDocument.defaultView??window,V=J=>{const Y=getAnimationName(d.current).includes(CSS.escape(J.animationName));if(J.target===s&&Y&&(k("ANIMATION_END"),!_.current)){const le=s.style.animationFillMode;s.style.animationFillMode="forwards",O=j.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=le)})}},G=J=>{J.target===s&&(S.current=getAnimationName(d.current))};return s.addEventListener("animationstart",G),s.addEventListener("animationcancel",V),s.addEventListener("animationend",V),()=>{j.clearTimeout(O),s.removeEventListener("animationstart",G),s.removeEventListener("animationcancel",V),s.removeEventListener("animationend",V)}}else k("ANIMATION_END")},[s,k]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:reactExports.useCallback(O=>{d.current=O?getComputedStyle(O):null,u(O)},[])}}function getAnimationName(t){return(t==null?void 0:t.animationName)||"none"}function getElementRef$9(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var RADIO_NAME="Radio",[createRadioContext,createRadioScope]=createContextScope$7(RADIO_NAME),[RadioProvider,useRadioContext]=createRadioContext(RADIO_NAME),Radio=reactExports.forwardRef((t,s)=>{const{__scopeRadio:u,name:d,checked:_=!1,required:S,disabled:R,value:a="on",onCheck:k,form:O,...j}=t,[V,G]=reactExports.useState(null),J=useComposedRefs(s,le=>G(le)),Z=reactExports.useRef(!1),Y=V?O||!!V.closest("form"):!0;return jsxRuntimeExports.jsxs(RadioProvider,{scope:u,checked:_,disabled:R,children:[jsxRuntimeExports.jsx(Primitive$a.button,{type:"button",role:"radio","aria-checked":_,"data-state":getState$1(_),"data-disabled":R?"":void 0,disabled:R,value:a,...j,ref:J,onClick:composeEventHandlers(t.onClick,le=>{_||k==null||k(),Y&&(Z.current=le.isPropagationStopped(),Z.current||le.stopPropagation())})}),Y&&jsxRuntimeExports.jsx(RadioBubbleInput,{control:V,bubbles:!Z.current,name:d,value:a,checked:_,required:S,disabled:R,form:O,style:{transform:"translateX(-100%)"}})]})});Radio.displayName=RADIO_NAME;var INDICATOR_NAME$2="RadioIndicator",RadioIndicator=reactExports.forwardRef((t,s)=>{const{__scopeRadio:u,forceMount:d,..._}=t,S=useRadioContext(INDICATOR_NAME$2,u);return jsxRuntimeExports.jsx(Presence,{present:d||S.checked,children:jsxRuntimeExports.jsx(Primitive$a.span,{"data-state":getState$1(S.checked),"data-disabled":S.disabled?"":void 0,..._,ref:s})})});RadioIndicator.displayName=INDICATOR_NAME$2;var BUBBLE_INPUT_NAME$1="RadioBubbleInput",RadioBubbleInput=reactExports.forwardRef(({__scopeRadio:t,control:s,checked:u,bubbles:d=!0,..._},S)=>{const R=reactExports.useRef(null),a=useComposedRefs(R,S),k=usePrevious(u),O=useSize(s);return reactExports.useEffect(()=>{const j=R.current;if(!j)return;const V=window.HTMLInputElement.prototype,J=Object.getOwnPropertyDescriptor(V,"checked").set;if(k!==u&&J){const Z=new Event("click",{bubbles:d});J.call(j,u),j.dispatchEvent(Z)}},[k,u,d]),jsxRuntimeExports.jsx(Primitive$a.input,{type:"radio","aria-hidden":!0,defaultChecked:u,..._,tabIndex:-1,ref:a,style:{..._.style,...O,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});RadioBubbleInput.displayName=BUBBLE_INPUT_NAME$1;function getState$1(t){return t?"checked":"unchecked"}var ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],RADIO_GROUP_NAME$2="RadioGroup",[createRadioGroupContext]=createContextScope$7(RADIO_GROUP_NAME$2,[createRovingFocusGroupScope,createRadioScope]),useRovingFocusGroupScope$2=createRovingFocusGroupScope(),useRadioScope=createRadioScope(),[RadioGroupProvider$1,useRadioGroupContext$1]=createRadioGroupContext(RADIO_GROUP_NAME$2),RadioGroup$2=reactExports.forwardRef((t,s)=>{const{__scopeRadioGroup:u,name:d,defaultValue:_,value:S,required:R=!1,disabled:a=!1,orientation:k,dir:O,loop:j=!0,onValueChange:V,...G}=t,J=useRovingFocusGroupScope$2(u),Z=useDirection(O),[Y,le]=useControllableState({prop:S,defaultProp:_??null,onChange:V,caller:RADIO_GROUP_NAME$2});return jsxRuntimeExports.jsx(RadioGroupProvider$1,{scope:u,name:d,required:R,disabled:a,value:Y,onValueChange:le,children:jsxRuntimeExports.jsx(Root$1,{asChild:!0,...J,orientation:k,dir:Z,loop:j,children:jsxRuntimeExports.jsx(Primitive$a.div,{role:"radiogroup","aria-required":R,"aria-orientation":k,"data-disabled":a?"":void 0,dir:Z,...G,ref:s})})})});RadioGroup$2.displayName=RADIO_GROUP_NAME$2;var ITEM_NAME$2="RadioGroupItem",RadioGroupItem$1=reactExports.forwardRef((t,s)=>{const{__scopeRadioGroup:u,disabled:d,..._}=t,S=useRadioGroupContext$1(ITEM_NAME$2,u),R=S.disabled||d,a=useRovingFocusGroupScope$2(u),k=useRadioScope(u),O=reactExports.useRef(null),j=useComposedRefs(s,O),V=S.value===_.value,G=reactExports.useRef(!1);return reactExports.useEffect(()=>{const J=Y=>{ARROW_KEYS.includes(Y.key)&&(G.current=!0)},Z=()=>G.current=!1;return document.addEventListener("keydown",J),document.addEventListener("keyup",Z),()=>{document.removeEventListener("keydown",J),document.removeEventListener("keyup",Z)}},[]),jsxRuntimeExports.jsx(Item,{asChild:!0,...a,focusable:!R,active:V,children:jsxRuntimeExports.jsx(Radio,{disabled:R,required:S.required,checked:V,...k,..._,name:S.name,ref:j,onCheck:()=>S.onValueChange(_.value),onKeyDown:composeEventHandlers(J=>{J.key==="Enter"&&J.preventDefault()}),onFocus:composeEventHandlers(_.onFocus,()=>{var J;G.current&&((J=O.current)==null||J.click())})})})});RadioGroupItem$1.displayName=ITEM_NAME$2;var INDICATOR_NAME2="RadioGroupIndicator",RadioGroupIndicator=reactExports.forwardRef((t,s)=>{const{__scopeRadioGroup:u,...d}=t,_=useRadioScope(u);return jsxRuntimeExports.jsx(RadioIndicator,{..._,...d,ref:s})});RadioGroupIndicator.displayName=INDICATOR_NAME2;var Root2$3=RadioGroup$2,Item2$1=RadioGroupItem$1,Indicator=RadioGroupIndicator;function RadioGroup$1({className:t,...s}){return jsxRuntimeExports.jsx(Root2$3,{"data-slot":"radio-group",className:cn("grid gap-3",t),...s})}function RadioGroupItem({className:t,...s}){return jsxRuntimeExports.jsx(Item2$1,{"data-slot":"radio-group-item",className:cn("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:jsxRuntimeExports.jsx(Indicator,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:jsxRuntimeExports.jsx(Circle,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var mapboxGl$1={exports:{}},mapboxGl=mapboxGl$1.exports,hasRequiredMapboxGl;function requireMapboxGl(){return hasRequiredMapboxGl||(hasRequiredMapboxGl=1,(function(t,s){(function(u,d){t.exports=d()})(mapboxGl,(function(){var u,d,_;function S(a,k){if(!u)u=k;else if(!d)d=k;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",j={};u(j),_=k(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}S(["exports"],function(a){var k=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;function j(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=n*y-p*l;return b?(o[0]=y*(b=1/b),o[1]=-l*b,o[2]=-p*b,o[3]=n*b,o):null}function V(){var o=new O(9);return O!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function G(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=e[4],T=e[5],P=e[6],I=e[7],F=e[8];return o[0]=b*F-T*I,o[1]=p*I-l*F,o[2]=l*T-p*b,o[3]=T*P-y*F,o[4]=n*F-p*P,o[5]=p*y-n*T,o[6]=y*I-b*P,o[7]=l*P-n*I,o[8]=n*b-l*y,o}function J(o,e,n){var l=e[0],p=e[1],y=e[2],b=e[3],T=e[4],P=e[5],I=e[6],F=e[7],B=e[8],N=n[0],H=n[1],W=n[2],ne=n[3],ue=n[4],ae=n[5],fe=n[6],ye=n[7],be=n[8];return o[0]=N*l+H*b+W*I,o[1]=N*p+H*T+W*F,o[2]=N*y+H*P+W*B,o[3]=ne*l+ue*b+ae*I,o[4]=ne*p+ue*T+ae*F,o[5]=ne*y+ue*P+ae*B,o[6]=fe*l+ye*b+be*I,o[7]=fe*p+ye*T+be*F,o[8]=fe*y+ye*P+be*B,o}function Z(){var o=new O(16);return O!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function Y(o){var e=new O(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e}function le(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ee(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=e[4],T=e[5],P=e[6],I=e[7],F=e[8],B=e[9],N=e[10],H=e[11],W=e[12],ne=e[13],ue=e[14],ae=e[15],fe=n*T-l*b,ye=n*P-p*b,be=n*I-y*b,Ie=l*P-p*T,Re=l*I-y*T,Ne=p*I-y*P,Ve=F*ne-B*W,Be=F*ue-N*W,He=F*ae-H*W,Ye=B*ue-N*ne,yt=B*ae-H*ne,ft=N*ae-H*ue,gt=fe*ft-ye*yt+be*Ye+Ie*He-Re*Be+Ne*Ve;return gt?(o[0]=(T*ft-P*yt+I*Ye)*(gt=1/gt),o[1]=(p*yt-l*ft-y*Ye)*gt,o[2]=(ne*Ne-ue*Re+ae*Ie)*gt,o[3]=(N*Re-B*Ne-H*Ie)*gt,o[4]=(P*He-b*ft-I*Be)*gt,o[5]=(n*ft-p*He+y*Be)*gt,o[6]=(ue*be-W*Ne-ae*ye)*gt,o[7]=(F*Ne-N*be+H*ye)*gt,o[8]=(b*yt-T*He+I*Ve)*gt,o[9]=(l*He-n*yt-y*Ve)*gt,o[10]=(W*Re-ne*be+ae*fe)*gt,o[11]=(B*be-F*Re-H*fe)*gt,o[12]=(T*Be-b*Ye-P*Ve)*gt,o[13]=(n*Ye-l*Be+p*Ve)*gt,o[14]=(ne*ye-W*Ie-ue*fe)*gt,o[15]=(F*Ie-B*ye+N*fe)*gt,o):null}function se(o,e,n){var l=e[0],p=e[1],y=e[2],b=e[3],T=e[4],P=e[5],I=e[6],F=e[7],B=e[8],N=e[9],H=e[10],W=e[11],ne=e[12],ue=e[13],ae=e[14],fe=e[15],ye=n[0],be=n[1],Ie=n[2],Re=n[3];return o[0]=ye*l+be*T+Ie*B+Re*ne,o[1]=ye*p+be*P+Ie*N+Re*ue,o[2]=ye*y+be*I+Ie*H+Re*ae,o[3]=ye*b+be*F+Ie*W+Re*fe,o[4]=(ye=n[4])*l+(be=n[5])*T+(Ie=n[6])*B+(Re=n[7])*ne,o[5]=ye*p+be*P+Ie*N+Re*ue,o[6]=ye*y+be*I+Ie*H+Re*ae,o[7]=ye*b+be*F+Ie*W+Re*fe,o[8]=(ye=n[8])*l+(be=n[9])*T+(Ie=n[10])*B+(Re=n[11])*ne,o[9]=ye*p+be*P+Ie*N+Re*ue,o[10]=ye*y+be*I+Ie*H+Re*ae,o[11]=ye*b+be*F+Ie*W+Re*fe,o[12]=(ye=n[12])*l+(be=n[13])*T+(Ie=n[14])*B+(Re=n[15])*ne,o[13]=ye*p+be*P+Ie*N+Re*ue,o[14]=ye*y+be*I+Ie*H+Re*ae,o[15]=ye*b+be*F+Ie*W+Re*fe,o}function Q(o,e,n){var l,p,y,b,T,P,I,F,B,N,H,W,ne=n[0],ue=n[1],ae=n[2];return e===o?(o[12]=e[0]*ne+e[4]*ue+e[8]*ae+e[12],o[13]=e[1]*ne+e[5]*ue+e[9]*ae+e[13],o[14]=e[2]*ne+e[6]*ue+e[10]*ae+e[14],o[15]=e[3]*ne+e[7]*ue+e[11]*ae+e[15]):(p=e[1],y=e[2],b=e[3],T=e[4],P=e[5],I=e[6],F=e[7],B=e[8],N=e[9],H=e[10],W=e[11],o[0]=l=e[0],o[1]=p,o[2]=y,o[3]=b,o[4]=T,o[5]=P,o[6]=I,o[7]=F,o[8]=B,o[9]=N,o[10]=H,o[11]=W,o[12]=l*ne+T*ue+B*ae+e[12],o[13]=p*ne+P*ue+N*ae+e[13],o[14]=y*ne+I*ue+H*ae+e[14],o[15]=b*ne+F*ue+W*ae+e[15]),o}function oe(o,e,n){var l=n[0],p=n[1],y=n[2];return o[0]=e[0]*l,o[1]=e[1]*l,o[2]=e[2]*l,o[3]=e[3]*l,o[4]=e[4]*p,o[5]=e[5]*p,o[6]=e[6]*p,o[7]=e[7]*p,o[8]=e[8]*y,o[9]=e[9]*y,o[10]=e[10]*y,o[11]=e[11]*y,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function _e(o,e,n){var l=Math.sin(n),p=Math.cos(n),y=e[4],b=e[5],T=e[6],P=e[7],I=e[8],F=e[9],B=e[10],N=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=y*p+I*l,o[5]=b*p+F*l,o[6]=T*p+B*l,o[7]=P*p+N*l,o[8]=I*p-y*l,o[9]=F*p-b*l,o[10]=B*p-T*l,o[11]=N*p-P*l,o}function Se(o,e,n){var l=Math.sin(n),p=Math.cos(n),y=e[0],b=e[1],T=e[2],P=e[3],I=e[8],F=e[9],B=e[10],N=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=y*p-I*l,o[1]=b*p-F*l,o[2]=T*p-B*l,o[3]=P*p-N*l,o[8]=y*l+I*p,o[9]=b*l+F*p,o[10]=T*l+B*p,o[11]=P*l+N*p,o}function ke(o,e,n){var l=Math.sin(n),p=Math.cos(n),y=e[0],b=e[1],T=e[2],P=e[3],I=e[4],F=e[5],B=e[6],N=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=y*p+I*l,o[1]=b*p+F*l,o[2]=T*p+B*l,o[3]=P*p+N*l,o[4]=I*p-y*l,o[5]=F*p-b*l,o[6]=B*p-T*l,o[7]=N*p-P*l,o}function Le(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function lt(o,e,n){var l,p,y,b=n[0],T=n[1],P=n[2],I=Math.sqrt(b*b+T*T+P*P);return I<k?null:(b*=I=1/I,T*=I,P*=I,l=Math.sin(e),p=Math.cos(e),o[0]=b*b*(y=1-p)+p,o[1]=T*b*y+P*l,o[2]=P*b*y-T*l,o[3]=0,o[4]=b*T*y-P*l,o[5]=T*T*y+p,o[6]=P*T*y+b*l,o[7]=0,o[8]=b*P*y+T*l,o[9]=T*P*y-b*l,o[10]=P*P*y+p,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function qt(o,e){var n=e[0],l=e[1],p=e[2],y=e[4],b=e[5],T=e[6],P=e[8],I=e[9],F=e[10];return o[0]=Math.sqrt(n*n+l*l+p*p),o[1]=Math.sqrt(y*y+b*b+T*T),o[2]=Math.sqrt(P*P+I*I+F*F),o}function Yt(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=n+n,T=l+l,P=p+p,I=n*b,F=l*b,B=l*T,N=p*b,H=p*T,W=p*P,ne=y*b,ue=y*T,ae=y*P;return o[0]=1-B-W,o[1]=F+ae,o[2]=N-ue,o[3]=0,o[4]=F-ae,o[5]=1-I-W,o[6]=H+ne,o[7]=0,o[8]=N+ue,o[9]=H-ne,o[10]=1-I-B,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var Ot=se;function Bt(){var o=new O(3);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function si(o){var e=new O(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function kt(o){var e=o[0],n=o[1],l=o[2];return Math.sqrt(e*e+n*n+l*l)}function xe(o,e,n){var l=new O(3);return l[0]=o,l[1]=e,l[2]=n,l}function Fe(o,e,n,l){return o[0]=e,o[1]=n,o[2]=l,o}function pe(o,e,n){return o[0]=e[0]+n[0],o[1]=e[1]+n[1],o[2]=e[2]+n[2],o}function Te(o,e,n){return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],o}function st(o,e,n){return o[0]=e[0]*n[0],o[1]=e[1]*n[1],o[2]=e[2]*n[2],o}function Me(o,e,n){return o[0]=Math.min(e[0],n[0]),o[1]=Math.min(e[1],n[1]),o[2]=Math.min(e[2],n[2]),o}function at(o,e,n){return o[0]=Math.max(e[0],n[0]),o[1]=Math.max(e[1],n[1]),o[2]=Math.max(e[2],n[2]),o}function ct(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o[2]=e[2]*n,o}function Ct(o,e,n,l){return o[0]=e[0]+n[0]*l,o[1]=e[1]+n[1]*l,o[2]=e[2]+n[2]*l,o}function li(o,e){var n=e[0]-o[0],l=e[1]-o[1],p=e[2]-o[2];return Math.sqrt(n*n+l*l+p*p)}function mi(o,e){var n=e[0]-o[0],l=e[1]-o[1],p=e[2]-o[2];return n*n+l*l+p*p}function bi(o){var e=o[0],n=o[1],l=o[2];return e*e+n*n+l*l}function zi(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function vi(o,e){var n=e[0],l=e[1],p=e[2],y=n*n+l*l+p*p;return y>0&&(y=1/Math.sqrt(y)),o[0]=e[0]*y,o[1]=e[1]*y,o[2]=e[2]*y,o}function Gi(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function lr(o,e,n){var l=e[0],p=e[1],y=e[2],b=n[0],T=n[1],P=n[2];return o[0]=p*P-y*T,o[1]=y*b-l*P,o[2]=l*T-p*b,o}function zr(o,e,n,l){var p=e[0],y=e[1],b=e[2];return o[0]=p+l*(n[0]-p),o[1]=y+l*(n[1]-y),o[2]=b+l*(n[2]-b),o}function Ui(o,e,n){var l=e[0],p=e[1],y=e[2],b=n[3]*l+n[7]*p+n[11]*y+n[15];return o[0]=(n[0]*l+n[4]*p+n[8]*y+n[12])/(b=b||1),o[1]=(n[1]*l+n[5]*p+n[9]*y+n[13])/b,o[2]=(n[2]*l+n[6]*p+n[10]*y+n[14])/b,o}function Ci(o,e,n){var l=e[0],p=e[1],y=e[2];return o[0]=l*n[0]+p*n[3]+y*n[6],o[1]=l*n[1]+p*n[4]+y*n[7],o[2]=l*n[2]+p*n[5]+y*n[8],o}function Gn(o,e,n){var l=n[0],p=n[1],y=n[2],b=n[3],T=e[0],P=e[1],I=e[2],F=p*I-y*P,B=y*T-l*I,N=l*P-p*T;return o[0]=T+b*(F+=F)+p*(N+=N)-y*(B+=B),o[1]=P+b*B+y*F-l*N,o[2]=I+b*N+l*B-p*F,o}function Wn(o){return o[0]=0,o[1]=0,o[2]=0,o}function vn(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var Sr=Te,Xr=st,es=kt;function Un(){var o=new O(4);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function dn(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o[2]=e[2]*n,o[3]=e[3]*n,o}function os(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=n*n+l*l+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),o[0]=n*b,o[1]=l*b,o[2]=p*b,o[3]=y*b,o}function Dr(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]*e[3]}function jn(o,e,n){var l=e[0],p=e[1],y=e[2],b=e[3];return o[0]=n[0]*l+n[4]*p+n[8]*y+n[12]*b,o[1]=n[1]*l+n[5]*p+n[9]*y+n[13]*b,o[2]=n[2]*l+n[6]*p+n[10]*y+n[14]*b,o[3]=n[3]*l+n[7]*p+n[11]*y+n[15]*b,o}function Rn(){var o=new O(4);return O!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function ys(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function As(o,e,n){n*=.5;var l=e[0],p=e[1],y=e[2],b=e[3],T=Math.sin(n),P=Math.cos(n);return o[0]=l*P+b*T,o[1]=p*P+y*T,o[2]=y*P-p*T,o[3]=b*P-l*T,o}function sa(o,e,n){n*=.5;var l=e[0],p=e[1],y=e[2],b=e[3],T=Math.sin(n),P=Math.cos(n);return o[0]=l*P-y*T,o[1]=p*P+b*T,o[2]=y*P+l*T,o[3]=b*P-p*T,o}Bt(),Un();var bn,Al,_s,Co=os,Zn=(bn=Bt(),Al=xe(1,0,0),_s=xe(0,1,0),function(o,e,n){var l=Gi(e,n);return l<-.999999?(lr(bn,Al,e),es(bn)<1e-6&&lr(bn,_s,e),vi(bn,bn),(function(p,y,b){b*=.5;var T=Math.sin(b);p[0]=T*y[0],p[1]=T*y[1],p[2]=T*y[2],p[3]=Math.cos(b)})(o,bn,Math.PI),o):l>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(lr(bn,e,n),o[0]=bn[0],o[1]=bn[1],o[2]=bn[2],o[3]=1+l,Co(o,o))});function Sn(){var o=new O(2);return O!=Float32Array&&(o[0]=0,o[1]=0),o}function $n(o,e){var n=new O(2);return n[0]=o,n[1]=e,n}function Ro(o,e,n){return o[0]=e,o[1]=n,o}function ao(o,e,n){return o[0]=e[0]+n[0],o[1]=e[1]+n[1],o}function Ls(o,e,n){return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o}function qa(o,e,n){return o[0]=e[0]*n,o[1]=e[1]*n,o}function Wa(o){var e=o[0],n=o[1];return Math.sqrt(e*e+n*n)}function oo(o,e){var n=e[0],l=e[1],p=n*n+l*l;return p>0&&(p=1/Math.sqrt(p)),o[0]=e[0]*p,o[1]=e[1]*p,o}function Tr(o,e){return o[0]*e[0]+o[1]*e[1]}Rn(),Rn(),V();var $i,Mn,Xn=Ls;function Tn(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}Sn();var tl=(function(){if(Mn)return $i;function o(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return Mn=1,$i=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var y=this.sampleCurveX(l)-e;if(Math.abs(y)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=y/b}var T=0,P=1;for(l=e,p=0;p<20&&(y=this.sampleCurveX(l),!(Math.abs(y-e)<n));p++)e>y?T=l:P=l,l=.5*(P-T)+T;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},$i})(),An=Tn(tl);function Pt(o,e){this.x=o,this.y=e}function ga(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(!ga(o[n],e[n]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const n in o)if(!ga(o[n],e[n]))return!1;return!0}return o===e}Pt.prototype={clone(){return new Pt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,n=o.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),n=Math.sin(o),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(o,e){const n=Math.cos(o),l=Math.sin(o),p=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Pt},Pt.convert=function(o){if(o instanceof Pt)return o;if(Array.isArray(o))return new Pt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Pt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const aa=Math.PI/180,Os=180/Math.PI;function tr(o){return o*aa}function Je(o){return o*Os}const me=[[0,0],[1,0],[1,1],[0,1]];function ve(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,n=e*o;return 4*(o<.5?n:3*(o-e)+n-.75)}function De(o,e,n,l){const p=new An(o,e,n,l);return function(y){return p.solve(y)}}const qe=De(.25,.1,.25,1);function Oe(o,e,n){return Math.min(n,Math.max(e,o))}function Ke(o,e,n){return(n=Oe((n-o)/(e-o),0,1))*n*(3-2*n)}function ut(o,e,n){const l=n-e,p=((o-e)%l+l)%l+e;return p===e?n:p}function et(o,e,n){if(!o.length)return n(null,[]);let l=o.length;const p=new Array(o.length);let y=null;o.forEach((b,T)=>{e(b,(P,I)=>{P&&(y=P),p[T]=I,--l===0&&n(y,p)})})}let dt=1;function Ft(){return dt++}function It(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function ii(o,e){o.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function yi(o,e,n){const l={};for(const p in o)l[p]=e.call(this,o[p],p,o);return l}function wi(o,e,n){const l={};for(const p in o)e.call(this,o[p],p,o)&&(l[p]=o[p]);return l}function Li(o){return Array.isArray(o)?o.map(Li):typeof o=="object"&&o?yi(o,Li):o}function Vi(o,e){for(let n=0;n<o.length;n++)if(e.indexOf(o[n])>=0)return!0;return!1}const xi={};function Pi(o){xi[o]||(typeof console<"u"&&console.warn(o),xi[o]=!0)}function Fr(o,e,n){return(n.y-o.y)*(e.x-o.x)>(e.y-o.y)*(n.x-o.x)}function fn(o){let e=0;for(let n,l,p=0,y=o.length,b=y-1;p<y;b=p++)n=o[p],l=o[b],e+=(l.x-n.x)*(n.y+l.y);return e}function Wr([o,e,n]){const l=tr(e+90),p=tr(n);return{x:o*Math.cos(l)*Math.sin(p),y:o*Math.sin(l)*Math.sin(p),z:o*Math.cos(p),azimuthal:e,polar:n}}function wn(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function qr(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,p,y)=>{const b=p||y;return e[l]=!b||b.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let rr=null;function Yr(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Ar(o,e,n,l){for(;e<n;){const p=e+n>>1;o[p]<l?e=p+1:n=p}return e}function Cr(o,e,n,l){for(;e<n;){const p=e+n>>1;o[p]<=l?e=p+1:n=p}return e}function Br(o){return o>0?1/(1.001-o):1+o}function pn(o){return o>0?1-1/(1.001-o):-o}function ls(o,e,n){return(o-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const Yn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Yn.API_URL)return null;try{const o=new URL(Yn.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function il(o){return Yn.API_URL_REGEX.test(o)}function zs(o){return Yn.API_SPRITE_REGEX.test(o)}let Ws,lo,ts,oa,Zs,Mo;function co(){return Ws==null&&(Ws=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ws}const ka={now:()=>oa!==void 0?oa:performance.now(),setNow(o){oa=o},restoreNow(){oa=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:n,height:l}=o;Zs||(Zs=document.createElement("canvas"));const p=Zs.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(n>Zs.width||l>Zs.height)&&(Zs.width=n,Zs.height=l),p.clearRect(-e,-e,n+2*e,l+2*e),p.drawImage(o,0,0,n,l),p.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:o=>(lo||(lo=document.createElement("a")),lo.href=o,lo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ts==null&&(ts=window.matchMedia("(prefers-reduced-motion: reduce)")),ts.matches)},hasCanvasFingerprintNoise(){if(Mo!==void 0)return Mo;if(!co())return Mo=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let n=0;for(let p=0;p<o.width;++p)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(p,0,1,1);const l=e.getImageData(0,0,o.width,o.height);n=0;for(let p=0;p<l.data.length;++p)if(p%4!=3&&n++!==l.data[p])return Mo=!0,!0;return Mo=!1,!1}};function Du(o,e){const n=o.indexOf("?");if(n<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(n));for(const p in e)l.set(p,e[p]);return`${o.slice(0,n)}?${l.toString()}`}function rl(o,e={persistentParams:[]}){const n=o.indexOf("?");if(n<0)return o;const l=new URLSearchParams,p=new URLSearchParams(o.slice(n));for(const b of e.persistentParams){const T=p.get(b);T&&l.set(b,T)}const y=l.toString();return`${o.slice(0,n)}${y.length>0?`?${y}`:""}`}const Am="mapbox-tiles";let np=500,Ud=50;const Fh=["language","worldview","jobid"];let xs,Za;function uo(){try{return caches}catch{}}function cs(){const o=uo();o&&xs==null&&(xs=o.open(Am))}let ho=1/0;const sc={supported:!1,testSupport:function(o){!Cl&&fo&&(ku?Lu(o):Po=o)}};let Po,fo,Cl=!1,ku=!1;const sp=typeof self<"u"?self:{};function Lu(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,fo),o.isContextLost())return;sc.supported=!0}catch{}o.deleteTexture(e),Cl=!0}sp.document&&(fo=sp.document.createElement("img"),fo.onload=function(){Po&&Lu(Po),Po=null,ku=!0},fo.onerror=function(){Cl=!0,Po=null},fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Kn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Kn);class jc extends Error{constructor(e,n,l){n===401&&il(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Rl=wn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,la=function(o,e){if(!(/^file:/.test(n=o.url)||/^file:/.test(Rl())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,p){const y=new AbortController,b=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Rl(),referrerPolicy:l.referrerPolicy,signal:y.signal});let T=!1,P=!1;const I=(F=b.url).indexOf("sku=")>0&&il(F);var F;l.type==="json"&&b.headers.set("Accept","application/json");const B=(H,W,ne)=>{if(P)return;if(H&&H.message!=="SecurityError"&&Pi(H.toString()),W&&ne)return N(W);const ue=Date.now();fetch(b).then(ae=>{if(ae.ok){const fe=I?ae.clone():null;return N(ae,fe,ue)}return p(new jc(ae.statusText,ae.status,l.url))}).catch(ae=>{ae.name!=="AbortError"&&p(new Error(`${ae.message} ${l.url}`))})},N=(H,W,ne)=>{(l.type==="arrayBuffer"?H.arrayBuffer():l.type==="json"?H.json():H.text()).then(ue=>{P||(W&&ne&&(function(ae,fe,ye){if(cs(),xs==null)return;const be=qr(fe.headers.get("Cache-Control")||"");if(be["no-store"])return;const Ie={status:fe.status,statusText:fe.statusText,headers:new Headers};fe.headers.forEach((Ve,Be)=>Ie.headers.set(Be,Ve)),be["max-age"]&&Ie.headers.set("Expires",new Date(ye+1e3*be["max-age"]).toUTCString());const Re=Ie.headers.get("Expires");if(!Re||new Date(Re).getTime()-ye<42e4)return;let Ne=rl(ae.url,{persistentParams:Fh});if(fe.status===206){const Ve=ae.headers.get("Range");if(!Ve)return;Ie.status=200,Ne=Du(Ne,{range:Ve})}(function(Ve,Be){if(Za===void 0)try{new Response(new ReadableStream),Za=!0}catch{Za=!1}Za?Be(Ve.body):Ve.blob().then(Be).catch(He=>Pi(He.message))})(fe,Ve=>{const Be=new Response((He=fe.status)!==200&&He!==404&&[101,103,204,205,304].includes(He)?null:Ve,Ie);var He;cs(),xs!=null&&xs.then(Ye=>Ye.put(Ne,Be)).catch(Ye=>Pi(Ye.message))})})(b,W,ne),T=!0,p(null,ue,H.headers))}).catch(ue=>{P||p(new Error(ue.message))})};return I?(function(H,W){if(cs(),xs==null)return W(null);xs.then(ne=>{let ue=rl(H.url,{persistentParams:Fh});const ae=H.headers.get("Range");ae&&(ue=Du(ue,{range:ae})),ne.match(ue).then(fe=>{const ye=(function(be){if(!be)return!1;const Ie=new Date(be.headers.get("Expires")||0),Re=qr(be.headers.get("Cache-Control")||"");return Number(Ie)>Date.now()&&!Re["no-cache"]})(fe);ne.delete(ue).catch(W),ye&&ne.put(ue,fe.clone()).catch(W),W(null,fe,ye)}).catch(W)}).catch(W)})(b,B):B(null,null),{cancel:()=>{P=!0,T||y.abort()}}})(o,e);if(wn(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var n;return(function(l,p){const y=new XMLHttpRequest;y.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in l.headers)y.setRequestHeader(b,l.headers[b]);return l.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=l.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(l.type==="json")try{b=JSON.parse(y.response)}catch(P){return p(P)}const T=new Headers;y.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(P=>{const I=P.split(": "),F=I.shift(),B=I.join(": ");T.append(F,B)}),p(null,b,T)}else p(new jc(y.statusText,y.status,l.url))},y.send(l.body),{cancel:()=>y.abort()}})(o,e)},Nc=function(o,e){return la(Object.assign(o,{type:"arrayBuffer"}),e)};function Gd(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const $d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nr,Ml;nr=[],Ml=0;const Bh=function(o,e){if(sc.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ml>=Yn.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return nr.push(y),y}Ml++;let n=!1;const l=()=>{if(!n)for(n=!0,Ml--;nr.length&&Ml<Yn.MAX_PARALLEL_IMAGE_REQUESTS;){const y=nr.shift(),{requestParameters:b,callback:T,cancelled:P}=y;P||(y.cancel=Bh(b,T).cancel)}},p=Nc(o,(y,b,T)=>{l(),y?e(y):b&&(self.createImageBitmap?(function(P,I){const F=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(F).then(B=>{I(null,B)}).catch(B=>{I(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(b,(P,I)=>e(P,I,T)):(function(P,I){const F=new Image;F.onload=()=>{I(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=$d})},F.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Blob([new Uint8Array(P)],{type:"image/png"});F.src=P.byteLength?URL.createObjectURL(B):$d})(b,(P,I)=>e(P,I,T)))});return{cancel:()=>{p.cancel(),l()}}};var ya,ac,oc,po={exports:{}},jh={exports:{}},Ou={exports:{}},ap=(function(){if(oc)return po.exports;oc=1;var o=(ya||(ya=1,jh.exports=function(n,l){var p,y,b,T,P,I,F,B;for(y=n.length-(p=3&n.length),b=l,P=3432918353,I=461845907,B=0;B<y;)F=255&n.charCodeAt(B)|(255&n.charCodeAt(++B))<<8|(255&n.charCodeAt(++B))<<16|(255&n.charCodeAt(++B))<<24,++B,b=27492+(65535&(T=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*P+(((F>>>16)*P&65535)<<16)&4294967295)<<15|F>>>17))*I+(((F>>>16)*I&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+(((T>>>16)+58964&65535)<<16);switch(F=0,p){case 3:F^=(255&n.charCodeAt(B+2))<<16;case 2:F^=(255&n.charCodeAt(B+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&n.charCodeAt(B)))*P+(((F>>>16)*P&65535)<<16)&4294967295)<<15|F>>>17))*I+(((F>>>16)*I&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),jh.exports),e=(ac||(ac=1,Ou.exports=function(n,l){for(var p,y=n.length,b=l^y,T=0;y>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(T)|(255&n.charCodeAt(++T))<<8|(255&n.charCodeAt(++T))<<16|(255&n.charCodeAt(++T))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++T;switch(y){case 3:b^=(255&n.charCodeAt(T+2))<<16;case 2:b^=(255&n.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Ou.exports);return po.exports=o,po.exports.murmur3=o,po.exports.murmur2=e,po.exports})(),nl=Tn(ap);class mo{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class zu extends mo{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function Cm(o,e,n){n[o]&&n[o].indexOf(e)!==-1||(n[o]=n[o]||[],n[o].push(e))}function Vc(o,e,n){if(n&&n[o]){const l=n[o].indexOf(e);l!==-1&&n[o].splice(l,1)}}class Pl{on(e,n){return this._listeners=this._listeners||{},Cm(e,n,this._listeners),this}off(e,n){return Vc(e,n,this._listeners),Vc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Cm(e,n,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,n){const l=typeof e=="string"?new mo(e,n):e,p=l.type;if(this.listens(p)){l.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const P of y)P.call(this,l);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const P of b)Vc(p,P,this._oneTimeListeners),P.call(this,l);const T=this._eventedParent;if(T){const P=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,P),T.fire(l)}}else l instanceof zu&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class Xs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Xs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,l]=e.split("");return new Xs({name:n,iconsetId:l})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return Xs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var go,Hd={},Rm=(function(){if(go)return Hd;go=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(y){return(y=Math.round(y))<0?0:y>255?255:y}function n(y){return e(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function l(y){return(b=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function p(y,b,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?y+(b-y)*T*6:2*T<1?b:3*T<2?y+(b-y)*(2/3-T)*6:y}try{Hd.parseCSSColor=function(y){var b,T=y.replace(/ /g,"").toLowerCase();if(T in o)return o[T].slice();if(T[0]==="#")return T.length===4?(b=parseInt(T.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:T.length===7&&(b=parseInt(T.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var P=T.indexOf("("),I=T.indexOf(")");if(P!==-1&&I+1===T.length){var F=T.substr(0,P),B=T.substr(P+1,I-(P+1)).split(","),N=1;switch(F){case"rgba":if(B.length!==4)return null;N=l(B.pop());case"rgb":return B.length!==3?null:[n(B[0]),n(B[1]),n(B[2]),N];case"hsla":if(B.length!==4)return null;N=l(B.pop());case"hsl":if(B.length!==3)return null;var H=(parseFloat(B[0])%360+360)%360/360,W=l(B[1]),ne=l(B[2]),ue=ne<=.5?ne*(W+1):ne+W-ne*W,ae=2*ne-ue;return[e(255*p(ae,ue,H+1/3)),e(255*p(ae,ue,H)),e(255*p(ae,ue,H-1/3)),N];default:return null}}return null}}catch{}return Hd})();class _r{constructor(e,n,l,p=1){this.r=e,this.g=n,this.b=l,this.a=p}static parse(e){if(!e)return;if(e instanceof _r)return e;if(typeof e!="string")return;const n=Rm.parseCSSColor(e);return n?new _r(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,l,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*l)},${p})`}toNonPremultipliedRenderColor(e){const{r:n,g:l,b:p,a:y}=this;return new cp(e,n,l,p,y)}toPremultipliedRenderColor(e){const{r:n,g:l,b:p,a:y}=this;return new Mm(e,n*y,l*y,p*y,y)}clone(){return new _r(this.r,this.g,this.b,this.a)}}class lp{constructor(e,n,l,p,y,b=!1){if(this.premultiplied=!1,this.premultiplied=b,e){const T=e.image.height,P=T*T;this.premultiplied?(n=y===0?0:n/y*(T-1),l=y===0?0:l/y*(T-1),p=y===0?0:p/y*(T-1)):(n*=T-1,l*=T-1,p*=T-1),n=Math.max(0,Math.min(T-1,n)),l=Math.max(0,Math.min(T-1,l)),p=Math.max(0,Math.min(T-1,p));const I=Math.floor(n),F=Math.floor(l),B=Math.floor(p),N=Math.ceil(n),H=Math.ceil(l),W=Math.ceil(p),ne=n-I,ue=l-F,ae=p-B,fe=e.image.data,ye=4*(I+F*P+B*T),be=4*(I+F*P+W*T),Ie=4*(I+H*P+B*T),Re=4*(I+H*P+W*T),Ne=4*(N+F*P+B*T),Ve=4*(N+F*P+W*T),Be=4*(N+H*P+B*T),He=4*(N+H*P+W*T);this.r=Ri(Ri(Ri(fe[ye],fe[be],ae),Ri(fe[Ie],fe[Re],ae),ue),Ri(Ri(fe[Ne],fe[Ve],ae),Ri(fe[Be],fe[He],ae),ue),ne)/255*(this.premultiplied?y:1),this.g=Ri(Ri(Ri(fe[ye+1],fe[be+1],ae),Ri(fe[Ie+1],fe[Re+1],ae),ue),Ri(Ri(fe[Ne+1],fe[Ve+1],ae),Ri(fe[Be+1],fe[He+1],ae),ue),ne)/255*(this.premultiplied?y:1),this.b=Ri(Ri(Ri(fe[ye+2],fe[be+2],ae),Ri(fe[Ie+2],fe[Re+2],ae),ue),Ri(Ri(fe[Ne+2],fe[Ve+2],ae),Ri(fe[Be+2],fe[He+2],ae),ue),ne)/255*(this.premultiplied?y:1),this.a=y}else this.r=n,this.g=l,this.b=p,this.a=y}toArray(){const{r:e,g:n,b:l,a:p}=this;return[255*e,255*n,255*l,p]}toHslaArray(){let{r:e,g:n,b:l,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const W=1/p;e*=W,n*=W,l*=W}const y=Math.min(Math.max(e,0),1),b=Math.min(Math.max(n,0),1),T=Math.min(Math.max(l,0),1),P=Math.min(y,b,T),I=Math.max(y,b,T),F=I-P,B=.5*(P+I);if(F===0)return[0,0,100*B,p];const N=B>.5?F/(2-I-P):F/(I+P);let H;switch(I){case y:H=60*((b-T)/F+(b<T?6:0));break;case b:H=60*((T-y)/F+2);break;default:H=60*((y-b)/F+4)}return[H,100*N,100*B,p]}toArray01(){const{r:e,g:n,b:l,a:p}=this;return[e,n,l,p]}toArray01Scaled(e){const{r:n,g:l,b:p}=this;return[n*e,l*e,p*e]}toArray01Linear(){const{r:e,g:n,b:l,a:p}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(l,2.2),p]}}class cp extends lp{constructor(e,n,l,p,y){super(e,n,l,p,y,!1)}}class Mm extends lp{constructor(e,n,l,p,y){super(e,n,l,p,y,!0)}}function Ri(o,e,n){return o*(1-n)+e*n}function up(o,e,n){return o.map((l,p)=>Ri(l,e[p],n))}_r.black=new _r(0,0,0,1),_r.white=new _r(1,1,1,1),_r.transparent=new _r(0,0,0,0),_r.red=new _r(1,0,0,1),_r.blue=new _r(0,0,1,1);var Uc=Object.freeze({__proto__:null,array:up,color:function(o,e,n){return new _r(Ri(o.r,e.r,n),Ri(o.g,e.g,n),Ri(o.b,e.b,n),Ri(o.a,e.a,n))},number:Ri});class Fs extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class qd{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,p]of n)this.bindings[l]=p}concat(e){return new qd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const _a={kind:"null"},gi={kind:"number"},gr={kind:"string"},dr={kind:"boolean"},ca={kind:"color"},Fu={kind:"object"},wr={kind:"value"},Wd={kind:"collator"},Bu={kind:"formatted"},Gc={kind:"resolvedImage"};function Ys(o,e){return{kind:"array",itemType:o,N:e}}function Pn(o){if(o.kind==="array"){const e=Pn(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const hp=[_a,gi,gr,dr,ca,Bu,Fu,Ys(wr),Gc];function Il(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Il(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const n of hp)if(!Il(n,e))return null}}return`Expected ${Pn(o)} but found ${Pn(e)} instead.`}function dp(o,e){return e.some(n=>n.kind===o.kind)}function ju(o,e){return e.some(n=>n==="null"?o===null:n==="array"?Array.isArray(o):n==="object"?o&&!Array.isArray(o)&&typeof o=="object":n===typeof o)}function Nh(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&Nh(o.itemType,e.itemType):o.kind===e.kind}class Zd{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vh{constructor(e,n,l,p,y){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=p,this.textColor=y}}class Bs{constructor(e){this.sections=e}static fromString(e){return new Bs([new Vh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Bs?e:Bs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const p=n.image.getPrimary().id.toString();e.push(["image",p]);continue}e.push(n.text);const l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class vs{constructor(e,n={}){this.id=Xs.from(e),this.params=n.params,this.sx=n.sx||1,this.sy=n.sy||1}toString(){return JSON.stringify(this)}static parse(e){let n,l,p,y;try{({id:n,params:l,sx:p,sy:y}=JSON.parse(e)||{})}catch{return null}return n?new vs(n,{params:l,sx:p,sy:y}):null}scaleSelf(e,n=e){return this.sx*=e,this.sy*=n,this}}class xa{constructor(e,n,l,p,y=!1){this.primaryId=Xs.from(e),this.primaryOptions=n,l&&(this.secondaryId=Xs.from(l)),this.secondaryOptions=p,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new vs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new vs(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?xa.build({name:e}):e}static build(e,n,l,p){return!e||typeof e=="object"&&!("name"in e)?null:new xa(e,l,n,p)}}function fp(o,e,n,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,n,l]:[o,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lc(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof _r||o instanceof Zd||o instanceof Bs||o instanceof xa)return!0;if(Array.isArray(o)){for(const e of o)if(!lc(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!lc(o[e]))return!1;return!0}return!1}function Qn(o){if(o===null)return _a;if(typeof o=="string")return gr;if(typeof o=="boolean")return dr;if(typeof o=="number")return gi;if(o instanceof _r)return ca;if(o instanceof Zd)return Wd;if(o instanceof Bs)return Bu;if(o instanceof xa)return Gc;if(Array.isArray(o)){const e=o.length;let n;for(const l of o){const p=Qn(l);if(n){if(n===p)continue;n=wr;break}n=p}return Ys(n||wr,e)}return Fu}function Io(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Bs||o instanceof xa||o instanceof _r?o.toString():JSON.stringify(o)}class Xa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!lc(e[1]))return n.error("invalid value");const l=e[1];let p=Qn(l);const y=n.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Xa(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _r?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Bs?this.value.serialize():this.value}}class In{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const cc={string:gr,number:gi,boolean:dr,object:Fu};class Ii{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,p=1;const y=e[0];if(y==="array"){let T,P;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in cc)||I==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=cc[I],p++}else T=wr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);P=e[2],p++}l=Ys(T,P)}else l=cc[y];const b=[];for(;p<e.length;p++){const T=n.parse(e[p],p,wr);if(!T)return null;b.push(T)}return new Ii(l,b)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!Il(this.type,Qn(l)))return l;if(n===this.args.length-1)throw new In(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Pn(Qn(l))} but was expected to be of type ${Pn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);const p=e.N;(typeof p=="number"||this.args.length>1)&&n.push(p)}}return n.concat(this.args.map(l=>l.serialize()))}}class fi{constructor(e){this.type=Bu,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const p=[];let y=!1;for(let b=1;b<=e.length-1;++b){const T=e[b];if(y&&typeof T=="object"&&!Array.isArray(T)){y=!1;let P=null;if(T["font-scale"]&&(P=n.parseObjectValue(T["font-scale"],b,"font-scale",gi),!P))return null;let I=null;if(T["text-font"]&&(I=n.parseObjectValue(T["text-font"],b,"text-font",Ys(gr)),!I))return null;let F=null;if(T["text-color"]&&(F=n.parseObjectValue(T["text-color"],b,"text-color",ca),!F))return null;const B=p[p.length-1];B.scale=P,B.font=I,B.textColor=F}else{const P=n.parse(e[b],b,wr);if(!P)return null;const I=P.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new fi(p)}evaluate(e){return new Bs(this.sections.map(n=>{const l=n.content.evaluate(e);return Nh(Qn(l),Gc)?new Vh("",l,null,null,null):new Vh(Io(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class $c{constructor(e,n,l,p){this._imageWarnHistory={},this.type=Gc,this.namePrimary=e,this.nameSecondary=n,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let l=1;const p=[];function y(){if(l<e.length){const T=n.parse(e[l],l++,gr);return T?(p.push({image:T,options:{}}),!0):(n.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function b(){if(l<e.length){const P=e[l];if((T=P)===null||typeof T!="object"||Array.isArray(T))return!0;const I=P.params,F=P.iconset,B=n.concat(l);if(!I&&!F)return l++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return B.error('Image options "params" should be an object'),!1;const N={},H=B.concat(void 0,"params");for(const W in I){if(!W)return H.error("Image parameter name should be non-empty"),!1;const ne=H.concat(void 0,W).parse(I[W],void 0,ca,void 0,{typeAnnotation:"coerce"});if(!ne)return!1;N[W]=ne}p[p.length-1].options.params=N}if(F){if(typeof F!="object"||F.constructor!==Object)return B.error('Image options "iconset" should be an object'),!1;if(!F.id)return B.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=F}return l++,!0}var T;return!0}for(let T=0;T<2;T++)if(!y()||!b())return;return new $c(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(e,n){const l={};if(n){for(const p in n)if(n[p])try{l[p]=n[p].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,p=xa.build(n,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(p&&e.availableImages){const y=p.getPrimary().id;if(p.available=e.availableImages.some(b=>Xs.isEqual(b,y)),p.available){const b=p.getSecondary()?p.getSecondary().id:null;b&&(p.available=e.availableImages.some(T=>Xs.isEqual(T,b)))}}return p}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const l={};if(n&&(l.iconset={id:n}),e){l.params={};for(const p in e)e[p]&&(l.params[p]=e[p].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Mi(o){return Vu(o)?"string":Si(o)?"number":Xd(o)?"boolean":Array.isArray(o)?"array":o===null?"null":Nu(o)?"object":typeof o}function Nu(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function Vu(o){return typeof o=="string"||o instanceof String}function Si(o){return typeof o=="number"||o instanceof Number}function Xd(o){return typeof o=="boolean"||o instanceof Boolean}const pp={"to-boolean":dr,"to-color":ca,"to-number":gi,"to-string":gr};class sl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0],p=[];let y=_a;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const b=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);y=Ys(n.expectedType.itemType,b)}else{if(!(b>0&&lc(e[1][0])))return null;y=Ys(Qn(e[1][0]),b)}for(let T=0;T<b;T++){const P=e[1][T];let I;if(Array.isArray(P))I=n.parse(P,void 0,y.itemType);else{const F=Mi(P);if(F!==y.itemType.kind)return n.error(`Expected ${y.itemType.kind} but found ${F}.`);I=n.registry.literal.parse(["literal",P===void 0?null:P],n)}if(!I)return null;p.push(I)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");y=pp[l];for(let b=1;b<e.length;b++){const T=n.parse(e[b],b,wr);if(!T)return null;p.push(T)}}return new sl(y,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(const p of this.args){if(n=p.evaluate(e),l=null,n instanceof _r)return n;if(typeof n=="string"){const y=e.parseColor(n);if(y)return y}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fp(n[0],n[1],n[2],n[3]),!l))return new _r(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new In(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new In(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Bs.fromString(Io(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?xa.build(Io(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Io(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new fi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $c(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Pm=["Unknown","Point","LineString","Polygon"];class Uu{constructor(e,n,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-e[0])+this.featureDistanceData.bearing[1]*(p*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=_r.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class va{constructor(e,n,l,p,y){this.name=e,this.type=n,this._evaluate=l,this.args=p,this._overloadIndex=y}evaluate(e){if(!this._evaluate){const n=va.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const l=e[0],p=va.definitions[l];if(!p)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=[];let P=null,I=-1;for(const[F,B]of b){if(Array.isArray(F)&&F.length!==e.length-1)continue;T.push(F),I++,P=new Xh(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const N=[];let H=!1;for(let W=1;W<e.length;W++){const ne=e[W],ue=Array.isArray(F)?F[W-1]:F.type,ae=P.parse(ne,1+N.length,ue);if(!ae){H=!0;break}N.push(ae)}if(!H)if(Array.isArray(F)&&F.length!==N.length)P.error(`Expected ${F.length} arguments, but found ${N.length} instead.`);else{for(let W=0;W<N.length;W++){const ne=Array.isArray(F)?F[W]:F.type,ue=N[W];P.concat(W+1).checkSubtype(ne,ue.type)}if(P.errors.length===0)return new va(l,y,B,N,I)}}if(T.length===1)n.errors.push(...P.errors);else{const F=(T.length?T:b.map(([N])=>N)).map(ba).join(" | "),B=[];for(let N=1;N<e.length;N++){const H=n.parse(e[N],1+B.length);if(!H)return null;B.push(Pn(H.type))}n.error(`Expected arguments of type ${F}, but found (${B.join(", ")}) instead.`)}return null}static register(e,n){va.definitions=n;for(const l in n)e[l]=va}}function ba(o){return Array.isArray(o)?`(${o.map(Pn).join(", ")})`:`(${Pn(o.type)}...)`}class La{constructor(e,n,l){this.type=Wd,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const p=l["case-sensitive"]===void 0?n.parse(!1,1,dr):n.parseObjectValue(l["case-sensitive"],1,"case-sensitive",dr);if(!p)return null;const y=l["diacritic-sensitive"]===void 0?n.parse(!1,1,dr):n.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",dr);if(!y)return null;let b=null;return l.locale&&(b=n.parseObjectValue(l.locale,1,"locale",gr),!b)?null:new La(p,y,b)}evaluate(e){return new Zd(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Uh(o,e,n=0,l=o.length-1,p=Dl){for(;l>n;){if(l-n>600){const P=l-n+1,I=e-n+1,F=Math.log(P),B=.5*Math.exp(2*F/3),N=.5*Math.sqrt(F*B*(P-B)/P)*(I-P/2<0?-1:1);Uh(o,e,Math.max(n,Math.floor(e-I*B/P+N)),Math.min(l,Math.floor(e+(P-I)*B/P+N)),p)}const y=o[e];let b=n,T=l;for(Ya(o,n,e),p(o[l],y)>0&&Ya(o,n,l);b<T;){for(Ya(o,b,T),b++,T--;p(o[b],y)<0;)b++;for(;p(o[T],y)>0;)T--}p(o[n],y)===0?Ya(o,n,T):(T++,Ya(o,T,l)),T<=e&&(n=T+1),e<=T&&(l=T-1)}}function Ya(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}function Dl(o,e){return o<e?-1:o>e?1:0}function Im(o){let e=0;for(let n,l,p=0,y=o.length,b=y-1;p<y;b=p++)n=o[p],l=o[b],e+=(l.x-n.x)*(n.y+l.y);return e}function Hc(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Gh(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function kl(o,e,n){const l=o[0]-e[0],p=o[1]-e[1],y=o[0]-n[0],b=o[1]-n[1];return l*b-y*p===0&&l*y<=0&&p*b<=0}function Yd(o,e,n){return e[1]>o[1]!=n[1]>o[1]&&o[0]<(n[0]-e[0])*(o[1]-e[1])/(n[1]-e[1])+e[0]}function ua(o,e,n=!1){let l=!1;for(let p=0,y=e.length;p<y;p++){const b=e[p];for(let T=0,P=b.length,I=P-1;T<P;I=T++){const F=b[I],B=b[T];if(kl(o,F,B))return n;Yd(o,F,B)&&(l=!l)}}return l}function Kd(o,e,n,l){const p=l[0]-n[0],y=l[1]-n[1],b=(o[0]-n[0])*y-p*(o[1]-n[1]),T=(e[0]-n[0])*y-p*(e[1]-n[1]);return b>0&&T<0||b<0&&T>0}function $h(o,e,n,l){return(p=[l[0]-n[0],l[1]-n[1]])[0]*(y=[e[0]-o[0],e[1]-o[1]])[1]-p[1]*y[0]!==0&&!(!Kd(o,e,n,l)||!Kd(n,l,o,e));var p,y}function Do(o){const e=new Pt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new Pt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of o[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),n.x<l.x&&(n.x=l.x),n.y<l.y&&(n.y=l.y);return{min:e,max:n}}const Ka=8192;function mp(o,e){const n=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(n*p*Ka),Math.round(l*p*Ka)]}function gp(o,e){for(let n=0;n<e.length;n++)if(ua(o,e[n]))return!0;return!1}function qc(o,e,n){for(const l of n)for(let p=0,y=l.length,b=y-1;p<y;b=p++)if($h(o,e,l[b],l[p]))return!0;return!1}function Qd(o,e){for(let n=0;n<o.length;++n)if(!ua(o[n],e))return!1;for(let n=0;n<o.length-1;++n)if(qc(o[n],o[n+1],e))return!1;return!0}function Dm(o,e){for(let n=0;n<e.length;n++)if(Qd(o,e[n]))return!0;return!1}function al(o,e,n){const l=[];for(let p=0;p<o.length;p++){const y=[];for(let b=0;b<o[p].length;b++){const T=mp(o[p][b],n);Hc(e,T),y.push(T)}l.push(y)}return l}function km(o,e,n){const l=[];for(let p=0;p<o.length;p++){const y=al(o[p],e,n);l.push(y)}return l}function Lm(o,e,n,l){if(o[0]<n[0]||o[0]>n[2]){const p=.5*l;let y=o[0]-n[0]>p?-l:n[0]-o[0]>p?l:0;y===0&&(y=o[0]-n[2]>p?-l:n[2]-o[0]>p?l:0),o[0]+=y}Hc(e,o)}function Jd(o,e,n,l){const p=Math.pow(2,l.z)*Ka,y=[l.x*Ka,l.y*Ka],b=[];if(!o)return b;for(const T of o)for(const P of T){const I=[P.x+y[0],P.y+y[1]];Lm(I,e,n,p),b.push(I)}return b}function ef(o,e,n,l){const p=Math.pow(2,l.z)*Ka,y=[l.x*Ka,l.y*Ka],b=[];if(!o)return b;for(const P of o){const I=[];for(const F of P){const B=[F.x+y[0],F.y+y[1]];Hc(e,B),I.push(B)}b.push(I)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const P of b)for(const I of P)Lm(I,e,n,p)}var T;return b}class Ll{constructor(e,n){this.type=dr,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(lc(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let p=0;p<l.features.length;++p){const y=l.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ll(l,l.features[p].geometry)}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ll(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ll(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(!b)return!1;if(l.type==="Polygon"){const T=al(l.coordinates,y,b),P=Jd(n.geometry(),p,y,b);if(!Gh(p,y))return!1;for(const I of P)if(!ua(I,T))return!1}if(l.type==="MultiPolygon"){const T=km(l.coordinates,y,b),P=Jd(n.geometry(),p,y,b);if(!Gh(p,y))return!1;for(const I of P)if(!gp(I,T))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(!b)return!1;if(l.type==="Polygon"){const T=al(l.coordinates,y,b),P=ef(n.geometry(),p,y,b);if(!Gh(p,y))return!1;for(const I of P)if(!Qd(I,T))return!1}if(l.type==="MultiPolygon"){const T=km(l.coordinates,y,b),P=ef(n.geometry(),p,y,b);if(!Gh(p,y))return!1;for(const I of P)if(!Dm(I,T))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ha={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qa=1/298.257223563,Gu=Qa*(2-Qa),Ks=Math.PI/180;class ko{static fromTile(e,n,l){const p=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),y=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Ks;return new ko(y,l)}static get units(){return ha}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!ha[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(ha).join(", ")}`);const l=6378.137*Ks*(n?ha[n]:1),p=Math.cos(e*Ks),y=1/(1-Gu*(1-p*p)),b=Math.sqrt(y);this.kx=l*b*p,this.ky=l*b*y*(1-Gu)}distance(e,n){const l=da(e[0]-n[0])*this.kx,p=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+p*p)}bearing(e,n){const l=da(n[0]-e[0])*this.kx;return Math.atan2(l,(n[1]-e[1])*this.ky)/Ks}destination(e,n,l){const p=l*Ks;return this.offset(e,Math.sin(p)*n,Math.cos(p)*n)}offset(e,n,l){return[e[0]+n/this.kx,e[1]+l/this.ky]}lineDistance(e){let n=0;for(let l=0;l<e.length-1;l++)n+=this.distance(e[l],e[l+1]);return n}area(e){let n=0;for(let l=0;l<e.length;l++){const p=e[l];for(let y=0,b=p.length,T=b-1;y<b;T=y++)n+=da(p[y][0]-p[T][0])*(p[y][1]+p[T][1])*(l?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let l=0;if(n<=0)return e[0];for(let p=0;p<e.length-1;p++){const y=e[p],b=e[p+1],T=this.distance(y,b);if(l+=T,l>n)return Wc(y,b,(n-(l-T))/T)}return e[e.length-1]}pointToSegmentDistance(e,n,l){let[p,y]=n,b=da(l[0]-p)*this.kx,T=(l[1]-y)*this.ky;if(b!==0||T!==0){const P=(da(e[0]-p)*this.kx*b+(e[1]-y)*this.ky*T)/(b*b+T*T);P>1?(p=l[0],y=l[1]):P>0&&(p+=b/this.kx*P,y+=T/this.ky*P)}return b=da(e[0]-p)*this.kx,T=(e[1]-y)*this.ky,Math.sqrt(b*b+T*T)}pointOnLine(e,n){let l=1/0,p=e[0][0],y=e[0][1],b=0,T=0;for(let P=0;P<e.length-1;P++){let I=e[P][0],F=e[P][1],B=da(e[P+1][0]-I)*this.kx,N=(e[P+1][1]-F)*this.ky,H=0;B===0&&N===0||(H=(da(n[0]-I)*this.kx*B+(n[1]-F)*this.ky*N)/(B*B+N*N),H>1?(I=e[P+1][0],F=e[P+1][1]):H>0&&(I+=B/this.kx*H,F+=N/this.ky*H)),B=da(n[0]-I)*this.kx,N=(n[1]-F)*this.ky;const W=B*B+N*N;W<l&&(l=W,p=I,y=F,b=P,T=H)}return{point:[p,y],index:b,t:Math.max(0,Math.min(1,T))}}lineSlice(e,n,l){let p=this.pointOnLine(l,e),y=this.pointOnLine(l,n);if(p.index>y.index||p.index===y.index&&p.t>y.t){const I=p;p=y,y=I}const b=[p.point],T=p.index+1,P=y.index;!Hh(l[T],b[0])&&T<=P&&b.push(l[T]);for(let I=T+1;I<=P;I++)b.push(l[I]);return Hh(l[P],y.point)||b.push(y.point),b}lineSliceAlong(e,n,l){let p=0;const y=[];for(let b=0;b<l.length-1;b++){const T=l[b],P=l[b+1],I=this.distance(T,P);if(p+=I,p>e&&y.length===0&&y.push(Wc(T,P,(e-(p-I))/I)),p>=n)return y.push(Wc(T,P,(n-(p-I))/I)),y;p>e&&y.push(P)}return y}bufferPoint(e,n){const l=n/this.ky,p=n/this.kx;return[e[0]-p,e[1]-l,e[0]+p,e[1]+l]}bufferBBox(e,n){const l=n/this.ky,p=n/this.kx;return[e[0]-p,e[1]-l,e[2]+p,e[3]+l]}insideBBox(e,n){return da(e[0]-n[0])>=0&&da(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Hh(o,e){return o[0]===e[0]&&o[1]===e[1]}function Wc(o,e,n){const l=da(e[0]-o[0]);return[o[0]+l*n,o[1]+(e[1]-o[1])*n]}function da(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Zc{constructor(e=[],n=(l,p)=>l<p?-1:l>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,p=n[e];for(;e>0;){const y=e-1>>1,b=n[y];if(l(p,b)>=0)break;n[e]=b,e=y}n[e]=p}_down(e){const{data:n,compare:l}=this,p=this.length>>1,y=n[e];for(;e<p;){let b=1+(e<<1);const T=b+1;if(T<this.length&&l(n[T],n[b])<0&&(b=T),l(n[b],y)>=0)break;n[e]=n[b],e=b}n[e]=y}}var $t=8192;function tf(o,e){return e.dist-o.dist}function $u(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;return!0}function ol(o){return o[1]-o[0]+1}function ll(o,e){const n=o[1]>=o[0]&&o[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function wa(o,e){if(o[0]>o[1])return[null,null];const n=ol(o);if(e){if(n===2)return[o,null];const l=Math.floor(n/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(n===1)return[o,null];const l=Math.floor(n/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function Ol(o,e){const n=[1/0,1/0,-1/0,-1/0];if(!ll(e,o.length))return n;for(let l=e[0];l<=e[1];++l)Hc(n,o[l]);return n}function Ea(o){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<o.length;++n)for(let l=0;l<o[n].length;++l)Hc(e,o[n][l]);return e}function zl(o,e,n){if($u(o)||$u(e))return NaN;let l=0,p=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(p=o[1]-e[3]),o[3]<e[1]&&(p=e[1]-o[3]),n.distance([0,0],[l,p])}function Xc(o){return 360*o-180}function uc(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Hu(o,e){const n=Math.pow(2,e.z),l=(o.y/$t+e.y)/n;return[Xc((o.x/$t+e.x)/n),uc(l)]}function Om(o,e){const n=[];for(let l=0;l<o.length;++l)n.push(Hu(o[l],e));return n}function rf(o,e,n){const l=n.pointOnLine(e,o).point;return n.distance(o,l)}function nf(o,e,n,l,p){const y=n.slice(l[0],l[1]+1);let b=1/0;for(let T=e[0];T<=e[1];++T)if((b=Math.min(b,rf(o[T],y,p)))===0)return 0;return b}function Cs(o,e,n,l,p){const y=Math.min(p.pointToSegmentDistance(o,n,l),p.pointToSegmentDistance(e,n,l)),b=Math.min(p.pointToSegmentDistance(n,o,e),p.pointToSegmentDistance(l,o,e));return Math.min(y,b)}function Ji(o,e,n,l,p){if(!ll(e,o.length)||!ll(l,n.length))return NaN;let y=1/0;for(let b=e[0];b<e[1];++b)for(let T=l[0];T<l[1];++T){if($h(o[b],o[b+1],n[T],n[T+1]))return 0;y=Math.min(y,Cs(o[b],o[b+1],n[T],n[T+1],p))}return y}function qu(o,e,n,l,p){if(!ll(e,o.length)||!ll(l,n.length))return NaN;let y=1/0;for(let b=e[0];b<=e[1];++b)for(let T=l[0];T<=l[1];++T)if((y=Math.min(y,p.distance(o[b],n[T])))===0)return y;return y}function sf(o,e,n){if(ua(o,e,!0))return 0;let l=1/0;for(const p of e){const y=p.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[y-1]&&(l=Math.min(l,n.pointToSegmentDistance(o,p[y-1],p[0])))===0||(l=Math.min(l,rf(o,p,n)))===0)return l}return l}function qh(o,e,n,l){if(!ll(e,o.length))return NaN;for(let y=e[0];y<=e[1];++y)if(ua(o[y],n,!0))return 0;let p=1/0;for(let y=e[0];y<e[1];++y)for(const b of n)for(let T=0,P=b.length,I=P-1;T<P;I=T++){if($h(o[y],o[y+1],b[I],b[T]))return 0;p=Math.min(p,Cs(o[y],o[y+1],b[I],b[T],l))}return p}function Oa(o,e){for(const n of o)for(let l=0;l<=n.length-1;++l)if(ua(n[l],e,!0))return!0;return!1}function yo(o,e,n,l=1/0){const p=Ea(o),y=Ea(e);if(l!==1/0&&zl(p,y,n)>=l)return l;if(Gh(p,y)){if(Oa(o,e))return 0}else if(Oa(e,o))return 0;let b=l;for(const T of o)for(let P=0,I=T.length,F=I-1;P<I;F=P++)for(const B of e)for(let N=0,H=B.length,W=H-1;N<H;W=N++){if($h(T[F],T[P],B[W],B[N]))return 0;b=Math.min(b,Cs(T[F],T[P],B[W],B[N],n))}return b}function Mr(o,e,n,l,p,y,b){if(y===null||b===null)return;const T=zl(Ol(l,y),Ol(p,b),n);T<e&&o.push({dist:T,range1:y,range2:b})}function cl(o,e,n,l,p=1/0){let y=Math.min(l.distance(o[0],n[0][0]),p);if(y===0)return y;const b=new Zc([{dist:0,range1:[0,o.length-1],range2:[0,0]}],tf),T=e?50:100,P=Ea(n);for(;b.length;){const I=b.pop();if(I.dist>=y)continue;const F=I.range1;if(ol(F)<=T){if(!ll(F,o.length))return NaN;if(e){const B=qh(o,F,n,l);if((y=Math.min(y,B))===0)return y}else for(let B=F[0];B<=F[1];++B){const N=sf(o[B],n,l);if((y=Math.min(y,N))===0)return y}}else{const B=wa(F,e);if(B[0]!==null){const N=zl(Ol(o,B[0]),P,l);N<y&&b.push({dist:N,range1:B[0],range2:[0,0]})}if(B[1]!==null){const N=zl(Ol(o,B[1]),P,l);N<y&&b.push({dist:N,range1:B[1],range2:[0,0]})}}}return y}function Lo(o,e,n,l,p,y=1/0){let b=Math.min(y,p.distance(o[0],n[0]));if(b===0)return b;const T=new Zc([{dist:0,range1:[0,o.length-1],range2:[0,n.length-1]}],tf),P=e?50:100,I=l?50:100;for(;T.length;){const F=T.pop();if(F.dist>=b)continue;const B=F.range1,N=F.range2;if(ol(B)<=P&&ol(N)<=I){if(!ll(B,o.length)||!ll(N,n.length))return NaN;if(e&&l?b=Math.min(b,Ji(o,B,n,N,p)):e||l?e&&!l?b=Math.min(b,nf(n,N,o,B,p)):!e&&l&&(b=Math.min(b,nf(o,B,n,N,p))):b=Math.min(b,qu(o,B,n,N,p)),b===0)return b}else{const H=wa(B,e),W=wa(N,l);Mr(T,b,p,o,n,H[0],W[0]),Mr(T,b,p,o,n,H[0],W[1]),Mr(T,b,p,o,n,H[1],W[0]),Mr(T,b,p,o,n,H[1],W[1])}}return b}function Oo(o,e,n,l,p=1/0){let y=p;const b=Ol(o,[0,o.length-1]);for(const T of n)if(!(y!==1/0&&zl(b,Ol(T,[0,T.length-1]),l)>=y)&&(y=Math.min(y,Lo(o,e,T,!0,l,y)),y===0))return y;return y}function Wh(o,e,n,l,p=1/0){let y=p;const b=Ol(o,[0,o.length-1]);for(const T of n){if(y!==1/0&&zl(b,Ea(T),l)>=y)continue;const P=cl(o,e,T,l,y);if(isNaN(P))return P;if((y=Math.min(y,P))===0)return y}return y}function Zh(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Fl{constructor(e,n){this.type=gi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(lc(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let p=0;p<l.features.length;++p)if(Zh(l.features[p].geometry.type))return new Fl(l,l.features[p].geometry)}else if(l.type==="Feature"){if(Zh(l.geometry.type))return new Fl(l,l.geometry)}else if(Zh(l.type))return new Fl(l,l)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),l=e.canonicalID();if(n!=null&&l!=null){if(e.geometryType()==="Point")return(function(p,y,b){const T=[];for(const I of p)for(const F of I)T.push(Hu(F,y));const P=new ko(T[0][1],"meters");return b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString"?Lo(T,!1,b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",P):b.type==="MultiLineString"?Oo(T,!1,b.coordinates,P):b.type==="Polygon"||b.type==="MultiPolygon"?Wh(T,!1,b.type==="Polygon"?[b.coordinates]:b.coordinates,P):null})(n,l,this.geometries);if(e.geometryType()==="LineString")return(function(p,y,b){const T=[];for(const I of p){const F=[];for(const B of I)F.push(Hu(B,y));T.push(F)}const P=new ko(T[0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return Oo(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",T,P);if(b.type==="MultiLineString"){let I=1/0;for(let F=0;F<b.coordinates.length;F++){const B=Oo(b.coordinates[F],!0,T,P,I);if(isNaN(B))return B;if((I=Math.min(I,B))===0)return I}return I}if(b.type==="Polygon"||b.type==="MultiPolygon"){let I=1/0;for(let F=0;F<T.length;F++){const B=Wh(T[F],!0,b.type==="Polygon"?[b.coordinates]:b.coordinates,P,I);if(isNaN(B))return B;if((I=Math.min(I,B))===0)return I}return I}return null})(n,l,this.geometries);if(e.geometryType()==="Polygon")return(function(p,y,b){const T=[];for(const I of(function(F){const B=F.length;if(B<=1)return[F];const N=[];let H,W;for(let ne=0;ne<B;ne++){const ue=Im(F[ne]);ue!==0&&(F[ne].area=Math.abs(ue),W===void 0&&(W=ue<0),W===ue<0?(H&&N.push(H),H=[F[ne]]):H.push(F[ne]))}return H&&N.push(H),N})(p)){const F=[];for(let B=0;B<I.length;++B)F.push(Om(I[B],y));T.push(F)}const P=new ko(T[0][0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return Wh(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",T,P);if(b.type==="MultiLineString"){let I=1/0;for(let F=0;F<b.coordinates.length;F++){const B=Wh(b.coordinates[F],!0,T,P,I);if(isNaN(B))return B;if((I=Math.min(I,B))===0)return I}return I}return b.type==="Polygon"||b.type==="MultiPolygon"?(function(I,F,B){let N=1/0;for(const H of I)for(const W of F){const ne=yo(H,W,B,N);if(isNaN(ne))return ne;if((N=Math.min(N,ne))===0)return N}return N})(b.type==="Polygon"?[b.coordinates]:b.coordinates,T,P):null})(n,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Yc(o){if(o instanceof va&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ll||o instanceof Fl)return!1;if(o instanceof hc)return o.featureConstant;let e=!0;return o.eachChild(n=>{e&&!Yc(n)&&(e=!1)}),e}function us(o){if(o instanceof va&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(n=>{e&&!us(n)&&(e=!1)}),e}function mn(o,e){if(o instanceof va&&e.indexOf(o.name)>=0)return!1;let n=!0;return o.eachChild(l=>{n&&!mn(l,e)&&(n=!1)}),n}function Gr(o,e,n){return[o,e,n].filter(Boolean).join("")}function ul(o,e){switch(o){case"string":return Io(e);case"number":return+e;case"boolean":return!!e;case"color":return _r.parse(e);case"formatted":return Bs.fromString(Io(e));case"resolvedImage":return xa.build(Io(e))}return e}function Ja(o,e,n,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),n!==void 0&&o>n&&(o=n),o}class hc{constructor(e,n,l,p=!1){this.type=e,this.key=n,this.scope=l,this.featureConstant=p}static parse(e,n){let l=n.expectedType;if(l==null&&(l=wr),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const p=n.parse(e[1],1);if(!(p instanceof Xa))return n.error("Key name of 'config' expression must be a string literal.");let y,b=!0;const T=Io(p.value);if(e.length>=3){const P=n.parse(e[2],2);if(!(P instanceof Xa))return n.error("Scope of 'config' expression must be a string literal.");y=Io(P.value)}if(n.options){const P=Gr(T,y,n._scope),I=n.options.get(P);I&&(b=Yc(I.value||I.default))}return new hc(l,T,y,b)}evaluate(e){const n=Gr(this.key,this.scope,e.scope),l=e.getConfig(n);if(!l)return null;const{type:p,value:y,values:b,minValue:T,maxValue:P,stepValue:I}=l,F=l.default.evaluate(e);let B=F;if(y){const N=e.scope;e.scope=(N||"").split("").slice(1).join(""),B=y.evaluate(e),e.scope=N}return p&&(B=ul(p,B)),B===void 0||T===void 0&&P===void 0&&I===void 0||(typeof B=="number"?B=Ja(B,T,P,I):Array.isArray(B)&&(B=B.map(N=>typeof N=="number"?Ja(N,T,P,I):N))),y!==void 0&&B!==void 0&&b&&!b.includes(B)&&(B=F,p&&(B=ul(p,B))),(p&&p!==this.type||B!==void 0&&!Nh(Qn(B),this.type))&&(B=ul(this.type.kind,B)),B}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class zo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new zo(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Xh{constructor(e,n=[],l,p=new qd,y=[],b,T,P){this.registry=e,this.path=n,this.key=n.map(I=>typeof I=="string"?`['${I}']`:`[${I}]`).join(""),this.scope=p,this.errors=y,this.expectedType=l,this._scope=b,this.options=T,this.iconImageUseTheme=P}parse(e,n,l,p,y={}){return n||l?this.concat(n,null,l,p)._parse(e,y):this._parse(e,y)}parseObjectValue(e,n,l,p,y,b={}){return this.concat(n,l,p,y)._parse(e,b)}_parse(e,n){function l(p,y,b){return b==="assert"?new Ii(y,[p]):b==="coerce"?new sl(y,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let y=p.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,T=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(b,T))return null}else y=l(y,b,n.typeAnnotation||"coerce");else y=l(y,b,n.typeAnnotation||"assert")}if(!(y instanceof Xa)&&y.type.kind!=="resolvedImage"&&af(y)){const b=new Uu(this._scope,this.options,this.iconImageUseTheme);try{y=new Xa(y.type,y.evaluate(b))}catch(T){return this.error(T.message),null}}return y}return sl.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l,p){let y=typeof e=="number"?this.path.concat(e):this.path;y=typeof n=="string"?y.concat(n):y;const b=p?this.scope.concat(p):this.scope;return new Xh(this.registry,y,l||null,b,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const l=`${this.key}${n.map(p=>`[${p}]`).join("")}`;this.errors.push(new Fs(l,e))}checkSubtype(e,n){const l=Il(e,n);return l&&this.error(l),l}}function af(o){if(o instanceof zo)return af(o.boundExpression);if(o instanceof va&&o.name==="error"||o instanceof La||o instanceof Ll||o instanceof Fl||o instanceof hc)return!1;const e=o instanceof sl||o instanceof Ii;let n=!0;return o.eachChild(l=>{n=e?n&&af(l):n&&l instanceof Xa}),!!n&&Yc(o)&&mn(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bl(o,e){const n=o.length-1;let l,p,y=0,b=n,T=0;for(;y<=b;)if(T=Math.floor((y+b)/2),l=o[T],p=o[T+1],l<=e){if(T===n||e<p)return T;y=T+1}else{if(!(l>e))throw new In("Input is not a number.");b=T-1}return 0}class Fo{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[p,y]of l)this.labels.push(p),this.outputs.push(y)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,gi);if(!l)return null;const p=[];let y=null;n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let b=1;b<e.length;b+=2){const T=b===1?-1/0:e[b],P=e[b+1],I=b,F=b+1;if(typeof T!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const B=n.parse(P,F,y);if(!B)return null;y=y||B.type,p.push([T,B])}return new Fo(y,l,p)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const y=n.length;return p>=n[y-1]?l[y-1].evaluate(e):l[Bl(n,p)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const of=.95047,Wu=1.08883,lf=4/29,_o=6/29,hl=3*_o*_o,dc=_o*_o*_o,jl=Math.PI/180,yp=180/Math.PI;function Yh(o){return o>dc?Math.pow(o,1/3):o/hl+lf}function fc(o){return o>_o?o*o*o:hl*(o-lf)}function Zu(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Nl(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function js(o){const e=Nl(o.r),n=Nl(o.g),l=Nl(o.b),p=Yh((.4124564*e+.3575761*n+.1804375*l)/of),y=Yh((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Yh((.0193339*e+.119192*n+.9503041*l)/Wu)),alpha:o.a}}function Kc(o){let e=(o.l+16)/116,n=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*fc(e),n=of*fc(n),l=Wu*fc(l),new _r(Zu(3.2404542*n-1.5371385*e-.4985314*l),Zu(-.969266*n+1.8760108*e+.041556*l),Zu(.0556434*n-.2040259*e+1.0572252*l),o.alpha)}function Kh(o,e,n){const l=e-o;return o+n*(l>180||l<-180?l-360*Math.round(l/360):l)}const Xu={forward:js,reverse:Kc,interpolate:function(o,e,n){return{l:Ri(o.l,e.l,n),a:Ri(o.a,e.a,n),b:Ri(o.b,e.b,n),alpha:Ri(o.alpha,e.alpha,n)}}},Qh={forward:function(o){const{l:e,a:n,b:l}=js(o),p=Math.atan2(l,n)*yp;return{h:p<0?p+360:p,c:Math.sqrt(n*n+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*jl,n=o.c;return Kc({l:o.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:o.alpha})},interpolate:function(o,e,n){return{h:Kh(o.h,e.h,n),c:Ri(o.c,e.c,n),l:Ri(o.l,e.l,n),alpha:Ri(o.alpha,e.alpha,n)}}};var zm=Object.freeze({__proto__:null,hcl:Qh,lab:Xu});class en{constructor(e,n,l,p,y){this.type=e,this.operator=n,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[b,T]of y)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(e,n,l,p){let y=0;if(e.name==="exponential")y=Yu(n,e.base,l,p);else if(e.name==="linear")y=Yu(n,1,l,p);else if(e.name==="cubic-bezier"){const b=e.controlPoints;y=new An(b[0],b[1],b[2],b[3]).solve(Yu(n,1,l,p))}return y}static parse(e,n){let[l,p,y,...b]=e;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(F=>typeof F!="number"||F<0||F>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(y=n.parse(y,2,gi),!y)return null;const T=[];let P=null;l==="interpolate-hcl"||l==="interpolate-lab"?P=ca:n.expectedType&&n.expectedType.kind!=="value"&&(P=n.expectedType);for(let I=0;I<b.length;I+=2){const F=b[I],B=b[I+1],N=I+3,H=I+4;if(typeof F!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(T.length&&T[T.length-1][0]>=F)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const W=n.parse(B,H,P);if(!W)return null;P=P||W.type,T.push([F,W])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new en(P,l,p,y,T):n.error(`Type ${Pn(P)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const y=n.length;if(p>=n[y-1])return l[y-1].evaluate(e);const b=Bl(n,p),T=en.interpolationFactor(this.interpolation,p,n[b],n[b+1]),P=l[b].evaluate(e),I=l[b+1].evaluate(e);return this.operator==="interpolate"?Uc[this.type.kind.toLowerCase()](P,I,T):this.operator==="interpolate-hcl"?Qh.reverse(Qh.interpolate(Qh.forward(P),Qh.forward(I),T)):Xu.reverse(Xu.interpolate(Xu.forward(P),Xu.forward(I),T))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function Yu(o,e,n,l){const p=l-n,y=o-n;return p===0?0:e===1?y/p:(Math.pow(e,y)-1)/(Math.pow(e,p)-1)}class Vl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null;const p=n.expectedType;p&&p.kind!=="value"&&(l=p);const y=[];for(const T of e.slice(1)){const P=n.parse(T,1+y.length,l,void 0,{typeAnnotation:"omit"});if(!P)return null;l=l||P.type,y.push(P)}const b=p&&y.some(T=>Il(p,T.type));return new Vl(b?wr:l,y)}evaluate(e){let n,l=null,p=0;for(const y of this.args){if(p++,l=y.evaluate(e),l&&l instanceof xa&&!l.available&&(n||(n=l),l=null,p===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class eo{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let y=1;y<e.length-1;y+=2){const b=e[y];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=n.parse(e[y+1],y+1);if(!T)return null;l.push([b,T])}const p=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return p?new eo(l,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}class Ku{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,gi),p=n.parse(e[2],2,Ys(n.expectedType||wr));return l&&p?new Ku(p.type.itemType,l,p):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new In("Array index out of bounds: negative index");if(n>=l.length)throw new In("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new In("Array index must be an integer. Use at-interpolated for fractional indices");return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ul{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,gi),p=n.parse(e[2],2,Ys(n.expectedType||wr));return l&&p?new Ul(p.type.itemType,l,p):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new In(`Array index out of bounds: ${n} < 0.`);if(n>l.length-1)throw new In(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n===Math.floor(n))return l[n];const p=Math.floor(n),y=Math.ceil(n),b=l[p],T=l[y];if(typeof b!="number"||typeof T!="number")throw new In(`Cannot interpolate between non-number values at index ${n}.`);const P=n-p;return b*(1-P)+T*P}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class pc{constructor(e,n){this.type=dr,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wr),p=n.parse(e[2],2,wr);return l&&p?dp(l.type,[dr,gr,gi,_a,wr])?new pc(l,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!ju(n,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(Qn(n))} instead.`);if(!ju(l,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Pn(Qn(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qu{constructor(e,n,l){this.type=gi,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wr),p=n.parse(e[2],2,wr);if(!l||!p)return null;if(!dp(l.type,[dr,gr,gi,_a,wr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(l.type)} instead`);if(e.length===4){const y=n.parse(e[3],3,gi);return y?new Qu(l,p,y):null}return new Qu(l,p)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!ju(n,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(Qn(n))} instead.`);if(!ju(l,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Pn(Qn(l))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return l.indexOf(n,p)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ju{constructor(e,n,l,p,y,b){this.inputType=e,this.type=n,this.input=l,this.cases=p,this.outputs=y,this.otherwise=b}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const y={},b=[];for(let I=2;I<e.length-1;I+=2){let F=e[I];const B=e[I+1];Array.isArray(F)||(F=[F]);const N=n.concat(I);if(F.length===0)return N.error("Expected at least one branch label.");for(const W of F){if(typeof W!="number"&&typeof W!="string")return N.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return N.error("Numeric branch labels must be integer values.");if(l){if(N.checkSubtype(l,Qn(W)))return null}else l=Qn(W);if(y[String(W)]!==void 0)return N.error("Branch labels must be unique.");y[String(W)]=b.length}const H=n.parse(B,I,p);if(!H)return null;p=p||H.type,b.push(H)}const T=n.parse(e[1],1,wr);if(!T)return null;const P=n.parse(e[e.length-1],e.length-1,p);return P?T.type.kind!=="value"&&n.concat(1).checkSubtype(l,T.type)?null:new Ju(l,p,T,y,b,P):null}evaluate(e){const n=this.input.evaluate(e);return(Nh(Qn(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],p={};for(const b of n){const T=p[this.cases[b]];T===void 0?(p[this.cases[b]]=l.length,l.push([this.cases[b],[b]])):l[T][1].push(b)}const y=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,T]of l)e.push(T.length===1?y(T[0]):T.map(y)),e.push(this.outputs[b].serialize());return e.push(this.otherwise.serialize()),e}}class Jh{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const p=[];for(let b=1;b<e.length-1;b+=2){const T=n.parse(e[b],b,dr);if(!T)return null;const P=n.parse(e[b+1],b+1,l);if(!P)return null;p.push([T,P]),l=l||P.type}const y=n.parse(e[e.length-1],e.length-1,l);return y?new Jh(l,p,y):null}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ed{constructor(e,n,l,p){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=p}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wr),p=n.parse(e[2],2,gi);if(!l||!p)return null;if(!dp(l.type,[Ys(wr),gr,wr]))return n.error(`Expected first argument to be of type array or string, but found ${Pn(l.type)} instead`);if(e.length===4){const y=n.parse(e[3],3,gi);return y?new ed(l.type,l,p,y):null}return new ed(l.type,l,p)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!ju(n,["string","array"]))throw new In(`Expected first argument to be of type array or string, but found ${Pn(Qn(n))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return n.slice(l,p)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Gl{constructor(e,n){this.type=Ys(gr),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,gr),p=n.parse(e[2],2,gr);return l&&p?new Gl(l,p):void 0}evaluate(e){const n=this.str.evaluate(e),l=this.delimiter.evaluate(e);return n.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function td(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function eh(o,e,n,l){return l.compare(e,n)===0}function Qc(o,e,n){const l=o!=="=="&&o!=="!=";return class Hb{constructor(y,b,T){this.type=dr,this.lhs=y,this.rhs=b,this.collator=T,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const T=y[0];let P=b.parse(y[1],1,wr);if(!P)return null;if(!td(T,P.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Pn(P.type)}'.`);let I=b.parse(y[2],2,wr);if(!I)return null;if(!td(T,I.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Pn(I.type)}'.`);if(P.type.kind!==I.type.kind&&P.type.kind!=="value"&&I.type.kind!=="value")return b.error(`Cannot compare types '${Pn(P.type)}' and '${Pn(I.type)}'.`);l&&(P.type.kind==="value"&&I.type.kind!=="value"?P=new Ii(I.type,[P]):P.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ii(P.type,[I])));let F=null;if(y.length===4){if(P.type.kind!=="string"&&I.type.kind!=="string"&&P.type.kind!=="value"&&I.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(F=b.parse(y[3],3,Wd),!F)return null}return new Hb(P,I,F)}evaluate(y){const b=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(l&&this.hasUntypedArgument){const P=Qn(b),I=Qn(T);if(P.kind!==I.kind||P.kind!=="string"&&P.kind!=="number")throw new In(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${P.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const P=Qn(b),I=Qn(T);if(P.kind!=="string"||I.kind!=="string")return e(y,b,T)}return this.collator?n(y,b,T,this.collator.evaluate(y)):e(y,b,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[o];return this.eachChild(b=>{y.push(b.serialize())}),y}}}const th=Qc("==",function(o,e,n){return e===n},eh),_p=Qc("!=",function(o,e,n){return e!==n},function(o,e,n,l){return!eh(0,e,n,l)}),rd=Qc("<",function(o,e,n){return e<n},function(o,e,n,l){return l.compare(e,n)<0}),nd=Qc(">",function(o,e,n){return e>n},function(o,e,n,l){return l.compare(e,n)>0}),sd=Qc("<=",function(o,e,n){return e<=n},function(o,e,n,l){return l.compare(e,n)<=0}),Fm=Qc(">=",function(o,e,n){return e>=n},function(o,e,n,l){return l.compare(e,n)>=0});class dl{constructor(e,n,l,p,y,b){this.type=gr,this.number=e,this.locale=n,this.currency=l,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=b}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,gi);if(!l)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=n.parseObjectValue(p.locale,2,"locale",gr),!y))return null;let b=null;if(p.currency&&(b=n.parseObjectValue(p.currency,2,"currency",gr),!b))return null;let T=null;if(p.unit&&(T=n.parseObjectValue(p.unit,2,"unit",gr),!T))return null;let P=null;if(p["min-fraction-digits"]&&(P=n.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",gi),!P))return null;let I=null;return p["max-fraction-digits"]&&(I=n.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",gi),!I)?null:new dl(l,y,b,T,P,I)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class $l{constructor(e){this.type=gi,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Pn(l.type)} instead.`):new $l(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new In(`Expected value to be of type string or array, but found ${Pn(Qn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function xp(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const mc={"==":th,"!=":_p,">":nd,"<":rd,">=":Fm,"<=":sd,array:Ii,at:Ku,"at-interpolated":Ul,boolean:Ii,case:Jh,coalesce:Vl,collator:La,format:fi,image:$c,in:pc,"index-of":Qu,interpolate:en,"interpolate-hcl":en,"interpolate-lab":en,length:$l,let:eo,literal:Xa,match:Ju,number:Ii,"number-format":dl,object:Ii,slice:ed,step:Fo,string:Ii,"to-boolean":sl,"to-color":sl,"to-number":sl,"to-string":sl,var:zo,within:Ll,distance:Fl,config:hc,split:Gl};function gc(o,[e,n,l,p]){e=e.evaluate(o),n=n.evaluate(o),l=l.evaluate(o);const y=p?p.evaluate(o):1,b=fp(e,n,l,y);if(b)throw new In(b);return new _r(e/255,n/255,l/255,y)}function ih(o,[e,n,l,p]){e=e.evaluate(o),n=n.evaluate(o),l=l.evaluate(o);const y=p?p.evaluate(o):1,b=(function(I,F,B,N){return typeof I=="number"&&I>=0&&I<=360?typeof F=="number"&&F>=0&&F<=100&&typeof B=="number"&&B>=0&&B<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[I,F,B,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[I,F,B,N]:[I,F,B]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[I,F,B,N]:[I,F,B]).join(", ")}]: 'h' must be between 0 and 360.`})(e,n,l,y);if(b)throw new In(b);const T=`hsla(${e}, ${n}%, ${l}%, ${y})`,P=_r.parse(T);if(!P)throw new In(`Failed to parse HSLA color: ${T}`);return P}function ad(o,e){return o in e}function Jc(o,e){const n=e[o];return n===void 0?null:n}function Bo(o){return{type:o}}function yc(o){if(o instanceof hc)return new Set([o.key]);let e=new Set;return o.eachChild(n=>{e=new Set([...e,...yc(n)])}),e}function fl(o){if(o instanceof va&&o.name==="is-active-floor")return!0;let e=!1;return o.eachChild(n=>{!e&&fl(n)&&(e=!0)}),e}function vp(o){return{result:"success",value:o}}function Sa(o){return{result:"error",value:o}}function od(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function rh(o){return o["property-type"]==="data-driven"}function pl(o){return od(o.expression,"measure-light")}function Hl(o){return od(o.expression,"zoom")}function eu(o){return!!o.expression&&o.expression.interpolated}function nh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function cf(o){return o}function tu(o,e){const n=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",p=l||!(l||o.property!==void 0),y=o.type||(eu(e)?"exponential":"interval");if(n&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map(I=>[I[0],_r.parse(I[1])])),o.default=_r.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!zm[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let b,T,P;if(y==="exponential")b=ru;else if(y==="interval")b=Bm;else if(y==="categorical"){b=iu,T=Object.create(null);for(const I of o.stops)T[I[0]]=I[1];P=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=uf}if(l){const I={},F=[];for(let H=0;H<o.stops.length;H++){const W=o.stops[H],ne=W[0].zoom;I[ne]===void 0&&(I[ne]={zoom:ne,type:o.type,property:o.property,default:o.default,stops:[]},F.push(ne)),I[ne].stops.push([W[0].value,W[1]])}const B=[];for(const H of F)B.push([I[H].zoom,tu(I[H],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:en.interpolationFactor.bind(void 0,N),zoomStops:B.map(H=>H[0]),evaluate:({zoom:H},W)=>ru({stops:B,base:o.base},e,H).evaluate(H,W)}}if(p){const I=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:en.interpolationFactor.bind(void 0,I),zoomStops:o.stops.map(F=>F[0]),evaluate:({zoom:F})=>b(o,e,F,T,P)}}return{kind:"source",evaluate(I,F){const B=F&&F.properties?F.properties[o.property]:void 0;return B===void 0?ql(o.default,e.default):b(o,e,B,T,P)}}}function ql(o,e,n){return o!==void 0?o:e!==void 0?e:n!==void 0?n:void 0}function iu(o,e,n,l,p){return ql(typeof n===p?l[n]:void 0,o.default,e.default)}function Bm(o,e,n){if(!Si(n))return ql(o.default,e.default);const l=o.stops.length;if(l===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[l-1][0])return o.stops[l-1][1];const p=Bl(o.stops.map(y=>y[0]),n);return o.stops[p][1]}function ru(o,e,n){const l=o.base!==void 0?o.base:1;if(!Si(n))return ql(o.default,e.default);const p=o.stops.length;if(p===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[p-1][0])return o.stops[p-1][1];const y=Bl(o.stops.map(F=>F[0]),n),b=(function(F,B,N,H){const W=H-N,ne=F-N;return W===0?0:B===1?ne/W:(Math.pow(B,ne)-1)/(Math.pow(B,W)-1)})(n,l,o.stops[y][0],o.stops[y+1][0]),T=o.stops[y][1],P=o.stops[y+1][1];let I=Uc[e.type]||cf;if(o.colorSpace&&o.colorSpace!=="rgb"){const F=zm[o.colorSpace];I=(B,N)=>F.reverse(F.interpolate(F.forward(B),F.forward(N),b))}return typeof T.evaluate=="function"?{evaluate(...F){const B=T.evaluate.apply(void 0,F),N=P.evaluate.apply(void 0,F);if(B!==void 0&&N!==void 0)return I(B,N,b)}}:I(T,P,b)}function uf(o,e,n){return e.type==="color"?n=_r.parse(n):e.type==="formatted"?n=Bs.fromString(n.toString()):e.type==="resolvedImage"?n=xa.build(n.toString()):Mi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),ql(n,o.default,e.default)}va.register(mc,{error:[{kind:"error"},[gr],(o,[e])=>{throw new In(e.evaluate(o))}],typeof:[gr,[wr],(o,[e])=>Pn(Qn(e.evaluate(o)))],"to-rgba":[Ys(gi,4),[ca],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ys(gi,4),[ca],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ca,[gi,gi,gi],gc],rgba:[ca,[gi,gi,gi,gi],gc],hsl:[ca,[gi,gi,gi],ih],hsla:[ca,[gi,gi,gi,gi],ih],has:{type:dr,overloads:[[[gr],(o,[e])=>ad(e.evaluate(o),o.properties())],[[gr,Fu],(o,[e,n])=>ad(e.evaluate(o),n.evaluate(o))]]},get:{type:wr,overloads:[[[gr],(o,[e])=>Jc(e.evaluate(o),o.properties())],[[gr,Fu],(o,[e,n])=>Jc(e.evaluate(o),n.evaluate(o))]]},"feature-state":[wr,[gr],(o,[e])=>Jc(e.evaluate(o),o.featureState||{})],properties:[Fu,[],o=>o.properties()],"geometry-type":[gr,[],o=>o.geometryType()],worldview:[gr,[],o=>o.globals.worldview||""],"is-active-floor":[dr,Bo(gr),(o,e)=>{if(!(o.globals.activeFloors&&o.globals.activeFloors.size>0))return!1;const n=o.globals.activeFloors;return e.some(l=>{const p=l.evaluate(o);return n.has(p)})}],id:[wr,[],o=>o.id()],zoom:[gi,[],o=>o.globals.zoom],pitch:[gi,[],o=>o.globals.pitch||0],"distance-from-center":[gi,[],o=>o.distanceFromCenter()],"measure-light":[gi,[gr],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[gi,[],o=>o.globals.heatmapDensity||0],"line-progress":[gi,[],o=>o.globals.lineProgress||0],"raster-value":[gi,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[gi,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[gi,[],o=>o.globals.skyRadialProgress||0],accumulated:[wr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[gi,Bo(gi),(o,e)=>{let n=0;for(const l of e)n+=l.evaluate(o);return n}],"*":[gi,Bo(gi),(o,e)=>{let n=1;for(const l of e)n*=l.evaluate(o);return n}],"-":{type:gi,overloads:[[[gi,gi],(o,[e,n])=>e.evaluate(o)-n.evaluate(o)],[[gi],(o,[e])=>-e.evaluate(o)]]},"/":[gi,[gi,gi],(o,[e,n])=>e.evaluate(o)/n.evaluate(o)],"%":[gi,[gi,gi],(o,[e,n])=>e.evaluate(o)%n.evaluate(o)],ln2:[gi,[],()=>Math.LN2],pi:[gi,[],()=>Math.PI],e:[gi,[],()=>Math.E],"^":[gi,[gi,gi],(o,[e,n])=>Math.pow(e.evaluate(o),n.evaluate(o))],sqrt:[gi,[gi],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[gi,[gi],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[gi,[gi],(o,[e])=>Math.log(e.evaluate(o))],log2:[gi,[gi],(o,[e])=>Math.log2(e.evaluate(o))],sin:[gi,[gi],(o,[e])=>Math.sin(e.evaluate(o))],cos:[gi,[gi],(o,[e])=>Math.cos(e.evaluate(o))],tan:[gi,[gi],(o,[e])=>Math.tan(e.evaluate(o))],asin:[gi,[gi],(o,[e])=>Math.asin(e.evaluate(o))],acos:[gi,[gi],(o,[e])=>Math.acos(e.evaluate(o))],atan:[gi,[gi],(o,[e])=>Math.atan(e.evaluate(o))],min:[gi,Bo(gi),(o,e)=>Math.min(...e.map(n=>n.evaluate(o)))],max:[gi,Bo(gi),(o,e)=>Math.max(...e.map(n=>n.evaluate(o)))],abs:[gi,[gi],(o,[e])=>Math.abs(e.evaluate(o))],round:[gi,[gi],(o,[e])=>{const n=e.evaluate(o);return n<0?-Math.round(-n):Math.round(n)}],floor:[gi,[gi],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[gi,[gi],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[dr,[gr,wr],(o,[e,n])=>o.properties()[e.value]===n.value],"filter-id-==":[dr,[wr],(o,[e])=>o.id()===e.value],"filter-type-==":[dr,[gr],(o,[e])=>o.geometryType()===e.value],"filter-<":[dr,[gr,wr],(o,[e,n])=>{const l=o.properties()[e.value],p=n.value;return typeof l==typeof p&&l<p}],"filter-id-<":[dr,[wr],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[dr,[gr,wr],(o,[e,n])=>{const l=o.properties()[e.value],p=n.value;return typeof l==typeof p&&l>p}],"filter-id->":[dr,[wr],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[dr,[gr,wr],(o,[e,n])=>{const l=o.properties()[e.value],p=n.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[dr,[wr],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[dr,[gr,wr],(o,[e,n])=>{const l=o.properties()[e.value],p=n.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[dr,[wr],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[dr,[wr],(o,[e])=>e.value in o.properties()],"filter-has-id":[dr,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[dr,[Ys(gr)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[dr,[Ys(wr)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[dr,[gr,Ys(wr)],(o,[e,n])=>n.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[dr,[gr,Ys(wr)],(o,[e,n])=>(function(l,p,y,b){for(;y<=b;){const T=y+b>>1;if(p[T]===l)return!0;p[T]>l?b=T-1:y=T+1}return!1})(o.properties()[e.value],n.value,0,n.value.length-1)],all:{type:dr,overloads:[[[dr,dr],(o,[e,n])=>e.evaluate(o)&&n.evaluate(o)],[Bo(dr),(o,e)=>{for(const n of e)if(!n.evaluate(o))return!1;return!0}]]},any:{type:dr,overloads:[[[dr,dr],(o,[e,n])=>e.evaluate(o)||n.evaluate(o)],[Bo(dr),(o,e)=>{for(const n of e)if(n.evaluate(o))return!0;return!1}]]},"!":[dr,[dr],(o,[e])=>!e.evaluate(o)],"is-supported-script":[dr,[gr],(o,[e])=>{const n=o.globals&&o.globals.isSupportedScript;return!n||n(e.evaluate(o))}],upcase:[gr,[gr],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[gr,[gr],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[gr,Bo(wr),(o,e)=>e.map(n=>Io(n.evaluate(o))).join("")],"resolved-locale":[gr,[Wd],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[gi,[gi,gi,wr],(o,e)=>{const[n,l,p]=e.map(b=>b.evaluate(o));if(n>l||n===l)return n;let y;if(typeof p=="string")y=(function(b){let T=0;if(b.length===0)return T;for(let P=0;P<b.length;P++)T=(T<<5)-T+b.charCodeAt(P),T&=T;return T})(p);else{if(typeof p!="number")throw new In(`Invalid seed input: ${p}`);y=p}return n+xp(y)()*(l-n)}]});class ld{constructor(e,n,l,p,y){this.expression=e,this._warningHistory={},this._scope=l,this._options=p,this._iconImageUseTheme=y,this._evaluator=new Uu(l,p,y),this._defaultValue=n?(function(b){return b.type==="color"&&(nh(b.default)||Array.isArray(b.default))?new _r(0,0,0,0):b.type==="color"?_r.parse(b.default)||null:b.default===void 0?null:b.default})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=yc(e),this.isIndoorDependent=fl(e)}evaluateWithoutErrorHandling(e,n,l,p,y,b,T,P){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,p,y,b,T,P,I){this._evaluator||(this._evaluator=new Uu(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null,this._evaluator.iconImageUseTheme=I||null;try{const F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(B=>JSON.stringify(B)).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){const B=F;return this._warningHistory[B.message]||(this._warningHistory[B.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${B.message}`)),this._defaultValue}}}function nu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in mc}function ml(o,e,n,l,p){const y=new Xh(mc,[],e?(function(T){const P={color:ca,string:gr,number:gi,enum:gr,boolean:dr,formatted:Bu,resolvedImage:Gc};return T.type==="array"?Ys(P[T.value]||wr,T.length):P[T.type]})(e):void 0,void 0,void 0,n,l,p),b=y.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?vp(new ld(b,e,n,l,p)):Sa(y.errors)}class Qs{constructor(e,n,l,p){this.kind=e,this._styleExpression=n,this.isLightConstant=l,this.isLineProgressConstant=p,this.isStateDependent=e!=="constant"&&!us(n.expression),this.configDependencies=yc(n.expression),this.isIndoorDependent=fl(n.expression)}evaluateWithoutErrorHandling(e,n,l,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,y,b)}evaluate(e,n,l,p,y,b,T){return this._styleExpression.evaluate(e,n,l,p,y,b,void 0,void 0,T)}}class Ns{constructor(e,n,l,p,y,b){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!us(n.expression),this.isIndoorDependent=fl(n.expression),this.isLightConstant=y,this.isLineProgressConstant=b,this.configDependencies=yc(n.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,n,l,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,y,b)}evaluate(e,n,l,p,y,b){return this._styleExpression.evaluate(e,n,l,p,y,b)}interpolationFactor(e,n,l){return this.interpolationType?en.interpolationFactor(this.interpolationType,e,n,l):0}}function jo(o,e,n,l,p){if((o=ml(o,e,n,l,p)).result==="error")return o;const y=o.value.expression,b=Yc(y);if(!b&&!rh(e))return Sa([new Fs("","data expressions not supported")]);const T=mn(y,["zoom","pitch","distance-from-center"]);if(!T&&!Hl(e))return Sa([new Fs("","zoom expressions not supported")]);const P=mn(y,["measure-light"]);if(!P&&!pl(e))return Sa([new Fs("","measure-light expression not supported")]);const I=mn(y,["line-progress"]);if(!I&&!(function(N){return od(N.expression,"line-progress")})(e))return Sa([new Fs("","line-progress expression not supported")]);const F=e.expression&&e.expression.relaxZoomRestriction,B=cd(y);return B||T||F?B instanceof Fs?Sa([B]):B instanceof en&&!eu(e)?Sa([new Fs("",'"interpolate" expressions cannot be used with this property')]):vp(B?new Ns(b&&I?"camera":"composite",o.value,B.labels,B instanceof en?B.interpolation:void 0,P,I):new Qs(b&&I?"constant":"source",o.value,P,I)):Sa([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class su{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,tu(this._parameters,this._specification))}static deserialize(e){return new su(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function cd(o){let e=null;if(o instanceof eo)e=cd(o.result);else if(o instanceof Vl){for(const n of o.args)if(e=cd(n),e)break}else(o instanceof Fo||o instanceof en)&&o.input instanceof va&&o.input.name==="zoom"&&(e=o);return e instanceof Fs||o.eachChild(n=>{const l=cd(n);l instanceof Fs?e=l:e&&l&&e!==l&&(e=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Js,za,hs=(function(){if(za)return Js;za=1,Js=e;var o=3;function e(n,l,p){var y=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var b=new Int32Array(this.arrayBuffer);n=b[0],this.d=(l=b[1])+2*(p=b[2]);for(var T=0;T<this.d*this.d;T++){var P=b[o+T],I=b[o+T+1];y.push(P===I?null:b.subarray(P,I))}var F=b[o+y.length+1];this.keys=b.subarray(b[o+y.length],F),this.bboxes=b.subarray(F),this.insert=this._insertReadonly}else{this.d=l+2*p;for(var B=0;B<this.d*this.d;B++)y.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=p,this.scale=l/n,this.uid=0;var N=p/l*n;this.min=-N,this.max=n+N}return e.prototype.insert=function(n,l,p,y,b){this._forEachCell(l,p,y,b,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,l,p,y,b,T){this.cells[b].push(T)},e.prototype.query=function(n,l,p,y,b){var T=this.min,P=this.max;if(n<=T&&l<=T&&P<=p&&P<=y&&!b)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(n,l,p,y,this._queryCell,I,{},b),I},e.prototype._queryCell=function(n,l,p,y,b,T,P,I){var F=this.cells[b];if(F!==null)for(var B=this.keys,N=this.bboxes,H=0;H<F.length;H++){var W=F[H];if(P[W]===void 0){var ne=4*W;(I?I(N[ne+0],N[ne+1],N[ne+2],N[ne+3]):n<=N[ne+2]&&l<=N[ne+3]&&p>=N[ne+0]&&y>=N[ne+1])?(P[W]=!0,T.push(B[W])):P[W]=!1}}},e.prototype._forEachCell=function(n,l,p,y,b,T,P,I){for(var F=this._convertToCellCoord(n),B=this._convertToCellCoord(l),N=this._convertToCellCoord(p),H=this._convertToCellCoord(y),W=F;W<=N;W++)for(var ne=B;ne<=H;ne++){var ue=this.d*ne+W;if((!I||I(this._convertFromCellCoord(W),this._convertFromCellCoord(ne),this._convertFromCellCoord(W+1),this._convertFromCellCoord(ne+1)))&&b.call(this,n,l,p,y,ue,T,P,I))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,l=o+this.cells.length+1+1,p=0,y=0;y<this.cells.length;y++)p+=this.cells[y].length;var b=new Int32Array(l+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var T=l,P=0;P<n.length;P++){var I=n[P];b[o+P]=T,b.set(I,T),T+=I.length}return b[o+n.length]=T,b.set(this.keys,T),b[o+n.length+1]=T+=this.keys.length,b.set(this.bboxes,T),T+=this.bboxes.length,b.buffer},Js})(),gl=Tn(hs);const xo={};function Ut(o,e,n={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),xo[e]={klass:o,omit:n.omit||[]}}Ut(Object,"Object"),gl.serialize=function(o,e){const n=o.toArrayBuffer();return e&&e.add(n),{buffer:n}},gl.deserialize=function(o){return new gl(o.buffer)},Object.defineProperty(gl,"name",{value:"Grid"}),Ut(gl,"Grid"),delete Pt.prototype.constructor,Ut(_r,"Color"),Ut(Error,"Error"),Ut(Bs,"Formatted"),Ut(Vh,"FormattedSection"),Ut(jc,"AJAXError"),Ut(xa,"ResolvedImage"),Ut(su,"StylePropertyFunction"),Ut(ld,"StyleExpression",{omit:["_evaluator"]}),Ut(Xs,"ImageId"),Ut(vs,"ImageVariant"),Ut(Ns,"ZoomDependentExpression"),Ut(Qs,"ZoomConstantExpression"),Ut(va,"CompoundExpression",{omit:["_evaluate"]});for(const o in mc)xo[mc[o]._classRegistryKey]||Ut(mc[o],`Expression${o}`);function gn(o){return o&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function yn(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(gn(o)||o instanceof ImageBitmap)return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const n=[];for(const l of o)n.push(yn(l,e));return n}if(o instanceof Map){const n={$name:"Map",entries:[]};for(const[l,p]of o.entries())n.entries.push(yn(l),yn(p,e));return n}if(o instanceof Set){const n={$name:"Set"};let l=0;for(const p of o.values())n[++l]=yn(p);return n}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const n=o.constructor,l=n._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const p=n.serialize?n.serialize(o,e):{};if(!n.serialize){for(const y in o)o.hasOwnProperty(y)&&(xo[l].omit.indexOf(y)>=0||(p[y]=yn(o[y],e)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}throw new Error("can't serialize object of type "+typeof o)}function vo(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||gn(o)||o instanceof ImageBitmap||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(vo);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const p=o.entries||[],y=new Map;for(let b=0;b<p.length;b+=2)y.set(vo(p[b]),vo(p[b+1]));return y}if(e==="Set"){const p=new Set;for(const y of Object.keys(o))y!=="$name"&&p.add(vo(o[y]));return p}if(e==="BigInt")return BigInt(o.value);const{klass:n}=xo[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(o);const l=Object.create(n.prototype);for(const p of Object.keys(o))p!=="$name"&&(l[p]=vo(o[p]));return l}throw new Error("can't deserialize object of type "+typeof o)}const au=o=>o>=1536&&o<=1791,_c=o=>o>=1872&&o<=1919,ou=o=>o>=2208&&o<=2303,xc=o=>o>=11904&&o<=12031,vc=o=>o>=12032&&o<=12255,bp=o=>o>=12272&&o<=12287,Dn=o=>o>=12288&&o<=12351,bc=o=>o>=12352&&o<=12447,lu=o=>o>=12448&&o<=12543,No=o=>o>=12544&&o<=12591,wp=o=>o>=12704&&o<=12735,jm=o=>o>=12736&&o<=12783,hf=o=>o>=12784&&o<=12799,df=o=>o>=12800&&o<=13055,ud=o=>o>=13056&&o<=13311,bs=o=>o>=13312&&o<=19903,Hn=o=>o>=19968&&o<=40959,sh=o=>o>=40960&&o<=42127,wc=o=>o>=42128&&o<=42191,hd=o=>o>=44032&&o<=55215,ff=o=>o>=63744&&o<=64255,Vo=o=>o>=64336&&o<=65023,dd=o=>o>=65040&&o<=65055,fd=o=>o>=65072&&o<=65103,pf=o=>o>=65104&&o<=65135,mf=o=>o>=65136&&o<=65279,gf=o=>o>=65280&&o<=65519;function yf(o){for(const e of o)if(yl(e.charCodeAt(0)))return!0;return!1}function Nm(o){for(const e of o)if(!Vm(e.charCodeAt(0)))return!1;return!0}function Vm(o){return!(au(o)||_c(o)||ou(o)||Vo(o)||mf(o))}function Ep(o){return!(o<11904||!(wp(o)||No(o)||fd(o)||ff(o)||ud(o)||xc(o)||jm(o)||Dn(o)||bs(o)||Hn(o)||df(o)||gf(o)||bc(o)||bp(o)||vc(o)||hf(o)||lu(o)||dd(o)||wc(o)||sh(o)))}function yl(o){return!(o!==746&&o!==747&&(o<4352||!(wp(o)||No(o)||fd(o)&&!(o>=65097&&o<=65103)||ff(o)||ud(o)||xc(o)||jm(o)||!(!Dn(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||bs(o)||Hn(o)||df(o)||(e=>e>=12592&&e<=12687)(o)||(e=>e>=43360&&e<=43391)(o)||(e=>e>=55216&&e<=55295)(o)||(e=>e>=4352&&e<=4607)(o)||hd(o)||bc(o)||bp(o)||(e=>e>=12688&&e<=12703)(o)||vc(o)||hf(o)||lu(o)&&o!==12540||!(!gf(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!pf(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(e=>e>=5120&&e<=5759)(o)||(e=>e>=6320&&e<=6399)(o)||dd(o)||(e=>e>=19904&&e<=19967)(o)||sh(o)||wc(o))))}function Sp(o){return o===12312||o===12313||o===12316||o===12540||o===12448}function Tp(o){return!(yl(o)||(function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Dn(e)||lu(e)||(n=>n>=57344&&n<=63743)(e)||fd(e)||pf(e)||gf(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function pd(o){return au(o)||_c(o)||ou(o)||Vo(o)||mf(o)}function Ap(o){return o>=1424&&o<=2303||Vo(o)||mf(o)}function Um(o,e){return!(!e&&Ap(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(n=>n>=6016&&n<=6143)(o))}function _l(o){for(const e of o)if(Ap(e.charCodeAt(0)))return!0;return!1}const fa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Wl=null,ea=fa.unavailable,Zl=null;const Cp=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ea=fa.error),Wl&&Wl(o)};function Rp(){_f.fire(new mo("pluginStateChange",{pluginStatus:ea,pluginURL:Zl}))}const _f=new Pl,Ec=function(){return ea},xf=function(){if(ea!==fa.deferred||!Zl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ea=fa.loading,Rp(),Zl&&Nc({url:Zl},o=>{o?Cp(o):(ea=fa.loaded,Rp())})},Fa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ea===fa.loaded||Fa.applyArabicShaping!=null,isLoading:()=>ea===fa.loading,setState(o){ea=o.pluginStatus,Zl=o.pluginURL},isParsing:()=>ea===fa.parsing,isParsed:()=>ea===fa.parsed,getPluginURL:()=>Zl};class xr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(n,l){for(const p of n)if(!Um(p.charCodeAt(0),l))return!1;return!0})(e,Fa.isLoaded())}}class ah{constructor(e,n,l,p,y){this.property=e,this.value=n,this.expression=(function(b,T,P,I,F){if(nh(b))return new su(b,T);if(nu(b)||Array.isArray(b)&&b.length>0){const B=jo(b,T,P,I,F);if(B.result==="error")throw new Error(B.value.map(N=>`${N.key}: ${N.message}`).join(", "));return B.value}{let B=b;return typeof b=="string"&&T.type==="color"&&(B=_r.parse(b)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>B}}})(n===void 0?e.specification.default:n,e.specification,l,p,y)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l,p){return this.property.possiblyEvaluate(this,e,n,l,p)}}class cu{constructor(e,n,l,p){this.property=e,this.value=new ah(e,void 0,n,l,p)}transitioned(e,n){return new Mp(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Mp(this.property,this.value,null,{},0)}}class oh{constructor(e,n,l,p){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=l,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Li(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new cu(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new ah(this._values[e].property,n===null?void 0:Li(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const l=this._properties.properties;if(e)for(const p in e){const y=e[p];if(p.endsWith("-transition")){const b=p.slice(0,-11);l[b]&&this.setTransition(b,y)}else l.hasOwnProperty(p)&&this.setValue(p,y)}}getTransition(e){return Li(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new cu(this._values[e].property)),this._values[e].transition=Li(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const p=this.getTransition(n);p!==void 0&&(e[`${n}-transition`]=p)}return e}transitioned(e,n){const l=new Pp(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(e,n._values[p]);return l}untransitioned(){const e=new Pp(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Mp{constructor(e,n,l,p,y){const b=p.delay||0,T=p.duration||0;y=y||0,this.property=e,this.value=n,this.begin=y+b,this.end=this.begin+T,e.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const p=e.now||0,y=this.value.possiblyEvaluate(e,n,l),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(e,n,l);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,n,l),y,ve(T))}}return y}}class Pp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const p=new ta(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,n,l);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class vf{constructor(e,n,l,p){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=l,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Li(this._values[e].value)}setValue(e,n){this._values[e]=new ah(this._values[e].property,n===null?void 0:Li(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l,p){const y=new ta(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].possiblyEvaluate(e,n,l,p);return y}isIndoorDependent(){return this._isIndoorDependent}}class Sc{constructor(e,n,l,p){this.property=e,this.value=n,this.parameters=l,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,p){return this.property.evaluate(this.value,this.parameters,e,n,l,p,this.iconImageUseTheme)}}class ta{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){const p=Uc[this.specification.type];return p?p(e,n,l):e}}class Qt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,p,y){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Sc(this,{kind:"constant",value:e.expression.evaluate(n,null,{},l,p,void 0,y)},n):new Sc(this,e.expression,n,y)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Sc(this,{kind:"constant",value:void 0},e.parameters);const p=Uc[this.specification.type];return p?new Sc(this,{kind:"constant",value:p(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,p,y,b,T){return e.kind==="constant"?e.value:e.evaluate(n,l,p,y,b,void 0,T)}}class uu{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){return!!e.expression.evaluate(n,null,{},l,p)}interpolate(){return!1}}class Kr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new xr(0,{});for(const l in e){const p=e[l];p.specification.overridable&&this.overridableProperties.push(l);const y=this.defaultPropertyValues[l]=new ah(p,void 0),b=this.defaultTransitionablePropertyValues[l]=new cu(p);this.defaultTransitioningPropertyValues[l]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=y.possiblyEvaluate(n)}}}Ut(Qt,"DataDrivenProperty"),Ut(Nt,"DataConstantProperty"),Ut(uu,"ColorRampProperty");var it=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ip(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function bf(o){if(Array.isArray(o))return o.map(bf);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const n in o)e[n]=bf(o[n]);return e}return Ip(o)}function md(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!md(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wf(o,e="",n=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};md(o)||(o=lh(o));const p=o;let y=!0;try{y=(function(F){if(!hu(F))return F;let B=bf(F);return gd(B),B=Dp(B),B})(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let b=null,T=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){T=it[`filter_${l}`];const F=ml(y,T,e,n);if(F.result==="error")throw new Error(F.value.map(B=>`${B.key}: ${B.message}`).join(", "));b=(B,N,H)=>F.value.evaluate(B,N,{},H)}let P=null,I=null;if(y!==p){const F=ml(p,T,e,n);if(F.result==="error")throw new Error(F.value.map(B=>`${B.key}: ${B.message}`).join(", "));P=(B,N,H,W,ne)=>F.value.evaluate(B,N,{},H,void 0,void 0,W,ne),I=!Yc(F.value.expression)}return{filter:b,dynamicFilter:P||void 0,needGeometry:kp(y),needFeature:!!I}}function Dp(o){if(!Array.isArray(o))return o;const e=(function(n){if(Gm.has(n[0])){for(let l=1;l<n.length;l++)if(hu(n[l]))return!0}return n})(o);return e===!0?e:e.map(n=>Dp(n))}function gd(o){let e=!1;const n=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||hu(o[l]),n.push(o[l+1]);n.push(o[o.length-1])}else if(o[0]==="match"){e=e||hu(o[1]);for(let l=2;l<o.length-1;l+=2)n.push(o[l+1]);n.push(o[o.length-1])}else if(o[0]==="step"){e=e||hu(o[1]);for(let l=1;l<o.length-1;l+=2)n.push(o[l+1])}e&&(o.length=0,o.push("any",...n));for(let l=1;l<o.length;l++)gd(o[l])}function hu(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<o.length;n++)if(hu(o[n]))return!0;return!1}const Gm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zg(o,e){return o<e?-1:o>e?1:0}function kp(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(kp(o[e]))return!0;return!1}function lh(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Ba(o[1],o[2],"=="):e==="!="?xd(Ba(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ba(o[1],o[2],e):e==="any"?(n=o.slice(1),["any"].concat(n.map(lh))):e==="all"?["all"].concat(o.slice(1).map(lh)):e==="none"?["all"].concat(o.slice(1).map(lh).map(xd)):e==="in"?yd(o[1],o.slice(2)):e==="!in"?xd(yd(o[1],o.slice(2))):e==="has"?_d(o[1]):e!=="!has"||xd(_d(o[1]));var n}function Ba(o,e,n){switch(o){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,o,e]}}function yd(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",o,["literal",e.sort(zg)]]:["filter-in-small",o,["literal",e]]}}function _d(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function xd(o){return["!",o]}const ch="";function Uo(o,e){return e?`${o}${ch}${e}`:o}let Ef;const vd=()=>Ef||(Ef=new Kr({"icon-size":new Qt(it.layout_symbol["icon-size"]),"icon-image":new Qt(it.layout_symbol["icon-image"]),"icon-rotate":new Qt(it.layout_symbol["icon-rotate"]),"icon-offset":new Qt(it.layout_symbol["icon-offset"]),"text-size":new Qt(it.layout_symbol["text-size"]),"text-rotate":new Qt(it.layout_symbol["text-rotate"]),"text-offset":new Qt(it.layout_symbol["text-offset"])}));class Lp{constructor(e,n,l,p,y,b){const T=ml(e,it.appearance.condition);if(T.result==="success"&&(this.condition=T.value),this.name=n,l){this.properties=new ta(vd()),this.unevaluatedLayout=new vf(vd(),p,y,b);for(const P in l)this.unevaluatedLayout.setValue(P,l[P])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,n,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),n=this.hasProperty("icon-size"),l=this.hasProperty("icon-offset"),p=this.hasProperty("icon-rotate");return e||n||l||p}hasTextProperties(){const e=this.hasProperty("text-size"),n=this.hasProperty("text-offset"),l=this.hasProperty("text-rotate");return e||n||l}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Sf="-transition",Tf=new Set(["fill","line","background","hillshade","raster"]);class ia extends Pl{constructor(e,n,l,p,y,b){if(super(),this.id=e.id,this.fqid=Uo(this.id,l),this.type=e.type,this.scope=l,this.lut=p,this.options=y,this.iconImageUseTheme=b,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const T=ml(this.filter,it[`filter_${e.type}`]);T.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...T.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||T.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new vf(n.layout,this.scope,y,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new oh(n.paint,this.scope,y);for(const T in e.paint)this.setPaintProperty(T,e.paint[T]);for(const T in e.layout)this.setLayoutProperty(T,e.layout[T]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ta(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Tf.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(n=>{this.appearances.push(new Lp(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Sf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const l=this._transitionablePaint,p=l._properties.properties;if(e.endsWith(Sf)){const B=e.slice(0,-11);return p[B]&&l.setTransition(B,n||void 0),!1}if(!p[e])return!1;const y=l._values[e],b=y.value.isDataDriven(),T=y.value;l.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const P=l._values[e].value,I=P.isDataDriven(),F=e.endsWith("pattern")||e==="line-dasharray";return I||b||F||this._handleOverridablePaintPropertyUpdate(e,T,P)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,l){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(n=>n.serialize())),wi(e,(n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Sc&&rh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!us(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=wf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,l){return{}}queryRadius(e){}queryIntersectsFeature(e,n,l,p,y,b,T,P,I,F){}}const Op={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ja{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const $m=new ArrayBuffer(0);class Nr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,n){return e._trim(),n&&e.arrayBuffer&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,e.arrayBuffer?n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement:(n.capacity=0,n.arrayBuffer=$m),n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xi(o,e=1){let n=0,l=0;return{members:o.map(p=>{const y=Op[p.type].BYTES_PER_ELEMENT,b=n=bd(n,Math.max(e,y)),T=p.components||1;return l=Math.max(l,y),n+=y*T,{name:p.name,type:p.type,components:T,offset:b}}),size:bd(n,Math.max(l,e)),alignment:e}}function bd(o,e){return Math.ceil(o/e)*e}class Xl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.int16[p+0]=n,this.int16[p+1]=l,e}}Xl.prototype.bytesPerElement=4,Ut(Xl,"StructArrayLayout2i4");class Go extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const y=3*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=p,e}}Go.prototype.bytesPerElement=6,Ut(Go,"StructArrayLayout3i6");class xl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,p)}emplace(e,n,l,p,y){const b=4*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=p,this.int16[b+3]=y,e}}xl.prototype.bytesPerElement=8,Ut(xl,"StructArrayLayout4i8");class ds extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ds.prototype.bytesPerElement=4,Ut(ds,"StructArrayLayout1f4");class uh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const y=4*e,b=2*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.float32[b+1]=p,e}}uh.prototype.bytesPerElement=8,Ut(uh,"StructArrayLayout2i1f8");class wd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=p,e}}wd.prototype.bytesPerElement=8,Ut(wd,"StructArrayLayout3i8");class is extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,y)}emplace(e,n,l,p,y,b){const T=5*e;return this.int16[T+0]=n,this.int16[T+1]=l,this.int16[T+2]=p,this.int16[T+3]=y,this.int16[T+4]=b,e}}is.prototype.bytesPerElement=10,Ut(is,"StructArrayLayout5i10");class Rs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,l,p,y,b,T)}emplace(e,n,l,p,y,b,T,P){const I=6*e,F=12*e,B=3*e;return this.int16[I+0]=n,this.int16[I+1]=l,this.uint8[F+4]=p,this.uint8[F+5]=y,this.uint8[F+6]=b,this.uint8[F+7]=T,this.float32[B+2]=P,e}}Rs.prototype.bytesPerElement=12,Ut(Rs,"StructArrayLayout2i4ub1f12");class to extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const y=3*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=p,e}}to.prototype.bytesPerElement=12,Ut(to,"StructArrayLayout3f12");class $o extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,y)}emplace(e,n,l,p,y,b){const T=6*e,P=3*e;return this.uint16[T+0]=n,this.uint16[T+1]=l,this.uint16[T+2]=p,this.uint16[T+3]=y,this.float32[P+2]=b,e}}$o.prototype.bytesPerElement=12,Ut($o,"StructArrayLayout4ui1f12");class du extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,p)}emplace(e,n,l,p,y){const b=4*e;return this.uint16[b+0]=n,this.uint16[b+1]=l,this.uint16[b+2]=p,this.uint16[b+3]=y,e}}du.prototype.bytesPerElement=8,Ut(du,"StructArrayLayout4ui8");class fu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,y,b)}emplace(e,n,l,p,y,b,T){const P=6*e;return this.int16[P+0]=n,this.int16[P+1]=l,this.int16[P+2]=p,this.int16[P+3]=y,this.int16[P+4]=b,this.int16[P+5]=T,e}}fu.prototype.bytesPerElement=12,Ut(fu,"StructArrayLayout6i12");class pu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B,N){const H=this.length;return this.resize(H+1),this.emplace(H,e,n,l,p,y,b,T,P,I,F,B,N)}emplace(e,n,l,p,y,b,T,P,I,F,B,N,H){const W=12*e;return this.int16[W+0]=n,this.int16[W+1]=l,this.int16[W+2]=p,this.int16[W+3]=y,this.uint16[W+4]=b,this.uint16[W+5]=T,this.uint16[W+6]=P,this.uint16[W+7]=I,this.int16[W+8]=F,this.int16[W+9]=B,this.int16[W+10]=N,this.int16[W+11]=H,e}}pu.prototype.bytesPerElement=24,Ut(pu,"StructArrayLayout4i4ui4i24");class Af extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,y,b)}emplace(e,n,l,p,y,b,T){const P=10*e,I=5*e;return this.int16[P+0]=n,this.int16[P+1]=l,this.int16[P+2]=p,this.float32[I+2]=y,this.float32[I+3]=b,this.float32[I+4]=T,e}}Af.prototype.bytesPerElement=20,Ut(Af,"StructArrayLayout3i3f20");class Ho extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,p)}emplace(e,n,l,p,y){const b=4*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=p,this.float32[b+3]=y,e}}Ho.prototype.bytesPerElement=16,Ut(Ho,"StructArrayLayout4f16");class Cf extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Cf.prototype.bytesPerElement=4,Ut(Cf,"StructArrayLayout1ul4");class io extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,e}}io.prototype.bytesPerElement=4,Ut(io,"StructArrayLayout2ui4");class Tc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B,N,H){const W=this.length;return this.resize(W+1),this.emplace(W,e,n,l,p,y,b,T,P,I,F,B,N,H)}emplace(e,n,l,p,y,b,T,P,I,F,B,N,H,W){const ne=20*e,ue=10*e;return this.int16[ne+0]=n,this.int16[ne+1]=l,this.int16[ne+2]=p,this.int16[ne+3]=y,this.int16[ne+4]=b,this.float32[ue+3]=T,this.float32[ue+4]=P,this.float32[ue+5]=I,this.float32[ue+6]=F,this.int16[ne+14]=B,this.uint32[ue+8]=N,this.uint16[ne+18]=H,this.uint16[ne+19]=W,e}}Tc.prototype.bytesPerElement=40,Ut(Tc,"StructArrayLayout5i4f1i1ul2ui40");class hh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,l,p,y,b,T)}emplace(e,n,l,p,y,b,T,P){const I=8*e;return this.int16[I+0]=n,this.int16[I+1]=l,this.int16[I+2]=p,this.int16[I+4]=y,this.int16[I+5]=b,this.int16[I+6]=T,this.int16[I+7]=P,e}}hh.prototype.bytesPerElement=16,Ut(hh,"StructArrayLayout3i2i2i16");class Ed extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,y)}emplace(e,n,l,p,y,b){const T=4*e,P=8*e;return this.float32[T+0]=n,this.float32[T+1]=l,this.float32[T+2]=p,this.int16[P+6]=y,this.int16[P+7]=b,e}}Ed.prototype.bytesPerElement=16,Ut(Ed,"StructArrayLayout2f1f2i16");class Sd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,y,b)}emplace(e,n,l,p,y,b,T){const P=20*e,I=5*e;return this.uint8[P+0]=n,this.uint8[P+1]=l,this.float32[I+1]=p,this.float32[I+2]=y,this.float32[I+3]=b,this.float32[I+4]=T,e}}Sd.prototype.bytesPerElement=20,Ut(Sd,"StructArrayLayout2ub4f20");class qn extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const y=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=l,this.uint16[y+2]=p,e}}qn.prototype.bytesPerElement=6,Ut(qn,"StructArrayLayout3ui6");class mu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie)}emplace(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie,Re){const Ne=30*e,Ve=15*e,Be=60*e;return this.int16[Ne+0]=n,this.int16[Ne+1]=l,this.int16[Ne+2]=p,this.float32[Ve+2]=y,this.float32[Ve+3]=b,this.uint16[Ne+8]=T,this.uint16[Ne+9]=P,this.uint32[Ve+5]=I,this.uint32[Ve+6]=F,this.uint32[Ve+7]=B,this.uint16[Ne+16]=N,this.uint16[Ne+17]=H,this.uint16[Ne+18]=W,this.float32[Ve+10]=ne,this.float32[Ve+11]=ue,this.uint8[Be+48]=ae,this.uint8[Be+49]=fe,this.uint8[Be+50]=ye,this.uint32[Ve+13]=be,this.int16[Ne+28]=Ie,this.uint8[Be+58]=Re,e}}mu.prototype.bytesPerElement=60,Ut(mu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ac extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie,Re,Ne,Ve,Be,He,Ye,yt,ft,gt,Tt,Et,St){const ht=this.length;return this.resize(ht+1),this.emplace(ht,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie,Re,Ne,Ve,Be,He,Ye,yt,ft,gt,Tt,Et,St)}emplace(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie,Re,Ne,Ve,Be,He,Ye,yt,ft,gt,Tt,Et,St,ht){const Rt=20*e,vt=40*e,Mt=80*e;return this.float32[Rt+0]=n,this.float32[Rt+1]=l,this.int16[vt+4]=p,this.int16[vt+5]=y,this.int16[vt+6]=b,this.int16[vt+7]=T,this.int16[vt+8]=P,this.int16[vt+9]=I,this.int16[vt+10]=F,this.int16[vt+11]=B,this.int16[vt+12]=N,this.uint16[vt+13]=H,this.uint16[vt+14]=W,this.uint16[vt+15]=ne,this.uint16[vt+16]=ue,this.uint16[vt+17]=ae,this.uint16[vt+18]=fe,this.uint16[vt+19]=ye,this.uint16[vt+20]=be,this.uint16[vt+21]=Ie,this.uint16[vt+22]=Re,this.uint16[vt+23]=Ne,this.uint16[vt+24]=Ve,this.uint16[vt+25]=Be,this.uint16[vt+26]=He,this.uint16[vt+27]=Ye,this.uint32[Rt+14]=yt,this.float32[Rt+15]=ft,this.float32[Rt+16]=gt,this.float32[Rt+17]=Tt,this.float32[Rt+18]=Et,this.uint8[Mt+76]=St,this.uint16[vt+39]=ht,e}}Ac.prototype.bytesPerElement=80,Ut(Ac,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class dh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,y,b)}emplace(e,n,l,p,y,b,T){const P=6*e;return this.float32[P+0]=n,this.float32[P+1]=l,this.float32[P+2]=p,this.float32[P+3]=y,this.float32[P+4]=b,this.float32[P+5]=T,e}}dh.prototype.bytesPerElement=24,Ut(dh,"StructArrayLayout6f24");class Cc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,y)}emplace(e,n,l,p,y,b){const T=5*e;return this.float32[T+0]=n,this.float32[T+1]=l,this.float32[T+2]=p,this.float32[T+3]=y,this.float32[T+4]=b,e}}Cc.prototype.bytesPerElement=20,Ut(Cc,"StructArrayLayout5f20");class fh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,l,p,y,b,T)}emplace(e,n,l,p,y,b,T,P){const I=7*e;return this.float32[I+0]=n,this.float32[I+1]=l,this.float32[I+2]=p,this.float32[I+3]=y,this.float32[I+4]=b,this.float32[I+5]=T,this.float32[I+6]=P,e}}fh.prototype.bytesPerElement=28,Ut(fh,"StructArrayLayout7f28");class ph extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,l,p,y,b,T,P,I,F,B)}emplace(e,n,l,p,y,b,T,P,I,F,B,N){const H=11*e;return this.float32[H+0]=n,this.float32[H+1]=l,this.float32[H+2]=p,this.float32[H+3]=y,this.float32[H+4]=b,this.float32[H+5]=T,this.float32[H+6]=P,this.float32[H+7]=I,this.float32[H+8]=F,this.float32[H+9]=B,this.float32[H+10]=N,e}}ph.prototype.bytesPerElement=44,Ut(ph,"StructArrayLayout11f44");class gu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,l,p,y,b,T,P,I)}emplace(e,n,l,p,y,b,T,P,I,F){const B=9*e;return this.float32[B+0]=n,this.float32[B+1]=l,this.float32[B+2]=p,this.float32[B+3]=y,this.float32[B+4]=b,this.float32[B+5]=T,this.float32[B+6]=P,this.float32[B+7]=I,this.float32[B+8]=F,e}}gu.prototype.bytesPerElement=36,Ut(gu,"StructArrayLayout9f36");class Rc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.float32[p+0]=n,this.float32[p+1]=l,e}}Rc.prototype.bytesPerElement=8,Ut(Rc,"StructArrayLayout2f8");class Td extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,p)}emplace(e,n,l,p,y){const b=6*e;return this.uint32[3*e+0]=n,this.uint16[b+2]=l,this.uint16[b+3]=p,this.uint16[b+4]=y,e}}Td.prototype.bytesPerElement=12,Ut(Td,"StructArrayLayout1ul3ui12");class mh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}mh.prototype.bytesPerElement=2,Ut(mh,"StructArrayLayout1ui2");class qo extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue)}emplace(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae){const fe=16*e;return this.float32[fe+0]=n,this.float32[fe+1]=l,this.float32[fe+2]=p,this.float32[fe+3]=y,this.float32[fe+4]=b,this.float32[fe+5]=T,this.float32[fe+6]=P,this.float32[fe+7]=I,this.float32[fe+8]=F,this.float32[fe+9]=B,this.float32[fe+10]=N,this.float32[fe+11]=H,this.float32[fe+12]=W,this.float32[fe+13]=ne,this.float32[fe+14]=ue,this.float32[fe+15]=ae,e}}qo.prototype.bytesPerElement=64,Ut(qo,"StructArrayLayout16f64");class yu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,y,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,l,p,y,b,T)}emplace(e,n,l,p,y,b,T,P){const I=10*e,F=5*e;return this.uint16[I+0]=n,this.uint16[I+1]=l,this.uint16[I+2]=p,this.uint16[I+3]=y,this.float32[F+2]=b,this.float32[F+3]=T,this.float32[F+4]=P,e}}yu.prototype.bytesPerElement=20,Ut(yu,"StructArrayLayout4ui3f20");class zp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}zp.prototype.bytesPerElement=2,Ut(zp,"StructArrayLayout1i2");class Ad extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Ad.prototype.bytesPerElement=1,Ut(Ad,"StructArrayLayout1ub1");class vl extends ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vl.prototype.size=40;class Rf extends Tc{get(e){return new vl(this,e)}}Ut(Rf,"CollisionBoxArray");class Fp extends ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Fp.prototype.size=60;class Cd extends mu{get(e){return new Fp(this,e)}}Ut(Cd,"PlacedSymbolArray");class gh extends ja{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}gh.prototype.size=80;class Nn extends Ac{get(e){return new gh(this,e)}}Ut(Nn,"SymbolInstanceArray");class Rd extends ds{getoffsetX(e){return this.float32[1*e+0]}}Ut(Rd,"GlyphOffsetArray");class Hm extends Xl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ut(Hm,"SymbolLineVertexArray");class Bp extends ja{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bp.prototype.size=12;class Yl extends Td{get(e){return new Bp(this,e)}}Ut(Yl,"FeatureIndexArray");class Kl extends io{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ut(Kl,"FillExtrusionCentroidArray");class Mf extends ja{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Mf.prototype.size=6;class jp extends Go{get(e){return new Mf(this,e)}}Ut(jp,"FillExtrusionWallArray");const yh=Xi([{name:"a_pos",components:2,type:"Int16"}],4),Wo=Xi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Np=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $r{constructor(e=[]){this.segments=e}_prepareSegment(e,n,l,p){let y=this.segments[this.segments.length-1];return e>$r.MAX_VERTEX_ARRAY_LENGTH&&Pi(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>$r.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:n,primitiveOffset:l,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}prepareSegment(e,n,l,p){return this._prepareSegment(e,n.length,l.length,p)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,p){return new $r([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Vp(o,e){return 256*(o=Oe(Math.floor(o),0,255))+Oe(Math.floor(e),0,255)}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut($r,"SegmentVector");const Pf=Xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Up=Xi([{name:"a_pattern_b",components:4,type:"Uint16"}]),If=Xi([{name:"a_dash",components:4,type:"Uint16"}]);class _h{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,l,p){this.ids.push(bl(e)),this.positions.push(n,l,p)}eachPosition(e,n){const l=bl(e);let p=0,y=this.ids.length-1;for(;p<y;){const b=p+y>>1;this.ids[b]>=l?y=b:p=b+1}for(;this.ids[p]===l;)n(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,n){const l=new Float64Array(e.ids),p=new Uint32Array(e.positions);return rs(l,p,0,l.length-1),n&&(n.add(l.buffer),n.add(p.buffer)),{ids:l,positions:p}}static deserialize(e){const n=new _h;let l;n.ids=e.ids,n.positions=e.positions;for(const p of n.ids)p!==l&&n.uniqueIds.push(p),l=p;return n.indexed=!0,n}}function bl(o){const e=+o;return Number.isSafeInteger(e)?e:nl(String(o))}function rs(o,e,n,l){for(;n<l;){const p=o[n+l>>1];let y=n-1,b=l+1;for(;;){do y++;while(o[y]<p);do b--;while(o[b]>p);if(y>=b)break;_u(o,y,b),_u(e,3*y,3*b),_u(e,3*y+1,3*b+1),_u(e,3*y+2,3*b+2)}b-n<l-b?(rs(o,e,n,b),n=b+1):(rs(o,e,b+1,l),l=b)}}function _u(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}Ut(_h,"FeaturePositionMap");class bo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _n extends bo{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Vn extends bo{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Na extends bo{constructor(e){super(e),this.current=[0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class xh extends bo{constructor(e){super(e),this.current=[0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class kn extends bo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Ta extends bo{constructor(e){super(e),this.current=_r.transparent.toPremultipliedRenderColor(null)}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Ql=new Float32Array(16);class xu extends bo{constructor(e){super(e),this.current=Ql}set(e,n,l){if(this.fetchUniformLocation(e,n)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let p=1;p<16;p++)if(l[p]!==this.current[p]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Fg=new Float32Array(9),m=new Float32Array(4);class i extends bo{constructor(e){super(e),this.current=m}set(e,n,l){if(this.fetchUniformLocation(e,n)){for(let p=0;p<4;p++)if(l[p]!==this.current[p]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function c(o){return[Vp(255*o.r,255*o.g),Vp(255*o.b,255*o.a)]}function g(o,e,n,l,p,y,b,T){return!!o&&(o.kind==="composite"||o.kind==="source"?o.evaluate(new xr(0,{brightness:y,worldview:T}),e,n,p,l,b)==="none":o.value==="none")}class E{constructor(e,n,l,p){this.value=e,this.uniformNames=n.map(y=>`u_${y}`),this.type=l,this.context=p}setUniform(e,n,l,p,y){const b=p.constantOr(this.value);n.set(e,y,b instanceof _r?b.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):b)}getBinding(e,n){return this.type==="color"?new Ta(e):new Vn(e)}}class A{constructor(e,n){this.uniformNames=n.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,l,p,y){let b=null;y!=="u_pattern"&&y!=="u_dash"||(b=this.pattern),y==="u_pattern_b"&&(b=this.patternTransition),y==="u_pixel_ratio"&&(b=this.pixelRatio),b&&n.set(e,y,b)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new kn(e):new Vn(e)}}class M{constructor(e,n,l,p){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,l,p,y,b,T,P){const I=this.paintVertexArray.length,F=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new xr(0,{brightness:b,worldview:P}),n,{},y,p,T):this.expression.kind==="constant"&&this.expression.value,B=g(this.lutExpression,n,{},p,y,b,T,P);this.paintVertexArray.resize(e),this._setPaintValue(I,e,F,B?null:this.context.lut)}updatePaintArray(e,n,l,p,y,b,T,P){const I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T,worldview:P},l,p,void 0,y):this.expression.kind==="constant"&&this.expression.value,F=g(this.lutExpression,l,p,y,void 0,T,void 0,P);this._setPaintValue(e,n,I,F?null:this.context.lut)}_setPaintValue(e,n,l,p){if(this.type==="color"){const y=c(l.toPremultipliedRenderColor(p));for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,y[0],y[1])}else{for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class D{constructor(e,n,l,p,y,b){this.expression=e,this.uniformNames=n.map(T=>`u_${T}_t`),this.type=l,this.useIntegerZoom=p,this.context=y,this.maxValue=0,this.paintVertexAttributes=n.map(T=>({name:`a_${T}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(e,n,l,p,y,b,T,P){const I=this.expression.evaluate(new xr(this.context.zoom,{brightness:b,worldview:P}),n,{},y,p,T),F=this.expression.evaluate(new xr(this.context.zoom+1,{brightness:b,worldview:P}),n,{},y,p,T),B=g(this.lutExpression,n,{},p,y,b,T,P),N=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(N,e,I,F,B?null:this.context.lut)}updatePaintArray(e,n,l,p,y,b,T,P){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:T,worldview:P},l,p,void 0,y),F=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T,worldview:P},l,p,void 0,y),B=g(this.lutExpression,l,p,y,void 0,T,void 0,P);this._setPaintValue(e,n,I,F,B?null:this.context.lut)}_setPaintValue(e,n,l,p,y){if(this.type==="color"){const b=c(l.toPremultipliedRenderColor(y)),T=c(p.toPremultipliedRenderColor(y));for(let P=e;P<n;P++)this.paintVertexArray.emplace(P,b[0],b[1],T[0],T[1])}else{for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,p,y){const b=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,T=Oe(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);n.set(e,y,T)}getBinding(e,n){return new Vn(e)}}class z{constructor(e,n,l,p,y){this.expression=e,this.layerId=y,this.paintVertexAttributes=(l==="array"?If:Pf).members;for(let b=0;b<n.length;++b);this.paintVertexArray=new p,this.paintTransitionVertexArray=new du}populatePaintArray(e,n,l,p){const y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(y,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,p,y,b,T){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],b)}_setPaintValues(e,n,l,p){if(!p||!l)return;const y=p[l[0]],b=p[l[1]];if(y){if(y){const{tl:T,br:P,pixelRatio:I}=y;for(let F=e;F<n;F++)this.paintVertexArray.emplace(F,T[0],T[1],P[0],P[1],I)}if(b){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:P}=b;for(let I=e;I<n;I++)this.paintTransitionVertexArray.emplace(I,T[0],T[1],P[0],P[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Up.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class U{constructor(e,n,l=()=>!0){this.binders={},this._buffers=[],this.context=n;const p=[];for(const y in e.paint._values){const b=e.paint.get(y);if(y.endsWith("-use-theme")||!l(y)||!(b instanceof Sc&&rh(b.property.specification)))continue;const T=K(y,e.type),P=b.value,I=b.property.specification.type,F=!!b.property.useIntegerZoom,B=y==="line-dasharray"||y.endsWith("pattern"),N=e.paint.get(`${y}-use-theme`),H=y==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(P.kind!=="constant"||H)if(P.kind==="source"||H||B){const W=ce(y,I,"source");this.binders[y]=B?new z(P,T,I,W,e.id):new M(P,T,I,W),p.push(`/a_${y}`)}else{const W=ce(y,I,"composite");this.binders[y]=new D(P,T,I,F,n,W),p.push(`/z_${y}`)}else this.binders[y]=B?new A(P.value,T):new E(P.value,T,I,n),p.push(`/u_${y}`);N&&(this.binders[y].lutExpression=N.value)}this.cacheKey=p.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof M||n instanceof D?n.maxValue:0}populatePaintArrays(e,n,l,p,y,b,T,P){for(const I in this.binders){const F=this.binders[I];F.context=this.context,(F instanceof M||F instanceof D||F instanceof z)&&F.populatePaintArray(e,n,l,p,y,b,T,P)}}setConstantPatternPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof A&&p.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof z?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,l,p,y,b,T,P,I,F){let B=!1;const N=Object.keys(e),H=N.length!==0&&!P,W=H?N:n.uniqueIds;this.context.lut=y.lut;for(const ne in this.binders){const ue=this.binders[ne];if(ue.context=this.context,(ue instanceof M||ue instanceof D||ue instanceof z)&&ue.expression&&ue.expression.kind&&ue.expression.kind!=="constant"&&(ue.expression.isStateDependent===!0||ue.expression.isLightConstant===!1)){const ae=y.paint.get(ne);ue.expression=ae.value;for(const fe of W){const ye=e[fe.toString()];n.eachPosition(fe,(be,Ie,Re)=>{const Ne=p.feature(be);ue.updatePaintArray(Ie,Re,Ne,ye,b,T,I,F)})}if(!H)for(const fe of l.uniqueIds){const ye=e[fe.toString()];l.eachPosition(fe,(be,Ie,Re)=>{const Ne=p.feature(be);ue.updatePaintArray(Ie,Re,Ne,ye,b,T,I,F)})}B=!0}}return B}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof E||l instanceof A)&&e.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof E||p instanceof A||p instanceof D)for(const y of p.uniformNames)n.push({name:y,property:l,binding:p.getBinding(e,y)})}return n}setUniforms(e,n,l,p,y){for(const{name:b,property:T,binding:P}of l)this.binders[T].setUniform(e,P,y,p.get(T),b)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof M||n instanceof D||n instanceof z)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof z&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof M||l instanceof D||l instanceof z)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof M||n instanceof D||n instanceof z)&&n.destroy()}}}class ${constructor(e,n,l=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new U(p,n,l);this.needsUpload=!1,this._featureMap=new _h,this._featureMapWithoutIds=new _h,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,l,p,y,b,T,P,I){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(e,n,p,y,b,T,P,I);n.id!==void 0?this._featureMap.add(n.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,p,y,b,T,P){for(const I of l)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,I,p,y,b,T||0,P)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ie={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function K(o,e){return ie[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const re={"line-pattern":{source:$o,composite:$o},"fill-pattern":{source:$o,composite:$o},"fill-extrusion-pattern":{source:$o,composite:$o},"line-dasharray":{source:du,composite:du}},he={color:{source:Rc,composite:Ho},number:{source:ds,composite:Rc}};function ce(o,e,n){const l=re[o];return l&&l[n]||he[e][n]}Ut(E,"ConstantBinder"),Ut(A,"PatternConstantBinder"),Ut(M,"SourceExpressionBinder"),Ut(z,"PatternCompositeBinder"),Ut(D,"CompositeExpressionBinder"),Ut(U,"ProgramConfiguration",{omit:["_buffers"]}),Ut($,"ProgramConfigurationSet");const de=$t/Math.PI/2,ge=64,Ce=[ge,32,16],Ae=-de,Ee=de;function Ge(o,e,n,l=de){return n=tr(n),[o*Math.sin(n)*l,-e*l,o*Math.cos(n)*l]}function je(o,e,n){return Ge(Math.cos(tr(o)),Math.sin(tr(o)),e,n)}const Ue=63710088e-1,ze=2*Math.PI*Ue;class Pe{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pe(ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,p=e.lat*n,y=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((e.lng-this.lng)*n);return Ue*Math.acos(Math.min(y,1))}toBounds(e=0){const n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new We({lng:this.lng-l,lat:this.lat-n},{lng:this.lng+l,lat:this.lat+n})}toEcef(e){return je(this.lat,this.lng,de+e*de/Ue)}static convert(e){if(e instanceof Pe)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Pe(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Pe(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class We{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Pe?new Pe(e.lng,e.lat):Pe.convert(e),this}setSouthWest(e){return this._sw=e instanceof Pe?new Pe(e.lng,e.lat):Pe.convert(e),this}extend(e){const n=this._sw,l=this._ne;let p,y;if(e instanceof Pe)p=e,y=e;else{if(!(e instanceof We))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(We.convert(e)):this.extend(Pe.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Pe.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return n||l?(n.lng=Math.min(p.lng,n.lng),n.lat=Math.min(p.lat,n.lat),l.lng=Math.max(y.lng,l.lng),l.lat=Math.max(y.lat,l.lat)):(this._sw=new Pe(p.lng,p.lat),this._ne=new Pe(y.lng,y.lat)),this}getCenter(){return new Pe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Pe(this.getWest(),this.getNorth())}getSouthEast(){return new Pe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=Pe.convert(e);let p=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&p}static convert(e){if(e)return e instanceof We?e:new We(e)}}function Xe(o){return ze*Math.cos(o*Math.PI/180)}function Qe(o){return(180+o)/360}function rt(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function tt(o,e){return o/Xe(e)}function pt(o){return 360*o-180}function wt(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function nt(o,e){return o*Xe(wt(e))}const Ze=85.051129;function _t(o){return Math.cos(tr(Oe(o,-85.051129,Ze)))}function ot(o,e){const n=Oe(e,0,25.5),l=Math.pow(2,n);return _t(o)*ze/(512*l)}function bt(o){return 1/Math.cos(o*Math.PI/180)}function Lt(o,e=0){const n=Math.exp(Math.PI*(1-(o.y+e/$t)/(1<<o.z)*2));return 80150034*n/(n*n+1)/$t/(1<<o.z)}class Wt{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=Pe.convert(e);return new Wt(Qe(l.lng),rt(l.lat),tt(n,l.lat))}toLngLat(){return new Pe(pt(this.x),wt(this.y))}toAltitude(){return nt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ze*bt(wt(this.y))}}function jt(o,e,n,l,p,y,b,T,P){const I=(e+l)/2,F=(n+p)/2,B=new Pt(I,F);T(B),(function(N,H,W,ne,ue,ae){const fe=W-ue,ye=ne-ae;return Math.abs((ne-H)*fe-(W-N)*ye)/Math.hypot(fe,ye)})(B.x,B.y,y.x,y.y,b.x,b.y)>=P?(jt(o,e,n,I,F,y,B,T,P),jt(o,I,F,l,p,B,b,T,P)):o.push(b)}function zt(o,e,n){let l=o[0],p=l.x,y=l.y;e(l);const b=[l];for(let T=1;T<o.length;T++){const P=o[T],{x:I,y:F}=P;e(P),jt(b,p,y,I,F,l,P,e,n),p=I,y=F,l=P}return b}function hi(o,e,n,l){if(l(e,n)){const p=e.add(n)._mult(.5);hi(o,e,p,l),hi(o,p,n,l)}else o.push(n)}function ai(o,e){let n=o[0];const l=[n];for(let p=1;p<o.length;p++){const y=o[p];hi(l,n,y,e),n=y}return l}const Xt=Math.pow(2,14)-1,oi=-Xt-1;function _i(o,e){const n=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=Oe(n,oi,Xt),o.y=Oe(l,oi,Xt),(n<o.x||n>o.x+1||l<o.y||l>o.y+1)&&Pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ti(o,e,n){const l=o.loadGeometry(),p=o.extent,y=$t/p;if(e&&n&&n.projection.isReprojectedInTileSpace){const b=1<<e.z,{scale:T,x:P,y:I,projection:F}=n,B=N=>{const H=pt((e.x+N.x/p)/b),W=wt((e.y+N.y/p)/b),ne=F.project(H,W);N.x=(ne.x*T-P)*p,N.y=(ne.y*T-I)*p};for(let N=0;N<l.length;N++)if(o.type!==1)l[N]=zt(l[N],B,1);else{const H=[];for(const W of l[N])W.x<0||W.x>=p||W.y<0||W.y>=p||(B(W),H.push(W));l[N]=H}}for(const b of l)for(const T of b)_i(T,y);return l}function Fi(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Ti(o):[]}}class Yi{constructor(e,n,l,p,y){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=p,this._values=y,e.readFields(Ai,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let p,y=1,b=0,T=0,P=0;for(;e.pos<n;){if(b<=0){const I=e.readVarint();y=7&I,b=I>>3}if(b--,y===1||y===2)T+=e.readSVarint(),P+=e.readSVarint(),y===1&&(p&&l.push(p),p=[]),p&&p.push(new Pt(T,P));else{if(y!==7)throw new Error(`unknown command ${y}`);p&&p.push(p[0].clone())}}return p&&l.push(p),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,p=0,y=0,b=0,T=1/0,P=-1/0,I=1/0,F=-1/0;for(;e.pos<n;){if(p<=0){const B=e.readVarint();l=7&B,p=B>>3}if(p--,l===1||l===2)y+=e.readSVarint(),b+=e.readSVarint(),y<T&&(T=y),y>P&&(P=y),b<I&&(I=b),b>F&&(F=b);else if(l!==7)throw new Error(`unknown command ${l}`)}return[T,I,P,F]}toGeoJSON(e,n,l){const p=this.extent*Math.pow(2,l),y=this.extent*e,b=this.extent*n,T=this.loadGeometry();function P(N){return[360*(N.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+b)/p)*Math.PI))-90]}function I(N){return N.map(P)}let F;if(this.type===1){const N=[];for(const W of T)N.push(W[0]);const H=I(N);F=N.length===1?{type:"Point",coordinates:H[0]}:{type:"MultiPoint",coordinates:H}}else if(this.type===2){const N=T.map(I);F=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=(function(W){const ne=W.length;if(ne<=1)return[W];const ue=[];let ae,fe;for(let ye=0;ye<ne;ye++){const be=Bi(W[ye]);be!==0&&(fe===void 0&&(fe=be<0),fe===be<0?(ae&&ue.push(ae),ae=[W[ye]]):ae&&ae.push(W[ye]))}return ae&&ue.push(ae),ue})(T),H=[];for(const W of N)H.push(W.map(I));F=H.length===1?{type:"Polygon",coordinates:H[0]}:{type:"MultiPolygon",coordinates:H}}}const B={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(B.id=this.id),B}}function Ai(o,e,n){o===1?e.id=n.readVarint():o===2?(function(l,p){const y=l.readVarint()+l.pos;for(;l.pos<y;){const b=p._keys[l.readVarint()],T=p._values[l.readVarint()];p.properties[b]=T}})(n,e):o===3?e.type=n.readVarint():o===4&&(e._geometry=n.pos)}function Bi(o){let e=0;for(let n,l,p=0,y=o.length,b=y-1;p<y;b=p++)n=o[p],l=o[b],e+=(l.x-n.x)*(n.y+l.y);return e}Yi.types=["Unknown","Point","LineString","Polygon"];class Di{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ur,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Yi(this._pbf,n,this.extent,this._keys,this._values)}}function ur(o,e,n){o===15?e.version=n.readVarint():o===1?e.name=n.readString():o===5?e.extent=n.readVarint():o===2?e._features.push(n.pos):o===3?e._keys.push(n.readString()):o===4&&e._values.push((function(l){let p=null;const y=l.readVarint()+l.pos;for(;l.pos<y;){const b=l.readVarint()>>3;p=b===1?l.readString():b===2?l.readFloat():b===3?l.readDouble():b===4?l.readVarint64():b===5?l.readVarint():b===6?l.readSVarint():b===7?l.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(n))}class sr{constructor(e,n){this.layers=e.readFields(vr,{},n)}}function vr(o,e,n){if(o===3){const l=new Di(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const er="3d_elevation_id",ji="level";class or{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,l){return this.get(e,!0,n,l)}optional(e,n,l){return this.get(e,!1,n,l)}success(){return this._valid}get(e,n,l,p){const y=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?l(p?p(y):y):n&&(this._valid=!1),this}}class Hr{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,l){return this.featureFunc(e,n,l)}parseVertex(e,n,l){return this.vertexFunc(e,n,l)}}const br=new Hr((o,e,n)=>o.reset(e).require(er,l=>{n.id=l}).optional("fixed_height_relative",l=>{n.constantHeight=l},Oi.decodeRelativeHeight).geometry(l=>{n.bounds=l},Do).success(),(o,e,n)=>o.reset(e).require(er,l=>{n.id=l}).require("elevation_idx",l=>{n.idx=l}).require("extent",l=>{n.extent=l}).require("height_relative",l=>{n.height=l},Oi.decodeRelativeHeight).geometry(l=>{n.position=l},Oi.getPoint).success()),pr=new Hr((o,e,n)=>o.reset(e).require(er,l=>{n.id=l}).optional("fixed_height",l=>{n.constantHeight=l},Oi.decodeMetricHeight).geometry(l=>{n.bounds=l},Do).success(),(o,e,n)=>o.reset(e).require(er,l=>{n.id=l}).require("elevation_idx",l=>{n.idx=l}).require("extent",l=>{n.extent=l}).require("height",l=>{n.height=l},Oi.decodeMetricHeight).geometry(l=>{n.position=l},Oi.getPoint).success());class Oi{static getPoint(e){return $n(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?pr:void 0:br}static parse(e){const n=[],l=[],p=e.length,y=new or;for(let b=0;b<p;b++){const T=e.feature(b),P=T.properties.version,I=Oi.getVersionSchema(P);if(I===void 0){Pi(`Unknown elevation feature version number ${P||"(unknown)"}`);continue}const F=T.properties.type;if(!F)continue;const B=Yi.types[T.type];if(B==="Point"&&F==="curve_point"){const N={};I.parseVertex(y,T,N)&&n.push(N)}else if(B==="Polygon"&&F==="curve_meta"){const N={};I.parseFeature(y,T,N)&&l.push(N)}}return{vertices:n,features:l}}}class Ni{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const p=Tr(n,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/p;return l[0]=this.pos[0]+this.dir[0]*y,l[1]=this.pos[1]+this.dir[1]*y,!0}}class kr{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const p=Gi(n,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/p;return l[0]=this.pos[0]+this.dir[0]*y,l[1]=this.pos[1]+this.dir[1]*y,l[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(e,n,l){if((function(H,W){var ne=H[0],ue=H[1],ae=H[2],fe=W[0],ye=W[1],be=W[2];return Math.abs(ne-fe)<=k*Math.max(1,Math.abs(ne),Math.abs(fe))&&Math.abs(ue-ye)<=k*Math.max(1,Math.abs(ue),Math.abs(ye))&&Math.abs(ae-be)<=k*Math.max(1,Math.abs(ae),Math.abs(be))})(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;const[p,y,b]=this.dir,T=this.pos[0]-e[0],P=this.pos[1]-e[1],I=this.pos[2]-e[2],F=p*p+y*y+b*b,B=2*(T*p+P*y+I*b),N=B*B-4*F*(T*T+P*P+I*I-n*n);if(N<0){const H=Math.max(-B/2,0),W=T+p*H,ne=P+y*H,ue=I+b*H,ae=Math.hypot(W,ne,ue);return l[0]=W*n/ae,l[1]=ne*n/ae,l[2]=ue*n/ae,!1}{const H=(-B-Math.sqrt(N))/(2*F);if(H<0){const W=Math.hypot(T,P,I);return l[0]=T*n/W,l[1]=P*n/W,l[2]=I*n/W,!1}return l[0]=T+p*H,l[1]=P+y*H,l[2]=I+b*H,!0}}}class sn{constructor(e,n,l,p,y){this.TL=e,this.TR=n,this.BR=l,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(e,n,l){const p=[-1,1,1],y=[1,1,1],b=[1,-1,1],T=[-1,-1,1],P=Ui(p,p,e),I=Ui(y,y,e),F=Ui(b,b,e),B=Ui(T,T,e);return new sn(P,I,F,B,n/l)}}function Er(o,e,n){let l=1/0,p=-1/0;const y=[];for(const b of o){Sr(y,b,e);const T=Gi(y,n);l=Math.min(l,T),p=Math.max(p,T)}return[l,p]}function Lr(o,e){let n=!0;for(let l=0;l<o.planes.length;l++){const p=o.planes[l];let y=0;for(let b=0;b<e.length;b++)y+=+(Gi(p,e[b])+p[3]>=0);if(y===0)return 0;y!==e.length&&(n=!1)}return n?2:1}function Vs(o,e){for(const n of o.projections){const l=Er(e,o.points[0],n.axis);if(n.projection[1]<l[0]||n.projection[0]>l[1])return 0}return 1}function ws(o,e){let n=0;const l=[0,0,0,0];for(let p=0;p<o.length;p++)l[0]=o[p][0],l[1]=o[p][1],l[2]=o[p][2],l[3]=1,Dr(l,e)>=0&&n++;return n}class ns{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=mr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Sr([],this.points[2],this.points[3]),Sr([],this.points[0],this.points[3]),Sr([],this.points[4],this.points[0]),Sr([],this.points[5],this.points[1]),Sr([],this.points[6],this.points[2]),Sr([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const p=[0,-l[2],l[1]],y=[l[2],0,-l[0]];this.projections.push({axis:p,projection:Er(this.points,this.points[0],p)}),this.projections.push({axis:y,projection:Er(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(e,n,l,p){const y=Math.pow(2,l),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const F=jn([],I,e),B=1/F[3]/n*y;return(N=F)[0]=(H=F)[0]*(W=[B,B,p?1/F[3]:B,B])[0],N[1]=H[1]*W[1],N[2]=H[2]*W[2],N[3]=H[3]*W[3],N;var N,H,W}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const F=vi([],lr([],Sr([],b[I[0]],b[I[1]]),Sr([],b[I[2]],b[I[1]]))),B=-Gi(F,b[I[1]]);return F.concat(B)}),P=[];for(let I=0;I<b.length;I++)P.push([b[I][0],b[I][1],b[I][2]]);return new ns(P,T)}intersectsPrecise(e,n,l){for(let p=0;p<n.length;p++)if(!ws(e,n[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!ws(e,this.planes[p]))return 0;for(const p of l)for(const y of this.frustumEdges){const b=lr([],p,y),T=kt(b);if(T===0)continue;ct(b,b,1/T);const P=Er(this.points,this.points[0],b),I=Er(e,this.points[0],b);if(P[0]>I[1]||I[0]>P[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const l=n[3];if(Gi([n[0],n[1],n[2]],e)+l<0)return!1}return!0}}class mr{static fromPoints(e){const n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const p of e)Me(n,n,p),at(l,l,p);return new mr(n,l)}static fromTileIdAndHeight(e,n,l){const p=1<<e.canonical.z,y=e.canonical.x,b=e.canonical.y;return new mr([y/p,b/p,n],[(y+1)/p,(b+1)/p,l])}static applyTransform(e,n){const l=e.getCorners();for(let p=0;p<l.length;++p)Ui(l[p],l[p],n);return mr.fromPoints(l)}static applyTransformFast(e,n){const l=[n[12],n[13],n[14]],p=[...l];for(let y=0;y<3;y++)for(let b=0;b<3;b++){const T=n[4*b+y],P=T*e.min[b],I=T*e.max[b];l[y]+=Math.min(P,I),p[y]+=Math.max(P,I)}return new mr(l,p)}static projectAabbCorners(e,n){const l=e.getCorners();for(let p=0;p<l.length;++p)Ui(l[p],l[p],n);return l}constructor(e,n){this.min=e,this.max=n,this.center=ct([],pe([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=si(this.min),p=si(this.max);for(let y=0;y<n.length;y++)l[y]=n[y]?this.min[y]:this.center[y],p[y]=n[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new mr(l,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Lr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Lr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Vs(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Vs(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ut(mr,"Aabb");class Aa{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,l=n[1],p=-n[0],y=(e.extent+1)*this.metersToTile;return[new Pt(Math.trunc(e.position[0]+l*y),Math.trunc(e.position[1]+p*y)),new Pt(Math.trunc(e.position[0]-l*y),Math.trunc(e.position[1]-p*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Es{constructor(e,n,l,p,y,b){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Sn(),Sn(),Sn(),Sn(),Sn(),Sn(),Sn()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=n,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=y,this.edges=this.edges.filter(T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((P=this.vertices[T.a].position)[0]===(I=this.vertices[T.b].position)[0]&&P[1]===I[1]);var P,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:$n(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const P=this.vertices[T.a].position,I=this.vertices[T.b].position,F=Ls(Sn(),I,P),B=Wa(F),N=qa(Sn(),F,1/B);this.edgeProps.push({vec:F,dir:N,len:B});const H=this.vertexProps[T.a].dir,W=this.vertexProps[T.b].dir;ao(H,H,N),ao(W,W,N)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||oo(T.dir,T.dir);this.tessellate(b)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[l,p]=n;return Ri(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,p)}computeSlopeNormal(e,n){const l=this.getClosestEdge(e);if(!l)return xe(0,0,1);const p=l[0],y=this.edges[p],b=this.edgeProps[p].vec,T=xe(b[0],b[1],(this.vertices[y.b].height-this.vertices[y.a].height)*n),P=xe(T[1],-T[0],0);lr(P,P,T);const I=kt(P);return I>0?ct(P,P,1/I):Fe(P,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,l=Number.POSITIVE_INFINITY,p=0;const[y,b,T,P,I,F,B]=this._tmpVec2;Ro(B,e.x,e.y);const N=new Ni(B,null);for(let H=0;H<this.edges.length;H++){const W=this.edges[H],ne=this.edgeProps[H].dir;N.dir=ne;const ue=this.vertices[W.a].position,ae=this.vertices[W.b].position,fe=N.intersectsPlane(ue,this.vertexProps[W.a].dir,y),ye=N.intersectsPlane(ae,this.vertexProps[W.b].dir,b);if(!fe||!ye)continue;Ls(T,b,y),Ls(P,B,y);const be=Tr(T,T),Ie=be>0?Tr(P,T)/be:0,Re=Oe(Ie,0,1),Ne=Math.abs((Ie-Re)*this.edgeProps[H].len);Ls(I,B,ue),Ro(F,ne[1],-ne[0]);const Ve=Ne+Math.abs(Tr(I,F));Ve<l&&(n=H,l=Ve,p=Re)}return[n,p]}tessellate(e){const n=Bt(),l=Bt(),p=Bt(),y=Bt();for(let b=this.edges.length-1;b>=0;--b){const T=this.edges[b].a,P=this.edges[b].b,{position:I,height:F,extent:B}=this.vertices[T],{position:N,height:H,extent:W}=this.vertices[P],ne=this.vertexProps[T].dir,ue=this.vertexProps[P].dir;if(Fe(n,I[0]/e,I[1]/e,F),Fe(l,N[0]/e,N[1]/e,H),Fe(p,ne[1],-ne[0],0),ct(p,p,B),Fe(y,ue[1],-ue[0],0),ct(y,y,W),this.distSqLines(xe(n[0]+.5*p[0],n[1]+.5*p[1],n[2]+.5*p[2]),xe(l[0]-.5*y[0],l[1]-.5*y[1],l[2]-.5*y[2]),xe(n[0]-.5*p[0],n[1]-.5*p[1],n[2]-.5*p[2]),xe(l[0]+.5*y[0],l[1]+.5*y[1],l[2]+.5*y[2]))<=.0025000000000000005)continue;const ae=this.vertices.length,fe=ao(Sn(),I,N);this.vertices.push({position:qa(fe,fe,.5),height:.5*(F+H),extent:.5*(B+W)});const ye=ao(Sn(),ne,ue);this.vertexProps.push({dir:oo(ye,ye)}),this.edges.splice(b,1),this.edgeProps.splice(b,1),this.edges.push({a:T,b:ae}),this.edges.push({a:ae,b:P});const be=Ls(Sn(),this.vertices[ae].position,I),Ie=Wa(be),Re={vec:be,dir:qa(Sn(),be,1/Ie),len:Ie};this.edgeProps.push(Re),this.edgeProps.push(Re)}}distSqLines(e,n,l,p){const y=Te(Bt(),n,e),b=Te(Bt(),p,l),T=Te(Bt(),e,l),P=Gi(y,y),I=Gi(y,b),F=Gi(y,T),B=Gi(b,b),N=Gi(b,T),H=P*B-I*I;if(H===0)return mi(zr(y,l,p,Gi(T,b)/Gi(b,b)),e);const W=(P*N-I*F)/H;return mi(zr(y,e,n,(I*N-F*B)/H),zr(b,l,p,W))}}class Ms{static parseFrom(e,n){const l=Oi.parse(e);if(!l)return[];let{vertices:p,features:y}=l;const b=1/Lt(n);y.sort((F,B)=>F.id-B.id),p.sort((F,B)=>F.id-B.id||F.idx-B.idx),p=p.filter((F,B,N)=>B===N.findIndex(H=>H.id===F.id&&H.idx===F.idx));const T=new Array;let P=0;const I=p.length;for(const F of y){if(F.constantHeight){T.push(new Es(F.id,F.bounds,F.constantHeight));continue}for(;P!==I&&p[P].id<F.id;)P++;if(P===I||p[P].id!==F.id)continue;const B=new Array,N=new Array,H=P;for(;P!==I&&p[P].id===F.id;){const W=p[P];if(B.push({position:W.position,height:W.height,extent:W.extent}),P!==H&&p[P-1].idx===W.idx-1){const ne=P-H;N.push({a:ne-1,b:ne})}P++}T.push(new Es(F.id,F.bounds,void 0,B,N,b))}return T}static getElevationFeature(e,n){if(!n)return;const l=+e.properties[er];return Number.isNaN(l)?void 0:n.find(p=>p.id===l)}}class Va{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*$t,this.yOffset=(e.y*this.zScale-n.y)*$t)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,l){const p=this.constantElevation(n,l);return p??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),l))}computeBiasedHeight(e,n){return n<=0?e:e+n*Ke(0,n,e>=0?e:Math.abs(.5*e))}}Ut(Es,"ElevationFeature");class pa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xl,this.indexArray=new qn,this.segments=new $r,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ds),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,p){}populate(e,n,l,p){const y=this.layers[0],b=[];let T=null;y.type==="circle"&&(T=y.layout.get("circle-sort-key"));for(const{feature:I,id:F,index:B,sourceLayerIndex:N}of e){const H=this.layers[0]._featureFilter.needGeometry,W=Fi(I,H);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),W,l))continue;const ne=T?T.evaluate(W,{},l):void 0,ue={id:F,properties:I.properties,type:I.type,sourceLayerIndex:N,index:B,geometry:H?W.geometry:Ti(I,l,p),patterns:{},sortKey:ne};b.push(ue)}T&&b.sort((I,F)=>I.sortKey-F.sortKey);let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new fu,P=p.projection);for(const I of b){const{geometry:F,index:B,sourceLayerIndex:N}=I,H=e[B].feature;this.addFeature(I,F,B,n.availableImages,l,P,n.brightness,n.elevationFeatures),n.featureIndex.insert(H,F,B,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,l,p,y,b,T){this.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Np.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Wo.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,l,p,y,b,T,P){let I;this.elevationMode!=="none"&&(I=Ms.getElevationFeature(e,P));for(const F of n)for(const B of F){const N=B.x,H=B.y;if(N<0||N>=$t||H<0||H>=$t)continue;if(b){const ue=b.projectTilePoint(N,H,y),ae=b.upVector(y,N,H);this.addGlobeExtVertex(ue,ae),this.addGlobeExtVertex(ue,ae),this.addGlobeExtVertex(ue,ae),this.addGlobeExtVertex(ue,ae)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ne=W.vertexLength;if(this.addCircleVertex(N,H,-1,-1),this.addCircleVertex(N,H,1,-1),this.addCircleVertex(N,H,1,1),this.addCircleVertex(N,H,-1,1),this.elevationMode!=="none"){const ue=I?I.pointElevation(new Pt(N,H)):0;this.hasElevation=this.hasElevation||ue!==0;for(let ae=0;ae<4;ae++)this.elevatedLayoutVertexArray.emplaceBack(ue)}this.indexArray.emplaceBack(ne,ne+1,ne+2),this.indexArray.emplaceBack(ne,ne+2,ne+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},p,y,T,void 0,this.worldview)}addCircleVertex(e,n,l,p){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*n+(p+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Qr(o,e){for(let n=0;n<o.length;n++)if(Ra(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(Ra(o,e[n]))return!0;return!!Jn(o,e)}function Cn(o,e,n){return!!Ra(o,e)||!!Zo(e,o,n)}function jr(o,e){if(o.length===1)return bu(e,o[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let p=0;p<l.length;p++)if(Ra(o,l[p]))return!0}for(let n=0;n<o.length;n++)if(bu(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(Jn(o,e[n]))return!0;return!1}function Ln(o,e,n){if(o.length>1){if(Jn(o,e))return!0;for(let l=0;l<e.length;l++)if(Zo(e[l],o,n))return!0}for(let l=0;l<o.length;l++)if(Zo(o[l],e,n))return!0;return!1}function Jn(o,e){if(o.length===0||e.length===0)return!1;for(let n=0;n<o.length-1;n++){const l=o[n],p=o[n+1];for(let y=0;y<e.length-1;y++)if(tn(l,p,e[y],e[y+1]))return!0}return!1}function tn(o,e,n,l){return Fr(o,n,l)!==Fr(e,n,l)&&Fr(o,e,n)!==Fr(o,e,l)}function Ca(o,e,n){return(o.x-n.x)*(e.y-n.y)-(o.y-n.y)*(e.x-n.x)}function bh(o,e,n,l){const p=Ca(o,e,l),y=Ca(o,e,n);if(Math.sign(p)===Math.sign(y))return;const b=Ca(n,l,o),T=b+y-p;return Math.sign(b)!==Math.sign(T)?[b/(b-T),y/(y-p)]:void 0}function Zo(o,e,n){const l=n*n;if(e.length===1)return o.distSqr(e[0])<l;for(let p=1;p<e.length;p++)if(vu(o,e[p-1],e[p])<l)return!0;return!1}function vu(o,e,n){const l=e.distSqr(n);if(l===0)return o.distSqr(e);const p=((o.x-e.x)*(n.x-e.x)+(o.y-e.y)*(n.y-e.y))/l;return o.distSqr(p<0?e:p>1?n:n.sub(e)._mult(p)._add(e))}function bu(o,e){let n,l,p,y=!1;for(let b=0;b<o.length;b++){n=o[b];for(let T=0,P=n.length-1;T<n.length;P=T++)l=n[T],p=n[P],l.y>e.y!=p.y>e.y&&e.x<(p.x-l.x)*(e.y-l.y)/(p.y-l.y)+l.x&&(y=!y)}return y}function Ra(o,e){let n=!1;for(let l=0,p=o.length-1;l<o.length;p=l++){const y=o[l],b=o[p];y.y>e.y!=b.y>e.y&&e.x<(b.x-y.x)*(e.y-y.y)/(b.y-y.y)+y.x&&(n=!n)}return n}function ro(o,e,n,l,p){for(const b of o)if(e<=b.x&&n<=b.y&&l>=b.x&&p>=b.y)return!0;const y=[new Pt(e,n),new Pt(e,p),new Pt(l,p),new Pt(l,n)];if(o.length>2){for(const b of y)if(Ra(o,b))return!0}for(let b=0;b<o.length-1;b++)if(Xo(o[b],o[b+1],y))return!0;return!1}function Xo(o,e,n){const l=n[0],p=n[2];if(o.x<l.x&&e.x<l.x||o.x>p.x&&e.x>p.x||o.y<l.y&&e.y<l.y||o.y>p.y&&e.y>p.y)return!1;const y=Fr(o,e,n[0]);return y!==Fr(o,e,n[1])||y!==Fr(o,e,n[2])||y!==Fr(o,e,n[3])}function Ua(o,e,n,l,p,y){let b=e.y-o.y,T=o.x-e.x;if(y=y||0){const P=b*b+T*T;if(P===0)return!0;const I=Math.sqrt(P);b/=I,T/=I}return!((n.x-o.x)*b+(n.y-o.y)*T-y<0||(l.x-o.x)*b+(l.y-o.y)*T-y<0||(p.x-o.x)*b+(p.y-o.y)*T-y<0)}function Vr(o,e,n,l,p,y,b){return!(Ua(o,e,l,p,y,b)||Ua(e,n,l,p,y,b)||Ua(n,o,l,p,y,b)||Ua(l,p,o,e,n,b)||Ua(p,y,o,e,n,b)||Ua(y,l,o,e,n,b))}function Jl(o,e,n){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(o)}function Df(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Bg(o,e,n,l,p){if(!e[0]&&!e[1])return o;const y=Pt.convert(e)._mult(p);n==="viewport"&&y._rotate(-l);const b=[];for(let T=0;T<o.length;T++)b.push(o[T].sub(y));return b}function Gy(o,e,n,l){const p=Pt.convert(o)._mult(l);return e==="viewport"&&p._rotate(-n),p}let $y,Hy;function Gp(o,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[o*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Ut(pa,"CircleBucket",{omit:["layers"]});class wl{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=wh(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const l=(function(y,b,T){var P=Gp(256*y,256*(b=Math.pow(2,T)-b-1),T),I=Gp(256*(y+1),256*(b+1),T);return P[0]+","+P[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),p=(function(y,b,T){let P,I="";for(let F=y;F>0;F--)P=1<<F-1,I+=(b&P?1:0)+(T&P?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qm{constructor(e,n){this.wrap=e,this.canonical=n,this.key=wh(e,n.z,n.z,n.x,n.y)}}class Ps{constructor(e,n,l,p,y){this.overscaledZ=e,this.wrap=n,this.canonical=new wl(l,+p,+y),this.key=n===0&&e===l?this.canonical.key:wh(n,e,l,p,y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Ps(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ps(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return wh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return wh(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Ps(n,this.wrap,n,l,p),new Ps(n,this.wrap,n,l+1,p),new Ps(n,this.wrap,n,l,p+1),new Ps(n,this.wrap,n,l+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ps(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wh(o,e,n,l,p){const y=1<<Math.min(n,22);let b=y*(p%y)+l%y;return o&&n<22&&(b+=y*y*((o<0?-2*o-1:2*o)%(1<<2*(22-n)))),16*(32*b+n)+(e-n)}const Eh=[o=>{let e=o.canonical.x-1,n=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,n--),new Ps(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,n=o.wrap;return e===1<<o.canonical.z&&(e=0,n++),new Ps(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>new Ps(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Ps(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ut(wl,"CanonicalTileID"),Ut(Ps,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Mc=Xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sh}=Mc,n0=Xi([{name:"a_pos_3",components:3,type:"Int16"}]);var jg=Xi([{name:"a_pos",type:"Int16",components:2}]);function $p(o){return o*de/Ue}const qy=[new mr([Ae,Ae,Ae],[Ee,Ee,Ee]),new mr([Ae,Ae,Ae],[0,0,Ee]),new mr([0,Ae,Ae],[Ee,0,Ee]),new mr([Ae,0,Ae],[0,Ee,Ee]),new mr([0,0,Ae],[Ee,Ee,Ee])];function Ng(o,e,n,l=!0){const p=ct([],o._camera.position,o.worldSize),y=[e,n,1,1];jn(y,y,o.pixelMatrixInverse),dn(y,y,1/y[3]);const b=vi([],Sr([],y,p)),T=o.globeMatrix,P=[T[12],T[13],T[14]],I=Sr([],P,p),F=kt(I),B=vi([],I),N=o.worldSize/(2*Math.PI),H=Gi(B,b),W=Math.asin(N/F);if(W<Math.acos(H)){if(!l)return null;const He=[],Ye=[];ct(He,b,F/H),vi(Ye,Sr(Ye,He,I)),vi(b,pe(b,I,ct(b,Ye,Math.tan(W)*F)))}const ne=[];new kr(p,b).closestPointOnSphere(P,N,ne);const ue=vi([],Yr(T,0)),ae=vi([],Yr(T,1)),fe=vi([],Yr(T,2)),ye=Gi(ue,ne),be=Gi(ae,ne),Ie=Gi(fe,ne),Re=Je(Math.asin(-be/N));let Ne=Je(Math.atan2(ye,Ie));Ne=o.center.lng+(function(He,Ye){const yt=(Ye-He+180)%360-180;return yt<-180?yt+360:yt})(o.center.lng,Ne);const Ve=Qe(Ne),Be=Oe(rt(Re),0,1);return new Wt(Ve,Be)}class s0{constructor(e,n,l){this.a=Sr([],e,l),this.b=Sr([],n,l),this.center=l;const p=vi([],this.a),y=vi([],this.b);this.angle=Math.acos(Gi(p,y))}}function Hp(o,e){if(o.angle===0)return null;let n;return n=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),n<0||n>1?null:(function(l,p,y,b){const T=Math.sin(y);return l*(Math.sin((1-b)*y)/T)+p*(Math.sin(b*y)/T)})(o.a[e],o.b[e],o.angle,Oe(n,0,1))+o.center[e]}function ec(o){if(o.z<=1)return qy[o.z+2*o.y+o.x];const e=Vg(kf(o));return mr.fromPoints(e)}function Pc(o,e,n){return ct(o,o,1-n),Ct(o,o,e,n)}function Wy(o,e,n){for(const l of o)Ui(l,l,e),ct(l,l,n)}function Wm(o,e,n,l){const p=e/o.worldSize,y=o.globeMatrix;if(n.z<=1){const Be=ec(n).getCorners();return Wy(Be,y,p),mr.fromPoints(Be)}const b=kf(n,l),T=Vg(b,de+$p(o._tileCoverLift));Wy(T,y,p);const P=Number.MAX_VALUE,I=[-P,-P,-P],F=[P,P,P];if(b.contains(o.center)){for(const Ye of T)Me(F,F,Ye),at(I,I,Ye);I[2]=0;const Be=o.point,He=[Be.x*p,Be.y*p,0];return Me(F,F,He),at(I,I,He),new mr(F,I)}if(o._tileCoverLift>0){for(const Be of T)Me(F,F,Be),at(I,I,Be);return new mr(F,I)}const B=[y[12]*p,y[13]*p,y[14]*p],N=b.getCenter(),H=Oe(o.center.lat,-85.051129,Ze),W=Oe(N.lat,-85.051129,Ze),ne=Qe(o.center.lng),ue=rt(H);let ae=ne-Qe(N.lng);const fe=ue-rt(W);ae>.5?ae-=1:ae<-.5&&(ae+=1);let ye=0;Math.abs(ae)>Math.abs(fe)?ye=ae>=0?1:3:(ye=fe>=0?0:2,Ct(B,B,[y[4]*p,y[5]*p,y[6]*p],-Math.sin(tr(fe>=0?b.getSouth():b.getNorth()))*de));const be=T[ye],Ie=T[(ye+1)%4],Re=new s0(be,Ie,B),Ne=[Hp(Re,0)||be[0],Hp(Re,1)||be[1],Hp(Re,2)||be[2]],Ve=wu(o.zoom);if(Ve>0){const Be=(function({x:Ye,y:yt,z:ft},gt,Tt,Et,St){const ht=1/(1<<ft);let Rt=Ye*ht,vt=Rt+ht,Mt=yt*ht,At=Mt+ht,ti=0;const ri=(Rt+vt)/2-Et;return ri>.5?ti=-1:ri<-.5&&(ti=1),Rt=((Rt+ti)*gt-(Et*=gt))*Tt+Et,vt=((vt+ti)*gt-Et)*Tt+Et,Mt=(Mt*gt-(St*=gt))*Tt+St,At=(At*gt-St)*Tt+St,[[Rt,At,0],[vt,At,0],[vt,Mt,0],[Rt,Mt,0]]})(n,e,o._pixelsPerMercatorPixel,ne,ue);for(let Ye=0;Ye<T.length;Ye++)Pc(T[Ye],Be[Ye],Ve);const He=pe([],Be[ye],Be[(ye+1)%4]);ct(He,He,.5),Pc(Ne,He,Ve)}for(const Be of T)Me(F,F,Be),at(I,I,Be);return F[2]=Math.min(be[2],Ie[2]),Me(F,F,Ne),at(I,I,Ne),new mr(F,I)}function kf({x:o,y:e,z:n},l=!1){const p=1/(1<<n),y=new Pe(pt(o*p),e===(1<<n)-1&&l?-90:wt((e+1)*p)),b=new Pe(pt((o+1)*p),e===0&&l?90:wt(e*p));return new We(y,b)}function Vg(o,e=de){const n=tr(o.getNorth()),l=tr(o.getSouth()),p=Math.cos(n),y=Math.cos(l),b=Math.sin(n),T=Math.sin(l),P=o.getWest(),I=o.getEast();return[Ge(y,T,P,e),Ge(y,T,I,e),Ge(p,b,I,e),Ge(p,b,P,e)]}function qp(o,e,n,l){const p=1<<n.z,y=(o/$t+n.x)/p;return je(wt((e/$t+n.y)/p),pt(y),l)}function Th({min:o,max:e}){return 16383/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Zy=new Float64Array(16);function Wp(o){const e=Th(o),n=Le(Zy,[e,e,e]);return Q(n,n,zi([],o.min))}function Ur(o){const e=(function(l,p){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=p[0],l[13]=p[1],l[14]=p[2],l[15]=1,l})(Zy,o.min),n=1/Th(o);return oe(e,e,[n,n,n])}function Zp(o){const e=$t/(2*Math.PI);return o/(2*Math.PI)/e}function Xp(o,e){return $t/(512*Math.pow(2,o))*Th(ec(e))}function Zm(o,e,n,l,p){const y=Zp(n),b=[o,e,-n/(2*Math.PI)],T=le(new Float64Array(16));return Q(T,T,b),oe(T,T,[y,y,y]),_e(T,T,tr(-p)),Se(T,T,tr(-l)),T}function wu(o){return Ke(5,6,o)}function Xm(o,e){const n=je(e.lat,e.lng),l=(function(W){const ne=je(W._center.lat,W._center.lng);let ue=lr([],xe(0,1,0),ne);const ae=lt([],-W.angle,ne);ue=Ui(ue,ue,ae),lt(ae,-W._pitch,ue);const fe=vi([],ne);return ct(fe,fe,$p(W.cameraToCenterDistance/W.pixelsPerMeter)),Ui(fe,fe,ae),pe([],ne,fe)})(o);return b=(p=Te([],l,n))[0],T=p[1],P=p[2],I=(y=n)[0],F=y[1],B=y[2],H=(N=Math.sqrt((b*b+T*T+P*P)*(I*I+F*F+B*B)))&&Gi(p,y)/N,Math.acos(Math.min(Math.max(H,-1),1));var p,y,b,T,P,I,F,B,N,H}function Md(o,e){return Xm(o,e)>Math.PI/2*1.01}const Yp=tr(85),a0=Math.cos(Yp),Xy=Math.sin(Yp),o0=Z(),Yy=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ug(o,e,n,l,p,y,b,T,P){if(y&&o.queryGeometry.isAboveHorizon)return!1;y&&(P*=o.pixelToTileUnitsFactor);const I=o.tileID.canonical,F=n.projection.upVectorScale(I,n.center.lat,n.worldSize).metersToTile;for(const B of e)for(const N of B){const H=N.add(T),W=p&&n.elevation?n.elevation.exaggeration()*p.getElevationAt(H.x,H.y,!0):0,ne=n.projection.projectTilePoint(H.x,H.y,I);if(W>0){const ye=n.projection.upVector(I,H.x,H.y);ne.x+=ye[0]*F*W,ne.y+=ye[1]*F*W,ne.z+=ye[2]*F*W}const ue=y?H:Ky(ne.x,ne.y,ne.z,l),ae=y?o.tilespaceRays.map(ye=>Ma(ye,W)):o.queryGeometry.screenGeometry,fe=jn([],[ne.x,ne.y,ne.z,1],l);if(!b&&y?P*=fe[3]/n.cameraToCenterDistance:b&&!y&&(P*=n.cameraToCenterDistance/fe[3]),y){const ye=wt((N.y/$t+I.y)/(1<<I.z));P/=n.projection.pixelsPerMeter(ye,1)/tt(1,ye)}if(Cn(ae,ue,P))return!0}return!1}function Ky(o,e,n,l){const p=jn([],[o,e,n,1],l);return new Pt(p[0]/p[3],p[1]/p[3])}const On=xe(0,0,0),Gg=xe(0,0,1);function Ma(o,e){const n=Bt();return On[2]=e,o.intersectsPlane(On,Gg,n),new Pt(n[0],n[1])}class Qy extends pa{}let $g,Jy,Ym,Km;function Kp(o,{width:e,height:n},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*n*l)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*n*l);return o.width=e,o.height=n,o.data=p,o}function Hg(o,e,n){const{width:l,height:p}=e;l===o.width&&p===o.height||(Qm(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,p)},n,null),o.width=l,o.height=p,o.data=e.data)}function Qm(o,e,n,l,p,y,b,T){if(p.width===0||p.height===0)return e;if(p.width>o.width||p.height>o.height||n.x>o.width-p.width||n.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||l.x>e.width-p.width||l.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const P=o.data,I=e.data,F=y===4&&T;for(let B=0;B<p.height;B++){const N=((n.y+B)*o.width+n.x)*y,H=((l.y+B)*e.width+l.x)*y;if(F)for(let W=0;W<p.width;W++){const ne=N+W*y+3,ue=H+W*y;I[ue+0]=255,I[ue+1]=255,I[ue+2]=255,I[ue+3]=P[ne]}else if(b)for(let W=0;W<p.width;W++){const ne=N+W*y,ue=H+W*y,ae=new _r(P[ne+0]/255,P[ne+1]/255,P[ne+2]/255,P[ne+3]).toNonPremultipliedRenderColor(b).toArray();I[ue+0]=ae[0],I[ue+1]=ae[1],I[ue+2]=ae[2],I[ue+3]=ae[3]}else for(let W=0;W<p.width*y;W++)I[H+W]=P[N+W]}return e}Ut(Qy,"HeatmapBucket",{omit:["layers"]});class Ic{constructor(e,n){Kp(this,e,1,n)}resize(e){Hg(this,new Ic(e),1)}clone(){return new Ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,y){Qm(e,n,l,p,y,1,null)}}class Ss{constructor(e,n){Kp(this,e,4,n)}resize(e){Hg(this,new Ss(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,y,b,T){Qm(e,n,l,p,y,4,b,T)}}class e_{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function Lf(o){const e={},n=o.resolution||256,l=o.clips?o.clips.length:1,p=o.image||new Ss({width:n,height:l}),y=(b,T,P)=>{e[o.evaluationKey]=P;const I=o.expression.evaluate(e),F=I?I.toNonPremultipliedRenderColor(null):null;F&&(p.data[b+T+0]=Math.floor(255*F.r),p.data[b+T+1]=Math.floor(255*F.g),p.data[b+T+2]=Math.floor(255*F.b),p.data[b+T+3]=Math.floor(255*F.a))};if(o.clips)for(let b=0,T=0;b<l;++b,T+=4*n)for(let P=0,I=0;P<n;P++,I+=4){const F=P/(n-1),{start:B,end:N}=o.clips[b];y(T,I,B*(1-F)+N*F)}else for(let b=0,T=0;b<n;b++,T+=4)y(0,T,b/(n-1));return p}Ut(Ic,"AlphaImage"),Ut(Ss,"RGBAImage");const l0=Xi([{name:"a_pos",components:2,type:"Int16"}],4),t_=Xi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),c0=Xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),u0=Xi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Yo(o,e,n=2){const l=e&&e.length,p=l?e[0]*n:o.length;let y=qg(o,0,p,n,!0);const b=[];if(!y||y.next===y.prev)return b;let T,P,I;if(l&&(y=(function(F,B,N,H){const W=[];for(let ne=0,ue=B.length;ne<ue;ne++){const ae=qg(F,B[ne]*H,ne<ue-1?B[ne+1]*H:F.length,H,!1);ae===ae.next&&(ae.steiner=!0),W.push(r_(ae))}W.sort(Zg);for(let ne=0;ne<W.length;ne++)N=f0(W[ne],N);return N})(o,e,y,n)),o.length>80*n){T=o[0],P=o[1];let F=T,B=P;for(let N=n;N<p;N+=n){const H=o[N],W=o[N+1];H<T&&(T=H),W<P&&(P=W),H>F&&(F=H),W>B&&(B=W)}I=Math.max(F-T,B-P),I=I!==0?32767/I:0}return Pd(y,b,n,T,P,I,0),b}function qg(o,e,n,l,p){let y;if(p===(function(b,T,P,I){let F=0;for(let B=T,N=P-I;B<P;B+=I)F+=(b[N]-b[B])*(b[B+1]+b[N+1]),N=B;return F})(o,e,n,l)>0)for(let b=e;b<n;b+=l)y=Yg(b/l|0,o[b],o[b+1],y);else for(let b=n-l;b>=e;b-=l)y=Yg(b/l|0,o[b],o[b+1],y);return y&&Id(y,y.next)&&(im(y),y=y.next),y}function Ah(o,e){if(!o)return o;e||(e=o);let n,l=o;do if(n=!1,l.steiner||!Id(l,l.next)&&rn(l.prev,l,l.next)!==0)l=l.next;else{if(im(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function Pd(o,e,n,l,p,y,b){if(!o)return;!b&&y&&(function(P,I,F,B){let N=P;do N.z===0&&(N.z=Qp(N.x,N.y,I,F,B)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==P);N.prevZ.nextZ=null,N.prevZ=null,(function(H){let W,ne=1;do{let ue,ae=H;H=null;let fe=null;for(W=0;ae;){W++;let ye=ae,be=0;for(let Re=0;Re<ne&&(be++,ye=ye.nextZ,ye);Re++);let Ie=ne;for(;be>0||Ie>0&&ye;)be!==0&&(Ie===0||!ye||ae.z<=ye.z)?(ue=ae,ae=ae.nextZ,be--):(ue=ye,ye=ye.nextZ,Ie--),fe?fe.nextZ=ue:H=ue,ue.prevZ=fe,fe=ue;ae=ye}fe.nextZ=null,ne*=2}while(W>1)})(N)})(o,l,p,y);let T=o;for(;o.prev!==o.next;){const P=o.prev,I=o.next;if(y?d0(o,l,p,y):h0(o))e.push(P.i,o.i,I.i),im(o),o=I.next,T=I.next;else if((o=I)===T){b?b===1?Pd(o=i_(Ah(o),e),e,n,l,p,y,2):b===2&&Wg(o,e,n,l,p,y):Pd(Ah(o),e,n,l,p,y,1);break}}}function h0(o){const e=o.prev,n=o,l=o.next;if(rn(e,n,l)>=0)return!1;const p=e.x,y=n.x,b=l.x,T=e.y,P=n.y,I=l.y,F=Math.min(p,y,b),B=Math.min(T,P,I),N=Math.max(p,y,b),H=Math.max(T,P,I);let W=l.next;for(;W!==e;){if(W.x>=F&&W.x<=N&&W.y>=B&&W.y<=H&&Of(p,T,y,P,b,I,W.x,W.y)&&rn(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function d0(o,e,n,l){const p=o.prev,y=o,b=o.next;if(rn(p,y,b)>=0)return!1;const T=p.x,P=y.x,I=b.x,F=p.y,B=y.y,N=b.y,H=Math.min(T,P,I),W=Math.min(F,B,N),ne=Math.max(T,P,I),ue=Math.max(F,B,N),ae=Qp(H,W,e,n,l),fe=Qp(ne,ue,e,n,l);let ye=o.prevZ,be=o.nextZ;for(;ye&&ye.z>=ae&&be&&be.z<=fe;){if(ye.x>=H&&ye.x<=ne&&ye.y>=W&&ye.y<=ue&&ye!==p&&ye!==b&&Of(T,F,P,B,I,N,ye.x,ye.y)&&rn(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,be.x>=H&&be.x<=ne&&be.y>=W&&be.y<=ue&&be!==p&&be!==b&&Of(T,F,P,B,I,N,be.x,be.y)&&rn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;ye&&ye.z>=ae;){if(ye.x>=H&&ye.x<=ne&&ye.y>=W&&ye.y<=ue&&ye!==p&&ye!==b&&Of(T,F,P,B,I,N,ye.x,ye.y)&&rn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;be&&be.z<=fe;){if(be.x>=H&&be.x<=ne&&be.y>=W&&be.y<=ue&&be!==p&&be!==b&&Of(T,F,P,B,I,N,be.x,be.y)&&rn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function i_(o,e){let n=o;do{const l=n.prev,p=n.next.next;!Id(l,p)&&em(l,n,n.next,p)&&tm(l,p)&&tm(p,l)&&(e.push(l.i,n.i,p.i),im(n),im(n.next),n=o=p),n=n.next}while(n!==o);return Ah(n)}function Wg(o,e,n,l,p,y){let b=o;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&Jp(b,T)){let P=Dd(b,T);return b=Ah(b,b.next),P=Ah(P,P.next),Pd(b,e,n,l,p,y,0),void Pd(P,e,n,l,p,y,0)}T=T.next}b=b.next}while(b!==o)}function Zg(o,e){let n=o.x-e.x;return n===0&&(n=o.y-e.y,n===0)&&(n=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function f0(o,e){const n=(function(p,y){let b=y;const T=p.x,P=p.y;let I,F=-1/0;if(Id(p,b))return b;do{if(Id(p,b.next))return b.next;if(P<=b.y&&P>=b.next.y&&b.next.y!==b.y){const ne=b.x+(P-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(ne<=T&&ne>F&&(F=ne,I=b.x<b.next.x?b:b.next,ne===T))return I}b=b.next}while(b!==y);if(!I)return null;const B=I,N=I.x,H=I.y;let W=1/0;b=I;do{if(T>=b.x&&b.x>=N&&T!==b.x&&Xg(P<H?T:F,P,N,H,P<H?F:T,P,b.x,b.y)){const ne=Math.abs(P-b.y)/(T-b.x);tm(b,p)&&(ne<W||ne===W&&(b.x>I.x||b.x===I.x&&El(I,b)))&&(I=b,W=ne)}b=b.next}while(b!==B);return I})(o,e);if(!n)return e;const l=Dd(n,o);return Ah(l,l.next),Ah(n,n.next)}function El(o,e){return rn(o.prev,o,e.prev)<0&&rn(e.next,o,o.next)<0}function Qp(o,e,n,l,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-n)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function r_(o){let e=o,n=o;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==o);return n}function Xg(o,e,n,l,p,y,b,T){return(p-b)*(e-T)>=(o-b)*(y-T)&&(o-b)*(l-T)>=(n-b)*(e-T)&&(n-b)*(y-T)>=(p-b)*(l-T)}function Of(o,e,n,l,p,y,b,T){return!(o===b&&e===T)&&Xg(o,e,n,l,p,y,b,T)}function Jp(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(n,l){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==l.i&&p.next.i!==l.i&&em(p,p.next,n,l))return!0;p=p.next}while(p!==n);return!1})(o,e)&&(tm(o,e)&&tm(e,o)&&(function(n,l){let p=n,y=!1;const b=(n.x+l.x)/2,T=(n.y+l.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&b<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==n);return y})(o,e)&&(rn(o.prev,o,e.prev)||rn(o,e.prev,e))||Id(o,e)&&rn(o.prev,o,o.next)>0&&rn(e.prev,e,e.next)>0)}function rn(o,e,n){return(e.y-o.y)*(n.x-e.x)-(e.x-o.x)*(n.y-e.y)}function Id(o,e){return o.x===e.x&&o.y===e.y}function em(o,e,n,l){const p=Jm(rn(o,e,n)),y=Jm(rn(o,e,l)),b=Jm(rn(n,l,o)),T=Jm(rn(n,l,e));return p!==y&&b!==T||!(p!==0||!Sl(o,n,e))||!(y!==0||!Sl(o,l,e))||!(b!==0||!Sl(n,o,l))||!(T!==0||!Sl(n,e,l))}function Sl(o,e,n){return e.x<=Math.max(o.x,n.x)&&e.x>=Math.min(o.x,n.x)&&e.y<=Math.max(o.y,n.y)&&e.y>=Math.min(o.y,n.y)}function Jm(o){return o>0?1:o<0?-1:0}function tm(o,e){return rn(o.prev,o,o.next)<0?rn(o,e,o.next)>=0&&rn(o,o.prev,e)>=0:rn(o,e,o.prev)<0||rn(o,o.next,e)<0}function Dd(o,e){const n=Kg(o.i,o.x,o.y),l=Kg(e.i,e.x,e.y),p=o.next,y=e.prev;return o.next=e,e.prev=o,n.next=p,p.prev=n,l.next=n,n.prev=l,y.next=l,l.prev=y,l}function Yg(o,e,n,l){const p=Kg(o,e,n);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function im(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Kg(o,e,n){return{i:o,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function rm(o,e){const n=o.length;if(n<=1)return[o];const l=[];let p,y;for(let b=0;b<n;b++){const T=fn(o[b]);T!==0&&(o[b].area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(p&&l.push(p),p=[o[b]]):p.push(o[b]))}if(p&&l.push(p),e>1)for(let b=0;b<l.length;b++)l[b].length<=e||(Uh(l[b],e,1,l[b].length-1,p0),l[b]=l[b].slice(0,e));return l}function p0(o,e){return e.area-o.area}function n_(o,e,n=1){if(!o)return null;const l=typeof o=="string"?xa.from(o).getPrimary():o.getPrimary(),p=typeof o=="string"?null:o.getSecondary();for(const y of[l,p]){if(!y)continue;const b=y.id.toString();e.has(b)||e.set(b,[]),y.scaleSelf(n),e.get(b).push(y)}return{primary:l.toString(),secondary:p?p.toString():null}}function Qg(o,e,n,l){const p=l.patternDependencies;let y=!1;for(const b of e){const T=b.paint.get(`${o}-pattern`);T.isConstant()||(y=!0),n_(T.constantOr(null),p,n)&&(y=!0)}return y}function Jg(o,e,n,l,p,y){const b=y.patternDependencies;for(const T of e){const P=T.paint.get(`${o}-pattern`).value;if(P.kind!=="constant"){let I=P.evaluate({zoom:l},n,{},y.availableImages);I=I&&I.name?I.name:I;const F=n_(I,b,p);if(!F)continue;const{primary:B,secondary:N}=F;B&&(n.patterns[T.id]=[B,N].filter(Boolean))}}return n}class Dc{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=$t&&n>=$t}static evaluate(e){if(e.length===0)return new Dc;let n=[];for(const P of e)n.push(...P.portals);if(n.length===0)return new Dc;for(const P of n){const I=P.va,F=P.vb;(Dc.isOnBorder(I.x,F.x)||Dc.isOnBorder(I.y,F.y))&&(P.type="border")}const l=n.filter(P=>P.type!=="unevaluated"),p=n.filter(P=>P.type==="unevaluated");if(p.length===0)return new Dc;p.sort((P,I)=>P.hash===I.hash?P.isTunnel===I.isTunnel?0:P.isTunnel?-1:1:P.hash<I.hash?1:-1),n=l.concat(p);let y=l.length,b=y,T=y;do if(b++,b===n.length||n[y].hash!==n[b].hash){if(b-y===2){T<y&&(n[T]=n[y],n[y]=null);const P=n[T],I=n[b-1];P.type=P.isTunnel!==I.isTunnel?"tunnel":"polygon",P.connection={a:P.connection.a,b:I.connection.a},T++}y=b}while(y!==n.length);return n.splice(T),n.sort((P,I)=>P.hash<I.hash?1:-1),{portals:n}}}Ut(Dc,"ElevationPortalGraph");class zf{constructor(e,n,l){this.outPositions=e,this.outNormals=n,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,n,l){let p=e[2];l!=null&&(p*=l);const y=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,b=this.vertexLookup.get(y);if(b!=null)return b;const T=this.outPositions.length;this.vertexLookup.set(y,T);const P=Math.trunc(16384*n[0]),I=Math.trunc(16384*n[1]),F=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],p),this.outNormals.emplaceBack(P,I,F),T}addTriangle(e,n,l){this.outIndices.emplaceBack(e,n,l)}addTriangles(e,n,l){if(e.length===0)return;const p=l.length===1,y=Bt(),b=Bt();for(let T=0;T<e.length;T+=3){const P=n[e[T+0]],I=n[e[T+1]],F=n[e[T+2]],B=p?l[0]:l[e[T+1]],N=p?l[0]:l[e[T+2]];Fe(y,P.x,P.y,p?l[0]:l[e[T+0]]);const H=this.addVertex(y,b);Fe(y,I.x,I.y,B);const W=this.addVertex(y,b);Fe(y,F.x,F.y,N);const ne=this.addVertex(y,b);this.outIndices.emplaceBack(H,W,ne)}}addQuad(e,n,l,p,y,b){const T=this.addVertex(e,y,b),P=this.addVertex(n,y,b),I=this.addVertex(l,y,b),F=this.addVertex(p,y,b);this.addTriangle(T,P,I),this.addTriangle(I,F,T)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ra{constructor(e,n,l,p){this.unevaluatedPortals=new Dc,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new uh,this.vertexNormals=new wd,this.indexArray=new qn,this.tileToMeters=Lt(e),this.bridgeProgramConfigurations=new $(n,{zoom:l,lut:p},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new $(n,{zoom:l,lut:p},y=>y!=="fill-bridge-guard-rail-color")}addVertices(e,n){const l=this.unevalVertices.length;for(let p=0;p<e.length;p++)this.unevalVertices.push(e[p]),this.unevalHeights.push(n[p]);return l}addTriangles(e,n,l){const p=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of e)p.push(y+n)}addRenderableRing(e,n,l,p,y,b){const T=[new Pt(y.min.x,y.min.y),new Pt(y.max.x,y.min.y),new Pt(y.max.x,y.max.y),new Pt(y.min.x,y.max.y)];for(let P=0;P<l-1;P++){const I=n+P,F=I+1,B=this.unevalVertices[I],N=this.unevalVertices[F];if(!(B.x>=y.min.x&&B.x<=y.max.x&&B.y>=y.min.y&&B.y<=y.max.y||N.x>=y.min.x&&N.x<=y.max.x&&N.y>=y.min.y&&N.y<=y.max.y||Xo(B,N,T))||this.isOnBorder(B.x,N.x)||this.isOnBorder(B.y,N.y))continue;const H=ra.computeEdgeHash(this.unevalVertices[I],this.unevalVertices[F]);let W,ne=this.vertexHashLookup.get(ra.computePosHash(B));ne!=null?W=ne.next:(ne=this.vertexHashLookup.get(ra.computePosHash(N)),W=ne!=null?ne.prev:H),this.unevalEdges.push({polygonIdx:e,a:I,b:F,hash:H,portalHash:W,isTunnel:p,type:"unevaluated",featureInfo:b})}}addPortalCandidates(e,n,l,p,y){if(n.length!==0){this.vertexHashLookup.clear();for(const b of n){if(b.length===0)continue;const T=b[0];let P=ra.computeEdgeHash(T[T.length-2],T[T.length-1]);for(let I=0;I<T.length-1;I++){const F=T[I+0],B=T[I+1],N=$n(B.x-F.x,B.y-F.y),H=Wa(N);if(H===0)continue;let W="unevaluated";const ne=p.pointElevation(F),ue=p.pointElevation(B);Math.abs(ne)<.01&&Math.abs(ue)<.01?W="entrance":(this.isOnBorder(F.x,B.x)||this.isOnBorder(F.y,B.y))&&(W="border");const ae=ra.computeEdgeHash(F,B);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:F,vb:B,vab:N,length:H,hash:ae,isTunnel:l,type:W});const fe=ra.computePosHash(F);this.vertexHashLookup.set(fe,{prev:P,next:ae}),P=ae}}}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},p=new zf(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const y=n(),b=n(),T=n(),P=(N,H)=>{N.sort((ne,ue)=>ne.type===H&&ue.type!==H?-1:ne.type!==H&&ue.type===H?1:0);const W=N.findIndex(ne=>ne.type!==H);return W>=0?W:N.length};let I=0;this.unevalEdges.length>0&&(I=P(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters)),l(T);const F=n(),B=n();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(I),H=P(N,"tunnel")+I;this.unevalEdges.push(...N),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:H})}l(F),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(B),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(b),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(y),this.maskSegments=$r.simpleSegment(0,B.primitiveOffset,0,B.primitiveLength),this.depthSegments=$r.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableBridgeSegments=$r.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableTunnelSegments=$r.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.shadowCasterSegments=$r.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(e,n,l,p,y,b,T,P){this.bridgeProgramConfigurations.updatePaintArrays(e,n,y,l,p,b,T,P),this.tunnelProgramConfigurations.updatePaintArrays(e,n,y,l,p,b,T,P)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,c0.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,u0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,l,p,y){const b=(T,P)=>{for(let I=0;I<P.length-1;I++){const F=P[I].featureIndex,B=P[I+1].vertexStart,N=e.feature(F);T.populatePaintArrays(B,N,F,{},l,n,p,void 0,y)}};b(this.bridgeProgramConfigurations,this.bridgeFeatureSections),b(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,l,p,y){const b=new Map;for(let T=p;T<y;T++){const P=l[T],I=P.a,F=P.b,B=ra.computePosHash(e[I]),N=ra.computePosHash(e[F]);let H=b.get(B);H||(H={},b.set(B,H));let W=b.get(N);W||(W={},b.set(N,W)),n[I]<=0&&n[F]<=0||(H.to=F,W.from=I)}return b}isTerminalVertex(e,n){const l=ra.computePosHash(this.unevalVertices[e]),p=n.get(l);return!p||!p.from||!p.to}constructBridgeStructures(e,n,l,p,y,b){e.clearVertexLookup();const T=this.computeVertexConnections(n,l,p,y.min,y.max),P=1/b,I=.5*P,F=(Tt,Et)=>Fe(Tt,n[Et].x,n[Et].y,l[Et]*P),B=Bt(),N=Bt(),H=Bt(),W=Bt(),ne=Bt(),ue=(Tt,Et)=>{const St=T.get(ra.computePosHash(n[Et])),ht=St.from,Rt=St.to;if(!ht||!Rt)return;F(B,ht),F(N,Et),F(H,Rt),Wn(W),vn(B,N)||(Sr(ne,N,B),vi(W,ne)),vn(H,N)||(Sr(ne,H,N),pe(W,W,vi(ne,ne)));const vt=es(W);return vt>0?ct(Tt,W,1/vt):void 0};let ae=Number.POSITIVE_INFINITY;this.sortSubarray(p,y.min,y.max,(Tt,Et)=>Tt.featureInfo.featureIndex-Et.featureInfo.featureIndex);const fe=Bt(),ye=Bt(),be=Bt(),Ie=Bt(),Re=Bt(),Ne=Bt(),Ve=Bt(),Be=Bt(),He=Bt(),Ye=[Bt(),Bt(),Bt(),Bt()],yt=[Bt(),Bt(),Bt(),Bt()],ft=[{coord:new Pt(0,0),height:0},{coord:new Pt(0,0),height:0}],gt=(Tt,Et)=>Tt>Et;for(let Tt=y.min;Tt<y.max;Tt++){const Et=p[Tt];if(!Et.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ft,n,l,Et,gt))continue;const[St,ht]=ft;if(Fe(fe,St.coord.x,St.coord.y,P*St.height),Fe(ye,ht.coord.x,ht.coord.y,P*ht.height),vn(fe,ye))continue;Sr(be,ye,fe),vi(be,be);const Rt=ue(Be,Et.a)||be,vt=ue(He,Et.b)||be;Fe(Ie,Rt[1],-Rt[0],0),vi(Ie,Ie),Fe(Re,vt[1],-vt[0],0),vi(Re,Re),lr(Be,Ie,Rt),vi(Ne,Be),lr(Be,Re,vt),vi(Ve,Be),pe(Ye[0],fe,ct(Be,Sr(Be,Ie,Ne),I)),pe(Ye[1],fe,ct(Be,pe(Be,Ie,Ne),I)),pe(Ye[2],fe,ct(Be,Ne,I)),Ye[3]=fe,pe(yt[0],ye,ct(Be,Sr(Be,Re,Ve),I)),pe(yt[1],ye,ct(Be,pe(Be,Re,Ve),I)),pe(yt[2],ye,ct(Be,Ve,I)),yt[3]=ye,ae=this.addFeatureSection(Et.featureInfo.featureIndex,ae,this.bridgeFeatureSections,e);const Mt=e.addVertex(Ye[0],Ie,b),At=e.addVertex(Ye[1],Ie,b),ti=e.addVertex(yt[0],Re,b),ri=e.addVertex(yt[1],Re,b);e.addTriangle(Mt,At,ti),e.addTriangle(At,ri,ti);const Zt=e.addVertex(Ye[1],Ne,b),Kt=e.addVertex(Ye[2],Ne,b),Ei=e.addVertex(yt[1],Ve,b),pi=e.addVertex(yt[2],Ve,b);e.addTriangle(Zt,Kt,Ei),e.addTriangle(Kt,pi,Ei),zi(Ie,Ie),zi(Re,Re);const ei=e.addVertex(Ye[2],Ie,b),ki=e.addVertex(Ye[3],Ie,b),Qi=e.addVertex(yt[2],Re,b),yr=e.addVertex(yt[3],Re,b);e.addTriangle(ei,ki,Qi),e.addTriangle(ki,yr,Qi);const Wi=this.isTerminalVertex(Et.a,T),Ir=this.isTerminalVertex(Et.b,T);St.height<.01&&Wi&&e.addQuad(Ye[3],Ye[2],Ye[1],Ye[0],zi(Rt,Rt),b),ht.height<.01&&Ir&&e.addQuad(yt[0],yt[1],yt[2],yt[3],vt,b)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,l,p,y,b){e.clearVertexLookup();let T=Number.POSITIVE_INFINITY;const P=(ae,fe)=>ae.featureInfo.featureIndex-fe.featureInfo.featureIndex;this.sortSubarray(p,y.min,y.max,P),this.sortSubarray(p,b.min,b.max,P);const I=ae=>vi(ae,ae),F=[{coord:new Pt(0,0),height:0},{coord:new Pt(0,0),height:0}],B=(ae,fe)=>ae<fe,N=Bt(),H=Bt(),W=Bt(),ne=Bt(),ue=Bt();for(let ae=y.min;ae<y.max;ae++){if(!this.prepareEdgePoints(F,n,l,p[ae],B))continue;const[fe,ye]=F,be=I(Fe(ue,-(ye.coord.y-fe.coord.y),ye.coord.x-fe.coord.x,0));T=this.addFeatureSection(p[ae].featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad(Fe(N,fe.coord.x,fe.coord.y,fe.height),Fe(H,ye.coord.x,ye.coord.y,ye.height),Fe(W,ye.coord.x,ye.coord.y,p[ae].isTunnel?-.1:0),Fe(ne,fe.coord.x,fe.coord.y,p[ae].isTunnel?-.1:0),be)}for(let ae=b.min;ae<b.max;ae++){const fe=p[ae];fe.isTunnel&&([fe.a,fe.b]=[fe.b,fe.a]);const ye=n[fe.a],be=n[fe.b],Ie=I(Fe(ue,-(be.y-ye.y),be.x-ye.x,0));T=this.addFeatureSection(fe.featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad(Fe(N,be.x,be.y,0),Fe(H,ye.x,ye.y,0),Fe(W,ye.x,ye.y,l[fe.a]+4),Fe(ne,be.x,be.y,l[fe.b]+4),Ie),e.addQuad(Fe(N,ye.x,ye.y,0),Fe(H,be.x,be.y,0),Fe(W,be.x,be.y,l[fe.b]+4),Fe(ne,ye.x,ye.y,l[fe.a]+4),Ie)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,l,p){e.coord.x=n,e.coord.y=l,e.height=p}prepareEdgePoints(e,n,l,p,y){let b=n[p.a].x,T=n[p.a].y,P=n[p.b].x,I=n[p.b].y,F=l[p.a],B=l[p.b];const N=y(F,0),H=y(B,0);if(N&&H)return this.setElevatedPoint(e[0],b,T,F),this.setElevatedPoint(e[1],P,I,B),!0;if(!N&&!H)return!1;if(N){if(!H){const W=B/(B-F);P=Ri(P,b,W),I=Ri(I,T,W),B=Ri(B,F,W)}}else{const W=F/(F-B);b=Ri(b,P,W),T=Ri(T,I,W),F=Ri(F,B,W)}return this.setElevatedPoint(e[0],b,T,F),this.setElevatedPoint(e[1],P,I,B),!0}prepareEdges(e,n){if(n.length===0)return;n.sort((T,P)=>T.hash===P.hash?P.polygonIdx-T.polygonIdx:P.hash>T.hash?1:-1);let l=0,p=0,y=0,b=n[l].polygonIdx;do p++,(p===n.length||n[l].hash!==n[p].hash)&&((p-l===1||n[p-1].polygonIdx!==b)&&(y<l&&(n[y]=n[l],n[l]=null),n[y].type="none",y++),l=p,l!==n.length&&(b=n[l].polygonIdx));while(l!==n.length);if(n.splice(y),n.length!==0&&e.length!==0){n.sort((I,F)=>I.portalHash<F.portalHash?1:-1);let T=0,P=0;for(;T!==n.length&&P!==e.length;){const I=n[T],F=e[P];I.portalHash>F.hash?T++:F.hash>I.portalHash?P++:(I.type=F.type,T++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=$t&&n>=$t}addFeatureSection(e,n,l,p){return e!==n&&(n=e,l.push({featureIndex:e,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),n}sortSubarray(e,n,l,p){const y=e.slice(n,l);y.sort(p),e.splice(n,y.length,...y)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(ra.computePosHash(e))<<32n|BigInt(ra.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function s_(o,e){return o>e?1:o<e?-1:0}class ey{constructor(e=s_,n=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n}rotateLeft(e){var n=e.right;n&&(e.right=n.left,n.left&&(n.left.parent=e),n.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.left=e),e.parent=n}rotateRight(e){var n=e.left;n&&(e.left=n.right,n.right&&(n.right.parent=e),n.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.right=e),e.parent=n}_splay(e){for(;e.parent;){var n=e.parent;n.parent?n.left===e&&n.parent.left===n?(this.rotateRight(n.parent),this.rotateRight(n)):n.right===e&&n.parent.right===n?(this.rotateLeft(n.parent),this.rotateLeft(n)):n.left===e&&n.parent.right===n?(this.rotateRight(n),this.rotateLeft(n)):(this.rotateLeft(n),this.rotateRight(n)):n.left===e?this.rotateRight(n):this.rotateLeft(n)}}splay(e){for(var n,l,p,y,b;e.parent;)(l=(n=e.parent).parent)&&l.parent?((p=l.parent).left===l?p.left=e:p.right=e,e.parent=p):(e.parent=null,this._root=e),y=e.left,b=e.right,e===n.left?(l&&(l.left===n?(n.right?(l.left=n.right,l.left.parent=l):l.left=null,n.right=l,l.parent=n):(y?(l.right=y,y.parent=l):l.right=null,e.left=l,l.parent=e)),b?(n.left=b,b.parent=n):n.left=null,e.right=n,n.parent=e):(l&&(l.right===n?(n.left?(l.right=n.left,l.right.parent=l):l.right=null,n.left=l,l.parent=n):(b?(l.left=b,b.parent=l):l.left=null,e.right=l,l.parent=e)),y?(n.right=y,y.parent=n):n.right=null,e.left=n,n.parent=e)}replace(e,n){e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,n){var l=this._root,p=null,y=this._compare;if(this._noDuplicates)for(;l;){if(p=l,y(l.key,e)===0)return;l=y(l.key,e)<0?l.right:l.left}else for(;l;)p=l,l=y(l.key,e)<0?l.right:l.left;return l={key:e,data:n,left:null,right:null,parent:p},p?y(p.key,l.key)<0?p.right=l:p.left=l:this._root=l,this.splay(l),this._size++,l}find(e){for(var n=this._root,l=this._compare;n;){var p=l(n.key,e);if(p<0)n=n.right;else{if(!(p>0))return n;n=n.left}}return null}contains(e){for(var n=this._root,l=this._compare;n;){var p=l(e,n.key);if(p===0)return!0;n=p<0?n.left:n.right}return!1}remove(e){var n=this.find(e);if(!n)return!1;if(this.splay(n),n.left)if(n.right){var l=this.minNode(n.right);l.parent!==n&&(this.replace(l,l.right),l.right=n.right,l.right.parent=l),this.replace(n,l),l.left=n.left,l.left.parent=l}else this.replace(n,n.left);else this.replace(n,n.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var n=this.find(e);if(n){this.splay(n);var l=n.left,p=n.right,y=null;l&&(l.parent=null,y=this.maxNode(l),this.splay(y),this._root=y),p&&(l?y.right=p:this._root=p,p.parent=y),this._size--}}pop(){var e=this._root,n=null;if(e){for(;e.left;)e=e.left;n={key:e.key,data:e.data},this.remove(e.key)}return n}next(e){var n=e;if(n)if(n.right)for(n=n.right;n&&n.left;)n=n.left;else for(n=e.parent;n&&n.right===e;)e=n,n=n.parent;return n}prev(e){var n=e;if(n)if(n.left)for(n=n.left;n&&n.right;)n=n.right;else for(n=e.parent;n&&n.left===e;)e=n,n=n.parent;return n}forEach(e){for(var n=this._root,l=[],p=!1,y=0;!p;)n?(l.push(n),n=n.left):l.length>0?(e(n=l.pop(),y++),n=n.right):p=!0;return this}range(e,n,l,p){const y=[],b=this._compare;let T,P=this._root;for(;y.length!==0||P;)if(P)y.push(P),P=P.left;else{if(P=y.pop(),T=b(P.key,n),T>0)break;if(b(P.key,e)>=0&&l.call(p,P))return this;P=P.right}return this}keys(){for(var e=this._root,n=[],l=[],p=!1;!p;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),l.push(e.key),e=e.right):p=!0;return l}values(){for(var e=this._root,n=[],l=[],p=!1;!p;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),l.push(e.data),e=e.right):p=!0;return l}at(e){for(var n=this._root,l=[],p=!1,y=0;!p;)if(n)l.push(n),n=n.left;else if(l.length>0){if(n=l.pop(),y===e)return n;y++,n=n.right}else p=!0;return null}load(e=[],n=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const p=e.length;return l&&kd(e,n,0,p-1,this._compare),this._root=Ch(null,e,n,0,p),this._size=p,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,n,l,p,y){return new ey(l,y).load(e,n,p)}}function Ch(o,e,n,l,p){const y=p-l;if(y>0){const b=l+Math.floor(y/2),T={key:e[b],data:n[b],parent:o};return T.left=Ch(T,e,n,l,b),T.right=Ch(T,e,n,b+1,p),T}return null}function kd(o,e,n,l,p){if(n>=l)return;const y=o[n+l>>1];let b=n-1,T=l+1;for(;;){do b++;while(p(o[b],y)<0);do T--;while(p(o[T],y)>0);if(b>=T)break;let P=o[b];o[b]=o[T],o[T]=P,P=e[b],e[b]=e[T],e[T]=P}kd(o,e,n,T,p),kd(o,e,T+1,l,p)}const ty=11102230246251565e-32,na=134217729,iy=(3+8*ty)*ty;function sm(o,e,n,l,p){let y,b,T,P,I=e[0],F=l[0],B=0,N=0;F>I==F>-I?(y=I,I=e[++B]):(y=F,F=l[++N]);let H=0;if(B<o&&N<n)for(F>I==F>-I?(b=I+y,T=y-(b-I),I=e[++B]):(b=F+y,T=y-(b-F),F=l[++N]),y=b,T!==0&&(p[H++]=T);B<o&&N<n;)F>I==F>-I?(b=y+I,P=b-y,T=y-(b-P)+(I-P),I=e[++B]):(b=y+F,P=b-y,T=y-(b-P)+(F-P),F=l[++N]),y=b,T!==0&&(p[H++]=T);for(;B<o;)b=y+I,P=b-y,T=y-(b-P)+(I-P),I=e[++B],y=b,T!==0&&(p[H++]=T);for(;N<n;)b=y+F,P=b-y,T=y-(b-P)+(F-P),F=l[++N],y=b,T!==0&&(p[H++]=T);return y===0&&H!==0||(p[H++]=y),H}function Rh(o){return new Float64Array(o)}const Ld=Rh(4),ry=Rh(8),a_=Rh(12),ny=Rh(16),no=Rh(4);function Od(o,e,n){e===null?(o.inOut=!1,o.otherInOut=!0):(o.isSubject===e.isSubject?(o.inOut=!e.inOut,o.otherInOut=e.otherInOut):(o.inOut=!e.otherInOut,o.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(o.prevInResult=!o_(e,n)||e.isVertical()?e.prevInResult:e)),o.resultTransition=o_(o,n)?(function(l,p){let y,b=!l.inOut,T=!l.otherInOut;switch(p){case 0:y=b&&T;break;case 1:y=b||T;break;case 3:y=b!==T;break;case 2:y=l.isSubject?b&&!T:T&&!b}return y?1:-1})(o,n):0}function o_(o,e){switch(o.type){case 0:switch(e){case 0:return!o.otherInOut;case 1:return o.otherInOut;case 2:return o.isSubject&&o.otherInOut||!o.isSubject&&!o.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class Eu{constructor(e,n,l,p,y){this.left=n,this.point=e,this.otherEvent=l,this.isSubject=p??!1,this.type=y||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const n=this.point,l=this.otherEvent.point;return this.left?(n[0]-e[0])*(l[1]-e[1])-(l[0]-e[0])*(n[1]-e[1])>0:(l[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(l[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new Eu(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Ko(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ff(o,e,n){const l=(function(p,y,b,T,P,I){const F=(y-I)*(b-P),B=(p-P)*(T-I),N=F-B;if(F===0||B===0||F>0!=B>0)return N;const H=Math.abs(F+B);return Math.abs(N)>=33306690738754716e-32*H?N:-(function(W,ne,ue,ae,fe,ye,be){let Ie,Re,Ne,Ve,Be,He,Ye,yt,ft,gt,Tt,Et,St,ht,Rt,vt,Mt,At;const ti=W-fe,ri=ue-fe,Zt=ne-ye,Kt=ae-ye;ht=ti*Kt,He=na*ti,Ye=He-(He-ti),yt=ti-Ye,He=na*Kt,ft=He-(He-Kt),gt=Kt-ft,Rt=yt*gt-(ht-Ye*ft-yt*ft-Ye*gt),vt=Zt*ri,He=na*Zt,Ye=He-(He-Zt),yt=Zt-Ye,He=na*ri,ft=He-(He-ri),gt=ri-ft,Mt=yt*gt-(vt-Ye*ft-yt*ft-Ye*gt),Tt=Rt-Mt,Be=Rt-Tt,Ld[0]=Rt-(Tt+Be)+(Be-Mt),Et=ht+Tt,Be=Et-ht,St=ht-(Et-Be)+(Tt-Be),Tt=St-vt,Be=St-Tt,Ld[1]=St-(Tt+Be)+(Be-vt),At=Et+Tt,Be=At-Et,Ld[2]=Et-(At-Be)+(Tt-Be),Ld[3]=At;let Ei=(function(yr,Wi){let Ir=Wi[0];for(let cr=1;cr<4;cr++)Ir+=Wi[cr];return Ir})(0,Ld),pi=22204460492503146e-32*be;if(Ei>=pi||-Ei>=pi||(Be=W-ti,Ie=W-(ti+Be)+(Be-fe),Be=ue-ri,Ne=ue-(ri+Be)+(Be-fe),Be=ne-Zt,Re=ne-(Zt+Be)+(Be-ye),Be=ae-Kt,Ve=ae-(Kt+Be)+(Be-ye),Ie===0&&Re===0&&Ne===0&&Ve===0)||(pi=11093356479670487e-47*be+iy*Math.abs(Ei),Ei+=ti*Ve+Kt*Ie-(Zt*Ne+ri*Re),Ei>=pi||-Ei>=pi))return Ei;ht=Ie*Kt,He=na*Ie,Ye=He-(He-Ie),yt=Ie-Ye,He=na*Kt,ft=He-(He-Kt),gt=Kt-ft,Rt=yt*gt-(ht-Ye*ft-yt*ft-Ye*gt),vt=Re*ri,He=na*Re,Ye=He-(He-Re),yt=Re-Ye,He=na*ri,ft=He-(He-ri),gt=ri-ft,Mt=yt*gt-(vt-Ye*ft-yt*ft-Ye*gt),Tt=Rt-Mt,Be=Rt-Tt,no[0]=Rt-(Tt+Be)+(Be-Mt),Et=ht+Tt,Be=Et-ht,St=ht-(Et-Be)+(Tt-Be),Tt=St-vt,Be=St-Tt,no[1]=St-(Tt+Be)+(Be-vt),At=Et+Tt,Be=At-Et,no[2]=Et-(At-Be)+(Tt-Be),no[3]=At;const ei=sm(4,Ld,4,no,ry);ht=ti*Ve,He=na*ti,Ye=He-(He-ti),yt=ti-Ye,He=na*Ve,ft=He-(He-Ve),gt=Ve-ft,Rt=yt*gt-(ht-Ye*ft-yt*ft-Ye*gt),vt=Zt*Ne,He=na*Zt,Ye=He-(He-Zt),yt=Zt-Ye,He=na*Ne,ft=He-(He-Ne),gt=Ne-ft,Mt=yt*gt-(vt-Ye*ft-yt*ft-Ye*gt),Tt=Rt-Mt,Be=Rt-Tt,no[0]=Rt-(Tt+Be)+(Be-Mt),Et=ht+Tt,Be=Et-ht,St=ht-(Et-Be)+(Tt-Be),Tt=St-vt,Be=St-Tt,no[1]=St-(Tt+Be)+(Be-vt),At=Et+Tt,Be=At-Et,no[2]=Et-(At-Be)+(Tt-Be),no[3]=At;const ki=sm(ei,ry,4,no,a_);ht=Ie*Ve,He=na*Ie,Ye=He-(He-Ie),yt=Ie-Ye,He=na*Ve,ft=He-(He-Ve),gt=Ve-ft,Rt=yt*gt-(ht-Ye*ft-yt*ft-Ye*gt),vt=Re*Ne,He=na*Re,Ye=He-(He-Re),yt=Re-Ye,He=na*Ne,ft=He-(He-Ne),gt=Ne-ft,Mt=yt*gt-(vt-Ye*ft-yt*ft-Ye*gt),Tt=Rt-Mt,Be=Rt-Tt,no[0]=Rt-(Tt+Be)+(Be-Mt),Et=ht+Tt,Be=Et-ht,St=ht-(Et-Be)+(Tt-Be),Tt=St-vt,Be=St-Tt,no[1]=St-(Tt+Be)+(Be-vt),At=Et+Tt,Be=At-Et,no[2]=Et-(At-Be)+(Tt-Be),no[3]=At;const Qi=sm(ki,a_,4,no,ny);return ny[Qi-1]})(p,y,b,T,P,I,H)})(o[0],o[1],e[0],e[1],n[0],n[1]);return l>0?-1:l<0?1:0}function Mh(o,e){const n=o.point,l=e.point;return n[0]>l[0]?1:n[0]<l[0]?-1:n[1]!==l[1]?n[1]>l[1]?1:-1:(function(p,y,b){return p.left!==y.left?p.left?1:-1:Ff(b,p.otherEvent.point,y.otherEvent.point)!==0?p.isBelow(y.otherEvent.point)?-1:1:!p.isSubject&&y.isSubject?1:-1})(o,e,n)}function Tl(o,e,n){const l=new Eu(e,!1,o,o.isSubject),p=new Eu(e,!0,o.otherEvent,o.isSubject);return Ko(o.point,o.otherEvent.point)&&console.warn("what is that, a collapsed segment?",o),l.contourId=p.contourId=o.contourId,Mh(p,o.otherEvent)>0&&(o.otherEvent.left=!0,p.left=!1),o.otherEvent.otherEvent=p,o.otherEvent=l,n.push(p),n.push(l),n}function eg(o,e){return o[0]*e[1]-o[1]*e[0]}function tg(o,e){return o[0]*e[0]+o[1]*e[1]}function ig(o,e,n){const l=(function(P,I,F,B){const N=[I[0]-P[0],I[1]-P[1]],H=[B[0]-F[0],B[1]-F[1]];function W(Ne,Ve,Be){return[Ne[0]+Ve*Be[0],Ne[1]+Ve*Be[1]]}const ne=[F[0]-P[0],F[1]-P[1]];let ue=eg(N,H),ae=ue*ue;const fe=tg(N,N);if(ae>0){const Ne=eg(ne,H)/ue;if(Ne<0||Ne>1)return null;const Ve=eg(ne,N)/ue;return Ve<0||Ve>1?null:Ne===0||Ne===1?[W(P,Ne,N)]:Ve===0||Ve===1?[W(F,Ve,H)]:[W(P,Ne,N)]}if(ue=eg(ne,N),ae=ue*ue,ae>0)return null;const ye=tg(N,ne)/fe,be=ye+tg(N,H)/fe,Ie=Math.min(ye,be),Re=Math.max(ye,be);return Ie<=1&&Re>=0?Ie===1?[W(P,Ie>0?Ie:0,N)]:Re===0?[W(P,Re<1?Re:1,N)]:[W(P,Ie>0?Ie:0,N),W(P,Re<1?Re:1,N)]:null})(o.point,o.otherEvent.point,e.point,e.otherEvent.point),p=l?l.length:0;if(p===0||p===1&&(Ko(o.point,e.point)||Ko(o.otherEvent.point,e.otherEvent.point))||p===2&&o.isSubject===e.isSubject)return 0;if(p===1)return!Ko(o.point,l[0])&&!Ko(o.otherEvent.point,l[0])&&Tl(o,l[0],n),!Ko(e.point,l[0])&&!Ko(e.otherEvent.point,l[0])&&Tl(e,l[0],n),1;const y=[];let b=!1,T=!1;return Ko(o.point,e.point)?b=!0:Mh(o,e)===1?y.push(e,o):y.push(o,e),Ko(o.otherEvent.point,e.otherEvent.point)?T=!0:Mh(o.otherEvent,e.otherEvent)===1?y.push(e.otherEvent,o.otherEvent):y.push(o.otherEvent,e.otherEvent),b&&T||b?(e.type=1,o.type=e.inOut===o.inOut?2:3,b&&!T&&Tl(y[1].otherEvent,y[0].point,n),2):T?(Tl(y[0],y[1].point,n),3):y[0]!==y[3].otherEvent?(Tl(y[0],y[1].point,n),Tl(y[1],y[2].point,n),3):(Tl(y[0],y[1].point,n),Tl(y[3].otherEvent,y[2].point,n),3)}function l_(o,e){if(o===e)return 0;if(Ff(o.point,o.otherEvent.point,e.point)!==0||Ff(o.point,o.otherEvent.point,e.otherEvent.point)!==0)return Ko(o.point,e.point)?o.isBelow(e.otherEvent.point)?-1:1:o.point[0]===e.point[0]?o.point[1]<e.point[1]?-1:1:Mh(o,e)===1?e.isAbove(o.point)?-1:1:o.isBelow(e.point)?-1:1;if(o.isSubject!==e.isSubject)return o.isSubject?-1:1;{let n=o.point,l=e.point;if(n[0]===l[0]&&n[1]===l[1])return n=o.otherEvent.point,l=e.otherEvent.point,n[0]===l[0]&&n[1]===l[1]?0:(o.contourId??0)>(e.contourId??0)?1:-1}return Mh(o,e)===1?1:-1}class c_{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function sy(o,e,n,l){let p,y=o+1,b=e[o].point;const T=e.length;for(y<T&&(p=e[y].point);y<T&&p[0]===b[0]&&p[1]===b[1];){if(!n[y])return y;y++,y<T&&(p=e[y].point)}for(y=o-1;n[y]&&y>l;)y--;return y}function u_(o,e,n){const l=new c_;if(o.prevInResult!=null){const p=o.prevInResult,y=p.outputContourId;if(p.resultTransition>0){const b=e[y];if(b.holeOf!=null){const T=b.holeOf;e[T].holeIds.push(n),l.holeOf=T,l.depth=e[y].depth}else e[y].holeIds.push(n),l.holeOf=y,l.depth=e[y].depth+1}else l.holeOf=null,l.depth=e[y].depth}else l.holeOf=null,l.depth=0;return l}const ay=Math.max,am=Math.min;let rg=0;function h_(o,e,n,l,p,y){let b,T,P,I,F,B;for(b=0,T=o.length-1;b<T;b++){if(P=o[b],I=o[b+1],F=new Eu(P,!1,void 0,e),B=new Eu(I,!1,F,e),F.otherEvent=B,P[0]===I[0]&&P[1]===I[1])continue;F.contourId=B.contourId=n,y||(F.isExteriorRing=!1,B.isExteriorRing=!1),Mh(F,B)>0?B.left=!0:F.left=!0;const N=P[0],H=P[1];p[0]=am(p[0],N),p[1]=am(p[1],H),p[2]=ay(p[2],N),p[3]=ay(p[3],H),l.push(F),l.push(B)}}const Bf=[];function ng(o,e,n){let l=o,p=e;typeof o[0][0][0]=="number"&&(l=[o]),typeof e[0][0][0]=="number"&&(p=[e]);let y=(function(N,H,W){let ne=null;return N.length*H.length===0&&(W===0?ne=Bf:W===2?ne=N:(W===1||W===3)&&(ne=N.length===0?H:N)),ne})(l,p,n);if(y)return y===Bf?null:y;const b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],P=(function(N,H,W,ne,ue){const ae=new Zc(void 0,Mh);let fe,ye,be,Ie,Re,Ne;for(be=0,Ie=N.length;be<Ie;be++)for(fe=N[be],Re=0,Ne=fe.length;Re<Ne;Re++)ye=Re===0,ye&&rg++,h_(fe[Re],!0,rg,ae,W,ye);for(be=0,Ie=H.length;be<Ie;be++)for(fe=H[be],Re=0,Ne=fe.length;Re<Ne;Re++)ye=Re===0,ue===2&&(ye=!1),ye&&rg++,h_(fe[Re],!1,rg,ae,ne,ye);return ae})(l,p,b,T,n);if(y=(function(N,H,W,ne,ue){let ae=null;return(W[0]>ne[2]||ne[0]>W[2]||W[1]>ne[3]||ne[1]>W[3])&&(ue===0?ae=Bf:ue===2?ae=N:(ue===1||ue===3)&&(ae=N.concat(H))),ae})(l,p,b,T,n),y)return y===Bf?null:y;const I=(function(N,H,W,ne,ue,ae){const fe=new ey(l_),ye=[],be=Math.min(ne[2],ue[2]);let Ie,Re,Ne;for(;N.length!==0;){let Ve=N.pop();if(ye.push(Ve),ae===0&&Ve.point[0]>be||ae===2&&Ve.point[0]>ne[2])break;if(Ve.left){Re=Ie=fe.insert(Ve),Ne=fe.minNode(),Ie=Ie!==Ne?fe.prev(Ie):null,Re=fe.next(Re);const Be=Ie?Ie.key:null;let He;if(Od(Ve,Be,ae),Re&&ig(Ve,Re.key,N)===2&&(Od(Ve,Be,ae),Od(Re.key,Ve,ae)),Ie&&ig(Ie.key,Ve,N)===2){let Ye=Ie;Ye=Ye!==Ne?fe.prev(Ye):null,He=Ye?Ye.key:null,Od(Be,He,ae),Od(Ve,Be,ae)}}else Ve=Ve.otherEvent,Re=Ie=fe.find(Ve),Ie&&Re&&(Ie=Ie!==Ne?fe.prev(Ie):null,Re=fe.next(Re),fe.remove(Ve),Re&&Ie&&ig(Ie.key,Re.key,N))}return ye})(P,0,0,b,T,n),F=(function(N){let H,W;const ne=(function(fe){let ye,be,Ie,Re,Ne;const Ve=[];for(be=0,Ie=fe.length;be<Ie;be++)ye=fe[be],(ye.left&&ye.inResult||!ye.left&&ye.otherEvent.inResult)&&Ve.push(ye);let Be=!1;for(;!Be;)for(Be=!0,be=0,Ie=Ve.length;be<Ie;be++)be+1<Ie&&Mh(Ve[be],Ve[be+1])===1&&(Re=Ve[be],Ve[be]=Ve[be+1],Ve[be+1]=Re,Be=!1);for(be=0,Ie=Ve.length;be<Ie;be++)ye=Ve[be],ye.otherPos=be;for(be=0,Ie=Ve.length;be<Ie;be++)ye=Ve[be],ye.left||(Ne=ye.otherPos,ye.otherPos=ye.otherEvent.otherPos,ye.otherEvent.otherPos=Ne);return Ve})(N),ue={},ae=[];for(H=0,W=ne.length;H<W;H++){if(ue[H])continue;const fe=ae.length,ye=u_(ne[H],ae,fe),be=Ne=>{ue[Ne]=!0,Ne<ne.length&&ne[Ne]&&(ne[Ne].outputContourId=fe)};let Ie=H,Re=H;for(ye.points.push(ne[H].point);be(Ie),Ie=ne[Ie].otherPos,be(Ie),ye.points.push(ne[Ie].point),Ie=sy(Ie,ne,ue,Re),!(Ie==Re||Ie>=ne.length)&&ne[Ie];);ae.push(ye)}return ae})(I),B=[];for(let N=0;N<F.length;N++){let H=F[N];if(H.isExterior()){let W=[H.points];for(let ne=0;ne<H.holeIds.length;ne++)W.push(F[H.holeIds[ne]].points);B.push(W)}}return B}function zd(o,e,n,l){const p=[],y=l===0?(b,T,P,I,F,B)=>{b.push(new Pt(B,P+(B-T)/(I-T)*(F-P)))}:(b,T,P,I,F,B)=>{b.push(new Pt(T+(B-P)/(F-P)*(I-T),B))};for(const b of o){const T=[];for(const P of b){if(P.length<=2)continue;const I=[];for(let N=0;N<P.length-1;N++){const H=P[N].x,W=P[N].y,ne=P[N+1].x,ue=P[N+1].y,ae=l===0?H:W,fe=l===0?ne:ue;ae<e?fe>e&&y(I,H,W,ne,ue,e):ae>n?fe<n&&y(I,H,W,ne,ue,n):I.push(P[N]),fe<e&&ae>=e&&y(I,H,W,ne,ue,e),fe>n&&ae<=n&&y(I,H,W,ne,ue,n)}let F=P[P.length-1];const B=l===0?F.x:F.y;B>=e&&B<=n&&I.push(F),I.length&&(F=I[I.length-1],I[0].x===F.x&&I[0].y===F.y||I.push(I[0]),T.push(I))}T.length&&p.push(T)}return p}function oy(o,e){const n=ng(om(o),om([e]),0);return n==null?[]:Su(n)}function d_(o,e){let l=om(o,65536);const p=[];for(;e.valid();e.next()){const[y,b]=e.get(),T=y.x*65536,P=y.y*65536,I=b.x*65536,F=b.y*65536,B=I-T,N=F-P,H=Math.hypot(B,N);if(H===0)continue;const W=Math.trunc(N/H*3),ne=-Math.trunc(B/H*3);p.push([[[T,P],[I,F],[I+W,F+ne],[T+W,P+ne],[T,P]]])}return p.length>0&&(l=ng(l,p,2)),Su(l,1/65536,128)}function om(o,e=1){return[o.map(n=>n.map(l=>[l.x*e,l.y*e]))]}function Su(o,e=1,n){return o.map(l=>l.map((p,y)=>{const b=p.map(T=>{let P=T[0],I=T[1];return n&&(P=Math.round(P/n)*n,I=Math.round(I/n)*n),new Pt(P*e,I*e)._round()});return y>0&&b.reverse(),b}))}class kc{constructor(e,n){this.layoutVertexArray=new Xl,this.indexArray=new qn,this.lineIndexArray=new io,this.triangleSegments=new $r,this.lineSegments=new $r,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new ds)}update(e,n,l,p,y,b,T,P){this.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,P)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,t_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,l,p,y,b,T){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,p,y,b,void 0,T)}}class Lc{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new kc(e,!1),this.elevationBufferData=new kc(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,p){}populate(e,n,l,p){this.hasPattern=Qg("fill",this.layers,this.pixelRatio,n);const y=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:T,id:P,index:I,sourceLayerIndex:F}of e){const B=this.layers[0]._featureFilter.needGeometry,N=Fi(T,B);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),N,l))continue;const H=y?y.evaluate(N,{},l,n.availableImages):void 0,W={id:P,properties:T.properties,type:T.type,sourceLayerIndex:F,index:I,geometry:B?N.geometry:Ti(T,l,p),patterns:{},sortKey:H};b.push(W)}y&&b.sort((T,P)=>T.sortKey-P.sortKey);for(const T of b){const{geometry:P,index:I,sourceLayerIndex:F}=T;if(this.hasPattern){const B=Jg("fill",this.layers,T,this.zoom,this.pixelRatio,n);this.patternFeatures.push(B)}else this.addFeature(T,P,I,l,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[I].feature,P,I,F,this.index)}}update(e,n,l,p,y,b,T){this.bufferData.update(e,n,l,p,y,b,T,this.worldview),this.elevationBufferData.update(e,n,l,p,y,b,T,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,l,p,y,b,T,this.worldview)}addFeatures(e,n,l,p,y,b){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,n,l,p,b,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,l,p,y,b=[],T,P){const I=rm(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,I,p,l,P):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(e,l,y,b,p,T,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,y,b,p,T,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,n,l,p,y){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,l,p,y,this.worldview))}addElevatedRoadFeature(e,n,l,p,y){const b=new Array,T=Ms.getElevationFeature(e,y);if(!T)return void this.addGeometry(n,this.bufferData);{const I=this.clipPolygonsToTile(n,1);I.length>0&&b.push({polygons:I,elevationFeature:T,elevationTileID:l})}const P={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:p};for(const I of b)if(I.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ra(I.elevationTileID,this.layers,this.zoom,this.lut));const B=I.elevationFeature.isTunnel();let N=0;e.properties.hasOwnProperty(ji)&&(N=+e.properties[ji]),this.elevatedStructures.addPortalCandidates(I.elevationFeature.id,I.polygons,B,I.elevationFeature,N)}I.elevationFeature.constantHeight==null&&(I.polygons=this.prepareElevatedPolygons(I.polygons,I.elevationFeature,I.elevationTileID));const F=new Va(l,I.elevationTileID);this.addElevatedGeometry(I.polygons,F,I.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,P)}}addElevatedGeometry(e,n,l,p,y,b){const T={elevation:l,elevationSampler:n,bias:p,index:y,featureInfo:b},[P,I]=this.addGeometry(e,this.elevationBufferData,T);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:P,max:I}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,P),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,I))}addGeometry(e,n,l){let p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,b=null;l&&(b=l.elevationSampler.constantElevation(l.elevation,l.bias),b!=null&&(p=b,y=b));const T=(P,I,F)=>{if(l!=null)if(I.push(P),b!=null)n.elevatedLayoutVertexArray.emplaceBack(b),F.push(b);else{const B=l.elevationSampler.pointElevation(P,l.elevation,l.bias);n.elevatedLayoutVertexArray.emplaceBack(B),F.push(B),p=Math.min(p,B),y=Math.max(y,B)}};for(const P of e){let I=0;for(const ye of P)I+=ye.length;const F=n.triangleSegments.prepareSegment(I,n.layoutVertexArray,n.indexArray),B=F.vertexLength,N=[],H=[],W=[],ne=[],ue=[],ae=n.layoutVertexArray.length;for(const ye of P){if(ye.length===0)continue;ye!==P[0]&&H.push(N.length/2);const be=n.lineSegments.prepareSegment(ye.length,n.layoutVertexArray,n.lineIndexArray),Ie=be.vertexLength;l&&ue.push(n.layoutVertexArray.length-ae),T(ye[0],W,ne),n.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),n.lineIndexArray.emplaceBack(Ie+ye.length-1,Ie),N.push(ye[0].x),N.push(ye[0].y);for(let Re=1;Re<ye.length;Re++)T(ye[Re],W,ne),n.layoutVertexArray.emplaceBack(ye[Re].x,ye[Re].y),n.lineIndexArray.emplaceBack(Ie+Re-1,Ie+Re),N.push(ye[Re].x),N.push(ye[Re].y);be.vertexLength+=ye.length,be.primitiveLength+=ye.length}const fe=Yo(N,H);for(let ye=0;ye<fe.length;ye+=3)n.indexArray.emplaceBack(B+fe[ye],B+fe[ye+1],B+fe[ye+2]);if(fe.length>0&&l&&this.elevationMode==="hd-road-base"){const ye=l.elevation.isTunnel(),be=l.elevation.safeArea,Ie=this.elevatedStructures.addVertices(W,ne);this.elevatedStructures.addTriangles(fe,Ie,ye);const Re=ue.length;if(Re>0){for(let Ne=0;Ne<Re-1;Ne++)this.elevatedStructures.addRenderableRing(l.index,ue[Ne]+Ie,ue[Ne+1]-ue[Ne],ye,be,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,ue[Re-1]+Ie,W.length-ue[Re-1],ye,be,l.featureInfo)}}F.vertexLength+=I,F.primitiveLength+=fe.length/3}return[p,y]}prepareElevatedPolygons(e,n,l){const p=1/Lt(l),y=[];for(const b of e){const T=d_(b,new Aa(n,p));y.push(...T)}return y}clipPolygonsToTile(e,n){const l=-n,p=-n,y=$t+n,b=$t+n;let T=0;const P=[],I=[];for(;T<e.length;T++){const N=e[T],H=Do(N);(H.min.x>=l&&H.max.x<=y&&H.min.y>=p&&H.max.y<=b?P:I).push(N)}if(P.length===e.length)return e;const F=[new Pt(l,p),new Pt(y,p),new Pt(y,b),new Pt(l,b),new Pt(l,p)],B=P;for(const N of I)B.push(...oy(N,F));return B}}let jf,Nf,Tu,f_;Ut(Lc,"FillBucket",{omit:["layers","patternFeatures"]}),Ut(kc,"FillBufferData"),Ut(ra,"ElevatedStructures");class lm{constructor(e,n,l,p){if(this.triangleCount=n.length/3,this.min=new Pt(0,0),this.max=new Pt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[y,b]=[e[0].clone(),e[0].clone()];for(let B=1;B<e.length;++B){const N=e[B];y.x=Math.min(y.x,N.x),y.y=Math.min(y.y,N.y),b.x=Math.max(b.x,N.x),b.y=Math.max(b.y,N.y)}if(p){const B=Math.ceil(Math.max(b.x-y.x,b.y-y.y)/p);l=Math.max(l,B)}if(l===0)return;this.min=y,this.max=b;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const P=Math.max(T.x,T.y)/l;this.cellsX=Math.max(1,Math.ceil(T.x/P)),this.cellsY=Math.max(1,Math.ceil(T.y/P)),this.xScale=1/P,this.yScale=1/P;const I=[];for(let B=0;B<this.triangleCount;B++){const N=e[n[3*B+0]].sub(this.min),H=e[n[3*B+1]].sub(this.min),W=e[n[3*B+2]].sub(this.min),ne=wo(Math.floor(Math.min(N.x,H.x,W.x)),this.xScale,this.cellsX),ue=wo(Math.floor(Math.max(N.x,H.x,W.x)),this.xScale,this.cellsX),ae=wo(Math.floor(Math.min(N.y,H.y,W.y)),this.yScale,this.cellsY),fe=wo(Math.floor(Math.max(N.y,H.y,W.y)),this.yScale,this.cellsY),ye=new Pt(0,0),be=new Pt(0,0),Ie=new Pt(0,0),Re=new Pt(0,0);for(let Ne=ae;Ne<=fe;++Ne){ye.y=be.y=Ne*P,Ie.y=Re.y=(Ne+1)*P;for(let Ve=ne;Ve<=ue;++Ve)ye.x=Ie.x=Ve*P,be.x=Re.x=(Ve+1)*P,(Vr(N,H,W,ye,be,Re)||Vr(N,H,W,ye,Re,Ie))&&I.push({cellIdx:Ne*this.cellsX+Ve,triIdx:B})}}if(I.length===0)return;I.sort((B,N)=>B.cellIdx-N.cellIdx||B.triIdx-N.triIdx);let F=0;for(;F<I.length;){const B=I[F].cellIdx,N={start:this.payload.length,len:0};for(;F<I.length&&I[F].cellIdx===B;)++N.len,this.payload.push(I[F++].triIdx);this.cells[B]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=wo(e.x-this.min.x,this.xScale,this.cellsX),p=wo(e.y-this.min.y,this.yScale,this.cellsY),y=this.cells[p*this.cellsX+l];if(y){this._lazyInitLookup();for(let b=0;b<y.len;b++){const T=this.payload[y.start+b],P=Math.floor(T/8),I=1<<T%8;if(!(this.lookup[P]&I)&&(this.lookup[P]|=I,n.push(T),n.length===this.triangleCount))return}}}query(e,n,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const p=wo(e.x-this.min.x,this.xScale,this.cellsX),y=wo(n.x-this.min.x,this.xScale,this.cellsX),b=wo(e.y-this.min.y,this.yScale,this.cellsY),T=wo(n.y-this.min.y,this.yScale,this.cellsY);for(let P=b;P<=T;P++)for(let I=p;I<=y;I++){const F=this.cells[P*this.cellsX+I];if(F)for(let B=0;B<F.len;B++){const N=this.payload[F.start+B],H=Math.floor(N/8),W=1<<N%8;if(!(this.lookup[H]&W)&&(this.lookup[H]|=W,l.push(N),l.length===this.triangleCount))return}}}}function wo(o,e,n){return Math.max(0,Math.min(n-1,Math.floor(o*e)))}Ut(lm,"TriangleGridIndex");class p_{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const l of this.footprints)n.push({footprint:l,id:e})}updateAppearances(e,n,l,p){}populate(e,n,l,p){const y=[];for(const{feature:b,id:T,index:P,sourceLayerIndex:I}of e){const F=this.layers[0]._featureFilter.needGeometry,B=Fi(b,F);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),B,l))continue;const N={id:T,properties:b.properties,type:b.type,sourceLayerIndex:I,index:P,geometry:F?B.geometry:Ti(b,l,p),patterns:{}};y.push(N)}for(const b of y){const{geometry:T,index:P,sourceLayerIndex:I}=b;this.addFeature(b,T,P,l,{},n.availableImages,n.brightness),n.featureIndex.insert(e[P].feature,T,P,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,l,p,y,b,T){}destroy(){}addFeature(e,n,l,p,y,b=[],T){for(const P of rm(n,2)){const I=[],F=[],B=[],N=new Pt(1/0,1/0),H=new Pt(-1/0,-1/0);for(const ue of P)if(ue.length!==0){ue!==P[0]&&B.push(F.length/2);for(let ae=0;ae<ue.length;ae++)F.push(ue[ae].x),F.push(ue[ae].y),I.push(ue[ae]),N.x=Math.min(N.x,ue[ae].x),N.y=Math.min(N.y,ue[ae].y),H.x=Math.max(H.x,ue[ae].x),H.y=Math.max(H.y,ue[ae].y)}const W=Yo(F,B),ne=new lm(I,W,8,256);this.footprints.push({vertices:I,indices:W,grid:ne,min:N,max:H})}}}Ut(p_,"ClipBucket",{omit:["layers"]});const m_=Xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sg=Xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),g_=Xi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),m0=Xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ag=Xi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),og=Xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),y_=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Vf}=m_,Uf=Number.MAX_SAFE_INTEGER,ly=Uf-1;function cm(o,e,n,l){return o.order<e||o.order===Uf||!(o.clipMask&n)||(function(p,y){return y.length!==0&&y.find(b=>b===p)===void 0})(l,o.clipScope)}function um(o,e){return o.x-e.x||o.y-e.y}function __(o,e){return um(o.min,e.min)===0&&um(o.max,e.max)===0}function Gf(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function f(o,e){if(o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(o[n].sourceId!==e[n].sourceId||!__(o[n],e[n])||o[n].order!==e[n].order||o[n].clipMask!==e[n].clipMask||!ga(o[n].clipScope,e[n].clipScope))return!1;return!0}function x(o,e,n){const l=1/$t,p=1/(1<<n.canonical.z),y=(e.x*l+n.canonical.x)*p+n.wrap,b=(e.y*l+n.canonical.y)*p;return{min:new Pt((o.x*l+n.canonical.x)*p+n.wrap,(o.y*l+n.canonical.y)*p),max:new Pt(y,b)}}function C(o,e,n){const l=1<<n.canonical.z,p=((e.x-n.wrap)*l-n.canonical.x)*$t,y=(e.y*l-n.canonical.y)*$t;return{min:new Pt(((o.x-n.wrap)*l-n.canonical.x)*$t,(o.y*l-n.canonical.y)*$t),max:new Pt(p,y)}}function L(o,e,n,l,p,y,b){const T=o.indices,P=o.vertices,I=[];for(let F=l;F<l+p;F+=3){const B=e[n[F+0]+y],N=e[n[F+1]+y],H=e[n[F+2]+y],W=Math.min(B.x,N.x,H.x),ne=Math.max(B.x,N.x,H.x),ue=Math.min(B.y,N.y,H.y),ae=Math.max(B.y,N.y,H.y);I.length=0,o.grid.query(new Pt(W,ue),new Pt(ne,ae),I);for(let fe=0;fe<I.length;fe++){const ye=I[fe];if(Vr(P[T[3*ye+0]],P[T[3*ye+1]],P[T[3*ye+2]],B,N,H,b))return!0}}return!1}function q(o,e,n,l){if(!o||!n)return!1;let p=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(n.vertices.length<o.vertices.length)return q(n,l,o,e);const y=e.canonical,b=l.canonical,T=Math.pow(2,b.z-y.z);p=o.vertices.map(P=>new Pt((P.x+y.x*$t)*T-b.x*$t,(P.y+y.y*$t)*T-b.y*$t))}return L(n,p,o.indices,0,o.indices.length,0,0)}function te(o,e,n,l){const p=Math.pow(2,l.z-n.z);return new Pt((o+n.x*$t)*p-l.x*$t,(e+n.y*$t)*p-l.y*$t)}function we(o,e){const n=[];e.grid.queryPoint(o,n);const l=e.indices,p=e.vertices;for(let y=0;y<n.length;y++){const b=n[y];if(Ra([p[l[3*b+0]],p[l[3*b+1]],p[l[3*b+2]]],o))return!0}return!1}const $e=[new Pt(0,0),new Pt($t,0),new Pt($t,$t),new Pt(0,$t)];function mt(o,e){const n=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return Xo(o[0],o[1],$e)?[o]:[];for(let p=0;p<o.length+2;p++){const y=o[p%o.length],b=o[(p+1)%o.length],T=Xo(p===0?o[o.length-1]:o[(p-1)%o.length],y,$e),P=Xo(y,b,$e),I=T||P;I&&l.push(y),I&&P||l.length>0&&(l.length>1&&n.push(l),l=[])}return l.length>1&&n.push(l),n}const Gt=Yi.types,ni=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],di=["fill-extrusion-flood-light-ground-radius"],Ht=Math.pow(2,13),Jt=Math.pow(2,15)-1,Hi=new Pt(0,1),ir=2147483648;function xn(o,e,n,l,p,y,b,T){o.emplaceBack((e<<1)+b,(n<<1)+y,(Math.floor(l*Ht)<<1)+p,Math.round(T))}function Dt(o,e,n){o.emplaceBack(e.x*$t,e.y*$t,n?1:0)}function xt(o,e,n,l,p,y){o.emplaceBack(e.x,e.y,(n.x<<1)+l,(n.y<<1)+p,y)}function Vt(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ui{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ar{constructor(){this.centroidXY=new Pt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Pt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Pt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Pt(this.max.x-this.min.x,this.max.y-this.min.y)}}class an{constructor(){this.acc=new Pt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,l){this.accCount++,this.acc._add(n);let p=!!this.borders;n.x<e.min.x?(e.min.x=n.x,p=!0):n.x>e.max.x&&(e.max.x=n.x,p=!0),n.y<e.min.y?(e.min.y=n.y,p=!0):n.y>e.max.y&&(e.max.y=n.y,p=!0),((n.x===0||n.x===$t)&&n.x===l.x)!=((n.y===0||n.y===$t)&&n.y===l.y)&&this.processBorderOverlap(n,l),p&&this.checkBorderIntersection(n,l)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Ri(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>$t!=e.x>$t&&this.addBorderIntersection(1,Ri(n.y,e.y,($t-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ri(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>$t!=e.y>$t&&this.addBorderIntersection(3,Ri(n.x,e.x,($t-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Pt(0,0):new Pt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function Ki(o,e){const n=o.add(e)._unit(),l=Oe(o.x*n.x+o.y*n.y,-1,1);var p,y,b;return b=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(b)))/4*Jt*((p=o).x*(y=e).y-p.y*y.x<0?-1:1)}const Or=[o=>o.x<0,o=>o.x>$t,o=>o.y<0,o=>o.y>$t];function Zr(o,e,n,l){const p=[4];if(l===0)return p;n._mult(l);const y=o.sub(n),b=e.sub(n),T=[o,e,y,b];for(let P=0;P<4;P++)for(const I of T)if(Or[P](I)){p.push(P);break}return p}class nn{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new is,this.indexArray=new qn,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut},n=>di.includes(n)),this._segments=new $r,this.hiddenByLandmarkVertexArray=new Ad,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $r}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,l,p=!1){const y=e.length;if(y>2){let b=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let P;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const I=e[0],F=e[1];P=Ki(I.sub(e[y-1])._perp()._unit(),F.sub(I)._perp()._unit())}for(let I=0;I<y;I++){const F=I===y-1?0:I+1,B=e[I],N=e[F],H=e[F===y-1?0:F+1],W=N.sub(B)._perp()._unit(),ne=Ki(W,H.sub(N)._perp()._unit()),ue=P,ae=ne;if(g0(B,N,n)||p&&Cx(B,n)&&Cx(N,n)){P=ne;continue}const fe=T.vertexLength;xt(this.vertexArray,B,N,1,1,ue),xt(this.vertexArray,B,N,1,0,ue),xt(this.vertexArray,B,N,0,1,ae),xt(this.vertexArray,B,N,0,0,ae),T.vertexLength+=4;const ye=Zr(B,N,W,l);for(const be of ye)this._segmentToGroundQuads[b].push({id:fe,region:be}),this._segmentToRegionTriCounts[b][be]+=2,T.primitiveLength+=2;P=ne}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let l=0;l<n;l++)this._segmentToGroundQuads[l].sort((p,y)=>p.region-y.region);for(let l=0;l<n;l++){const p=this._segmentToGroundQuads[l],y=e[l],b=this._segmentToRegionTriCounts[l];b.reduce((P,I)=>P+I,0);let T=0;for(let P=0;P<=4;P++){const I=b[P];if(I!==0){let F=this.regionSegments[P];F||(F=this.regionSegments[P]=new $r);const B={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+T,vertexLength:y.vertexLength,primitiveLength:I};F.get().push(B)}T+=I}for(let P=0;P<p.length;P++){const I=p[P].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,l,p,y,b,T){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,l,p,y,b,void 0,T)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,sg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,g_.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,l,p,y,b,T,P){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,l,p,y,b,T,P)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&ir))}updateHiddenByLandmarkRange(e,n,l){if(!this.hasData())return;const p=n+e;if(n!==0){for(let y=e;y<p;++y)this.hiddenByLandmarkVertexArray.emplace(y,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,og.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class tc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qn,this.footprintVertices=new Xl,this.footprintSegments=[],this.layoutVertexArray=new xl,this.centroidVertexArray=new Kl,this.wallVertexArray=new jp,this.indexArray=new qn,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut},n=>ni.includes(n)),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new nn(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,p){}populate(e,n,l,p){this.features=[],this.hasPattern=Qg("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Lt(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:b,index:T,sourceLayerIndex:P}of e){const I=this.layers[0]._featureFilter.needGeometry,F=Fi(y,I);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),F,l))continue;const B={id:b,sourceLayerIndex:P,index:T,geometry:I?F.geometry:Ti(y,l,p),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length,H=Gt[B.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:Jg("fill-extrusion",this.layers,B,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const W of B.geometry)for(const ne of mt(W,H))this.addFeature(y.id,B,[ne],T,l,{},n.availableImages,p,n.brightness);else this.addFeature(y.id,B,B.geometry,T,l,{},n.availableImages,p,n.brightness);n.featureIndex.insert(y,B.geometry,T,P,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,l,p,y,b){for(const{featureId:T,feature:P}of this.features){const I=Gt[P.type]==="Polygon",{geometry:F}=P;if(this.wallMode)for(const B of F)for(const N of mt(B,I))this.addFeature(T,P,[N],P.index,n,l,p,y,b);else this.addFeature(T,P,F,P.index,n,l,p,y,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,l,p,y,b,T){this.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,this.worldview),this.groundEffect.update(e,n,y,l,p,b,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,ag.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,y_.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,m0.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,p,y,b,T,P,I){const F=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,B=[new Pt(0,0),new Pt($t,$t)],N=P.projection,H=N.name==="globe",W=this.wallMode||Gt[n.type]==="Polygon",ne=new an;ne.centroidDataIndex=this.centroidData.length;const ue=new ar;ue.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(ue.buildingId=Number(n.properties.building_id));const ae=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},y)<=0,fe=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},y);let ye;if(ue.height=fe,ue.vertexArrayOffset=this.layoutVertexArray.length,ue.groundVertexArrayOffset=this.groundEffect.vertexArray.length,H&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fu),this.wallMode){if(H)return void Pi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;ye=(function(He){const Ye=He[0].x===He[He.length-1].x&&He[0].y===He[He.length-1].y;(function(Zt){let Kt=0;const Ei=Zt.length;for(let pi=0;pi<Ei;pi++)Kt+=(Zt[(pi+1)%Ei].x-Zt[pi].x)*(Zt[(pi+1)%Ei].y+Zt[pi].y);return Kt>=0})(He)||(He=He.reverse());const ft={geometry:[],joinNormals:[],indices:[]},gt=[],Tt=[],Et=[];let St=He.length;for(;St>=2&&He[St-1].equals(He[St-2]);)St--;if(St<(Ye?3:2))return ft;let ht,Rt,vt,Mt,At,ti=0;for(;ti<St-1&&He[ti].equals(He[ti+1]);)ti++;Ye&&(ht=He[St-2],At=He[ti].sub(ht)._unit()._perp());for(let Zt=ti;Zt<St;Zt++){if(vt=Zt===St-1?Ye?He[ti+1]:void 0:He[Zt+1],vt&&He[Zt].equals(vt))continue;At&&(Mt=At),ht&&(Rt=ht),ht=He[Zt],At=vt?vt.sub(ht)._unit()._perp():Mt,Mt=Mt||At;let Kt=Mt.add(At);Kt.x===0&&Kt.y===0||Kt._unit();const Ei=Kt.x*At.x+Kt.y*At.y,pi=Ei!==0?1/Ei:1/0,ei=Mt.x*At.y-Mt.y*At.x>0;let ki="miter";const Qi=2;ki==="miter"&&pi>Qi&&(ki="bevel"),ki==="bevel"&&(pi>100&&(ki="flipbevel"),pi<Qi&&(ki="miter"));const yr=(Wi,Ir,cr,zn)=>{const hr=new Pt(Wi.x,Wi.y),Rr=new Pt(Wi.x,Wi.y);hr.x+=Ir.x*zn,hr.y+=Ir.y*zn,Rr.x-=Ir.x*Math.max(cr,1),Rr.y-=Ir.y*Math.max(cr,1),Et.push(Ir),gt.push(hr),Tt.push(Rr)};if(ki==="miter")Kt._mult(pi),yr(ht,Kt,0,0);else if(ki==="flipbevel")Kt=At.mult(-1),yr(ht,Kt,0,0),yr(ht,Kt.mult(-1),0,0);else{const Wi=-Math.sqrt(pi*pi-1),Ir=ei?Wi:0,cr=ei?0:Wi;Rt&&yr(ht,Mt,Ir,cr),vt&&yr(ht,At,Ir,cr)}}ft.geometry=[...gt,...Tt.reverse(),gt[0]],ft.joinNormals=[...Et,...Et.reverse(),Et[Et.length-1]];const ri=ft.geometry.length-1;for(let Zt=0;Zt<ri/2;Zt++)if(Zt+1<ri/2){let Kt=Zt,Ei=Zt+1,pi=ri-1-Zt,ei=ri-2-Zt;Kt=Kt===0?ri-1:Kt-1,Ei=Ei===0?ri-1:Ei-1,pi=pi===0?ri-1:pi-1,ei=ei===0?ri-1:ei-1,ft.indices.push(pi),ft.indices.push(Ei),ft.indices.push(Kt),ft.indices.push(pi),ft.indices.push(ei),ft.indices.push(Ei)}return ft})(l[0]),l=[ye.geometry]}const be=(He,Ye)=>He<(Ye.length-1)/2||He===Ye.length-1,Ie=this.wallMode?[l]:rm(l,500);for(let He=Ie.length-1;He>=0;He--){const Ye=Ie[He];(Ye.length===0||Wb(Ye[0]))&&Ie.splice(He,1)}let Re;if(H)Re=Ix(Ie,B,y);else{Re=[];for(const He of Ie)Re.push({polygon:He,bounds:B})}const Ne=W?this.edgeRadius:0,Ve=Ne>0&&this.zoom<17,Be=(He,Ye)=>{if(He.length===0)return!1;const yt=He[He.length-1];return Ye.x===yt.x&&Ye.y===yt.y};for(const{polygon:He,bounds:Ye}of Re){let yt=0,ft=0;for(const St of He)W&&!St[0].equals(St[St.length-1])&&St.push(St[0]),ft+=W?St.length-1:St.length;const gt=this.segments.prepareSegment((W?5:4)*ft,this.layoutVertexArray,this.indexArray);ue.footprintSegIdx<0&&(ue.footprintSegIdx=this.footprintSegments.length),ue.polygonSegIdx<0&&(ue.polygonSegIdx=this.polygonSegments.length);const Tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Et=new ui;if(Et.vertexOffset=this.footprintVertices.length,Et.indexOffset=3*this.footprintIndices.length,Et.ringIndices=[],W){const St=[],ht=[];yt=gt.vertexLength;for(let vt=0;vt<He.length;vt++){const Mt=He[vt];Mt.length&&vt!==0&&ht.push(St.length/2);const At=[];let ti,ri;ti=Mt[1].sub(Mt[0])._perp()._unit(),Et.ringIndices.push(Mt.length-1);for(let Zt=1;Zt<Mt.length;Zt++){const Kt=Mt[Zt],Ei=Mt[Zt===Mt.length-1?1:Zt+1],pi=Kt.clone();if(Ne){ri=Ei.sub(Kt)._perp()._unit();const ei=ti.add(ri)._unit(),ki=Ne*Math.min(4,1/(ti.x*ei.x+ti.y*ei.y));pi.x+=ki*ei.x,pi.y+=ki*ei.y,pi.x=Math.round(pi.x),pi.y=Math.round(pi.y),ti=ri}if(!ae||Ne!==0&&!Ve||Be(At,pi)||At.push(pi),xn(this.layoutVertexArray,pi.x,pi.y,0,0,1,1,0),this.wallMode){const ei=be(Zt,Mt);Dt(this.wallVertexArray,ye.joinNormals[Zt],!ei)}gt.vertexLength++,this.footprintVertices.emplaceBack(Kt.x,Kt.y),St.push(Kt.x,Kt.y),H&&Vt(this.layoutVertexExtArray,N.projectTilePoint(pi.x,pi.y,y),N.upVector(y,pi.x,pi.y))}ae&&(Ne===0||Ve)&&(At.length!==0&&Be(At,At[0])&&At.pop(),this.groundEffect.addData(At,Ye,F))}const Rt=this.wallMode?ye.indices:Yo(St,ht);for(let vt=0;vt<Rt.length;vt+=3)this.footprintIndices.emplaceBack(Et.vertexOffset+Rt[vt+0],Et.vertexOffset+Rt[vt+1],Et.vertexOffset+Rt[vt+2]),this.indexArray.emplaceBack(yt+Rt[vt],yt+Rt[vt+2],yt+Rt[vt+1]),gt.primitiveLength++;Et.indexCount+=Rt.length,Et.vertexCount+=this.footprintVertices.length-Et.vertexOffset}for(let St=0;St<He.length;St++){const ht=He[St];ne.startRing(ue,ht[0]);let Rt=ht.length>4&&Rx(ht[ht.length-2],ht[0],ht[1]),vt=Ne?qb(ht[ht.length-2],ht[0],ht[1],Ne):0;const Mt=[];let At,ti,ri;ti=ht[1].sub(ht[0])._perp()._unit();let Zt=!0;for(let Kt=1,Ei=0;Kt<ht.length;Kt++){let pi=ht[Kt-1],ei=ht[Kt];const ki=ht[Kt===ht.length-1?1:Kt+1];if(ne.appendEdge(ue,ei,pi),g0(ei,pi,Ye)){Ne&&(ti=ki.sub(ei)._perp()._unit(),Zt=!Zt);continue}const Qi=ei.sub(pi)._perp(),yr=Qi.x/(Math.abs(Qi.x)+Math.abs(Qi.y)),Wi=Qi.y>0?1:0,Ir=pi.dist(ei);if(Ei+Ir>32768&&(Ei=0),Ne){ri=ki.sub(ei)._perp()._unit();let Rr=Ax(pi,ei,ki,x_(ti,ri),Ne);isNaN(Rr)&&(Rr=0);const Jr=ei.sub(pi)._unit();pi=pi.add(Jr.mult(vt))._round(),ei=ei.add(Jr.mult(-Rr))._round(),vt=Rr,ti=ri,ae&&this.zoom>=17&&(Be(Mt,pi)||Mt.push(pi),Be(Mt,ei)||Mt.push(ei))}const cr=gt.vertexLength,zn=ht.length>4&&Rx(pi,ei,ki);let hr=Mx(Ei,Rt,Zt);if(xn(this.layoutVertexArray,pi.x,pi.y,yr,Wi,0,0,hr),xn(this.layoutVertexArray,pi.x,pi.y,yr,Wi,0,1,hr),this.wallMode){const Rr=be(Kt-1,ht),Jr=ye.joinNormals[Kt-1];Dt(this.wallVertexArray,Jr,Rr),Dt(this.wallVertexArray,Jr,Rr)}if(Ei+=Ir,hr=Mx(Ei,zn,!Zt),Rt=zn,xn(this.layoutVertexArray,ei.x,ei.y,yr,Wi,0,0,hr),xn(this.layoutVertexArray,ei.x,ei.y,yr,Wi,0,1,hr),this.wallMode){const Rr=be(Kt,ht),Jr=ye.joinNormals[Kt];Dt(this.wallVertexArray,Jr,Rr),Dt(this.wallVertexArray,Jr,Rr)}if(gt.vertexLength+=4,this.indexArray.emplaceBack(cr+0,cr+1,cr+2),this.indexArray.emplaceBack(cr+1,cr+3,cr+2),gt.primitiveLength+=2,Ne){const Rr=yt+(Kt===1?ht.length-2:Kt-2),Jr=Kt===1?yt:Rr+1;if(this.indexArray.emplaceBack(cr+1,Rr,cr+3),this.indexArray.emplaceBack(Rr,Jr,cr+3),gt.primitiveLength+=2,At===void 0&&(At=cr),!g0(ki,ht[Kt],Ye)){const on=Kt===ht.length-1?At:gt.vertexLength;this.indexArray.emplaceBack(cr+2,cr+3,on),this.indexArray.emplaceBack(cr+3,on+1,on),this.indexArray.emplaceBack(cr+3,Jr,on+1),gt.primitiveLength+=3}Zt=!Zt}if(H){const Rr=this.layoutVertexExtArray,Jr=N.projectTilePoint(pi.x,pi.y,y),on=N.projectTilePoint(ei.x,ei.y,y),ln=N.upVector(y,pi.x,pi.y),Fn=N.upVector(y,ei.x,ei.y);Vt(Rr,Jr,ln),Vt(Rr,Jr,ln),Vt(Rr,on,Fn),Vt(Rr,on,Fn)}}W&&(yt+=ht.length-1),ae&&Ne&&this.zoom>=17&&(Mt.length!==0&&Be(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,Ye,F,Ne>0))}this.footprintSegments.push(Et),Tt.triangleCount=this.indexArray.length-Tt.triangleArrayOffset,this.polygonSegments.push(Tt),++ue.footprintSegLen,++ue.polygonSegLen}if(ue.vertexCount=this.layoutVertexArray.length-ue.vertexArrayOffset,ue.groundVertexCount=this.groundEffect.vertexArray.length-ue.groundVertexArrayOffset,ue.vertexCount!==0){if(ue.centroidXY=ne.borders?Hi:this.encodeCentroid(ne,ue),this.centroidData.push(ue),ne.borders){this.featuresOnBorder.push(ne);const He=this.featuresOnBorder.length-1;for(let Ye=0;Ye<ne.borders.length;Ye++)ne.borders[Ye][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ye].push(He)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,b,T,y,I,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,p,b,T,y,I,this.worldview),this.maxHeight=Math.max(this.maxHeight,fe)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let T=0;T<this.centroidData.length;T++){const P=this.centroidData[T],I=+(P.min.y+P.max.y>$t),F=2*I+(+(P.min.x+P.max.x>$t)^I);for(let B=0;B<P.polygonSegLen;B++){const N=P.polygonSegIdx+B;e.push({centroidIdx:T,subtile:F,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const n=new qn;e.sort((T,P)=>T.triangleSegmentIdx===P.triangleSegmentIdx?T.subtile-P.subtile:T.triangleSegmentIdx-P.triangleSegmentIdx);let l=0,p=0,y=0;for(const T of e){if(T.triangleSegmentIdx!==l)break;y++}const b=e.length;for(;p!==e.length;){l=e[p].triangleSegmentIdx;let T=0,P=p,I=p;for(let F=P;F<y&&e[F].subtile===T;F++)I++;for(;P!==y;){const F=e[P];T=F.subtile;const B=this.centroidData[F.centroidIdx].min.clone(),N=this.centroidData[F.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=P;W<I;W++){const ne=e[W],ue=this.polygonSegments[ne.polygonSegmentIdx],ae=this.centroidData[ne.centroidIdx].min,fe=this.centroidData[ne.centroidIdx].max,ye=this.indexArray.uint16;for(let be=ue.triangleArrayOffset;be<ue.triangleArrayOffset+ue.triangleCount;be++)n.emplaceBack(ye[3*be],ye[3*be+1],ye[3*be+2]);H.primitiveLength+=ue.triangleCount,B.x=Math.min(B.x,ae.x),B.y=Math.min(B.y,ae.y),N.x=Math.max(N.x,fe.x),N.y=Math.max(N.y,fe.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:B,max:N}),P=I;for(let W=P;W<y&&e[W].subtile===e[P].subtile;W++)I++}p=y;for(let F=p;F<b&&e[F].triangleSegmentIdx===e[p].triangleSegmentIdx;F++)y++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,l){const p=new $r;if(this.wallMode){for(const ne of this.triangleSubSegments)p.segments.push(ne.segment);return p}let y=0,b=0;const T=1<<e.canonical.z;if(n){const ne=n.getMinMaxForTile(e);ne&&(y=ne.min,b=ne.max)}b+=this.maxHeight;const P=e.toUnwrapped();let I;const F=[P.canonical.x/T+P.wrap,P.canonical.y/T],B=[(P.canonical.x+1)/T+P.wrap,(P.canonical.y+1)/T],N=(ne,ue,ae)=>[ne[0]*(1-ae[0])+ue[0]*ae[0],ne[1]*(1-ae[1])+ue[1]*ae[1]],H=[],W=[];for(const ne of this.triangleSubSegments){H[0]=ne.min.x/$t,H[1]=ne.min.y/$t,W[0]=ne.max.x/$t,W[1]=ne.max.y/$t;const ue=N(F,B,H),ae=N(F,B,W);if(new mr([ue[0],ue[1],y],[ae[0],ae[1],b]).intersectsPrecise(l)===0){I&&(p.segments.push(I),I=void 0);continue}const fe=ne.segment;I&&I.vertexOffset!==fe.vertexOffset&&(p.segments.push(I),I=void 0),I?(I.vertexLength+=fe.vertexLength,I.primitiveLength+=fe.primitiveLength):I={vertexOffset:fe.vertexOffset,primitiveLength:fe.primitiveLength,vertexLength:fe.vertexLength,primitiveOffset:fe.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&p.segments.push(I),p}encodeCentroid(e,n){const l=e.centroid(),p=n.span(),y=Math.min(7,Math.round(p.x*this.tileToMeter/10)),b=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Pt(Oe(l.x,1,8191)<<3|y,Oe(l.y,1,8191)<<3|b)}encodeBorderCentroid(e){if(!e.borders)return new Pt(0,0);const n=e.borders,l=Number.MAX_VALUE;if(n[0][0]!==l||n[1][0]!==l){const p=n[0][0]!==l?0:1;return new Pt(6|(n[0][0]!==l?0:65528),(n[p][0]+n[p][1])/2<<3|6)}{const p=n[2][0]!==l?2:3;return new Pt((n[p][0]+n[p][1])/2<<3|6,6|(n[2][0]!==l?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,p=e.flags&ir?Hi:e.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==p.y||y!==p.x){for(let b=n;b<l;++b)this.centroidVertexArray.emplace(b,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const p=n.getReplacementRegionsForTile(e.toUnwrapped());if(f(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const y=[];for(const b of this.activeReplacements){if(b.order<l)continue;const T=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-e.canonical.z));if(b.footprint.buildingIds)for(const P of this.centroidData)P.flags&ir||b.min.x>P.max.x||P.min.x>b.max.x||b.min.y>P.max.y||P.min.y>b.max.y||b.footprint.buildingIds.has(P.buildingId)&&(P.flags|=ir);else for(const P of this.centroidData)if(!(P.flags&ir||b.min.x>P.max.x||P.min.x>b.max.x||b.min.y>P.max.y||P.min.y>b.max.y))for(let I=0;I<P.footprintSegLen;I++){const F=this.footprintSegments[P.footprintSegIdx+I];if(y.length=0,Zb(this.footprintVertices,F.vertexOffset,F.vertexCount,b.footprintTileId.canonical,e.canonical,y),L(b.footprint,y,this.footprintIndices.uint16,F.indexOffset,F.indexCount,-F.vertexOffset,-T)){P.flags|=ir;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,l){let p=!1;for(let y=0;y<l.footprintSegLen;y++){const b=this.footprintSegments[l.footprintSegIdx+y];let T=0;for(const P of b.ringIndices){for(let I=T,F=P+T-1;I<P+T;F=I++){const B=this.footprintVertices.int16[2*(I+b.vertexOffset)+0],N=this.footprintVertices.int16[2*(I+b.vertexOffset)+1],H=this.footprintVertices.int16[2*(F+b.vertexOffset)+1];N>n!=H>n&&e<(this.footprintVertices.int16[2*(F+b.vertexOffset)+0]-B)*(n-N)/(H-N)+B&&(p=!p)}T=P}}return p}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,p=!0;const y=4*(e+$t)*$t+(n+$t);if(this.partLookup.hasOwnProperty(y)){const b=this.partLookup[y];return b?{height:b.height,hidden:!!(b.flags&ir)}:void 0}for(const b of this.centroidData)e>b.max.x||b.min.x>e||n>b.max.y||b.min.y>n||b.height<=l||this.footprintContainsPoint(e,n,b)&&(l=b.height,this.partLookup[y]=b,p=!!(b.flags&ir));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:p};this.partLookup[y]=void 0}}function x_(o,e){const n=o.add(e)._unit();return o.x*n.x+o.y*n.y}function qb(o,e,n,l){const p=e.sub(o)._perp()._unit(),y=n.sub(e)._perp()._unit();return Ax(o,e,n,x_(p,y),l)}function Ax(o,e,n,l,p){const y=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(n)/3,p*y/l)}function g0(o,e,n){return o.x<n[0].x&&e.x<n[0].x||o.x>n[1].x&&e.x>n[1].x||o.y<n[0].y&&e.y<n[0].y||o.y>n[1].y&&e.y>n[1].y}function Cx(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function Wb(o){return o.every(e=>e.x<=0)||o.every(e=>e.x>=$t)||o.every(e=>e.y<=0)||o.every(e=>e.y>=$t)}function Rx(o,e,n){if(o.x<0||o.x>=$t||e.x<0||e.x>=$t||n.x<0||n.x>=$t)return!1;const l=n.sub(e),p=l.perp(),y=o.sub(e);return(l.x*y.x+l.y*y.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function Mx(o,e,n){const l=e?2|o:-3&o;return n?1|l:-2&l}function Px(){const o=Math.PI/32,e=Math.tan(o),n=Ue;return n*Math.sqrt(1+2*e*e)-n}function Ix(o,e,n){const l=1<<n.z,p=pt(n.x/l),y=pt((n.x+1)/l),b=wt(n.y/l),T=wt((n.y+1)/l);return(function(P,I,F,B,N=0,H){const W=[];if(!P.length||!F||!B)return W;const ne=(Re,Ne)=>{for(const Ve of Re)W.push({polygon:Ve,bounds:Ne})},ue=Math.ceil(Math.log2(F)),ae=Math.ceil(Math.log2(B)),fe=ue-ae,ye=[];for(let Re=0;Re<Math.abs(fe);Re++)ye.push(fe>0?0:1);for(let Re=0;Re<Math.min(ue,ae);Re++)ye.push(0),ye.push(1);let be=P;if(be=zd(be,I[0].y-N,I[1].y+N,1),be=zd(be,I[0].x-N,I[1].x+N,0),!be.length)return W;const Ie=[];for(ye.length?Ie.push({polygons:be,bounds:I,depth:0}):ne(be,I);Ie.length;){const Re=Ie.pop(),Ne=Re.depth,Ve=ye[Ne],Be=Re.bounds[0],He=Re.bounds[1],Ye=Ve===0?Be.x:Be.y,yt=Ve===0?He.x:He.y,ft=H?H(Ve,Ye,yt):.5*(Ye+yt),gt=zd(Re.polygons,Ye-N,ft+N,Ve),Tt=zd(Re.polygons,ft-N,yt+N,Ve);if(gt.length){const Et=[Be,new Pt(Ve===0?ft:He.x,Ve===1?ft:He.y)];ye.length>Ne+1?Ie.push({polygons:gt,bounds:Et,depth:Ne+1}):ne(gt,Et)}if(Tt.length){const Et=[new Pt(Ve===0?ft:Be.x,Ve===1?ft:Be.y),He];ye.length>Ne+1?Ie.push({polygons:Tt,bounds:Et,depth:Ne+1}):ne(Tt,Et)}}return W})(o,e,Math.ceil((y-p)/11.25),Math.ceil((b-T)/11.25),1,(P,I,F)=>{if(P===0)return .5*(I+F);{const B=wt((n.y+I/$t)/l);return(rt(.5*(wt((n.y+F/$t)/l)+B))*l-n.y)*$t}})}function Zb(o,e,n,l,p,y){const b=Math.pow(2,l.z-p.z);for(let T=0;T<n;T++){let P=o.int16[2*(T+e)+0],I=o.int16[2*(T+e)+1];P=(P+p.x*$t)*b-l.x*$t,I=(I+p.y*$t)*b-l.y*$t,y.push(new Pt(P,I))}}let Dx,kx;Ut(tc,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(ar,"PartData"),Ut(ui,"FootprintSegment"),Ut(an,"BorderCentroidData"),Ut(nn,"GroundEffect");class hm extends Pt{constructor(e,n,l){super(e,n),this.z=l}}class Lx extends hm{constructor(e,n,l,p){super(e,n,l),this.w=p}}function Ox(o,e,n,l){const p=n==="x"?"y":"x",y=(l-o[n])/(e[n]-o[n]);o[p]=Math.round(o[p]+(e[p]-o[p])*y),o[n]=l,o.hasOwnProperty("z")&&(o.z=Ri(o.z,e.z,y)),o.hasOwnProperty("w")&&(o.w=Ri(o.w,e.w,y))}function zx(o,e,n,l){const p=n,y=l;for(const b of["x","y"]){let T=o,P=e;T[b]>=P[b]&&(T=e,P=o),T[b]<p&&P[b]>p&&Ox(T,P,b,p),T[b]<y&&P[b]>y&&Ox(P,T,b,y)}}function v_(o,e,n,l,p,y){const b=[];for(let T=0;T<o.length;T++){const P=o[T];let I;const F=b.length;let B=0;for(let N=0;N<P.length-1;N++){let H=P[N],W=P[N+1],ne=0;const ue=B;let ae,fe;y&&(ne=Math.hypot(W.x-H.x,W.y-H.y),B+=ne,ae=H,fe=W),H.x<e&&W.x<e||(H.x<e?H=new Pt(e,H.y+(e-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x<e&&(W=new Pt(e,H.y+(e-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y<n&&W.y<n||(H.y<n?H=new Pt(H.x+(n-H.y)/(W.y-H.y)*(W.x-H.x),n)._round():W.y<n&&(W=new Pt(H.x+(n-H.y)/(W.y-H.y)*(W.x-H.x),n)._round()),H.x>=l&&W.x>=l||(H.x>=l?H=new Pt(l,H.y+(l-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x>=l&&(W=new Pt(l,H.y+(l-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y>=p&&W.y>=p||(H.y>=p?H=new Pt(H.x+(p-H.y)/(W.y-H.y)*(W.x-H.x),p)._round():W.y>=p&&(W=new Pt(H.x+(p-H.y)/(W.y-H.y)*(W.x-H.x),p)._round()),I&&H.equals(I[I.length-1])||(I=[H],b.push(I),y&&y.push({progress:{min:ue+Fx(ae,fe,H)*ne,max:1},parentIndex:T,prevPoint:ae,nextPoint:fe})),I.push(W),y&&(y[y.length-1].progress.max=ue+Fx(ae,fe,W)*ne,y[y.length-1].nextPoint=fe)))))}if(y&&B>0)for(let N=F;N<b.length;N++)y[N].progress.min/=B,y[N].progress.max/=B}return b}function Xb(o,e,n,l,p){if(o.length<2)return void l.push(o);const y=[];for(;e.valid();){const[I,F]=e.get();for(let B=0;B<o.length-1;B++){const N=o[B],H=o[B+1],W=bh(N,H,I,F);if(W){const[ne]=W,ue=new Pt(Ri(N.x,H.x,ne),Ri(N.y,H.y,ne));y.push({t:B+ne,distance:0,point:ue})}}e.next()}if(y.length===0)return void l.push(o);y.sort((I,F)=>I.t-F.t);let b=0,T=0,P=[];for(l.push(P);b!==o.length;){if(T===y.length){for(;b!==o.length;)P.length!==0&&P[P.length-1].equals(o[b])||P.push(o[b]),b++;break}y[T].t<=b?(P.length!==0&&P[P.length-1].equals(y[T].point)||P.push(y[T].point),Math.trunc(y[T].t),T++):(P.length!==0&&P[P.length-1].equals(o[b])||P.push(o[b]),b++)}}function Fx(o,e,n){return o.x!==e.x?(n.x-o.x)/(e.x-o.x):o.y!==e.y?(n.y-o.y)/(e.y-o.y):0}function cy(o,e){return o.x*e.x+o.y*e.y}function Bx(o,e){if(o.length===1){let n=0;const l=e[n++];let p;for(;!p||l.equals(p);)if(p=e[n++],!p)return 1/0;for(;n<e.length;n++){const y=e[n],b=o[0],T=p.sub(l),P=y.sub(l),I=b.sub(l),F=cy(T,T),B=cy(T,P),N=cy(P,P),H=cy(I,T),W=cy(I,P),ne=F*N-B*B,ue=(N*H-B*W)/ne,ae=(F*W-B*H)/ne,fe=l.z*(1-ue-ae)+p.z*ue+y.z*ae;if(isFinite(fe))return fe}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}function jx(o,e,n){let l=1/0;jr(n,e)&&(l=Bx(n,e[0]));for(let p=0;p<e.length;p++){const y=e[p],b=o[p];for(let T=0;T<y.length-1;T++){const P=y[T],I=[P,y[T+1],b[T+1],b[T],P];Qr(n,I)&&(l=Math.min(l,Bx(n,I)))}}return l!==1/0&&l}function Nx(o,e,n,l,p,y,b,T,P,I,F){return o.projection.name==="globe"?(function(B,N,H,W,ne,ue,ae,fe,ye,be,Ie){const Re=[],Ne=[],Ve=B.projection.upVectorScale(Ie,B.center.lat,B.worldSize).metersToTile,Be=[0,0,0,1],He=[0,0,0,1],Ye=(ft,gt,Tt,Et)=>{ft[0]=gt,ft[1]=Tt,ft[2]=Et,ft[3]=1},yt=Px();H>0&&(H+=yt),W+=yt;for(const ft of N){const gt=[],Tt=[];for(const Et of ft){const St=Et.x+ne.x,ht=Et.y+ne.y,Rt=B.projection.projectTilePoint(St,ht,Ie),vt=B.projection.upVector(Ie,Et.x,Et.y);let Mt=H,At=W;if(ae){const ti=Vx(St,ht,H,W,ae,fe,ye,be);Mt+=ti.base,At+=ti.top}H!==0?Ye(Be,Rt.x+vt[0]*Ve*Mt,Rt.y+vt[1]*Ve*Mt,Rt.z+vt[2]*Ve*Mt):Ye(Be,Rt.x,Rt.y,Rt.z),Ye(He,Rt.x+vt[0]*Ve*At,Rt.y+vt[1]*Ve*At,Rt.z+vt[2]*Ve*At),Ui(Be,Be,ue),Ui(He,He,ue),gt.push(new hm(Be[0],Be[1],Be[2])),Tt.push(new hm(He[0],He[1],He[2]))}Re.push(gt),Ne.push(Tt)}return[Re,Ne]})(o,e,n,l,p,y,b,T,P,I,F):b?(function(B,N,H,W,ne,ue,ae,fe,ye){const be=[],Ie=[],Re=[0,0,0,1];for(const Ne of B){const Ve=[],Be=[];for(const He of Ne){const Ye=He.x+W.x,yt=He.y+W.y,ft=Vx(Ye,yt,N,H,ue,ae,fe,ye);Re[0]=Ye,Re[1]=yt,Re[2]=ft.base,Re[3]=1,jn(Re,Re,ne),Re[3]=Math.max(Re[3],1e-5);const gt=new hm(Re[0]/Re[3],Re[1]/Re[3],Re[2]/Re[3]);Re[0]=Ye,Re[1]=yt,Re[2]=ft.top,Re[3]=1,jn(Re,Re,ne),Re[3]=Math.max(Re[3],1e-5);const Tt=new hm(Re[0]/Re[3],Re[1]/Re[3],Re[2]/Re[3]);Ve.push(gt),Be.push(Tt)}be.push(Ve),Ie.push(Be)}return[be,Ie]})(e,n,l,p,y,b,T,P,I):(function(B,N,H,W,ne){const ue=[],ae=[],fe=ne[8]*N,ye=ne[9]*N,be=ne[10]*N,Ie=ne[11]*N,Re=ne[8]*H,Ne=ne[9]*H,Ve=ne[10]*H,Be=ne[11]*H;for(const He of B){const Ye=[],yt=[];for(const ft of He){const gt=ft.x+W.x,Tt=ft.y+W.y,Et=ne[0]*gt+ne[4]*Tt+ne[12],St=ne[1]*gt+ne[5]*Tt+ne[13],ht=ne[2]*gt+ne[6]*Tt+ne[14],Rt=ne[3]*gt+ne[7]*Tt+ne[15],vt=Et+fe,Mt=St+ye,At=ht+be,ti=Math.max(Rt+Ie,1e-5),ri=Et+Re,Zt=St+Ne,Kt=ht+Ve,Ei=Math.max(Rt+Be,1e-5);Ye.push(new hm(vt/ti,Mt/ti,At/ti)),yt.push(new hm(ri/Ei,Zt/Ei,Kt/Ei))}ue.push(Ye),ae.push(yt)}return[ue,ae]})(e,n,l,p,y)}function Vx(o,e,n,l,p,y,b,T){const P=b*p.getElevationAt(o,e,!0,!0),I=y[0]!==0,F=I?y[1]===0?b*(y[0]/7-450):b*(function(B,N,H){const W=Math.floor(N[0]/8),ne=Math.floor(N[1]/8),ue=10*(N[0]-8*W),ae=10*(N[1]-8*ne),fe=B.getElevationAt(W,ne,!0,!0),ye=B.getMeterToDEM(H),be=Math.floor(.5*(ue*ye-1)),Ie=Math.floor(.5*(ae*ye-1)),Re=B.tileCoordToPixel(W,ne),Ne=2*be+1,Ve=2*Ie+1,Be=(function(Tt,Et,St,ht,Rt){return[Tt.getElevationAtPixel(Et,St,!0),Tt.getElevationAtPixel(Et+Rt,St,!0),Tt.getElevationAtPixel(Et,St+Rt,!0),Tt.getElevationAtPixel(Et+ht,St+Rt,!0)]})(B,Re.x-be,Re.y-Ie,Ne,Ve),He=Math.abs(Be[0]-Be[1]),Ye=Math.abs(Be[2]-Be[3]),yt=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),ft=Math.min(.25,.5*ye*(He+Ye)/Ne),gt=Math.min(.25,.5*ye*yt/Ve);return fe+Math.max(ft*ue,gt*ae)})(p,y,T):P;return{base:P+(n===0?-1:n),top:I?Math.max(F+l,P+n+2):P+l}}class Yb{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Kb{constructor(){this.tasks={},this.taskQueue=[],ii(["process"],this),this.invoker=new Yb(this.process),this.nextId=0}add(e,n){const l=this.nextId++,p=(function({type:y,isSymbolTile:b,zoom:T}){return T=T||0,y==="message"?0:y!=="maybePrepare"||b?y!=="parseTile"||b?y==="parseTile"&&b?300-T:y==="maybePrepare"&&b?400-T:500:200-T:100-T})(n);if(p===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:n,priority:p,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<n&&(n=y.priority,e=p)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class Ux{constructor(e,n,l){this.target=e,this.parent=n,this.mapId=l,this.callbacks={},this.cancelCallbacks={},ii(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Kb}send(e,n,l,p,y=!1,b){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[T]=l);const P=new Set;return this.target.postMessage({id:T,type:e,hasCallback:!!l,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:yn(n,P)},P),{cancel:()=>{l&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const p=this.cancelCallbacks[l];delete this.cancelCallbacks[l],p&&p.cancel()}else if(n.mustQueue||wn(self)){const p=this.callbacks[l],y=this.scheduler.add(()=>this.processTask(l,n),p&&p.metadata||{type:"message"});y&&(this.cancelCallbacks[l]=y)}else this.processTask(l,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(n.error?l(vo(n.error)):l(null,vo(n.data)))}else{const l=new Set,p=n.hasCallback?(b,T)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:b?yn(b):null,data:yn(T,l)},l)}:()=>{},y=vo(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,y,p);else if(this.parent.getWorkerSource){const b=n.type.split("."),{source:T,scope:P}=y;this.parent.getWorkerSource(n.sourceMapId,b[0],T,P)[b[1]](y,p)}else p(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var uy={workerUrl:"",workerClass:null,workerParams:void 0};function Qb(o){return uy.workerClass!=null?new uy.workerClass:new self.Worker(uy.workerUrl,Object.assign({name:o},uy.workerParams))}const y0="mapboxgl_preloaded_worker_pool";class dm{constructor(e){this.active={},this.name=e}acquire(e,n=dm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;){const l=Qb(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(l)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[y0]}numActive(){return Object.keys(this.active).length}}dm.workerCount=2;class lg{constructor(e,n,l="Worker",p=dm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ft();const y=this.workerPool.acquire(this.id,p);for(let b=0;b<y.length;b++){const T=new lg.Actor(y[b],n,this.id);T.name=`${l} ${b}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,l){et(this.actors,(p,y)=>{p.send(e,n,y)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let hy,_0;function b_(){return hy||(hy=new dm),hy}lg.Actor=Ux;const x0=4096;class Jb{constructor(e){this.module=e,this.memoryStack=this.module.malloc(x0),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>x0?-1:(new Int32Array(this.module.heap32.buffer,n,e.length).set(e),n)}createFloatArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>x0?-1:(new Float32Array(this.module.heapF32.buffer,n,e.length).set(e),n)}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.normalScale;this.module.setStyle(n[0],n[1],n[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,l){this.module.setFauxFacadeOptions(e?1:0,n?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){this.memoryStackNextFree=this.memoryStack;for(const T of e){const P=this.createIntArray(T.ringIndices),I=this.createFloatArray(T.coordinates);if(P===-1||I===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(T.id,T.sourceId,T.minHeight,T.height,T.roofType,I,P,T.ringIndices.length-1)}for(const T of n){let P;P=T.entrances?JSON.parse(T.entrances):[];const I=this.createFloatArray(P),F=this.createFloatArray(T.coordinates);if(I===-1||F===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(T.sourceId,T.crossPerc,T.distanceToRoad,I,P.length,F,T.coordinates.length)}if(!this.module.generateMesh()){const T=this.module.getLastError();return this.readStringBuffer(T)}const l=this.module.getMeshCount(),p=new Array(l);for(let T=0;T<l;T++){const P=this.module.getPositionsPtr(T),I=this.module.getPositionsLength(T),F=new Float32Array(this.module.heapF32.buffer,P,I),B=this.module.getNormalsPtr(T),N=this.module.getNormalsLength(T),H=new Float32Array(this.module.heapF32.buffer,B,N),W=this.module.getAOPtr(T),ne=this.module.getAOLength(T),ue=new Float32Array(this.module.heapF32.buffer,W,ne),ae=this.module.getUVPtr(T),fe=this.module.getUVLength(T),ye=new Float32Array(this.module.heapF32.buffer,ae,fe),be=this.module.getFauxFacadePtr(T),Ie=this.module.getFauxFacadeLength(T),Re=new Uint8Array(this.module.heapU8.buffer,be,Ie),Ne=this.module.getIndicesPtr(T),Ve=this.module.getIndicesLength(T),Be=new Int16Array(this.module.heap16.buffer,Ne,Ve),He=this.module.getBuildingPart(T);p[T]={positions:F,normals:H,ao:ue,uv:ye,isFauxFacade:Re,indices:Be,buildingPart:He}}const y=this.module.getRingCount(),b=[];for(let T=0;T<y;T++){const P=this.module.getRingPtr(T),I=this.module.getRingLength(T),F=new Float32Array(this.module.heapF32.buffer,P,I);b.push(F)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:b}}}let dy,v0,Au,cg,b0,ug=null,hg=null,Gx=null,w_=null;function $x(){return wn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:v0||Yn.DRACO_URL}function Hx(){if(wn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(cg)return cg;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return cg=WebAssembly.validate(o)?Yn.MESHOPT_SIMD_URL:Yn.MESHOPT_URL,cg}function ew(){return w_}const qx=5120,Wx=5121,Zx=5122,Xx=5123,Yx=5125,Kx=5126,E_={[qx]:Int8Array,[Wx]:Uint8Array,[Zx]:Int16Array,[Xx]:Uint16Array,[Yx]:Uint32Array,[Kx]:Float32Array},tw={[qx]:"DT_INT8",[Wx]:"DT_UINT8",[Zx]:"DT_INT16",[Xx]:"DT_UINT16",[Yx]:"DT_UINT32",[Kx]:"DT_FLOAT32"},fy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Qx(o,e,n){const l=n.json.bufferViews.length,p=n.buffers.length;e.bufferView=l,n.json.bufferViews[l]={buffer:p,byteLength:o.byteLength},n.buffers[p]=o}const w0="KHR_draco_mesh_compression";function iw(o,e){const n=o.extensions&&o.extensions[w0];if(!n)return;const l=new Au.Decoder,p=iv(e,n.bufferView),y=new Au.Mesh;if(!l.DecodeArrayToMesh(p,p.byteLength,y))throw new Error("Failed to decode Draco mesh");const b=e.json.accessors[o.indices],T=E_[b.componentType],P=b.count*T.BYTES_PER_ELEMENT,I=Au._malloc(P);T===Uint16Array?l.GetTrianglesUInt16Array(y,P,I):l.GetTrianglesUInt32Array(y,P,I),Qx(Au.memory.buffer.slice(I,I+P),b,e),Au._free(I);for(const F of Object.keys(n.attributes)){const B=l.GetAttributeByUniqueId(y,n.attributes[F]),N=e.json.accessors[o.attributes[F]],H=tw[N.componentType],W=N.count*fy[N.type]*E_[N.componentType].BYTES_PER_ELEMENT,ne=Au._malloc(W);l.GetAttributeDataArrayForAllPoints(y,B,Au[H],W,ne),Qx(Au.memory.buffer.slice(ne,ne+W),N,e),Au._free(ne)}l.destroy(),y.destroy(),delete o.extensions[w0]}const S_="EXT_meshopt_compression";function rw(o,e){if(!o.extensions||!o.extensions[S_])return;const n=o.extensions[S_],l=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),p=new Uint8Array(n.count*n.byteStride);b0.decodeGltfBuffer(p,n.count,n.byteStride,l,n.mode,n.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=p.buffer,delete o.extensions[S_]}const Jx=1179937895,ev=new TextDecoder("utf8");function tv(o,e){return new URL(o,e).href}function nw(o,e,n,l){return fetch(tv(o.uri,l)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[n]=p})}function iv(o,e){const n=o.json.bufferViews[e];return new Uint8Array(o.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function sw(o,e,n,l){if(o.uri){const p=tv(o.uri,l);return fetch(p).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{e.images[n]=y})}if(o.bufferView!==void 0){const p=iv(e,o.bufferView),y=new Blob([p],{type:o.mimeType});return createImageBitmap(y).then(b=>{e.images[n]=b})}}function rv(o,e=0,n){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===Jx){const F=new Uint32Array(o,e);let B=2;const N=(F[B++]>>2)-3,H=F[B++]>>2;if(B++,l.json=JSON.parse(ev.decode(F.subarray(B,B+H))),B+=H,B<N){const W=F[B++];B++;const ne=e+(B<<2);l.buffers[0]=o.slice(ne,ne+W)}}else l.json=JSON.parse(ev.decode(new Uint8Array(o,e)));const{buffers:p,images:y,meshes:b,extensionsUsed:T,bufferViews:P}=l.json;let I=Promise.resolve();if(p){const F=[];for(let B=0;B<p.length;B++){const N=p[B];N.uri?F.push(nw(N,l,B,n)):l.buffers[B]||(l.buffers[B]=null)}I=Promise.all(F)}return I.then(()=>{const F=[],B=T&&T.includes(w0),N=T&&T.includes(S_);if(B&&F.push((function(){if(!Au)return dy??(dy=(function(H){let W,ne=null;function ue(){W=new Uint8Array(ne.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const fe={a:{a:ae,d:function(ye,be,Ie){return W.copyWithin(ye,be,be+Ie)},c:function(ye){const be=W.length,Ie=Math.max(ye>>>0,Math.ceil(1.2*be)),Re=Math.ceil((Ie-be)/65536);try{return ne.grow(Re),ue(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,fe):H.then(ye=>ye.arrayBuffer()).then(ye=>WebAssembly.instantiate(ye,fe))).then(ye=>{const{Rb:be,Qb:Ie,P:Re,T:Ne,X:Ve,Ja:Be,La:He,Qa:Ye,Va:yt,Wa:ft,eb:gt,jb:Tt,f:Et,e:St,yb:ht,zb:Rt,Ab:vt,Bb:Mt,Db:At,Gb:ti}=ye.instance.exports;ne=St;const ri=(()=>{let Zt=0,Kt=0,Ei=0,pi=0;return ei=>{Ei&&(be(pi),be(Zt),Kt+=Ei,Ei=Zt=0),Zt||(Kt+=128,Zt=Ie(Kt));const ki=ei.length+7&-8;let Qi=Zt;ki>=Kt&&(Ei=ki,Qi=pi=Ie(ki));for(let yr=0;yr<ei.length;yr++)W[Qi+yr]=ei[yr];return Qi}})();return ue(),Et(),{memory:St,_free:be,_malloc:Ie,Mesh:class{constructor(){this.ptr=Re()}destroy(){Ne(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){Tt(this.ptr)}DecodeArrayToMesh(Zt,Kt,Ei){const pi=ri(Zt),ei=He(this.ptr,pi,Kt,Ei.ptr);return!!Ve(ei)}GetAttributeByUniqueId(Zt,Kt){return{ptr:Ye(this.ptr,Zt.ptr,Kt)}}GetTrianglesUInt16Array(Zt,Kt,Ei){yt(this.ptr,Zt.ptr,Kt,Ei)}GetTrianglesUInt32Array(Zt,Kt,Ei){ft(this.ptr,Zt.ptr,Kt,Ei)}GetAttributeDataArrayForAllPoints(Zt,Kt,Ei,pi,ei){gt(this.ptr,Zt.ptr,Kt.ptr,Ei,pi,ei)}},DT_INT8:ht(),DT_UINT8:Rt(),DT_INT16:vt(),DT_UINT16:Mt(),DT_UINT32:At(),DT_FLOAT32:ti()}})})(fetch($x())),dy.then(H=>{Au=H,dy=void 0}))})()),N&&F.push((function(){if(b0)return;const H=(function(W){let ne;const ue=WebAssembly.instantiateStreaming(W,{}).then(ye=>{ne=ye.instance,ne.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ue,supported:!0,decodeGltfBuffer(ye,be,Ie,Re,Ne,Ve){(function(Be,He,Ye,yt,ft,gt,Tt){const Et=Be.exports.sbrk,St=yt+3&-4,ht=Et(St*ft),Rt=Et(gt.length),vt=new Uint8Array(Be.exports.memory.buffer);vt.set(gt,Rt);const Mt=He(ht,yt,ft,Rt,gt.length);if(Mt===0&&Tt&&Tt(ht,St,ft),Ye.set(vt.subarray(ht,ht+yt*ft)),Et(ht-Et(0)),Mt!==0)throw new Error(`Malformed buffer data: ${Mt}`)})(ne,ne.exports[fe[Ne]],ye,be,Ie,Re,ne.exports[ae[Ve]])}}})(fetch(Hx()));return H.ready.then(()=>{b0=H})})()),y)for(let H=0;H<y.length;H++)F.push(sw(y[H],l,H,n));return(F.length?Promise.all(F):Promise.resolve()).then(()=>{if(B&&b)for(const{primitives:H}of b)for(const W of H)iw(W,l);if(N&&b&&P)for(const H of P)rw(H,l);return l})})}function nv(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>rv(e,0,o))}function E0(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function S0(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class T0{constructor(e,n,l,p){this.context=e,this.format=l,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:p&&p.premultiply})}update(e,n){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:y}=this,{gl:b}=y,{x:T,y:P}=n&&n.position?n.position:{x:0,y:0},I=T+l,F=P+p;!this.size||this.size[0]===I&&this.size[1]===F||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!n||n.premultiply!==!1));const B=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&I>0&&F>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(I,F)))+1:1;b.texStorage2D(b.TEXTURE_2D,N,this.format,I,F),this.size=[I,F]}this.size&&(B?b.texSubImage2D(b.TEXTURE_2D,0,T,P,E0(this.format),S0(this.format),e):"data"in e&&e.data&&b.texSubImage2D(b.TEXTURE_2D,0,T,P,l,p,E0(this.format),S0(this.format),e.data)),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,l=!1){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),e!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,n),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,l,p,y){const{context:b}=this,{gl:T}=b;T.bindTexture(T.TEXTURE_2D,this.texture),n!==this.magFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?e===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,l),this.wrapS=l),p!==this.wrapT&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,p),this.wrapT=p),y!==this.compareMode&&(y?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_FUNC,y)):T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.NONE),this.compareMode=y)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class py{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:l}=this,{gl:p}=l;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrapS=n)}}const aw=Xi([{name:"a_pos_3f",components:3,type:"Float32"}]),ow=Xi([{name:"a_color_3f",components:3,type:"Float32"}]),lw=Xi([{name:"a_color_4f",components:4,type:"Float32"}]),cw=Xi([{name:"a_uv_2f",components:2,type:"Float32"}]),uw=Xi([{name:"a_normal_3f",components:3,type:"Float32"}]),hw=Xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dw=Xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function sv(o,e){const n=T_(o.projection,o.zoom,o.width,o.height),l=(function(y,b,T,P,I){const F=new Pe(T.lng-180*$f,T.lat),B=new Pe(T.lng+180*$f,T.lat),N=y.project(F.lng,F.lat),H=y.project(B.lng,B.lat),W=-Math.atan2(H.y-N.y,H.x-N.x),ne=Wt.fromLngLat(T);ne.y=Oe(ne.y,-1+$f,1-$f);const ue=ne.toLngLat(),ae=y.project(ue.lng,ue.lat),fe=Wt.fromLngLat(ue);fe.x+=$f;const ye=fe.toLngLat(),be=y.project(ye.lng,ye.lat),Ie=ov(be.x-ae.x,be.y-ae.y,W),Re=Wt.fromLngLat(ue);Re.y+=$f;const Ne=Re.toLngLat(),Ve=y.project(Ne.lng,Ne.lat),Be=ov(Ve.x-ae.x,Ve.y-ae.y,W),He=Math.abs(Ie.x)/Math.abs(Be.y),Ye=le([]);ke(Ye,Ye,-W*(1-(I?0:P)));const yt=le([]);return oe(yt,yt,[1,1-(1-He)*P,1]),yt[4]=-Be.x/Be.y*P,ke(yt,yt,W),se(yt,Ye,yt),yt})(o.projection,0,o.center,n,e),p=av(o);return oe(l,l,[p,p,1]),l}function av(o){const e=o.projection,n=T_(o.projection,o.zoom,o.width,o.height),l=A0(e,o.center),p=A0(e,Pe.convert(e.center));return Math.pow(2,l*n+(1-n)*p)}function T_(o,e,n,l,p=1/0){const y=o.range;if(!y)return 0;const b=Math.min(p,Math.max(n,l)),T=Math.log2(b/1024);return Ke(y[0]+T,y[1]+T,e)}const $f=1/4e4;function A0(o,e){const n=Oe(e.lat,-85.051129,Ze),l=new Pe(e.lng-180*$f,n),p=new Pe(e.lng+180*$f,n),y=o.project(l.lng,n),b=o.project(p.lng,n),T=Wt.fromLngLat(l),P=Wt.fromLngLat(p),I=b.x-y.x,F=b.y-y.y,B=P.x-T.x,N=P.y-T.y,H=Math.sqrt((B*B+N*N)/(I*I+F*F));return Math.log2(H)}function ov(o,e,n){const l=Math.cos(n),p=Math.sin(n);return{x:o*l-e*p,y:o*p+e*l}}function lv(o,e,n){le(o),ke(o,o,tr(e[2])),_e(o,o,tr(e[0])),Se(o,o,tr(e[1])),oe(o,o,n),se(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function A_(o,e,n,l,p,y,b,T){const P=[n[0]-e[0],n[1]-e[1],0],I=[l[0]-e[0],l[1]-e[1],0];if(kt(P)<1e-12||kt(I)<1e-12)return ys(o);const F=lr([],P,I);vi(F,F),Te(I,l,e),P[2]=(y-p)*T,I[2]=(b-p)*T;const B=P;return lr(B,P,I),vi(B,B),Zn(o,F,B)}function C_(o,e,n=!1){const l=wu(e.zoom),p=(function(y,b,T){const P=b.worldSize,I=[y[12],y[13],y[14]],F=wt(I[1]/P),B=pt(I[0]/P),N=le([]),H=tt(1,F)*P,W=tt(1,0)*P*ot(F,b.zoom),ne=1/Zp(P);let ue=W*ne;if(T){const be=T_(b.projection,b.zoom,b.width,b.height,1024);ue=ne*b.projection.pixelSpaceConversion(b.center.lat,P,be)}const ae=je(F,B);pe(ae,ae,ct([],vi([],ae),H*ue*I[2]));const fe=(function(be){const Ie=[be[0],be[1],be[2]];let Re=[0,1,0];const Ne=lr([],Re,Ie);return lr(Re,Ie,Ne),bi(Re)===0&&(Re=[0,1,0],lr(Ne,Ie,Re)),vi(Ne,Ne),vi(Re,Re),vi(Ie,Ie),[Ne[0],Ne[1],Ne[2],0,Re[0],Re[1],Re[2],0,Ie[0],Ie[1],Ie[2],0,be[0],be[1],be[2],1]})(ae);oe(N,N,[ue,ue,ue*H]),Q(N,N,[-I[0],-I[1],-I[2]]);const ye=se([],b.globeMatrix,fe);return se(ye,ye,N),se(ye,ye,y),ye})(o,e,n);if(l>0){const y=(function(b,T){const P=T.worldSize,I=tt(1,0)*P*ot(T.center.lat,T.zoom)/Zp(P),F=tt(1,T.center.lat)*P,B=le([]);Se(B,B,tr(T.center.lng)),_e(B,B,tr(T.center.lat)),Q(B,B,[0,0,de]),oe(B,B,[I,I,I*F]);const N=T.point;return Q(B,B,[-N.x,-N.y,0]),se(B,B,b),se(B,T.globeMatrix,B)})(o,e);return(function(b,T,P){const I=(W,ne,ue)=>{const ae=kt(W),fe=kt(ne),ye=Pc(W,ne,ue);return ct(ye,ye,1/kt(ye)*Ri(ae,fe,ue))},F=I([b[0],b[1],b[2]],[T[0],T[1],T[2]],P),B=I([b[4],b[5],b[6]],[T[4],T[5],T[6]],P),N=I([b[8],b[9],b[10]],[T[8],T[9],T[10]],P),H=Pc([b[12],b[13],b[14]],[T[12],T[13],T[14]],P);return[F[0],F[1],F[2],0,B[0],B[1],B[2],0,N[0],N[1],N[2],0,H[0],H[1],H[2],1]})(p,y,l)}return p}function C0(o,e,n,l){const p=mr.projectAabbCorners(l,n);let y=Number.MAX_VALUE;for(let T=0;T<p.length;++T){const P=p[T];P[0]=(.5*P[0]+.5)*e.width,P[1]=(.5-.5*P[1])*e.height,P[2]<y&&(y=P[2])}const b=(function(T){const P=[];let I=0;for(let H=1;H<T.length;H++)(T[H][0]<T[I][0]||T[H][0]===T[I][0]&&T[H][1]<T[I][1])&&(I=H);let F,B=I;const N=new Uint8Array(T.length);do{if(N[B])break;P.push(new Pt(T[B][0],T[B][1])),N[B]=1,F=(B+1)%T.length;for(let H=0;H<T.length;H++){if(T[H][0]===T[F][0]&&T[H][1]===T[F][1]||T[H][0]===T[B][0]&&T[H][1]===T[B][1])continue;const W=[T[H][0]-T[B][0],T[H][1]-T[B][1]],ne=[T[F][0]-T[B][0],T[F][1]-T[B][1]],ue=W[0]*ne[1]-W[1]*ne[0];(ue>0||ue===0&&W[0]*ne[0]+W[1]*ne[1]>=0&&W[0]*W[0]+W[1]*W[1]>ne[0]*ne[0]+ne[1]*ne[1])&&(F=H)}B=F}while(B!==I);return P.length>0&&P.push(P[0]),P})(p);if(Qr(o,b))return y}const fm=64,dg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function R_(o,e,n,l,p,y,b,T,P,I=!1){const F=n.zoom,B=n.project(l),N=ot(l.lat,F),H=1/N;le(o),Q(o,o,[B.x+b[0]*H,B.y+b[1]*H,b[2]]);let W=1,ne=1;const ue=n.worldSize;if(I){if(n.projection.name==="mercator"){let be=0;n.elevation&&(be=n.elevation.getAtPointOrZero(new Wt(B.x/ue,B.y/ue),0));const Ie=jn([],[B.x,B.y,be,1],n.projMatrix)[3]/n.cameraToCenterDistance;W=Ie,ne=Ie*ot(n.center.lat,F)}else if(n.projection.name==="globe"){const be=C_(o,n),Ie=[0,0,0,1];jn(Ie,Ie,se([],n.projMatrix,be));const Re=Ie[3]/n.cameraToCenterDistance,Ne=wu(F),Ve=n.projection.pixelsPerMeter(l.lat,ue)*ot(l.lat,F),Be=n.projection.pixelsPerMeter(n.center.lat,ue)*ot(n.center.lat,F);W=Re/Ri(Ve,_t(n.center.lat),Ne),ne=Re*N/Ve,W*=Be,ne*=Be}}else W=H;oe(o,o,[W,W,ne]);const ae=[...o],fe=e.orientation,ye=[];if(lv(ye,[fe[0]+(p?p[0]:0),fe[1]+(p?p[1]:0),fe[2]+(p?p[2]:0)],y),se(o,ae,ye),T&&n.elevation){let be=0;const Ie=[];if(P&&n.elevation){be=(function(Ne,Ve,Be,He,Ye){const yt=Ve.elevation;if(!yt)return 0;const ft=mr.projectAabbCorners(Be,He),gt=tt(1,Ye.lat)*Ve.worldSize,Tt=(function(Kt,Ei){const pi=[0,0,1],ei=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ki of ei){const Qi=Kt[ki.corners[0]],yr=Kt[ki.corners[1]],Wi=Kt[ki.corners[2]],Ir=[yr[0]-Qi[0],yr[1]-Qi[1],Ei*(yr[2]-Qi[2])],cr=lr(Ir,Ir,[Wi[0]-Qi[0],Wi[1]-Qi[1],Ei*(Wi[2]-Qi[2])]);vi(cr,cr),ki.dotProductWithUp=Gi(cr,pi)}return ei.sort((ki,Qi)=>ki.dotProductWithUp-Qi.dotProductWithUp),ei[0].corners})(ft,gt),Et=ft[Tt[0]],St=ft[Tt[1]],ht=ft[Tt[2]],Rt=ft[Tt[3]],vt=yt.getAtPointOrZero(new Wt(Et[0]/Ve.worldSize,Et[1]/Ve.worldSize),0),Mt=yt.getAtPointOrZero(new Wt(St[0]/Ve.worldSize,St[1]/Ve.worldSize),0),At=yt.getAtPointOrZero(new Wt(ht[0]/Ve.worldSize,ht[1]/Ve.worldSize),0),ti=yt.getAtPointOrZero(new Wt(Rt[0]/Ve.worldSize,Rt[1]/Ve.worldSize),0),ri=(vt+ti)/2,Zt=(Mt+At)/2;return ri>Zt?Mt<At?A_(Ne,St,Rt,Et,Mt,ti,vt,gt):A_(Ne,ht,Et,Rt,At,vt,ti,gt):vt<ti?A_(Ne,Et,St,ht,vt,Mt,At,gt):A_(Ne,Rt,ht,St,ti,At,Mt,gt),Math.max(ri,Zt)})(Ie,n,e.aabb,o,l);const Re=se([],Yt([],Ie),ye);se(o,ae,Re)}else be=n.elevation.getAtPointOrZero(new Wt(B.x/ue,B.y/ue),0);be!==0&&(o[14]+=be)}}class cv{constructor(e,n,l,p,y){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=l!=null?new Pe(l[0],l[1]):new Pe(0,0),this.orientation=p??[0,0,0],this.nodes=y,this.uploaded=!1,this.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){se(e.globalMatrix,n,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const b=[];y=l.orientation,le(p=b),Se(p,p,tr(y[1])),ke(p,p,tr(y[2])),_e(p,p,tr(y[0])),se(e.globalMatrix,e.globalMatrix,b)}var p,y;if(e.meshes)for(const b of e.meshes){const T=mr.applyTransformFast(b.aabb,e.globalMatrix);this.aabb.encapsulate(T)}if(e.children)for(const b of e.children)this._applyTransformations(b,e.globalMatrix)}computeBoundsAndApplyParent(){const e=le([]);this.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,l,p,y,b,T=!1){R_(this.matrix,this,e.transform,this.position,n,l,p,y,b,T)}upload(e){if(!this.uploaded){for(const n of this.nodes)R0(n,e);for(const n of this.nodes)M_(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)M0(e)}}function my(o,e,n=!1){o.uploaded||(o.gfxTexture=new T0(e,o.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function fw(o,e,n){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,aw.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,uw.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,cw.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?ow:lw).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,dw.members,!0)),o.segments=$r.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&my(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&my(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&my(l.normalTexture,e),l.occlusionTexture&&my(l.occlusionTexture,e,n),l.emissionTexture&&my(l.emissionTexture,e)}function R0(o,e,n){if(o.meshes)for(const l of o.meshes)fw(l,e,n);if(o.children)for(const l of o.children)R0(l,e,n)}function M_(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)M_(e)}function pw(o){o.pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()}function M0(o){if(o.meshes)for(const e of o.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&pw(e.material));if(o.children)for(const e of o.children)M0(e)}function pm(o,e){const n=o.json.bufferViews[e.bufferView],l=E_[e.componentType];return new l(o.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==fy[e.type]*l.BYTES_PER_ELEMENT?n.byteStride/l.BYTES_PER_ELEMENT:fy[e.type]))}function P0(o,e,n,l){const p=E_[e.componentType],y=(function(F){switch(F){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(p),b=o.json.bufferViews[e.bufferView],T=b.byteStride?b.byteStride/p.BYTES_PER_ELEMENT:fy[e.type],P=n.float32,I=P.length/n.capacity;for(let F=0,B=0;F<e.count*T;F+=T,B+=I)for(let N=0;N<I;N++)P[B+N]=l[F+N]*y;n._trim()}function mw(o,e,n){const l=o.indices,p=o.attributes,y={};y.indexArray=new qn;const b=e.json.accessors[l],T=b.count/3;y.indexArray.reserve(T);const P=pm(e,b);for(let N=0;N<T;N++)y.indexArray.emplaceBack(P[3*N],P[3*N+1],P[3*N+2]);y.indexArray._trim(),y.vertexArray=new to;const I=e.json.accessors[p.POSITION];y.vertexArray.reserve(I.count);const F=pm(e,I);for(let N=0;N<I.count;N++)y.vertexArray.emplaceBack(F[3*N],F[3*N+1],F[3*N+2]);if(y.vertexArray._trim(),y.aabb=new mr(I.min,I.max),y.centroid=(function(N,H){const W=[0,0,0],ne=N.length;if(ne>0){for(let ue=0;ue<ne;ue++){const ae=3*N[ue];W[0]+=H[ae],W[1]+=H[ae+1],W[2]+=H[ae+2]}W[0]/=ne,W[1]/=ne,W[2]/=ne}return W})(P,F),p.COLOR_0!==void 0){const N=e.json.accessors[p.COLOR_0],H=fy[N.type],W=pm(e,N);y.colorArray=H===3?new to:new Ho,y.colorArray.resize(N.count),P0(e,N,y.colorArray,W)}if(p.NORMAL!==void 0){y.normalArray=new to;const N=e.json.accessors[p.NORMAL];y.normalArray.resize(N.count);const H=pm(e,N);P0(e,N,y.normalArray,H)}if(p.TEXCOORD_0!==void 0&&n.length>0){y.texcoordArray=new Rc;const N=e.json.accessors[p.TEXCOORD_0];y.texcoordArray.resize(N.count);const H=pm(e,N);P0(e,N,y.texcoordArray,H)}if(p._FEATURE_ID_RGBA4444!==void 0){const N=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=pm(e,N))}p._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(pm(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));const B=o.material;return y.material=(function(N,H){const{emissiveFactor:W=[0,0,0],alphaMode:ne="OPAQUE",alphaCutoff:ue=.5,normalTexture:ae,occlusionTexture:fe,emissiveTexture:ye,doubleSided:be,name:Ie}=N,{baseColorFactor:Re=[1,1,1,1],metallicFactor:Ne=1,roughnessFactor:Ve=1,baseColorTexture:Be,metallicRoughnessTexture:He}=N.pbrMetallicRoughness||{},Ye=fe?H[fe.index]:void 0;if(fe&&fe.extensions&&fe.extensions.KHR_texture_transform&&Ye){const yt=fe.extensions.KHR_texture_transform;Ye.offsetScale=[yt.offset[0],yt.offset[1],yt.scale[0],yt.scale[1]]}return{name:Ie,pbrMetallicRoughness:{baseColorFactor:new _r(...Re),metallicFactor:Ne,roughnessFactor:Ve,baseColorTexture:Be?H[Be.index]:void 0,metallicRoughnessTexture:He?H[He.index]:void 0},doubleSided:be,emissiveFactor:new _r(...W),alphaMode:ne,alphaCutoff:ue,normalTexture:ae?H[ae.index]:void 0,occlusionTexture:Ye,emissionTexture:ye?H[ye.index]:void 0,defined:N.defined===void 0}})(B!==void 0?e.json.materials[B]:{defined:!1},n),y}function uv(o,e,n){const{matrix:l,rotation:p,translation:y,scale:b,mesh:T,extras:P,children:I,name:F}=o,B={};if(B.name=F,B.localMatrix=l||(function(N,H,W,ne){var ue=H[0],ae=H[1],fe=H[2],ye=H[3],be=ue+ue,Ie=ae+ae,Re=fe+fe,Ne=ue*be,Ve=ue*Ie,Be=ue*Re,He=ae*Ie,Ye=ae*Re,yt=fe*Re,ft=ye*be,gt=ye*Ie,Tt=ye*Re,Et=ne[0],St=ne[1],ht=ne[2];return N[0]=(1-(He+yt))*Et,N[1]=(Ve+Tt)*Et,N[2]=(Be-gt)*Et,N[3]=0,N[4]=(Ve-Tt)*St,N[5]=(1-(Ne+yt))*St,N[6]=(Ye+ft)*St,N[7]=0,N[8]=(Be+gt)*ht,N[9]=(Ye-ft)*ht,N[10]=(1-(Ne+He))*ht,N[11]=0,N[12]=W[0],N[13]=W[1],N[14]=W[2],N[15]=1,N})([],p||[0,0,0,1],y||[0,0,0],b||[1,1,1]),B.globalMatrix=Y(B.localMatrix),T!==void 0){B.meshes=n[T];const N=B.anchor=[0,0];for(const H of B.meshes){const{min:W,max:ne}=H.aabb;N[0]+=W[0]+ne[0],N[1]+=W[1]+ne[1]}N[0]=Math.floor(N[0]/B.meshes.length/2),N[1]=Math.floor(N[1]/B.meshes.length/2)}if(P&&(P.id&&(B.id=P.id),P.lights&&(B.lights=(function(N){if(!N.length)return[];const H=(function(fe){const ye=atob(fe),be=new Uint8Array(ye.length);for(let Ie=0;Ie<ye.length;Ie++)be[Ie]=ye.codePointAt(Ie);return be})(N),W=[],ne=H.length/24,ue=new Uint16Array(H.buffer),ae=new Float32Array(H.buffer);for(let fe=0;fe<ne;fe++){const ye=ue[2*fe*6]/30,be=ue[2*fe*6+1]/30,Ie=ue[2*fe*6+10]/100,Re=ae[6*fe+1],Ne=ae[6*fe+2],Ve=ae[6*fe+3],Be=ae[6*fe+4],He=Ve-Re,Ye=Be-Ne,yt=Math.hypot(He,Ye);W.push({pos:[Re+.5*He,Ne+.5*Ye,be],normal:[Ye/yt,-He/yt,0],width:yt,height:ye,depth:Ie,points:[Re,Ne,Ve,Be]})}return W})(P.lights)),P.MAPBOX_geometry_bloom&&(B.isGeometryBloom=P.MAPBOX_geometry_bloom)),I){const N=[];for(const H of I)N.push(uv(e.json.nodes[H],e,n));B.children=N}return B}function gw(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new lm(o.vertices,o.indices,8,256),[n,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:n,max:l}}function yw(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const l=[];for(const b of n){if(!Array.isArray(b)||b.length!==2)continue;const T=b[0],P=b[1];typeof T=="number"&&typeof P=="number"&&l.push(new Pt(T,P))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let p=0;for(let b=0;b<l.length;b++){const T=l[b],P=l[(b+1)%l.length],I=l[(b+2)%l.length];p+=(T.x-P.x)*(I.y-P.y)-(I.x-P.x)*(T.y-P.y)}p>0&&l.reverse();const y=Yo(l.flatMap(b=>[b.x,b.y]),[]);return y.length===0?null:{vertices:l,indices:y}}function _w(o,e){const n=[],l=[];let p=0;const y=[];for(const b of o){p=n.length;const T=b.vertexArray.float32,P=b.indexArray.uint16;for(let I=0;I<b.vertexArray.length;I++)y[0]=T[3*I+0],y[1]=T[3*I+1],y[2]=T[3*I+2],Ui(y,y,e),n.push(new Pt(y[0],y[1]));for(let I=0;I<3*b.indexArray.length;I++)l.push(P[I]+p)}if(l.length%3!=0)return null;for(let b=0;b<l.length;b+=3){const T=n[l[b+0]],P=n[l[b+1]],I=n[l[b+2]];(T.x-P.x)*(I.y-P.y)-(I.x-P.x)*(T.y-P.y)>0&&([l[b+1],l[b+2]]=[l[b+2],l[b+1]])}return{vertices:n,indices:l}}function I0(o){const e=(function(P,I){const F=[],B=WebGL2RenderingContext;if(P.json.textures)for(const N of P.json.textures){const H={magFilter:B.LINEAR,minFilter:B.NEAREST,wrapS:B.REPEAT,wrapT:B.REPEAT};N.sampler!==void 0&&Object.assign(H,P.json.samplers[N.sampler]),F.push({image:I[N.source],sampler:H,uploaded:!1})}return F})(o,o.images),n=(function(P,I){const F=[];for(const B of P.json.meshes){const N=[];for(const H of B.primitives)N.push(mw(H,P,I));F.push(N)}return F})(o,e),{scenes:l,scene:p,nodes:y}=o.json,b=l?l[p||0].nodes:[...y.keys()],T=[];for(const P of b)T.push(uv(y[P],o,n));return(function(P,I,F){const B={},N=new Set;for(let H=0;H<P.length;H++){const W=F[I[H]];if(!W.extras)continue;const ne=W.extras["mapbox:footprint:version"],ue=W.extras["mapbox:footprint:id"];(ne||ue)&&N.add(H),ne==="1.0.0"&&ue&&(B[ue]=H)}for(let H=0;H<P.length;H++){if(N.has(H))continue;const W=P[H],ne=F[I[H]];if(!ne.extras)continue;let ue=null;W.id in B&&(ue=_w(P[B[W.id]].meshes,W.localMatrix)),ue||(ue=yw(ne)),ue&&(W.footprint=gw(ue))}if(N.size>0){const H=Array.from(N.values()).sort((W,ne)=>W-ne);for(let W=H.length-1;W>=0;W--)P.splice(H[W],1)}})(T,b,o.json.nodes),T}function xw(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,n=o.aabb.min[0]-1,l=o.aabb.min[1]-1,p=fm/(o.aabb.max[0]-n+2),y=fm/(o.aabb.max[1]-l+2);for(let b=0;b<e.length;b+=3){const T=e[b+2],P=(e[b+0]-n)*p|0,I=(e[b+1]-l)*y|0;T>o.heightmap[I*fm+P]&&(o.heightmap[I*fm+P]=T)}}function hv(o,e,n,l,p){n.reserve(n.length+4*o.length),l.reserve(l.length+10*o.length),p.reserve(p.length+10*o.length);let y=l.length;for(const b of o){const T=Math.min(10,Math.max(4,1.3*b.height))*e,P=[-b.normal[1],b.normal[0],0],I=Math.min(.29,.1*b.width/b.depth),F=b.width-2*b.depth*e*(I+.01),B=Ct([],b.pos,P,F/2),N=Ct([],b.pos,P,-F/2),H=[B[0],B[1],B[2]+b.height],W=[N[0],N[1],N[2]+b.height],ne=Ct([],b.normal,P,I);ct(ne,ne,T);const ue=Ct([],b.normal,P,-I);ct(ue,ue,T),pe(ne,B,ne),pe(ue,N,ue),B[2]+=.1,N[2]+=.1,l.emplaceBack(ne[0],ne[1],ne[2]),l.emplaceBack(ue[0],ue[1],ue[2]),l.emplaceBack(B[0],B[1],B[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(H[0],H[1],H[2]),l.emplaceBack(W[0],W[1],W[2]),l.emplaceBack(B[0],B[1],B[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(ne[0],ne[1],ne[2]),l.emplaceBack(ue[0],ue[1],ue[2]);const ae=F/T/2;p.emplaceBack(-ae-I,-1,ae,.8),p.emplaceBack(ae+I,-1,ae,.8),p.emplaceBack(-ae,0,ae,1.3),p.emplaceBack(ae,0,ae,1.3),p.emplaceBack(ae+I,-.8,ae,.7),p.emplaceBack(ae+I,-.8,ae,.7),p.emplaceBack(0,0,ae,1.3),p.emplaceBack(0,0,ae,1.3),p.emplaceBack(ae+I,-1.2,ae,.8),p.emplaceBack(ae+I,-1.2,ae,.8),n.emplaceBack(6+y,4+y,8+y),n.emplaceBack(7+y,9+y,5+y),n.emplaceBack(0+y,1+y,2+y),n.emplaceBack(1+y,3+y,2+y),y+=10}}function bw(o,e){const n={};n.indexArray=new qn,n.vertexArray=new to,n.colorArray=new Ho,hv(o,e,n.indexArray,n.vertexArray,n.colorArray);const l={defined:!0};l.emissiveFactor=_r.black;const p={};return p.baseColorFactor=_r.white,l.pbrMetallicRoughness=p,n.material=l,n.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const dv=Xi([{name:"a_pos_3f",components:3,type:"Float32"}]),ww=Xi([{name:"a_normal_3",components:3,type:"Int16"}]),Ew=Xi([{name:"a_centroid_3",components:3,type:"Int16"}]),fv=Xi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Sw=Xi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Tw=Xi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Aw=Xi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Cw=Xi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Rw=Xi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),pv=Yi.types,P_=32767;function Mw(o,e){const n=$t+e;for(const l of o)for(const p of l)if(p.x<-e||p.x>n||p.y<-e||p.y>n)return!1;return!0}function Pw(o){switch(o){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${o}`)}}class D0{constructor(){this.layoutVertexArray=new to,this.layoutAttenuationArray=new Ho,this.layoutColorArray=new io,this.indexArray=new qn,this.indexArrayForConflation=new qn,this.segmentsBucket=new $r}}class k0{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new $r,this.entranceBloom=new D0;const n=66560;this.layoutVertexArray=new to,this.layoutVertexArray.reserve(n),this.layoutNormalArray=new Go,this.layoutNormalArray.reserve(n),this.layoutCentroidArray=new Go,this.layoutCentroidArray.reserve(n),this.layoutColorArray=new io,this.layoutColorArray.reserve(n),this.layoutFloodLightDataArray=new mh,this.layoutFloodLightDataArray.reserve(n),this.layoutAOArray=new Ad,this.layoutAOArray.reserve(n),this.indexArray=new qn,this.indexArray.reserve(66560),this.indexArrayForConflation=new qn,this.segmentsBucket=new $r,this.entranceBloom=new D0,e&&(this.layoutFacadePaintArray=new io,this.layoutFacadeDataArray=new du,this.layoutFacadeVerticalRangeArray=new io)}reserve(e,n,l){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(n),l&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class mv{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Rc,this.footprintsIndices=new mh,this.footprintsMin=new Pt(1/0,1/0),this.footprintsMax=new Pt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new k0(!1),this.buildingWithFacade=new k0(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.groundEffect=new nn(e),this.groundEffect.groundRadiusArray=new ds,this.hasAppearances=null}updateFootprints(e,n){const l=new lm([],[],1),p={vertices:[],indices:new Uint32Array(0),grid:l,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};n.push({footprint:p,id:e})}updateAppearances(e,n,l,p){}prepare(){return(function(){if(w_!=null||Gx!=null)return null;if(hg!=null)return hg;const e=fetch(Yn.BUILDING_GEN_URL);return hg=(function(n){let l,p,y,b,T;function P(){l=new Uint8Array(T.buffer),p=new Int16Array(T.buffer),y=new Int32Array(T.buffer),b=new Float32Array(T.buffer)}function I(){throw new Error("Unexpected BuildingGen error.")}const F=()=>{},B={a:{a:I,f:function(N){const H=l.length,W=Math.max(N>>>0,Math.ceil(1.2*H)),ne=Math.ceil((W-H)/65536);try{return T.grow(ne),P(),!0}catch{return!1}},g:I,b:F,c:F,d:F,e:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,B):n.then(N=>N.arrayBuffer()).then(N=>WebAssembly.instantiate(N,B))).then(N=>{const H=N.instance.exports;return(0,H.g)(),T=H.f,P(),new Jb({setStyle:H.h,setAOOptions:H.i,setMetricOptions:H.j,setStructuralOptions:H.k,setFacadeOptions:H.l,setFauxFacadeOptions:H.m,setFacadeClassifierOptions:H.n,addFeature:H.o,addFacade:H.p,generateMesh:H.q,getLastError:H.r,getOuterRingLength:H.s,getMeshCount:H.t,getPositionsPtr:H.u,getPositionsLength:H.v,getNormalsPtr:H.w,getNormalsLength:H.x,getAOPtr:H.y,getAOLength:H.z,getUVPtr:H.A,getUVLength:H.B,getFauxFacadePtr:H.C,getFauxFacadeLength:H.D,getIndicesPtr:H.E,getIndicesLength:H.F,getBuildingPart:H.G,getRingCount:H.H,getRingPtr:H.I,getRingLength:H.J,malloc:H.K,free:H.L,heapU8:l,heap16:p,heap32:y,heapF32:b})})})(e).then(n=>(hg=null,w_=n,w_)).catch(n=>{Pi("Could not load building-gen"),hg=null,Gx=n}),hg})()}populate(e,n,l,p){const y=ew();if(!y)return;const b=Lt(l);this.tileToMeter=b,this.brightness=n.brightness,y.setStyle({normalScale:[1,-1,b],tileToMeters:b}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeClassifierOptions(3);const T=new Map,P=new Map;let I=0;for(const{feature:ae}of e){if(pv[ae.type]!=="LineString"){T.set(ae.id,ae.properties.source_id);continue}const fe=this.layers[0]._featureFilter.needGeometry;if(fe&&!this.layers[0]._featureFilter.filter(new xr(this.zoom),ae,l))continue;const ye=Fi(ae,fe);if(!fe&&!this.layers[0]._featureFilter.filter(new xr(this.zoom),ye,l))continue;const be=fe?ye.geometry:Ti(ae,l,p),Ie=[];for(const Be of be)for(const He of Be)Ie.push(He.x),Ie.push(He.y);const Re={coordinates:Ie,crossPerc:ae.properties.cross_perc,distanceToRoad:ae.properties.distance_to_road,entrances:ae.properties.entrances,sourceId:0},Ne=ae.properties.source_id;let Ve=P.get(Ne);Ve||(Ve=[],P.set(Ne,Ve)),Ve.push(Re),++I}this.maxHeight=0;const F=new Array,B=new Set,N=ae=>{ae!=null&&B.add(ae)},H=(ae,fe)=>{ae!=null&&F.push({buildingId:ae,footprintIndex:fe})},W=64*(e.length-I),ne=W/2;this.buildingWithFacade.reserve(W,ne,!0),this.buildingWithoutFacade.reserve(2*W,2*ne,!1),this.footprintsIndices.reserve(16*(e.length-I)),this.footprintsVertices.reserve(8*(e.length-I));for(const{feature:ae,id:fe,index:ye,sourceLayerIndex:be}of e){if(pv[ae.type]==="LineString")continue;const Ie=this.layers[0]._featureFilter.needGeometry;if(Ie&&!this.layers[0]._featureFilter.filter(new xr(this.zoom),ae,l))continue;let Re=null;if(ae.properties&&ae.properties.hasOwnProperty("building_id")&&(Re=Number(ae.properties.building_id),B.has(Re)))continue;const Ne=Fi(ae,Ie);if(!Ie&&!this.layers[0]._featureFilter.filter(new xr(this.zoom),Ne,l))continue;const Ve=Ie?Ne.geometry:Ti(ae,l,p),Be=rm(Ve,500);let He=!1;for(const Zi of Be)if(Zi.length!==1){He=!0;break}if(He){N(Re);continue}if(!Mw(Ve,163)){N(Re);continue}const Ye=this.layers[0],yt=Pw(Ye.layout.get("building-roof-shape").evaluate(ae,{},l)),ft=Ye.layout.get("building-base").evaluate(ae,{},l),gt=Ye.layout.get("building-height").evaluate(ae,{},l),Tt=Ye.layout.get("building-flood-light-ground-radius").evaluate(ae,{},l),Et=Ye.paint.get("building-ambient-occlusion-intensity"),St=Tt/this.tileToMeter;ae.properties["building-part"]="roof";const ht=Ye.paint.get("building-color").evaluate(ae,{},this.canonical).toPremultipliedRenderColor(this.lut),Rt=Ye.paint.get("building-emissive-strength").evaluate(ae,{},this.canonical);ae.properties["building-part"]="wall";const vt=Ye.paint.get("building-color").evaluate(ae,{},this.canonical).toPremultipliedRenderColor(this.lut),Mt=Ye.paint.get("building-emissive-strength").evaluate(ae,{},this.canonical);ae.properties["building-part"]="window";const At=Ye.paint.get("building-color").evaluate(ae,{},this.canonical).toPremultipliedRenderColor(this.lut),ti=Ye.paint.get("building-emissive-strength").evaluate(ae,{},this.canonical);ae.properties["building-part"]="door";const ri=Ye.paint.get("building-color").evaluate(ae,{},this.canonical).toPremultipliedRenderColor(this.lut),Zt=Ye.paint.get("building-emissive-strength").evaluate(ae,{},this.canonical);let Kt=Ye.layout.get("building-flood-light-wall-radius").evaluate(ae,{},l);Kt=Oe(Kt,0,2048);const Ei=Kt/2048*P_,pi=T.get(fe),ei=P.get(pi)||[],ki=ei.length!==0&&Ye.layout.get("building-facade").evaluate(ae,{},l);y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(ki,!1,1);let Qi=0,yr=0,Wi=0,Ir=0,cr=0,zn=0,hr=0,Rr=0,Jr=0,on=0,ln=0;if(ki){let Zi=Math.round(Ye.layout.get("building-facade-floors").evaluate(ae,{},l));if(ft===0){Zi=Math.max(1,Zi-(ei.length>0?1:0));let Bn=4;if(gt>100){const ms=[10,13,15];Bn=ms[ae.id?ae.id%ms.length:0]}else gt<=10&&(Bn=3);y.setFacadeOptions(Bn,!0),cr=(gt<15?1.3:1.61803)*Bn/b}else cr=ft/b;zn=gt/b,cr=Math.min(cr,zn),Wi=Ye.layout.get("building-facade-unit-width").evaluate(ae,{},l)/b,Ir=(zn-cr)/Zi,y.setFauxFacadeOptions(!0,!0,Wi);const Ds=Ye.layout.get("building-facade-window").evaluate(ae,{},l);Qi=Ds[0],yr=Ds[1],hr=Math.floor(65535*Math.min(1,cr/$t)),Rr=Math.floor(65535*Math.min(1,zn/$t)),Jr=Math.floor(255*Qi)<<8|Math.floor(255*yr),on=Math.floor(65535*Math.min(1,Wi/$t)),ln=Math.floor(65535*Math.min(1,Ir/$t))}const Fn=Array(Be.length),Us={x:1/0,y:1/0},ma={x:-1/0,y:-1/0},ss={x:0,y:0};let ps=0;for(let Zi=0;Zi<Be.length;Zi++){const Ds=Be[Zi];if(Ds.length>0){const Bn=[],ms=Array(Ds.length+1);ms[0]=0;for(let nc=0;nc<Ds.length;nc++){const Eo=Ds[nc];for(let el=0;el<Eo.length;el++){const ks=Eo[Eo.length-el-1];Us.x=Math.min(Us.x,ks.x),Us.y=Math.min(Us.y,ks.y),ma.x=Math.max(ma.x,ks.x),ma.y=Math.max(ma.y,ks.y),ss.x+=ks.x,ss.y+=ks.y,ps++,Bn.push(ks.x),Bn.push(ks.y)}ms[nc+1]=Bn.length}Fn[Zi]={id:ae.id?ae.id:0,height:gt,minHeight:ft,sourceId:0,roofType:yt,coordinates:Bn,ringIndices:ms}}}ss.x/=ps||1,ss.y/=ps||1;const Ts=y.generateMesh(Fn,ei);if(typeof Ts=="string"){Pi(`Unable to generate building ${ae.id}: ${Ts}`),N(Re);continue}if(Ts.meshes.length===0||Ts.modifiedPolygonRings.length===0){N(Re);continue}const qi=ki?this.buildingWithFacade:this.buildingWithoutFacade;let un=0;for(const Zi of Ts.meshes)un+=Zi.positions.length/3;const En=qi.segmentsBucket.prepareSegment(un,qi.layoutVertexArray,qi.indexArray),Jo=[];let Ga=null,Gs=0,$a=-1;const Ph=qi.layoutVertexArray.length,Pa=Ph+un;qi.layoutVertexArray.resize(Pa),qi.layoutCentroidArray.resize(Pa),qi.layoutNormalArray.resize(Pa),qi.layoutAOArray.resize(Pa),qi.layoutColorArray.resize(Pa),qi.layoutFloodLightDataArray.resize(Pa),ki&&(qi.layoutFacadePaintArray.resize(Pa),qi.layoutFacadeDataArray.resize(Pa),qi.layoutFacadeVerticalRangeArray.resize(Pa));const t0=qi.indexArray.length;let Sg=0,so=Ph;for(const Zi of Ts.meshes){let Ds,Bn;if(Zi.buildingPart===1)Ds=ht,Bn=Rt;else if(Zi.buildingPart===0)Ds=vt,Bn=Mt;else if(Zi.buildingPart===2)Ds=At,Bn=ti;else{if(Zi.buildingPart!==3)continue;Ds=ri,Bn=Zt}if(Bn=Oe(Bn,0,1),Zi.buildingPart===3){const as=new Array;for(let Da=0;Da<Zi.positions.length;Da+=12){const Xf=Zi.positions[Da+0],Hs=Zi.positions[Da+1],So=Zi.positions[Da+3],Fc=Zi.positions[Da+4],kh=Zi.positions[Da+2],vx=Zi.positions[Da+8]-kh,bx=1,jy=So-Xf,Ag=Fc-Hs,Mu=Math.hypot(jy,Ag);as.push({pos:[Xf+.5*jy,Hs+.5*Ag,kh],normal:[Ag/Mu,-jy/Mu,0],width:Mu,height:vx,depth:bx,points:[Xf,Hs,So,Fc]})}const $s=qi.entranceBloom.segmentsBucket.prepareSegment(10*as.length,qi.entranceBloom.layoutVertexArray,qi.entranceBloom.indexArray),gs=qi.entranceBloom.layoutVertexArray.length;Gs=qi.entranceBloom.indexArray.length,hv(as,.5/this.tileToMeter,qi.entranceBloom.indexArray,qi.entranceBloom.layoutVertexArray,qi.entranceBloom.layoutAttenuationArray);const Ia=qi.entranceBloom.layoutVertexArray.length-gs;$a=qi.entranceBloom.indexArray.length-Gs;for(let Da=0;Da<Ia;Da++)qi.entranceBloom.layoutColorArray.emplaceBack(255*ri.r<<8|255*ri.g,255*ri.b<<8|51*Zt);$s.vertexLength+=Ia,$s.primitiveLength+=$a,Ga={part:Zi.buildingPart,vertexOffset:gs,vertexLength:Ia}}qi.layoutVertexArray.float32.set(Zi.positions,3*so);const ms=Zi.positions.length/3;for(let as=0;as<ms;++as){const $s=3*as;Sg=Math.max(Sg,Zi.positions[$s+2]);const gs=Zi.normals[$s+1]*P_,Ia=Zi.normals[$s+2]*P_,Da=3*(so+as);qi.layoutNormalArray.int16[Da]=Zi.normals[$s]*P_,qi.layoutNormalArray.int16[Da+1]=gs,qi.layoutNormalArray.int16[Da+2]=Ia;const Xf=Zi.ao[as];qi.layoutAOArray.uint8[so+as]=255*Xf;const Hs=1+(Xf-1)*Et,So=255*Ds.b*Hs<<8|255*Bn;qi.layoutColorArray.uint16[2*(so+as)]=255*Ds.r*Hs<<8|255*Ds.g*Hs,qi.layoutColorArray.uint16[2*(so+as)+1]=So}const nc=Math.floor(ss.x),Eo=Math.floor(ss.y),el=Math.floor(gt);for(let as=0;as<ms;++as){const $s=3*(so+as);qi.layoutCentroidArray.int16[$s]=nc,qi.layoutCentroidArray.int16[$s+1]=Eo,qi.layoutCentroidArray.int16[$s+2]=el}if(qi.layoutFloodLightDataArray.uint16.fill(Zi.buildingPart===0?Ei:0,so,so+ms),ki){const as=255*At.r<<8|255*At.g,$s=255*At.b<<8|255*ti;for(let gs=0;gs<ms;++gs){const Ia=2*(so+gs);qi.layoutFacadePaintArray.uint16[Ia]=as,qi.layoutFacadePaintArray.uint16[Ia+1]=$s}for(let gs=0;gs<ms;++gs)if(Zi.isFauxFacade[gs]){const Ia=Math.min(65535,Math.floor(Zi.uv[2*gs]*Ts.outerRingLength));qi.layoutFacadeDataArray.emplace(so+gs,1|Ia,Jr,on,ln),qi.layoutFacadeVerticalRangeArray.emplace(so+gs,hr,Rr)}else qi.layoutFacadeDataArray.emplace(so+gs,0,0,0,0),qi.layoutFacadeVerticalRangeArray.emplace(so+gs,0,0)}const ks=En.vertexLength,By=Zi.indices.length/3,Dh=qi.indexArray.length;qi.indexArray.resize(Dh+By);for(let as=0;as<By;++as){const $s=3*as,gs=3*Dh+$s;qi.indexArray.uint16[gs]=ks+Zi.indices[$s],qi.indexArray.uint16[gs+1]=ks+Zi.indices[$s+1],qi.indexArray.uint16[gs+2]=ks+Zi.indices[$s+2]}Zi.buildingPart!==1&&Zi.buildingPart!==0&&Zi.buildingPart!==2&&Zi.buildingPart!==3||Jo.push({part:Zi.buildingPart,vertexOffset:so,vertexLength:Zi.positions.length/3}),so+=ms,En.vertexLength+=ms,En.primitiveLength+=Zi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Sg);const i0=qi.indexArray.length-t0,Ih=this.footprintsIndices.length,jd=this.footprintsVertices.length,Zf=[],rc=new Pt(1/0,1/0),zc=new Pt(-1/0,-1/0),Fy=this.groundEffect.vertexArray.length;for(const Zi of Ts.modifiedPolygonRings){const Ds=[],Bn=new Pt(1/0,1/0),ms=new Pt(-1/0,-1/0);for(let nc=0;nc<Zi.length;nc+=2){const Eo=Zi.length-nc-2;Bn.x=Math.min(Bn.x,Zi[Eo]),Bn.y=Math.min(Bn.y,Zi[Eo+1]),ms.x=Math.max(ms.x,Zi[Eo]),ms.y=Math.max(ms.y,Zi[Eo+1]);const el=new Pt(Zi[Eo],Zi[Eo+1]);Ds.push(el),Zf.push(el.x,el.y),this.footprintsVertices.emplaceBack(el.x,el.y)}rc.x=Math.min(rc.x,Bn.x),rc.y=Math.min(rc.y,Bn.y),zc.x=Math.max(zc.x,ms.x),zc.y=Math.max(zc.y,ms.y),this.groundEffect.addData(Ds,[Bn,ms],St)}const Tg=this.groundEffect.vertexArray.length-Fy;this.groundEffect.groundRadiusArray.reserveForAdditional(Tg);for(let Zi=0;Zi<Tg;Zi++)this.groundEffect.groundRadiusArray.emplaceBack(Tt);(Us.x<0||ma.x>$t||Us.y<0||ma.y>$t)&&this.featuresOnBorder.push({featureId:ae.id,footprintIndex:this.footprints.length});{const Zi=Yo(Zf,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Zi.length),this.footprintsIndices.uint16.set(Zi,Ih),this.buildingIds.add(Re??ae.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,rc.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,rc.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,zc.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,zc.y);const Ds={footprintVertexOffset:jd,footprintVertexLength:this.footprintsVertices.length-jd,footprintIndexOffset:Ih,footprintIndexLength:this.footprintsIndices.length-Ih,min:rc,max:zc,hiddenFlags:0,indicesOffset:t0,indicesLength:i0,bloomIndicesOffset:Gs,bloomIndicesLength:$a,groundEffectVertexOffset:Fy,groundEffectVertexLength:Tg,hasFauxFacade:ki,height:Sg,promoteId:fe,feature:Ne,parts:Jo,buildingBloom:Ga},Bn=this.footprints.length;ae.id!==void 0&&this.featureFootprintLookup.set(ae.id,Bn),H(Re,Bn),this.footprints.push(Ds)}this.programConfigurations.populatePaintArrays(qi.layoutVertexArray.length,ae,ye,{},n.availableImages,l,n.brightness),this.groundEffect.addPaintPropertiesData(ae,ye,{},n.availableImages,l,n.brightness),n.featureIndex.insert(ae,Ve,ye,be,this.index,Ph)}F.forEach(({buildingId:ae,footprintIndex:fe})=>{B.has(ae)&&(this.footprints[fe].hiddenFlags|=4)});const ue=new Set;this.buildingIds.forEach((ae,fe,ye)=>{B.has(ae)||ue.add(ae)}),this.buildingIds=ue,this.groundEffect.prepareBorderSegments()}update(e,n,l,p,y,b,T){this.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T),this.groundEffect.update(e,n,y,l,p,b,T),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,dv.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,ww.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,Ew.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,Rw.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,Tw.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,Aw.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,dv.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,Cw.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,l=!0){let p=!1;const y=l?n:0,b=0|(l?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const T of e){const P=this.footprints[T],I=P.hiddenFlags&b|y;P.hiddenFlags!==I&&(P.hiddenFlags=I,p=!0,this.groundEffect.updateHiddenByLandmarkRange(P.groundEffectVertexOffset,P.groundEffectVertexLength,P.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const p of this.footprints){const y=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,b=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let P=p.indicesOffset;P<b;P++)y.indexArrayForConflation.uint16[3*P+0]=0,y.indexArrayForConflation.uint16[3*P+1]=0,y.indexArrayForConflation.uint16[3*P+2]=0;const T=p.bloomIndicesOffset+p.bloomIndicesLength;for(let P=p.bloomIndicesOffset;P<T;P++)y.entranceBloom.indexArrayForConflation.uint16[3*P+0]=0,y.entranceBloom.indexArrayForConflation.uint16[3*P+1]=0,y.entranceBloom.indexArrayForConflation.uint16[3*P+2]=0}}const l=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=e.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=e.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,fv.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,Sw.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,fv.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const l=e.paint.get("building-ambient-occlusion-intensity");for(const p of this.footprints){if(4&p.hiddenFlags)continue;const y=n[p.promoteId],b=p.feature;b.properties["building-part"]="roof";const T=e.paint.get("building-color").evaluate(b,y,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(b,y,this.canonical);b.properties["building-part"]="wall";const I=e.paint.get("building-color").evaluate(b,y,this.canonical).toPremultipliedRenderColor(this.lut),F=e.paint.get("building-emissive-strength").evaluate(b,y,this.canonical);b.properties["building-part"]="window";const B=e.paint.get("building-color").evaluate(b,y,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(b,y,this.canonical);b.properties["building-part"]="door";const H=e.paint.get("building-color").evaluate(b,y,this.canonical).toPremultipliedRenderColor(this.lut),W=e.paint.get("building-emissive-strength").evaluate(b,y,this.canonical),ne=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ae of p.parts){let fe,ye=T;ae.part===1?(ye=T,fe=P):ae.part===0?(ye=I,fe=F):ae.part===2?(ye=B,fe=N):ae.part===3&&(ye=H,fe=W),fe=Oe(fe,0,1);for(let be=0;be<ae.vertexLength;be++){const Ie=ae.vertexOffset+be,Re=1+(ne.layoutAOArray.uint8[Ie]/255-1)*l;ne.layoutColorArray.emplace(Ie,ye.r*Re*255<<8|ye.g*Re*255,ye.b*Re*255<<8|255*fe),p.hasFauxFacade&&ne.layoutFacadePaintArray.emplace(Ie,255*B.r<<8|255*B.g,255*B.b<<8|255*N)}}const ue=p.buildingBloom;if(ue)for(let ae=0;ae<ue.vertexLength;ae++)ne.entranceBloom.layoutColorArray.emplace(ue.vertexOffset+ae,255*H.r<<8|255*H.g,255*H.b<<8|51*W)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const p=n.getReplacementRegionsForTile(e.toUnwrapped());if(f(this.activeReplacements,p))return;this.activeReplacements=p;for(const b of this.footprints)b.hiddenFlags&=-2;const y=[];for(const b of this.activeReplacements){if(b.order<l)continue;const T=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-e.canonical.z));for(const P of this.footprints)P.min.x>b.max.x||P.max.x<b.min.x||P.min.y>b.max.y||P.max.y<b.min.y||(y.length=0,Dw(this.footprintsVertices,P.footprintVertexOffset,P.footprintVertexLength,b.footprintTileId.canonical,e.canonical,y),L(b.footprint,y,this.footprintsIndices.uint16,P.footprintIndexOffset,P.footprintIndexLength,0,-T)&&(P.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,p=!0;const y=4*(e+$t)*$t+(n+$t);if(this.footprintLookup.hasOwnProperty(y)){const T=this.footprintLookup[y];return T?{height:T.height,hidden:T.hiddenFlags!==0}:void 0}const b=new Pt(e,n);for(const T of this.footprints)e>T.max.x||T.min.x>e||n>T.max.y||T.min.y>n||T.height<=l||Iw(b,this.footprintsVertices.float32.subarray(2*T.footprintVertexOffset,2*(T.footprintVertexOffset+T.footprintVertexLength)),this.footprintsIndices.uint16.subarray(T.footprintIndexOffset,T.footprintIndexOffset+T.footprintIndexLength))&&(l=T.height,this.footprintLookup[y]=T,p=T.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:p};this.footprintLookup[y]=void 0}}function Iw(o,e,n){for(let l=0;l<n.length;l+=3){const p=n[l],y=n[l+1],b=n[l+2],T=e[2*p+0],P=e[2*p+1],I=e[2*y+0],F=e[2*y+1],B=e[2*b+0],N=e[2*b+1],H=(T-B)*(o.y-N)-(P-N)*(o.x-B),W=(I-T)*(o.y-P)-(F-P)*(o.x-T);if(H<0!=W<0&&H!==0&&W!==0)continue;const ne=(B-I)*(o.y-F)-(N-F)*(o.x-I);if(ne===0||ne<0==H+W<=0)return!0}return!1}function Dw(o,e,n,l,p,y){const b=Math.pow(2,l.z-p.z);for(let T=0;T<n;T++){let P=o.float32[2*(T+e)+0],I=o.float32[2*(T+e)+1];P=(P+p.x*$t)*b-l.x*$t,I=(I+p.y*$t)*b-l.y*$t,y.push(new Pt(P,I))}}let gv,yv;Ut(mv,"BuildingBucket",{omit:["layers"]}),Ut(k0,"BuildingGeometry"),Ut(D0,"BuildingBloomGeometry");const kw=Xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Lw=Xi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ow}=kw,zw=Xi([{name:"a_packed",components:3,type:"Float32"}]),{members:Fw}=zw,Bw=Xi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:jw}=Bw;class _v{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ic({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const l=this.getKey(e,n);return this.positions[l]}trim(){const e=this.width,n=this.height=It(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){const p=[];let y=e.length%2==1?-e[e.length-1]*l:0,b=e[0]*l,T=!0;p.push({left:y,right:b,isDash:T,zeroLength:e[0]===0});let P=e[0];for(let I=1;I<e.length;I++){T=!T;const F=e[I];y=P*l,P+=F,b=P*l,p.push({left:y,right:b,isDash:T,zeroLength:F===0})}return p}addRoundDash(e,n,l){const p=n/2;for(let y=-l;y<=l;y++){const b=this.width*(this.nextRow+l+y);let T=0,P=e[T];for(let I=0;I<this.width;I++){I/P.right>1&&(P=e[++T]);const F=Math.abs(I-P.left),B=Math.abs(I-P.right),N=Math.min(F,B);let H;const W=y/l*(p+1);if(P.isDash){const ne=p-Math.abs(W);H=Math.sqrt(N*N+ne*ne)}else H=p-Math.sqrt(N*N+W*W);this.image.data[b+I]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e,n){for(let P=e.length-1;P>=0;--P){const I=e[P],F=e[P+1];I.zeroLength?e.splice(P,1):F&&F.isDash===I.isDash&&(F.left=I.left,e.splice(P,1))}const l=e[0],p=e[e.length-1];l.isDash===p.isDash&&(l.left=p.left-this.width,p.right=l.right+this.width);const y=this.width*this.nextRow;let b=0,T=e[b];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++b]);const I=Math.abs(P-T.left),F=Math.abs(P-T.right),B=Math.min(I,F);this.image.data[y+P]=Math.max(0,Math.min(255,(T.isDash?B:-B)+n+128))}}addDash(e,n){const l=this.getKey(e,n);if(this.positions[l])return this.positions[l];const p=n==="round",y=p?7:0,b=2*y+1;if(this.nextRow+b>this.height)return Pi("LineAtlas out of space"),null;e.length===0&&e.push(1);let T=0;for(let F=0;F<e.length;F++)e[F]<0&&(Pi("Negative value is found in line dasharray, replacing values with 0"),e[F]=0),T+=e[F];if(T!==0){const F=this.width/T,B=this.getDashRanges(e,this.width,F);p?this.addRoundDash(B,F,y):this.addRegularDash(B,n==="square"?.5*F:0)}const P=this.nextRow+y;this.nextRow+=b;const I={tl:[P,y],br:[T,0]};return this.positions[l]=I,I}}Ut(_v,"LineAtlas");const Nw=Yi.types,Vw=Math.cos(Math.PI/180*37.5),Uw=Math.cos(Math.PI/180*5);class L0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Rs,this.layoutVertexArray2=new to,this.patternVertexArray=new to,this.indexArray=new qn,this.programConfigurations=new $(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $r,this.maxLineLength=0,this.zOffsetVertexArray=new to,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,p){}populate(e,n,l,p){this.hasPattern=Qg("line",this.layers,this.pixelRatio,n);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Lt(l);const b=this.layers[0].layout.get("line-elevation-reference");if(b==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),H=N.isConstant()&&!N.constantOr(0);this.elevationType=b!=="sea"&&b!=="ground"&&H?"none":"offset",this.elevationType==="offset"&&b==="none"&&Pi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const P=[];for(const{feature:N,id:H,index:W,sourceLayerIndex:ne}of e){const ue=this.layers[0]._featureFilter.needGeometry,ae=Fi(N,ue);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),ae,l))continue;const fe=y?y.evaluate(ae,{},l):void 0,ye={id:H,properties:N.properties,type:N.type,sourceLayerIndex:ne,index:W,geometry:ue?ae.geometry:Ti(N,l,p),patterns:{},sortKey:fe};P.push(ye)}y&&P.sort((N,H)=>N.sortKey-H.sortKey);const{lineAtlas:I,featureIndex:F}=n,B=this.addConstantDashes(I);for(const N of P){const{geometry:H,index:W,sourceLayerIndex:ne}=N;if(B&&this.addFeatureDashes(N,I),this.hasPattern){const ue=Jg("line",this.layers,N,this.zoom,this.pixelRatio,n);this.patternFeatures.push(ue)}else this.addFeature(N,H,W,l,I.positions,n.availableImages,n.brightness,n.elevationFeatures);F.insert(e[W].feature,H,W,ne,this.index)}}addConstantDashes(e){let n=!1;for(const l of this.layers){const p=l.paint.get("line-dasharray").value,y=l.layout.get("line-cap").value;if(p.kind!=="constant"||y.kind!=="constant")n=!0;else{const b=y.value,T=p.value;if(!T)continue;e.addDash(T,b)}}return n}addFeatureDashes(e,n){const l=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(y.kind==="constant"&&b.kind==="constant")continue;let T,P;if(y.kind==="constant"){if(T=y.value,!T)continue}else T=y.evaluate({zoom:l},e);P=b.kind==="constant"?b.value:b.evaluate({zoom:l},e),n.addDash(T,P),e.patterns[p.id]=[n.getKey(T,P)]}}update(e,n,l,p,y,b,T,P){this.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,P)}addFeatures(e,n,l,p,y,b){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,n,l,p,b,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Fw)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,jw)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Lw.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ow),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let l,p;if(n&&n>0?(l=`mapbox_clip_start_${n}`,p=`mapbox_clip_end_${n}`):(l="mapbox_clip_start",p="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(p))return{start:+e.properties[l],end:+e.properties[p]}}addFeature(e,n,l,p,y,b,T,P){const I=this.layers[0].layout,F=I.get("line-join").evaluate(e,{}),B=I.get("line-cap").evaluate(e,{}),N=I.get("line-miter-limit"),H=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const W=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=I.get("line-z-offset").value;const ne=this.layers[0].paint.get("line-width").value;if(ne.kind!=="constant"&&ne.isLineProgressConstant===!1&&(this.variableWidthValue=ne),this.elevationType==="road"){const ue=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,p,P,F,B,N,H)){const[ae,fe]=this.clipRuntimeLinesToTile(n,1);for(let ye=0;ye<ae.length;ye++){const be=ae[ye],Ie=fe[ye],Re={progress:{min:Ie.progress.min,max:Ie.progress.max},nextDir:this.computeSegNextDir(Ie,be),prevDir:this.computeSegPrevDir(Ie,be)};this.addLine(be,e,p,F,B,N,H,Re,W&&Ie.parentIndex>0?Ie.parentIndex:null)}this.fillNonElevatedRoadSegment(ue)}}else for(let ue=0;ue<n.length;ue++)this.addLine(n[ue],e,p,F,B,N,H,void 0,W&&ue>0?ue:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,y,b,p,T,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return v_(e,-n,-n,$t+n,$t+n)}clipRuntimeLinesToTile(e,n){const l=[];return[v_(e,-n,-n,$t+n,$t+n,l),l]}addElevatedRoadFeature(e,n,l,p,y,b,T,P){const I=[],F=Ms.getElevationFeature(e,p);if(F){const B=this.clipLinesToTile(n,1),N=this.prepareElevatedLines(B,F,l);for(const H of N)I.push({geometry:H,elevation:F,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const B of I){const N=this.layoutVertexArray.length;this.addLine(B.geometry,e,l,y,b,T,P);const H=new Va(l,B.elevationTileID);if(B.elevation)for(let W=N;W<this.layoutVertexArray.length;W++){const ne=new Pt(this.layoutVertexArray.int16[6*W]>>1,this.layoutVertexArray.int16[6*W+1]>>1),ue=H.pointElevation(ne,B.elevation,.05);this.updateHeightRange(ue),this.zOffsetVertexArray.emplaceBack(ue,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(e,n,l){if(n.constantHeight!=null)return e;const p=[],y=1/Lt(l);for(const b of e)Xb(b,new Aa(n,y),0,p);return p}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,l,p,y,b,T,P,I){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=I?this.lineFeatureClips(n,I):this.lineClips;const F=p==="none";this.patternJoinNone=this.hasPattern&&F,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const B=P&&P.progress.min>0,N=P&&P.progress.max<1;if(this.lineClips){let Be={min:this.lineClips.start,max:this.lineClips.end},He=1;if(P){const ft=this.lineClips.end-this.lineClips.start;Be=(function(gt,Tt,Et){return{min:ls(gt.min,Tt,Et),max:ls(gt.max,Tt,Et)}})(P.progress,{min:0,max:1},Be),ft>0&&(He=(Be.max-Be.min)/ft)}const Ye=+n.properties.mapbox_clip_feature_len,yt=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(Ye)||Number.isNaN(yt)){for(let gt=0;gt<e.length-1;gt++)this.totalDistance+=e[gt].dist(e[gt+1]);const ft=this.totalDistance/(Be.max-Be.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ye,this.distance=yt*He,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const H=Nw[n.type]==="Polygon";let W=e.length;for(;W>=2&&e[W-1].equals(e[W-2]);)W--;let ne=0;for(;ne<W-1&&e[ne].equals(e[ne+1]);)ne++;if(W<(H?3:2))return;p==="bevel"&&(b=1.05);const ue=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let ae,fe,ye,be,Ie,Re,Ne,Ve;P&&P.prevDir&&(Re=P.prevDir.perp()),P&&P.nextDir&&(Ne=P.nextDir.perp()),this.e1=this.e2=-1,H&&(ae=e[W-2],Ie=e[ne].sub(ae)._unit()._perp());for(let Be=ne;Be<W;Be++){if(ye=Be===W-1?H?e[ne+1]:void 0:e[Be+1],ye&&e[Be].equals(ye))continue;Ie&&(be=Ie),ae&&(fe=ae),ae=e[Be],Ve=this.evaluateLineProgressFeatures(fe?fe.dist(ae):0),Ie=ye?ye.sub(ae)._unit()._perp():be,be=be||Ie;const He=fe&&ye;let Ye=He?p:H||F?"butt":y;const yt=be.x*Ie.x+be.y*Ie.y;if(F){const vt=function(Mt){if(Mt.patternJoinNone){const At=Mt.segmentPoints.length/2,ti=Mt.lineSoFar-Mt.segmentStart;for(let ri=0;ri<At;++ri){const Zt=Mt.segmentPoints[2*ri+1],Kt=Math.round(Mt.segmentPoints[2*ri])+.5+.25*Zt;Mt.patternVertexArray.emplaceBack(Kt,ti,Mt.segmentStart),Mt.patternVertexArray.emplaceBack(Kt,ti,Mt.segmentStart)}Mt.segmentPoints.length=0}Mt.e1=Mt.e2=-1};if(He&&yt<Uw){this.updateDistance(fe,ae),this.addCurrentVertex(ae,be,1,1,ue,Ve),vt(this),this.addCurrentVertex(ae,Ie,-1,-1,ue,Ve);continue}if(fe){if(!ye){this.updateDistance(fe,ae),this.addCurrentVertex(ae,be,1,1,ue,Ve),vt(this);continue}Ye="miter"}}let ft=be.add(Ie);ft.x===0&&ft.y===0||ft._unit();const gt=ft.x*Ie.x+ft.y*Ie.y,Tt=gt!==0?1/gt:1/0,Et=2*Math.sqrt(2-2*gt),St=gt<Vw&&fe&&ye,ht=be.x*Ie.y-be.y*Ie.x>0,Rt=this.overscaling<=16?122880/(512*this.overscaling):0;if(He&&Ye==="round"){if(Tt<T)Ye="miter";else if(Tt<=2){const vt=O0(ae,-10,8202);Ye=this.elevationType==="offset"&&(vt||this.hasCrossSlope)?"miter":"fakeround"}}if(Ye==="miter"&&Tt>b&&(Ye="bevel"),Ye==="bevel"&&(Tt>2&&(Ye="flipbevel"),Tt<b&&(Ye="miter")),fe&&!(Ye==="miter"&&St)&&this.updateDistance(fe,ae),Ye==="miter")if(St){const vt=ae.dist(fe);if(vt>2*Rt){const At=ae.sub(ae.sub(fe)._mult(Rt/vt)._round());this.updateDistance(fe,At),this.addCurrentVertex(At,be,0,0,ue,Ve),fe=At}this.updateDistance(fe,ae),ft._mult(Tt),this.addCurrentVertex(ae,ft,0,0,ue,Ve);const Mt=ae.dist(ye);if(Mt>2*Rt){const At=ae.add(ye.sub(ae)._mult(Rt/Mt)._round());this.updateDistance(ae,At),this.addCurrentVertex(At,Ie,0,0,ue,Ve),ae=At}}else ft._mult(Tt),this.addCurrentVertex(ae,ft,0,0,ue,Ve);else if(Ye==="flipbevel"){if(Tt>100)ft=Ie.mult(-1);else{const vt=Tt*be.add(Ie).mag()/be.sub(Ie).mag();ft._perp()._mult(vt*(ht?-1:1))}this.addCurrentVertex(ae,ft,0,0,ue,Ve),this.addCurrentVertex(ae,ft.mult(-1),0,0,ue,Ve)}else if(Ye==="bevel"||Ye==="fakeround"){Ve!=null&&fe&&this.addCurrentVertex(ae,Ne||be,-1,-1,ue,Ve);const vt=ae.dist(fe)<=2*Rt&&Ye!=="bevel",Mt=ft.mult(ht?1:-1);Mt._mult(Tt);const At=Ie.mult(ht?-1:1),ti=be.mult(ht?-1:1),ri=this.evaluateLineProgressFeatures(this.distance);if(Ve==null&&(this.addHalfVertex(ae,Mt.x,Mt.y,!1,!ht,0,ue,ri),vt||this.addHalfVertex(ae,Mt.x+2*ti.x,Mt.y+2*ti.y,!1,ht,0,ue,ri)),Ye==="fakeround"){const Zt=Math.round(180*Et/Math.PI/20);this.addHalfVertex(ae,ti.x,ti.y,!1,ht,0,ue,ri);for(let Kt=0;Kt<Zt;Kt++){let Ei=Kt/Zt;if(Ei!==.5){const ei=Ei-.5;Ei+=Ei*ei*(Ei-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*ei*ei+(.848013+yt*(.215638*yt-1.06021)))}const pi=At.sub(ti)._mult(Ei)._add(ti)._unit();this.addHalfVertex(ae,pi.x,pi.y,!1,ht,0,ue,ri)}this.addHalfVertex(ae,At.x,At.y,!1,ht,0,ue,ri)}vt||Ve!=null||this.addHalfVertex(ae,Mt.x+2*At.x,Mt.y+2*At.y,!1,ht,0,ue,ri),Ve!=null&&ye&&this.addCurrentVertex(ae,Re||Ie,1,1,ue,Ve)}else if(Ye==="butt")this.addCurrentVertex(ae,ft,0,0,ue,Ve);else if(Ye==="square"){if(!fe){const vt=B?0:-1;this.addCurrentVertex(ae,ft,vt,vt,ue,Ve)}if(this.addCurrentVertex(ae,ft,0,0,ue,Ve),fe){const vt=N?0:1;this.addCurrentVertex(ae,ft,vt,vt,ue,Ve)}}else if(Ye==="round"){if(fe){const vt=!He&&Ne?Ne:be;this.addCurrentVertex(ae,vt,0,0,ue,Ve),!He&&N||this.addCurrentVertex(ae,vt,1,1,ue,Ve,!0)}if(ye){const vt=!He&&Re?Re:Ie;!He&&B||this.addCurrentVertex(ae,vt,-1,-1,ue,Ve,!0),this.addCurrentVertex(ae,vt,0,0,ue,Ve)}}}}addVerticesTo(e,n,l,p,y,b,T,P,I,F){const B=(n.w-e.w)/this.tessellationStep|0;let N=0;const H=this.scaledDistance;if(B>1){this.lineSoFar=e.w;const ne=(n.x-e.x)/B,ue=(n.y-e.y)/B,ae=(n.z-e.z)/B,fe=(n.w-e.w)/B;for(let ye=1;ye<B;++ye){e.x+=ne,e.y+=ue,e.z+=ae,this.lineSoFar+=fe,N+=fe;const be=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(e,l,p,F,!1,T,I,be),this.addHalfVertex(e,y,b,F,!0,-P,I,be)}}this.lineSoFar=n.w,this.scaledDistance=H;const W=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,l,p,F,!1,T,I,W),this.addHalfVertex(n,y,b,F,!0,-P,I,W)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Pi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,l,p,y,b,T=!1){const P=n.x+n.y*l,I=n.y-n.x*l,F=n.y*p-n.x,B=-n.y-n.x*p;if(b!=null){const N=this.elevationType==="offset",H=-10,W=8202,ne=b.zOffset,ue=new Lx(e.x,e.y,ne,this.lineSoFar),ae=!!N&&O0(e,H,W),fe=this.lineSoFar,ye=this.distance;if(this.currentVertex)if(ae){const be=this.currentVertexIsOutside,Ie=this.currentVertex,Re=new Lx(e.x,e.y,ne,this.lineSoFar);if(zx(Ie,Re,H,W),!O0(Re,H,W)){if(be){this.e1=this.e2=-1,this.distance-=Ie.dist(ue),this.lineSoFar=Ie.w;const Ne=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,P,I,T,!1,l,y,Ne),this.addHalfVertex(Ie,F,B,T,!0,-p,y,Ne),this.prevDistance=this.distance}this.distance=this.prevDistance+Ie.dist(Re),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ie,Re,P,I,F,B,l,p,y,T),this.distance=ye,this.scaledDistance=this.distance/this.totalDistance}}else{const be=this.currentVertex;if(this.currentVertexIsOutside){zx(be,ue,H,W),this.e1=this.e2=-1,this.distance-=be.dist(ue),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=be.w;const Ie=this.evaluateLineProgressFeatures(be.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(be,P,I,T,!1,l,y,Ie),this.addHalfVertex(be,F,B,T,!0,-p,y,Ie),this.prevDistance=this.distance,this.distance=ye,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(be,ue,P,I,F,B,l,p,y,T)}else ae||(this.addHalfVertex(e,P,I,T,!1,l,y,b),this.addHalfVertex(e,F,B,T,!0,-p,y,b));this.currentVertex=ue,this.currentVertexIsOutside=ae,this.lineSoFar=fe}else this.addHalfVertex(e,P,I,T,!1,l,y,b),this.addHalfVertex(e,F,B,T,!0,-p,y,b)}addHalfVertex({x:e,y:n},l,p,y,b,T,P,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(n<<1)+(b?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const B=Ri(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,B)}const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),b?this.e2=F:this.e1=F,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function O0(o,e,n){return o.x<e||o.x>n||o.y<e||o.y>n}let xv,vv;function bv(o,e,n){return e*($t/(o.tileSize*Math.pow(2,n-o.tileID.overscaledZ)))}Ut(L0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const wv=(o,e,n)=>(1-n)*o+n*e;function Ev(o,e){return 1/bv(o,1,e.tileZoom)}function Sv(o,e,n,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Tv=o=>{const e=[];Av(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=o.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",p=!!o.paint.get("line-pattern").constantOr(1);return l&&p&&e.push("LINE_JOIN_NONE"),e};function Av(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let z0;const Cv=()=>z0||(z0={layout:xv||(xv=new Kr({"line-cap":new Qt(it.layout_line["line-cap"]),"line-join":new Qt(it.layout_line["line-join"]),"line-miter-limit":new Nt(it.layout_line["line-miter-limit"]),"line-round-limit":new Nt(it.layout_line["line-round-limit"]),"line-sort-key":new Qt(it.layout_line["line-sort-key"]),"line-z-offset":new Qt(it.layout_line["line-z-offset"]),"line-elevation-reference":new Nt(it.layout_line["line-elevation-reference"]),"line-cross-slope":new Nt(it.layout_line["line-cross-slope"]),visibility:new Nt(it.layout_line.visibility),"line-width-unit":new Nt(it.layout_line["line-width-unit"])})),paint:vv||(vv=new Kr({"line-opacity":new Qt(it.paint_line["line-opacity"]),"line-color":new Qt(it.paint_line["line-color"]),"line-translate":new Nt(it.paint_line["line-translate"]),"line-translate-anchor":new Nt(it.paint_line["line-translate-anchor"]),"line-width":new Qt(it.paint_line["line-width"]),"line-gap-width":new Qt(it.paint_line["line-gap-width"]),"line-offset":new Qt(it.paint_line["line-offset"]),"line-blur":new Qt(it.paint_line["line-blur"]),"line-dasharray":new Qt(it.paint_line["line-dasharray"]),"line-pattern":new Qt(it.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nt(it.paint_line["line-pattern-cross-fade"]),"line-gradient":new uu(it.paint_line["line-gradient"]),"line-trim-offset":new Nt(it.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nt(it.paint_line["line-trim-fade-range"]),"line-trim-color":new Nt(it.paint_line["line-trim-color"]),"line-emissive-strength":new Qt(it.paint_line["line-emissive-strength"]),"line-border-width":new Qt(it.paint_line["line-border-width"]),"line-border-color":new Qt(it.paint_line["line-border-color"]),"line-occlusion-opacity":new Nt(it.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},z0);class Gw extends Qt{possiblyEvaluate(e,n){return n=new xr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,p){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,p)}}let gy;function Rv(o,e){return e>0?e+2*o:o}const $w=Xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hw=Xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qw=Xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ww=Xi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Zw=Xi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Xw=Xi([{name:"a_texb",components:2,type:"Uint16"}]),Yw=Xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Kw=Xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Mv=Xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qw=Xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xi([{name:"triangle",components:3,type:"Uint16"}]),Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Xi([{type:"Float32",name:"offsetX"}]),Xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Is=24;function Jw(o,e,n){return o.sections.forEach(l=>{l.text=(function(p,y,b){const T=y.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Fa.applyArabicShaping&&(p=Fa.applyArabicShaping(p)),p})(l.text,e,n)}),o}const yy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function eE(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function tE(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const F0=4294967296,Pv=1/F0,Iv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let I_=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,n=this.length){for(;this.pos<n;){const l=this.readVarint(),p=l>>3,y=this.pos;this.type=7&l,o(p,e,this),this.pos===y&&this.skip(l)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*F0;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*F0;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let n,l;return l=e[this.pos++],n=127&l,l<128?n:(l=e[this.pos++],n|=(127&l)<<7,l<128?n:(l=e[this.pos++],n|=(127&l)<<14,l<128?n:(l=e[this.pos++],n|=(127&l)<<21,l<128?n:(l=e[this.pos],n|=(15&l)<<28,(function(p,y,b){const T=b.buf;let P,I;if(I=T[b.pos++],P=(112&I)>>4,I<128||(I=T[b.pos++],P|=(127&I)<<3,I<128)||(I=T[b.pos++],P|=(127&I)<<10,I<128)||(I=T[b.pos++],P|=(127&I)<<17,I<128)||(I=T[b.pos++],P|=(127&I)<<24,I<128)||(I=T[b.pos++],P|=(1&I)<<31,I<128))return fg(p,P,y);throw new Error("Expected varint not more than 10 bytes")})(n,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&Iv?Iv.decode(this.buf.subarray(e,o)):(function(n,l,p){let y="",b=l;for(;b<p;){const T=n[b];let P,I,F,B=null,N=T>239?4:T>223?3:T>191?2:1;if(b+N>p)break;N===1?T<128&&(B=T):N===2?(P=n[b+1],(192&P)==128&&(B=(31&T)<<6|63&P,B<=127&&(B=null))):N===3?(P=n[b+1],I=n[b+2],(192&P)==128&&(192&I)==128&&(B=(15&T)<<12|(63&P)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):N===4&&(P=n[b+1],I=n[b+2],F=n[b+3],(192&P)==128&&(192&I)==128&&(192&F)==128&&(B=(15&T)<<18|(63&P)<<12|(63&I)<<6|63&F,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,N=1):B>65535&&(B-=65536,y+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),y+=String.fromCharCode(B),b+=N}return y})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const n=this.readPackedEnd();for(;this.pos<n;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*Pv),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*Pv),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,n){let l,p;if(e>=0?(l=e%4294967296|0,p=e/4294967296|0):(l=~(-e%4294967296),p=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(y,b,T){T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7)})(l,0,n),(function(y,b){const T=(7&y)<<4;b.buf[b.pos++]|=T|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))})(p,n)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(l,p,y){for(let b,T,P=0;P<p.length;P++){if(b=p.charCodeAt(P),b>55295&&b<57344){if(!T){b>56319||P+1===p.length?(l[y++]=239,l[y++]=191,l[y++]=189):T=b;continue}if(b<56320){l[y++]=239,l[y++]=191,l[y++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(l[y++]=239,l[y++]=191,l[y++]=189,T=null);b<128?l[y++]=b:(b<2048?l[y++]=b>>6|192:(b<65536?l[y++]=b>>12|224:(l[y++]=b>>18|240,l[y++]=b>>12&63|128),l[y++]=b>>6&63|128),l[y++]=63&b|128)}return y})(this.buf,o,this.pos);const n=this.pos-e;n>=128&&Dv(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=o[n]}writeRawMessage(o,e){this.pos++;const n=this.pos;o(e,this);const l=this.pos-n;l>=128&&Dv(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeMessage(o,e,n){this.writeTag(o,2),this.writeRawMessage(e,n)}writePackedVarint(o,e){e.length&&this.writeMessage(o,iE,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,rE,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,aE,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,nE,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,sE,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,oE,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,lE,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,cE,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,uE,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function fg(o,e,n){return n?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function Dv(o,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let p=n.pos-1;p>=o;p--)n.buf[p+l]=n.buf[p]}function iE(o,e){for(let n=0;n<o.length;n++)e.writeVarint(o[n])}function rE(o,e){for(let n=0;n<o.length;n++)e.writeSVarint(o[n])}function nE(o,e){for(let n=0;n<o.length;n++)e.writeFloat(o[n])}function sE(o,e){for(let n=0;n<o.length;n++)e.writeDouble(o[n])}function aE(o,e){for(let n=0;n<o.length;n++)e.writeBoolean(o[n])}function oE(o,e){for(let n=0;n<o.length;n++)e.writeFixed32(o[n])}function lE(o,e){for(let n=0;n<o.length;n++)e.writeSFixed32(o[n])}function cE(o,e){for(let n=0;n<o.length;n++)e.writeFixed64(o[n])}function uE(o,e){for(let n=0;n<o.length;n++)e.writeSFixed64(o[n])}function hE(o,e,n){e.glyphs=[],o===1&&n.readMessage(dE,e)}function dE(o,e,n){if(o===3){const{id:l,bitmap:p,width:y,height:b,left:T,top:P,advance:I}=n.readMessage(fE,{});e.glyphs.push({id:l,bitmap:new Ic({width:y+6,height:b+6},p),metrics:{width:y,height:b,left:T,top:P,advance:I}})}else o===4?e.ascender=n.readSVarint():o===5&&(e.descender=n.readSVarint())}function fE(o,e,n){o===1?e.id=n.readVarint():o===2?e.bitmap=n.readBytes():o===3?e.width=n.readVarint():o===4?e.height=n.readVarint():o===5?e.left=n.readSVarint():o===6?e.top=n.readSVarint():o===7&&(e.advance=n.readVarint())}const Qo={horizontal:1,vertical:2,horizontalOnly:3};class _y{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const l=new _y;return l.scale=e||1,l.fontStack=n,l}static forImage(e){const n=new _y;return n.image=e,n}}class pg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,l){const p=new pg;for(let y=0;y<e.sections.length;y++){const b=e.sections[y];b.image?p.addImageSection(b,l):p.addTextSection(b,n)}return p}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(n,l){let p="";for(let y=0;y<n.length;y++){const b=n.charCodeAt(y+1)||null,T=n.charCodeAt(y-1)||null;p+=!l&&(b&&Tp(b)&&!yy[n[y+1]]||T&&Tp(T)&&!yy[n[y-1]])||!yy[n[y]]?n[y]:yy[n[y]]}return p})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&D_[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&D_[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const l=new pg;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(_y.forText(e.scale,e.fontStack||n));const l=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(l)}addImageSection(e,n){const l=e.image?e.image.getPrimary():null;if(!l)return void Pi("Can't add FormattedSection with an empty image.");l.scaleSelf(n);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(_y.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function B0(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne=1){const ue=pg.fromFeature(o,p,ne);B===Qo.vertical&&ue.verticalizePunctuation(N);let ae=[];const fe=(function(Ne,Ve,Be,He,Ye,yt){if(!Ne)return[];const ft=[],gt=(function(St,ht,Rt,vt,Mt,At){let ti=0;for(let ri=0;ri<St.length();ri++){const Zt=St.getSection(ri);ti+=kv(St.getCodePoint(ri),Zt,vt,Mt,ht,At)}return ti/Math.max(1,Math.ceil(ti/Rt))})(Ne,Ve,Be,He,Ye,yt),Tt=Ne.text.indexOf("")>=0;let Et=0;for(let St=0;St<Ne.length();St++){const ht=Ne.getSection(St),Rt=Ne.getCodePoint(St);if(D_[Rt]||(Et+=kv(Rt,ht,He,Ye,Ve,yt)),St<Ne.length()-1){const vt=Ep(Rt);(pE[Rt]||vt||ht.image)&&ft.push(Ov(St+1,Et,gt,ft,mE(Rt,Ne.getCodePoint(St+1),vt&&Tt),!1))}}return zv(Ov(Ne.length(),Et,gt,ft,0,!0))})(ue,I,y,e,l,H),{processBidirectionalText:ye,processStyledBidirectionalText:be}=Fa;if(ye&&ue.sections.length===1){const Ne=ye(ue.toString(),fe);for(const Ve of Ne){const Be=new pg;Be.text=Ve,Be.sections=ue.sections;for(let He=0;He<Ve.length;He++)Be.sectionIndex.push(0);ae.push(Be)}}else if(be){const Ne=be(ue.text,ue.sectionIndex,fe);for(const Ve of Ne){const Be=new pg;Be.text=Ve[0],Be.sectionIndex=Ve[1],Be.sections=ue.sections,ae.push(Be)}}else ae=(function(Ne,Ve){const Be=[],He=Ne.text;let Ye=0;for(const yt of Ve)Be.push(Ne.substring(Ye,yt)),Ye=yt;return Ye<He.length&&Be.push(Ne.substring(Ye,He.length)),Be})(ue,fe);const Ie=[],Re={positionedLines:Ie,text:ue.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ne,Ve,Be,He,Ye,yt,ft,gt,Tt,Et,St,ht){let Rt=0,vt=0,Mt=0;const At=gt==="right"?1:gt==="left"?0:.5;let ti=!1;for(const pi of Ye){const ei=pi.getSections();for(const ki of ei){if(ki.image)continue;const Qi=Ve[ki.fontStack];if(Qi&&(ti=Qi.ascender!==void 0&&Qi.descender!==void 0,!ti))break}if(!ti)break}let ri=0;for(const pi of Ye){pi.trim();const ei=pi.getMaxScale(),ki=(ei-1)*Is,Qi={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[ri]=Qi;const yr=Qi.positionedGlyphs;let Wi=0;if(!pi.length()){vt+=yt,++ri;continue}let Ir=0,cr=0;for(let hr=0;hr<pi.length();hr++){const Rr=pi.getSection(hr),Jr=pi.getSectionIndex(hr),on=pi.getCodePoint(hr);let ln=Rr.scale,Fn=null,Us=null,ma=null,ss=Is,ps=0,Ts=Tt;Ts===Qo.vertical&&Sp(on)&&(Ts=Qo.horizontal);const qi=!(Ts===Qo.horizontal||!St&&!yl(on)||St&&(D_[on]||pd(on)));if(Rr.image){const un=He.get(Rr.image.toString());if(!un)continue;ma=Rr.image,Ne.iconsInText=Ne.iconsInText||!0,Us=un.paddedRect;const En=un.displaySize;ln=ln*Is/ht,Fn={width:En[0],height:En[1],left:0,top:-3,advance:qi?En[1]:En[0],localGlyph:!1},ps=ti?-Fn.height*ln:ei*Is-17-En[1]*ln,ss=Fn.advance;const Jo=(qi?En[0]:En[1])*ln-Is*ei;Jo>0&&Jo>Wi&&(Wi=Jo)}else{const un=Be[Rr.fontStack];if(!un)continue;un[on]&&(Us=un[on]);const En=Ve[Rr.fontStack];if(!En)continue;const Jo=En.glyphs[on];if(!Jo)continue;if(Fn=Jo.metrics,ss=on!==8203?Is:0,ti){const Ga=En.ascender!==void 0?Math.abs(En.ascender):0,Gs=En.descender!==void 0?Math.abs(En.descender):0,$a=(Ga+Gs)*ln;Ir<$a&&(Ir=$a,cr=(Ga-Gs)/2*ln),ps=-Ga*ln}else ps=(ei-ln)*Is-17}qi?(Ne.verticalizable=!0,yr.push({glyph:on,image:ma,x:Rt,y:vt+ps,vertical:qi,scale:ln,localGlyph:Fn.localGlyph,fontStack:Rr.fontStack,sectionIndex:Jr,metrics:Fn,rect:Us}),Rt+=ss*ln+Et):(yr.push({glyph:on,image:ma,x:Rt,y:vt+ps,vertical:qi,scale:ln,localGlyph:Fn.localGlyph,fontStack:Rr.fontStack,sectionIndex:Jr,metrics:Fn,rect:Us}),Rt+=Fn.advance*ln+Et)}yr.length!==0&&(Mt=Math.max(Rt-Et,Mt),ti?Fv(yr,At,Wi,cr,yt*ei/2):Fv(yr,At,Wi,0,yt/2)),Rt=0;const zn=yt*ei+Wi;Qi.lineOffset=Math.max(Wi,ki),vt+=zn,++ri}const Zt=vt,{horizontalAlign:Kt,verticalAlign:Ei}=j0(ft);(function(pi,ei,ki,Qi,yr,Wi){const Ir=(ei-ki)*yr,cr=-Wi*Qi;for(const zn of pi)for(const hr of zn.positionedGlyphs)hr.x+=Ir,hr.y+=cr})(Ne.positionedLines,At,Kt,Ei,Mt,Zt),Ne.top+=-Ei*Zt,Ne.bottom=Ne.top+Zt,Ne.left+=-Kt*Mt,Ne.right=Ne.left+Mt,Ne.hasBaseline=ti})(Re,e,n,l,ae,b,T,P,B,I,N,W),!(function(Ne){for(const Ve of Ne)if(Ve.positionedGlyphs.length!==0)return!1;return!0})(Ie))return Re}const D_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kv(o,e,n,l,p,y){if(e.image){const b=l.get(e.image.toString());return b?b.displaySize[0]*e.scale*Is/y+p:0}{const b=n[e.fontStack],T=b&&b.glyphs[o];return T?T.metrics.advance*e.scale+p:0}}function Lv(o,e,n,l){const p=Math.pow(o-e,2);return l?o<e?p/2:2*p:p+Math.abs(n)*n}function mE(o,e,n){let l=0;return o===10&&(l-=1e4),n&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Ov(o,e,n,l,p,y){let b=null,T=Lv(e,n,p,y);for(const P of l){const I=Lv(e-P.x,n,p,y)+P.badness;I<=T&&(b=P,T=I)}return{index:o,x:e,priorBreak:b,badness:T}}function zv(o){return o?zv(o.priorBreak).concat(o.index):[]}function j0(o){let e=.5,n=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Fv(o,e,n,l,p){if(!(e||n||l||p))return;const y=o.length-1,b=o[y],T=(b.x+b.metrics.advance*b.scale)*e;for(let P=0;P<=y;P++)o[P].x-=T,o[P].y+=n+l+p}function N0(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function k_(o,e,n,l){const{horizontalAlign:p,verticalAlign:y}=j0(l),b=n[0]-o.displaySize[0]*p,T=n[1]-o.displaySize[1]*y;return{imagePrimary:o,imageSecondary:e,top:T,bottom:T+o.displaySize[1],left:b,right:b+o.displaySize[0]}}function V0(o,e,n,l,p,y){const b=o.imagePrimary;let T;if(b.content){const ue=b.content,ae=b.pixelRatio||1;T=[ue[0]/ae,ue[1]/ae,b.displaySize[0]-ue[2]/ae,b.displaySize[1]-ue[3]/ae]}const P=e.left*y,I=e.right*y;let F,B,N,H;n==="width"||n==="both"?(H=p[0]+P-l[3],B=p[0]+I+l[1]):(H=p[0]+(P+I-b.displaySize[0])/2,B=H+b.displaySize[0]);const W=e.top*y,ne=e.bottom*y;return n==="height"||n==="both"?(F=p[1]+W-l[0],N=p[1]+ne+l[2]):(F=p[1]+(W+ne-b.displaySize[1])/2,N=F+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:F,right:B,bottom:N,left:H,collisionPadding:T}}function Bv(o){return!o.imagePrimary.stretchX}function jv(o){return!o.imagePrimary.stretchY}function Nv(o){return{width:o.right-o.left,height:o.bottom-o.top}}const Fd=128;function mm(o,e,n,l){const{expression:p}=e;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new xr(o+1,{worldview:n}),void 0,void 0,void 0,l)};if(p.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:b}=p;let T=0;for(;T<y.length&&y[T]<=o;)T++;T=Math.max(0,T-1);let P=T;for(;P<y.length&&y[P]<o+1;)P++;P=Math.min(y.length-1,P);const I=y[T],F=y[P];return p.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:F,interpolationType:b}:{kind:"camera",minZoom:I,maxZoom:F,minSize:p.evaluate(new xr(I,{worldview:n}),void 0,void 0,void 0,l),maxSize:p.evaluate(new xr(F,{worldview:n}),void 0,void 0,void 0,l),interpolationType:b}}}function U0(o,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:p}){return o.kind==="source"?l/Fd:o.kind==="composite"?Ri(l/Fd,p/Fd,n):e}function mg(o,e,n=1){let l=0,p=0;if(o.kind==="constant")p=o.layoutSize*n;else if(o.kind!=="source"){const{interpolationType:y,minZoom:b,maxZoom:T}=o,P=y?Oe(en.interpolationFactor(y,e,b,T),0,1):0;o.kind==="camera"?p=Ri(o.minSize,o.maxSize,P)*n:l=P*n}return{uSizeT:l,uSize:p}}class Bd extends Pt{constructor(e,n,l,p,y){super(e,n),this.angle=p,this.z=l,y!==void 0&&(this.segment=y)}clone(){return new Bd(this.x,this.y,this.z,this.angle,this.segment)}}function Vv(o,e,n,l,p){if(e.segment===void 0)return!0;let y=e,b=e.segment+1,T=0;for(;T>-n/2;){if(b--,b<0)return!1;T-=o[b].dist(y),y=o[b]}T+=o[b].dist(o[b+1]),b++;const P=[];let I=0;for(;T<n/2;){const F=o[b],B=o[b+1];if(!B)return!1;let N=o[b-1].angleTo(F)-F.angleTo(B);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:T,angleDelta:N}),I+=N;T-P[0].distance>l;)I-=P.shift().angleDelta;if(I>p)return!1;b++,T+=F.dist(B)}return!0}function Uv(o){let e=0;for(let n=0;n<o.length-1;n++)e+=o[n].dist(o[n+1]);return e}function Gv(o,e,n){return o?.6*e*n:0}function $v(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function gE(o,e,n,l,p,y){const b=Gv(n,p,y),T=$v(n,l)*y;let P=0;const I=Uv(o)/2;for(let F=0;F<o.length-1;F++){const B=o[F],N=o[F+1],H=B.dist(N);if(P+H>I){const W=(I-P)/H,ne=Ri(B.x,N.x,W),ue=Ri(B.y,N.y,W),ae=new Bd(ne,ue,0,N.angleTo(B),F);return!b||Vv(o,ae,T,b,e)?ae:void 0}P+=H}}function yE(o,e,n,l,p,y,b,T,P){const I=Gv(l,y,b),F=$v(l,p),B=F*b,N=o[0].x===0||o[0].x===P||o[0].y===0||o[0].y===P;return e-B<e/4&&(e=B+e/4),Hv(o,N?e/2*T%e:(F/2+2*y)*b*T%e,e,I,n,B,N,!1,P)}function Hv(o,e,n,l,p,y,b,T,P){const I=y/2,F=Uv(o);let B=0,N=e-n,H=[];for(let W=0;W<o.length-1;W++){const ne=o[W],ue=o[W+1],ae=ne.dist(ue),fe=ue.angleTo(ne);for(;N+n<B+ae;){N+=n;const ye=(N-B)/ae,be=Ri(ne.x,ue.x,ye),Ie=Ri(ne.y,ue.y,ye);if(be>=0&&be<P&&Ie>=0&&Ie<P&&N-I>=0&&N+I<=F){const Re=new Bd(be,Ie,0,fe,W);l&&!Vv(o,Re,y,l,p)||H.push(Re)}}B+=ae}return T||H.length||b||(H=Hv(o,B/2,n,l,p,y,b,!0,P)),H}function qv(o){let e=0,n=0;for(const b of o)e+=b.w*b.h,n=Math.max(n,b.w);o.sort((b,T)=>T.h-b.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let p=0,y=0;for(const b of o)for(let T=l.length-1;T>=0;T--){const P=l[T];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,y=Math.max(y,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===P.w&&b.h===P.h){const I=l.pop();I&&T<l.length&&(l[T]=I)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(l.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:p,h:y,fill:e/(p*y)||0}}Ut(Bd,"Anchor");class xy{static getImagePositionScale(e,n,l){if(n&&e){const{sx:p,sy:y}=e;return{x:p,y}}return{x:l,y:l}}constructor(e,n,l,p){this.paddedRect=e;const{pixelRatio:y,version:b,stretchX:T,stretchY:P,content:I,sdf:F,usvg:B}=n;this.pixelRatio=y,this.stretchX=T,this.stretchY=P,this.content=I,this.version=b,this.padding=l,this.sdf=F,this.usvg=B,this.scale=xy.getImagePositionScale(p,B,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function G0(o,e,n){const l=vs.parse(o),p=(function(y,b,T=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*T[0])+2*b,h:(y.data?y.data.height:y.height*T[1])+2*b}})(e,n,[l.sx,l.sy]);return{bin:p,imagePosition:new xy(p,e,n,l),imageVariant:l}}class Wv{constructor(e,n,l){const p=new Map,y=new Map;this.haveRenderCallbacks=[];const b=[];this.addImages(e,p,1,b),this.addImages(n,y,2,b);const{w:T,h:P}=qv(b),I=new Ss({width:T||1,height:P||1});for(const[F,B]of e.entries()){const N=p.get(F).paddedRect;Ss.copy(B.data,I,{x:0,y:0},{x:N.x+1,y:N.y+1},B.data,null,B.sdf)}for(const[F,B]of n.entries()){const N=y.get(F),H=N.paddedRect;let W=N.padding;const ne=H.x+W,ue=H.y+W,ae=B.data.width,fe=B.data.height;W=W>1?W-1:W,Ss.copy(B.data,I,{x:0,y:0},{x:ne,y:ue},B.data,l),Ss.copy(B.data,I,{x:0,y:fe-W},{x:ne,y:ue-W},{width:ae,height:W},l),Ss.copy(B.data,I,{x:0,y:0},{x:ne,y:ue+fe},{width:ae,height:W},l),Ss.copy(B.data,I,{x:ae-W,y:0},{x:ne-W,y:ue},{width:W,height:fe},l),Ss.copy(B.data,I,{x:0,y:0},{x:ne+ae,y:ue},{width:W,height:fe},l),Ss.copy(B.data,I,{x:ae-W,y:fe-W},{x:ne-W,y:ue-W},{width:W,height:W},l),Ss.copy(B.data,I,{x:0,y:fe-W},{x:ne+ae,y:ue-W},{width:W,height:W},l),Ss.copy(B.data,I,{x:0,y:0},{x:ne+ae,y:ue+fe},{width:W,height:W},l),Ss.copy(B.data,I,{x:ae-W,y:0},{x:ne-W,y:ue+fe},{width:W,height:W},l)}this.lut=l,this.image=I,this.iconPositions=p,this.patternPositions=y}addImages(e,n,l,p){for(const[y,b]of e.entries()){const{bin:T,imagePosition:P,imageVariant:I}=G0(y,b,l);n.set(y,P),p.push(T),b.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(e,n,l,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>e.hasImage(y,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const y of e.getUpdatedImages(l)){for(const b of this.iconPositions.keys()){const T=vs.parse(b);if(Xs.isEqual(T.id,y)){const P=e.getImage(y,l);this.patchUpdatedImage(this.iconPositions.get(b),P,n,null)}}for(const b of this.patternPositions.keys()){const T=vs.parse(b);if(Xs.isEqual(T.id,y)){const P=e.getImage(y,l);this.patchUpdatedImage(this.patternPositions.get(b),P,n,p||this.lut)}}}}patchUpdatedImage(e,n,l,p=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[y,b]=e.tl,T=e.sdf;if(this.lut||T){const P={width:n.data.width,height:n.data.height},I=new Ss(P);Ss.copy(n.data,I,{x:0,y:0},{x:0,y:0},P,p,T),l.update(I,{position:{x:y,y:b}})}else l.update(n.data,{position:{x:y,y:b}})}}Ut(xy,"ImagePosition"),Ut(Wv,"ImageAtlas",{omit:["lut"]});const vy=1e20;function Zv(o,e,n,l,p,y,b,T,P){for(let I=e;I<e+l;I++)Xv(o,n*y+I,y,p,b,T,P);for(let I=n;I<n+p;I++)Xv(o,I*y+e,1,l,b,T,P)}function Xv(o,e,n,l,p,y,b){y[0]=0,b[0]=-vy,b[1]=vy,p[0]=o[e];for(let T=1,P=0,I=0;T<l;T++){p[T]=o[e+T*n];const F=T*T;do{const B=y[P];I=(p[T]-p[B]+F-B*B)/(T-B)/2}while(I<=b[P]&&--P>-1);P++,y[P]=T,b[P]=I,b[P+1]=vy}for(let T=0,P=0;T<l;T++){for(;b[P+1]<T;)P++;const I=y[P],F=T-I;o[e+T*n]=p[I]+F*F}}const $0={none:0,ideographs:1,all:2};class gg{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const l=[],p=this.url||Yn.GLYPHS_URL;for(const y in e)for(const b of e[y])l.push({stack:y,id:b});et(l,({stack:y,id:b},T)=>{let P=this.entries[y];P||(P=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=P.glyphs[b];if(I!==void 0)return void T(null,{stack:y,id:b,glyph:I});if(I=this._tinySDF(P,y,b),I)return P.glyphs[b]=I,void T(null,{stack:y,id:b,glyph:I});const F=Math.floor(b/256);if(256*F>65535)return Pi("glyphs > 65535 not supported"),void T(null,{stack:y,id:b,glyph:I});if(P.ranges[F])return void T(null,{stack:y,id:b,glyph:I});let B=P.requests[F];B||(B=P.requests[F]=[],gg.loadGlyphRange(y,F,p,this.requestManager,(N,H)=>{if(H){P.ascender=H.ascender,P.descender=H.descender;for(const W in H.glyphs)this._doesCharSupportLocalGlyph(+W)||(P.glyphs[+W]=H.glyphs[+W]);P.ranges[F]=!0}for(const W of B)W(N,H);delete P.requests[F]})),B.push((N,H)=>{N?T(N):H&&T(null,{stack:y,id:b,glyph:H.glyphs[b]||null})})},(y,b)=>{if(y)n(y);else if(b){const T={};for(const{stack:P,id:I,glyph:F}of b)T[P]===void 0&&(T[P]={}),T[P].glyphs===void 0&&(T[P].glyphs={}),T[P].glyphs[I]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},T[P].ascender=this.entries[P].ascender,T[P].descender=this.entries[P].descender;n(null,T)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==$0.none&&(this.localGlyphMode===$0.all?!!this.localFontFamily:!!this.localFontFamily&&(Hn(e)||hd(e)||bc(e)||lu(e)||Dn(e)||bs(e)||(n=e)>=131072&&n<=173791||(l=>l>=66736&&l<=66815)(e)));var n}_tinySDF(e,n,l){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(l))return;let y=e.tinySDF;if(!y){let ne="400";/bold/i.test(n)?ne="900":/medium/i.test(n)?ne="500":/light/i.test(n)&&(ne="200"),y=e.tinySDF=new gg.TinySDF({fontFamily:p,fontWeight:ne,fontSize:48,buffer:6,radius:16}),y.fontWeight=ne}if(this.localGlyphs[y.fontWeight][l])return this.localGlyphs[y.fontWeight][l];const b=String.fromCodePoint(l),{data:T,width:P,height:I,glyphWidth:F,glyphHeight:B,glyphLeft:N,glyphTop:H,glyphAdvance:W}=y.draw(b);return this.localGlyphs[y.fontWeight][l]={id:l,bitmap:new Ic({width:P,height:I},T),metrics:{width:F/2,height:B/2,left:N/2,top:H/2-27,advance:W/2,localGlyph:!0}}}}function Yv(o,e){return o+e[1]-e[0]}function H0(o,e,n,l,p=1){const y=[],b=o.imagePrimary,T=b.pixelRatio,P=b.paddedRect.w-2,I=b.paddedRect.h-2,F=(o.right-o.left)*p,B=(o.bottom-o.top)*p,N=b.stretchX||[[0,P]],H=b.stretchY||[[0,I]],W=N.reduce(Yv,0),ne=H.reduce(Yv,0),ue=P-W,ae=I-ne;let fe=0,ye=W,be=0,Ie=ne,Re=0,Ne=ue,Ve=0,Be=ae;if(b.content&&l){const Ye=b.content;fe=L_(N,0,Ye[0]),be=L_(H,0,Ye[1]),ye=L_(N,Ye[0],Ye[2]),Ie=L_(H,Ye[1],Ye[3]),Re=Ye[0]-fe,Ve=Ye[1]-be,Ne=Ye[2]-Ye[0]-ye,Be=Ye[3]-Ye[1]-Ie}const He=(Ye,yt,ft,gt)=>{const Tt=O_(Ye.stretch-fe,ye,F,o.left*p),Et=z_(Ye.fixed-Re,Ne,Ye.stretch,W),St=O_(yt.stretch-be,Ie,B,o.top*p),ht=z_(yt.fixed-Ve,Be,yt.stretch,ne),Rt=O_(ft.stretch-fe,ye,F,o.left*p),vt=z_(ft.fixed-Re,Ne,ft.stretch,W),Mt=O_(gt.stretch-be,Ie,B,o.top*p),At=z_(gt.fixed-Ve,Be,gt.stretch,ne),ti=new Pt(Tt,St),ri=new Pt(Rt,St),Zt=new Pt(Rt,Mt),Kt=new Pt(Tt,Mt),Ei=new Pt(Et/T,ht/T),pi=new Pt(vt/T,At/T),ei=e*Math.PI/180;if(ei){const cr=Math.sin(ei),zn=Math.cos(ei),hr=[zn,-cr,cr,zn];ti._matMult(hr),ri._matMult(hr),Kt._matMult(hr),Zt._matMult(hr)}const ki=Ye.stretch+Ye.fixed,Qi=ft.stretch+ft.fixed,yr=yt.stretch+yt.fixed,Wi=gt.stretch+gt.fixed,Ir=o.imageSecondary;return{tl:ti,tr:ri,bl:Kt,br:Zt,texPrimary:{x:b.paddedRect.x+1+ki,y:b.paddedRect.y+1+yr,w:Qi-ki,h:Wi-yr},texSecondary:Ir?{x:Ir.paddedRect.x+1+ki,y:Ir.paddedRect.y+1+yr,w:Qi-ki,h:Wi-yr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ei,pixelOffsetBR:pi,minFontScaleX:Ne/T/F,minFontScaleY:Be/T/B,isSDF:n}};if(b.stretchX||b.stretchY){const Ye=Kv(N,ue,W),yt=Kv(H,ae,ne);for(let ft=0;ft<Ye.length-1;ft++){const gt=Ye[ft],Tt=Ye[ft+1];for(let Et=0;Et<yt.length-1;Et++)y.push(He(gt,yt[Et],Tt,yt[Et+1]))}}else y.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:I+1}));return y}function _E(o,e){const n=o.stretchY||[[0,o.paddedRect.h-2]];return o.stretchX||o.stretchY?Qv(o.stretchX||[[0,o.paddedRect.w-2]])*Qv(n):1}function L_(o,e,n){let l=0;for(const p of o)l+=Math.max(e,Math.min(n,p[1]))-Math.max(e,Math.min(n,p[0]));return l}function Kv(o,e,n){const l=[{fixed:-1,stretch:0}];for(const[p,y]of o){const b=l[l.length-1];l.push({fixed:p-b.stretch,stretch:b.stretch}),l.push({fixed:p-b.stretch,stretch:b.stretch+(y-p)})}return l.push({fixed:e+1,stretch:n}),l}function Qv(o){return 2*o.length+1}function O_(o,e,n,l){return o/e*n+l}function z_(o,e,n,l){return o-e*n/l}function xE(o,e,n,l){const p=e+o.positionedLines[l].lineOffset;return l===0?n+p/2:n+(p+(e+o.positionedLines[l-1].lineOffset))/2}function Jv(o,e,n,l,p,y,b,T,P){const I=[];if(e.positionedLines.length===0)return I;const F=(P!==void 0?P:l.layout.get("text-rotate").evaluate(y,{}))*Math.PI/180,B=(function(ue){const ae=ue[0],fe=ue[1],ye=ae*fe;return ye>0?[ae,-fe]:ye<0?[-ae,fe]:ae===0?[fe,ae]:[fe,-ae]})(n);let N=Math.abs(e.top-e.bottom);for(const ue of e.positionedLines)N-=ue.lineOffset;const H=e.positionedLines.length,W=N/H;let ne=e.top-n[1];for(let ue=0;ue<H;++ue){const ae=e.positionedLines[ue];ne=xE(e,W,ne,ue);for(const fe of ae.positionedGlyphs){if(!fe.rect)continue;const ye=fe.rect||{};let be=4,Ie=!0,Re=1,Ne=0;if(fe.image){const ri=b.get(fe.image.toString());if(!ri)continue;if(ri.sdf){Pi("SDF images are not supported in formatted text and will be ignored.");continue}Ie=!1,Re=ri.pixelRatio,be=1/Re}const Ve=(p||T)&&fe.vertical,Be=fe.metrics.advance*fe.scale/2,He=fe.metrics,Ye=fe.rect;if(Ye===null)continue;T&&e.verticalizable&&(Ne=fe.image?Be-fe.metrics.width*fe.scale/2:0);const yt=p?[fe.x+Be,fe.y]:[0,0];let ft=[0,0],gt=[0,0],Tt=!1;p||(Ve?(gt=[fe.x+Be+B[0],fe.y+B[1]-Ne],Tt=!0):ft=[fe.x+Be+n[0],fe.y+n[1]-Ne]);const Et=Ye.w*fe.scale/(Re*(fe.localGlyph?2:1)),St=Ye.h*fe.scale/(Re*(fe.localGlyph?2:1));let ht,Rt,vt,Mt;if(Ve){const ri=fe.y-ne,Zt=new Pt(-Be,Be-ri),Kt=-Math.PI/2,Ei=new Pt(...gt);ht=new Pt(-Be+ft[0],ft[1]),ht._rotateAround(Kt,Zt)._add(Ei),ht.x+=-ri+Be,ht.y-=(He.left-be)*fe.scale;const pi=fe.image?He.advance*fe.scale:Is*fe.scale,ei=String.fromCodePoint(fe.glyph);eE(ei)?ht.x+=(1-be)*fe.scale:tE(ei)?ht.x+=pi-He.height*fe.scale+(-be-1)*fe.scale:ht.x+=fe.image||He.width+2*be===Ye.w&&He.height+2*be===Ye.h?(pi-St)/2:(pi-(He.height+2*be)*fe.scale)/2,Rt=new Pt(ht.x,ht.y-Et),vt=new Pt(ht.x+St,ht.y),Mt=new Pt(ht.x+St,ht.y-Et)}else{const ri=(He.left-be)*fe.scale-Be+ft[0],Zt=(-He.top-be)*fe.scale+ft[1],Kt=ri+Et,Ei=Zt+St;ht=new Pt(ri,Zt),Rt=new Pt(Kt,Zt),vt=new Pt(ri,Ei),Mt=new Pt(Kt,Ei)}if(F){let ri;ri=p?new Pt(0,0):Tt?new Pt(B[0],B[1]):new Pt(n[0],n[1]),ht._rotateAround(F,ri),Rt._rotateAround(F,ri),vt._rotateAround(F,ri),Mt._rotateAround(F,ri)}const At=new Pt(0,0),ti=new Pt(0,0);I.push({tl:ht,tr:Rt,bl:vt,br:Mt,texPrimary:ye,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:yt,sectionIndex:fe.sectionIndex,isSDF:Ie,pixelOffsetTL:At,pixelOffsetBR:ti,minFontScaleX:0,minFontScaleY:0})}}return I}function vE(o,e=1,n=!1){let l=1/0,p=1/0,y=-1/0,b=-1/0;const T=o[0];for(let H=0;H<T.length;H++){const W=T[H];(!H||W.x<l)&&(l=W.x),(!H||W.y<p)&&(p=W.y),(!H||W.x>y)&&(y=W.x),(!H||W.y>b)&&(b=W.y)}const P=Math.min(y-l,b-p);let I=P/2;const F=new Zc([],bE);if(P===0)return new Pt(l,p);for(let H=l;H<y;H+=P)for(let W=p;W<b;W+=P)F.push(new yg(H+I,W+I,I,o));let B=(function(H){let W=0,ne=0,ue=0;const ae=H[0];for(let fe=0,ye=ae.length,be=ye-1;fe<ye;be=fe++){const Ie=ae[fe],Re=ae[be],Ne=Ie.x*Re.y-Re.x*Ie.y;ne+=(Ie.x+Re.x)*Ne,ue+=(Ie.y+Re.y)*Ne,W+=3*Ne}return new yg(ne/W,ue/W,0,H)})(o),N=F.length;for(;F.length;){const H=F.pop();(H.d>B.d||!B.d)&&(B=H,n&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,N)),H.max-B.d<=e||(I=H.h/2,F.push(new yg(H.p.x-I,H.p.y-I,I,o)),F.push(new yg(H.p.x+I,H.p.y-I,I,o)),F.push(new yg(H.p.x-I,H.p.y+I,I,o)),F.push(new yg(H.p.x+I,H.p.y+I,I,o)),N+=4)}return n&&(console.log(`num probes: ${N}`),console.log(`best distance: ${B.d}`)),B.p}function bE(o,e){return e.max-o.max}gg.loadGlyphRange=function(o,e,n,l,p){const y=256*e,b=y+255,T=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",o).replace("{range}",`${y}-${b}`),Kn.Glyphs);Nc(T,(P,I)=>{if(P)p(P);else if(I){const F={},B=(function(N){return new I_(N).readFields(hE,{})})(I);for(const N of B.glyphs)F[N.id]=N;p(null,{glyphs:F,ascender:B.ascender,descender:B.descender})}})},gg.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:b="normal",lang:T=null}={}){this.buffer=e,this.cutoff=l,this.radius=n,this.lang=T;const P=this.size=o+4*e,I=this._createCanvas(P),F=this.ctx=I.getContext("2d",{willReadFrequently:!0});F.font=`${b} ${y} ${o}px ${p}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(o),b=Math.ceil(n),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),P=Math.min(this.size-this.buffer,b+Math.ceil(l)),I=T+2*this.buffer,F=P+2*this.buffer,B=Math.max(I*F,0),N=new Uint8ClampedArray(B),H={data:N,width:I,height:F,glyphWidth:T,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:e};if(T===0||P===0)return H;const{ctx:W,buffer:ne,gridInner:ue,gridOuter:ae}=this;this.lang&&(W.lang=this.lang),W.clearRect(ne,ne,T,P),W.fillText(o,ne,ne+b);const fe=W.getImageData(ne,ne,T,P);ae.fill(vy,0,B),ue.fill(0,0,B);for(let ye=0;ye<P;ye++)for(let be=0;be<T;be++){const Ie=fe.data[4*(ye*T+be)+3]/255;if(Ie===0)continue;const Re=(ye+ne)*I+be+ne;if(Ie===1)ae[Re]=0,ue[Re]=vy;else{const Ne=.5-Ie;ae[Re]=Ne>0?Ne*Ne:0,ue[Re]=Ne<0?Ne*Ne:0}}Zv(ae,0,0,I,F,I,this.f,this.v,this.z),Zv(ue,ne,ne,T,P,I,this.f,this.v,this.z);for(let ye=0;ye<B;ye++){const be=Math.sqrt(ae[ye])-Math.sqrt(ue[ye]);N[ye]=Math.round(255-255*(be/this.radius+this.cutoff))}return H}};class yg{constructor(e,n,l,p){this.p=new Pt(e,n),this.h=l,this.d=(function(y,b){let T=!1,P=1/0;for(let I=0;I<b.length;I++){const F=b[I];for(let B=0,N=F.length,H=N-1;B<N;H=B++){const W=F[B],ne=F[H];W.y>y.y!=ne.y>y.y&&y.x<(ne.x-W.x)*(y.y-W.y)/(ne.y-W.y)+W.x&&(T=!T),P=Math.min(P,vu(y,W,ne))}}return(T?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const wE=Object.keys,q0=Number.POSITIVE_INFINITY,EE=Math.sqrt(2);function Hf(o,e,n,l,p){const y=N0(o)&&o.collisionPadding?o.collisionPadding:[0,0,0,0],b={top:o.top-y[1],bottom:o.bottom+y[3],left:o.left-y[0],right:o.right+y[2],scaled:!1};return l!==void 0&&(function(T,P){T.top*=P,T.bottom*=P,T.left*=P,T.right*=P,T.scaled=!0})(b,l),n&&(function(T,P){if(!P)return;const I=tr(P),F=new Pt(T.left,T.top),B=new Pt(T.right,T.top),N=new Pt(T.left,T.bottom),H=new Pt(T.right,T.bottom),W=new Pt(0,0);F._rotateAround(I,W),B._rotateAround(I,W),N._rotateAround(I,W),H._rotateAround(I,W),T.left=Math.min(F.x,B.x,N.x,H.x),T.right=Math.max(F.x,B.x,N.x,H.x),T.top=Math.min(F.y,B.y,N.y,H.y),T.bottom=Math.max(F.y,B.y,N.y,H.y)})(b,n),p&&(b.left+=p[0],b.right+=p[0],b.top+=p[1],b.bottom+=p[1]),e?{top:Math.min(e.top,b.top),bottom:Math.max(e.bottom,b.bottom),left:Math.min(e.left,b.left),right:Math.max(e.right,b.right),scaled:e.scaled||b.scaled}:b}function e1(o,[e,n]){let l=0,p=0;if(n===q0){e<0&&(e=0);const y=e/EE;switch(o){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(o){case"top-right":case"bottom-right":l=-y;break;case"top-left":case"bottom-left":l=y;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),o){case"top-right":case"top-left":case"top":p=n-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-n}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,p]}function SE(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W){const ne=o.layers[0],ue=ne.appearances;if(ue.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const ae={iconBBox:null,iconVerticalBBox:null},fe={textBBox:null,textVerticalBBox:null},{baseIconRotate:ye,baseTextRotate:be,iconScaleFactor:Ie}=(function(Ne,Ve,Be){const He=Ne.get("icon-rotate").evaluate(Ve,{},Be),Ye=Ne.get("text-rotate").evaluate(Ve,{},Be),[yt,ft]=Ne.get("icon-size-scale-range");return{baseIconRotate:He,baseTextRotate:Ye,iconScaleFactor:Oe(1,yt,ft)}})(l,p,y);e&&(ae.iconBBox=Hf(e,ae.iconBBox,ye,b),n)&&(ae.iconVerticalBBox=Hf(n,ae.iconVerticalBBox,ye+90,b));const Re=B_(B.horizontal);Re&&(fe.textBBox=Hf(Re,fe.textBBox,be,1,H)),B.vertical&&(fe.textVerticalBBox=Hf(B.vertical,fe.textVerticalBBox,be+90,1,H));for(const Ne of ue)Ne.hasIconProperties()&&TE(ae,o,ne,Ne,p,y,T,ye,b,P,e,I,Ie,F,W),Ne.hasTextProperties()&&AE(fe,ne,Ne,p,y,H,be,N,Re,B.vertical);return{iconBBox:ae.iconBBox,iconVerticalBBox:ae.iconVerticalBBox,textBBox:fe.textBBox,textVerticalBBox:fe.textVerticalBBox}}function TE(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W){const{appearanceIconOffset:ne,appearanceIconRotate:ue,appearanceIconSize:ae}=t1(l,n,p,y,b,T,P,I.iconScaleFactor);let fe=null,ye=null,be=null;l.hasProperty("icon-image")?be=(function(Ie,Re,Ne,Ve,Be,He,Ye,yt){let ft=null;const gt=Re.getAppearanceValueAndResolveTokens(Ne,"icon-image",Ve,Be,yt);if(gt){const Tt=Ie.getResolvedImageFromTokens(gt),Et=Ne.getUnevaluatedProperty("icon-size"),St=by(Tt,mm(Ie.zoom,Et,Ie.worldview,yt),Et,Be,Ie.zoom,Ve,Ie.pixelRatio,Ye,Ie.worldview,yt);ft=He.get(St.iconPrimary.toString())}return ft})(e,n,l,p,y,B,N,W):F&&(be=F.imagePrimary),be&&(fe=k_(be,null,ne,H),e.allowVerticalPlacement&&(ye=k_(be,null,ne,H))),fe&&(o.iconBBox=Hf(fe,o.iconBBox,ue,ae)),ye&&(o.iconVerticalBBox=Hf(ye,o.iconVerticalBBox,ue+90,ae))}function t1(o,e,n,l,p,y,b,T){const P=o.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(o,"icon-offset",n,l,[]):null,I=P&&Array.isArray(P)?P:p,F=o.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(o,"icon-rotate",n,l,[]):null,B=typeof F=="number"?F:y,N=o.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(o,"icon-size",n,l,[]):null;return{appearanceIconOffset:I,appearanceIconRotate:B,appearanceIconSize:typeof N=="number"?N*T:b}}function AE(o,e,n,l,p,y,b,T,P,I){const{appearanceTextOffset:F,appearanceTextRotate:B,appearanceTextSize:N}=i1(n,e,l,p,y,b,T),H=N/T;P&&(o.textBBox=Hf(P,o.textBBox,B,H,F)),I&&(o.textVerticalBBox=Hf(I,o.textVerticalBBox,B+90,H,F))}function i1(o,e,n,l,p,y,b){const T=o.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(o,"text-offset",n,l,[]):null,P=T&&Array.isArray(T)?[T[0]*Is,T[1]*Is]:p,I=o.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(o,"text-rotate",n,l,[]):null,F=typeof I=="number"?I:y,B=o.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(o,"text-size",n,l,[]):null;return{appearanceTextOffset:P,appearanceTextRotate:F,appearanceTextSize:typeof B=="number"?B:b}}function F_(o,e,n,l,p,y,b,T,P){if(!e||!e.usvg)return;const I=Nv(l),F=Nv(p),B=y!=="both"&&y!=="width"||!Bv(l)?1:F.width/I.width,N=y!=="both"&&y!=="height"||!jv(l)?1:F.height/I.height;n.scaleSelf(B,N);const H=n.toString();b.set(H,n),T.set(H,e);const{imagePosition:W}=G0(H,e,1);P.set(H,W)}function r1(o,e,n,l,p,y,b,T,P,I){if(!o)return;const F=(function(B,N,H,W,ne,ue,ae){if(B.kind==="camera")return B.maxSize;if(B.kind==="composite"){const fe=N.possiblyEvaluate(new xr(B.maxZoom,{worldview:ue}),H,ae).evaluate(ne,{},H,ae),ye=N.possiblyEvaluate(new xr(B.minZoom,{worldview:ue}),H,ae).evaluate(ne,{},H,ae);return Math.max(fe,ye)}return N.possiblyEvaluate(new xr(W,{worldview:ue}),H,ae).evaluate(ne,{},H,ae)})(e,n,l,p,y,P,I);return o.scaleSelf(F*T*b)}function by(o,e,n,l,p,y,b,T,P,I){return{iconPrimary:r1(o.getPrimary(),e,n,l,p,y,b,T,P,I),iconSecondary:r1(o.getSecondary(),e,n,l,p,y,b,T,P,I)}}function CE(o,e,n){if(!e)return;const l=n.get(o.toString()),p=n.get(e.toString());l&&p&&(l.paddedRect.w===p.paddedRect.w&&l.paddedRect.h===p.paddedRect.h||Pi(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),l.usvg!==p.usvg&&Pi(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function n1(o,e,n,l){if(!o)return;const p=e.get(n.toString());if(o.imagePrimary=p,l){const y=e.get(l.toString());o.imageSecondary=y}}function RE(o,e){for(const n in o.horizontal)s1(o.horizontal[n],e);s1(o.vertical,e)}function s1(o,e){if(o){for(const n of o.positionedLines)for(const l of n.positionedGlyphs)if(l.image!==null){const p=l.image.toString();l.rect=e.get(p).paddedRect}}}function W0(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ME(o,e,n,l,p,y,b,T,P){const I=B_(y.horizontal)||y.vertical,F=n.get("icon-text-fit-padding").evaluate(l,{},p);let B,N=e;return e&&P!=="none"&&(o.allowVerticalPlacement&&y.vertical&&(B=V0(e,y.vertical,P,F,T,b)),I&&(N=V0(e,I,P,F,T,b))),{defaultShapedIcon:N,verticallyShapedIcon:B}}function a1(o,e){return o*e/24}function PE(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe,ye,be,Ie,Re,Ne){let Ve=b.textMaxSize.evaluate(e,{},N);Ve===void 0?Ve=T*b.textScaleFactor:Ve*=b.textScaleFactor;const Be=o.layers[0].layout,He=a1(T,b.textScaleFactor),Ye=B_(n.horizontal)||n.vertical,yt=o.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((ue!=="none"||yt)&&o.appearanceFeatureData&&o.featureToAppearanceIndex[e.index]<o.appearanceFeatureData.length){const Zt=o.appearanceFeatureData[o.featureToAppearanceIndex[e.index]];Zt&&(Zt.textShaping=Ye,Zt.iconTextFitPadding=Be.get("icon-text-fit-padding").evaluate(e,{},N),Zt.fontScale=He,Zt.textScaleFactor=b.textScaleFactor)}const ft=H.name==="globe",gt=o.tilePixelRatio*Ve/24,Tt=(Mt=o.overscaling,o.zoom>18&&Mt>2&&(Mt>>=1),Math.max($t/(512*Mt),1)*Be.get("symbol-spacing")),Et=Be.get("text-padding")*o.tilePixelRatio,St=Be.get("icon-padding")*o.tilePixelRatio,ht=tr(Be.get("text-max-angle")),Rt=Be.get("icon-rotation-alignment")==="map"&&ye!=="point",vt=Tt/2;var Mt;o.hasAnyIconTextFit===!1&&ue!=="none"&&(o.hasAnyIconTextFit=!0);const At=e.properties?+e.properties[er]:null,ti=At&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(At):65535,ri=(Zt,Kt,Ei)=>{if(Kt.x<0||Kt.x>=$t||Kt.y<0||Kt.y>=$t)return;let pi=null;if(ft){const{x:ei,y:ki,z:Qi}=H.projectTilePoint(Kt.x,Kt.y,Ei);pi={anchor:new Bd(ei,ki,Qi,0,void 0),up:H.upVector(Ei,Kt.x,Kt.y)}}(function(ei,ki,Qi,yr,Wi,Ir,cr,zn,hr,Rr,Jr,on,ln,Fn,Us,ma,ss,ps,Ts,qi,un,En,Jo,Ga,Gs,$a,Ph,Pa,t0,Sg,so,i0){const Ih=ei.addToLineVertexArray(ki,yr);let jd,Zf,rc,zc,Fy,Tg,Zi,Ds=0,Bn=0,ms=0,nc=0,Eo=-1,el=-1;const ks={};let By=nl("");const Dh=Qi?Qi.anchor:ki,as=Pa!=="none";let $s=0,gs=0;if(hr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Hs=hr.layout.get("text-offset").evaluate(un,{},Gs);$s=Hs[0]*Is,gs=Hs[1]*Is}else $s=hr.layout.get("text-radial-offset").evaluate(un,{},Gs)*Is,gs=q0;if(ei.allowVerticalPlacement&&Wi.vertical){const Hs=Wi.vertical;if(Us)Tg=Y0(Hs),zn&&(Zi=Y0(zn));else{const So=hr.layout.get("text-rotate").evaluate(un,{},Gs)+90;rc=j_(Rr,Dh,ki,Jr,on,ln,Hs,Fn,So,ma,i0),zn&&(zc=j_(Rr,Dh,ki,Jr,on,ln,zn,ps,So,null,so))}}if(Ir){const Hs=hr.layout.get("icon-rotate").evaluate(un,{},Gs),So=H0(Ir,Hs,Jo,as,En.iconScaleFactor),Fc=zn?H0(zn,Hs,Jo,as,En.iconScaleFactor):void 0;Zf=j_(Rr,Dh,ki,Jr,on,ln,Ir,ps,Hs,null,Sg);const kh=(function(Mu,US,Tb,GS,$S,Ab,Cb,HS,YS,wx){const Rb=Mu.layers[0],Mb=Rb.appearances;let Cg=US.length;if(Tb&&(Cg=Math.max(Cg,Tb.length)),Mb.length===0)return Cg;const[qS,WS]=GS.get("icon-size-scale-range"),ZS=Oe(1,qS,WS);for(const Ex of Mb){const Pb=Ex.getUnevaluatedProperties();if(Pb._values["icon-image"].value!==void 0){const Ib=Rb.getAppearanceValueAndResolveTokens(Ex,"icon-image",Ab,Cb,wx);if(Ib){const Db=Mu.getResolvedImageFromTokens(Ib);if(Db){const kb=Ex.hasProperty("icon-size")?Pb._values["icon-size"]:$S._values["icon-size"],XS=by(Db,mm(Mu.zoom,kb,Mu.worldview,wx),kb,Cb,Mu.zoom,Ab,Mu.pixelRatio,ZS,Mu.worldview,wx),Lb=HS.get(XS.iconPrimary.toString());Lb&&(Cg=Math.max(Cg,_E(Lb)))}}}}return Cg})(ei,So,Fc,hr.layout,hr._unevaluatedLayout,un,Gs,ei.iconAtlasPositions,0,Ga);Ds=4*kh;const vx=hr.layout.get("icon-size").evaluate(un,{},Gs,Ga),bx=En.compositeIconSizes?En.compositeIconSizes[0].evaluate(un,{},Gs,Ga):0,jy=En.compositeIconSizes?En.compositeIconSizes[1].evaluate(un,{},Gs,Ga):0,Ag=X0(ei.layerIds[0],ei.iconSizeData,vx,En.iconScaleFactor,bx,jy);ei.addSymbols(ei.icon,So,Ag,qi,Ts,un,void 0,Qi,ki,Ih.lineStartIndex,Ih.lineLength,-1,Ga,Gs,$a,Ph,ei.symbolInstances.length,kh),Eo=ei.icon.placedSymbolArray.length-1,Fc&&(Bn=4*kh,ei.addSymbols(ei.icon,Fc,Ag,qi,Ts,un,Qo.vertical,Qi,ki,Ih.lineStartIndex,Ih.lineLength,-1,Ga,Gs,$a,Ph,ei.symbolInstances.length,kh),el=ei.icon.placedSymbolArray.length-1)}for(const Hs in Wi.horizontal){const So=Hs,Fc=Wi.horizontal[So];jd||(By=nl(Fc.text),Us?Fy=Y0(Fc):jd=j_(Rr,Dh,ki,Jr,on,ln,Fc,Fn,hr.layout.get("text-rotate").evaluate(un,{},Gs),ma,i0));const kh=Fc.positionedLines.length===1;if(ms+=o1(ei,Qi,ki,Fc,cr,hr,Us,un,ma,Ih,Wi.vertical?Qo.horizontal:Qo.horizontalOnly,kh?wE(Wi.horizontal):[So],ks,Eo,En,Ga,Gs,ei.symbolInstances.length,$a),kh)break}Wi.vertical&&(nc+=o1(ei,Qi,ki,Wi.vertical,cr,hr,Us,un,ma,Ih,Qo.vertical,["vertical"],ks,el,En,Ga,Gs,ei.symbolInstances.length,$a));let Ia=-1;const Da=(Hs,So)=>Hs?Math.max(Hs,So):So;Ia=Da(Fy,Ia),Ia=Da(Tg,Ia),Ia=Da(Zi,Ia);const Xf=Ia>-1?1:0;ei.glyphOffsetArray.length>=65535&&Pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),un.sortKey!==void 0&&ei.addToSortKeyRanges(ei.symbolInstances.length,un.sortKey),ei.symbolInstances.emplaceBack(ki.x,ki.y,Dh.x,Dh.y,Dh.z,ks.right>=0?ks.right:-1,ks.center>=0?ks.center:-1,ks.left>=0?ks.left:-1,ks.vertical>=0?ks.vertical:-1,Eo,el,By,jd!==void 0?jd:ei.collisionBoxArray.length,jd!==void 0?jd+1:ei.collisionBoxArray.length,rc!==void 0?rc:ei.collisionBoxArray.length,rc!==void 0?rc+1:ei.collisionBoxArray.length,Zf!==void 0?Zf:ei.collisionBoxArray.length,Zf!==void 0?Zf+1:ei.collisionBoxArray.length,zc||ei.collisionBoxArray.length,zc?zc+1:ei.collisionBoxArray.length,Jr,ms,nc,Ds,Bn,Xf,0,$s,gs,Ia,0,as?1:0,t0)})(o,Kt,pi,Zt,n,l,y,p,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Et,fe,I,0,St,Rt,ae,e,b,F,B,N,W,ne,ue,ti,be,Ie,Re)};if(ye==="line")for(const Zt of v_(e.geometry,0,0,$t,$t)){const Kt=yE(Zt,Tt,ht,n.vertical||Ye,l,24,gt,o.overscaling,$t);for(const Ei of Kt)Ye&&IE(o,Ye.text,vt,Ei)||ri(Zt,Ei,N)}else if(ye==="line-center"){for(const Zt of e.geometry)if(Zt.length>1){const Kt=gE(Zt,ht,n.vertical||Ye,l,24,gt);Kt&&ri(Zt,Kt,N)}}else if(e.type==="Polygon")for(const Zt of rm(e.geometry,0)){const Kt=vE(Zt,16);ri(Zt[0],new Bd(Kt.x,Kt.y,0,0,void 0),N)}else if(e.type==="LineString")for(const Zt of e.geometry)ri(Zt,new Bd(Zt[0].x,Zt[0].y,0,0,void 0),N);else if(e.type==="Point")for(const Zt of e.geometry)for(const Kt of Zt)ri([Kt],new Bd(Kt.x,Kt.y,0,0,void 0),N)}const Z0=255,gm=Z0*Fd;function o1(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe){const ye=Jv(0,l,P,y,b,T,p,o.allowVerticalPlacement,void 0),be=y.layout.get("text-size").evaluate(T,{},ue),Ie=W.compositeTextSizes?W.compositeTextSizes[0].evaluate(T,{},ue):0,Re=W.compositeTextSizes?W.compositeTextSizes[1].evaluate(T,{},ue):0,Ne=X0(o.layerIds[0],o.textSizeData,be,W.textScaleFactor,Ie,Re);o.addSymbols(o.text,ye,Ne,P,b,T,F,e,n,I.lineStartIndex,I.lineLength,H,ne,ue,fe,!1,ae,ye.length);for(const Ve of B)N[Ve]=o.text.placedSymbolArray.length-1;return 4*ye.length}function X0(o,e,n,l,p,y){const b=e;let T=null;return b.kind==="source"?(T=[Fd*n*l],T[0]>gm&&Pi(`${o}: Value for "text-size" is >= ${Z0}. Reduce your "text-size".`)):b.kind==="composite"&&(T=[Fd*p*l,Fd*y*l],(T[0]>gm||T[1]>gm)&&Pi(`${o}: Value for "text-size" is >= ${Z0}. Reduce your "text-size".`)),T}function B_(o){for(const e in o)return o[e];return null}function j_(o,e,n,l,p,y,b,T,P,I,F){let B,N,H,W;if(B=F?F.top:b.top,N=F?F.bottom:b.bottom,H=F?F.left:b.left,W=F?F.right:b.right,N0(b)&&b.collisionPadding){const ne=b.collisionPadding;H-=ne[0],B-=ne[1],W+=ne[2],N+=ne[3]}if(P){const ne=new Pt(H,B),ue=new Pt(W,B),ae=new Pt(H,N),fe=new Pt(W,N),ye=tr(P);let be=new Pt(0,0);I&&(be=new Pt(I[0],I[1])),ne._rotateAround(ye,be),ue._rotateAround(ye,be),ae._rotateAround(ye,be),fe._rotateAround(ye,be),H=Math.min(ne.x,ue.x,ae.x,fe.x),W=Math.max(ne.x,ue.x,ae.x,fe.x),B=Math.min(ne.y,ue.y,ae.y,fe.y),N=Math.max(ne.y,ue.y,ae.y,fe.y)}return o.emplaceBack(e.x,e.y,e.z,n.x,n.y,H,B,W,N,T,l,p,y),o.length-1}function Y0(o){N0(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function IE(o,e,n,l){const p=o.compareText;if(e in p){const y=p[e];for(let b=y.length-1;b>=0;b--)if(l.dist(y[b])<n)return!0}else p[e]=[];return p[e].push(l),!1}function l1(o,e){const n=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,p=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),y=Math.sin(n)*p/Math.sin(Math.max(Math.PI/2-o._pitch-n,.01));let b=Math.sin(o._pitch)*y+p;const T=p*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let P=Math.max(o.zoom-17,0);o.isOrthographic&&(P/=10),b*=1+P}return Math.min(1.01*b,T)}function wy(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const n=Math.pow(2,-o.z),l=o.x*n,p=(o.x+1)*n,y=o.y*n,b=(o.y+1)*n,T=pt(l),P=pt(p),I=wt(y),F=wt(b),B=e.project(T,I),N=e.project(P,I),H=e.project(P,F),W=e.project(T,F);let ne=Math.min(B.x,N.x,H.x,W.x),ue=Math.min(B.y,N.y,H.y,W.y),ae=Math.max(B.x,N.x,H.x,W.x),fe=Math.max(B.y,N.y,H.y,W.y);const ye=n/16;function be(Re,Ne,Ve,Be,He,Ye){const yt=(Ve+He)/2,ft=(Be+Ye)/2,gt=e.project(pt(yt),wt(ft)),Tt=Math.max(0,ne-gt.x,ue-gt.y,gt.x-ae,gt.y-fe);ne=Math.min(ne,gt.x),ae=Math.max(ae,gt.x),ue=Math.min(ue,gt.y),fe=Math.max(fe,gt.y),Tt>ye&&(be(Re,gt,Ve,Be,yt,ft),be(gt,Ne,yt,ft,He,Ye))}be(B,N,l,y,p,y),be(N,H,p,y,p,b),be(H,W,p,b,l,b),be(W,B,l,b,l,y),ne-=ye,ue-=ye,ae+=ye,fe+=ye;const Ie=1/Math.max(ae-ne,fe-ue);return{scale:Ie,x:ne*Ie,y:ue*Ie,x2:ae*Ie,y2:fe*Ie,projection:e}}function c1(o,{x:e,y:n},l=0){return new Pt(((e-l)*o.scale-o.x)*$t,(n*o.scale-o.y)*$t)}const DE=le(new Float32Array(16));class qf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Pe(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l,p=!0){return e._coordinatePoint(e.locationCoordinate(n,l),p)}pixelsPerMeter(e,n){return tt(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return l1(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,p){const y=e.horizonLineFromTop(!1),b=new Pt(n,Math.max(y,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(b,p))}pointCoordinate3D(e,n,l){const p=new Pt(n,l);if(e.elevation)return e.elevation.pointCoordinate(p);{const y=this.pointCoordinate(e,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return DE}createTileMatrix(e,n,l){let p,y,b;const T=l.canonical,P=le(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=wy(T,this);p=1,y=I.x+l.wrap*I.scale,b=I.y,oe(P,P,[p/I.scale,p/I.scale,e.pixelsPerMeter/n])}else p=n/e.zoomScale(T.z),y=(T.x+Math.pow(2,T.z)*l.wrap)*p,b=T.y*p;return Q(P,P,[y,b,0]),oe(P,P,[p/$t,p/$t,1]),P}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class kE extends qf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,l]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(tr(n));this.n=(p+Math.sin(tr(l)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:l,c:p,r0:y}=this,b=tr(e-this.center[0]),T=tr(n),P=Math.sqrt(p-2*l*Math.sin(T))/l;return{x:P*Math.sin(b*l),y:P*Math.cos(b*l)-y,z:0}}unproject(e,n){const{n:l,c:p,r0:y}=this,b=y+n;let T=Math.atan2(e,Math.abs(b))*Math.sign(b);b*l<0&&(T-=Math.PI*Math.sign(e)*Math.sign(b));const P=tr(this.center[0])*l;T=ut(T,-Math.PI-P,Math.PI-P);const I=Oe(Je(T/l)+this.center[0],-180,180),F=Math.asin(Oe((p-(e*e+b*b)*l*l)/(2*l),-1,1)),B=Oe(Je(F),-85.051129,Ze);return new Pe(I,B)}}const Ey=1.340264,Sy=-.081106,Ty=893e-6,Ay=.003796,N_=Math.sqrt(3)/2;class LE extends qf{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(N_*Math.sin(n)),p=l*l,y=p*p*p;return{x:.5*(e*Math.cos(l)/(N_*(Ey+3*Sy*p+y*(7*Ty+9*Ay*p)))/Math.PI+.5),y:1-.5*(l*(Ey+Sy*p+y*(Ty+Ay*p))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,p=l*l,y=p*p*p;for(let F,B,N,H=0;H<12&&(B=l*(Ey+Sy*p+y*(Ty+Ay*p))-n,N=Ey+3*Sy*p+y*(7*Ty+9*Ay*p),F=B/N,l=Oe(l-F,-Math.PI/3,Math.PI/3),p=l*l,y=p*p*p,!(Math.abs(F)<1e-12));++H);const b=N_*e*(Ey+3*Sy*p+y*(7*Ty+9*Ay*p))/Math.cos(l),T=Math.asin(Math.sin(l)/N_),P=Oe(180*b/Math.PI,-180,180),I=Oe(180*T/Math.PI,-85.051129,Ze);return new Pe(P,I)}}class OE extends qf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const l=360*(e-.5),p=Oe(360*(.5-n),-85.051129,Ze);return new Pe(l,p)}}const _g=Math.PI/2;function V_(o){return Math.tan((_g+o)/2)}class zE extends qf{constructor(e){super(e),this.center=e.center||[0,30];const[n,l]=this.parallels=e.parallels||[30,30];let p=tr(n),y=tr(l);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const b=Math.cos(p),T=V_(p);this.n=p===y?Math.sin(p):Math.log(b/Math.cos(y))/Math.log(V_(y)/T),this.f=b*Math.pow(V_(p),this.n)/this.n}project(e,n){n=tr(n),this.southernCenter&&(n=-n),e=tr(e-this.center[0]);const l=1e-6,{n:p,f:y}=this;y>0?n<-_g+l&&(n=-_g+l):n>_g-l&&(n=_g-l);const b=y/Math.pow(V_(n),p);let T=b*Math.sin(p*e),P=y-b*Math.cos(p*e);return T=.5*(T/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:T,y:this.southernCenter?P:1-P,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:l,f:p}=this,y=p-n,b=Math.sign(y),T=Math.sign(l)*Math.sqrt(e*e+y*y);let P=Math.atan2(e,Math.abs(y))*b;y*l<0&&(P-=Math.PI*Math.sign(e)*b);const I=Oe(Je(P/l)+this.center[0],-180,180),F=Oe(Je(2*Math.atan(Math.pow(p/T,1/l))-_g),-85.051129,Ze);return new Pe(I,this.southernCenter?-F:F)}}class u1 extends qf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Qe(e),y:rt(n),z:0}}unproject(e,n){const l=pt(e),p=wt(n);return new Pe(l,p)}}const h1=tr(Ze);class FE extends qf{project(e,n){const l=(n=tr(n))*n,p=l*l;return{x:.5*((e=tr(e))*(.8707-.131979*l+p*(p*(.003971*l-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+p*(.028874*l-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,p=25,y=0,b=l*l;do{b=l*l;const I=b*b;y=(l*(1.007226+b*(.015085+I*(.028874*b-.044475-.005916*I)))-n)/(1.007226+b*(.045255+I*(.259866*b-.311325-.005916*11*I))),l=Oe(l-y,-h1,h1)}while(Math.abs(y)>1e-6&&--p>0);b=l*l;const T=Oe(Je(e/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),P=Je(l);return new Pe(T,P)}}const d1=tr(Ze);class BE extends qf{project(e,n){n=tr(n),e=tr(e);const l=Math.cos(n),p=2/Math.PI,y=Math.acos(l*Math.cos(e/2)),b=Math.sin(y)/y,T=.5*(e*p+2*l*Math.sin(e/2)/b)||0,P=.5*(n+Math.sin(n)/b)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,p=n=(2*(1-n)-1)*Math.PI,y=25;const b=1e-6;let T=0,P=0;do{const I=Math.cos(p),F=Math.sin(p),B=2*F*I,N=F*F,H=I*I,W=Math.cos(l/2),ne=Math.sin(l/2),ue=2*W*ne,ae=ne*ne,fe=1-H*W*W,ye=fe?1/fe:0,be=fe?Math.acos(I*W)*Math.sqrt(1/fe):0,Ie=.5*(2*be*I*ne+2*l/Math.PI)-e,Re=.5*(be*F+p)-n,Ne=.5*ye*(H*ae+be*I*W*N)+1/Math.PI,Ve=ye*(ue*B/4-be*F*ne),Be=.125*ye*(B*ne-be*F*H*ue),He=.5*ye*(N*W+be*ae*I)+.5,Ye=Ve*Be-He*Ne;T=(Re*Ve-Ie*He)/Ye,P=(Ie*Be-Re*Ne)/Ye,l=Oe(l-T,-Math.PI,Math.PI),p=Oe(p-P,-d1,d1)}while((Math.abs(T)>b||Math.abs(P)>b)&&--y>0);return new Pe(Je(l),Je(p))}}class f1 extends qf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:l,cosPhi:p}=this;return{x:tr(e)*p*l+.5,y:-Math.sin(tr(n))/p*l+.5,z:0}}unproject(e,n){const{scale:l,cosPhi:p}=this,y=-(n-.5)/l,b=Oe(Je((e-.5)/l)/p,-180,180),T=Math.asin(Oe(y*p,-1,1)),P=Oe(Je(T),-85.051129,Ze);return new Pe(b,P)}}class jE extends u1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){const p=qp(e,n,l);return Ui(p,p,Wp(ec(l))),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,n,l){const p=je(n.lat,n.lng),y=vi([],p),b=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Ct(p,p,y,tt(1,0)*$t*b);const T=le(new Float64Array(16));return se(T,e.pixelMatrix,e.globeMatrix),Ui(p,p,T),new Pt(p[0],p[1])}pixelsPerMeter(e,n){return tt(1,0)*n}pixelSpaceConversion(e,n,l){const p=tt(1,e)*n,y=Ri(tt(1,45)*n,p,l);return this.pixelsPerMeter(e,n)/y}createTileMatrix(e,n,l){const p=Ur(ec(l.canonical));return se(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,n){const{center:l}=e,p=Wp(ec(n));return Se(p,p,tr(l.lng)),_e(p,p,tr(l.lat)),oe(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,n,l,p){return Ng(e,n,l,!0)||new Wt(0,0)}pointCoordinate3D(e,n,l){const p=this.pointCoordinate(e,n,l,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,n){return!Ng(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=(function(p,y){const b=p.cameraToCenterDistance,T=p._centerAltitude*y,P=p._camera,I=p._camera.forward(),F=pe([],ct([],I,-b),[0,0,T]),B=p.worldSize/(2*Math.PI),N=[0,0,-B],H=p.width/p.height,W=Math.tan(p.fovAboveCenter),ne=ct([],P.up(),W),ue=ct([],P.right(),W*H),ae=vi([],pe([],pe([],I,ne),ue)),fe=[];let ye;if(new kr(F,ae).closestPointOnSphere(N,B,fe)){const be=pe([],fe,N),Ie=Sr([],be,F);ye=Math.cos(p.fovAboveCenter)*kt(Ie)}else{const be=Sr([],F,N),Ie=Sr([],N,F);vi(Ie,Ie);const Re=kt(be)-B;ye=Math.sqrt(Re*(Re+2*B));const Ne=Math.acos(ye/(B+Re))-Math.acos(Gi(I,Ie));ye*=Math.cos(Ne)}return 1.01*ye})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=wu(e.zoom);if(l>0){const p=l1(e,tt(1,e.center.lat)*e.worldSize),y=e.worldSize/(2*Math.PI),b=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ri(n,p+y*(1-Math.cos(b)),Math.pow(l,10))}return n}upVector(e,n,l){return qp(n,l,e,1)}upVectorScale(e){return{metersToTile:$p(Th(ec(e)))}}}function p1(o){const e=o.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new u1(o);case"equirectangular":return new OE(o);case"naturalEarth":return new FE(o);case"equalEarth":return new LE(o);case"winkelTripel":return new BE(o);case"albers":return n?new f1(o):new kE(o);case"lambertConformalConic":return n?new f1(o):new zE(o);case"globe":return new jE(o)}throw new Error(`Invalid projection name: ${o.name}`)}const NE=Yi.types,VE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cy(o,e,n,l,p,y,b,T,P,I,F,B,N){const H=T?Math.min(gm,Math.round(T[0])):0,W=T?Math.min(gm,Math.round(T[1])):0;o.emplaceBack(e,n,Math.round(32*l),Math.round(32*p),y,b,(H<<1)+(P?1:0),0+(W<<1),16*I,16*F,256*B,256*N)}function Ry(o,e,n){o.emplaceBack(e,n)}function My(o,e,n,l,p,y,b){o.emplaceBack(e,n,l,p,y,b)}const U_=(o,e,n,l)=>{for(let p=0;p<e;p++)o.emplaceBack(n[0],n[1],n[2],l[0],l[1],l[2])};function xg(o,e,n,l,p){o.emplaceBack(e,n,l,p),o.emplaceBack(e,n,l,p),o.emplaceBack(e,n,l,p),o.emplaceBack(e,n,l,p)}function UE(o){for(const e of o.sections)if(_l(e.text))return!0;return!1}class K0{constructor(e){this.layoutVertexArray=new pu,this.indexArray=new qn,this.programConfigurations=e,this.segments=new $r,this.dynamicLayoutVertexArray=new Ho,this.opacityVertexArray=new Cf,this.placedSymbolArray=new Cd,this.iconTransitioningVertexArray=new io,this.globeExtVertexArray=new Af,this.zOffsetVertexArray=new ds,this.orientationVertexArray=new dh,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,n){const l=[],p=this.layoutVertexArray.uint16;for(let y=0;y<n;++y){const b=12*(e+y);l.push(...p.slice(b,b+12))}return l}updateSymbolVertexData(e,n,l,p,y,b,T,P,I,F,B,N,H){const W=this.layoutVertexArray.uint16,ne=12*e;W[ne]=n,W[ne+1]=l,W[ne+2]=p,W[ne+3]=y,W[ne+4]=b,W[ne+5]=T,W[ne+6]=P,W[ne+7]=I,W[ne+8]=F,W[ne+9]=B,W[ne+10]=N,W[ne+11]=H}upload(e,n,l,p,y,b){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$w.members,!!b),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,VE,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Xw.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hw.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ww.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Zw.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ut(K0,"SymbolBuffers");class Q0{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new $r,this.collisionVertexArray=new Sd,this.collisionVertexArrayExt=new Ho}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Yw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Kw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(Q0,"CollisionBuffers");class G_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=le([]),this.placementViewportMatrix=le([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=mm(this.zoom,n["text-size"],this.worldview,e.availableImages),this.iconSizeData=mm(this.zoom,n["icon-size"],this.worldview,e.availableImages);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),y=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(b=>Qo[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();if(!n||n.length===0)return!1;const l=Array.isArray(e)?e:[e];return n.some(p=>l.some(y=>p.getProperty(y)!=null))}createArrays(){this.text=new K0(new $(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new K0(new $(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Rd,this.lineVertexArray=new Hm,this.symbolInstances=new Nn}calculateGlyphDependencies(e,n,l,p,y){for(const b of e){const T=b.codePointAt(0);if(T===void 0)break;if(n[T]=!0,p&&y&&T<=65535){const P=yy[b];P&&(n[P.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,l,p,y,b,T){if(!e.hasProperty("icon-size"))return T*b;let P=1;const I=e.getUnevaluatedProperties()._values["icon-size"],F=mm(this.zoom,I,this.worldview,y),B=mg(F,n);if(F.kind!=="constant"&&F.kind!=="camera"||(P=B.uSize),F.kind==="composite"){const{minZoom:N,maxZoom:H}=F,W=I.possiblyEvaluate(new xr(N,{worldview:this.worldview}),p),ne=I.possiblyEvaluate(new xr(H,{worldview:this.worldview}),p),ue=W.evaluate(l,{},p,y);P=ue+(ne.evaluate(l,{},p,y)-ue)*B.uSizeT}return F.kind==="source"&&(P=I.possiblyEvaluate(new xr(this.zoom,{worldview:this.worldview}),p).evaluate(l,{},p,y)),P*b}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!f(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?xa.build(e):e}populate(e,n,l,p){const y=this.layers[0],b=y.layout,T=this.projection.name==="globe",P=b.get("text-font"),I=b.get("text-field"),F=b.get("icon-image"),[B,N]=b.get("icon-size-scale-range"),H=Oe(n.scaleFactor||1,B,N),W=(I.value.kind!=="constant"||I.value.value instanceof Bs&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),ne=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,ue=this.hasAnyAppearanceProperty("icon-image"),ae=b.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!W&&!ne&&!ue)return;const fe=n.iconDependencies,ye=n.glyphDependencies,be=n.availableImages,Ie=new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),Re=Ne=>{const Ve=Ne.id.toString();fe.has(Ve)?fe.get(Ve).push(Ne):fe.set(Ve,[Ne])};for(const Ne of e){const{feature:Ve,id:Be,index:He,sourceLayerIndex:Ye}=Ne,yt=y._featureFilter.needGeometry,ft=Fi(Ve,yt);if(!y._featureFilter.filter(Ie,ft,l))continue;if(yt||(ft.geometry=Ti(Ve,l,p)),T&&Ve.type!==1&&l.z<=5){const Mt=ft.geometry,At=.98078528056,ti=(ri,Zt)=>Gi(qp(ri.x,ri.y,l,1),qp(Zt.x,Zt.y,l,1))<At;for(let ri=0;ri<Mt.length;ri++)Mt[ri]=ai(Mt[ri],ti)}let gt,Tt;if(W){const Mt=y.getValueAndResolveTokens("text-field",ft,l,be),At=Bs.factory(Mt);UE(At)&&(this.hasRTLText=!0),(!this.hasRTLText||Ec()==="unavailable"||this.hasRTLText&&Fa.isParsed())&&(gt=Jw(At,y,ft))}if(ne){const Mt=y.getValueAndResolveTokens("icon-image",ft,l,be);Tt=this.getResolvedImageFromTokens(Mt)}const Et=this.layers[0];let St=!1;if(!Tt&&ue){const Mt=Et.getAppearances();for(const At of Mt)if(At.getProperty("icon-image")){const ti=Et.getAppearanceValueAndResolveTokens(At,"icon-image",ft,l,be);if(ti){Tt=this.getResolvedImageFromTokens(ti),St=!0;break}}}if(!gt&&!Tt)continue;const ht=this.sortFeaturesByKey?ae.evaluate(ft,{},l):void 0,Rt={id:Be,text:gt,icon:Tt,index:He,sourceLayerIndex:Ye,geometry:ft.geometry,properties:Ve.properties,type:NE[Ve.type],sortKey:ht};if(this.features.push(Rt),this.featureToAppearanceIndex[He]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Be,properties:Ve.properties,usesAppearanceIconAsPlaceholder:St,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),Tt){const Mt=Et._unevaluatedLayout._values,{iconPrimary:At,iconSecondary:ti}=by(Tt,this.iconSizeData,Mt["icon-size"],l,this.zoom,Rt,this.pixelRatio,H,this.worldview,be);Re(At),ti&&(this.hasAnySecondaryIcon=!0,Re(ti))}const vt=Et.getAppearances();if(vt.length!==0&&vt.forEach(Mt=>{if(!Mt.getProperty("icon-image"))return;const At=this.getCombinedIconPrimary(Mt,Et,ft,l,be,Rt,H);At&&Re(At)}),gt){const Mt=P.evaluate(ft,{},l).join(","),At=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Qo.vertical)>=0;for(const ti of gt.sections)if(ti.image){const ri=ti.image.getPrimary().scaleSelf(this.pixelRatio),Zt=ri.id.toString(),Kt=fe.get(Zt)||[];Kt.push(ri),fe.set(Zt,Kt)}else{const ri=yf(gt.toString()),Zt=ti.fontStack||Mt,Kt=ye[Zt]=ye[Zt]||{};this.calculateGlyphDependencies(ti.text,Kt,At,this.allowVerticalPlacement,ri)}}}if(b.get("symbol-placement")==="line"&&(this.features=(function(Ne){const Ve={},Be={},He=[];let Ye=0;function yt(Et){He.push(Ne[Et]),Ye++}function ft(Et,St,ht){const Rt=Be[Et];return delete Be[Et],Be[St]=Rt,He[Rt].geometry[0].pop(),He[Rt].geometry[0]=He[Rt].geometry[0].concat(ht[0]),Rt}function gt(Et,St,ht){const Rt=Ve[St];return delete Ve[St],Ve[Et]=Rt,He[Rt].geometry[0].shift(),He[Rt].geometry[0]=ht[0].concat(He[Rt].geometry[0]),Rt}function Tt(Et,St,ht){const Rt=ht?St[0][St[0].length-1]:St[0][0];return`${Et}:${Rt.x}:${Rt.y}`}for(let Et=0;Et<Ne.length;Et++){const St=Ne[Et],ht=St.geometry,Rt=St.text?St.text.toString():null;if(!Rt){yt(Et);continue}const vt=Tt(Rt,ht),Mt=Tt(Rt,ht,!0);if(vt in Be&&Mt in Ve&&Be[vt]!==Ve[Mt]){const At=gt(vt,Mt,ht),ti=ft(vt,Mt,He[At].geometry);delete Ve[vt],delete Be[Mt],Be[Tt(Rt,He[ti].geometry,!0)]=ti,He[At].geometry=null}else vt in Be?ft(vt,Mt,ht):Mt in Ve?gt(vt,Mt,ht):(yt(Et),Ve[vt]=Ye-1,Be[Mt]=Ye-1)}return He.filter(Et=>Et.geometry)})(this.features)),b.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ne of n.elevationFeatures)this.elevationFeatureIdToIndex.set(Ne.id,this.elevationFeatures.length),this.elevationFeatures.push(Ne)}}else b.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ne,Ve)=>Ne.sortKey-Ve.sortKey)}getCombinedIconPrimary(e,n,l,p,y,b,T){let P,I;const F=e.getUnevaluatedProperties();if(F._values["icon-image"].value!==void 0){const B=n.getAppearanceValueAndResolveTokens(e,"icon-image",l,p,y);P=this.getResolvedImageFromTokens(B)}else{const B=n.getValueAndResolveTokens("icon-image",l,p,y);P=this.getResolvedImageFromTokens(B)}if(P){const B=e.hasProperty("icon-size")?F._values["icon-size"]:n._unevaluatedLayout._values["icon-size"];I=by(P,mm(this.zoom,B,this.worldview,y),B,p,this.zoom,b,this.pixelRatio,T,this.worldview,y).iconPrimary}return I}updateSymbolInstanceIconVertices(e,n,l,p,y,b,T,P,I,F,B,N,H,W){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(n.activeAppearance===l)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(l){const ne=this.getCombinedIconPrimary(l,I,p,b,T,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:n.properties,type:"Point",id:n.id},F);if(!ne)return{vertexOffsetDelta:0,hasChanges:!1};const ue=ne.toString(),ae=this.iconAtlasPositions&&this.iconAtlasPositions.get(ue);if(ae){const{appearanceIconOffset:fe,appearanceIconRotate:ye}=t1(l,I,p,b,N,W,H,F);let be=k_(ae,void 0,fe,I.layout.get("icon-anchor").evaluate(p,B,b));const Ie=ae.sdf,Re=I.layout.get("icon-text-fit").constantOr("none");Re!=="none"&&n.textShaping&&n.iconTextFitPadding&&n.fontScale&&(be=V0(be,n.textShaping,Re,n.iconTextFitPadding,fe,n.fontScale));const Ne=this.calculateEffectiveAppearanceIconSize(l,P.zoom,p,b,T,F,H),Ve=0,Be=1+(Math.min(gm,Math.round(Ne*Fd))<<1),He=H0(be,ye,Ie,Re!=="none",F);n.isUsingAppearanceIconVertexData||(n.isUsingAppearanceIconVertexData=!0,n.layoutBasedIconVertexData=this.icon.getSymbolVertexData(y,e.numIconVertices));let Ye=y;for(let ft=0;ft<He.length;++ft){const gt=He[ft],Tt=n.layoutBasedIconVertexData[0]||e.tileAnchorX,Et=n.layoutBasedIconVertexData[1]||e.tileAnchorY,St=16*gt.pixelOffsetTL.x,ht=16*gt.pixelOffsetTL.y,Rt=16*gt.pixelOffsetBR.x,vt=16*gt.pixelOffsetBR.y,Mt=16*gt.minFontScaleX,At=16*gt.minFontScaleY;this.icon.updateSymbolVertexData(Ye,Tt,Et,Math.round(32*gt.tl.x),Math.round(32*gt.tl.y),gt.texPrimary.x,gt.texPrimary.y,Ve,Be,St,ht,Mt,At),this.icon.updateSymbolVertexData(Ye+1,Tt,Et,Math.round(32*gt.tr.x),Math.round(32*gt.tr.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y,Ve,Be,Rt,ht,Mt,At),this.icon.updateSymbolVertexData(Ye+2,Tt,Et,Math.round(32*gt.bl.x),Math.round(32*gt.bl.y),gt.texPrimary.x,gt.texPrimary.y+gt.texPrimary.h,Ve,Be,St,vt,Mt,At),this.icon.updateSymbolVertexData(Ye+3,Tt,Et,Math.round(32*gt.br.x),Math.round(32*gt.br.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y+gt.texPrimary.h,Ve,Be,Rt,vt,Mt,At),Ye+=4}const yt=e.numIconVertices-4*He.length;for(let ft=0;ft<yt;++ft)this.icon.updateSymbolVertexData(Ye+ft,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(n.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(y,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(n.isUsingAppearanceIconVertexData){const ue=n.layoutBasedIconVertexData.length/12;for(let ae=0;ae<ue;++ae){const fe=ae*12;this.icon.updateSymbolVertexData(y+ae,n.layoutBasedIconVertexData[fe+0],n.layoutBasedIconVertexData[fe+1],n.layoutBasedIconVertexData[fe+2],n.layoutBasedIconVertexData[fe+3],n.layoutBasedIconVertexData[fe+4],n.layoutBasedIconVertexData[fe+5],n.layoutBasedIconVertexData[fe+6],n.layoutBasedIconVertexData[fe+7],n.layoutBasedIconVertexData[fe+8],n.layoutBasedIconVertexData[fe+9],n.layoutBasedIconVertexData[fe+10],n.layoutBasedIconVertexData[fe+11])}return n.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:ue,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe){const ye=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!ye)return{vertexOffsetDelta:ye?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(n.activeAppearance===l)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(l&&n.textShaping){const{appearanceTextOffset:be,appearanceTextRotate:Ie,appearanceTextSize:Re}=i1(l,T,p,b,B,H,N);n.fontScale=a1(Re,n.textScaleFactor);const Ne=l.getUnevaluatedProperty("text-size");let Ve=this.textSizeData,Be=ue,He=ae;l.hasProperty("text-size")&&(Ve=mm(this.zoom,Ne,this.worldview,fe),Be=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,He=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Ye=n.textShaping.bottom-B[1],yt=n.textShaping.left-B[0],ft=n.textShaping.right-B[0];n.textShaping.top=be[1]+(n.textShaping.top-B[1]),n.textShaping.bottom=be[1]+Ye,n.textShaping.left=be[0]+yt,n.textShaping.right=be[0]+ft;const gt=Jv(0,n.textShaping,be,T,!1,p,I,this.allowVerticalPlacement,Ie),Tt=Re&&Ve.kind==="composite"?Ne.possiblyEvaluate(new xr(Be,{}),b).evaluate(p,F,b):W,Et=Re&&Ve.kind==="composite"?Ne.possiblyEvaluate(new xr(He,{}),b).evaluate(p,F,b):ne,St=X0(l.name,Ve,Re,P,Tt,Et),ht=Array.isArray(St)?St[1]:Re,Rt=0,vt=1+(Math.min(gm,Math.round(ht*Fd))<<1);n.isUsingAppearanceTextVertexData||(n.isUsingAppearanceTextVertexData=!0,n.layoutBasedTextVertexData=this.text.getSymbolVertexData(y,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let Mt=0;Mt<gt.length&&Mt<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++Mt){const At=gt[Mt],ti=At.glyphOffset[1],ri=e.tileAnchorX,Zt=e.tileAnchorY,Kt=y+4*Mt;this.text.updateSymbolVertexData(Kt,ri,Zt,Math.round(32*At.tl.x),Math.round(32*(ti+At.tl.y)),At.texPrimary.x,At.texPrimary.y,Rt,vt,At.pixelOffsetTL.x,At.pixelOffsetTL.y,At.minFontScaleX,At.minFontScaleY),this.text.updateSymbolVertexData(Kt+1,ri,Zt,Math.round(32*At.tr.x),Math.round(32*(ti+At.tr.y)),At.texPrimary.x+At.texPrimary.w,At.texPrimary.y,Rt,vt,At.pixelOffsetBR.x,At.pixelOffsetTL.y,At.minFontScaleX,At.minFontScaleY),this.text.updateSymbolVertexData(Kt+2,ri,Zt,Math.round(32*At.bl.x),Math.round(32*(ti+At.bl.y)),At.texPrimary.x,At.texPrimary.y+At.texPrimary.h,Rt,vt,At.pixelOffsetTL.x,At.pixelOffsetBR.y,At.minFontScaleX,At.minFontScaleY),this.text.updateSymbolVertexData(Kt+3,ri,Zt,Math.round(32*At.br.x),Math.round(32*(ti+At.br.y)),At.texPrimary.x+At.texPrimary.w,At.texPrimary.y+At.texPrimary.h,Rt,vt,At.pixelOffsetBR.x,At.pixelOffsetBR.y,At.minFontScaleX,At.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(n.isUsingAppearanceTextVertexData){const Ie=n.layoutBasedTextVertexData.length/12;for(let Re=0;Re<Ie;++Re){const Ne=Re*12;this.text.updateSymbolVertexData(y+Re,n.layoutBasedTextVertexData[Ne+0],n.layoutBasedTextVertexData[Ne+1],n.layoutBasedTextVertexData[Ne+2],n.layoutBasedTextVertexData[Ne+3],n.layoutBasedTextVertexData[Ne+4],n.layoutBasedTextVertexData[Ne+5],n.layoutBasedTextVertexData[Ne+6],n.layoutBasedTextVertexData[Ne+7],n.layoutBasedTextVertexData[Ne+8],n.layoutBasedTextVertexData[Ne+9],n.layoutBasedTextVertexData[Ne+10],n.layoutBasedTextVertexData[Ne+11])}return n.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:Ie,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,n,l,p,y,b,T){this.text.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,y,l,p,b,T,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const l=Lt(e),p=1/l;let y=!1,b=!1;for(let T=0;T<this.symbolInstances.length;T++){const P=this.symbolInstances.get(T),I=xe(1,0,0),F=xe(0,1,0),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:N,numIconVertices:H,numVerticalIconVertices:W}=P,ne=B>0||N>0,ue=H>0,ae=this.elevationFeatures[P.elevationFeatureIndex];if(ae){const fe=new Pt(P.tileAnchorX,P.tileAnchorY),ye=.075+ae.pointElevation(fe);P.zOffset!==ye&&(n=!0,P.zOffset=ye),ye!==0&&(this.hasAnyZOffset=!0);const be=ae.computeSlopeNormal(fe,p),Ie=Zn(Rn(),xe(0,0,1),be);Gn(I,I,Ie),Gn(F,F,Ie),I[2]*=l,F[2]*=l,I[0]===1&&I[1]===0&&I[2]===0&&F[0]===0&&F[1]===1&&F[2]===0||(y=y||ne,b=b||ue)}if(ne&&(U_(this.text.orientationVertexArray,B,I,F),U_(this.text.orientationVertexArray,N,I,F)),ue){const{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:ye}=P;fe>=0&&U_(this.icon.orientationVertexArray,H,I,F),ye>=0&&U_(this.icon.orientationVertexArray,W,I,F)}}y||(this.text.orientationVertexArray=void 0),b||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(y,b,T)=>{l+=b,l>y.length&&y.resize(l);for(let P=-b;P<0;P++)y.emplace(P+l,T)},n=(y,b,T)=>{p+=b,p>y.length&&y.resize(p);for(let P=-b;P<0;P++)y.emplace(P+p,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,p=0;for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:P,numIconVertices:I}=b,F=b.zOffset,B=I>0;if((T>0||P>0)&&(e(this.text.zOffsetVertexArray,T,F),e(this.text.zOffsetVertexArray,P,F)),B){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:H}=b;N>=0&&n(this.icon.zOffsetVertexArray,I,F),H>=0&&n(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,F)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,l,p,y){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(b=>b.appearances&&b.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,l,p,y){if(!(e&&n&&l&&this.appearanceFeatureData))return!1;const b=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,T=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!b&&!T)return!1;const P=this.layers[0],I=P.layout;let F=1,B=0,N=!1;if(b){const[ae,fe]=I.get("icon-size-scale-range");F=Oe(1,ae,fe)}let H=1,W=0,ne=!1;if(T){const[ae,fe]=I.get("text-size-scale-range");H=Oe(1,ae,fe)}const ue=new Map;if(y&&l)for(const ae of l){const fe=y.getImage(ae,P.scope);if(fe){const ye=new vs(ae.toString());ue.set(ye.toString(),fe)}}for(let ae=0;ae<this.symbolInstances.length;ae++){const fe=this.symbolInstances.get(ae),ye=this.featureToAppearanceIndex[fe.featureIndex],be=ye!==void 0?this.appearanceFeatureData[ye]:void 0;if(!be)continue;const Ie=be.id,Re=n&&Ie!==void 0?n[String(Ie)]:void 0,Ne={type:"Point",id:be.id,properties:be.properties,geometry:[]},Ve=P.appearances&&P.appearances.find(Be=>Be.isActive({globals:p,feature:Ne,canonical:e,featureState:Re}));if(T){const Be=I.get("text-size"),He=I.get("text-offset").evaluate(Ne,Re,e),Ye=Be.evaluate(Ne,Re,e),yt=I.get("text-rotate").evaluate(Ne,Re,e),ft=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,gt=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,Tt=Be.evaluate(Ne,{zoom:ft},e),Et=Be.evaluate(Ne,{zoom:gt},e),St=this.updateSymbolInstanceTextVertices(fe,be,Ve,Ne,W,e,P,H,ue,Re,He,Ye,yt,Tt,Et,ft,gt,l);W+=St.vertexOffsetDelta,ne=ne||St.hasChanges}if(b){const Be=I.get("icon-offset").evaluate(Ne,Re,e),He=I.get("icon-size").evaluate(Ne,Re,e,l),Ye=I.get("icon-rotate").evaluate(Ne,Re,e),yt=this.updateSymbolInstanceIconVertices(fe,be,Ve,Ne,B,e,l,p,P,F,Re,Be,He,Ye);B+=yt.vertexOffsetDelta,N=N||yt.hasChanges}be.activeAppearance=Ve}return N&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),ne&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),N||ne}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:p,y}of n)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne,ue,ae,fe){const ye=e.indexArray,be=e.layoutVertexArray,Ie=e.globeExtVertexArray,Re=e.segments.prepareSegment(4*fe,be,ye,this.canOverlap?b.sortKey:void 0),Ne=this.glyphOffsetArray.length,Ve=Re.vertexLength,Be=this.allowVerticalPlacement&&T===Qo.vertical?Math.PI/2:0,He=b.text&&b.text.sections;for(let ft=0;ft<n.length;ft++){const{tl:gt,tr:Tt,bl:Et,br:St,texPrimary:ht,texSecondary:Rt,pixelOffsetTL:vt,pixelOffsetBR:Mt,minFontScaleX:At,minFontScaleY:ti,glyphOffset:ri,isSDF:Zt,sectionIndex:Kt}=n[ft],Ei=Re.vertexLength,pi=ri[1];if(Cy(be,I.x,I.y,gt.x,pi+gt.y,ht.x,ht.y,l,Zt,vt.x,vt.y,At,ti),Cy(be,I.x,I.y,Tt.x,pi+Tt.y,ht.x+ht.w,ht.y,l,Zt,Mt.x,vt.y,At,ti),Cy(be,I.x,I.y,Et.x,pi+Et.y,ht.x,ht.y+ht.h,l,Zt,vt.x,Mt.y,At,ti),Cy(be,I.x,I.y,St.x,pi+St.y,ht.x+ht.w,ht.y+ht.h,l,Zt,Mt.x,Mt.y,At,ti),P){const{x:ei,y:ki,z:Qi}=P.anchor,[yr,Wi,Ir]=P.up;My(Ie,ei,ki,Qi,yr,Wi,Ir),My(Ie,ei,ki,Qi,yr,Wi,Ir),My(Ie,ei,ki,Qi,yr,Wi,Ir),My(Ie,ei,ki,Qi,yr,Wi,Ir),xg(e.dynamicLayoutVertexArray,ei,ki,Qi,Be)}else xg(e.dynamicLayoutVertexArray,I.x,I.y,I.z,Be);if(ue){const ei=Rt||ht;Ry(e.iconTransitioningVertexArray,ei.x,ei.y),Ry(e.iconTransitioningVertexArray,ei.x+ei.w,ei.y),Ry(e.iconTransitioningVertexArray,ei.x,ei.y+ei.h),Ry(e.iconTransitioningVertexArray,ei.x+ei.w,ei.y+ei.h)}ye.emplaceBack(Ei,Ei+1,Ei+2),ye.emplaceBack(Ei+1,Ei+2,Ei+3),Re.vertexLength+=4,Re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ri[0]),ft!==n.length-1&&Kt===n[ft+1].sectionIndex||e.programConfigurations.populatePaintArrays(be.length,b,b.index,{},H,W,ne,He&&He[Kt],this.worldview)}const Ye=fe-n.length;Ye!==0&&this._addNullVertices(Ye,be,l,P,Ie,e,ue,Re,ye);const yt=P?P.anchor:I;e.placedSymbolArray.emplaceBack(yt.x,yt.y,yt.z,I.x,I.y,Ne,this.glyphOffsetArray.length-Ne,Ve,F,B,I.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],T,0,0,0,N,0),e.symbolInstanceIndices.push(ae)}_addNullVertices(e,n,l,p,y,b,T,P,I){for(let F=0;F<e;F++){for(let N=0;N<4;N++)Cy(n,0,0,0,0,0,0,l,!1,0,0,0,0),p&&My(y,0,0,0,0,0,0),xg(b.dynamicLayoutVertexArray,0,0,0,0),T&&Ry(b.iconTransitioningVertexArray,0,0);const B=P.vertexLength;I.emplaceBack(B,B+1,B+2),I.emplaceBack(B+1,B+2,B+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,l,p,y,b,T){e.emplaceBack(n,l,p,y,b,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,n,l,p,y,b,T){const P=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),I=P.vertexLength,F=T.tileAnchorX,B=T.tileAnchorY;for(let H=0;H<4;H++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,n,e.padding,T.zOffset),this._commitLayoutVertex(l.layoutVertexArray,p,y,b,F,B,new Pt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,p,y,b,F,B,new Pt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,p,y,b,F,B,new Pt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,p,y,b,F,B,new Pt(e.x1,e.y2)),P.vertexLength+=4;const N=l.indexArray;N.emplaceBack(I,I+1),N.emplaceBack(I+1,I+2),N.emplaceBack(I+2,I+3),N.emplaceBack(I+3,I),P.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,p,y,b){for(let T=p;T<y;T++){const P=l.get(T),I=this.getSymbolInstanceTextSize(e,b,n,T);this._addCollisionDebugVertices(P,I,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(e,n,l,p,y,b){for(let T=p;T<y;T++){const P=l.get(T),I=this.getSymbolInstanceIconSize(e,n,b.placedIconSymbolIndex);this._addCollisionDebugVertices(P,I,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(e,n,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Q0(hh,Mv.members,io),this.iconCollisionBox=new Q0(hh,Mv.members,io);const p=mg(this.iconSizeData,e),y=mg(this.textSizeData,e,l);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(y,e,n,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(y,e,n,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(p,e,n,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(p,e,n,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(e,n,l,p){const y=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:p),b=U0(this.textSizeData,e,y)/Is;return this.tilePixelRatio*b}getSymbolInstanceIconSize(e,n,l){const p=this.icon.placedSymbolArray.get(l),y=U0(this.iconSizeData,e,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(e,n,l,p){e.emplaceBack(n,-l,-l,p),e.emplaceBack(n,l,-l,p),e.emplaceBack(n,l,l,p),e.emplaceBack(n,-l,l,p)}_updateTextDebugCollisionBoxes(e,n,l,p,y,b,T){for(let P=p;P<y;P++){const I=l.get(P),F=this.getSymbolInstanceTextSize(e,b,n,P);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,I.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(e,n,l,p,y,b,T){for(let P=p;P<y;P++){const I=l.get(P),F=this.getSymbolInstanceIconSize(e,n,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,F,I.padding,b.zOffset)}}updateCollisionDebugBuffers(e,n,l,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=mg(this.iconSizeData,e,p),b=mg(this.textSizeData,e,l);for(let T=0;T<this.symbolInstances.length;T++){const P=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(b,e,n,P.textBoxStartIndex,P.textBoxEndIndex,P,l),this._updateTextDebugCollisionBoxes(b,e,n,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P,l),this._updateIconDebugCollisionBoxes(y,e,n,P.iconBoxStartIndex,P.iconBoxEndIndex,P,p),this._updateIconDebugCollisionBoxes(y,e,n,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,p,y,b,T,P,I){const F={};if(n<l){const{x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be,featureIndex:Ie}=e.get(n);F.textBox={x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be},F.textFeatureIndex=Ie}if(p<y){const{x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be,featureIndex:Ie}=e.get(p);F.verticalTextBox={x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be},F.verticalTextFeatureIndex=Ie}if(b<T){const{x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be,featureIndex:Ie}=e.get(b);F.iconBox={x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be},F.iconFeatureIndex=Ie}if(P<I){const{x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be,featureIndex:Ie}=e.get(P);F.verticalIconBox={x1:B,y1:N,x2:H,y2:W,padding:ne,projectedAnchorX:ue,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:ye,tileAnchorY:be},F.verticalIconFeatureIndex=Ie}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),p=l.vertexStartIndex+4*l.numGlyphs;for(let y=l.vertexStartIndex;y<p;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),p=[],y=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const P=this.symbolInstances.get(T);p.push(0|Math.round(n*P.tileAnchorX+l*P.tileAnchorY)),y.push(P.featureIndex)}return b.sort((T,P)=>p[T]-p[P]||y[P]-y[T]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:I}=l;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&b!==y&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&n<this.elevationFeatures.length&&(l=this.elevationFeatures[n]),l}}function m1(o,e){return e.replace(/{([^{}]+)}/g,(n,l)=>l in o?String(o[l]):"")}let g1,y1,J0;Ut(G_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),G_.addDynamicAttributes=xg;class _1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_a,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut(_1,"FormatSectionOverride",{omit:["defaultValue"]});const ex=()=>J0||(J0={layout:g1||(g1=new Kr({"symbol-placement":new Nt(it.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(it.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nt(it.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nt(it.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nt(it.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nt(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt(it.layout_symbol["icon-size"]),"icon-size-scale-range":new Nt(it.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Qt(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt(it.layout_symbol["icon-image"]),"icon-image-use-theme":new Nt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Qt(it.layout_symbol["icon-rotate"]),"icon-padding":new Nt(it.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(it.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt(it.layout_symbol["icon-offset"]),"icon-anchor":new Qt(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(it.layout_symbol["text-rotation-alignment"]),"text-field":new Qt(it.layout_symbol["text-field"]),"text-font":new Qt(it.layout_symbol["text-font"]),"text-size":new Qt(it.layout_symbol["text-size"]),"text-size-scale-range":new Nt(it.layout_symbol["text-size-scale-range"]),"text-max-width":new Qt(it.layout_symbol["text-max-width"]),"text-line-height":new Qt(it.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt(it.layout_symbol["text-letter-spacing"]),"text-justify":new Qt(it.layout_symbol["text-justify"]),"text-radial-offset":new Qt(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(it.layout_symbol["text-variable-anchor"]),"text-anchor":new Qt(it.layout_symbol["text-anchor"]),"text-max-angle":new Nt(it.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(it.layout_symbol["text-writing-mode"]),"text-rotate":new Qt(it.layout_symbol["text-rotate"]),"text-padding":new Nt(it.layout_symbol["text-padding"]),"text-keep-upright":new Nt(it.layout_symbol["text-keep-upright"]),"text-transform":new Qt(it.layout_symbol["text-transform"]),"text-offset":new Qt(it.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(it.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nt(it.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(it.layout_symbol["text-optional"]),visibility:new Nt(it.layout_symbol.visibility)})),paint:y1||(y1=new Kr({"icon-opacity":new Qt(it.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Qt(it.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Qt(it.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Qt(it.paint_symbol["text-emissive-strength"]),"icon-color":new Qt(it.paint_symbol["icon-color"]),"icon-halo-color":new Qt(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt(it.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(it.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(it.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Qt(it.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Qt(it.paint_symbol["text-occlusion-opacity"]),"text-color":new Qt(it.paint_symbol["text-color"],{runtimeType:ca,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Qt(it.paint_symbol["text-halo-color"]),"text-halo-width":new Qt(it.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt(it.paint_symbol["text-halo-blur"]),"text-translate":new Nt(it.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(it.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nt(it.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nt(it.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nt(it.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nt(it.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Qt(it.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},J0);class $_ extends ia{constructor(e,n,l,p){super(e,ex(),n,l,p,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=le([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach(p=>{p.recalculate(e,n,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const y of l)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,l,p){return this._saturation===e&&this._contrast===n&&this._brightnessMin===l&&this._brightnessMax===p||(this._colorAdjustmentMatrix=(function(y,b,T,P){y=pn(y),b=Br(b);const I=Z(),F=y/3,B=1-2*F,N=[B,F,F,0,F,B,F,0,F,F,B,0,0,0,0,1],H=.5-.5*b,W=P-T;return se(I,[W,0,0,0,0,W,0,0,0,0,W,0,T,T,T,1],[b,0,0,0,0,b,0,0,0,0,b,0,H,H,H,1]),se(I,I,N),I})(e,n,l,p),this._saturation=e,this._contrast=n,this._brightnessMin=l,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,l,p){const y=this.layout.get(e).evaluate(n,{},l,p),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||nu(b.value)||!y?y:m1(n.properties,y)}getAppearanceValueAndResolveTokens(e,n,l,p,y){const b=e.getProperty(n);if(!b)return;const T=b.evaluate(l,{},p,y),P=e.getUnevaluatedProperties()._values[n];return P.isDataDriven()||nu(P.value)||!T||typeof T!="string"?T:m1(l.properties,T)}createBucket(e){return new G_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ex().paint.overridableProperties){if(!$_.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new _1(n),p=new ld(l,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let y=null;y=n.value.kind==="constant"||n.value.kind==="source"?new Qs("source",p):new Ns("composite",p,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Sc(n.property,y,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&$_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),p=ex().paint.properties[n];let y=!1;const b=T=>{for(const P of T)if(p.overrides&&p.overrides.hasOverride(P))return void(y=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Bs)b(l.value.value.sections);else if(l.value.kind==="source"){const T=I=>{y||(I instanceof Xa&&Qn(I.value)===Bu?b(I.value.sections):I instanceof fi?b(I.sections):I.eachChild(T))},P=l.value;P._styleExpression&&T(P._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,l){return{config:new U(this,{zoom:n,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let x1,v1,b1,w1;var tx=Xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function H_(o,e,n,l,p,y,b,T){const P=[o,e,1,n,l,1,p,y,1],I=[b,T,1],F=G([],P),[B,N,H]=Ci(I,I,F);return J(P,P,[B,0,0,0,N,0,0,0,H])}function E1(o,e,n,l,p,y,b,T){const P=(function(I,F,B,N,H,W,ne,ue){const ae=H_(0,0,1,0,1,1,0,1),fe=H_(I,F,B,N,H,W,ne,ue);return J(fe,fe,G([],ae))})(o,e,n,l,p,y,b,T);return[P[2]/P[8]/$t,P[5]/P[8]/$t]}function q_(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Ze)]}class S1 extends Pl{constructor(e,n,l,p){super(),this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new mo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Bh(this.map._requestManager.transformRequest(this.url,Kn.Image),(l,p)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new zu(l)):p&&(this.image=p instanceof HTMLImageElement?ka.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new py(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new mo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof py||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],l=e[0][1];for(const y of e)y[1]>l&&(l=y[1]),y[1]<n&&(n=y[1]);const p=(l+n)/2;if(p>Ze?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=e.map(Wt.fromLngLat);this.tileID=(function(b){let T=1/0,P=1/0,I=-1/0,F=-1/0;for(const ne of b)T=Math.min(T,ne.x),P=Math.min(P,ne.y),I=Math.max(I,ne.x),F=Math.max(F,ne.y);const B=Math.max(I-T,F-P),N=Math.max(0,Math.floor(-Math.log2(B))),H=Math.pow(2,N);let W=Math.floor((T+I)/2*H);return W>1&&(W-=1),new wl(N,W,Math.floor((P+F)/2*H))})(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new mo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof py||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ae in this.tiles){const fe=this.tiles[ae];fe.state!=="loaded"&&(fe.state="loaded",fe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=wy(new wl(0,0,0),this.map.transform.projection),l=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ae){const fe=ae[1].x-ae[0].x,ye=ae[1].y-ae[0].y,be=ae[2].x-ae[1].x,Ie=ae[2].y-ae[1].y,Re=ae[3].x-ae[2].x,Ne=ae[3].y-ae[2].y,Ve=ae[0].x-ae[3].x,Be=ae[0].y-ae[3].y,He=fe*Ie-be*ye,Ye=be*Ne-Re*Ie,yt=Re*Be-Ve*Ne,ft=Ve*ye-fe*Be;return He>0&&Ye>0&&yt>0&&ft>0||He<0&&Ye<0&&yt<0&&ft<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=wy(this.tileID,this.map.transform.projection),[y,b,T,P]=this.coordinates.map(ae=>{const fe=p.projection.project(ae[0],ae[1]);return c1(p,fe)._round()});this.perspectiveTransform=E1(y.x,y.y,b.x,b.y,T.x,T.y,P.x,P.y);const I=this._boundsArray=new xl;I.emplaceBack(y.x,y.y,0,0),I.emplaceBack(b.x,b.y,$t,0),I.emplaceBack(P.x,P.y,0,$t),I.emplaceBack(T.x,T.y,$t,$t),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(I,tx.members),this.boundsSegments=$r.simpleSegment(0,0,4,2);const F=[],B=[q_((N=this.coordinates)[0]),q_(N[1]),q_(N[2]),q_(N[3])];var N;const[H,W,ne,ue]=(function(ae){let fe=ae[0][0],ye=fe,be=ae[0][1],Ie=be;for(let Re=1;Re<ae.length;Re++)ae[Re][0]<fe?fe=ae[Re][0]:ae[Re][0]>ye&&(ye=ae[Re][0]),ae[Re][1]<be?be=ae[Re][1]:ae[Re][1]>Ie&&(Ie=ae[Re][1]);return[fe,be,ye-fe,Ie-be]})(B);{const ae=new xl,[fe,ye,be,Ie]=(function(St){let ht=St[0].x,Rt=ht,vt=St[0].y,Mt=vt;for(let At=1;At<St.length;At++)St[At].x<ht?ht=St[At].x:St[At].x>Rt&&(Rt=St[At].x),St[At].y<vt?vt=St[At].y:St[At].y>Mt&&(Mt=St[At].y);return[ht,vt,Rt-ht,Mt-vt]})(l),Re=St=>[(St.x-fe)/be,(St.y-ye)/Ie],[Ne,Ve,Be,He]=l.map(Re),Ye=(function(St,ht,Rt,vt,Mt,At,ti,ri){const Zt=H_(0,0,1,0,1,1,0,1);return J(Zt,Zt,G([],H_(St,ht,Rt,vt,Mt,At,ti,ri)))})(Ne[0],Ne[1],Ve[0],Ve[1],Be[0],Be[1],He[0],He[1]);this.elevatedGlobePerspectiveTransform=E1(Ne[0],Ne[1],Ve[0],Ve[1],Be[0],Be[1],He[0],He[1]);const yt=(St,ht)=>{F.push(St.lng);const Rt=Math.round((St.lng-H)/ne*$t),vt=Math.round((St.lat-W)/ue*$t),Mt=Re(ht),At=Ci([],[Mt[0],Mt[1],1],Ye),ti=Math.round(At[0]/At[2]*$t),ri=Math.round(At[1]/At[2]*$t);ae.emplaceBack(Rt,vt,ti,ri)},ft=l[3].x-l[0].x,gt=l[3].y-l[0].y,Tt=l[2].x-l[1].x,Et=l[2].y-l[1].y;for(let St=0;St<65;St++){const ht=St/64,Rt=[l[0].x+ht*ft,l[0].y+ht*gt],vt=[l[1].x+ht*Tt,l[1].y+ht*Et],Mt=vt[0]-Rt[0],At=vt[1]-Rt[1];for(let ti=0;ti<65;ti++){const ri=ti/64,Zt={x:Rt[0]+Mt*ri,y:Rt[1]+At*ri};yt(n.projection.unproject(Zt.x,Zt.y),Zt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ae,tx.members)}{this.maxLongitudeTriangleSize=0;let ae=[],fe=new qn;const ye=(be,Ie,Re)=>{fe.emplaceBack(be,Ie,Re);const Ne=F[be],Ve=F[Ie],Be=F[Re],He=Math.min(Math.min(Ne,Ve),Be),Ye=Math.max(Math.max(Ne,Ve),Be)-He;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),ae.push(He+Ye/2)};for(let be=0;be<64;be++)for(let Ie=0;Ie<64;Ie++){const Re=65*be+Ie,Ne=Re+1,Ve=Re+65,Be=Ve+1;ye(Re,Ve,Ne),ye(Ne,Ve,Be)}[ae,fe]=(function(be,Ie){const Re=Array.from({length:be.length},(Be,He)=>He);Re.sort((Be,He)=>be[Be]-be[He]);const Ne=[],Ve=new qn;for(let Be=0;Be<Re.length;Be++){const He=Re[Be];Ne.push(be[He]);const Ye=3*He,yt=Ye+1;Ve.emplaceBack(Ie.uint16[Ye],Ie.uint16[yt],Ie.uint16[yt+1])}return[Ne,Ve]})(ae,fe),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(fe)}this.elevatedGlobeSegments=$r.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ne/$t,0,ue/$t,0,0,W,H,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,l=n.gl;!this._dirty||this.texture instanceof py||(this.texture?this.texture.update(this.image):(this.texture=new T0(n,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let p=(y=e+180)+360*Math.round((l[0]-y)/360);var y;const b=new $r,T=(B,N)=>{b.segments.push({vertexOffset:0,primitiveOffset:B,vertexLength:n.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},P=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-p)<=P){const B=Cr(l,0,l.length,p+P);return B===l.length||T(B,Ar(l,B+1,l.length,p+360-P)-B),b}p<l[0]&&(p+=360);const I=Ar(l,0,l.length,p-P);if(I===l.length)return T(0,l.length),b;T(0,I-0);const F=Cr(l,I+1,l.length,p+P);return F!==l.length&&T(F,l.length-F),b}}const ix=1024,GE=(Math.pow(ix,2)-1)/268170240;class T1 extends ia{constructor(e,n,l,p){super(e,{layout:b1||(b1=new Kr({visibility:new Nt(it.layout_raster.visibility)})),paint:w1||(w1=new Kr({"raster-opacity":new Nt(it.paint_raster["raster-opacity"]),"raster-color":new uu(it.paint_raster["raster-color"]),"raster-color-mix":new Nt(it.paint_raster["raster-color-mix"]),"raster-color-range":new Nt(it.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nt(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(it.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(it.paint_raster["raster-saturation"]),"raster-contrast":new Nt(it.paint_raster["raster-contrast"]),"raster-resampling":new Nt(it.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(it.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nt(it.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nt(it.paint_raster["raster-array-band"]),"raster-elevation":new Nt(it.paint_raster["raster-elevation"]),"raster-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof S1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[l,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(p)||l===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Lf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:p}],resolution:ix}),this.colorRampTexture=null,this._curRampRange=[l,p])}is3D(e){return this.paint.get("raster-elevation")>0}}let A1,C1,R1,M1,P1;class I1 extends ia{constructor(e,n,l,p){super(e,{layout:A1||(A1=new Kr({visibility:new Nt(it["layout_raster-particle"].visibility)})),paint:C1||(C1=new Kr({"raster-particle-array-band":new Nt(it["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nt(it["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new uu(it["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nt(it["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nt(it["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nt(it["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nt(it["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nt(it["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,p),this._updateColorRamp(),this.lastInvalidatedAt=ka.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Lf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ka.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class $E extends ia{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function rx(o,e,n){const l=[0,0,1],p=ys([]);return sa(p,p,n?-tr(o)+Math.PI:tr(o)),As(p,p,-tr(e)),Gn(l,l,p),vi(l,l)}const D1={None:0,Model:1,Symbol:2,FillExtrusion:4};class W_{constructor(e,n,l,p){this.message=(e?`${e}: `:"")+l,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function nx(o,e){const n=o.indexOf("://")===-1;try{return new URL(o,n&&e?"http://example.com":void 0),!0}catch{return!1}}class k1{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class L1{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new qo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,l=this.instancedDataArray.float32;let p=Math.floor(l[n+2]);const y=1.05*(l[n+2]-p);return p/=100,[l[n]%1*1.05,l[n+1]%1*1.05,y,p]}tileCoordinatesForInstance(e){const n=16*e,l=this.instancedDataArray.float32;let p=l[n+0];return p=p>$t?p-$t:p,new Pt(Math.trunc(p),Math.trunc(l[n+1]))}translationForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+4],l[n+5],l[n+6]]}rotationScaleForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+7],l[n+8],l[n+9],l[n+10],l[n+11],l[n+12],l[n+13],l[n+14],l[n+15]]}transformForInstance(e){const n=16*e,l=this.instancedDataArray.float32;return[l[n+7],l[n+8],l[n+9],l[n+4],l[n+10],l[n+11],l[n+12],l[n+5],l[n+13],l[n+14],l[n+15],l[n+6],0,0,0,1]}}class sx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,l,p){}populate(e,n,l,p){this.tileToMeter=Lt(l);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const b=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?n.elevationFeatures:void 0;for(const{feature:T,id:P,index:I,sourceLayerIndex:F}of e){const B=P??(T.properties&&T.properties.hasOwnProperty("id")?T.properties.id:void 0),N=Fi(T,y);if(!this.layers[0]._featureFilter.filter(new xr(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),N,l))continue;const H={id:B,sourceLayerIndex:F,index:I,geometry:y?N.geometry:Ti(T,l,p),properties:T.properties,type:T.type,patterns:{}},W=this.addFeature(H,H.geometry,N,b,l);W&&n.featureIndex.insert(T,H.geometry,I,F,this.index,this.instancesPerModel[W].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let l=0;for(const p of this.modelUris){const y=e.getModel(p,n);if(!y)continue;const b=this.instancesPerModel[p];if(b){const T=.5*li(y.aabb.max,y.aabb.min)*b.maxScale+b.maxXYTranslationDistance,P=Math.min($t,Math.max(T/this.tileToMeter,256));l=Math.max(P,l)}}return l}update(e,n,l,p){for(const y in this.instancesPerModel){const b=this.instancesPerModel[y];for(const T in e)b.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(b.features[b.idToFeaturesIndex[T]],e[T],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];for(const p of l.features){const y=this.layers[0],b=p.feature,T=this.canonical,P=y.paint.get("model-rotation").evaluate(b,{},T),I=y.paint.get("model-scale").evaluate(b,{},T),F=y.paint.get("model-translation").evaluate(b,{},T);vn(p.rotation,P)&&vn(p.scale,I)&&vn(p.translation,F)||(this.evaluate(p,p.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,n,l,p){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const y=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(f(this.activeReplacements,y))return!1;this.activeReplacements=y;let b=!1;for(const T in this.instancesPerModel){const P=this.instancesPerModel[T],I=P.instancedDataArray;for(const F of P.features){const B=F.instancedDataOffset,N=F.instancedDataCount;for(let H=0;H<N;H++){const W=16*(H+B);let ne=I.float32[W+0];const ue=ne>$t;ne=ue?ne-$t:ne;const ae=Math.floor(ne),fe=Math.floor(I.float32[W+1]);let ye=!1;for(const be of this.activeReplacements)if(!cm(be,l,D1.Model,p)&&!(be.min.x>ae||ae>be.max.x||be.min.y>fe||fe>be.max.y)&&(ye=we(te(ae,fe,e.canonical,be.footprintTileId.canonical),be.footprint),ye))break;I.float32[W]=ye?ne+$t:ne,b=b||ye!==ue}}}return b}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,hw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const l in this.instancesPerModel){const p=this.instancesPerModel[l];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(e&&n&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)n.removeModel(l,"",!0)}addFeature(e,n,l,p,y){const b=this.layers[0],T=b.layout.get("model-id"),P=b.layout.get("model-allow-density-reduction"),I=T.evaluate(l,{},this.canonical);if(!I)return Pi(`modelId is not evaluated for layer ${b.id} and it is not going to get rendered.`),I;(nx(I,!1)||this.styleDefinedModelURLs[I]!==void 0)&&(this.modelUris.includes(I)||this.modelUris.push(I)),this.instancesPerModel[I]||(this.instancesPerModel[I]=new L1);const F=this.instancesPerModel[I],B=F.instancedDataArray,N=new k1(l,B.length);let H;p&&(H=Ms.getElevationFeature(e,p));for(const W of n)for(const ne of W){if(ne.x<0||ne.x>=$t||ne.y<0||ne.y>=$t)continue;if(this.lookupDim!==0&&P){const ae=(this.lookupDim-1)/$t,fe=this.lookupDim*(ne.y*ae|0)+ne.x*ae|0;if(this.lookup){if(this.lookup[fe]!==0)continue;this.lookup[fe]=1}}this.instanceCount++;const ue=B.length;if(B.resize(ue+1),p){F.instancesRoadElevation||(F.instancesRoadElevation=[]);const ae=H?H.pointElevation(new Pt(ne.x,ne.y)):0;F.instancesRoadElevation.push(ae)}F.instancesEvaluatedElevation.push(0),B.float32[16*ue]=ne.x,B.float32[16*ue+1]=ne.y}return N.instancedDataCount=F.instancedDataArray.length-N.instancedDataOffset,N.instancedDataCount>0&&(e.id&&(F.idToFeaturesIndex[e.id]=F.features.length),F.features.push(N),this.evaluate(N,{},F,!1)),I}getModelUris(){return this.modelUris}evaluate(e,n,l,p){const y=this.layers[0],b=e.feature,T=this.canonical,P=e.rotation=y.paint.get("model-rotation").evaluate(b,n,T),I=e.scale=y.paint.get("model-scale").evaluate(b,n,T),F=e.translation=y.paint.get("model-translation").evaluate(b,n,T),B=Object.assign({},y.paint.get("model-color").evaluate(b,n,T));B.a=y.paint.get("model-color-mix-intensity").evaluate(b,n,T);const N=[];this.maxVerticalOffset<F[2]&&(this.maxVerticalOffset=F[2]);const H=F[0]*F[0]+F[1]*F[1],W=H>0?Math.sqrt(H):0;l.maxScale=Math.max(Math.max(l.maxScale,I[0]),Math.max(I[1],I[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,W),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),lv(N,P,I);const ne=Math.round(100*B.a)+B.b/1.05;for(let ue=0;ue<e.instancedDataCount;++ue){const ae=e.instancedDataOffset+ue,fe=16*ae,ye=l.instancedDataArray.float32;let be=0;p&&(be=ye[fe+6]-l.instancesEvaluatedElevation[ae]);const Ie=0|ye[fe+1];ye[fe]=(0|ye[fe])+B.r/1.05,ye[fe+1]=Ie+B.g/1.05,ye[fe+2]=ne,ye[fe+3]=1/(T.z>10?this.tileToMeter:Lt(T,Ie)),ye[fe+4]=F[0],ye[fe+5]=F[1],ye[fe+6]=F[2]+(l.instancesRoadElevation?l.instancesRoadElevation[ae]:0)+be,ye[fe+7]=N[0],ye[fe+8]=N[1],ye[fe+9]=N[2],ye[fe+10]=N[4],ye[fe+11]=N[5],ye[fe+12]=N[6],ye[fe+13]=N[8],ye[fe+14]=N[9],ye[fe+15]=N[10],l.instancesEvaluatedElevation[ae]=F[2]}}}let O1,z1;Ut(sx,"ModelBucket",{omit:["layers"]}),Ut(L1,"PerModelAttributes"),Ut(k1,"ModelFeature");class vg{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){const p=l||e.findDEMTileFor(n);if(!p||!p.dem)return;const y=p.dem,b=p.tileID,T=1<<n.canonical.z-b.canonical.z;return new vg(p,y.dim/$t/T,[(n.canonical.x/T-b.canonical.x)*y.dim,(n.canonical.y/T-b.canonical.y)*y.dim])}tileCoordToPixel(e,n){const l=n*this._scale+this._offset[1];return new Pt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,n,l,p){const y=e*this._scale+this._offset[0],b=n*this._scale+this._offset[1],T=Math.floor(y),P=Math.floor(b),I=this._dem;return p=!!p,l?Ri(Ri(I.get(T,P,p),I.get(T,P+1,p),b-P),Ri(I.get(T+1,P,p),I.get(T+1,P+1,p),b-P),y-T):I.get(T,P,p)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*tt(1,e)*this._dem.stride}}const ax=new Float32Array(262144),ym=new Uint8Array(262144);function F1(o){let e=0;if(o.meshes)for(const n of o.meshes)e=Math.max(e,n.aabb.max[2]);if(o.children)for(const n of o.children)e=Math.max(e,F1(n));return e}function B1(o,e,n){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const p=mr.applyTransform(l.aabb,o.globalMatrix);n.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(o.children)for(const l of o.children)B1(l,e,n)}const j1=["","wall","door","roof","window","lamp","logo"];class N1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:F1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=mr.applyTransformFast(l.aabb,this.node.globalMatrix),n.encapsulate(l.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Z_{constructor(e,n,l,p,y,b,T,P){this.id=l,this.layers=e,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=dg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=dg.HasMapboxMeshFeatures),y&&(this.modelTraits|=dg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.worldview=P,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const I of n)this.nodesInfo.push(new N1(I)),B1(I,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const l of this.getNodesInfo()){const p=l.node;p.footprint&&n.push({footprint:p.footprint,id:e})}}updateAppearances(e,n,l,p){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const l=n?this.stateDependentLayers:this.layers;if(!ga(e,this.states))for(const p of l)this.evaluate(p,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const l of n){const p=l.node;this.uploaded?this.updatePbrBuffer(p):R0(p,e,!0)}for(const l of n)M_(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),n=!0);return n}needsReEvaluation(e,n,l){const p=e.transform.projectionOptions,y=e.style.getBrightness(),b=this.brightness!==y;if(!this.uploaded||this.dirty||p.name!==this.projection.name||Py(l.paint.get("model-color").value,b)||Py(l.paint.get("model-color-mix-intensity").value,b)||Py(l.paint.get("model-roughness").value,b)||Py(l.paint.get("model-emissive-strength").value,b)||Py(l.paint.get("model-height-based-emissive-strength-multiplier").value,b)){this.projection=p,this.brightness=y;const T=this.getNodesInfo();for(const P of T)P.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),p=this.id.canonical;for(const y of l){const b=y.feature;y.evaluatedTranslation=n.paint.get("model-translation").evaluate(b,{},p),y.evaluatedScale=n.paint.get("model-scale").evaluate(b,{},p)}}evaluate(e,n){const l=this.getNodesInfo();for(const p of l){if(!p.node.meshes)continue;const y=p.feature,b=n&&n[y.id];if(ga(b,p.state))continue;p.state=structuredClone(b);const T=p.node.meshes&&p.node.meshes[0].featureData,P=p.evaluatedColor[2],I=p.evaluatedRMEA[2],F=this.id.canonical;if(p.hasTranslucentParts=!1,T){for(let B=0;B<j1.length;B++){const N=j1[B];N.length&&(y.properties.part=N);const H=e.paint.get("model-color").evaluate(y,b,F).toPremultipliedRenderColor(null),W=e.paint.get("model-color-mix-intensity").evaluate(y,b,F);p.evaluatedColor[B]=[H.r,H.g,H.b,W],p.evaluatedRMEA[B][0]=e.paint.get("model-roughness").evaluate(y,b,F),p.evaluatedRMEA[B][2]=e.paint.get("model-emissive-strength").evaluate(y,b,F),p.evaluatedRMEA[B][3]=H.a,p.emissionHeightBasedParams[B]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,b,F),!p.hasTranslucentParts&&H.a<1&&(p.hasTranslucentParts=!0)}delete y.properties.part,qE(p,P!==p.evaluatedColor[2]||I!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(y,b,F);p.evaluatedTranslation=e.paint.get("model-translation").evaluate(y,b,F),p.evaluatedScale=e.paint.get("model-scale").evaluate(y,b,F),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,l,p){const y=e.findDEMTileFor(l);if(y&&(y.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const b=vg.create(e,l,y);if(!b)return;this.modelTraits&dg.HasMapboxMeshFeatures&&this.updateDEM(e,b,l,p);for(const T of this.getNodesInfo()){const P=T.node;if(!P.footprint||!P.footprint.vertices||!P.footprint.vertices.length)continue;const I=P.footprint.vertices;let F=b.getElevationAt(I[0].x,I[0].y,!0,!0);for(let B=1;B<I.length;B++)F=Math.min(F,b.getElevationAt(I[B].x,I[B].y,!0,!0));P.elevation=F}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,l,p){let y=n._dem._modifiedForSources[p];if(y===void 0&&(n._dem._modifiedForSources[p]=[],y=n._dem._modifiedForSources[p]),y.includes(l.canonical))return;const b=n._dem.dim;y.push(l.canonical);let T=!1;for(const P of this.getNodesInfo()){const I=P.node;if(!I.footprint||!I.footprint.grid)continue;const F=I.footprint.grid,B=n.tileCoordToPixel(F.min.x,F.min.y),N=n.tileCoordToPixel(F.max.x,F.max.y),H=Math.min(Math.min(b-N.y,B.x),Math.min(B.y,b-N.x));if(H<0)continue;const W=Oe(H,2,5);let ne=Math.max(0,B.x-W),ue=Math.max(0,B.y-W),ae=Math.min(N.x+W,b-1),fe=Math.min(N.y+W,b-1);for(let Re=ue;Re<=fe;++Re)for(let Ne=ne;Ne<=ae;++Ne)ym[Re*b+Ne]=255;let ye=0,be=0;for(let Re=0;Re<F.cellsY;++Re)for(let Ne=0;Ne<F.cellsX;++Ne){if(!F.cells[Re*F.cellsX+Ne])continue;const Ve=n.tileCoordToPixel(F.min.x+Ne/F.xScale,F.min.y+Re/F.yScale),Be=n.tileCoordToPixel(F.min.x+(Ne+1)/F.xScale,F.min.y+(Re+1)/F.yScale);for(let He=Ve.y;He<=Math.min(Be.y+1,b-1);++He)for(let Ye=Ve.x;Ye<=Math.min(Be.x+1,b-1);++Ye)ym[He*b+Ye]===255&&(ym[He*b+Ye]=0,ye+=n.getElevationAtPixel(Ye,He),be++)}const Ie=ye/be;ne=Math.max(1,B.x-W),ue=Math.max(1,B.y-W),ae=Math.min(N.x+W,b-2),fe=Math.min(N.y+W,b-2),T=!0;for(let Re=ue;Re<=fe;++Re)for(let Ne=ne;Ne<=ae;++Ne)ym[Re*b+Ne]===0&&(ax[Re*b+Ne]=n._dem.set(Ne,Re,Ie));for(let Re=1;Re<W;++Re){ne=Math.max(1,B.x-Re),ue=Math.max(1,B.y-Re),ae=Math.min(N.x+Re,b-2),fe=Math.min(N.y+Re,b-2);for(let Ne=ue;Ne<=fe;++Ne)for(let Ve=ne;Ve<=ae;++Ve){const Be=Ne*b+Ve;if(ym[Be]===255){let He=0,Ye=0,yt=-1,ft=-1;for(let gt=-1;gt<=1;++gt)for(let Tt=-1;Tt<=1;++Tt){const Et=(Ne+gt)*b+Ve+Tt;if(ym[Et]>=Re)continue;const St=ax[Et],ht=Math.abs(St);ht>Ye&&(He=St,Ye=ht,yt=Tt,ft=gt)}if(Ye>.1){const gt=1-(Re+.5*Math.abs(yt*ft))/W;let Tt=n._dem.get(Ve,Ne)+He*gt;const Et=n._dem.get(Ve+yt,Ne+ft),St=n._dem.get(Ve-yt,Ne-ft,!0);(Tt-Et)*(Tt-St)>0&&(Tt=(Et+St)/2),ax[Be]=n._dem.set(Ve,Ne,Tt),ym[Be]=Re}}}}}T&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=ka.now())}setFilter(e){this.filter=e?wf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new xr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)M_(n.node),M0(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped());for(const p of this.getNodesInfo()){const y=p.node.footprint;p.hiddenByReplacement=!!y&&!l.find(b=>b.footprint===y)}}getHeightAtTileCoord(e,n){const l=[],p=[0,0,0],y=le([]);for(const b of this.getNodesInfo()){const T=b.node.meshes[0],P=T.transformedAabb;if(e<P.min[0]||n<P.min[1]||e>P.max[0]||n>P.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};ee(y,b.node.globalMatrix),p[0]=e,p[1]=n,Ui(p,p,y);const I=(p[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*fm|0,F=Math.min(63,(p[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*fm|0)*fm+Math.min(63,I),B=T.heightmap[F];if(!(B<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:B,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Pt(e,n),new Pt(e,n),l),l.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Py(o,e){return o instanceof Qs&&!o.isLightConstant&&e}function HE(o,e,n,l,p,y,b,T){let P=(61440&e|(61440&e)>>4)>>8,I=(3840&e|(3840&e)>>4)>>4,F=240&e|(240&e)>>4;n[3]>0&&(P=Ri(P,255*n[0],n[3]),I=Ri(I,255*n[1],n[3]),F=Ri(F,255*n[2],n[3]));const B=P<<8|I,N=F<<8|Math.floor(255*l[3]),H=(function(Re){const Ne=Oe(Re,0,2);return Math.min(Math.round(.5*Ne*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],W=Oe(p[0],0,1),ne=Oe(p[1],0,1),ue=Oe(p[2],0,1),ae=Oe(p[3],0,1);let fe,ye,be,Ie;if(W!==ne&&b!==y&&ne!==W){const Re=b-y;ye=1/(Re*(ne-W)),be=-(y+Re*W)/(Re*(ne-W));const Ne=Oe(p[4],-1,1);Ie=Math.pow(10,Ne),fe=255*ue<<8|255*ae}else fe=65535,ye=0,be=1,Ie=1;if(o.emplaceBack(B,N,H,fe,ye,be,Ie),T){const Re=T.length;T.clear();for(let Ne=0;Ne<Re;Ne++)T.emplaceBack(B,N,H,fe,ye,be,Ie)}}function qE(o,e,n){const l=o.node;let p=0;const y=n&dg.HasMeshoptCompression;for(const b of l.meshes){if(l.lights&&l.lightMeshIndex===p||!b.featureData)continue;b.featureArray=new yu,b.featureArray.reserve(b.featureData.length);let T=e;for(const P of b.featureData){const I=y?65535&P:P>>16&65535,F=y?P>>16&65535:65535&P,B=(15&F)<8?15&F:0,N=o.evaluatedRMEA[B],H=o.evaluatedColor[B],W=o.emissionHeightBasedParams[B];let ne;if(T&&B===2&&l.lights&&(ne=new yu,ne.resize(10*l.lights.length)),HE(b.featureArray,I,H,N,W,b.aabb.min[2],b.aabb.max[2],ne),ne&&T){T=!1;const ue=l.meshes[l.lightMeshIndex];ue.featureArray=ne,ue.featureArray._trim()}}b.featureArray._trim(),p++}}Ut(Z_,"Tiled3dModelBucket",{omit:["layers"]}),Ut(N1,"Tiled3dModelFeature");const WE=["id","tile","layer","source","sourceLayer","state"];class _m{constructor(e,n,l,p,y){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=p,this.properties=e?e.properties:{},this.id=y}clone(){const e=new _m(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of WE)this[n]!==void 0&&(e[n]=this[n]);return e}}class xm extends Pl{constructor(e,n,l,p){super(),this.id=e,this.type="model",this.models=[],this._options=n,this._modelsInfo=new Map}loadGLTFFromURI(e){return nv(this.map._requestManager.transformRequest(e,Kn.Model).url)}load(){for(const e in this._options.models){const n=this._options.models[e],l=this._modelsInfo.get(e);if(l){l.modelSpec=n;const p=l.model;p&&(p.position=n.position!=null?new Pe(n.position[0],n.position[1]):new Pe(0,0),p.orientation=n.orientation!=null?n.orientation:[0,0,0],xm.applyModelSpecification(p,n),p.computeBoundsAndApplyParent(),this.models.push(p))}else this._modelsInfo.set(e,{modelSpec:n,model:null}),this.loadGLTFFromURI(n.uri).then(p=>{if(!p)return;const y=this._modelsInfo.get(e);if(!y)return;const b=I0(p),T=y.modelSpec,P=new cv(e,T.uri,T.position,T.orientation,b);xm.applyModelSpecification(P,T),P.computeBoundsAndApplyParent(),this.models.push(P),y.model=P,this.loaded()&&this.fire(new mo("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(p=>{this.fire(new zu(new Error(`Could not load model ${e} from ${n.uri}: ${p.message}`)))})}this.loaded()&&this.fire(new mo("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,n){n.nodeOverrides&&xm.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&xm.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every(l=>typeof l=="string")){e.nodeOverrideNames=[];for(const l of n)e.nodeOverrideNames.push(l)}else Object.entries(n).forEach(([l,p])=>{const y={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const b=p.orientation;b&&(y.orientation=b)}e.nodeOverrides.set(l,y)})}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every(l=>typeof l=="string")){e.materialOverrideNames=[];for(const l of n)e.materialOverrideNames.push(l)}else Object.entries(n).forEach(([l,p])=>{const y={color:new _r(1,1,1),colorMix:0,emissionStrength:0,opacity:1},b=p["model-color"];b!==void 0&&(y.color.r=b[0],y.color.g=b[1],y.color.b=b[2]);const T=p["model-color-mix-intensity"];T!==void 0&&(y.colorMix=T);const P=p["model-emissive-strength"];P!==void 0&&(y.emissionStrength=P);const I=p["model-opacity"];I!==void 0&&(y.opacity=I),e.materialOverrides.set(l,y)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=Uo(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const n=new Map;for(const l in e){const p=e[l];if(this._modelsInfo.has(l)){const y=this._modelsInfo.get(l);y&&y.modelSpec.uri===p.uri&&n.set(l,y)}}this._modelsInfo=n,this._options.models=e,this.load()}}function ox(o,e,n,l){const p=1<<o.z;e.lat=wt((l/$t+o.y)/p),e.lng=pt((n/$t+o.x)/p)}function ZE(o,e,n,l){const p=o.getNodesInfo()[e];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let y=Number.MAX_VALUE;const b=p.node,T=n.tile,P=l.calculatePosMatrix(T.tileID.toUnwrapped(),l.worldSize),I=p.evaluatedScale;let F=0;l.elevation&&b.elevation&&(F=b.elevation*l.elevation.exaggeration()),Q(P,P,[(b.anchor?b.anchor[0]:0)*(I[0]-1),(b.anchor?b.anchor[1]:0)*(I[1]-1),F]),oe(P,P,I);const B=n.queryGeometry,N=B.isPointQuery()?B.screenBounds:B.screenGeometry,H=function(ne){const ue=se([],P,ne.globalMatrix);se(ue,l.expandedFarZProjMatrix,ue);for(let ae=0;ae<ne.meshes.length;++ae){const fe=ne.meshes[ae];if(ae===ne.lightMeshIndex)continue;const ye=C0(N,l,ue,fe.aabb);ye!=null&&(y=Math.min(ye,y))}if(ne.children)for(const ae of ne.children)H(ae)};if(H(b),y===Number.MAX_VALUE)return;const W=new Pe(0,0);return ox(T.tileID.canonical,W,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:y,position:W,feature:p.feature}}const XE={circle:class extends ia{constructor(o,e,n,l){super(o,{layout:$y||($y=new Kr({"circle-sort-key":new Qt(it.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nt(it.layout_circle["circle-elevation-reference"]),visibility:new Nt(it.layout_circle.visibility)})),paint:Hy||(Hy=new Kr({"circle-radius":new Qt(it.paint_circle["circle-radius"]),"circle-color":new Qt(it.paint_circle["circle-color"]),"circle-blur":new Qt(it.paint_circle["circle-blur"]),"circle-opacity":new Qt(it.paint_circle["circle-opacity"]),"circle-translate":new Nt(it.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt(it.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nt(it.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}createBucket(o){return new pa(o)}queryRadius(o){const e=o;return Jl("circle-radius",this,e)+Jl("circle-stroke-width",this,e)+Df(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,n,l,p,y,b,T){const P=Gy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Ug(o,l,y,b,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,n){const l=Yy(this);return{config:new U(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ia{createBucket(o){return new Qy(o)}constructor(o,e,n,l){super(o,{layout:$g||($g=new Kr({visibility:new Nt(it.layout_heatmap.visibility)})),paint:Jy||(Jy=new Kr({"heatmap-radius":new Qt(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uu(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(it.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return Jl("heatmap-radius",this,o)}queryIntersectsFeature(o,e,n,l,p,y,b,T){const P=this.paint.get("heatmap-radius").evaluate(e,n);return Ug(o,l,y,b,T,!0,!0,new Pt(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,n){return o==="heatmap"?{config:new U(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends ia{constructor(o,e,n,l){super(o,{layout:Ym||(Ym=new Kr({visibility:new Nt(it.layout_hillshade.visibility)})),paint:Km||(Km=new Kr({"hillshade-illumination-direction":new Nt(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(it.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nt(it.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}},fill:class extends ia{constructor(o,e,n,l){super(o,{layout:jf||(jf=new Kr({"fill-sort-key":new Qt(it.layout_fill["fill-sort-key"]),visibility:new Nt(it.layout_fill.visibility),"fill-elevation-reference":new Nt(it.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Qt(it.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Nf||(Nf=new Kr({"fill-antialias":new Nt(it.paint_fill["fill-antialias"]),"fill-opacity":new Qt(it.paint_fill["fill-opacity"]),"fill-color":new Qt(it.paint_fill["fill-color"]),"fill-outline-color":new Qt(it.paint_fill["fill-outline-color"]),"fill-translate":new Nt(it.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qt(it.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nt(it.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nt(it.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Qt(it.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Qt(it.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Qt(it.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(o,e,n){return{config:new U(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Lc(o)}queryRadius(){return Df(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,n,l,p,y){return!o.queryGeometry.isAboveHorizon&&jr(Bg(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ia{constructor(o,e,n,l){super(o,{layout:Dx||(Dx=new Kr({visibility:new Nt(it["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nt(it["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:kx||(kx=new Kr({"fill-extrusion-opacity":new Nt(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qt(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nt(it["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Qt(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nt(it["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nt(it["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nt(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nt(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nt(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nt(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nt(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nt(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nt(it["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nt(it["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Qt(it["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Qt(it["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nt(it["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nt(it["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nt(it["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nt(it["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Qt(it["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Qt(it["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nt(it["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new tc(o)}queryRadius(){return Df(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,n,l,p,y,b,T,P){const I=Gy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(e,n),B=this.paint.get("fill-extrusion-base").evaluate(e,n),N=[0,0],H=T&&y.elevation,W=y.elevation?y.elevation.exaggeration():1,ne=o.tile.getBucket(this);if(H&&ne instanceof tc){const be=ne.centroidVertexArray,Ie=P+1;Ie<be.length&&(N[0]=be.geta_centroid_pos0(Ie),N[1]=be.geta_centroid_pos1(Ie))}if(N[0]===0&&N[1]===1)return!1;y.projection.name==="globe"&&(l=Ix([l],[new Pt(0,0),new Pt($t,$t)],o.tileID.canonical).map(be=>be.polygon).flat());const ue=H?T:null,[ae,fe]=Nx(y,l,B,F,I,b,ue,N,W,y.center.lat,o.tileID.canonical),ye=o.queryGeometry;return jx(ae,fe,ye.isPointQuery()?ye.screenBounds:ye.screenGeometry)}},building:class extends ia{constructor(o,e,n,l){super(o,{layout:gv||(gv=new Kr({visibility:new Nt(it.layout_building.visibility),"building-facade":new Qt(it.layout_building["building-facade"]),"building-facade-floors":new Qt(it.layout_building["building-facade-floors"]),"building-facade-unit-width":new Qt(it.layout_building["building-facade-unit-width"]),"building-facade-window":new Qt(it.layout_building["building-facade-window"]),"building-roof-shape":new Qt(it.layout_building["building-roof-shape"]),"building-height":new Qt(it.layout_building["building-height"]),"building-base":new Qt(it.layout_building["building-base"]),"building-flood-light-wall-radius":new Qt(it.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Qt(it.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Qt(it.layout_building["building-flip-roof-orientation"])})),paint:yv||(yv=new Kr({"building-opacity":new Nt(it.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Nt(it.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Nt(it.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Nt(it.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Nt(it.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Nt(it.paint_building["building-vertical-scale"]),"building-cast-shadows":new Nt(it.paint_building["building-cast-shadows"]),"building-color":new Qt(it.paint_building["building-color"]),"building-emissive-strength":new Qt(it.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Nt(it.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Nt(it.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Nt(it.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Nt(it.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Nt(it.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new mv(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}queryRadius(o){return 0}queryIntersectsFeature(o,e,n,l,p,y,b,T,P,I){let F=this.layout.get("building-height").evaluate(e,n);const B=this.layout.get("building-base").evaluate(e,n),N=o.tile.getBucket(this).getFootprint(e);if(N){if(N.hiddenFlags!==0)return!1;F=N.height}const[H,W]=Nx(y,l,B,F,new Pt(0,0),b,null,[0,0],1,y.center.lat,o.tileID.canonical),ne=o.queryGeometry;return jx(H,W,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends ia{constructor(o,e,n,l){const p=Cv();super(o,p,e,n,l),p.layout&&(this.layout=new ta(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(gy)return gy;const n=Cv();return gy=new Gw(n.paint.properties["line-width"].specification),gy.useIntegerZoom=!0,gy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new L0(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,n){const l=Tv(this);return{config:new U(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,n=Rv(Jl("line-width",this,e),Jl("line-gap-width",this,e)),l=Jl("line-offset",this,e);return n/2+Math.abs(l)+Df(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,n,l,p,y){if(o.queryGeometry.isAboveHorizon)return!1;const b=Bg(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,o.pixelToTileUnitsFactor),T=o.pixelToTileUnitsFactor/2*Rv(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),P=this.paint.get("line-offset").evaluate(e,n);return P&&(l=(function(I,F){const B=[],N=new Pt(0,0);for(let H=0;H<I.length;H++){const W=I[H],ne=[];for(let ue=0;ue<W.length;ue++){const ae=W[ue],fe=W[ue+1],ye=ue===0?N:ae.sub(W[ue-1])._unit()._perp(),be=ue===W.length-1?N:fe.sub(ae)._unit()._perp(),Ie=ye._add(be)._unit();Ie._mult(1/(Ie.x*be.x+Ie.y*be.y)),ne.push(Ie._mult(F)._add(ae))}B.push(ne)}return B})(l,P*o.pixelToTileUnitsFactor)),(function(I,F,B){for(let N=0;N<F.length;N++){const H=F[N];if(I.length>=3){for(let W=0;W<H.length;W++)if(Ra(I,H[W]))return!0}if(Ln(I,H,B))return!0}return!1})(b,l,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:$_,background:class extends ia{constructor(o,e,n,l){super(o,{layout:x1||(x1=new Kr({visibility:new Nt(it.layout_background.visibility)})),paint:v1||(v1=new Kr({"background-pitch-alignment":new Nt(it.paint_background["background-pitch-alignment"]),"background-color":new Nt(it.paint_background["background-color"]),"background-pattern":new Nt(it.paint_background["background-pattern"]),"background-opacity":new Nt(it.paint_background["background-opacity"]),"background-emissive-strength":new Nt(it.paint_background["background-emissive-strength"]),"background-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:T1,"raster-particle":I1,sky:class extends ia{constructor(o,e,n,l){super(o,{layout:R1||(R1=new Kr({visibility:new Nt(it.layout_sky.visibility)})),paint:M1||(M1=new Kr({"sky-type":new Nt(it.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nt(it.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nt(it.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nt(it.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nt(it.paint_sky["sky-gradient-radius"]),"sky-gradient":new uu(it.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nt(it.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nt(it.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nt(it.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),p=!l,y=o.style.light,b=y.properties.get("position");return p&&y.properties.get("anchor")==="viewport"&&Pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?rx(b.azimuthal,90-b.polar,e):rx(l[0],90-l[1],e)}const n=this.paint.get("sky-gradient-center");return rx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends ia{constructor(o,e,n,l){super(o,{paint:P1||(P1=new Kr({}))},e,null)}},model:class extends ia{constructor(o,e,n,l){super(o,{layout:O1||(O1=new Kr({visibility:new Nt(it.layout_model.visibility),"model-id":new Qt(it.layout_model["model-id"]),"model-allow-density-reduction":new Nt(it.layout_model["model-allow-density-reduction"])})),paint:z1||(z1=new Kr({"model-opacity":new Qt(it.paint_model["model-opacity"]),"model-rotation":new Qt(it.paint_model["model-rotation"]),"model-scale":new Qt(it.paint_model["model-scale"]),"model-translation":new Qt(it.paint_model["model-translation"]),"model-color":new Qt(it.paint_model["model-color"]),"model-color-mix-intensity":new Qt(it.paint_model["model-color-mix-intensity"]),"model-type":new Nt(it.paint_model["model-type"]),"model-cast-shadows":new Nt(it.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nt(it.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nt(it.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Qt(it.paint_model["model-emissive-strength"]),"model-roughness":new Qt(it.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Qt(it.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nt(it.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nt(it.paint_model["model-front-cutoff"]),"model-elevation-reference":new Nt(it.paint_model["model-elevation-reference"]),"model-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this.layer=o,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new sx(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Z_?8191:0}queryRenderedFeatures(o,e,n){const l=e.getSource();if(!(l&&l instanceof xm))return{};const p=l,y={};y[this.id]=[];const b=y[this.id];let T=0;for(const P of p.models){const I=e.getFeatureState(this.sourceLayer,P.id),F={type:"Unknown",id:P.id,properties:P.featureProperties},B=this.paint.get("model-rotation").evaluate(F,I),N=this.paint.get("model-scale").evaluate(F,I),H=this.paint.get("model-translation").evaluate(F,I),W=this.paint.get("model-elevation-reference");let ne=[];R_(ne,P,n,P.position,B,N,H,W==="ground",W==="ground",!1),n.projection.name==="globe"&&(ne=C_(ne,n));const ue=se([],n.projMatrix,ne),ae=C0(o.isPointQuery()?o.screenBounds:o.screenGeometry,n,ue,P.aabb);if(ae!=null){const fe=new _m(void 0,0,0,0,P.id);fe.layer=this.layer,fe.properties=structuredClone(P.featureProperties),fe.properties.layer=this.id,fe.properties.uri=P.uri,fe.properties.orientation=P.orientation,fe.sourceLayer=this.sourceLayer,fe.geometry={type:"Point",coordinates:[P.position.lng,P.position.lat]},fe.state=I,fe.source=this.source,b.push({featureIndex:T,feature:fe,intersectionZ:ae})}++T}return y}queryIntersectsFeature(o,e,n,l,p,y,b,T,P,I){if(!this.modelManager)return!1;const F=this.modelManager,B=o.tile.getBucket(this);if(!(B&&B instanceof sx))return!1;for(const N in B.instancesPerModel){const H=B.instancesPerModel[N],W=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(H.idToFeaturesIndex.hasOwnProperty(W)){const ne=H.features[H.idToFeaturesIndex[W]],ue=F.getModel(N,I||this.scope);if(!ue)return!1;let ae=[];const fe=new Pe(0,0),ye=B.canonical;let be=Number.MAX_VALUE;for(let Ie=0;Ie<ne.instancedDataCount;++Ie){const Re=16*(ne.instancedDataOffset+Ie),Ne=H.instancedDataArray.float32,Ve=[Ne[Re+4],Ne[Re+5],Ne[Re+6]];ox(ye,fe,Math.floor(Ne[Re]),Math.floor(Ne[Re+1])),R_(ae,ue,y,fe,ne.rotation,ne.scale,Ve,!1,!1,!1),y.projection.name==="globe"&&(ae=C_(ae,y));const Be=se([],y.projMatrix,ae),He=o.queryGeometry,Ye=C0(He.isPointQuery()?He.screenBounds:He.screenGeometry,y,Be,ue.aabb);Ye!=null&&(be=Math.min(Ye,be))}return be!==Number.MAX_VALUE&&be}}return!1}_handleOverridablePaintPropertyUpdate(o,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ns}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ia{constructor(o,e,n,l){super(o,{layout:Tu||(Tu=new Kr({"clip-layer-types":new Nt(it.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nt(it.layout_clip["clip-layer-scope"]),visibility:new Nt(it.layout_clip.visibility)})),paint:f_||(f_=new Kr({}))},e,n,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new p_(o)}is3D(o){return!0}}},lx=new _r(0,0,0);function YE(o,e,n){o===1&&e.icons.push((function(l,p){return(function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:b}=y;if(b.content_area){const{content_area:T}=b;T.left==null&&(T.left=0),T.top==null&&(T.top=T.left),T.width==null&&(T.width=y.usvg_tree.width),T.height==null&&(T.height=T.width)}if(b.text_placeholder){const{text_placeholder:T}=b;T.top==null&&(T.top=T.left),T.height==null&&(T.height=T.width)}return b.stretch_x&&b.stretch_x.length&&V1(b,"x"),b.stretch_y&&b.stretch_y.length&&V1(b,"y"),y})(l.readFields(KE,{name:void 0},p))})(n,n.readVarint()+n.pos))}function V1(o,e){const n=[],l=o[`stretch_${e}`];let p=null;for(let y=0;y<l.length;y++)p===null?p=n.length===0?l[0]:n[n.length-1][1]+l[y]:(n.push([p,p+l[y]]),p=null);o[`stretch_${e}_areas`]=n}function KE(o,e,n){o===1?e.name=n.readString():o===2?e.metadata=(function(l,p){return l.readFields(QE,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)})(n,n.readVarint()+n.pos):o===3&&(e.usvg_tree=(function(l,p){return l.readFields(tS,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)})(n,n.readVarint()+n.pos),e.data="usvg_tree")}function QE(o,e,n){o===1?e.stretch_x=n.readPackedVarint():o===2?e.stretch_y=n.readPackedVarint():o===3?e.content_area=U1(n,n.readVarint()+n.pos):o===4?e.variables.push((function(l,p){return l.readFields(eS,{name:void 0},p)})(n,n.readVarint()+n.pos)):o===5&&(e.text_placeholder=U1(n,n.readVarint()+n.pos))}function U1(o,e){return o.readFields(JE,{},e)}function JE(o,e,n){o===1?e.left=n.readVarint():o===2?e.width=n.readVarint():o===3?e.top=n.readVarint():o===4&&(e.height=n.readVarint())}function eS(o,e,n){o===1?e.name=n.readString():o===2&&(e.rgb_color=K_(n.readVarint()),e.value="rgb_color")}function tS(o,e,n){o===1?e.width=e.height=n.readVarint():o===2?e.height=n.readVarint():o===3?e.children.push(X_(n,n.readVarint()+n.pos)):o===4?e.linear_gradients.push((function(l,p){return l.readFields(lS,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)})(n,n.readVarint()+n.pos)):o===5?e.radial_gradients.push((function(l,p){return l.readFields(uS,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)})(n,n.readVarint()+n.pos)):o===7?e.clip_paths.push((function(l,p){return l.readFields(hS,{children:[]},p)})(n,n.readVarint()+n.pos)):o===8&&e.masks.push((function(l,p){const y=l.readFields(dS,{left:0,width:20,mask_type:1,children:[]},p);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y})(n,n.readVarint()+n.pos))}function X_(o,e){return o.readFields(iS,{},e)}function iS(o,e,n){o===1?(e.group=(function(l,p){return l.readFields(rS,{opacity:255,children:[]},p)})(n,n.readVarint()+n.pos),e.node="group"):o===2&&(e.path=(function(l,p){return l.readFields(sS,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)})(n,n.readVarint()+n.pos),e.node="path")}function rS(o,e,n){o===1?e.transform=Y_(n,n.readVarint()+n.pos):o===2?e.opacity=n.readVarint():o===5?e.clip_path_idx=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(X_(n,n.readVarint()+n.pos))}function Y_(o,e){return o.readFields(nS,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function nS(o,e,n){o===1?e.sx=n.readFloat():o===2?e.ky=n.readFloat():o===3?e.kx=n.readFloat():o===4?e.sy=n.readFloat():o===5?e.tx=n.readFloat():o===6&&(e.ty=n.readFloat())}function sS(o,e,n){o===1?e.fill=(function(l,p){return l.readFields(aS,{rgb_color:lx,paint:"rgb_color",opacity:255},p)})(n,n.readVarint()+n.pos):o===2?e.stroke=(function(l,p){return l.readFields(oS,{rgb_color:lx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)})(n,n.readVarint()+n.pos):o===3?e.paint_order=n.readVarint():o===5?n.readPackedVarint(e.commands):o===6?e.step=n.readFloat():o===7?n.readPackedSVarint(e.diffs):o===8&&(e.rule=n.readVarint())}function aS(o,e,n){o===1?(e.rgb_color=K_(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=n.readVarint())}function K_(o){return new _r((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function oS(o,e,n){o===1?(e.rgb_color=K_(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5?n.readPackedFloat(e.dasharray):o===6?e.dashoffset=n.readFloat():o===7?e.miterlimit=n.readFloat():o===8?e.opacity=n.readVarint():o===9?e.width=n.readFloat():o===10?e.linecap=n.readVarint():o===11&&(e.linejoin=n.readVarint())}function lS(o,e,n){o===1?e.transform=Y_(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(G1(n,n.readVarint()+n.pos)):o===4?e.x1=n.readFloat():o===5?e.y1=n.readFloat():o===6?e.x2=n.readFloat():o===7&&(e.y2=n.readFloat())}function G1(o,e){return o.readFields(cS,{offset:0,opacity:255,rgb_color:lx},e)}function cS(o,e,n){o===1?e.offset=n.readFloat():o===2?e.opacity=n.readVarint():o===3&&(e.rgb_color=K_(n.readVarint()))}function uS(o,e,n){o===1?e.transform=Y_(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(G1(n,n.readVarint()+n.pos)):o===4?e.cx=n.readFloat():o===5?e.cy=n.readFloat():o===6?e.r=n.readFloat():o===7?e.fx=n.readFloat():o===8?e.fy=n.readFloat():o===9&&(e.fr=n.readFloat())}function hS(o,e,n){o===1?e.transform=Y_(n,n.readVarint()+n.pos):o===2?e.clip_path_idx=n.readVarint():o===3&&e.children.push(X_(n,n.readVarint()+n.pos))}function dS(o,e,n){o===1?e.left=e.top=n.readFloat():o===2?e.width=e.height=n.readFloat():o===3?e.top=n.readFloat():o===4?e.height=n.readFloat():o===5?e.mask_type=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(X_(n,n.readVarint()+n.pos))}class fS{static calculate(e={},n=[]){const l=new Map,p=new Map;if(Object.keys(e).length===0)return l;n.forEach(y=>{p.set(y.name,y.rgb_color||new _r(0,0,0))});for(const[y,b]of Object.entries(e))p.has(y)?l.set(p.get(y).toString(),b):console.warn(`Ignoring unknown image variable "${y}"`);return l}}function bg(o,e=255,n){const l=e/255,p=o.toString(),y=n.has(p)?n.get(p).clone():o.clone();return y.a*=l,y.toString()}function Iy(o,e){if(!co()){const n=document.createElement("canvas");return n.width=o,n.height=e,n}return new OffscreenCanvas(o,e)}let ux,Dy=null;function hx(o,e,n,l,p){for(const y of l.children)$1(o,e,n,y,p)}function $1(o,e,n,l,p){l.group?(o.save(),(function(y,b,T,P,I){const F=P.mask_idx!=null?T.masks[P.mask_idx]:null,B=P.clip_path_idx!=null?T.clip_paths[P.clip_path_idx]:null;if(P.transform&&(b=wg(P.transform).preMultiplySelf(b)),!(function(W,ne,ue){return W.opacity!==255||ne||ue})(P,B!=null,F!=null))return void hx(y,b,T,P,I);const N=Iy(y.canvas.width,y.canvas.height),H=N.getContext("2d");hx(H,b,T,P,I),B&&K1(H,b,T,B),F&&Q1(H,b,T,F,I),y.globalAlpha=P.opacity/255,y.drawImage(N,0,0)})(o,e,n,l.group,p),o.restore()):l.path&&(o.save(),(function(y,b,T,P,I){y.setTransform(b),P.paint_order===1?(H1(y,T,P,I),W1(y,T,P,I)):(W1(y,T,P,I),H1(y,T,P,I))})(o,e,n,l.path,p),o.restore())}function H1(o,e,n,l){const p=n.fill;if(!p)return;const y=p.opacity/255;switch(o.save(),o.beginPath(),J1(n,o),p.paint){case"rgb_color":o.fillStyle=bg(p.rgb_color,p.opacity,l);break;case"linear_gradient_idx":{const b=e.linear_gradients[p.linear_gradient_idx];b.transform&&o.setTransform(wg(b.transform).preMultiplySelf(o.getTransform())),o.fillStyle=Z1(o,b,y,l);break}case"radial_gradient_idx":{const b=e.radial_gradients[p.radial_gradient_idx];b.transform&&o.setTransform(wg(b.transform).preMultiplySelf(o.getTransform())),o.fillStyle=X1(o,b,y,l)}}o.fill(q1(n)),o.restore()}function q1(o){return o.rule===1?"nonzero":o.rule===2?"evenodd":void 0}function W1(o,e,n,l){const p=n.stroke;if(!p)return;const y=eb(n);o.lineWidth=p.width,o.miterLimit=p.miterlimit,o.setLineDash(p.dasharray),o.lineDashOffset=p.dashoffset;const b=p.opacity/255;switch(p.paint){case"rgb_color":o.strokeStyle=bg(p.rgb_color,p.opacity,l);break;case"linear_gradient_idx":o.strokeStyle=Z1(o,e.linear_gradients[p.linear_gradient_idx],b,l,!0);break;case"radial_gradient_idx":o.strokeStyle=X1(o,e.radial_gradients[p.radial_gradient_idx],b,l,!0)}switch(p.linejoin){case 2:case 1:o.lineJoin="miter";break;case 3:o.lineJoin="round";break;case 4:o.lineJoin="bevel"}switch(p.linecap){case 1:o.lineCap="butt";break;case 2:o.lineCap="round";break;case 3:o.lineCap="square"}o.stroke(y)}function Z1(o,e,n,l,p=!1){if(e.stops.length===1){const N=e.stops[0];return bg(N.rgb_color,N.opacity*n,l)}const{x1:y,y1:b,x2:T,y2:P}=e;let I=new DOMPoint(y,b),F=new DOMPoint(T,P);if(p){const N=wg(e.transform);I=N.transformPoint(I),F=N.transformPoint(F)}const B=o.createLinearGradient(I.x,I.y,F.x,F.y);for(const N of e.stops)B.addColorStop(N.offset,bg(N.rgb_color,N.opacity*n,l));return B}function X1(o,e,n,l,p=!1){if(e.stops.length===1){const ae=e.stops[0];return bg(ae.rgb_color,ae.opacity*n,l)}const y=wg(e.transform),{fx:b,fy:T,fr:P,cx:I,cy:F,r:B}=e;let N=new DOMPoint(b,T),H=new DOMPoint(I,F),W=P,ne=B;if(p){N=y.transformPoint(N),H=y.transformPoint(H);const ae=(y.a+y.d)/2;W=P*ae,ne=e.r*ae}const ue=o.createRadialGradient(N.x,N.y,W,H.x,H.y,ne);for(const ae of e.stops)ue.addColorStop(ae.offset,bg(ae.rgb_color,ae.opacity*n,l));return ue}function Y1(o,e,n,l){const p=l.transform?wg(l.transform).preMultiplySelf(e):e,y=Iy(o.canvas.width,o.canvas.height),b=y.getContext("2d");for(const P of l.children)if(P.group)Y1(b,p,n,P.group);else if(P.path){const I=P.path,F=new Path2D;F.addPath(eb(I),p),b.fill(F,q1(I))}const T=l.clip_path_idx!=null?n.clip_paths[l.clip_path_idx]:null;T&&K1(b,p,n,T),o.globalCompositeOperation="source-over",o.drawImage(y,0,0)}function K1(o,e,n,l){const p=Iy(o.canvas.width,o.canvas.height);Y1(p.getContext("2d"),e,n,l),o.globalCompositeOperation="destination-in",o.drawImage(p,0,0)}function Q1(o,e,n,l,p){if(l.children.length===0)return;const y=l.mask_idx!=null?n.masks[l.mask_idx]:null;y&&Q1(o,e,n,y,p);const b=o.canvas.width,T=o.canvas.height,P=Iy(b,T),I=P.getContext("2d"),F=l.width,B=l.height,N=l.left,H=l.top,W=new Path2D,ne=new Path2D;ne.rect(N,H,F,B),W.addPath(ne,e),I.clip(W);for(const fe of l.children)$1(I,e,n,fe,p);const ue=I.getImageData(0,0,b,T),ae=ue.data;if(l.mask_type===1)for(let fe=0;fe<ae.length;fe+=4)ae[fe+3]=ae[fe+3]/255*(.2126*ae[fe]+.7152*ae[fe+1]+.0722*ae[fe+2]);I.putImageData(ue,0,0),o.globalCompositeOperation="destination-in",o.drawImage(P,0,0)}function wg(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function J1(o,e){const n=o.step;let l=o.diffs[0]*n,p=o.diffs[1]*n;e.moveTo(l,p);for(let y=0,b=2;y<o.commands.length;y++)switch(o.commands[y]){case 1:l+=o.diffs[b++]*n,p+=o.diffs[b++]*n,e.moveTo(l,p);break;case 2:l+=o.diffs[b++]*n,p+=o.diffs[b++]*n,e.lineTo(l,p);break;case 3:{const T=l+o.diffs[b++]*n,P=p+o.diffs[b++]*n;l=T+o.diffs[b++]*n,p=P+o.diffs[b++]*n,e.quadraticCurveTo(T,P,l,p);break}case 4:{const T=l+o.diffs[b++]*n,P=p+o.diffs[b++]*n,I=T+o.diffs[b++]*n,F=P+o.diffs[b++]*n;l=I+o.diffs[b++]*n,p=F+o.diffs[b++]*n,e.bezierCurveTo(T,P,I,F,l,p);break}case 5:e.closePath();break}return e}function eb(o){return J1(o,new Path2D)}class Q_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}Ut(Q_,"LRUCache");class dx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ss(e,e.data)}getFromCache(e,n,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new Q_(150)),this.cacheMap.get(l).get(Uo(e.toString(),n))}setInCache(e,n,l,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Q_(150));const y=this.cacheDependenciesMap.get(p),b=Uo(e.id.toString(),l);y.get(b)||y.set(b,new Set);const T=this.cacheMap.get(p),P=e.toString();y.get(b).add(P),T.put(Uo(e.toString(),l),n)}removeImagesFromCacheByIds(e,n,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const p=this.cacheMap.get(l),y=this.cacheDependenciesMap.get(l);for(const b of e){const T=Uo(b.toString(),n);if(y.has(T)){for(const P of y.get(T))p.delete(P);y.delete(T)}}}rasterize(e,n,l,p){const y=this.getFromCache(e,l,p);if(y)return y.clone();const b=(function(P,I){const F=fS.calculate(I.params,P.metadata?P.metadata.variables:[]),B=P.usvg_tree,N=B.width,H=B.height,W=Math.max(1,Math.round(N*I.sx)),ne=Math.max(1,Math.round(H*I.sy)),ue=new DOMMatrix([W/N,0,0,ne/H,0,0]);return Dy===null&&(Dy=Iy(10,10),ux=Dy.getContext("2d",{willReadFrequently:!0})),Dy.width=W,Dy.height=ne,hx(ux,ue,B,B,F),ux.getImageData(0,0,W,ne)})(n.icon,e),T=dx._getImage(b);return this.setInCache(e,T,l,p),T.clone()}}class tb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function ib(o,e,n,l){let p=0,y=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(l[b])<1e-15){if(n[b]<o[b]||n[b]>e[b])return null}else{const T=1/l[b];let P=(o[b]-n[b])*T,I=(e[b]-n[b])*T;if(P>I){const F=P;P=I,I=F}if(P>p&&(p=P),I<y&&(y=I),p>y)return null}return p}function rb(o,e,n,l,p,y,b,T,P,I,F){const B=l-o,N=p-e,H=y-n,W=b-o,ne=T-e,ue=P-n,ae=F[1]*ue-F[2]*ne,fe=F[2]*W-F[0]*ue,ye=F[0]*ne-F[1]*W,be=B*ae+N*fe+H*ye;if(Math.abs(be)<1e-15)return null;const Ie=1/be,Re=I[0]-o,Ne=I[1]-e,Ve=I[2]-n,Be=(Re*ae+Ne*fe+Ve*ye)*Ie;if(Be<0||Be>1)return null;const He=Ne*H-Ve*N,Ye=Ve*B-Re*H,yt=Re*N-Ne*B,ft=(F[0]*He+F[1]*Ye+F[2]*yt)*Ie;return ft<0||Be+ft>1?null:(W*He+ne*Ye+ue*yt)*Ie}function nb(o,e,n){return(o-e)/(n-e)}function sb(o,e,n,l,p,y,b,T,P){const I=1<<n,F=y-l,B=b-p,N=(o+1)/I*F+l,H=(e+0)/I*B+p,W=(e+1)/I*B+p;T[0]=(o+0)/I*F+l,T[1]=H,P[0]=N,P[1]=W}class ab{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=(function(y){const b=Math.ceil(Math.log2(y.dim/8)),T=[];let P=Math.ceil(Math.pow(2,b));const I=1/P,F=(H,W,ne,ue,ae)=>{const fe=ue?1:0,ye=(H+1)*ne-fe,be=W*ne,Ie=(W+1)*ne-fe;ae[0]=H*ne,ae[1]=be,ae[2]=ye,ae[3]=Ie};let B=new tb(P);const N=[];for(let H=0;H<P*P;H++){F(H%P,Math.floor(H/P),I,!1,N);const W=Wf(N[0],N[1],y),ne=Wf(N[2],N[1],y),ue=Wf(N[2],N[3],y),ae=Wf(N[0],N[3],y);B.minimums.push(Math.min(W,ne,ue,ae)),B.maximums.push(Math.max(W,ne,ue,ae)),B.leaves.push(1)}for(T.push(B),P/=2;P>=1;P/=2){const H=T[T.length-1];B=new tb(P);for(let W=0;W<P*P;W++){F(W%P,Math.floor(W/P),2,!0,N);const ne=H.getElevation(N[0],N[1]),ue=H.getElevation(N[2],N[1]),ae=H.getElevation(N[2],N[3]),fe=H.getElevation(N[0],N[3]),ye=H.isLeaf(N[0],N[1]),be=H.isLeaf(N[2],N[1]),Ie=H.isLeaf(N[2],N[3]),Re=H.isLeaf(N[0],N[3]),Ne=Math.min(ne.min,ue.min,ae.min,fe.min),Ve=Math.max(ne.max,ue.max,ae.max,fe.max),Be=ye&&be&&Ie&&Re;B.maximums.push(Ve),B.minimums.push(Ne),B.leaves.push(Ve-Ne<=5&&Be?1:0)}T.push(B)}return T})(this.dem),l=n.length-1,p=n[l];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,p,y,b,T=1){return ib([e,n,-100],[l,p,this.maximums[0]*T],y,b)}raycast(e,n,l,p,y,b,T=1){if(!this.nodeCount)return null;const P=this.raycastRoot(e,n,l,p,y,b,T);if(P==null)return null;const I=[],F=[],B=[],N=[],H=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:W,t:ne,nodex:ue,nodey:ae,depth:fe}=H.pop();if(this.leaves[W]){sb(ue,ae,fe,e,n,l,p,B,N);const be=1<<fe,Ie=(ue+0)/be,Re=(ue+1)/be,Ne=(ae+0)/be,Ve=(ae+1)/be,Be=Wf(Ie,Ne,this.dem)*T,He=Wf(Re,Ne,this.dem)*T,Ye=Wf(Re,Ve,this.dem)*T,yt=Wf(Ie,Ve,this.dem)*T,ft=rb(B[0],B[1],Be,N[0],B[1],He,N[0],N[1],Ye,y,b),gt=rb(N[0],N[1],Ye,B[0],N[1],yt,B[0],B[1],Be,y,b),Tt=Math.min(ft!==null?ft:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const Et=Ct([],y,b,ne);if(lb(Be,He,yt,Ye,nb(Et[0],B[0],N[0]),nb(Et[1],B[1],N[1]))>=Et[2])return ne}continue}let ye=0;for(let be=0;be<this._siblingOffset.length;be++){sb((ue<<1)+this._siblingOffset[be][0],(ae<<1)+this._siblingOffset[be][1],fe+1,e,n,l,p,B,N),B[2]=-100,N[2]=this.maximums[this.childOffsets[W]+be]*T;const Ie=ib(B,N,y,b);if(Ie!=null){const Re=Ie;I[be]=Re;let Ne=!1;for(let Ve=0;Ve<ye&&!Ne;Ve++)Re>=I[F[Ve]]&&(F.splice(Ve,0,be),Ne=!0);Ne||(F[ye]=be),ye++}}for(let be=0;be<ye;be++){const Ie=F[be];H.push({idx:this.childOffsets[W]+Ie,t:I[Ie],nodex:(ue<<1)+this._siblingOffset[Ie][0],nodey:(ae<<1)+this._siblingOffset[Ie][1],depth:fe+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,p,y){if(e[p].isLeaf(n,l)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const b=p-1,T=e[b];let P=0,I=0;for(let F=0;F<this._siblingOffset.length;F++){const B=2*n+this._siblingOffset[F][0],N=2*l+this._siblingOffset[F][1],H=T.getElevation(B,N),W=T.isLeaf(B,N),ne=this._addNode(H.min,H.max,W);W&&(P|=1<<F),I||(I=ne)}for(let F=0;F<this._siblingOffset.length;F++)P&1<<F||this._construct(e,2*n+this._siblingOffset[F][0],2*l+this._siblingOffset[F][1],b,I+F)}}function lb(o,e,n,l,p,y){return Ri(Ri(o,n,y),Ri(e,l,y),p)}function Wf(o,e,n){const l=n.dim,p=Oe(o*l-.5,0,l-1),y=Oe(e*l-.5,0,l-1),b=Math.floor(p),T=Math.floor(y),P=Math.min(b+1,l-1),I=Math.min(T+1,l-1);return lb(n.get(b,T),n.get(P,T),n.get(b,I),n.get(P,I),p-b,y-T)}const pS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mS(o,e,n){return(256*o*256+256*e+n)/10-1e4}function gS(o,e,n){return 256*o+e+n/256-32768}class J_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,p=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Pi(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,b=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let P=0;P<y;P++)b[this._idx(-1,P)]=b[this._idx(0,P)],b[this._idx(y,P)]=b[this._idx(y-1,P)],b[this._idx(P,-1)]=b[this._idx(P,0)],b[this._idx(P,y)]=b[this._idx(P,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)]}const T=l==="terrarium"?gS:mS;for(let P=0;P<b.length;++P){const I=4*P;this.floatView[P]=T(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=ka.now()}_buildQuadTree(){this._tree=new ab(this)}get(e,n,l=!1){l&&(e=Oe(e,-1,this.dim),n=Oe(n,-1,this.dim));const p=this._idx(e,n);return this.floatView[p]}set(e,n,l){const p=this._idx(e,n),y=this.floatView[p];return this.floatView[p]=l,l-y}static getUnpackVector(e){return pS[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const l=[0,0,0,0],p=J_.getUnpackVector(n);let y=Math.floor((e+p[3])/p[2]);return l[2]=y%256,y=Math.floor(y/256),l[1]=y%256,y=Math.floor(y/256),l[0]=y,l}getPixels(){return new e_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,y=n*this.dim+this.dim,b=l*this.dim,T=l*this.dim+this.dim;switch(n){case-1:p=y-1;break;case 1:y=p+1}switch(l){case-1:b=T-1;break;case 1:T=b+1}const P=-n*this.dim,I=-l*this.dim;for(let F=b;F<T;F++)for(let B=p;B<y;B++){const N=4*this._idx(B,F),H=4*this._idx(B+P,F+I);this.pixels[N+0]=e.pixels[H+0],this.pixels[N+1]=e.pixels[H+1],this.pixels[N+2]=e.pixels[H+2],this.pixels[N+3]=e.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function yS(o,e,n){o===1?e.headerLength=n.readFixed32():o===2?e.x=n.readVarint():o===3?e.y=n.readVarint():o===4?e.z=n.readVarint():o===5&&e.layers.push((function(l,p){return l.readFields(wS,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)})(n,n.readVarint()+n.pos))}function _S(o,e,n){o===1?(e.delta_filter=(function(l,p){return l.readFields(xS,{blockSize:0},p)})(n,n.readVarint()+n.pos),e.filter="delta_filter"):o===2?(n.readVarint(),e.filter="zigzag_filter"):o===3?(n.readVarint(),e.filter="bitshuffle_filter"):o===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function xS(o,e,n){o===1&&(e.blockSize=n.readVarint())}function vS(o,e,n){o===1?(n.readVarint(),e.codec="gzip_data"):o===2?(n.readVarint(),e.codec="jpeg_image"):o===3?(n.readVarint(),e.codec="webp_image"):o===4&&(n.readVarint(),e.codec="png_image")}function bS(o,e,n){let l=0,p=0;o===1?e.firstByte=n.readFixed64():o===2?e.lastByte=n.readFixed64():o===3?e.filters.push((function(y,b){return y.readFields(_S,{},b)})(n,n.readVarint()+n.pos)):o===4?e.codec=(function(y,b){return y.readFields(vS,{},b)})(n,n.readVarint()+n.pos):o===5?p=n.readFloat():o===6?l=n.readFloat():o===7?e.bands.push(n.readString()):o===8?e.offset=n.readDouble():o===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=l)}function wS(o,e,n){o===1?e.version=n.readVarint():o===2?e.name=n.readString():o===3?e.units=n.readString():o===4?e.tileSize=n.readVarint():o===5?e.buffer=n.readVarint():o===6?e.pixelFormat=n.readVarint():o===7&&e.dataIndex.push((function(l,p){return l.readFields(bS,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)})(n,n.readVarint()+n.pos))}function ES(o,e,n){if(o===2)(function(l,p,y){l.readFields(SS,y,p)})(n,n.readVarint()+n.pos,e);else if(o===3)throw new Error("Not implemented")}function SS(o,e,n){if(o===1){let l=0;const p=n.readVarint()+n.pos;for(;n.pos<p;)e[l++]=n.readVarint()}}function TS(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let l=2;l>=1;l--){const p=l===1?1:0,y=l===2?1:0;for(let b=0;b<e[0];b++){const T=e[1]*b;for(let P=p;P<e[1];P++){const I=e[2]*(P+T);for(let F=y;F<e[2];F++){const B=e[3]*(F+I);for(let N=0;N<e[3];N++){const H=B+N;o[H]+=o[H-n]}}}}n*=e[l]}return o}function AS(o){for(let e=0,n=o.length;e<n;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function CS(o,e){switch(e){case"uint32":return o;case"uint16":for(let n=0;n<o.length;n+=2){const l=o[n],p=o[n+1];o[n]=(240&l)>>4|(61440&l)>>8|(240&p)<<4|61440&p,o[n+1]=15&l|(3840&l)>>4|(15&p)<<8|(3840&p)<<4}return o;case"uint8":for(let n=0;n<o.length;n+=4){const l=o[n],p=o[n+1],y=o[n+2],b=o[n+3];o[n+0]=(192&l)>>6|(192&p)>>4|(192&y)>>2|192&b,o[n+1]=(48&l)>>4|(48&p)>>2|48&y|(48&b)<<2,o[n+2]=(12&l)>>2|12&p|(12&y)<<2|(12&b)<<4,o[n+3]=3&l|(3&p)<<2|(3&y)<<4|(3&b)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ut(J_,"DEMData"),Ut(ab,"DemMinMaxQuadTree",{omit:["dem"]});var ic=Uint8Array,ky=Uint16Array,RS=Int32Array,cb=new ic([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ub=new ic([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MS=new ic([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hb=function(o,e){for(var n=new ky(31),l=0;l<31;++l)n[l]=e+=1<<o[l-1];var p=new RS(n[30]);for(l=1;l<30;++l)for(var y=n[l];y<n[l+1];++y)p[y]=y-n[l]<<5|l;return{b:n,r:p}},db=hb(cb,2),fb=db.b,PS=db.r;fb[28]=258,PS[258]=28;for(var IS=hb(ub,0).b,pb=new ky(32768),fs=0;fs<32768;++fs){var Eg=(43690&fs)>>1|(21845&fs)<<1;pb[fs]=((65280&(Eg=(61680&(Eg=(52428&Eg)>>2|(13107&Eg)<<2))>>4|(3855&Eg)<<4))>>8|(255&Eg)<<8)>>1}var Ly=function(o,e,n){for(var l=o.length,p=0,y=new ky(e);p<l;++p)o[p]&&++y[o[p]-1];var b,T=new ky(e);for(p=1;p<e;++p)T[p]=T[p-1]+y[p-1]<<1;b=new ky(1<<e);var P=15-e;for(p=0;p<l;++p)if(o[p])for(var I=p<<4|o[p],F=e-o[p],B=T[o[p]-1]++<<F,N=B|(1<<F)-1;B<=N;++B)b[pb[B]>>P]=I;return b},Oy=new ic(288);for(fs=0;fs<144;++fs)Oy[fs]=8;for(fs=144;fs<256;++fs)Oy[fs]=9;for(fs=256;fs<280;++fs)Oy[fs]=7;for(fs=280;fs<288;++fs)Oy[fs]=8;var mb=new ic(32);for(fs=0;fs<32;++fs)mb[fs]=5;var DS=Ly(Oy,9),kS=Ly(mb,5),fx=function(o){for(var e=o[0],n=1;n<o.length;++n)o[n]>e&&(e=o[n]);return e},Cu=function(o,e,n){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&n},mx=function(o,e){var n=e/8|0;return(o[n]|o[n+1]<<8|o[n+2]<<16)>>(7&e)},LS=function(o){return(o+7)/8|0},OS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ru=function(o,e,n){var l=new Error(e||OS[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,Ru),!n)throw l;return l},zS=new ic(0),FS=typeof TextDecoder<"u"&&new TextDecoder;try{FS.decode(zS,{stream:!0})}catch{}const BS={gzip_data:"gzip"};class Oc extends Error{constructor(e){super(e),this.name="MRTError"}}const jS={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},gb={uint32:1,uint16:2,uint8:4},NS={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let gx;class e0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new Oc(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),l=new DataView(e);if(n[0]!==13)throw new Oc("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),l=this.getHeaderLength(e);if(n.length<l)throw new Oc(`Expected header with length >= ${l} but got buffer of length ${n.length}`);const p=new gx(n.subarray(0,l)).readFields(yS,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Oc(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const y of p.layers)this.layers[y.name]=new yb(y,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],l=this.getLayer(e.layerName);for(let p of e.blockIndices){const y=l.dataIndex[p],b=y.firstByte-e.firstByte,T=y.lastByte-e.firstByte;if(l._blocksInProgress.has(p))continue;const P={layerName:l.name,firstByte:b,lastByte:T,pixelFormat:l.pixelFormat,blockIndex:p,blockShape:[y.bands.length].concat(l.bandShape),buffer:l.buffer,codec:y.codec.codec,filters:y.filters.map(I=>I.filter)};l._blocksInProgress.add(p),n.push(P)}return new _b(n,()=>{n.forEach(p=>l._blocksInProgress.delete(p.blockIndex))},(p,y)=>{if(n.forEach(b=>l._blocksInProgress.delete(b.blockIndex)),p)throw p;y.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class yb{constructor({version:e,name:n,units:l,tileSize:p,pixelFormat:y,buffer:b,dataIndex:T},P){if(this.version=e,this.version!==1)throw new Oc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=l,this.tileSize=p,this.buffer=b,this.pixelFormat=jS[y],this.dataIndex=T,this.bandShape=[p+2*b,p+2*b,gb[this.pixelFormat]],this._decodedBlocks=new Q_(P?P.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return gb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[l,p]of this.dataIndex.entries()){for(const[y,b]of p.bands.entries())if(b===e)return{bandIndex:n+y,blockIndex:l,blockBandIndex:y};n+=p.bands.length}break;case"number":for(const[l,p]of this.dataIndex.entries()){if(e>=n&&e<n+p.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-n};n+=p.bands.length}break;default:throw new Oc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,l=-1/0;const p=[],y=new Set;for(const b of e){const{blockIndex:T}=this.getBlockForBand(b);if(T<0)throw new Oc(`Invalid band: ${JSON.stringify(b)}`);const P=this.dataIndex[T];p.includes(T)||p.push(T),y.add(T),n=Math.min(n,P.firstByte),l=Math.max(l,P.lastByte)}if(y.size>this.cacheSize)throw new Oc(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:l,blockIndices:p}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:l}=this.getBlockForBand(e);if(n<0)throw new Oc(`Band not found: ${JSON.stringify(e)}`);const p=this._decodedBlocks.get(n.toString());if(!p)throw new Oc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[n],b=this.bandShape.reduce((I,F)=>I*F,1),T=l*b,P=p.subarray(T,T+b);return{data:P,bytes:new Uint8Array(P.buffer).subarray(P.byteOffset,P.byteOffset+P.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}e0.setPbf=function(o){gx=o};class _b{constructor(e,n,l){this.tasks=e,this._onCancel=n,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}e0.performDecoding=function(o,e){const n=new Uint8Array(o);return Promise.all(e.tasks.map(l=>{const{layerName:p,firstByte:y,lastByte:b,pixelFormat:T,blockShape:P,blockIndex:I,filters:F,codec:B}=l,N=n.subarray(y,b+1),H=new Uint32Array(P[0]*P[1]*P[2]);let W;if(B!=="gzip_data")throw new Oc(`Unhandled codec: ${B}`);return W=(function(ne,ue){if(!globalThis.DecompressionStream&&ue==="gzip_data")return Promise.resolve((Ie=(function(Ve){Ve[0]==31&&Ve[1]==139&&Ve[2]==8||Ru(6,"invalid gzip data");var Be=Ve[3],He=10;4&Be&&(He+=2+(Ve[10]|Ve[11]<<8));for(var Ye=(Be>>3&1)+(Be>>4&1);Ye>0;Ye-=!Ve[He++]);return He+(2&Be)})(ae=ne),Ie+8>ae.length&&Ru(6,"invalid gzip data"),(function(Ve,Be,He,Ye){var yt=Ve.length;if(!yt||Be.f&&!Be.l)return He||new ic(0);var ft=!He,gt=ft||Be.i!=2,Tt=Be.i;ft&&(He=new ic(3*yt));var Et=function($a){var Ph=He.length;if($a>Ph){var Pa=new ic(Math.max(2*Ph,$a));Pa.set(He),He=Pa}},St=Be.f||0,ht=Be.p||0,Rt=Be.b||0,vt=Be.l,Mt=Be.d,At=Be.m,ti=Be.n,ri=8*yt;do{if(!vt){St=Cu(Ve,ht,1);var Zt=Cu(Ve,ht+1,3);if(ht+=3,!Zt){var Kt=Ve[(hr=LS(ht)+4)-4]|Ve[hr-3]<<8,Ei=hr+Kt;if(Ei>yt){Tt&&Ru(0);break}gt&&Et(Rt+Kt),He.set(Ve.subarray(hr,Ei),Rt),Be.b=Rt+=Kt,Be.p=ht=8*Ei,Be.f=St;continue}if(Zt==1)vt=DS,Mt=kS,At=9,ti=5;else if(Zt==2){var pi=Cu(Ve,ht,31)+257,ei=Cu(Ve,ht+10,15)+4,ki=pi+Cu(Ve,ht+5,31)+1;ht+=14;for(var Qi=new ic(ki),yr=new ic(19),Wi=0;Wi<ei;++Wi)yr[MS[Wi]]=Cu(Ve,ht+3*Wi,7);ht+=3*ei;var Ir=fx(yr),cr=(1<<Ir)-1,zn=Ly(yr,Ir);for(Wi=0;Wi<ki;){var hr,Rr=zn[Cu(Ve,ht,cr)];if(ht+=15&Rr,(hr=Rr>>4)<16)Qi[Wi++]=hr;else{var Jr=0,on=0;for(hr==16?(on=3+Cu(Ve,ht,3),ht+=2,Jr=Qi[Wi-1]):hr==17?(on=3+Cu(Ve,ht,7),ht+=3):hr==18&&(on=11+Cu(Ve,ht,127),ht+=7);on--;)Qi[Wi++]=Jr}}var ln=Qi.subarray(0,pi),Fn=Qi.subarray(pi);At=fx(ln),ti=fx(Fn),vt=Ly(ln,At),Mt=Ly(Fn,ti)}else Ru(1);if(ht>ri){Tt&&Ru(0);break}}gt&&Et(Rt+131072);for(var Us=(1<<At)-1,ma=(1<<ti)-1,ss=ht;;ss=ht){var ps=(Jr=vt[mx(Ve,ht)&Us])>>4;if((ht+=15&Jr)>ri){Tt&&Ru(0);break}if(Jr||Ru(2),ps<256)He[Rt++]=ps;else{if(ps==256){ss=ht,vt=null;break}var Ts=ps-254;ps>264&&(Ts=Cu(Ve,ht,(1<<(En=cb[Wi=ps-257]))-1)+fb[Wi],ht+=En);var qi=Mt[mx(Ve,ht)&ma],un=qi>>4;if(qi||Ru(3),ht+=15&qi,Fn=IS[un],un>3){var En=ub[un];Fn+=mx(Ve,ht)&(1<<En)-1,ht+=En}if(ht>ri){Tt&&Ru(0);break}gt&&Et(Rt+131072);var Jo=Rt+Ts;if(Rt<Fn){var Ga=0-Fn,Gs=Math.min(Fn,Jo);for(Ga+Rt<0&&Ru(3);Rt<Gs;++Rt)He[Rt]=Ye[Ga+Rt]}for(;Rt<Jo;++Rt)He[Rt]=He[Rt-Fn]}}Be.l=vt,Be.p=ss,Be.b=Rt,Be.f=St,vt&&(St=1,Be.m=At,Be.d=Mt,Be.n=ti)}while(!St);return Rt!=He.length&&ft?(function($a,Ph,Pa){return(Pa==null||Pa>$a.length)&&(Pa=$a.length),new ic($a.subarray(0,Pa))})(He,0,Rt):He.subarray(0,Rt)})(ae.subarray(Ie,-8),{i:2},new ic(((ye=ae)[(be=ye.length)-4]|ye[be-3]<<8|ye[be-2]<<16|ye[be-1]<<24)>>>0),fe)));var ae,fe,ye,be,Ie;const Re=BS[ue];if(!Re)throw new Error(`Unhandled codec: ${ue}`);const Ne=new globalThis.DecompressionStream(Re);return new Response(new Blob([ne]).stream().pipeThrough(Ne)).arrayBuffer().then(Ve=>new Uint8Array(Ve))})(N,B).then(ne=>((function(ue,ae){ue.readFields(ES,ae)})(new gx(ne),H),new NS[T](H.buffer))),W.then(ne=>{for(let ue=F.length-1;ue>=0;ue--)switch(F[ue]){case"delta_filter":TS(ne,P);break;case"zigzag_filter":AS(ne);break;case"bitshuffle_filter":CS(ne,T);break;default:throw new Oc(`Unhandled filter "${F[ue]}"`)}return{layerName:p,blockIndex:I,data:ne}}).catch(ne=>{throw ne})}))},Ut(_b,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ut(e0,"MapboxRasterTile"),Ut(yb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class xb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class vb{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new gl($t,16,0),this.featureIndexArray=new Yl,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,l,p,y,b=0,T=0){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,y,b);const I=this.grid;for(let F=0;F<n.length;F++){const B=n[F],N=[1/0,1/0,-1/0,-1/0];for(let H=0;H<B.length;H++){const W=B[H];N[0]=Math.min(N[0],W.x),N[1]=Math.min(N[1],W.y),N[2]=Math.max(N[2],W.x),N[3]=Math.max(N[3],W.y)}T!==0&&(N[0]-=T,N[1]-=T,N[2]+=T,N[3]+=T),N[0]<$t&&N[1]<$t&&N[2]>=0&&N[3]>=0&&I.insert(P,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sr(new I_(this.rawTileData)).layers,this.sourceLayerCoder=new xb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:l,transform:p,tileTransform:y,pixelPosMatrix:b,availableImages:T,worldview:P}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const I=n.queryRadius?n.queryRadius:0,F=l.bufferedTilespaceBounds,B=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(ne,ue,ae,fe)=>ro(l.bufferedTilespaceGeometry,ne-I,ue-I,ae+I,fe+I));B.sort(VS);let N=null;p.elevation&&B.length>0&&(N=vg.create(p.elevation,this.tileID));const H={};let W;for(let ne=0;ne<B.length;ne++){const ue=B[ne];if(ue===W)continue;W=ue;const ae=this.featureIndexArray.get(ue);let fe=null;this.is3DTile?this.loadMatchingModelFeature(H,ae,e,l,p,P):this.loadMatchingFeature(H,ae,e,T,P,(ye,be,Ie,Re=0)=>(fe||(fe=Ti(ye,this.tileID.canonical,y)),be.queryIntersectsFeature(l,ye,Ie,fe,this.z,p,b,N,Re,n.scope)))}return H}loadMatchingFeature(e,n,l,p,y,b){const{featureIndex:T,bucketIndex:P,sourceLayerIndex:I,layoutVertexArrayOffset:F}=n,B=this.bucketLayerIDs[P],N=l.layers,H=Object.keys(N);if(H.length&&!Vi(H,B))return;const W=l.sourceCache,ne=this.sourceLayerCoder.decode(I),ue=this.vtLayers[ne].feature(T),ae=this.getId(ue,ne);for(let fe=0;fe<B.length;fe++){const ye=B[fe];if(!N[ye])continue;const{styleLayer:be,targets:Ie}=N[ye];let Re={};ae!==void 0&&(Re=W.getFeatureState(be.sourceLayer,ae));const Ne=!b||b(ue,be,Re,F);if(!Ne)continue;const Ve=new _m(ue,this.z,this.x,this.y,ae);Ve.tile=this.tileID.canonical,Ve.state=Re;let Be=this.serializedLayersCache.get(ye);Be||(Be=be.serialize(),Be.id=ye,this.serializedLayersCache.set(ye,Be)),Ve.source=Be.source,Ve.sourceLayer=Be["source-layer"],Ve.layer=Object.assign({},Be),Ve.layer.paint=bb(Be.paint,be.paint,ue,Re,p),Ve.layer.layout=bb(Be.layout,be.layout,ue,Re,p);let He=!1;for(const Ye of Ie){this.updateFeatureProperties(Ve,Ye);const{filter:yt}=Ye;if(yt){if(ue.properties=Ve.properties,yt.needGeometry){const ft=Fi(ue,!0);if(!yt.filter(new xr(this.tileID.overscaledZ,{worldview:y}),ft,this.tileID.canonical))continue}else if(!yt.filter(new xr(this.tileID.overscaledZ,{worldview:y}),ue))continue}He=!0,Ye.targetId&&this.addFeatureVariant(Ve,Ye)}He&&this.appendToResult(e,ye,T,Ve,Ne)}}loadMatchingModelFeature(e,n,l,p,y,b){const{featureIndex:T,bucketIndex:P}=n,I=this.bucketLayerIDs[P],F=l.layers,B=Object.keys(F);if(!B.length||Vi(B,I))for(let N=0;N<I.length;N++){const H=I[N],{styleLayer:W,targets:ne}=F[H];if(W.type!=="model")continue;const ue=p.tile,ae=ue.getBucket(W);if(!(ae&&ae instanceof Z_))continue;const fe=ZE(ae,T,p,y);if(!fe)continue;const{z:ye,x:be,y:Ie}=ue.tileID.canonical,{feature:Re,intersectionZ:Ne,position:Ve}=fe;let Be={};Re.id!==void 0&&(Be=l.sourceCache.getFeatureState(W.sourceLayer,Re.id));const He=new _m({},ye,be,Ie,Re.id);He.tile=this.tileID.canonical,He.state=Be,He.properties=Re.properties,He.geometry={type:"Point",coordinates:[Ve.lng,Ve.lat]};let Ye=this.serializedLayersCache.get(H);Ye||(Ye=W.serialize(),Ye.id=H,this.serializedLayersCache.set(H,Ye)),He.source=Ye.source,He.sourceLayer=Ye["source-layer"],He.layer=Object.assign({},Ye);let yt=!1;for(const ft of ne){this.updateFeatureProperties(He,ft);const{filter:gt}=ft;if(gt){if(Re.properties=He.properties,gt.needGeometry){if(!gt.filter(new xr(this.tileID.overscaledZ,{worldview:b}),Re,this.tileID.canonical))continue}else if(!gt.filter(new xr(this.tileID.overscaledZ,{worldview:b}),Re))continue}yt=!0,ft.targetId&&this.addFeatureVariant(He,ft)}yt&&this.appendToResult(e,H,T,He,Ne)}}updateFeatureProperties(e,n,l){if(n.properties){const p={};for(const y in n.properties){const b=n.properties[y].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);b!=null&&(p[y]=b)}e.properties=p}}addFeatureVariant(e,n,l){const p={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(p.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(p)}appendToResult(e,n,l,p,y){let b=e[n];b===void 0&&(b=e[n]=[]),b.push({featureIndex:l,feature:p,intersectionZ:y})}lookupSymbolFeatures(e,n,l,p,y,b){const T={};this.loadVTLayers();for(const P of e)this.loadMatchingFeature(T,{bucketIndex:n,sourceLayerIndex:l,featureIndex:P,layoutVertexArrayOffset:0},p,y,b);return T}loadFeature(e){const{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();const p=this.sourceLayerCoder.decode(l),y=this.vtFeatures[p];if(y[n])return y[n];const b=this.vtLayers[p].feature(n);return y[n]=b,b}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const y=ml(p);if(y.result!=="success"){const b=y.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void Pi(`Failed to create expression for promoteId: ${b}`)}this.promoteIdExpression=y.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[p];typeof l=="boolean"&&(l=Number(l))}return l}}function bb(o,e,n,l,p){return yi(o,(y,b)=>{const T=e instanceof ta?e.get(b):null;return T&&T.evaluate?T.evaluate(n,l,void 0,p):T})}function VS(o,e){return e-o}Ut(vb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=wb[15&l];if(!y)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new yx(T,b,y,e)}constructor(e,n=64,l=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const y=wb.indexOf(this.ArrayType),b=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-T%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+P,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+P),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+P,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _x(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:T}=this,P=[0,y.length-1,0],I=[];for(;P.length;){const F=P.pop()||0,B=P.pop()||0,N=P.pop()||0;if(B-N<=T){for(let ue=N;ue<=B;ue++){const ae=b[2*ue],fe=b[2*ue+1];ae>=e&&ae<=l&&fe>=n&&fe<=p&&I.push(y[ue])}continue}const H=N+B>>1,W=b[2*H],ne=b[2*H+1];W>=e&&W<=l&&ne>=n&&ne<=p&&I.push(y[H]),(F===0?e<=W:n<=ne)&&(P.push(N),P.push(H-1),P.push(1-F)),(F===0?l>=W:p>=ne)&&(P.push(H+1),P.push(B),P.push(1-F))}return I}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:b}=this,T=[0,p.length-1,0],P=[],I=l*l;for(;T.length;){const F=T.pop()||0,B=T.pop()||0,N=T.pop()||0;if(B-N<=b){for(let ue=N;ue<=B;ue++)Sb(y[2*ue],y[2*ue+1],e,n)<=I&&P.push(p[ue]);continue}const H=N+B>>1,W=y[2*H],ne=y[2*H+1];Sb(W,ne,e,n)<=I&&P.push(p[H]),(F===0?e-l<=W:n-l<=ne)&&(T.push(N),T.push(H-1),T.push(1-F)),(F===0?e+l>=W:n+l>=ne)&&(T.push(H+1),T.push(B),T.push(1-F))}return P}}function _x(o,e,n,l,p,y){if(p-l<=n)return;const b=l+p>>1;Eb(o,e,b,l,p,y),_x(o,e,n,l,b-1,1-y),_x(o,e,n,b+1,p,1-y)}function Eb(o,e,n,l,p,y){for(;p>l;){if(p-l>600){const I=p-l+1,F=n-l+1,B=Math.log(I),N=.5*Math.exp(2*B/3),H=.5*Math.sqrt(B*N*(I-N)/I)*(F-I/2<0?-1:1);Eb(o,e,n,Math.max(l,Math.floor(n-F*N/I+H)),Math.min(p,Math.floor(n+(I-F)*N/I+H)),y)}const b=e[2*n+y];let T=l,P=p;for(zy(o,e,l,n),e[2*p+y]>b&&zy(o,e,l,p);T<P;){for(zy(o,e,T,P),T++,P--;e[2*T+y]<b;)T++;for(;e[2*P+y]>b;)P--}e[2*l+y]===b?zy(o,e,l,P):(P++,zy(o,e,P,p)),P<=n&&(l=P+1),n<=P&&(p=P-1)}}function zy(o,e,n,l){xx(o,n,l),xx(e,2*n,2*l),xx(e,2*n+1,2*l+1)}function xx(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}function Sb(o,e,n,l){const p=o-n,y=e-l;return p*p+y*y}a.$=Xd,a.A=vs,a.B=Uo,a.C=2,a.D=lg,a.E=Pl,a.F=xy,a.G=qv,a.H=Nu,a.I=Xs,a.J=Ip,a.K=Mi,a.L=Si,a.M=eu,a.N=rh,a.O=Hl,a.P=Pt,a.Q=nu,a.R=Kn,a.S=bf,a.T=T0,a.U=ml,a.V=W_,a.W=jo,a.X=mn,a.Y=Yc,a.Z=us,a._=va,a.a=function(o){return Yn.API_CDN_URL_REGEX.test(o)},a.a$=wt,a.a0=Vu,a.a1=Rm,a.a2=md,a.a3=class extends W_{},a.a4=nh,a.a5=pl,a.a6=it,a.a7=function(o){const e=o.value;return e?Vu(e)?nx(e,!0)?[]:[new W_(o.key,e,`invalid url "${e}"`)]:[new W_(o.key,e,`string expected, "${Mi(e)}" found`)]:[]},a.a8=oh,a.a9=Kr,a.aA=Oe,a.aB=se,a.aC=jn,a.aD=de,a.aE=Ra,a.aF=Qe,a.aG=zt,a.aH=function(o,e){const n={};for(let l=0;l<e.length;l++){const p=e[l];p in o&&(n[p]=o[p])}return n},a.aI=We,a.aJ=rt,a.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,n,l){const p=this.entries[o]=this.entries[o]||{callbacks:[]};if(p.result){const[y,b]=p.result;return this.scheduler?this.scheduler.add(()=>{l(y,b)},e):l(y,b),()=>{}}return p.callbacks.push(l),p.cancel||(p.cancel=n((y,b)=>{p.result=[y,b];for(const T of p.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,b)},e):T(y,b);setTimeout(()=>delete this.entries[o],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==l),p.callbacks.length||(p.cancel(),delete this.entries[o]))}}},a.aL=function(o,e,n){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const y=Nc(o.request,(b,T,P)=>{b?p(b):T&&p(null,{rawData:T,vectorTile:n?void 0:new sr(new I_(T)),responseHeaders:new Map(P.entries())})});return()=>{y.cancel(),p()}},e)},a.aM=function(o){return o?{cacheControl:o.get("Cache-Control"),expires:o.get("Expires")}:{cacheControl:void 0,expires:void 0}},a.aN=jc,a.aO=function(o){ho++,ho>Ud&&(o.getActor().send("enforceCacheSizeLimit",np),ho=0)},a.aP=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},a.aQ=Ps,a.aR=T1,a.aS=I1,a.aT=Pe,a.aU=S1,a.aV=function(o,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<o.length;l++){const p=document.createElement("source");Gd(o[l])||(n.crossOrigin="Anonymous"),p.src=o[l],n.appendChild(p)}return{cancel:()=>{}}},a.aW=py,a.aX=xm,a.aY=ii,a.aZ=wy,a.a_=pt,a.aa=Nt,a.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Wr(o.expression.evaluate(e))}interpolate(o,e,n){return{x:Ri(o.x,e.x,n),y:Ri(o.y,e.y,n),z:Ri(o.z,e.z,n),azimuthal:Ri(o.azimuthal,e.azimuthal,n),polar:Ri(o.polar,e.polar,n)}}},a.ac=xr,a.ad=Ns,a.ae=Wt,a.af=Ui,a.ag=kt,a.ah=Ke,a.ai=ta,a.aj=wu,a.ak=Ri,a.al=$t,a.am=up,a.an=tr,a.ao=_r,a.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([n,l]){const p=Wr([1,n,l]);return{x:p.x,y:p.y,z:p.z}})(o.expression.evaluate(e))}interpolate(o,e,n){return{x:Ri(o.x,e.x,n),y:Ri(o.y,e.y,n),z:Ri(o.z,e.z,n)}}},a.aq=function(o,e,n=0,l=!0){const p=new Pt(n,n),y=o.sub(p),b=e.add(p),T=[y,new Pt(b.x,y.y),b,new Pt(y.x,b.y)];return l&&T.push(y.clone()),T},a.ar=function(o,e){const n=[];for(let l=0;l<o.length;l++){const p=ut(l-1,-1,o.length-1),y=ut(l+1,-1,o.length-1),b=o[l],T=o[y],P=o[p].sub(b).unit(),I=T.sub(b).unit(),F=I.angleWithSep(P.x,P.y),B=P.add(I).unit().mult(-1*e/Math.sin(F/2));n.push(b.add(B))}return n},a.as=c1,a.at=ro,a.au=function(o,e,n=0){return xe(((e.x-n)*o.scale-o.x)*$t,(e.y*o.scale-o.y)*$t,nt(e.z,e.y))},a.av=Sr,a.aw=vi,a.ax=kr,a.ay=bv,a.az=function(o){let e=1/0,n=1/0,l=-1/0,p=-1/0;for(const y of o)e=Math.min(e,y.x),n=Math.min(n,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return{min:new Pt(e,n),max:new Pt(l,p)}},a.b=function(o){return Yn.API_FONTS_REGEX.test(o)},a.b$=te,a.b0=qn,a.b1=xl,a.b2=Ft,a.b3=Rf,a.b4=G_,a.b5=function(){Fa.isLoading()||Fa.isLoaded()||Ec()!=="deferred"||xf()},a.b6=wf,a.b7=Fi,a.b8=_m,a.b9=qr,a.bA=le,a.bB=ke,a.bC=Z,a.bD=function(o,e){const{x:n,y:l}=o.point,p=Zm(n,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return se(p,p,Ur(ec(e)))},a.bE=j,a.bF=Wn,a.bG=li,a.bH=Ct,a.bI=lr,a.bJ=Gi,a.bK=mg,a.bL=Qo,a.bM=U0,a.bN=function(o,e,n,l,p){const y=5*e+2;o.float32[y+0]=n,o.float32[y+1]=l,o.float32[y+2]=p},a.bO=xg,a.bP=$n,a.bQ=qa,a.bR=ao,a.bS=Xn,a.bT=ut,a.bU=function(o,e,n,l){var p=new O(4);return p[0]=o,p[1]=e,p[2]=n,p[3]=l,p},a.bV=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const n=e.getSource().maxzoom,l=1<<n,p=Math.floor(o.x),y=Math.floor((o.x-p)*l),b=Math.floor(o.y*l),T=this.findDEMTileFor(new Ps(n,p,n,y,b));return!(!T||!T.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const p=l.getSource().maxzoom,y=1<<p,b=Math.floor(o.x),T=o.x-b,P=new Ps(p,b,p,Math.floor(T*y),Math.floor(o.y*y)),I=this.findDEMTileFor(P);if(!I||!I.dem)return e;const F=I.dem,B=1<<I.tileID.canonical.z,N=(T*B-I.tileID.canonical.x)*F.dim,H=(o.y*B-I.tileID.canonical.y)*F.dim,W=Math.floor(N),ne=Math.floor(H);return(n?this.exaggeration():1)*Ri(Ri(F.get(W,ne),F.get(W,ne+1),H-ne),Ri(F.get(W+1,ne),F.get(W+1,ne+1),H-ne),N-W)}static getAtTileOffset(o,e,n,l){const p=1<<o.canonical.z;return l?l.pointElevation(e):n?n.getAtPointOrZero(new Wt(o.wrap+(o.canonical.x+e.x/$t)/p,(o.canonical.y+e.y/$t)/p)):0}static getAtTileOffsetFunc(o,e,n,l){return(p,y,b)=>{const T=this.getAtTileOffset(o,p,y,b),P=l.upVector(o.canonical,p.x,p.y);return ct(P,P,T*l.upVectorScale(o.canonical,e,n).metersToTile),P}}getForTilePoints(o,e,n,l){if(this.isUsingMockSource())return!1;const p=vg.create(this,o,l);return!!p&&(e.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],n)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const n=e.dem.tree,l=e.tileID,p=1<<o.canonical.z-l.canonical.z;let y=o.canonical.x/p-l.canonical.x,b=o.canonical.y/p-l.canonical.y,T=0;for(let P=0;P<o.canonical.z-l.canonical.z&&!n.leaves[T];P++){y*=2,b*=2;const I=2*Math.floor(b)+Math.floor(y);T=n.childOffsets[T]+I,y%=1,b%=1}return{min:this.exaggeration()*n.minimums[T],max:this.exaggeration()*n.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,n=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const p of o){const y=this.getMinMaxForTile(p.tileID);y&&(n=Math.min(n,y.min),l=Math.max(l,y.max),e=!0)}return e?{min:n,max:l}:null}},a.bW=v_,a.bX=Qr,a.bY=Is,a.bZ=cm,a.b_=D1,a.ba=L0,a.bb=Lc,a.bc=Ti,a.bd=Xl,a.be=mh,a.bf=jg,a.bg=$r,a.bh=Yo,a.bi=tx,a.bj=function(o,e){const n=wu(e.zoom);if(n===0)return ec(o);const l=kf(o),p=Vg(l),y=Qe(l.getWest())*e.worldSize,b=Qe(l.getEast())*e.worldSize,T=rt(l.getNorth())*e.worldSize,P=rt(l.getSouth())*e.worldSize,I=[y,T,0],F=[b,T,0],B=[y,P,0],N=[b,P,0],H=ee([],e.globeMatrix);return Ui(I,I,H),Ui(F,F,H),Ui(B,B,H),Ui(N,N,H),p[0]=Pc(p[0],B,n),p[1]=Pc(p[1],N,n),p[2]=Pc(p[2],F,n),p[3]=Pc(p[3],I,n),mr.fromPoints(p)},a.bk=Wp,a.bl=ee,a.bm=qp,a.bn=Pc,a.bo=Go,a.bp=n0,a.bq=Le,a.br=Q,a.bs=e0,a.bt=I_,a.bu=Nc,a.bv=function(o,e){const n=[];for(const l in o)l in e||n.push(l);return n},a.bw=et,a.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.by=ga,a.bz=Y,a.c=zs,a.c$=function(o,e,n){let l=0;for(let p=0;p<2;++p)o[p]>0&&(l+=(o[p]-0)*(o[p]-0)),e[p]<0&&(l+=(0-e[p])*(0-e[p]));return l},a.c0=we,a.c1=j0,a.c2=e1,a.c3=W0,a.c4=yx,a.c5=ct,a.c6=es,a.c7=ys,a.c8=function(o,e,n){n*=.5;var l=e[0],p=e[1],y=e[2],b=e[3],T=Math.sin(n),P=Math.cos(n);return o[0]=l*P+p*T,o[1]=p*P-l*T,o[2]=y*P+b*T,o[3]=b*P-y*T,o},a.c9=As,a.cA=Bt,a.cB=ns,a.cC=av,a.cD=wl,a.cE=Wm,a.cF=function(o,e,n,l,p,y,b,T,P){if(P.name==="globe")return Wm(o,e,new wl(n,l,p),!1);const I=wy({z:n,x:l,y:p},P);return new mr([(y+I.x/I.scale)*e,e*(I.y/I.scale),b],[(y+I.x2/I.scale)*e,e*(I.y2/I.scale),T])},a.cG=function(o,e,n){return o[0]=Math.min(e[0],n[0]),o[1]=Math.min(e[1],n[1]),o[2]=Math.min(e[2],n[2]),o[3]=Math.min(e[3],n[3]),o},a.cH=function(o,e,n){return o[0]=Math.max(e[0],n[0]),o[1]=Math.max(e[1],n[1]),o[2]=Math.max(e[2],n[2]),o[3]=Math.max(e[3],n[3]),o},a.cI=function(o){const e=Math.round((o+45+360)%360/90)%4;return me[e]},a.cJ=Ze,a.cK=dn,a.cL=6,a.cM=function(o){const e=le(new Float64Array(16));se(e,o.pixelMatrix,o.globeMatrix);const n=[0,Ae,0],l=[0,Ee,0];return Ui(n,n,e),Ui(l,l,e),[n[0]>0&&n[0]<=o.width&&n[1]>0&&n[1]<=o.height&&!Md(o,new Pe(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!Md(o,new Pe(o.center.lat,-90))]},a.cN=function(o,e){const{scale:n}=o.tileTransform,l=n*$t/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(p,y,b){var T=y[1],P=y[2],I=y[3],F=b[0],B=b[1];return p[0]=y[0]*F,p[1]=T*F,p[2]=P*B,p[3]=I*B,p})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},a.cO=T_,a.cP=Ot,a.cQ=sv,a.cR=function(o){const e=sv(o,!0);return j([],[e[0],e[1],e[4],e[5]])},a.cS=oe,a.cT=sn,a.cU=_e,a.cV=function(o){const{x:e,y:n}=o.point,{lng:l,lat:p}=o._center;return Zm(e,n,o.worldSize,l,p)},a.cW=st,a.cX=Je,a.cY=wh,a.cZ=Xo,a.c_=5,a.ca=Yr,a.cb=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},a.cc=Yt,a.cd=function(o,e,n,l,p){var y=1/Math.tan(e/2);if(o[0]=y/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0){var b=1/(l-p);o[10]=(p+l)*b,o[14]=2*p*l*b}else o[10]=-1,o[14]=-2*l;return o},a.ce=function(o,e,n,l,p,y,b){var T=1/(e-n),P=1/(l-p),I=1/(y-b);return o[0]=-2*T,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*P,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(e+n)*T,o[13]=(p+l)*P,o[14]=(b+y)*I,o[15]=1,o},a.cf=tt,a.cg=function(o,e,n){o[4*e+0]=n[0],o[4*e+1]=n[1],o[4*e+2]=n[2],o[4*e+3]=n[3]},a.ch=_n,a.ci=xh,a.cj=Vn,a.ck=Na,a.cl=xu,a.cm=p1,a.cn=function(){var o=new O(4);return O!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},a.co=function(o,e,n){var l=e[0],p=e[1],y=e[2],b=e[3],T=Math.sin(n),P=Math.cos(n);return o[0]=l*P+y*T,o[1]=p*P+b*T,o[2]=l*-T+y*P,o[3]=p*-T+b*P,o},a.cp=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},a.cq=vn,a.cr=function(o){var e=o[0],n=o[1],l=o[2],p=o[3];return Math.sqrt(e*e+n*n+l*l+p*p)},a.cs=Co,a.ct=Gn,a.cu=qm,a.cv=3,a.cw=2,a.cx=7,a.cy=6,a.cz=zr,a.d=function(o){return Yn.API_TILEJSON_REGEX.test(o)},a.d$=class{constructor(o,e,n,l){this.context=o,this.format=l,this.size=n,this.texture=o.gl.createTexture();const[p,y,b]=this.size,{gl:T}=o;T.bindTexture(T.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&T.texImage3D(T.TEXTURE_3D,0,this.format,p,y,b,0,E0(this.format),S0(this.format),e.data)}bind(o,e){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},a.d0=function(o){return o*o*o*o*o},a.d1=Xe,a.d2=45,a.d3=kn,a.d4=function(o,e,n){const l=Math.sqrt(o*o+e*e+n*n),p=l>0?Math.acos(n/l)*Os:0;let y=o!==0||e!==0?Math.atan2(-e,-o)*Os+90:0;return y<0&&(y+=360),[l,y,p]},a.d5=xe,a.d6=Wr,a.d7=Lt,a.d8=pe,a.d9=mr,a.dA=function(o){return o({pluginStatus:ea,pluginURL:Zl}),_f.on("pluginStateChange",o),o},a.dB=Ta,a.dC=class extends bo{constructor(o){super(o),this.current=Fg}set(o,e,n){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},a.dD=ve,a.dE=function(o,e,n){const l=wu(n.zoom),p=o.style.map._antialias,y=o.terrain&&o.terrain.exaggeration()>0;return l===0&&!p&&!y},a.dF=function(o){const e=o.pixelsPerMeter,n=e/tt(1,o.center.lat),l=le(new Float64Array(16));return Q(l,l,[o.point.x,o.point.y,0]),oe(l,l,[n,n,e]),Float32Array.from(l)},a.dG=kf,a.dH=function(o){const e=80.051129;o=Oe(o,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(tr(o))),3);return Math.round(n*(Ce.length-1))},a.dI=function(o,e,n,l){const p=e.getNorth(),y=e.getSouth(),b=e.getWest(),T=e.getEast(),P=1<<o.z,I=T-b,F=p-y,B=I/ge,N=-F/Ce[n],H=[0,B,0,N,0,0,p,b,0];if(o.z>0){const W=180/l;J(H,H,[W/I+1,0,0,0,W/F+1,0,-.5*W/B,.5*W/N,1])}return H[2]=P,H[5]=o.x,H[8]=o.y,H},a.dJ=ec,a.dK=function(o,e,n){const l=le(new Float64Array(16)),p=(e/(1<<o)-.5)*Math.PI*2;return Se(l,n.globeMatrix,p),Float32Array.from(l)},a.dL=e_,a.dM=$p,a.dN=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},a.dO=V,a.dP=function(o,e){var n=Math.sin(e),l=Math.cos(e);return o[0]=l,o[1]=n,o[2]=0,o[3]=-n,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},a.dQ=Ci,a.dR=Xp,a.dS=Br,a.dT=pn,a.dU=ix,a.dV=function(o,e){const n=[0,0,0];return Ui(n,n,Wp(ec(e.canonical))),Ui(n,n,o),n},a.dW=o=>({u_matrix:new xu(o),u_texsize:new Na(o),u_pixels_to_tile_units:new i(o),u_device_pixel_ratio:new Vn(o),u_width_scale:new Vn(o),u_floor_width_scale:new Vn(o),u_image:new _n(o),u_units_to_pixels:new Na(o),u_tile_units_to_pixels:new Vn(o),u_alpha_discard_threshold:new Vn(o),u_trim_offset:new Na(o),u_trim_fade_range:new Na(o),u_trim_gradient_mix_range:new Na(o),u_trim_color:new kn(o),u_zbias_factor:new Vn(o),u_tile_to_meter:new Vn(o),u_ground_shadow_factor:new xh(o),u_pattern_transition:new Vn(o)}),a.dX=o=>({u_matrix:new xu(o),u_pixels_to_tile_units:new i(o),u_device_pixel_ratio:new Vn(o),u_width_scale:new Vn(o),u_floor_width_scale:new Vn(o),u_units_to_pixels:new Na(o),u_dash_image:new _n(o),u_gradient_image:new _n(o),u_image_height:new Vn(o),u_texsize:new Na(o),u_tile_units_to_pixels:new Vn(o),u_alpha_discard_threshold:new Vn(o),u_trim_offset:new Na(o),u_trim_fade_range:new Na(o),u_trim_gradient_mix_range:new Na(o),u_trim_color:new kn(o),u_zbias_factor:new Vn(o),u_tile_to_meter:new Vn(o),u_ground_shadow_factor:new xh(o)}),a.dY=o=>({u_camera_to_center_distance:new Vn(o),u_extrude_scale:new i(o),u_device_pixel_ratio:new Vn(o),u_matrix:new xu(o),u_inv_rot_matrix:new xu(o),u_merc_center:new Na(o),u_tile_id:new xh(o),u_zoom_transition:new Vn(o),u_up_dir:new xh(o),u_emissive_strength:new Vn(o)}),a.dZ=Ed,a.d_=Qw,a.da=Te,a.db=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},a.dc=nv,a.dd=I0,a.de=cv,a.df=nx,a.dg=function(o,e){return o.readFields(YE,{icons:[]},e)},a.dh=b_,a.di=gg,a.dj=$0,a.dk=Rl,a.dl=Cp,a.dm=rl,a.dn=nl,a.dp=Li,a.dq=function(o){const e=o.indexOf(ch);return e>=0?o.slice(0,e):o},a.dr=function(o){return o.indexOf(ch)>=0},a.ds=function(o){const e=o.lastIndexOf(ch);return e>=0?o.slice(e+1):""},a.dt=function(o){const e=[],n=o.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.du=function(o,e,n,l){return o.type==="custom"?new $E(o,e):new XE[o.type](o,e,n,l)},a.dv=wi,a.dw=function(o){const e=o.indexOf(ch);return e>=0?o.slice(e+1):""},a.dx=class extends _m{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},a.dy=_f,a.dz=la,a.e=Yn,a.e$=Fe,a.e0=Yy,a.e1=(o,e,n,l,p,y)=>{const b=o.transform,T=b.projection.name==="globe";let P;if(y.paint.get("circle-pitch-alignment")==="map")if(T){const F=Xp(b.zoom,e.canonical)*b._pixelsPerMercatorPixel;P=Float32Array.from([F,0,0,F])}else P=b.calculatePixelsToTileUnitsMatrix(n);else P=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(b.projection),u_matrix:o.translatePosMatrix(e.projMatrix,n,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ka.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:o0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(T){I.u_inv_rot_matrix=l,I.u_merc_center=p,I.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],I.u_zoom_transition=wu(b.zoom);const F=p[0]*$t,B=p[1]*$t;I.u_up_dir=b.projection.upVector(new wl(0,0,0),F,B)}return I},a.e2=Tv,a.e3=xa,a.e4=(o,e,n,l,p,y,b,T,P,I)=>{const F=o.transform,B=F.pitch<15?wv(.07,.7,Oe((14-F.zoom)/5,0,1)):.07,N=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Sv(o,e,n,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:F.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_width_scale:y,u_floor_width_scale:b,u_image:0,u_tile_units_to_pixels:Ev(e,F),u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:n.lut).toArray01(),u_zbias_factor:B,u_tile_to_meter:Lt(e.tileID.canonical,0),u_ground_shadow_factor:P,u_pattern_transition:I}},a.e5=(o,e,n,l,p,y,b,T,P,I)=>{const F=o.transform,B=F.calculatePixelsToTileUnitsMatrix(e),N=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",H=F.pitch<15?wv(.07,.7,Oe((14-F.zoom)/5,0,1)):.07;return{u_matrix:Sv(o,e,n,l),u_pixels_to_tile_units:B,u_device_pixel_ratio:y,u_width_scale:b,u_floor_width_scale:T,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:Av(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ev(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:P,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:n.lut).toArray01(),u_zbias_factor:H,u_tile_to_meter:Lt(e.tileID.canonical,0),u_ground_shadow_factor:I}},a.e6=It,a.e7=Lf,a.e8=nt,a.e9=Eh,a.eA=function(o,e){var n=2*Math.acos(e[3]),l=Math.sin(n/2);return l>k?(o[0]=e[0]/l,o[1]=e[1]/l,o[2]=e[2]/l):(o[0]=1,o[1]=0,o[2]=0),n},a.eB=ox,a.eC=R_,a.eD=C_,a.eE=[1,1,1],a.eF=vg,a.eG=Un,a.eH=function(o,e,n,l){var p=e[0],y=e[1],b=e[2],T=e[3];return o[0]=p+l*(n[0]-p),o[1]=y+l*(n[1]-y),o[2]=b+l*(n[2]-b),o[3]=T+l*(n[3]-T),o},a.eI=dg,a.eJ=io,a.eK=Rc,a.eL=function(o,e,n,l,p,y,b,T,P,I,F,B,N,H,W,ne){var ue=new O(16);return ue[0]=o,ue[1]=e,ue[2]=n,ue[3]=l,ue[4]=p,ue[5]=y,ue[6]=b,ue[7]=T,ue[8]=P,ue[9]=I,ue[10]=F,ue[11]=B,ue[12]=N,ue[13]=H,ue[14]=W,ue[15]=ne,ue},a.eM=Ue,a.eN=gu,a.eO=ph,a.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Pt(1/0,1/0),max:new Pt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const n=x(new Pt(0,0),new Pt($t,$t),o),l=[];if(e&&!Gf(n,this._globalClipBounds))return l;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Gf(n,p))continue;const y=C(p.min,p.max,o);l.push({min:y.min,max:y.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return l}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const l of e.cache.getVisibleCoordinates()){const p=e.cache.getTile(l).buckets[e.layer];p&&p.updateFootprints(l.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const n=o.getOrder(),l=o.getClipMask(),p=o.getClipScope();for(const y of e){if(!y.footprint)continue;const b=x(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:n,clipMask:l,clipScope:p})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||um(e.min,n.min)||um(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||(function(l,p){const y=(b,T)=>b+T;return l.length-p.length||l.reduce(y,"").localeCompare(p.reduce(y,""))})(e.clipScope,n.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const n=this._activeRegions[e],l=this._prevRegions[e];o=n.priority!==l.priority||!__(n,l)||n.order!==l.order||n.clipMask!==l.clipMask||!ga(n.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(o){++this._updateTime;for(const n of this._activeRegions)n.order!==Uf&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const l=this._activeRegions;if(n>=l.length)return n;const p=l[n].priority;for(;n<l.length&&l[n].priority===p;)++n;return n};if(this._sourceIds.length>1){let n=0,l=e(n);for(;n!==l;){let p=n;const y=n;for(;p!==l;){const b=this._activeRegions[p];b.hiddenByOverlap=!1;for(let T=0;T<y;T++){const P=this._activeRegions[T];if(!P.hiddenByOverlap&&b.order===Uf&&Gf(b,P)&&(b.hiddenByOverlap=q(b.footprint,b.tileId,P.footprint,P.tileId),b.hiddenByOverlap))break}++p}n=l,l=e(n)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},a.eQ=Uf,a.eR=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const n=new Xl,l=new qn,p=[],y=o+1+2,b=e[0]+1,T=e[0]+1+(1+e.length),P=(I,F,B)=>{let N=I===y-1?I-2:I===0?I:I-1;return N+=B?24575:0,[N,F]};for(let I=0;I<y;++I)n.emplaceBack(...P(I,0,!0));for(let I=0;I<b;++I)for(let F=0;F<y;++F)n.emplaceBack(...P(F,I,(F===0||F===y-1)&&!0));for(let I=0;I<e.length;++I){const F=e[I];for(let B=0;B<y;++B)n.emplaceBack(...P(B,F,!0))}for(let I=0;I<e.length;++I){const F=l.length,B=e[I]+1+2,N=new qn;for(let ne=0;ne<B-1;ne++){const ue=ne===B-2,ae=ue?y*(T-e.length+I-ne):y;for(let fe=0;fe<y-1;fe++){const ye=ne*y+fe;ne===0||ue||fe===0||fe===y-2?(N.emplaceBack(ye+1,ye,ye+ae),N.emplaceBack(ye+ae,ye+ae+1,ye+1)):(l.emplaceBack(ye+1,ye,ye+ae),l.emplaceBack(ye+ae,ye+ae+1,ye+1))}}const H=$r.simpleSegment(0,F,n.length,l.length-F);for(let ne=0;ne<N.uint16.length;ne+=3)l.emplaceBack(N.uint16[ne],N.uint16[ne+1],N.uint16[ne+2]);const W=$r.simpleSegment(0,F,n.length,l.length-F);p.push({withoutSkirts:H,withSkirts:W})}return{vertices:n,indices:l,segments:p}}_createGrid(o){const e=this._fillGridMeshWithLods(ge,Ce);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,jg.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new qn;for(let b=0;b<=ge;b++)e.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const n=new Cc,l=new Cc,p=new Cc,y=new Cc;this._poleSegments=[];for(let b=0,T=0;b<5;b++){const P=360/(1<<b);n.emplaceBack(0,-de,0,.5,0),l.emplaceBack(0,-de,0,.5,1),p.emplaceBack(0,-de,0,.5,.5),y.emplaceBack(0,-de,0,.5,.5);for(let I=0;I<=ge;I++){let F=I/ge,B=0;const N=Ri(0,P,F),[H,W,ne]=Ge(a0,Xy,N,de);n.emplaceBack(H,W,ne,F,B),l.emplaceBack(H,W,ne,F,1-B);const ue=tr(N);F=.5+.5*Math.sin(ue),B=.5+.5*Math.cos(ue),p.emplaceBack(H,W,ne,F,B),y.emplaceBack(H,W,ne,F,1-B)}this._poleSegments.push($r.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(n,Sh,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,Sh,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(p,Sh,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(y,Sh,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},a.eS=ly,a.eT=De,a.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eV=qe,a.eW=bt,a.eX=function(o,e,n){return o[0]=e[0]/n[0],o[1]=e[1]/n[1],o[2]=e[2]/n[2],o},a.eY=Xr,a.eZ=je,a.e_=bi,a.ea=tc,a.eb=Px,a.ec=ir,a.ed=450,a.ee=7,a.ef=ot,a.eg=function(o,e){if(o===e){var n=e[1],l=e[2],p=e[3],y=e[6],b=e[7],T=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=n,o[6]=e[9],o[7]=e[13],o[8]=l,o[9]=y,o[11]=e[14],o[12]=p,o[13]=b,o[14]=T}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},a.eh=GE,a.ei=Xi,a.ej=zp,a.ek=256,a.el=Ur,a.em=to,a.en=Se,a.eo=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},a.ep=Cc,a.eq=xp,a.er=fh,a.es=function(o,e,n,l,p){return Oe((o-e)/(n-e)*(p-l)+l,l,p)},a.et=sa,a.eu=function(o,e){var n=e[0],l=e[1],p=e[2],y=e[3],b=e[4],T=e[5],P=e[6],I=e[7],F=e[8],B=F*b-T*I,N=-F*y+T*P,H=I*y-b*P,W=n*B+l*N+p*H;return W?(o[0]=B*(W=1/W),o[1]=(-F*l+p*I)*W,o[2]=(T*l-p*b)*W,o[3]=N*W,o[4]=(F*n-p*P)*W,o[5]=(-T*n+p*y)*W,o[6]=H*W,o[7]=(-I*n+l*P)*W,o[8]=(b*n-l*y)*W,o):null},a.ev=2,a.ew=zi,a.ex=Rn,a.ey=qt,a.ez=function(o,e){var n=new O(3);qt(n,e);var l=1/n[0],p=1/n[1],y=1/n[2],b=e[0]*l,T=e[1]*p,P=e[2]*y,I=e[4]*l,F=e[5]*p,B=e[6]*y,N=e[8]*l,H=e[9]*p,W=e[10]*y,ne=b+F+W,ue=0;return ne>0?(ue=2*Math.sqrt(ne+1),o[3]=.25*ue,o[0]=(B-H)/ue,o[1]=(N-P)/ue,o[2]=(T-I)/ue):b>F&&b>W?(ue=2*Math.sqrt(1+b-F-W),o[3]=(B-H)/ue,o[0]=.25*ue,o[1]=(T+I)/ue,o[2]=(N+P)/ue):F>W?(ue=2*Math.sqrt(1+F-b-W),o[3]=(N-P)/ue,o[0]=(T+I)/ue,o[1]=.25*ue,o[2]=(B+H)/ue):(ue=2*Math.sqrt(1+W-b-F),o[3]=(T-I)/ue,o[0]=(N+P)/ue,o[1]=(B+H)/ue,o[2]=.25*ue),o},a.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},a.f0=function([o,e,n]){const l=Math.hypot(o,e,n),p=Math.atan2(o,n),y=.5*Math.PI-Math.acos(-e/l);return new Pe(Je(p),Je(y))},a.f1=os,a.f2=A0,a.f3=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(n){if(rr==null){const l=n.navigator?n.navigator.userAgent:null;rr=!!n.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return rr})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.f4=function(o,e){np=o,Ud=e},a.f5=Md,a.f6=Xm,a.f7=function(o){const e=[0,0,0],n=le(new Float64Array(16));return se(n,o.pixelMatrix,o.globeMatrix),Ui(e,e,n),new Pt(e[0],e[1])},a.f8=function(){const o=hy;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(y0),hy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.f9=function(){b_().acquire(y0)},a.fA=J_,a.fB=Yi,a.fC=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==Jx){const n=new Uint32Array(o,0,7),[,,l,p,y,b]=n;e=n.byteLength+p+y+b+y,(l!==o.byteLength||e>=o.byteLength)&&Pi("Invalid b3dm header information.")}return rv(o,e)},a.fD=function(o,e){const n=I0(o);for(const l of n){for(const p of l.meshes)xw(p);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(bw(l.lights,e)))}return n},a.fE=Z_,a.fF=wn,a.fG=Ux,a.fH=Fa,a.fI=fa,a.fJ=function(o){cs(),xs!=null&&xs.then(e=>{e.keys().then(n=>{for(let l=0;l<n.length-o;l++)e.delete(n[l]).catch(p=>Pi(p.message))}).catch(n=>Pi(n.message))}).catch(e=>Pi(e.message))},a.fa=Ec,a.fb=function(o,e,n=!1){if(ea===fa.deferred||ea===fa.loading||ea===fa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zl=ka.resolveURL(o),ea=fa.deferred,Wl=e,Rp(),n||xf()},a.fc=function(o){cg=ka.resolveURL(o),ug||(ug=new lg(b_(),new Pl)),ug.broadcast("setMeshoptUrl",cg)},a.fd=Hx,a.fe=function(o){v0=ka.resolveURL(o),ug||(ug=new lg(b_(),new Pl)),ug.broadcast("setDracoUrl",v0)},a.ff=$x,a.fg=uy,a.fh=function(o){const e=uo();if(!e)return;const n=e.delete(Am);o&&n.then(()=>o()).catch(o)},a.fi=dm,a.fj=Ut,a.fk=Ic,a.fl=2,a.fm=xb,a.fn=vb,a.fo=_v,a.fp=er,a.fq="hd_road_elevation",a.fr=Ms,a.fs=yi,a.ft=Dc,a.fu=G0,a.fv=1,a.fw=function(o,e,n,l,p,y,b,T=1,P,I,F,B){o.createArrays(),o.tilePixelRatio=$t/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const N=o.layers[0].layout,H=o.layers[0]._unevaluatedLayout._values,W={};W.scaleFactor=T,W.textSizeScaleRange=N.get("text-size-scale-range"),W.iconSizeScaleRange=N.get("icon-size-scale-range");const[ne,ue]=W.textSizeScaleRange,[ae,fe]=W.iconSizeScaleRange;W.textScaleFactor=Oe(W.scaleFactor,ne,ue),W.iconScaleFactor=Oe(W.scaleFactor,ae,fe);const ye=H["text-size"],be=H["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:He,maxZoom:Ye}=o.textSizeData;W.compositeTextSizes=[ye.possiblyEvaluate(new xr(He,{worldview:F}),y),ye.possiblyEvaluate(new xr(Ye,{worldview:F}),y)]}if(o.iconSizeData.kind==="composite"){const{minZoom:He,maxZoom:Ye}=o.iconSizeData;W.compositeIconSizes=[be.possiblyEvaluate(new xr(He,{worldview:F}),y,B),be.possiblyEvaluate(new xr(Ye,{worldview:F}),y,B)]}W.layoutTextSize=ye.possiblyEvaluate(new xr(b+1,{worldview:F}),y),W.layoutIconSize=be.possiblyEvaluate(new xr(b+1,{worldview:F}),y,B),W.textMaxSize=ye.possiblyEvaluate(new xr(18,{worldview:F}),y);const Ie=N.get("symbol-placement"),Re=N.get("text-rotation-alignment")==="map"&&Ie!=="point",Ne=N.get("text-size");let Ve=!1;const Be=[];for(const He of o.features){const Ye=N.get("text-font").evaluate(He,{},y).join(","),yt=Ne.evaluate(He,{},y)*W.textScaleFactor,ft=W.layoutTextSize.evaluate(He,{},y)*W.textScaleFactor,gt=W.layoutIconSize.evaluate(He,{},y,B)*W.iconScaleFactor,Tt={horizontal:{},vertical:void 0},Et=He.text;let St,ht=[0,0];if(Et){const cr=Et.toString(),zn=N.get("text-letter-spacing").evaluate(He,{},y)*Is,hr=N.get("text-line-height").evaluate(He,{},y)*Is,Rr=Nm(cr)?zn:0,Jr=N.get("text-anchor").evaluate(He,{},y),on=N.get("text-variable-anchor");if(!on){const ss=N.get("text-radial-offset").evaluate(He,{},y);if(ss)ht=e1(Jr,[ss*Is,q0]);else{const ps=N.get("text-offset").evaluate(He,{},y);ht=[ps[0]*Is,ps[1]*Is]}}let ln=Re?"center":N.get("text-justify").evaluate(He,{},y);const Fn=Ie==="point",Us=Fn?N.get("text-max-width").evaluate(He,{},y)*Is:1/0,ma=ss=>{o.allowVerticalPlacement&&yf(cr)&&(Tt.vertical=B0(Et,e,n,p,Ye,Us,hr,Jr,ss,Rr,ht,Qo.vertical,!0,ft,yt,P))};if(!Re&&on){const ss=ln==="auto"?on.map(Ts=>W0(Ts)):[ln];let ps=!1;for(let Ts=0;Ts<ss.length;Ts++){const qi=ss[Ts];if(!Tt.horizontal[qi])if(ps)Tt.horizontal[qi]=Tt.horizontal[0];else{const un=B0(Et,e,n,p,Ye,Us,hr,"center",qi,Rr,ht,Qo.horizontal,!1,ft,yt,P);un&&(Tt.horizontal[qi]=un,ps=un.positionedLines.length===1)}}ma("left")}else{if(ln==="auto"&&(ln=W0(Jr)),Fn||N.get("text-writing-mode").indexOf("horizontal")>=0||!yf(cr)){const ss=B0(Et,e,n,p,Ye,Us,hr,Jr,ln,Rr,ht,Qo.horizontal,!1,ft,yt,P);ss&&(Tt.horizontal[ln]=ss)}ma(Fn?"left":ln)}}let Rt,vt,Mt,At,ti,ri,Zt=!1;const Kt=N.get("icon-text-fit").evaluate(He,{},y);if(He.icon&&He.icon.hasPrimary()){const cr=by(He.icon,o.iconSizeData,H["icon-size"],y,o.zoom,He,P,W.iconScaleFactor,F,B);Rt=cr.iconPrimary,Mt=cr.iconSecondary;const zn=Rt.toString();if(vt=l.get(zn),vt&&(ti=N.get("icon-offset").evaluate(He,{},y),ri=N.get("icon-anchor").evaluate(He,{},y),St=k_(p.get(zn),Mt?p.get(Mt.toString()):void 0,ti,ri),Zt=vt.sdf,o.sdfIcons===void 0?o.sdfIcons=vt.sdf:o.sdfIcons!==vt.sdf&&Pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(vt.pixelRatio!==o.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),Mt){const hr=Mt.toString();At=l.get(hr)}}Ve=Ve||!(!He.icon||!He.icon.hasSecondary());const Ei=B_(Tt.horizontal)||Tt.vertical;o.iconsInText||(o.iconsInText=!!Ei&&Ei.iconsInText);const pi=ft*W.textScaleFactor/Is,{defaultShapedIcon:ei,verticallyShapedIcon:ki}=ME(o,St,N,He,y,Tt,pi,ti,Kt);Kt!=="none"&&St&&(Bv(St)||jv(St))&&(F_(0,vt,Rt,St,ei,Kt,I,l,p),F_(0,At,Mt,St,ei,Kt,I,l,p),ki&&(F_(0,vt,Rt,St,ki,Kt,I,l,p),F_(0,At,Mt,St,ki,Kt,I,l,p))),St=ei;const{iconBBox:Qi,iconVerticalBBox:yr,textBBox:Wi,textVerticalBBox:Ir}=SE(o,St,ki,N,He,y,gt,ti,W,p,ri,Tt,ft,ht,B);Be.push({feature:He,shapedTextOrientations:Tt,shapedText:Ei,shapedIcon:St,iconPrimary:Rt,iconSecondary:Mt,iconOffset:ti,iconAnchor:ri,verticallyShapedIcon:ki,layoutTextSize:ft,layoutIconSize:gt,textOffset:ht,isSDFIcon:Zt,iconTextFit:Kt,iconCollisionBounds:Qi,iconVerticalCollisionBounds:yr,textCollisionBounds:Wi,textVerticalCollisionBounds:Ir})}return{featureData:Be,sizes:W,hasAnySecondaryIcon:Ve,textAlongLine:Re,symbolPlacement:Ie}},a.fx=Wv,a.fy=function(o,e,n,l,p,y,b,T,P,I){o.iconAtlasPositions=I.iconPositions;const{featureData:F,hasAnySecondaryIcon:B,sizes:N,textAlongLine:H,symbolPlacement:W}=e;for(const ne of F){const{shapedIcon:ue,verticallyShapedIcon:ae,feature:fe,shapedTextOrientations:ye,shapedText:be,layoutTextSize:Ie,textOffset:Re,isSDFIcon:Ne,iconPrimary:Ve,iconSecondary:Be,iconTextFit:He,iconOffset:Ye,iconCollisionBounds:yt,iconVerticalCollisionBounds:ft,textCollisionBounds:gt}=ne;n1(ue,I.iconPositions,Ve,Be),n1(ae,I.iconPositions,Ve,Be),RE(ye,I.iconPositions),CE(Ve,Be,I.iconPositions),(be||ue)&&PE(o,fe,ye,ue,ae,P,N,Ie,0,Re,Ne,l,p,b,T,B,He,Ye,H,W,yt,ft,gt)}n&&o.generateCollisionDebugBuffers(y,o.collisionBoxArray,N.textScaleFactor)},a.fz=sr,a.g=function(o,e){return la(Object.assign(o,{method:"GET"}),e)},a.h=function(o){return o.indexOf("mapbox:")===0},a.i=function(o){return Yn.API_STYLE_REGEX.test(o)&&!zs(o)},a.j=il,a.k=sc,a.l=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.m=function(o,e){return la(Object.assign(o,{type:"json"}),e)},a.n=Bh,a.o=ka,a.p=function(o,e){return la(Object.assign(o,{method:"POST"}),e)},a.q=Ss,a.r=co,a.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=function(){return _0||(_0=new dm("ImageRasterizer")),_0},a.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},a.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},a.w=Pi,a.x=dx,a.y=zu,a.z=mo}),S(["./shared"],function(a){function k(Je){const me=Je?Je.url.toString():void 0;return me?performance.getEntriesByName(me):[]}function O(Je){if(typeof Je=="number"||typeof Je=="boolean"||typeof Je=="string"||Je==null)return JSON.stringify(Je);if(Array.isArray(Je)){let ve="[";for(const De of Je)ve+=`${O(De)},`;return`${ve}]`}let me="{";for(const ve of Object.keys(Je).sort())me+=`${ve}:${O(Je[ve])},`;return`${me}}`}function j(Je){let me="";for(const ve of a.bx)me+=`/${O(Je[ve])}`;return me}function V(Je,me){return(function ve(De){return typeof De=="string"&&De===me||(Array.isArray(De)?De.some(ve):!(!De||typeof De!="object")&&Object.values(De).some(ve))})(Je)}class G{constructor(me){this.keyCache={},this._layers={},this._layerConfigs={},me&&this.replace(me)}replace(me,ve){this._layerConfigs={},this._layers={},this.update(me,[],ve)}update(me,ve,De){this._options=De;for(const Oe of me)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=a.du(Oe,this.scope,null,this._options)).compileFilter(De),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of ve)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const qe=(function(Oe,Ke){const ut={};for(let dt=0;dt<Oe.length;dt++){const Ft=Oe[dt];let It=Ke&&Ke[Ft.id];It||(Ft.type==="symbol"?It=Ft.id:(It=j(Ft),Ft.type==="line"&&Ft.paint&&V(Ft.paint["line-width"],"line-progress")&&(It+=`/${O(Ft.paint["line-width"])}`))),Ke&&(Ke[Ft.id]=It);let ii=ut[It];ii||(ii=ut[It]=[]),ii.push(Ft)}const et=[];for(const dt in ut)et.push(ut[dt]);return et})(Object.values(this._layerConfigs),this.keyCache);for(const Oe of qe){const Ke=Oe.map(ii=>this._layers[ii.id]),ut=Ke[0];if(ut.visibility==="none")continue;const et=ut.source||"";let dt=this.familiesBySource[et];dt||(dt=this.familiesBySource[et]={});const Ft=ut.sourceLayer||"_geojsonTileLayer";let It=dt[Ft];It||(It=dt[Ft]=[]),It.push(Ke)}}}const J=1*a.fl;class Z{constructor(me){const ve={},De=[];for(const ut in me){const et=me[ut],dt=ve[ut]={};for(const Ft in et.glyphs){const It=et.glyphs[+Ft];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const ii=It.metrics.localGlyph?J:1,yi={x:0,y:0,w:It.bitmap.width+2*ii,h:It.bitmap.height+2*ii};De.push(yi),dt[Ft]=yi}}const{w:qe,h:Oe}=a.G(De),Ke=new a.fk({width:qe||1,height:Oe||1});for(const ut in me){const et=me[ut];for(const dt in et.glyphs){const Ft=et.glyphs[+dt];if(!Ft||Ft.bitmap.width===0||Ft.bitmap.height===0)continue;const It=ve[ut][dt],ii=Ft.metrics.localGlyph?J:1;a.fk.copy(Ft.bitmap,Ke,{x:0,y:0},{x:It.x+ii,y:It.y+ii},Ft.bitmap)}}this.image=Ke,this.positions=ve}}function Y(Je,me,ve){Je[me]?ve&&(Je[me].center=ve):Je[me]={floorIds:new Set,center:ve||[0,0],floors:{}}}function le(Je,me,ve,De){for(const qe of me)Y(Je,qe),Je[qe].floors[ve]=De,Je[qe].floorIds.add(ve)}function ee(Je){return{id:Je.properties.id.toString(),center:Je.properties.center.toString().split(";").map(Number)}}function se(Je){return{id:Je.properties.id.toString(),isDefault:!!Je.properties.is_default&&Je.properties.is_default,connections:Je.properties.connected_floor_ids?new Set(Je.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Je.properties.conflicted_floor_ids?new Set(Je.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Je.properties.building_ids?new Set(Je.properties.building_ids.toString().split(";")):new Set,name:Je.properties.name.toString(),zIndex:Je.properties.z_index}}function Q(Je,me){return me.every(ve=>Je.properties&&Je.properties[ve]!=null)}function oe(Je){return Q(Je,["type","id","name"])&&Je.properties.type==="building"}function _e(Je){return Q(Je,["type","id","name","z_index"])&&Je.properties.type==="floor"}a.fj(Z,"GlyphAtlas");class Se{constructor(me){this.tileID=new a.aQ(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.lut=me.lut,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.scope=me.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=me.showCollisionBoxes,this.collectResourceTiming=!!me.request&&me.request.collectResourceTiming,this.promoteId=me.promoteId,this.isSymbolTile=me.isSymbolTile,this.tileTransform=a.aZ(me.tileID.canonical,me.projection),this.projection=me.projection,this.worldview=me.worldview,this.localizableLayerIds=me.localizableLayerIds,this.brightness=me.brightness,this.extraShadowCaster=!!me.extraShadowCaster,this.tessellationStep=me.tessellationStep,this.scaleFactor=me.scaleFactor,this.worldview=me.worldview,this.indoor=me.indoor}parse(me,ve,De,qe,Oe,Ke){this.status="parsing",this.data=me,this.collisionBoxArray=new a.b3;const ut=new a.fm(Object.keys(me.layers).sort()),et=new a.fn(this.tileID,this.promoteId);et.bucketLayerIDs=[];const dt={},Ft=new a.fo(256,256),It={featureIndex:et,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ft,availableImages:De,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Li=this.indoor.indoorState.activeFloorsVisible,Vi=(function(xi,Pi,Fr){const fn=(function(qr,rr){if(!qr)return a.w("No source layers defined in indoor specification"),rr;if(qr.size===0)return rr;const Yr=qr.difference(rr);for(const Ar of Yr)a.w(`Missing source layer required in indoor specification: ${Ar}`);return rr.intersection(rr)})(Pi.sourceLayers,new Set(Object.keys(xi.layers))),Wr=Pi.indoorState,wn=(function(qr,rr,Yr,Ar){const Cr=new Set,Br=new Set,pn=new Set,ls=new Map,Yn={},il=zs=>{const Ws=ls.get(zs)||new Set;for(const lo of Cr)if((ls.get(lo)||new Set).has(zs)||Ws.has(lo))return!0;return!1};for(const zs of rr){const Ws=qr.layers[zs];if(Ws)for(let lo=0;lo<Ws.length;lo++){const ts=Ws.feature(lo);if(oe(ts)){const{id:oa,center:Zs}=ee(ts);Y(Yn,oa,Zs),Cr.add(oa);continue}if(_e(ts)){const{id:oa,isDefault:Zs,connections:Mo,conflicts:co,buildings:ka,name:Du,zIndex:rl}=se(ts);le(Yn,ka,oa,{name:Du,zIndex:rl}),ls.set(oa,co),(oa===Ar||Mo.has(Ar))&&Cr.add(oa),Br.add(oa),Zs&&pn.add(oa)}}else a.w(`indoor source layer not found: ${zs}`)}if(Yr)for(const zs of Yr)Br.has(zs)&&(il(zs)||Cr.add(zs));for(const zs of pn)Cr.has(zs)||il(zs)||Cr.add(zs);return{buildings:Yn,activeFloors:Cr}})(xi,fn,Wr.lastActiveFloors,Wr.selectedFloorId);return Fr.send("setIndoorData",wn),wn})(me,this.indoor,Oe);It.activeFloors=Li?Vi.activeFloors:void 0}const ii=[],yi=ve.familiesBySource[this.source];for(const Li in yi){const Vi=me.layers[Li];if(!Vi)continue;let xi=!1,Pi=!1,Fr=!1;for(const rr of yi[Li])rr[0].type==="symbol"?xi=!0:Pi=!0,rr[0].is3D()&&rr[0].type!=="model"&&(Fr=!0);if(this.extraShadowCaster&&!Fr||this.isSymbolTile===!0&&!xi||this.isSymbolTile===!1&&!Pi)continue;Vi.version===1&&a.w(`Vector tile source "${this.source}" layer "${Li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fn=ut.encode(Li),Wr=[],wn=this.localizableLayerIds&&this.localizableLayerIds.has(Li);let qr=!1;for(let rr=0,Yr=0;rr<Vi.length;rr++){const Ar=Vi.feature(rr),Cr=et.getId(Ar,Li),Br=Ar.properties?Ar.properties.worldview:null;if(wn&&this.worldview&&typeof Br=="string")if(Br==="all")Ar.properties.$localized=!0;else{if(!Br.split(",").includes(this.worldview))continue;Ar.properties.$localized=!0,Ar.properties.worldview=this.worldview}!qr&&Ar.properties&&Ar.properties.hasOwnProperty(a.fp)&&(qr=!0),Wr.push({feature:Ar,id:Cr,index:Yr,sourceLayerIndex:fn}),Yr++}qr&&!It.elevationFeatures&&me.layers.hasOwnProperty(a.fq)&&(It.elevationFeatures=a.fr.parseFrom(me.layers[a.fq],this.canonical));for(const rr of yi[Li]){const Yr=rr[0];if(this.extraShadowCaster&&(!Yr.is3D()||Yr.type==="model")||this.isSymbolTile!==void 0&&Yr.type==="symbol"!==this.isSymbolTile||Yr.minzoom&&this.zoom<Math.floor(Yr.minzoom)||Yr.maxzoom&&this.zoom>=Yr.maxzoom||Yr.visibility==="none")continue;ke(rr,this.zoom,It.brightness,De,this.worldview);const Ar=dt[Yr.id]=Yr.createBucket({index:et.bucketLayerIDs.length,layers:rr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:qe,worldview:this.worldview,localizable:wn,availableImages:De});et.bucketLayerIDs.push(rr.map(Br=>a.B(Br.id,Br.scope)));let Cr=Ar.prepare?Ar.prepare():null;Cr!=null?(Cr=Cr.then(()=>Ar.populate(Wr,It,this.tileID.canonical,this.tileTransform)),ii.push(Cr)):Ar.populate(Wr,It,this.tileID.canonical,this.tileTransform)}}const wi=()=>{let Li,Vi,xi,Pi,Fr,fn;Ft.trim();const Wr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},wn=()=>{if(Li)return this.status="done",Ke(Li);if(this.extraShadowCaster)this.status="done",Ke(null,{buckets:Object.values(dt).filter(rr=>!rr.isEmpty()),featureIndex:et,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:It.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vi&&xi&&Pi){const rr=new Z(Vi),Yr=new Map;for(const[Br,pn]of xi.entries()){const{imagePosition:ls}=a.fu(Br,pn,a.fv);Yr.set(Br,ls)}const Ar={};for(const Br in dt){const pn=dt[Br];pn instanceof a.b4&&(ke(pn.layers,this.zoom,It.brightness,De,this.worldview),Ar[Br]=a.fw(pn,Vi,rr.positions,xi,Yr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Fr,this.worldview,De))}const Cr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Oe,xi,Fr,()=>{Cr.iconsPending=!1,qr(Ar,rr,Cr)}),this.rasterizeIfNeeded(Oe,Pi,fn,()=>{Cr.patternsPending=!1,qr(Ar,rr,Cr)})}},qr=(rr,Yr,Ar,Cr)=>{if(Ar.iconsPending||Ar.patternsPending)return;const Br=new a.fx(xi,Pi,this.lut);for(const pn in dt){const ls=dt[pn];if(pn in rr)a.fy(ls,rr[pn],this.showCollisionBoxes,De,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,xi,Br);else if(ls.hasPattern&&(ls instanceof a.ba||ls instanceof a.bb||ls instanceof a.ea)){ke(ls.layers,this.zoom,It.brightness,De,this.worldview);const Yn=Object.fromEntries(Br.patternPositions);ls.addFeatures(It,this.tileID.canonical,Yn,De,this.tileTransform,this.brightness)}}this.status="done",Ke(null,{buckets:Object.values(dt).filter(pn=>!pn.isEmpty()),featureIndex:et,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yr.image,lineAtlas:Ft,imageAtlas:Br,brightness:It.brightness})};if(!this.extraShadowCaster){const rr=a.fs(It.glyphDependencies,Cr=>Object.keys(Cr).map(Number));Object.keys(rr).length?Oe.send("getGlyphs",{uid:this.uid,stacks:rr},(Cr,Br)=>{Li||(Li=Cr,Vi=Br,wn())},void 0,!1,Wr):Vi={};const Yr=Array.from(It.iconDependencies.keys()).map(Cr=>a.I.parse(Cr));Yr.length?Oe.send("getImages",{images:Yr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Cr,Br)=>{Li||(Li=Cr,xi=new Map,Fr=this.updateImageMapAndGetImageTaskQueue(xi,Br,It.iconDependencies),wn())},void 0,!1,Wr):(xi=new Map,Fr=new Map);const Ar=Array.from(It.patternDependencies.keys()).map(Cr=>a.I.parse(Cr));Ar.length?Oe.send("getImages",{images:Ar,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Cr,Br)=>{Li||(Li=Cr,Pi=new Map,fn=this.updateImageMapAndGetImageTaskQueue(Pi,Br,It.patternDependencies),wn())},void 0,!1,Wr):(Pi=new Map,fn=new Map)}if(It.elevationFeatures&&It.elevationFeatures.length>0){const rr=[];for(const Ar of Object.values(dt))if(Ar instanceof a.bb){const Cr=Ar.getUnevaluatedPortalGraph();Cr&&rr.push(Cr)}const Yr=a.ft.evaluate(rr);for(const Ar of Object.values(dt))if(Ar instanceof a.bb){const Cr=me.layers[ut.decode(Ar.sourceLayerIndex)];Ar.setEvaluatedPortalGraph(Yr,Cr,this.tileID.canonical,It.availableImages,It.brightness)}}wn()};ii.length>0?Promise.allSettled(ii).then(wi).catch(Ke):wi()}updateParameters(me){this.scaleFactor=me.scaleFactor,this.showCollisionBoxes=me.showCollisionBoxes,this.projection=me.projection,this.brightness=me.brightness,this.tileTransform=a.aZ(me.tileID.canonical,me.projection),this.extraShadowCaster=me.extraShadowCaster,this.lut=me.lut,this.worldview=me.worldview,this.indoor=me.indoor}rasterizeIfNeeded(me,ve,De,qe){Array.from(ve.values()).some(Oe=>Oe.usvg)?this.rasterize(me,ve,De,qe):qe()}updateImageMapAndGetImageTaskQueue(me,ve,De){const qe=new Map;for(const Oe of ve.keys()){const Ke=De.get(Oe)||[];for(const ut of Ke){const et=ut.toString(),dt=ve.get(ut.id.toString());dt.usvg?qe.has(et)||(qe.set(et,ut),me.set(et,Object.assign({},dt))):me.set(et,dt)}}return qe}rasterize(me,ve,De,qe){this.rasterizeTask=me.send("rasterizeImages",{scope:this.scope,tasks:De},(Oe,Ke)=>{if(!Oe)for(const[ut,et]of Ke.entries()){const dt=Object.assign(ve.get(ut),{data:et});ve.set(ut,dt)}qe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ke(Je,me,ve,De,qe){const Oe=new a.ac(me,{brightness:ve,worldview:qe});for(const Ke of Je)Ke.recalculate(Oe,De)}class Le extends a.E{constructor(me,ve,De,qe,Oe,Ke,ut){super(),this.actor=me,this.layerIndex=ve,this.availableImages=De,this.availableModels=qe,this.loadVectorData=Ke||a.aL,this.loading={},this.loaded={},this.deduped=new a.aK(me.scheduler),this.isSpriteLoaded=Oe,this.scheduler=me.scheduler,this.brightness=ut}loadTile(me,ve){const De=me.uid,qe=me&&me.request,Oe=qe&&qe.collectResourceTiming,Ke=this.loading[De]=new Se(me);Ke.abort=this.loadVectorData(me,(ut,et)=>{const dt=!this.loading[De];if(delete this.loading[De],Ke.cancelRasterize(),dt||ut||!et)return Ke.status="done",dt||(this.loaded[De]=Ke),ve(ut);const Ft=et.rawData,It={},ii=a.aM(et.responseHeaders);ii&&ii.expires&&(It.expires=ii.expires),ii&&ii.cacheControl&&(It.cacheControl=ii.cacheControl),Ke.vectorTile=et.vectorTile||new a.fz(new a.bt(Ft));const yi=()=>{Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(wi,Li)=>{if(wi||!Li)return ve(wi);const Vi={};if(Oe){const xi=k(qe);xi.length>0&&(Vi.resourceTiming=JSON.parse(JSON.stringify(xi)))}ve(null,Object.assign({rawTileData:Ft.slice(0),responseHeaders:et.responseHeaders},Li,It,Vi))})};this.isSpriteLoaded?yi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yi,{type:"parseTile",isSymbolTile:me.isSymbolTile,zoom:me.tileZoom}):yi()}),this.loaded=this.loaded||{},this.loaded[De]=Ke})}reloadTile(me,ve){const De=this.loaded,qe=me.uid;if(De&&De[qe]){const Oe=De[qe];Oe.updateParameters(me);const Ke=(ut,et)=>{const dt=Oe.reloadCallback;dt&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,dt)),ve(ut,et)};Oe.status==="parsing"?Oe.reloadCallback=Ke:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ke):Ke())}else ve(null,void 0)}abortTile(me,ve){const De=me.uid,qe=this.loading[De];qe&&(qe.abort&&qe.abort(),delete this.loading[De]),ve()}removeTile(me,ve){const De=this.loaded,qe=me.uid;De&&De[qe]&&delete De[qe],ve()}}class lt{loadTile(me,ve){const{uid:De,encoding:qe,rawImageData:Oe,padding:Ke}=me,ut=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,Ke):Oe;ve(null,new a.fA(De,ut,qe,Ke<1))}reloadTile(me,ve){ve(null,null)}abortTile(me,ve){ve()}removeTile(me,ve){ve()}getImageData(me,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(me.width,me.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=me.width,this.offscreenCanvas.height=me.height,this.offscreenCanvasContext.drawImage(me,0,0,me.width,me.height);const De=this.offscreenCanvasContext.getImageData(-ve,-ve,me.width+2*ve,me.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),De}}a.bs.setPbf(a.bt);class qt{constructor(me){this._mrt=new a.bs(me.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=me.uid,this.tileID=me.tileID,this.source=me.source}parse(me,ve){const De=this._mrt;this.status="parsing",this._entireBuffer=me;try{De.parseHeader(me),this._isHeaderLoaded=!0;const qe=[];for(const Oe in De.layers){const Ke=De.getLayer(Oe),ut=Ke.getDataRange(Ke.getBandList()),et=De.createDecodingTask(ut),dt=me.slice(ut.firstByte,ut.lastByte+1),Ft=a.bs.performDecoding(dt,et).then(It=>et.complete(null,It)).catch(It=>et.complete(It,null));qe.push(Ft)}Promise.allSettled(qe).then(()=>ve(null,De)).catch(Oe=>ve(Oe))}catch(qe){ve(qe)}}}class Yt{constructor(me){this.actor=me,this.loading={},this.loaded={}}loadTile(me,ve){const De=me.uid,qe=me.request,Oe=this.loading[De]=new qt(me),{cancel:Ke}=a.bu(qe,(ut,et,dt)=>{const Ft=!this.loading[De];if(delete this.loading[De],Ft||ut||!et)return Oe.status="done",Ft||(this.loaded[De]=Oe),ve(ut);Oe.parse(et,(It,ii)=>{if(It||!ii)return ve(It);ve(null,ii,dt)}),this.loaded[De]=Oe});Oe.abort=Ke}reloadTile(me,ve){ve(null,void 0)}abortTile(me,ve){const De=me.uid,qe=this.loading[De];qe&&(qe.abort&&qe.abort(),delete this.loading[De]),ve()}removeTile(me,ve){const De=me.uid;this.loaded[De]&&delete this.loaded[De],ve()}decodeRasterArray(me,ve){a.bs.performDecoding(me.buffer,me.task).then(De=>ve(null,De)).catch(De=>ve(De))}}const Ot=a.fB.prototype.toGeoJSON;class Bt{constructor(me){this._feature=me,this.extent=a.al,this.type=me.type,this.properties=me.tags,"id"in me&&!isNaN(me.id)&&(this.id=parseInt(me.id,10))}loadGeometry(){if(this._feature.type===1){const me=[];for(const ve of this._feature.geometry)me.push([new a.P(ve[0],ve[1])]);return me}{const me=[];for(const ve of this._feature.geometry){const De=[];for(const qe of ve)De.push(new a.P(qe[0],qe[1]));me.push(De)}return me}}toGeoJSON(me,ve,De){return Ot.call(this,me,ve,De)}}class si{constructor(me,ve){this.name=me,this.extent=a.al,this.length=ve.length,this._jsonFeatures=ve}feature(me){return new Bt(this._jsonFeatures[me])}}class kt{constructor(me){this.layers={},this.extent=a.al;for(const ve of Object.keys(me))this.layers[ve]=new si(ve,me[ve])}}const xe=64/4096;class Fe{constructor(){this.features=new Map}clear(){this.features.clear()}load(me=[],ve){for(const De of me){const qe=De.id;if(qe==null)continue;let Oe=this.features.get(qe);Oe&&this.updateCache(Oe,ve),De.geometry?(Oe=Te(De),this.updateCache(Oe,ve),this.features.set(qe,Oe)):this.features.delete(qe),this.updateCache(Oe,ve)}}updateCache(me,ve){for(const{canonical:De,uid:qe}of Object.values(ve)){const{z:Oe,x:Ke,y:ut}=De;pe(me,Math.pow(2,Oe),Ke,ut)&&delete ve[qe]}}getTile(me,ve,De){const qe=Math.pow(2,me),Oe=[];for(const Ke of this.features.values())pe(Ke,qe,ve,De)&&Oe.push(ct(Ke,qe,ve,De));return{features:Oe}}getFeatures(){return[...this.features.values()]}}function pe({minX:Je,minY:me,maxX:ve,maxY:De},qe,Oe,Ke){return Je<(Oe+1+xe)/qe&&me<(Ke+1+xe)/qe&&ve>(Oe-xe)/qe&&De>(Ke-xe)/qe}function Te(Je){const{id:me,geometry:ve,properties:De}=Je;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:qe,coordinates:Oe}=ve,Ke={id:me,type:1,geometry:[],tags:De,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ut=Ke.geometry;if(qe==="Point")st(Oe,ut,Ke);else if(qe==="MultiPoint")for(const et of Oe)st(et,ut,Ke);else if(qe==="LineString")Ke.type=2,Me(Oe,ut,Ke);else if(qe==="MultiLineString")Ke.type=2,at(Oe,ut,Ke);else if(qe==="Polygon")Ke.type=3,at(Oe,ut,Ke,!0);else{if(qe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ke.type=3;for(const et of Oe)at(et,ut,Ke,!0)}return Ke}function st([Je,me],ve,De){const qe=a.aF(Je);let Oe=a.aJ(me);Oe=Oe<0?0:Oe>1?1:Oe,ve.push(qe,Oe),De.minX=Math.min(De.minX,qe),De.minY=Math.min(De.minY,Oe),De.maxX=Math.max(De.maxX,qe),De.maxY=Math.max(De.maxY,Oe)}function Me(Je,me,ve,De=!1,qe=!1){const Oe=[];for(const Ke of Je)st(Ke,Oe,ve);me.push(Oe),De&&(function(Ke,ut){let et=0;for(let dt=0,Ft=Ke.length,It=Ft-2;dt<Ft;It=dt,dt+=2)et+=(Ke[dt]-Ke[It])*(Ke[dt+1]+Ke[It+1]);if(et>0===ut)for(let dt=0,Ft=Ke.length;dt<Ft/2;dt+=2){const It=Ke[dt],ii=Ke[dt+1];Ke[dt]=Ke[Ft-2-dt],Ke[dt+1]=Ke[Ft-1-dt],Ke[Ft-2-dt]=It,Ke[Ft-1-dt]=ii}})(Oe,qe)}function at(Je,me,ve,De=!1){for(let qe=0;qe<Je.length;qe++)Me(Je[qe],me,ve,De,qe===0)}function ct(Je,me,ve,De){const{id:qe,type:Oe,geometry:Ke,tags:ut}=Je,et=[];if(Oe===1)(function(dt,Ft,It,ii,yi){for(let wi=0;wi<dt.length;wi+=2){const Li=Math.round(a.al*(dt[wi+0]*Ft-It)),Vi=Math.round(a.al*(dt[wi+1]*Ft-ii));yi.push([Li,Vi])}})(Ke,me,ve,De,et);else if(Oe===2)for(const dt of Ke)Ct(dt,me,ve,De,et);else if(Oe===3)for(const dt of Ke)li(dt,me,ve,De,et);return{id:qe,type:Oe,geometry:et,tags:ut}}function Ct(Je,me,ve,De,qe){const Ke=a.al+128;let ut;for(let et=0;et<Je.length-2;et+=2){let dt=Math.round(a.al*(Je[et+0]*me-ve)),Ft=Math.round(a.al*(Je[et+1]*me-De)),It=Math.round(a.al*(Je[et+2]*me-ve)),ii=Math.round(a.al*(Je[et+3]*me-De));const yi=It-dt,wi=ii-Ft;dt<-128&&It<-128||(dt<-128?(Ft+=Math.round(wi*((-128-dt)/yi)),dt=-128):It<-128&&(ii=Ft+Math.round(wi*((-128-dt)/yi)),It=-128),Ft<-128&&ii<-128||(Ft<-128?(dt+=Math.round(yi*((-128-Ft)/wi)),Ft=-128):ii<-128&&(It=dt+Math.round(yi*((-128-Ft)/wi)),ii=-128),dt>=Ke&&It>=Ke||(dt>=Ke?(Ft+=Math.round(wi*((Ke-dt)/yi)),dt=Ke):It>=Ke&&(ii=Ft+Math.round(wi*((Ke-dt)/yi)),It=Ke),Ft>=Ke&&ii>=Ke||(Ft>=Ke?(dt+=Math.round(yi*((Ke-Ft)/wi)),Ft=Ke):ii>=Ke&&(It=dt+Math.round(yi*((Ke-Ft)/wi)),ii=Ke),ut&&dt===ut[ut.length-1][0]&&Ft===ut[ut.length-1][1]||(ut=[[dt,Ft]],qe.push(ut)),ut.push([It,ii])))))}}function li(Je,me,ve,De,qe){const Oe=(ve-xe)/me,Ke=(De-xe)/me,ut=(ve+1+xe)/me,et=(De+1+xe)/me;function dt(ii,yi){let wi=0;return ii<Oe?wi|=1:ii>ut&&(wi|=2),yi<Ke?wi|=4:yi>et&&(wi|=8),wi}let Ft=[];for(let ii=1;ii<=8;ii*=2){let yi=Je[Je.length-2],wi=Je[Je.length-1],Li=!(dt(yi,wi)&ii);for(let Vi=0;Vi<Je.length;Vi+=2){const xi=Je[Vi],Pi=Je[Vi+1],Fr=!(dt(xi,Pi)&ii);Fr!==Li&&(8&ii?Ft.push(yi+(xi-yi)*(et-wi)/(Pi-wi),et):4&ii?Ft.push(yi+(xi-yi)*(Ke-wi)/(Pi-wi),Ke):2&ii?Ft.push(ut,wi+(Pi-wi)*(ut-yi)/(xi-yi)):1&ii&&Ft.push(Oe,wi+(Pi-wi)*(Oe-yi)/(xi-yi))),Fr&&Ft.push(xi,Pi),yi=xi,wi=Pi,Li=Fr}if(!(Je=Ft).length||ii===8)break;Ft=[]}const It=[];for(let ii=0;ii<Ft.length;ii+=2)It.push([Math.round(a.al*(Ft[ii]*me-ve)),Math.round(a.al*(Ft[ii+1]*me-De))]);It.length&&qe.push(It)}function mi({name:Je,features:me},ve){ve.writeStringField(1,Je),ve.writeVarintField(5,a.al);const De=new Map,qe=new Map,Oe={keys:De,values:qe,feature:null};for(const Ke of me)Oe.feature=Ke,ve.writeMessage(2,bi,Oe);for(const Ke of De.keys())ve.writeStringField(3,Ke);for(const Ke of qe.keys())ve.writeMessage(4,zr,Ke)}function bi(Je,me){const ve=Je.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&me.writeVarintField(1,+ve.id),ve.tags&&me.writeMessage(2,zi,Je),me.writeVarintField(3,ve.type),me.writeMessage(4,lr,ve)}function zi({keys:Je,values:me,feature:ve},De){for(const qe of Object.keys(ve.tags)){let Oe=ve.tags[qe];if(Oe===null)continue;let Ke=Je.get(qe);Ke===void 0&&(Ke=Je.size,Je.set(qe,Ke)),De.writeVarint(Ke);const ut=typeof Oe;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(Oe=JSON.stringify(Oe));let et=me.get(Oe);et===void 0&&(et=me.size,me.set(Oe,et)),De.writeVarint(et)}}function vi(Je,me){return(me<<3)+(7&Je)}function Gi(Je){return Je<<1^Je>>31}function lr(Je,me){const{geometry:ve,type:De}=Je;let qe=0,Oe=0;if(De===1){me.writeVarint(vi(1,ve.length));for(const Ke of ve){const ut=Ke[0]-qe,et=Ke[1]-Oe;me.writeVarint(Gi(ut)),me.writeVarint(Gi(et)),qe+=ut,Oe+=et}}else for(const Ke of ve){if(Ke.length===0)continue;me.writeVarint(vi(1,1));const ut=Ke.length-(De===3?1:0);for(let et=0;et<ut;et++){et===1&&me.writeVarint(vi(2,ut-1));const dt=Ke[et][0]-qe,Ft=Ke[et][1]-Oe;me.writeVarint(Gi(dt)),me.writeVarint(Gi(Ft)),qe+=dt,Oe+=Ft}De===3&&me.writeVarint(vi(7,1))}}function zr(Je,me){const ve=typeof Je;ve==="string"?me.writeStringField(1,Je):ve==="boolean"?me.writeBooleanField(7,Je):ve==="number"&&(Je%1!=0?me.writeDoubleField(3,Je):Je<0?me.writeSVarintField(6,Je):me.writeVarintField(5,Je))}const Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Je=>Je},Ci=Math.fround||(Gn=new Float32Array(1),Je=>(Gn[0]=+Je,Gn[0]));var Gn;class Wn{constructor(me){this.options=Object.assign(Object.create(Ui),me),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(me){const{log:ve,minZoom:De,maxZoom:qe}=this.options;ve&&console.time("total time");const Oe=`prepare ${me.length} points`;ve&&console.time(Oe),this.points=me;const Ke=[];for(let et=0;et<me.length;et++){const dt=me[et];if(!dt.geometry)continue;const[Ft,It]=dt.geometry.coordinates,ii=Ci(Xr(Ft)),yi=Ci(es(It));Ke.push(ii,yi,1/0,et,-1,1),this.options.reduce&&Ke.push(0)}let ut=this.trees[qe+1]=this._createTree(Ke);ve&&console.timeEnd(Oe);for(let et=qe;et>=De;et--){const dt=+Date.now();ut=this.trees[et]=this._createTree(this._cluster(ut,et)),ve&&console.log("z%d: %d clusters in %dms",et,ut.numItems,+Date.now()-dt)}return ve&&console.timeEnd("total time"),this}getClusters(me,ve){let De=((me[0]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,me[1]));let Oe=me[2]===180?180:((me[2]+180)%360+360)%360-180;const Ke=Math.max(-90,Math.min(90,me[3]));if(me[2]-me[0]>=360)De=-180,Oe=180;else if(De>Oe){const It=this.getClusters([De,qe,180,Ke],ve),ii=this.getClusters([-180,qe,Oe,Ke],ve);return It.concat(ii)}const ut=this.trees[this._limitZoom(ve)],et=ut.range(Xr(De),es(Ke),Xr(Oe),es(qe)),dt=ut.data,Ft=[];for(const It of et){const ii=this.stride*It;Ft.push(dt[ii+5]>1?vn(dt,ii,this.clusterProps):this.points[dt[ii+3]])}return Ft}getChildren(me){const ve=this._getOriginId(me),De=this._getOriginZoom(me),qe="No cluster with the specified id.",Oe=this.trees[De];if(!Oe)throw new Error(qe);const Ke=Oe.data;if(ve*this.stride>=Ke.length)throw new Error(qe);const ut=this.options.radius/(this.options.extent*Math.pow(2,De-1)),et=Oe.within(Ke[ve*this.stride],Ke[ve*this.stride+1],ut),dt=[];for(const Ft of et){const It=Ft*this.stride;Ke[It+4]===me&&dt.push(Ke[It+5]>1?vn(Ke,It,this.clusterProps):this.points[Ke[It+3]])}if(dt.length===0)throw new Error(qe);return dt}getLeaves(me,ve,De){const qe=[];return this._appendLeaves(qe,me,ve=ve||10,De=De||0,0),qe}getTile(me,ve,De){const qe=this.trees[this._limitZoom(me)],Oe=Math.pow(2,me),{extent:Ke,radius:ut}=this.options,et=ut/Ke,dt=(De-et)/Oe,Ft=(De+1+et)/Oe,It={features:[]};return this._addTileFeatures(qe.range((ve-et)/Oe,dt,(ve+1+et)/Oe,Ft),qe.data,ve,De,Oe,It),ve===0&&this._addTileFeatures(qe.range(1-et/Oe,dt,1,Ft),qe.data,Oe,De,Oe,It),ve===Oe-1&&this._addTileFeatures(qe.range(0,dt,et/Oe,Ft),qe.data,-1,De,Oe,It),It.features.length?It:null}getClusterExpansionZoom(me){let ve=this._getOriginZoom(me)-1;for(;ve<=this.options.maxZoom;){const De=this.getChildren(me);if(ve++,De.length!==1)break;me=De[0].properties.cluster_id}return ve}_appendLeaves(me,ve,De,qe,Oe){const Ke=this.getChildren(ve);for(const ut of Ke){const et=ut.properties;if(et&&et.cluster?Oe+et.point_count<=qe?Oe+=et.point_count:Oe=this._appendLeaves(me,et.cluster_id,De,qe,Oe):Oe<qe?Oe++:me.push(ut),me.length===De)break}return Oe}_createTree(me){const ve=new a.c4(me.length/this.stride|0,this.options.nodeSize,Float32Array);for(let De=0;De<me.length;De+=this.stride)ve.add(me[De],me[De+1]);return ve.finish(),ve.data=me,ve}_addTileFeatures(me,ve,De,qe,Oe,Ke){for(const ut of me){const et=ut*this.stride,dt=ve[et+5]>1;let Ft,It,ii;if(dt)Ft=Sr(ve,et,this.clusterProps),It=ve[et],ii=ve[et+1];else{const Li=this.points[ve[et+3]];Ft=Li.properties;const[Vi,xi]=Li.geometry.coordinates;It=Xr(Vi),ii=es(xi)}const yi={type:1,geometry:[[Math.round(this.options.extent*(It*Oe-De)),Math.round(this.options.extent*(ii*Oe-qe))]],tags:Ft};let wi;wi=dt||this.options.generateId?ve[et+3]:this.points[ve[et+3]].id,wi!==void 0&&(yi.id=wi),Ke.features.push(yi)}}_limitZoom(me){return Math.max(this.options.minZoom,Math.min(Math.floor(+me),this.options.maxZoom+1))}_cluster(me,ve){const{radius:De,extent:qe,reduce:Oe,minPoints:Ke}=this.options,ut=De/(qe*Math.pow(2,ve)),et=me.data,dt=[],Ft=this.stride;for(let It=0;It<et.length;It+=Ft){if(et[It+2]<=ve)continue;et[It+2]=ve;const ii=et[It],yi=et[It+1],wi=me.within(et[It],et[It+1],ut),Li=et[It+5];let Vi=Li;for(const xi of wi){const Pi=xi*Ft;et[Pi+2]>ve&&(Vi+=et[Pi+5])}if(Vi>Li&&Vi>=Ke){let xi,Pi=ii*Li,Fr=yi*Li,fn=-1;const Wr=(It/Ft<<5)+(ve+1)+this.points.length;for(const wn of wi){const qr=wn*Ft;if(et[qr+2]<=ve)continue;et[qr+2]=ve;const rr=et[qr+5];Pi+=et[qr]*rr,Fr+=et[qr+1]*rr,et[qr+4]=Wr,Oe&&(xi||(xi=this._map(et,It,!0),fn=this.clusterProps.length,this.clusterProps.push(xi)),Oe(xi,this._map(et,qr)))}et[It+4]=Wr,dt.push(Pi/Vi,Fr/Vi,1/0,Wr,-1,Vi),Oe&&dt.push(fn)}else{for(let xi=0;xi<Ft;xi++)dt.push(et[It+xi]);if(Vi>1)for(const xi of wi){const Pi=xi*Ft;if(!(et[Pi+2]<=ve)){et[Pi+2]=ve;for(let Fr=0;Fr<Ft;Fr++)dt.push(et[Pi+Fr])}}}}return dt}_getOriginId(me){return me-this.points.length>>5}_getOriginZoom(me){return(me-this.points.length)%32}_map(me,ve,De){if(me[ve+5]>1){const Ke=this.clusterProps[me[ve+6]];return De?Object.assign({},Ke):Ke}const qe=this.points[me[ve+3]].properties,Oe=this.options.map(qe);return De&&Oe===qe?Object.assign({},Oe):Oe}}function vn(Je,me,ve){return{type:"Feature",id:Je[me+3],properties:Sr(Je,me,ve),geometry:{type:"Point",coordinates:[(De=Je[me],360*(De-.5)),Un(Je[me+1])]}};var De}function Sr(Je,me,ve){const De=Je[me+5],qe=De>=1e4?`${Math.round(De/1e3)}k`:De>=1e3?Math.round(De/100)/10+"k":De,Oe=Je[me+6],Ke=Oe===-1?{}:Object.assign({},ve[Oe]);return Object.assign(Ke,{cluster:!0,cluster_id:Je[me+3],point_count:De,point_count_abbreviated:qe})}function Xr(Je){return Je/360+.5}function es(Je){const me=Math.sin(Je*Math.PI/180),ve=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return ve<0?0:ve>1?1:ve}function Un(Je){const me=(180-360*Je)*Math.PI/180;return 360*Math.atan(Math.exp(me))/Math.PI-90}function dn(Je,me,ve,De){let qe=De;const Oe=me+(ve-me>>1);let Ke,ut=ve-me;const et=Je[me],dt=Je[me+1],Ft=Je[ve],It=Je[ve+1];for(let ii=me+3;ii<ve;ii+=3){const yi=os(Je[ii],Je[ii+1],et,dt,Ft,It);if(yi>qe)Ke=ii,qe=yi;else if(yi===qe){const wi=Math.abs(ii-Oe);wi<ut&&(Ke=ii,ut=wi)}}qe>De&&(Ke-me>3&&dn(Je,me,Ke,De),Je[Ke+2]=qe,ve-Ke>3&&dn(Je,Ke,ve,De))}function os(Je,me,ve,De,qe,Oe){let Ke=qe-ve,ut=Oe-De;if(Ke!==0||ut!==0){const et=((Je-ve)*Ke+(me-De)*ut)/(Ke*Ke+ut*ut);et>1?(ve=qe,De=Oe):et>0&&(ve+=Ke*et,De+=ut*et)}return Ke=Je-ve,ut=me-De,Ke*Ke+ut*ut}function Dr(Je,me,ve,De){const qe={id:Je??null,type:me,geometry:ve,tags:De,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(me==="Point"||me==="MultiPoint"||me==="LineString")jn(qe,ve);else if(me==="Polygon")jn(qe,ve[0]);else if(me==="MultiLineString")for(const Oe of ve)jn(qe,Oe);else if(me==="MultiPolygon")for(const Oe of ve)jn(qe,Oe[0]);return qe}function jn(Je,me){for(let ve=0;ve<me.length;ve+=3)Je.minX=Math.min(Je.minX,me[ve]),Je.minY=Math.min(Je.minY,me[ve+1]),Je.maxX=Math.max(Je.maxX,me[ve]),Je.maxY=Math.max(Je.maxY,me[ve+1])}function Rn(Je,me,ve,De){if(!me.geometry)return;const qe=me.geometry.coordinates;if(qe&&qe.length===0)return;const Oe=me.geometry.type,Ke=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let ut=[],et=me.id;if(ve.promoteId?et=me.properties[ve.promoteId]:ve.generateId&&(et=De||0),Oe==="Point")ys(qe,ut);else if(Oe==="MultiPoint")for(const dt of qe)ys(dt,ut);else if(Oe==="LineString")As(qe,ut,Ke,!1);else if(Oe==="MultiLineString"){if(ve.lineMetrics){for(const dt of qe)ut=[],As(dt,ut,Ke,!1),Je.push(Dr(et,"LineString",ut,me.properties));return}sa(qe,ut,Ke,!1)}else if(Oe==="Polygon")sa(qe,ut,Ke,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const dt of me.geometry.geometries)Rn(Je,{id:et,geometry:dt,properties:me.properties},ve,De);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const dt of qe){const Ft=[];sa(dt,Ft,Ke,!0),ut.push(Ft)}}Je.push(Dr(et,Oe,ut,me.properties))}function ys(Je,me){me.push(bn(Je[0]),Al(Je[1]),0)}function As(Je,me,ve,De){let qe,Oe,Ke=0;for(let et=0;et<Je.length;et++){const dt=bn(Je[et][0]),Ft=Al(Je[et][1]);me.push(dt,Ft,0),et>0&&(Ke+=De?(qe*Ft-dt*Oe)/2:Math.sqrt(Math.pow(dt-qe,2)+Math.pow(Ft-Oe,2))),qe=dt,Oe=Ft}const ut=me.length-3;me[2]=1,dn(me,0,ut,ve),me[ut+2]=1,me.size=Math.abs(Ke),me.start=0,me.end=me.size}function sa(Je,me,ve,De){for(let qe=0;qe<Je.length;qe++){const Oe=[];As(Je[qe],Oe,ve,De),me.push(Oe)}}function bn(Je){return Je/360+.5}function Al(Je){const me=Math.sin(Je*Math.PI/180),ve=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return ve<0?0:ve>1?1:ve}function _s(Je,me,ve,De,qe,Oe,Ke,ut){if(De/=me,Oe>=(ve/=me)&&Ke<De)return Je;if(Ke<ve||Oe>=De)return null;const et=[];for(const dt of Je){const Ft=dt.geometry;let It=dt.type;const ii=qe===0?dt.minX:dt.minY,yi=qe===0?dt.maxX:dt.maxY;if(ii>=ve&&yi<De){et.push(dt);continue}if(yi<ve||ii>=De)continue;let wi=[];if(It==="Point"||It==="MultiPoint")Co(Ft,wi,ve,De,qe);else if(It==="LineString")Zn(Ft,wi,ve,De,qe,!1,ut.lineMetrics);else if(It==="MultiLineString")$n(Ft,wi,ve,De,qe,!1);else if(It==="Polygon")$n(Ft,wi,ve,De,qe,!0);else if(It==="MultiPolygon")for(const Li of Ft){const Vi=[];$n(Li,Vi,ve,De,qe,!0),Vi.length&&wi.push(Vi)}if(wi.length){if(ut.lineMetrics&&It==="LineString"){for(const Li of wi)et.push(Dr(dt.id,It,Li,dt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(wi.length===1?(It="LineString",wi=wi[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=wi.length===3?"Point":"MultiPoint"),et.push(Dr(dt.id,It,wi,dt.tags))}}return et.length?et:null}function Co(Je,me,ve,De,qe){for(let Oe=0;Oe<Je.length;Oe+=3){const Ke=Je[Oe+qe];Ke>=ve&&Ke<=De&&Ro(me,Je[Oe],Je[Oe+1],Je[Oe+2])}}function Zn(Je,me,ve,De,qe,Oe,Ke){let ut=Sn(Je);const et=qe===0?ao:Ls;let dt,Ft,It=Je.start;for(let Vi=0;Vi<Je.length-3;Vi+=3){const xi=Je[Vi],Pi=Je[Vi+1],Fr=Je[Vi+2],fn=Je[Vi+3],Wr=Je[Vi+4],wn=qe===0?xi:Pi,qr=qe===0?fn:Wr;let rr=!1;Ke&&(dt=Math.sqrt(Math.pow(xi-fn,2)+Math.pow(Pi-Wr,2))),wn<ve?qr>ve&&(Ft=et(ut,xi,Pi,fn,Wr,ve),Ke&&(ut.start=It+dt*Ft)):wn>De?qr<De&&(Ft=et(ut,xi,Pi,fn,Wr,De),Ke&&(ut.start=It+dt*Ft)):Ro(ut,xi,Pi,Fr),qr<ve&&wn>=ve&&(Ft=et(ut,xi,Pi,fn,Wr,ve),rr=!0),qr>De&&wn<=De&&(Ft=et(ut,xi,Pi,fn,Wr,De),rr=!0),!Oe&&rr&&(Ke&&(ut.end=It+dt*Ft),me.push(ut),ut=Sn(Je)),Ke&&(It+=dt)}let ii=Je.length-3;const yi=Je[ii],wi=Je[ii+1],Li=qe===0?yi:wi;Li>=ve&&Li<=De&&Ro(ut,yi,wi,Je[ii+2]),ii=ut.length-3,Oe&&ii>=3&&(ut[ii]!==ut[0]||ut[ii+1]!==ut[1])&&Ro(ut,ut[0],ut[1],ut[2]),ut.length&&me.push(ut)}function Sn(Je){const me=[];return me.size=Je.size,me.start=Je.start,me.end=Je.end,me}function $n(Je,me,ve,De,qe,Oe){for(const Ke of Je)Zn(Ke,me,ve,De,qe,Oe,!1)}function Ro(Je,me,ve,De){Je.push(me,ve,De)}function ao(Je,me,ve,De,qe,Oe){const Ke=(Oe-me)/(De-me);return Ro(Je,Oe,ve+(qe-ve)*Ke,1),Ke}function Ls(Je,me,ve,De,qe,Oe){const Ke=(Oe-ve)/(qe-ve);return Ro(Je,me+(De-me)*Ke,Oe,1),Ke}function qa(Je,me){const ve=[];for(let De=0;De<Je.length;De++){const qe=Je[De],Oe=qe.type;let Ke;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")Ke=Wa(qe.geometry,me);else if(Oe==="MultiLineString"||Oe==="Polygon"){Ke=[];for(const ut of qe.geometry)Ke.push(Wa(ut,me))}else if(Oe==="MultiPolygon"){Ke=[];for(const ut of qe.geometry){const et=[];for(const dt of ut)et.push(Wa(dt,me));Ke.push(et)}}ve.push(Dr(qe.id,Oe,Ke,qe.tags))}return ve}function Wa(Je,me){const ve=[];ve.size=Je.size,Je.start!==void 0&&(ve.start=Je.start,ve.end=Je.end);for(let De=0;De<Je.length;De+=3)ve.push(Je[De]+me,Je[De+1],Je[De+2]);return ve}function oo(Je,me){if(Je.transformed)return Je;const ve=1<<Je.z,De=Je.x,qe=Je.y;for(const Oe of Je.features){const Ke=Oe.geometry,ut=Oe.type;if(Oe.geometry=[],ut===1)for(let et=0;et<Ke.length;et+=2)Oe.geometry.push(Tr(Ke[et],Ke[et+1],me,ve,De,qe));else for(let et=0;et<Ke.length;et++){const dt=[];for(let Ft=0;Ft<Ke[et].length;Ft+=2)dt.push(Tr(Ke[et][Ft],Ke[et][Ft+1],me,ve,De,qe));Oe.geometry.push(dt)}}return Je.transformed=!0,Je}function Tr(Je,me,ve,De,qe,Oe){return[Math.round(ve*(Je*De-qe)),Math.round(ve*(me*De-Oe))]}function $i(Je,me,ve,De,qe){const Oe=me===qe.maxZoom?0:qe.tolerance/((1<<me)*qe.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:Je.length,source:null,x:ve,y:De,z:me,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ut of Je)Mn(Ke,ut,Oe,qe);return Ke}function Mn(Je,me,ve,De){const qe=me.geometry,Oe=me.type,Ke=[];if(Je.minX=Math.min(Je.minX,me.minX),Je.minY=Math.min(Je.minY,me.minY),Je.maxX=Math.max(Je.maxX,me.maxX),Je.maxY=Math.max(Je.maxY,me.maxY),Oe==="Point"||Oe==="MultiPoint")for(let ut=0;ut<qe.length;ut+=3)Ke.push(qe[ut],qe[ut+1]),Je.numPoints++,Je.numSimplified++;else if(Oe==="LineString")Xn(Ke,qe,Je,ve,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let ut=0;ut<qe.length;ut++)Xn(Ke,qe[ut],Je,ve,Oe==="Polygon",ut===0);else if(Oe==="MultiPolygon")for(let ut=0;ut<qe.length;ut++){const et=qe[ut];for(let dt=0;dt<et.length;dt++)Xn(Ke,et[dt],Je,ve,!0,dt===0)}if(Ke.length){let ut=me.tags||null;if(Oe==="LineString"&&De.lineMetrics){ut={};for(const dt in me.tags)ut[dt]=me.tags[dt];ut.mapbox_clip_start=qe.start/qe.size,ut.mapbox_clip_end=qe.end/qe.size}const et={geometry:Ke,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:ut};me.id!==null&&(et.id=me.id),Je.features.push(et)}}function Xn(Je,me,ve,De,qe,Oe){const Ke=De*De;if(De>0&&me.size<(qe?Ke:De))return void(ve.numPoints+=me.length/3);const ut=[];for(let et=0;et<me.length;et+=3)(De===0||me[et+2]>Ke)&&(ve.numSimplified++,ut.push(me[et],me[et+1])),ve.numPoints++;qe&&(function(et,dt){let Ft=0;for(let It=0,ii=et.length,yi=ii-2;It<ii;yi=It,It+=2)Ft+=(et[It]-et[yi])*(et[It+1]+et[yi+1]);if(Ft>0===dt)for(let It=0,ii=et.length;It<ii/2;It+=2){const yi=et[It],wi=et[It+1];et[It]=et[ii-2-It],et[It+1]=et[ii-1-It],et[ii-2-It]=yi,et[ii-1-It]=wi}})(ut,Oe),Je.push(ut)}const Tn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tl{constructor(me,ve){const De=(ve=this.options=(function(Oe,Ke){for(const ut in Ke)Oe[ut]=Ke[ut];return Oe})(Object.create(Tn),ve)).debug;if(De&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let qe=(function(Oe,Ke){const ut=[];if(Oe.type==="FeatureCollection")for(let et=0;et<Oe.features.length;et++)Rn(ut,Oe.features[et],Ke,et);else Rn(ut,Oe.type==="Feature"?Oe:{geometry:Oe},Ke);return ut})(me,ve);this.tiles={},this.tileCoords=[],De&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),qe=(function(Oe,Ke){const ut=Ke.buffer/Ke.extent;let et=Oe;const dt=_s(Oe,1,-1-ut,ut,0,-1,2,Ke),Ft=_s(Oe,1,1-ut,2+ut,0,-1,2,Ke);return(dt||Ft)&&(et=_s(Oe,1,-ut,1+ut,0,-1,2,Ke)||[],dt&&(et=qa(dt,1).concat(et)),Ft&&(et=et.concat(qa(Ft,-1)))),et})(qe,ve),qe.length&&this.splitTile(qe,0,0,0),De&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(me,ve,De,qe,Oe,Ke,ut){const et=[me,ve,De,qe],dt=this.options,Ft=dt.debug;for(;et.length;){qe=et.pop(),De=et.pop(),ve=et.pop(),me=et.pop();const It=1<<ve,ii=An(ve,De,qe);let yi=this.tiles[ii];if(!yi&&(Ft>1&&console.time("creation"),yi=this.tiles[ii]=$i(me,ve,De,qe,dt),this.tileCoords.push({z:ve,x:De,y:qe}),Ft)){Ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,De,qe,yi.numFeatures,yi.numPoints,yi.numSimplified),console.timeEnd("creation"));const rr=`z${ve}`;this.stats[rr]=(this.stats[rr]||0)+1,this.total++}if(yi.source=me,Oe==null){if(ve===dt.indexMaxZoom||yi.numPoints<=dt.indexMaxPoints)continue}else{if(ve===dt.maxZoom||ve===Oe)continue;if(Oe!=null){const rr=Oe-ve;if(De!==Ke>>rr||qe!==ut>>rr)continue}}if(yi.source=null,me.length===0)continue;Ft>1&&console.time("clipping");const wi=.5*dt.buffer/dt.extent,Li=.5-wi,Vi=.5+wi,xi=1+wi;let Pi=null,Fr=null,fn=null,Wr=null,wn=_s(me,It,De-wi,De+Vi,0,yi.minX,yi.maxX,dt),qr=_s(me,It,De+Li,De+xi,0,yi.minX,yi.maxX,dt);me=null,wn&&(Pi=_s(wn,It,qe-wi,qe+Vi,1,yi.minY,yi.maxY,dt),Fr=_s(wn,It,qe+Li,qe+xi,1,yi.minY,yi.maxY,dt),wn=null),qr&&(fn=_s(qr,It,qe-wi,qe+Vi,1,yi.minY,yi.maxY,dt),Wr=_s(qr,It,qe+Li,qe+xi,1,yi.minY,yi.maxY,dt),qr=null),Ft>1&&console.timeEnd("clipping"),et.push(Pi||[],ve+1,2*De,2*qe),et.push(Fr||[],ve+1,2*De,2*qe+1),et.push(fn||[],ve+1,2*De+1,2*qe),et.push(Wr||[],ve+1,2*De+1,2*qe+1)}}getTile(me,ve,De){me=+me,ve=+ve,De=+De;const qe=this.options,{extent:Oe,debug:Ke}=qe;if(me<0||me>24)return null;const ut=1<<me,et=An(me,ve=ve+ut&ut-1,De);if(this.tiles[et])return oo(this.tiles[et],Oe);Ke>1&&console.log("drilling down to z%d-%d-%d",me,ve,De);let dt,Ft=me,It=ve,ii=De;for(;!dt&&Ft>0;)Ft--,It>>=1,ii>>=1,dt=this.tiles[An(Ft,It,ii)];return dt&&dt.source?(Ke>1&&(console.log("found parent tile z%d-%d-%d",Ft,It,ii),console.time("drilling down")),this.splitTile(dt.source,Ft,It,ii,me,ve,De),Ke>1&&console.timeEnd("drilling down"),this.tiles[et]?oo(this.tiles[et],Oe):null):null}}function An(Je,me,ve){return 32*((1<<Je)*ve+me)+Je}function Pt(Je,me){const ve=Je.tileID.canonical;if(!this._geoJSONIndex)return void me(null,null);const De=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!De)return void me(null,null);const qe=dt=>dt.tags&&"3d_elevation_id"in dt.tags&&"source"in dt.tags&&dt.tags.source==="elevation",Oe=De.features.filter(dt=>qe(dt));let Ke={_geojsonTileLayer:De.features};Oe.length>0&&(Ke={_geojsonTileLayer:De.features.filter(dt=>!qe(dt)),hd_road_elevation:Oe});const ut=new kt(Ke),et=(function(dt){const Ft=new a.bt;for(const It of Object.keys(dt))Ft.writeMessage(3,mi,{name:It,features:dt[It]});return Ft.finish()})(Ke).buffer;me(null,{vectorTile:ut,rawData:et})}class ga extends Le{constructor(me,ve,De,qe,Oe,Ke,ut){super(me,ve,De,qe,Oe,Pt,ut),Ke&&(this.loadGeoJSON=Ke),this._dynamicIndex=new Fe}loadData(me,ve){const De=me&&me.request,qe=De&&De.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(me,(Oe,Ke)=>{if(Oe||!Ke)return ve(Oe);if(typeof Ke!="object")return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));{try{if(me.filter){const et=a.U(me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(et.result==="error")throw new Error(et.value.map(dt=>`${dt.key}: ${dt.message}`).join(", "));Ke.features=Ke.features.filter(dt=>et.value.evaluate({zoom:0},dt))}me.dynamic?(Ke.type==="Feature"&&(Ke={type:"FeatureCollection",features:[Ke]}),me.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ke.features,this.loaded),me.cluster&&(Ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=me.cluster?new Wn((function({superclusterOptions:et,clusterProperties:dt}){if(!dt||!et)return et;const Ft={},It={},ii={accumulated:null,zoom:0},yi={properties:null},wi=Object.keys(dt);for(const Li of wi){const[Vi,xi]=dt[Li],Pi=a.U(xi),Fr=a.U(typeof Vi=="string"?[Vi,["accumulated"],["get",Li]]:Vi);Ft[Li]=Pi.value,It[Li]=Fr.value}return et.map=Li=>{yi.properties=Li;const Vi={};for(const xi of wi)Vi[xi]=Ft[xi].evaluate(ii,yi);return Vi},et.reduce=(Li,Vi)=>{yi.properties=Vi;for(const xi of wi)ii.accumulated=Li[xi],Li[xi]=It[xi].evaluate(ii,yi)},et})(me)).load(Ke.features):me.dynamic?this._dynamicIndex:(function(et,dt){return new tl(et,dt)})(Ke,me.geojsonVtOptions)}catch(et){return ve(et)}const ut={};if(qe){const et=k(De);et&&(ut.resourceTiming={},ut.resourceTiming[me.source]=JSON.parse(JSON.stringify(et)))}ve(null,ut)}})}reloadTile(me,ve){const De=this.loaded;return De&&De[me.uid]?me.partial?ve(null,void 0):super.reloadTile(me,ve):this.loadTile(me,ve)}loadGeoJSON(me,ve){if(me.request)a.m(me.request,ve);else{if(typeof me.data!="string")return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ve(null,JSON.parse(me.data))}catch{return ve(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(me,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(De){ve(De)}}getClusterChildren(me,ve){try{ve(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(De){ve(De)}}getClusterLeaves(me,ve){try{ve(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(De){ve(De)}}}class aa{constructor(me,ve,De){this.tileID=new a.aQ(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=me.projection,this.brightness=ve,this.worldview=De}parse(me,ve,De,qe){this.status="parsing";const Oe=new a.aQ(De.tileID.overscaledZ,De.tileID.wrap,De.tileID.canonical.z,De.tileID.canonical.x,De.tileID.canonical.y),Ke=[],ut=ve.familiesBySource[De.source],et=new a.fn(Oe,De.promoteId);et.bucketLayerIDs=[],et.is3DTile=!0,a.fC(me).then(dt=>{if(!dt)return qe(new Error("Could not parse tile"));const Ft=dt.json.extensionsUsed&&dt.json.extensionsUsed.includes("MAPBOX_mesh_features")||dt.json.asset.extras&&dt.json.asset.extras.MAPBOX_mesh_features,It=dt.json.extensionsUsed&&dt.json.extensionsUsed.includes("EXT_meshopt_compression"),ii=new a.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const yi in ut)for(const wi of ut[yi]){const Li=wi[0];et.bucketLayerIDs.push(wi.map(Pi=>a.B(Pi.id,Pi.scope))),Li.recalculate(ii,[]);const Vi=a.fD(dt,1/a.d7(De.tileID.canonical)),xi=new a.fE(wi,Vi,Oe,Ft,It,this.brightness,et,this.worldview);Ft||(xi.needsUpload=!0),Ke.push(xi),xi.evaluate(Li)}this.status="done",qe(null,{buckets:Ke,featureIndex:et,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(dt=>qe(new Error(dt.message)))}}class Os{constructor(me,ve,De,qe,Oe,Ke,ut,et){this.actor=me,this.layerIndex=ve,this.availableImages=De,this.availableModels=qe,this.brightness=ut,this.loading={},this.loaded={},this.worldview=et}loadTile(me,ve){const De=me.uid,qe=this.loading[De]=new aa(me,this.brightness,this.worldview);a.bu(me.request,(Oe,Ke)=>{const ut=!this.loading[De];return delete this.loading[De],ut||Oe?(qe.status="done",ut||(this.loaded[De]=qe),ve(Oe)):Ke&&Ke.byteLength!==0?void qe.parse(Ke,this.layerIndex,me,(et,dt)=>{qe.status="done",this.loaded=this.loaded||{},this.loaded[De]=qe,et||!dt?ve(et):ve(null,dt)}):(qe.status="done",this.loaded[De]=qe,ve())})}reloadTile(me,ve){const De=this.loaded,qe=me.uid;if(De&&De[qe]){const Oe=De[qe];Oe.projection=me.projection,Oe.brightness=me.brightness;const Ke=(ut,et)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(me,ve)),ve(ut,et)};Oe.status==="parsing"?Oe.reloadCallback=Ke:Oe.status==="done"&&this.loadTile(me,ve)}}abortTile(me,ve){const De=me.uid;this.loading[De]&&delete this.loading[De],ve()}removeTile(me,ve){const De=this.loaded,qe=me.uid;De&&De[qe]&&delete De[qe],ve()}}class tr{constructor(me){this.self=me,this.actor=new a.fG(me,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cm({name:"mercator"}),this.workerSourceTypes={vector:Le,geojson:ga,"raster-dem":lt,"raster-array":Yt,"batched-model":Os},this.workerSources={},this.self.registerWorkerSource=(ve,De)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=De},this.self.registerRTLTextPlugin=ve=>{if(a.fH.isParsed())throw new Error("RTL text plugin already registered.");a.fH.setState({pluginStatus:a.fI.parsed,pluginURL:a.fH.getPluginURL()}),a.fH.applyArabicShaping=ve.applyArabicShaping,a.fH.processBidirectionalText=ve.processBidirectionalText,a.fH.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const De of this.rtlPluginParsingListeners)De(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(me,ve,De){delete this.layerIndexes[me],delete this.availableImages[me],delete this.availableModels[me],delete this.workerSources[me],De()}checkIfReady(me,ve,De){De()}setReferrer(me,ve){this.referrer=ve}spriteLoaded(me,ve){this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={});const{scope:De,isLoaded:qe}=ve;if(this.isSpriteLoaded[me][De]=qe,this.workerSources[me]&&this.workerSources[me][De])for(const Oe in this.workerSources[me][De]){const Ke=this.workerSources[me][De][Oe];for(const ut in Ke){const et=Ke[ut];et instanceof Le&&(et.isSpriteLoaded=qe,et.fire(new a.z("isSpriteLoaded")))}}}setImages(me,ve,De){this.availableImages[me]||(this.availableImages[me]={});const{scope:qe,images:Oe}=ve;if(this.availableImages[me][qe]=Oe,this.workerSources[me]&&this.workerSources[me][qe]){for(const Ke in this.workerSources[me][qe]){const ut=this.workerSources[me][qe][Ke];for(const et in ut)ut[et].availableImages=Oe}De()}else De()}setModels(me,{scope:ve,models:De},qe){if(this.availableModels[me]||(this.availableModels[me]={}),this.availableModels[me][ve]=De,this.workerSources[me]&&this.workerSources[me][ve]){for(const Oe in this.workerSources[me][ve]){const Ke=this.workerSources[me][ve][Oe];for(const ut in Ke)Ke[ut].availableModels=De}qe()}else qe()}setProjection(me,ve){this.projections[me]=a.cm(ve)}setBrightness(me,ve,De){this.brightness=ve,De()}setWorldview(me,ve,De){this.worldview=ve,De()}setLayers(me,ve,De){this.getLayerIndex(me,ve.scope).replace(ve.layers,ve.options),De()}updateLayers(me,ve,De){this.getLayerIndex(me,ve.scope).update(ve.layers,ve.removedIds,ve.options),De()}loadTile(me,ve,De){ve.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,ve.type,ve.source,ve.scope).loadTile(ve,De)}decodeRasterArray(me,ve,De){this.getWorkerSource(me,ve.type,ve.source,ve.scope).decodeRasterArray(ve,De)}reloadTile(me,ve,De){ve.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,ve.type,ve.source,ve.scope).reloadTile(ve,De)}abortTile(me,ve,De){this.getWorkerSource(me,ve.type,ve.source,ve.scope).abortTile(ve,De)}removeTile(me,ve,De){this.getWorkerSource(me,ve.type,ve.source,ve.scope).removeTile(ve,De)}removeSource(me,ve,De){if(!(this.workerSources[me]&&this.workerSources[me][ve.scope]&&this.workerSources[me][ve.scope][ve.type]&&this.workerSources[me][ve.scope][ve.type][ve.source]))return;const qe=this.workerSources[me][ve.scope][ve.type][ve.source];delete this.workerSources[me][ve.scope][ve.type][ve.source],qe.removeSource!==void 0?qe.removeSource(ve,De):De()}loadWorkerSource(me,ve,De){try{this.self.importScripts(ve.url),De()}catch(qe){De(qe)}}syncRTLPluginState(me,ve,De){if(a.fH.isParsed())De(null,!0);else if(a.fH.isParsing())this.rtlPluginParsingListeners.push(De);else try{a.fH.setState(ve);const qe=a.fH.getPluginURL();!a.fH.isLoaded()||a.fH.isParsed()||a.fH.isParsing()||qe==null||(a.fH.setState({pluginStatus:a.fI.parsing,pluginURL:a.fH.getPluginURL()}),this.self.importScripts(qe),a.fH.isParsed()?De(null,!0):this.rtlPluginParsingListeners.push(De))}catch(qe){De(qe)}}setDracoUrl(me,ve){this.dracoUrl=ve}getAvailableImages(me,ve){this.availableImages[me]||(this.availableImages[me]={});let De=this.availableImages[me][ve];return De||(De=[]),De}getAvailableModels(me,ve){this.availableModels[me]||(this.availableModels[me]={});let De=this.availableModels[me][ve];return De||(De={}),De}getLayerIndex(me,ve){this.layerIndexes[me]||(this.layerIndexes[me]={});let De=this.layerIndexes[me][ve];return De||(De=this.layerIndexes[me][ve]=new G,De.scope=ve),De}getWorkerSource(me,ve,De,qe){const Oe=this.workerSources;return Oe[me]||(Oe[me]={}),Oe[me][qe]||(Oe[me][qe]={}),Oe[me][qe][ve]||(Oe[me][qe][ve]={}),this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={}),Oe[me][qe][ve][De]||(Oe[me][qe][ve][De]=new this.workerSourceTypes[ve]({send:(Ke,ut,et,dt,Ft,It)=>this.actor.send(Ke,ut,et,me,Ft,It),scheduler:this.actor.scheduler},this.getLayerIndex(me,qe),this.getAvailableImages(me,qe),this.getAvailableModels(me,qe),this.isSpriteLoaded[me][qe],void 0,this.brightness,this.worldview)),Oe[me][qe][ve][De]}rasterizeImagesWorker(me,ve,De){const qe=new Map;for(const[Oe,{image:Ke,imageVariant:ut}]of ve.tasks.entries()){const et=this.imageRasterizer.rasterize(ut,Ke,ve.scope,me);qe.set(Oe,et)}De(void 0,qe)}removeRasterizedImages(me,ve,De){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,me),De()}enforceCacheSizeLimit(me,ve){a.fJ(ve)}getWorkerPerformanceMetrics(me,ve,De){De(void 0,void 0)}}return a.fF(self)&&(self.worker=new tr(self)),tr}),S(["./shared"],function(a){var k="3.18.1";const O={create:"create",load:"load",fullLoad:"fullLoad"},j={mark(m){performance.mark(m)},measure(m,i,c){performance.measure(m,i,c)}};function V(m){const i=m.name.split("?")[0];return a.a(i)&&i.includes("mapbox-gl.js")?"javascript":a.a(i)&&i.includes("mapbox-gl.css")?"css":a.b(i)?"fontRange":a.c(i)?"sprite":a.i(i)?"style":a.d(i)?"tilejson":"other"}var G,J={},Z=(function(){if(G)return J;function m(g){return!i(g)}function i(g){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,M,D=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(D);try{M=new Worker(z),A=!0}catch{A=!1}return M&&M.terminate(),URL.revokeObjectURL(z),A})()?(function(){var A=document.createElement("canvas");A.width=A.height=1;var M=A.getContext("2d");if(!M)return!1;var D=M.getImageData(0,0,1,1);return D&&D.width===A.width})()?(c[E=g&&g.failIfMajorPerformanceCaveat]===void 0&&(c[E]=(function(A){var M,D=(function(z){var U=document.createElement("canvas"),$=Object.create(m.webGLContextAttributes);return $.failIfMajorPerformanceCaveat=z,U.getContext("webgl2",$)})(A);if(!D)return!1;try{M=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!M||D.isContextLost())&&(D.shaderSource(M,"void main() {}"),D.compileShader(M),D.getShaderParameter(M,D.COMPILE_STATUS)===!0)})(E)),c[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}G=1,J.supported=m,J.notSupportedReason=i;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},J})();function Y(m,i,c){const g=document.createElement(m);return i!=null&&(g.className=i),c&&c.appendChild(g),g}function le(m,i,c){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const E of Object.keys(i))g.setAttributeNS(null,E,String(i[E]));return c&&c.appendChild(g),g}const ee=typeof document<"u"?document.documentElement&&document.documentElement.style:null,se=ee&&ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Q;function oe(){ee&&se&&(Q=ee[se],ee[se]="none")}function _e(){ee&&se&&(ee[se]=Q)}function Se(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Se,!0)}function ke(){window.addEventListener("click",Se,!0),window.setTimeout(()=>{window.removeEventListener("click",Se,!0)},0)}function Le(m,i){const c=m.getBoundingClientRect();return Yt(m,c,i)}function lt(m,i){const c=m.getBoundingClientRect(),g=[];for(let E=0;E<i.length;E++)g.push(Yt(m,c,i[E]));return g}function qt(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Yt(m,i,c){const g=m.offsetWidth===i.width?1:m.offsetWidth/i.width;return new a.P((c.clientX-i.left)*g,(c.clientY-i.top)*g)}const Ot="01",Bt="NO_ACCESS_TOKEN";class si{constructor(i,c,g){this._transformRequestFn=i,this._customAccessToken=c,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const i=(function(){let c="";for(let g=0;g<10;g++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ot,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,c){return this._transformRequestFn&&this._transformRequestFn(i,c)||{url:i}}normalizeStyleURL(i,c){if(!a.h(i))return i;const g=xe(i);return g.params.push(`sdk=js-${k}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeGlyphsURL(i,c){if(!a.h(i))return i;const g=xe(i);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeModelURL(i,c){if(!a.h(i))return i;const g=xe(i);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeSourceURL(i,c,g,E){if(!a.h(i))return i;const A=xe(i);return A.path=`/v4/${A.authority}.json`,A.params.push("secure"),g&&A.params.push(`language=${g}`),E&&A.params.push(`worldview=${E}`),this._makeAPIURL(A,this._customAccessToken||c)}normalizeIconsetURL(i,c){const g=xe(i);return a.h(i)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||c)):Fe(g)}normalizeSpriteURL(i,c,g,E){const A=xe(i);return a.h(i)?(A.path=`/styles/v1${A.path}/sprite${c}${g}`,this._makeAPIURL(A,this._customAccessToken||E)):(A.path+=`${c}${g}`,Fe(A))}normalizeTileURL(i,c,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!a.h(i))return i;const E=xe(i);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||g&&E.authority!=="raster"&&g===512?"@2x":""}${a.k.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${a.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${a.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${a.e.TILE_URL_VERSION}${E.path}`);const A=this._customAccessToken||(function(M){for(const D of M){const z=D.match(/^access_token=(.*)$/);if(z)return z[1]}return null})(E.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&A&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,A)}canonicalizeTileURL(i,c){const g=xe(i);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return i;let E="mapbox://";g.path.match(/^\/raster\/v1\//)?E+=`raster/${g.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${g.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${g.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let A=g.params;return c&&(A=A.filter(M=>!M.match(/^access_token=/))),A.length&&(E+=`?${A.join("&")}`),E}canonicalizeTileset(i,c){const g=!!c&&a.h(c),E=[];for(const A of i.tiles||[])a.j(A)?E.push(this.canonicalizeTileURL(A,g)):E.push(A);return E}_makeAPIURL(i,c){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=xe(a.e.API_URL);if(i.protocol=E.protocol,i.authority=E.authority,i.protocol==="http"){const A=i.params.indexOf("secure");A>=0&&i.params.splice(A,1)}if(E.path!=="/"&&(i.path=`${E.path}${i.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Fe(i);if(c=c||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return i.params=i.params.filter(A=>A.indexOf("access_token")===-1),i.params.push(`access_token=${c||""}`),Fe(i)}}const kt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xe(m){const i=m.match(kt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Fe(m){const i=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${i}`}const pe="mapbox.eventData";function Te(m){if(!m)return null;const i=m.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(a.l(i[1]))}catch{return null}}class st{constructor(i){this.type=i,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const c=Te(a.e.ACCESS_TOKEN);let g="";return g=c&&c.u?a.f(c.u):a.e.ACCESS_TOKEN||"",i?`${pe}.${i}:${g}`:`${pe}:${g}`}fetchEventData(){const i=a.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp");if(i)try{const A=localStorage.getItem(c);A&&(this.eventData=JSON.parse(A));const M=localStorage.getItem(g);M&&(this.anonId=M);const D=localStorage.getItem(E);D&&(this.anonIdTimestamp=Number(D));const z=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<z)&&this.refreshUUID()}catch{a.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=a.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const i=a.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp"),A=this.anonId,M=this.anonIdTimestamp;if(i&&A)try{localStorage.setItem(g,A),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),M&&localStorage.setItem(E,M.toString())}catch{a.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,c,g,E){if(!a.e.EVENTS_URL)return;const A=xe(a.e.EVENTS_URL);A.params.push(`access_token=${E||a.e.ACCESS_TOKEN||""}`);const M={event:this.type,created:new Date(i).toISOString()},D=c?Object.assign(M,c):M,z={url:Fe(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=a.p(z,U=>{this.pendingRequest=null,g(U),this.saveEventData(),this.processRequests(E)})}queueRequest(i,c){this.queue.push(i),this.processRequests(c)}}class Me extends st{constructor(i){super("metrics"),i&&(this.data=i)}postMetricsEvent(i){if(!a.e.EVENTS_URL||!i&&!a.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:g}=this.queue.shift();this.postEvent(c,g,()=>{},i)}}const at=new class extends st{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,i){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(c=>a.h(c)||a.j(c))&&this.queueRequest(Date.now(),i)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Te(a.e.ACCESS_TOKEN),c=i?i.u:a.e.ACCESS_TOKEN;let g=c!==this.eventData.tokenU;a.v(this.anonId)||(this.refreshUUID(),g=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const A=new Date(this.eventData.lastSuccess),M=new Date(E),D=(E-this.eventData.lastSuccess)/864e5;g=g||D>=1||D<-1||A.getDate()!==M.getDate()}else g=!0;g?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:Ot,"enabled.telemetry":!1,userId:this.anonId},A=>{A||(this.eventData.lastSuccess=E,this.eventData.tokenU=c)},m):this.processRequests()}},ct=at.postTurnstileEvent.bind(at),Ct=new class extends st{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,i,c,g){this.skuToken=i,this.errorCb=g,a.e.EVENTS_URL&&(c||a.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(Bt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:Ot,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):i&&(this.success[i]=!0)},m))}remove(){this.errorCb=null}},li=Ct.postMapLoadEvent.bind(Ct),mi=new class extends st{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let i=this.mapInstanceIdMap.get(m);return i||(i=a.u(),this.mapInstanceIdMap.set(m,i)),i}getEventId(m){const i=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,i+1),i}postStyleLoadEvent(m,i){const{map:c,style:g,importedStyles:E}=i;if(!a.e.EVENTS_URL||!m&&!a.e.ACCESS_TOKEN)return;const A=this.getMapInstanceId(c),M={mapInstanceId:A,eventId:this.getEventId(A),style:g};E.length&&(M.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:M},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:c}=this.queue.shift();this.postEvent(i,c,()=>{},m)}},bi=mi.postStyleLoadEvent.bind(mi),zi=new Me({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),vi=zi.postMetricsEvent.bind(zi),Gi=new Me({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),lr=Gi.postMetricsEvent.bind(Gi),zr=new class extends st{constructor(){super("gljs.performance")}postPerformanceEvent(m,i){a.e.EVENTS_URL&&(m||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:c}=this.queue.shift(),g=(function(E){const A=performance.getEntriesByType("resource"),M=performance.getEntriesByType("mark"),D=(function(re){const he={};if(re){for(const ce in re)if(ce!=="other")for(const de of re[ce]){const ge=`${ce}ResolveRangeMin`,Ce=`${ce}ResolveRangeMax`,Ae=`${ce}RequestCount`,Ee=`${ce}RequestCachedCount`;he[ge]=Math.min(he[ge]||1/0,de.startTime),he[Ce]=Math.max(he[Ce]||-1/0,de.responseEnd);const Ge=je=>{he[je]===void 0&&(he[je]=0),++he[je]};de.transferSize!==void 0&&de.transferSize===0&&Ge(Ee),Ge(Ae)}}return he})((function(re,he){const ce={};if(re)for(const de of re){const ge=he(de);ce[ge]===void 0&&(ce[ge]=[]),ce[ge].push(de)}return ce})(A,V)),z=window.devicePixelRatio,U=navigator.connection||navigator.mozConnection||navigator.webkitConnection,$=U?U.effectiveType:void 0,ie={counters:[],metadata:[],attributes:[]},K=(re,he,ce)=>{ce!=null&&re.push({name:he,value:ce.toString()})};for(const re in D)K(ie.counters,re,D[re]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(K(ie.counters,"interactionRangeMin",E.interactionRange[0]),K(ie.counters,"interactionRangeMax",E.interactionRange[1])),M)for(const re of Object.values(O)){const he=M.find(ce=>ce.name===re);he&&K(ie.counters,re,he.startTime)}return K(ie.counters,"visibilityHidden",E.visibilityHidden),K(ie.attributes,"style",(function(re){if(re)for(const he of re){const ce=he.name.split("?")[0];if(a.i(ce)){const de=ce.split("/").slice(-2);if(de.length===2)return`mapbox://styles/${de[0]}/${de[1]}`}}})(A)),K(ie.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),K(ie.attributes,"fogEnabled",E.fogEnabled?"true":"false"),K(ie.attributes,"projection",E.projection),K(ie.attributes,"zoom",E.zoom),K(ie.metadata,"devicePixelRatio",z),K(ie.metadata,"connectionEffectiveType",$),K(ie.metadata,"navigatorUserAgent",navigator.userAgent),K(ie.metadata,"screenWidth",window.screen.width),K(ie.metadata,"screenHeight",window.screen.height),K(ie.metadata,"windowWidth",window.innerWidth),K(ie.metadata,"windowHeight",window.innerHeight),K(ie.metadata,"mapWidth",E.width/z),K(ie.metadata,"mapHeight",E.height/z),K(ie.metadata,"webglRenderer",E.renderer),K(ie.metadata,"webglVendor",E.vendor),K(ie.metadata,"sdkVersion",k),K(ie.metadata,"sdkIdentifier","mapbox-gl-js"),ie})(c);for(const E of g.metadata);for(const E of g.counters);for(const E of g.attributes);this.postEvent(i,g,()=>{},m)}},Ui=zr.postPerformanceEvent.bind(zr),Ci=new class extends st{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,i,c,g){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const E=xe(a.e.API_URL+a.e.SESSION_PATH);E.params.push(`sku=${i||""}`),E.params.push(`access_token=${g||a.e.ACCESS_TOKEN||""}`);const A={url:Fe(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(A,M=>{this.pendingRequest=null,c(M),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,i,c,g){this.skuToken=i,this.errorCb=g,a.e.SESSION_PATH&&a.e.API_URL&&(c||a.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(Bt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||this.getSession(c,this.skuToken,g=>{g?this.errorCb(g):i&&(this.success[i]=!0)},m)}remove(){this.errorCb=null}},Gn=Ci.getSessionAPI.bind(Ci),Wn=new Set;function vn(m,i){i?Wn.add(m):Wn.delete(m)}class Sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,c){this._updatedSourceCaches[i]=c,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const c=i.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(i.id),this.setDirty()}removeLayer(i){const c=i.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][i.id]=i,this._updatedLayers[c].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const c in this._updatedLayers)i[c]=i[c]||{},i[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)i[c]=i[c]||{},i[c].removedIds=Object.keys(this._removedLayers[c]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(i){return this._updatedImages[i]?Array.from(this._updatedImages[i].values()):[]}updateImage(i,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(a.I.toString(i)),this.setDirty()}resetUpdatedImages(i){this._updatedImages[i]&&this._updatedImages[i].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Xr(m){const{userImage:i}=m;return!!(i&&i.render&&i.render())&&(m.data.replace(new Uint8Array(i.data.buffer)),!0)}class es extends a.E{constructor(i){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=i,i!=="raster"&&a.r()&&(this.imageRasterizerDispatcher=new a.D(a.t(),this,"Image Rasterizer Worker",1))}addScope(i){this.loaded.set(i,!1),this.imageProviders.set(i,new Map),this.images.set(i,new Map),this.updatedImages.set(i,new Set),this.callbackDispatchedThisFrame.set(i,new Set),this.patterns.set(i,new Map),this.atlasImage.set(i,new a.q({width:1,height:1}))}removeScope(i){this.loaded.delete(i),this.imageProviders.delete(i),this.images.delete(i),this.updatedImages.delete(i),this.callbackDispatchedThisFrame.delete(i),this.patterns.delete(i),this.atlasImage.delete(i);const c=this.atlasTexture.get(i);c&&(c.destroy(),this.atlasTexture.delete(i))}addImageProvider(i,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(i.id,i)}removeImageProvider(i,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(i)}getPendingImageProviders(){const i=[];for(const c of this.imageProviders.values())for(const g of c.values())g.hasPendingRequests()&&i.push(g);return i}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.x),this._imageRasterizer}isLoaded(){for(const i of this.loaded.keys())if(!this.loaded.get(i))return!1;return!0}setLoaded(i,c){if(this.loaded.get(c)!==i&&(this.loaded.set(c,i),i)){for(const{ids:g,callback:E}of this.requestors)this._notify(g,c,E);this.requestors=[]}}hasImage(i,c){return!!this.getImage(i,c)}getImage(i,c){return this.images.get(c).get(i.toString())}addImage(i,c,g){this._validate(i,g)&&this.images.get(c).set(i.toString(),g)}_validate(i,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new a.y(new Error(`Image "${i.name}" has invalid "content" value`))),g=!1),g}_validateStretch(i,c){if(!i)return!0;let g=0;for(const E of i){if(E[0]<g||E[1]<E[0]||c<E[1])return!1;g=E[1]}return!0}_validateContent(i,c){return i?i.length!==4||!c.usvg&&(i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,c,g){const E=this.images.get(c).get(i.toString());g.version=E.version+1,this.images.get(c).set(i.toString(),g),this.updatedImages.get(c).add(i),this.removeFromImageRasterizerCache(i,c)}clearUpdatedImages(i){this.updatedImages.get(i).clear()}removeFromImageRasterizerCache(i,c){this.spriteFormat!=="raster"&&(a.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([i],c))}removeImage(i,c){const g=this.images.get(c),E=g.get(i.toString());g.delete(i.toString()),this.patterns.get(c).delete(i.toString()),this.removeFromImageRasterizerCache(i,c),E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(i){return Array.from(this.images.get(i).keys()).map(c=>a.I.from(c))}getImages(i,c,g){const E=[],A=[],M=this.imageProviders.get(c);for(const $ of i){if(!$.iconsetId){E.push($);continue}const ie=M.get($.iconsetId);ie&&(this.getImage($,c)?A.push($):ie.addPendingRequest($))}if(E.length===0)return void this._notify(A,c,g);let D=!0;const z=!!this.loaded.get(c),U=this.images.get(c);if(!z)for(const $ of E)U.has($.toString())||(D=!1);z||D?this._notify(E,c,g):this.requestors.push({ids:E,scope:c,callback:g})}rasterizeImages(i,c){const g=new Map,{tasks:E,scope:A}=i;for(const[M,D]of E.entries()){const z=this.getImage(D.id,A);z&&g.set(M,{image:z,imageVariant:D})}this._rasterizeImages(A,g,c)}_rasterizeImages(i,c,g){if(a.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:i},g);else{const E=new Map;for(const[A,{image:M,imageVariant:D}]of c.entries())E.set(A,this.imageRasterizer.rasterize(D,M,i,0));g(void 0,E)}}getUpdatedImages(i){return this.updatedImages.get(i)||new Set}_notify(i,c,g){const E=this.images.get(c),A=new Map;for(const M of i){if(!E.get(M.toString())){if(M.iconsetId)continue;this.fire(new a.z("styleimagemissing",{id:M.name}))}const D=E.get(M.toString());if(!D){a.w(`Image "${M.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const z={data:D.usvg?null:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,usvg:D.usvg,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)};D.usvg&&Object.assign(z,{width:D.icon.usvg_tree.width,height:D.icon.usvg_tree.height}),A.set(a.I.toString(M),z)}g(null,A)}getPixelSize(i){const{width:c,height:g}=this.atlasImage.get(i);return{width:c,height:g}}getPattern(i,c,g){const E=i.toString(),A=this.patterns.get(c),M=A.get(E),D=this.getImage(i,c);if(!D)return null;if(M){if(M.position.version===D.version)return M.position;M.position.version=D.version}else{if(D.usvg&&!D.data){const z=this.getPatternInFlightId(E,c);if(this.patternsInFlight.has(z))return null;this.patternsInFlight.add(z);const U=new a.A(i).scaleSelf(a.o.devicePixelRatio),$=new Map([[U.toString(),{image:D,imageVariant:U}]]);return this._rasterizeImages(c,$,(ie,K)=>this.storePatternImage(U,c,D,g,K)),null}this.storePattern(i,c,D)}return this._updatePatternAtlas(c,g),A.get(E).position}getPatternInFlightId(i,c){return a.B(i,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(i,c,g,E,A){const M=i.toString(),D=A?A.get(M):void 0;D&&(g.data=D,this.storePattern(i.id,c,g),this._updatePatternAtlas(c,E),this.patternsInFlight.delete(this.getPatternInFlightId(i.id.toString(),c)))}storePattern(i,c,g){const E={w:g.data.width+2*a.C,h:g.data.height+2*a.C,x:0,y:0},A=new a.F(E,g,a.C);this.patterns.get(c).set(i.toString(),{bin:E,position:A})}destroyAtlasTextures(){for(const i of this.atlasTexture.values())i&&i.destroy();this.atlasTexture.clear()}bind(i,c){const g=i.gl;let E=this.atlasTexture.get(c);E?this.dirty&&(E.update(this.atlasImage.get(c)),this.dirty=!1):(E=new a.T(i,this.atlasImage.get(c),g.RGBA8),this.atlasTexture.set(c,E)),E.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(i,c){const g=this.patterns.get(i),E=Array.from(g.values()).map(({bin:U})=>U),{w:A,h:M}=a.G(E),D=this.atlasImage.get(i);D.resize({width:A||1,height:M||1});const z=this.images.get(i);for(const[U,{bin:$,position:ie}]of g.entries()){let K=ie.padding;const re=$.x+K,he=$.y+K,ce=z.get(U).data,de=ce.width,ge=ce.height;K=K>1?K-1:K,a.q.copy(ce,D,{x:0,y:0},{x:re,y:he},{width:de,height:ge},c),a.q.copy(ce,D,{x:0,y:ge-K},{x:re,y:he-K},{width:de,height:K},c),a.q.copy(ce,D,{x:0,y:0},{x:re,y:he+ge},{width:de,height:K},c),a.q.copy(ce,D,{x:de-K,y:0},{x:re-K,y:he},{width:K,height:ge},c),a.q.copy(ce,D,{x:0,y:0},{x:re+de,y:he},{width:K,height:ge},c),a.q.copy(ce,D,{x:de-K,y:ge-K},{x:re-K,y:he-K},{width:K,height:K},c),a.q.copy(ce,D,{x:0,y:ge-K},{x:re+de,y:he-K},{width:K,height:K},c),a.q.copy(ce,D,{x:0,y:0},{x:re+de,y:he+ge},{width:K,height:K},c),a.q.copy(ce,D,{x:de-K,y:0},{x:re-K,y:he+ge},{width:K,height:K},c)}this.dirty=!0}beginFrame(){for(const i of this.images.keys())this.callbackDispatchedThisFrame.set(i,new Set)}dispatchRenderCallbacks(i,c){const g=this.images.get(c);for(const E of i){if(this.callbackDispatchedThisFrame.get(c).has(E.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(E.toString());const A=g.get(E.toString());Xr(A)&&this.updateImage(E,c,A)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Un(m){const i=m.value,c=m.valueSpec,g=m.style,E=m.styleSpec,A=m.key,M=m.arrayElementValidator||Tr;if(!Array.isArray(i))return[new a.V(A,i,`array expected, ${a.K(i)} found`)];if(c.length&&i.length!==c.length)return[new a.V(A,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new a.V(A,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let D={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};E.$version<7&&(D.function=c.function),a.H(c.value)&&(D=c.value);let z=[];for(let U=0;U<i.length;U++)z=z.concat(M({array:i,arrayIndex:U,value:i[U],valueSpec:D,style:g,styleSpec:E,key:`${A}[${U}]`},!0));return z}function dn(m){const i=m.key,c=m.value,g=m.valueSpec;if(!a.L(c))return[new a.V(i,c,`number expected, ${a.K(c)} found`)];if(c!=c)return[new a.V(i,c,"number expected, NaN found")];if("minimum"in g){let E=g.minimum;if(Array.isArray(g.minimum)&&(E=g.minimum[m.arrayIndex]),c<E)return[new a.V(i,c,`${c} is less than the minimum value ${E}`)]}if("maximum"in g){let E=g.maximum;if(Array.isArray(g.maximum)&&(E=g.maximum[m.arrayIndex]),c>E)return[new a.V(i,c,`${c} is greater than the maximum value ${E}`)]}return[]}function os(m){const i=m.key,c=m.value;if(!a.H(c))return[new a.V(i,c,`object expected, ${a.K(c)} found`)];const g=m.valueSpec,E=a.J(c.type);let A,M,D,z={};const U=E!=="categorical"&&c.property===void 0,$=!U,ie=(function(ce){const de=ce.stops;return Array.isArray(de)&&Array.isArray(de[0])&&a.H(de[0][0])})(c),K=$i({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ce){if(E==="identity")return[new a.V(ce.key,ce.value,'identity function may not have a "stops" property')];let de=[];const ge=ce.value;return de=de.concat(Un({key:ce.key,value:ge,valueSpec:ce.valueSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:re})),Array.isArray(ge)&&ge.length===0&&de.push(new a.V(ce.key,ge,"array must have at least one stop")),de},default:function(ce){return Tr({key:ce.key,value:ce.value,valueSpec:g,style:ce.style,styleSpec:ce.styleSpec})}}});return E==="identity"&&U&&K.push(new a.V(m.key,m.value,'missing required property "property"')),E==="identity"||c.stops||K.push(new a.V(m.key,m.value,'missing required property "stops"')),E==="exponential"&&g.expression&&!a.M(g)&&K.push(new a.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&($&&!a.N(g)?K.push(new a.V(m.key,m.value,"property functions not supported")):U&&!a.O(g)&&K.push(new a.V(m.key,m.value,"zoom functions not supported"))),E!=="categorical"&&!ie||c.property!==void 0||K.push(new a.V(m.key,m.value,'"property" property is required')),K;function re(ce){let de=[];const ge=ce.value,Ce=ce.key;if(!Array.isArray(ge))return[new a.V(Ce,ge,`array expected, ${a.K(ge)} found`)];if(ge.length!==2)return[new a.V(Ce,ge,`array length 2 expected, length ${ge.length} found`)];if(ie){if(!a.H(ge[0]))return[new a.V(Ce,ge,`object expected, ${a.K(ge[0])} found`)];const Ae=ge[0];if(Ae.zoom===void 0)return[new a.V(Ce,ge,"object stop key must have zoom")];if(Ae.value===void 0)return[new a.V(Ce,ge,"object stop key must have value")];const Ee=a.J(Ae.zoom);if(typeof Ee!="number")return[new a.V(Ce,Ae.zoom,"stop zoom values must be numbers")];if(D&&D>Ee)return[new a.V(Ce,Ae.zoom,"stop zoom values must appear in ascending order")];Ee!==D&&(D=Ee,M=void 0,z={}),de=de.concat($i({key:`${Ce}[0]`,value:ge[0],valueSpec:{zoom:{}},style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:dn,value:he}}))}else de=de.concat(he({key:`${Ce}[0]`,value:ge[0],style:ce.style,styleSpec:ce.styleSpec},ge));return a.Q(a.S(ge[1]))?de.concat([new a.V(`${Ce}[1]`,ge[1],"expressions are not allowed in function stops.")]):de.concat(Tr({key:`${Ce}[1]`,value:ge[1],valueSpec:g,style:ce.style,styleSpec:ce.styleSpec}))}function he(ce,de){const ge=a.K(ce.value),Ce=a.J(ce.value),Ae=ce.value!==null?ce.value:de;if(A){if(ge!==A)return[new a.V(ce.key,Ae,`${ge} stop domain type must match previous stop domain type ${A}`)]}else A=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean"&&typeof Ce!="number"&&typeof Ce!="string"&&typeof Ce!="boolean")return[new a.V(ce.key,Ae,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&E!=="categorical"){let Ee=`number expected, ${ge} found`;return a.N(g)&&E===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(ce.key,Ae,Ee)]}return E!=="categorical"||ge!=="number"||typeof Ce=="number"&&isFinite(Ce)&&Math.floor(Ce)===Ce?E!=="categorical"&&ge==="number"&&typeof Ce=="number"&&typeof M=="number"&&M!==void 0&&Ce<M?[new a.V(ce.key,Ae,"stop domain values must appear in ascending order")]:(M=Ce,E==="categorical"&&Ce in z?[new a.V(ce.key,Ae,"stop domain values must be unique")]:(z[Ce]=!0,[])):[new a.V(ce.key,Ae,`integer expected, found ${String(Ce)}`)]}}function Dr(m){const i=(m.expressionContext==="property"?a.W:a.U)(a.S(m.value),m.valueSpec);if(i.result==="error")return i.value.map(g=>new a.V(`${m.key}${g.key}`,m.value,g.message));const c=i.value.expression||i.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!c.outputDefined())return[new a.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!a.Z(c))return[new a.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return jn(c,m);if(m.expressionContext==="appearance")return Rn(c,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!a.X(c,["zoom","feature-state"]))return[new a.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!a.Y(c))return[new a.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jn(m,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const E of i.valueSpec.expression.parameters)c.delete(E);if(c.size===0)return[];const g=[];return m instanceof a._&&c.has(m.name)?[new a.V(i.key,i.value,`["${m.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(m.eachChild(E=>{g.push(...jn(E,i))}),g)}function Rn(m,i){const c=new Set;if(i.valueSpec&&i.valueSpec.expression)for(const E of i.valueSpec.expression.parameters)c.add(E);if(c.size===0)return[];const g=[];return m instanceof a._&&!c.has(m.name)?[new a.V(i.key,i.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(E=>{g.push(...Rn(E,i))}),g)}function ys(m){const i=m.key,c=m.value,g=m.valueSpec,E=[];return Array.isArray(g.values)?g.values.indexOf(a.J(c))===-1&&E.push(new a.V(i,c,`expected one of [${g.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(g.values).indexOf(a.J(c))===-1&&E.push(new a.V(i,c,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(c)} found`)),E}function As(m){return a.a2(a.S(m.value))?Dr(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):sa(m)}function sa(m){const i=m.value,c=m.key;if(!Array.isArray(i))return[new a.V(c,i,`array expected, ${a.K(i)} found`)];if(i.length<1)return[new a.V(c,i,"filter array must have at least 1 element")];const g=m.styleSpec;let E=ys({key:`${c}[0]`,value:i[0],valueSpec:g.filter_operator});const A=()=>{i.length>=2&&(a.a0(i[1])||E.push(new a.V(`${c}[1]`,i[1],`string expected, ${a.K(i[1])} found`)));for(let M=2;M<i.length;M++)a.J(i[1])==="$type"?E=E.concat(ys({key:`${c}[${M}]`,value:i[M],valueSpec:g.geometry_type})):a.a0(i[M])||a.L(i[M])||a.$(i[M])||E.push(new a.V(`${c}[${M}]`,i[M],`string, number, or boolean expected, ${a.K(i[M])} found.`))};switch(a.J(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&a.J(i[1])==="$type"&&E.push(new a.V(c,i,`"$type" cannot be use with operator "${i[0]}"`)),i.length!==3&&E.push(new a.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`)),A();break;case"==":case"!=":i.length!==3&&E.push(new a.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`)),A();break;case"in":case"!in":A();break;case"any":case"all":case"none":for(let M=1;M<i.length;M++)E=E.concat(sa({key:`${c}[${M}]`,value:i[M],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":i.length!==2?E.push(new a.V(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):a.a0(i[1])||E.push(new a.V(`${c}[1]`,i[1],`string expected, ${a.K(i[1])} found`))}return E}function bn(m,i){const c=m.key,g=m.style,E=m.layer,A=m.styleSpec,M=m.value,D=m.objectKey,z=A[`${i}_${m.layerType}`];if(!z)return[];const U=D.match(/^(.*)-use-theme$/);if(U&&z[U[1]])return a.Q(a.S(M))?[].concat(Tr({key:c,value:M,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:A,expressionContext:"property",propertyType:i,propertyKey:D})):Tr({key:c,value:M,valueSpec:{type:"string"},style:g,styleSpec:A});const $=D.match(/^(.*)-transition$/);if(i==="paint"&&$&&z[$[1]]&&z[$[1]].transition)return Tr({key:c,value:M,valueSpec:A.transition,style:g,styleSpec:A});const ie=m.valueSpec||z[D];if(!ie)return[new a.a3(c,M,`unknown property "${D}"`)];let K;if(a.a0(M)&&a.N(ie)&&!ie.tokens&&(K=/^{([^}]+)}$/.exec(M))){const he=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new a.V(c,M,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${he}.`)]}const re=[];if(m.layerType==="symbol")D!=="text-field"||!g||g.glyphs||g.imports||re.push(new a.V(c,M,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&a.a4(a.S(M))&&a.J(M.type)==="identity"&&re.push(new a.V(c,M,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&i==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&a.N(ie)&&(a.a5(ie)||a.O(ie))){const he=a.W(a.S(M),ie).value,ce="expression"in he&&he.expression||"_styleExpression"in he&&he._styleExpression&&he._styleExpression.expression;ce&&!a.X(ce,["measure-light"])&&(D==="model-emissive-strength"&&a.Y(ce)&&a.Z(ce)||re.push(new a.V(c,M,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return re.concat(Tr({key:m.key,value:M,valueSpec:ie,style:g,styleSpec:A,expressionContext:"property",propertyType:i,propertyKey:D}))}function Al(m){return bn(m,"paint")}function _s(m){return bn(m,"layout")}function Co(m){let i=[];const c=m.value,g=m.key,E=m.style,A=m.styleSpec;if(!a.H(c))return[new a.V(g,c,"object expected")];c.type||c.ref||i.push(new a.V(g,c,'either "type" or "ref" is required'));let M=a.J(c.type);const D=a.J(c.ref);if(c.id){const z=a.J(c.id);for(let U=0;U<m.arrayIndex;U++){const $=E.layers[U];a.J($.id)===z&&i.push(new a.V(g,c.id,`duplicate layer id "${z}", previously used at line ${$.id.__line__}`))}}if("ref"in c){let z;["type","source","source-layer","filter","layout"].forEach(U=>{U in c&&i.push(new a.V(g,c[U],`"${U}" is prohibited for ref layers`))}),E.layers.forEach(U=>{a.J(U.id)===D&&(z=U)}),z?z.ref?i.push(new a.V(g,c.ref,"ref cannot reference another ref layer")):M=a.J(z.type):typeof D=="string"&&i.push(new a.V(g,c.ref,`ref layer "${D}" not found`))}else if(M!=="background"&&M!=="sky"&&M!=="slot")if(c.source)if(a.a0(c.source)){const z=E.sources&&E.sources[c.source],U=z&&a.J(z.type);z?U==="vector"&&M==="raster"?i.push(new a.V(g,c.source,`layer "${c.id}" requires a raster source`)):U==="raster"&&M!=="raster"?i.push(new a.V(g,c.source,`layer "${c.id}" requires a vector source`)):U!=="vector"||c["source-layer"]?U==="raster-dem"&&M!=="hillshade"?i.push(new a.V(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):U!=="raster-array"||["raster","raster-particle"].includes(M)?M==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&U==="geojson"&&!z.lineMetrics?i.push(new a.V(g,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):M==="raster-particle"&&U!=="raster-array"&&i.push(new a.V(g,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):i.push(new a.V(g,c.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new a.V(g,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new a.V(g,c.source,`source "${c.source}" not found`))}else i.push(new a.V(`${g}.source`,c.source,'"source" must be a string'));else i.push(new a.V(g,c,'missing required property "source"'));return i=i.concat($i({key:g,value:c,valueSpec:A.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Tr({key:`${g}.type`,value:c.type,valueSpec:A.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:z=>As(Object.assign({layerType:M},z)),layout:z=>$i({layer:c,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":U=>_s(Object.assign({layerType:M},U))}}),paint:z=>$i({layer:c,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":U=>Al(Object.assign({layerType:M,layer:c},U))}}),appearances(z){const U=Un({key:z.key,value:z.value,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:K=>(function(re){const{key:he,layer:ce,layerType:de}=re,ge=a.J(re.value),Ce=a.J(ge.name),Ae=a.J(ge.condition),Ee=$i({key:he,value:ge,valueSpec:re.styleSpec.appearance,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{condition:Ge=>(function(je){const Ue=[];return Ue.push(...Dr({key:je.key,value:je.object.condition,valueSpec:a.a6.appearance.condition,expressionContext:"appearance"})),Ue})(Object.assign({layer:ce,layerType:de},Ge)),properties:Ge=>(function(je){const Ue=[],{styleSpec:ze,layer:Pe,layerType:We}=je,Xe=ze[`paint_${We}`],Qe=ze[`layout_${We}`],rt=je.object[je.objectKey];for(const tt in rt){const pt=tt in Xe?"paint":tt in Qe?"layout":void 0;if(!pt){Ue.push(new a.V(je.key,tt,`unknown property "${tt}" for layer type "${We}"`));continue}const wt=Object.assign({},je,{key:`${je.key}.${tt}`,object:rt,objectKey:tt,layer:Pe,layerType:We,value:rt[tt],valueSpec:pt==="paint"?Xe[tt]:Qe[tt]});Ue.push(...bn(wt,pt))}return Ue})(Object.assign({layer:ce,layerType:de},Ge))}});return Ce!=="hidden"&&Ae===void 0&&Ee.push(new a.V(re.key,"name",'Appearance with name different than "hidden" must have a condition')),Ee})(Object.assign({layerType:M,layer:c},K))}),$=Array.isArray(z.value)?z.value:[],ie=new Set;return $.forEach((K,re)=>{const he=a.J(K.name);if(he)if(ie.has(he)){const ce=a.J(c.id);U.push(new a.V(z.key,he,`Duplicated appearance name "${he}" for layer "${ce}"`))}else ie.add(he)}),U}}})),i}function Zn({key:m,value:i}){return a.a0(i)?[]:[new a.V(m,i,`string expected, ${a.K(i)} found`)]}const Sn={promoteId:function m({key:i,value:c}){if(a.a0(c))return Zn({key:i,value:c});if(Array.isArray(c)){const E=[],A=a.S(c),M=a.U(A);return M.result==="error"&&M.value.forEach(D=>{E.push(new a.V(`${i}${D.key}`,null,`${D.message}`))}),a.X(M.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||E.push(new a.V(`${i}`,null,"promoteId expression should be only feature dependent")),E}if(!a.H(c))return[new a.V(i,c,`string, expression or object expected, "${a.K(c)}" found`)];const g=[];for(const E in c)g.push(...m({key:`${i}.${E}`,value:c[E]}));return g}};function $n(m){const i=m.value,c=m.key,g=m.styleSpec,E=m.style;if(!a.H(i))return[new a.V(c,i,`object expected, ${a.K(i)} found`)];if(!("type"in i))return[new a.V(c,i,'"type" is required')];const A=a.J(i.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(A)&&("url"in i||"tiles"in i||M.push(new a.a3(c,i,'Either "url" or "tiles" is required.'))),A){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat($i({key:c,value:i,valueSpec:g[`source_${A.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Sn})),M;case"geojson":if(M=$i({key:c,value:i,valueSpec:g.source_geojson,style:E,styleSpec:g,objectElementValidators:Sn}),"cluster"in i&&"clusterProperties"in i){if(!a.H(i.clusterProperties))return[new a.V(`${c}.clusterProperties`,i,`object expected, ${a.K(i)} found`)];for(const D in i.clusterProperties){const z=i.clusterProperties[D];if(!Array.isArray(z))return[new a.V(`${c}.clusterProperties.${D}`,z,"array expected")];const[U,$]=z,ie=typeof U=="string"?[U,["accumulated"],["get",D]]:U;M.push(...Dr({key:`${c}.${D}.map`,value:$,expressionContext:"cluster-map"})),M.push(...Dr({key:`${c}.${D}.reduce`,value:ie,expressionContext:"cluster-reduce"}))}}return M;case"video":return $i({key:c,value:i,valueSpec:g.source_video,style:E,styleSpec:g});case"image":return $i({key:c,value:i,valueSpec:g.source_image,style:E,styleSpec:g});case"canvas":return[new a.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ys({key:`${c}.type`,value:i.type,valueSpec:{values:Ro(g)}})}}function Ro(m){return m.source.reduce((i,c)=>{const g=m[c];return g.type.type==="enum"&&(i=i.concat(Object.keys(g.type.values||{}))),i},[])}function ao(m){const i=m.value,c=m.styleSpec,g=c.light,E=m.style;if(i===void 0)return[];if(!a.H(i))return[new a.V("light",i,`object expected, ${a.K(i)} found`)];let A=[];for(const M in i){const D=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);A=A.concat(z&&g[z[1]]?Tr({key:M,value:i[M],valueSpec:{type:"string"},style:E,styleSpec:c}):D&&g[D[1]]&&g[D[1]].transition?Tr({key:M,value:i[M],valueSpec:c.transition,style:E,styleSpec:c}):g[M]?Tr({key:M,value:i[M],valueSpec:g[M],style:E,styleSpec:c}):[new a.V(M,i[M],`unknown property "${M}"`)])}return A}function Ls(m){const i=m.value;if(!i)return[];const c=m.key;if(!a.H(i))return[new a.V(c,i,`object expected, ${a.K(i)} found`)];let g=[];const E=m.styleSpec,A=E["light-3d"],M=m.style,D=m.style.lights;for(const $ of["type","id"])if(!($ in i))return g=g.concat([new a.V(c,i,`missing property "${$}"`)]),g;if(!a.a0(i.type))return g=g.concat([new a.V(`${c}.type`,i.type,"string expected")]),g;if(D)for(let $=0;$<m.arrayIndex;$++){const ie=a.J(i.type),K=D[$];a.J(K.type)===ie&&g.push(new a.V(c,i.id,`duplicate light type "${i.type}", previously defined at line ${K.id.__line__}`))}const z=`properties_light_${i.type}`;if(!(z in E))return g=g.concat([new a.V(`${c}.type`,i,`Invalid light type ${i.type}`)]),g;const U=E[z];for(const $ in i)if($==="properties"){const ie=i[$];if(!a.H(ie))return g=g.concat([new a.V("properties",ie,`object expected, ${a.K(ie)} found`)]),g;for(const K in ie){const re=K.match(/^(.*)-transition$/),he=K.match(/^(.*)-use-theme$/);g=g.concat(he&&U[he[1]]?Tr({key:$,value:ie[K],valueSpec:{type:"string"},style:M,styleSpec:E}):re&&U[re[1]]&&U[re[1]].transition?Tr({key:$,value:i[$],valueSpec:E.transition,style:M,styleSpec:E}):U[K]?Tr({key:K,value:ie[K],valueSpec:U[K],style:M,styleSpec:E}):[new a.a3(m.key,ie[K],`unknown property "${K}"`)])}}else g=g.concat(A[$]?Tr({key:$,value:i[$],valueSpec:A[$],style:M,styleSpec:E}):[new a.a3($,i[$],`unknown property "${$}"`)]);return g}function qa(m){const i=m.value,c=m.key,g=m.style,E=m.styleSpec,A=E.terrain;if(i==null)return[];if(!a.H(i))return[new a.V("terrain",i,`object expected, ${a.K(i)} found`)];let M=[];for(const D in i){const z=D.match(/^(.*)-transition$/),U=D.match(/^(.*)-use-theme$/);M=M.concat(U&&A[U[1]]?Tr({key:D,value:i[D],valueSpec:{type:"string"},style:g,styleSpec:E}):z&&A[z[1]]&&A[z[1]].transition?Tr({key:D,value:i[D],valueSpec:E.transition,style:g,styleSpec:E}):A[D]?Tr({key:D,value:i[D],valueSpec:A[D],style:g,styleSpec:E}):[new a.a3(D,i[D],`unknown property "${D}"`)])}if(i.source)if(a.a0(i.source)){const D=g.sources&&g.sources[i.source],z=D&&a.J(D.type);D?z!=="raster-dem"&&M.push(new a.V(`${c}.source`,i.source,`terrain cannot be used with a source of type ${z}, it only be used with a "raster-dem" source type`)):M.push(new a.V(`${c}.source`,i.source,`source "${i.source}" not found`))}else M.push(new a.V(`${c}.source`,i.source,"source must be a string"));else M.push(new a.V(c,i,'terrain is missing required property "source"'));return M}function Wa(m){const i=m.value,c=m.style,g=m.styleSpec,E=g.fog;if(i===void 0)return[];if(!a.H(i))return[new a.V("fog",i,`object expected, ${a.K(i)} found`)];let A=[];for(const M in i){const D=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);A=A.concat(z&&E[z[1]]?Tr({key:M,value:i[M],valueSpec:{type:"string"},style:c,styleSpec:g}):D&&E[D[1]]&&E[D[1]].transition?Tr({key:M,value:i[M],valueSpec:g.transition,style:c,styleSpec:g}):E[M]?Tr({key:M,value:i[M],valueSpec:E[M],style:c,styleSpec:g}):[new a.a3(M,i[M],`unknown property "${M}"`)])}return A}const oo={"*":()=>[],array:Un,boolean:function(m){const i=m.value,c=m.key;return a.$(i)?[]:[new a.V(c,i,`boolean expected, ${a.K(i)} found`)]},number:dn,color:function({key:m,value:i}){return a.a0(i)?a.a1.parseCSSColor(i)===null?[new a.V(m,i,`color expected, "${i}" found`)]:[]:[new a.V(m,i,`color expected, ${a.K(i)} found`)]},enum:ys,filter:As,function:os,layer:Co,object:$i,source:$n,model:a.a7,light:ao,"light-3d":Ls,terrain:qa,fog:Wa,string:Zn,formatted:function(m){return Zn(m).length===0?[]:Dr(m)},resolvedImage:function(m){return Zn(m).length===0?[]:Dr(m)},projection:function(m){const i=m.value,c=m.styleSpec,g=c.projection,E=m.style;if(a.H(i)){let A=[];for(const M in i)A=A.concat(Tr({key:M,value:i[M],valueSpec:g[M],style:E,styleSpec:c}));return A}return a.a0(i)?[]:[new a.V("projection",i,`object or string expected, ${a.K(i)} found`)]},import:function(m){const i=m.key,{value:c,styleSpec:g}=m;if(!a.H(c))return[new a.V(i,c,"import must be an object")];const{data:E,...A}=c;Object.defineProperty(A,"__line__",{value:c.__line__,enumerable:!1});let M=$i(Object.assign({},m,{value:A,valueSpec:g.import}));return a.J(A.id)===""&&M.push(new a.V(`${m.key}.id`,A,"import id can't be an empty string")),E&&(M=M.concat(Xn(E,g,{key:`${m.key}.data`}))),M},iconset:function(m){const i=m.value,c=m.key,g=m.styleSpec,E=m.style;if(!a.H(i))return[new a.V(c,i,"object expected")];if(!i.type)return[new a.V(c,i,'"type" is required')];const A=a.J(i.type);let M=[];if(M=M.concat($i({key:c,value:i,valueSpec:g[`iconset_${A}`],style:E,styleSpec:g})),(function(D,z){return!(D!=="source"||!z.source)})(A,i)){const D=E.sources&&E.sources[i.source],z=D&&a.J(D.type);D?z!=="raster-array"&&M.push(new a.V(c,i.source,`iconset cannot be used with a source of type ${String(z)}, it only be used with a "raster-array" source type`)):M.push(new a.V(c,i.source,`source "${i.source}" not found`))}return M}};function Tr(m,i=!1){const c=m.value,g=m.valueSpec,E=m.styleSpec;if(g.expression){if(a.a4(a.J(c)))return os(m);if(a.Q(a.S(c)))return Dr(m)}if(g.type&&oo[g.type]){const A=oo[g.type](m);return i===!0&&A.length>0&&Array.isArray(m.value)?Dr(m):A}return $i(Object.assign({},m,{valueSpec:g.type?E[g.type]:g}))}function $i(m){const i=m.key,c=m.value,g=m.valueSpec||{},E=m.objectElementValidators||{},A=m.style,M=m.styleSpec;if(!a.H(c))return[new a.V(i,c,`object expected, ${a.K(c)} found`)];let D=[];for(const z in c){const U=z.split(".")[0];let $;E[U]?$=E[U]:g[U]?$=Tr:E["*"]?$=E["*"]:g["*"]&&($=Tr),$?D=D.concat($({key:(i&&`${i}.`)+z,value:c[z],valueSpec:g[U]||g["*"],style:A,styleSpec:M,object:c,objectKey:z},c)):D.push(new a.a3(i,c[z],`unknown property "${z}"`))}for(const z in g){if(E[z])continue;const U=g[z];U.required&&U.default===void 0&&c[z]===void 0&&D.push(new a.V(i,c,`missing required property "${z}"`))}return D}function Mn({key:m,value:i}){const c=Zn({key:m,value:i});if(c.length)return c;const g=i;return g.indexOf("{fontstack}")===-1&&c.push(new a.V(m,i,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&c.push(new a.V(m,i,'"glyphs" url must include a "{range}" token')),c}function Xn(m,i=a.a6,c={}){return $i({key:c.key||"",value:m,valueSpec:Object.assign(i.$root,{"*":{type:"*"}}),styleSpec:i,style:m,objectElementValidators:{glyphs:Mn}})}function Tn(m,i=a.a6){return Oe(Xn(m,i))}const tl=m=>Oe($n(m)),An=m=>Oe(ao(m)),Pt=m=>Oe(Ls(m)),ga=m=>Oe(qa(m)),aa=m=>Oe(Wa(m)),Os=m=>Oe((function(i){const c=i.value,g=i.style,E=i.styleSpec,A=E.snow;if(c===void 0)return[];if(!a.H(c))return[new a.V("snow",c,`object expected, ${a.K(c)} found`)];let M=[];for(const D in c){const z=D.match(/^(.*)-transition$/);M=M.concat(z&&A[z[1]]&&A[z[1]].transition?Tr({key:D,value:c[D],valueSpec:E.transition,style:g,styleSpec:E}):A[D]?Tr({key:D,value:c[D],valueSpec:A[D],style:g,styleSpec:E}):[new a.a3(D,c[D],`unknown property "${D}"`)])}return M})(m)),tr=m=>Oe((function(i){const c=i.value,g=i.style,E=i.styleSpec,A=E.rain;if(c===void 0)return[];if(!a.H(c))return[new a.V("rain",c,`object expected, ${a.K(c)} found`)];let M=[];for(const D in c){const z=D.match(/^(.*)-transition$/);M=M.concat(z&&A[z[1]]&&A[z[1]].transition?Tr({key:D,value:c[D],valueSpec:E.transition,style:g,styleSpec:E}):A[D]?Tr({key:D,value:c[D],valueSpec:A[D],style:g,styleSpec:E}):[new a.a3(D,c[D],`unknown property "${D}"`)])}return M})(m)),Je=m=>Oe(Co(m)),me=m=>Oe(As(m)),ve=m=>Oe(Al(m)),De=m=>Oe(_s(m)),qe=m=>Oe(a.a7(m));function Oe(m){return m.slice().sort((i,c)=>i.line&&c.line?i.line-c.line:0)}function Ke(m,i){let c=!1;if(i&&i.length)for(const g of i)g instanceof a.a3?a.w(g.message):(m.fire(new a.y(new Error(g.message))),c=!0);return c}const ut=a.a6.light;let et;class dt extends a.E{constructor(i,c="flat"){super(),this._transitionable=new a.a8(et||(et=new a.a9({anchor:new a.aa(ut.anchor),position:new a.ab(ut.position),color:new a.aa(ut.color),intensity:new a.aa(ut.intensity)}))),this.setLight(i,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c,g={}){this._validate(An,i,g)||(this._transitionable.setTransitionOrValue(i),this.id=c)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g){return(!g||g.validate!==!1)&&Ke(this,i.call(Tn,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}const Ft=a.a6.terrain;let It=class extends a.E{constructor(m,i,c,g,E){super(),this.scope=c,this._transitionable=new a.a8(new a.a9({source:new a.aa(Ft.source),exaggeration:new a.aa(Ft.exaggeration)}),c,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i,this.worldview=E}get(){return this._transitionable.serialize()}set(m,i){this._transitionable.setTransitionOrValue(m,i)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new a.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const i=m.value.expression;if(!i)return null;let c=-1,g=-1,E=1;for(const A of i.zoomStops)E=i.evaluate(new a.ac(A,{worldview:this.worldview})),E>.01?(c=A,g=-1):g=A;return E<.01&&c>0&&g>c?[c,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof a.ad}};const ii=.05;function yi(m,i,c,g){const E=a.ah(45,65,c),[A,M]=wi(m,g);let D=1-Math.min(1,Math.exp((i-A)/(M-A)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*E*m.alpha}function wi(m,i){const c=.5/Math.tan(.5*i);return[m.range[0]+c,m.range[1]+c]}function Li(m,i,c,g,E){const A=a.af([],[i,c,g],E.mercatorFogMatrix);return yi(m,a.ag(A),E.pitch,E._fov)}function Vi(m,i,c,g,E,A,M){const D=[[c,g,0],[E,g,0],[E,A,0],[c,A,0]];let z=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(const $ of D){const ie=a.af([],$,i),K=a.ag(ie);z=Math.min(z,K),U=Math.max(U,K)}return[yi(m,z,M.pitch,M._fov),yi(m,U,M.pitch,M._fov)]}const xi=a.a6.fog;class Pi extends a.E{constructor(i,c,g,E){super();const A=new a.a9({range:new a.aa(xi.range),color:new a.aa(xi.color),"color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.aa(xi["high-color"]),"high-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.aa(xi["space-color"]),"space-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.aa(xi["horizon-blend"]),"star-intensity":new a.aa(xi["star-intensity"]),"vertical-range":new a.aa(xi["vertical-range"])});this._transitionable=new a.a8(A,g,new Map(E)),this.set(i,E),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new a.ai(A),this.scope=g}get state(){const i=this._transform,c=i.projection.name==="globe",g=a.aj(i.zoom),E=this.properties.get("range"),A=[.5,3];return{range:c?[a.ak(A[0],E[0],g),a.ak(A[1],E[1],g)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c,g={}){if(this._validate(aa,i,g))return;const E=Object.assign({},i);for(const A of Object.keys(xi))E[A]===void 0&&(E[A]=xi[A].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ah(45,65,i))*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?(function(g,E,A){const M=a.ae.fromLngLat(E),D=A.elevation?A.elevation.getAtPointOrZero(M):0;return Li(g,M.x,M.y,D,A)})(this.state,i,c):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Vi(this.state,c,0,0,a.al,a.al,this._transform)}getOpacityForBounds(i,c,g,E,A){return this._transform.projection.supportsFog?Vi(this.state,i,c,g,E,A,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?wi(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const g of c){const E=i.points[g];let A;if(E[2]>=0)A=E;else{const M=i.points[g-4];A=a.am(M,E,M[2]/(M[2]-E[2]))}if(Li(this.state,A[0],A[1],0,this._transform)>=ii)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g){return(!g||g.validate!==!1)&&Ke(this,i.call(Tn,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let Fr,fn,Wr,wn=class extends a.E{constructor(m,i,c,g){super();const E=Fr||(Fr=new a.a9({density:new a.aa(a.a6.snow.density),intensity:new a.aa(a.a6.snow.intensity),color:new a.aa(a.a6.snow.color),opacity:new a.aa(a.a6.snow.opacity),vignette:new a.aa(a.a6.snow.vignette),"vignette-color":new a.aa(a.a6.snow["vignette-color"]),"center-thinning":new a.aa(a.a6.snow["center-thinning"]),direction:new a.aa(a.a6.snow.direction),"flake-size":new a.aa(a.a6.snow["flake-size"])}));this._transitionable=new a.a8(E,c,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(E),this.scope=c}get state(){const m=this.properties.get("opacity"),i=this.properties.get("color"),c=this.properties.get("direction"),g=a.an(c[0]),E=-Math.max(a.an(c[1]),.01),A=[Math.cos(g)*Math.cos(E),Math.sin(g)*Math.cos(E),Math.sin(E)],M=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=M,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(i.r,i.g,i.b,i.a*m),direction:A,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(m,i,c={}){if(this._validate(Os,m,c))return;const g=Object.assign({},m),E=a.a6.snow;for(const A of Object.keys(E))g[A]===void 0&&(g[A]=E[A].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,i,c){return(!c||c.validate!==!1)&&Ke(this,m.call(Tn,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}},qr=class extends a.E{constructor(m,i,c,g){super();const E=fn||(fn=new a.a9({density:new a.aa(a.a6.rain.density),intensity:new a.aa(a.a6.rain.intensity),color:new a.aa(a.a6.rain.color),opacity:new a.aa(a.a6.rain.opacity),vignette:new a.aa(a.a6.rain.vignette),"vignette-color":new a.aa(a.a6.rain["vignette-color"]),"center-thinning":new a.aa(a.a6.rain["center-thinning"]),direction:new a.aa(a.a6.rain.direction),"droplet-size":new a.aa(a.a6.rain["droplet-size"]),"distortion-strength":new a.aa(a.a6.rain["distortion-strength"])}));this._transitionable=new a.a8(E,c,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(E),this.scope=c}get state(){const m=this.properties.get("opacity"),i=this.properties.get("color"),c=this.properties.get("direction"),g=a.an(c[0]),E=-Math.max(a.an(c[1]),.01),A=[Math.cos(g)*Math.cos(E),Math.sin(g)*Math.cos(E),Math.sin(E)],M=this.properties.get("vignette-color");return M.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(i.r,i.g,i.b,i.a*m),direction:A,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(m,i,c={}){if(this._validate(tr,m,c))return;const g=Object.assign({},m),E=a.a6.rain;for(const A of Object.keys(E))g[A]===void 0&&(g[A]=E[A].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,i,c){return(!c||c.validate!==!1)&&Ke(this,m.call(Tn,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}};class rr extends a.E{constructor(i,c,g,E){super(),this.scope=g,this._options=i,this.properties=new a.ai(c),this._transitionable=new a.a8(c,g,new Map(E)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,c){this._options=i,this._transitionable.setTransitionOrValue(i.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Yr=()=>Wr||(Wr=new a.a9({color:new a.aa(a.a6.properties_light_ambient.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_ambient.intensity)}));let Ar;const Cr=()=>Ar||(Ar=new a.a9({direction:new a.ap(a.a6.properties_light_directional.direction),color:new a.aa(a.a6.properties_light_directional.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_directional.intensity),"cast-shadows":new a.aa(a.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new a.aa(a.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.aa(a.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new a.aa(a.a6.properties_light_directional["shadow-draw-before-layer"])}));class Br{constructor(i,c,g){this.screenBounds=i,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,c){let g,E;if(i instanceof a.P||typeof i[0]=="number"){const A=a.P.convert(i);g=[A],E=c.isPointAboveHorizon(A)}else{const A=a.P.convert(i[0]),M=a.P.convert(i[1]),D=A.add(M)._div(2);g=[A,M],E=a.aq(A,M).every(z=>c.isPointAboveHorizon(z))&&c.isPointAboveHorizon(D)}return new Br(g,E,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return a.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],E=a.aq(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?E[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(E[3]=this.cameraPoint)),a.ar(E,i)}bufferedCameraGeometryGlobe(i){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],E=a.aq(c,g,i),A=this.cameraPoint.clone();switch(3*((A.y>c.y)+(A.y>g.y))+((A.x>c.x)+(A.x>g.x))){case 0:E[0]=A,E[4]=A.clone();break;case 1:E.splice(1,0,A);break;case 2:E[1]=A;break;case 3:E.splice(4,0,A);break;case 5:E.splice(2,0,A);break;case 6:E[3]=A;break;case 7:E.splice(3,0,A);break;case 8:E[2]=A}return E}containsTile(i,c,g,E=0){const A=Math.max(i.queryPadding,i.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,M=g?this._bufferedCameraMercator(A,c):this._bufferedScreenMercator(A,c);let D=i.tileID.wrap+(M.unwrapped?E:0);const z=M.polygon.map(de=>a.as(i.tileTransform,de,D));if(!a.at(z,0,0,a.al,a.al))return;D=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const U=this.screenGeometryMercator.polygon.map(de=>a.au(i.tileTransform,de,D)),$=U.map(de=>new a.P(de[0],de[1])),ie=c.getFreeCameraOptions().position||new a.ae(0,0,0),K=a.au(i.tileTransform,ie,D),re=U.map(de=>{const ge=a.av(de,de,K);return a.aw(ge,ge),new a.ax(K,ge)}),he=a.ay(i,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:re,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(ce=a.az(z),ce.min.x=a.aA(ce.min.x,0,a.al),ce.min.y=a.aA(ce.min.y,0,a.al),ce.max.x=a.aA(ce.max.x,0,a.al),ce.max.y=a.aA(ce.max.y,0,a.al),ce),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:he};var ce}_bufferedScreenMercator(i,c){const g=Yn(i);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let E;return E=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),c):{polygon:this.bufferedScreenGeometry(i).map(A=>c.pointCoordinate3D(A)),unwrapped:!0},this._screenRaycastCache[g]=E,E}}_bufferedCameraMercator(i,c){const g=Yn(i);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let E;return E=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),c):{polygon:this.bufferedCameraGeometry(i).map(A=>c.pointCoordinate3D(A)),unwrapped:!0},this._cameraRaycastCache[g]=E,E}}_projectAndResample(i,c){const g=(function(A,M){const D=a.aB([],M.pixelMatrix,M.globeMatrix),z=[0,-a.aD,0,1],U=[0,a.aD,0,1],$=[0,0,0,1];a.aC(z,z,D),a.aC(U,U,D),a.aC($,$,D);const ie=new a.P(z[0]/z[3],z[1]/z[3]),K=new a.P(U[0]/U[3],U[1]/U[3]),re=a.aE(A,ie)&&z[3]<$[3],he=a.aE(A,K)&&U[3]<$[3];if(!re&&!he)return null;const ce=(function(Ue,ze,Pe){for(let We=1;We<Ue.length;We++){const Xe=ls(ze.pointCoordinate3D(Ue[We-1]).x),Qe=ls(ze.pointCoordinate3D(Ue[We]).x);if(Pe<0){if(Xe<Qe)return{idx:We,t:-Xe/(Qe-1-Xe)}}else if(Qe<Xe)return{idx:We,t:(1-Xe)/(Qe+1-Xe)}}return null})(A,M,re?-1:1);if(!ce)return null;const{idx:de,t:ge}=ce;let Ce=de>1?pn(A.slice(0,de),M):[],Ae=de<A.length?pn(A.slice(de),M):[];Ce=Ce.map(Ue=>new a.P(ls(Ue.x),Ue.y)),Ae=Ae.map(Ue=>new a.P(ls(Ue.x),Ue.y));const Ee=[...Ce];Ee.length===0&&Ee.push(Ae[Ae.length-1]);const Ge=a.ak(Ee[Ee.length-1].y,(Ae.length===0?Ce[0]:Ae[0]).y,ge);let je;return je=re?[new a.P(0,Ge),new a.P(0,0),new a.P(1,0),new a.P(1,Ge)]:[new a.P(1,Ge),new a.P(1,1),new a.P(0,1),new a.P(0,Ge)],Ee.push(...je),Ae.length===0?Ee.push(Ce[0]):Ee.push(...Ae),{polygon:Ee.map(Ue=>new a.ae(Ue.x,Ue.y)),unwrapped:!1}})(i,c);if(g)return g;const E=(function(A,M){let D=!1,z=-1/0,U=0;for(let ie=0;ie<A.length-1;ie++)A[ie].x>z&&(z=A[ie].x,U=ie);for(let ie=0;ie<A.length-1;ie++){const K=(U+ie)%(A.length-1),re=A[K],he=A[K+1];Math.abs(re.x-he.x)>.5&&(re.x<he.x?(re.x+=1,K===0&&(A[A.length-1].x+=1)):(he.x+=1,K+1===A.length-1&&(A[0].x+=1)),D=!0)}const $=a.aF(M.center.lng);return D&&$<Math.abs($-1)&&A.forEach(ie=>{ie.x-=1}),{polygon:A,unwrapped:D}})(pn(i,c).map(A=>new a.P(ls(A.x),A.y)),c);return{polygon:E.polygon.map(A=>new a.ae(A.x,A.y)),unwrapped:E.unwrapped}}}function pn(m,i){return a.aG(m,c=>{const g=i.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function ls(m){return m<0?1+m%1:m%1}function Yn(m){return 100*m|0}function il(m,i,c,g,E){const A=function(D,z){if(D)return E(D);if(z){if(m.url&&z.tiles&&m.tiles&&delete m.tiles,z.variants){if(!Array.isArray(z.variants))return E(new Error("variants must be an array"));for(const $ of z.variants){if($==null||typeof $!="object"||$.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray($.capabilities))return E(new Error("capabilities must be an array"));if($.capabilities.length===1&&$.capabilities[0]==="meshopt"){z=Object.assign(z,$);break}}}const U=a.aH(Object.assign({},z,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);U.tiles=i.canonicalizeTileset(U,m.url),E(null,U)}},M=(function(D,z,U){if(!D)return null;if(!z&&!U)return D;U=U||D.worldview_default;const $=Object.values(D.language||{});if($.length===0)return null;const ie=Object.values(D.worldview||{});if(ie.length===0)return null;const K=$.every(he=>he===z),re=ie.every(he=>he===U);return K&&re?D:z in(D.language_options||{})||U in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null})(m.data,c,g);return M?a.o.frame(()=>A(null,M)):m.url?a.m(i.transformRequest(i.normalizeSourceURL(m.url,null,c,g),a.R.Source),A):a.o.frame(()=>{const{data:D,...z}=m;A(null,z)})}function zs(m,i){const c=Math.pow(2,i.z),g=Math.floor(a.aF(m.getWest())*c),E=Math.floor(a.aJ(m.getNorth())*c),A=Math.ceil(a.aF(m.getEast())*c),M=Math.ceil(a.aJ(m.getSouth())*c);return i.x>=g&&i.x<A&&i.y>=E&&i.y<M}class Ws{constructor(i,c,g){this.bounds=i?a.aI.convert(this.validateBounds(i)):null,this.minzoom=c||0,this.maxzoom=g||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}addExtraBounds(i){if(i){this.extraBounds||(this.extraBounds=[]);for(const c of i)this.extraBounds.push(a.aI.convert(this.validateBounds(c)))}}contains(i){if(i.z>this.maxzoom||i.z<this.minzoom||this.bounds&&!zs(this.bounds,i))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(zs(c,i))return!0;return!1}static fromTileJSON(i){if(!i.bounds&&!i.extra_bounds)return null;const c=new Ws(i.bounds,i.minzoom,i.maxzoom);return c.addExtraBounds(i.extra_bounds),c}}class lo extends a.E{constructor(i,c,g,E){if(super(),this.id=i,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,a.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new a.aK}load(i){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=il(this._options,this.map._requestManager,c,g,(E,A)=>{if(this._tileJSONRequest=null,this._loaded=!0,E)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new a.y(E));else if(A){if(Object.assign(this,A),this.hasWorldviews=!!A.worldview_options,A.worldview_default&&(this.worldviewDefault=A.worldview_default),A.vector_layers){this.vectorLayers=A.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const M of A.vector_layers)this.vectorLayerIds.push(M.id),A.worldview&&A.worldview[M.source]&&this.localizableLayerIds.add(M.id)}this.tileBounds=Ws.fromTileJSON(A),ct(A.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(E)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(i,c){const g=i.tileID.canonical.url(this.tiles,this.scheme),E=this.map._requestManager.normalizeTileURL(g),A=this.map._requestManager.transformRequest(E,a.R.Tile),M=this.map.style?this.map.style.getLut(this.scope):null,D=M?{image:M.image.clone()}:null,z={request:A,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&a.h(g)&&(z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",z,U.bind(this));else if(i.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",z,U.bind(this),void 0,!0);else{const $=a.aL.call({deduped:this._deduped},z,(ie,K)=>{if(ie||!K)U.call(this,ie);else{const re=a.aM(K.responseHeaders);z.data={rawData:K.rawData.slice(0),expires:re.expires,cacheControl:re.cacheControl},i.actor&&i.actor.send("loadTile",z,U.bind(this),void 0,!0)}},!0);i.request={cancel:$}}function U($,ie){return delete i.request,i.aborted?c(null):$&&$ instanceof a.aN&&$.status!==404?c($):(ie&&ie.resourceTiming&&(i.resourceTiming=ie.resourceTiming),this.map._refreshExpiredTiles&&ie&&i.setExpiryData(ie),i.loadVectorData(ie,this.map.painter),a.aO(this.dispatcher),c(null,ie),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ts extends a.E{constructor(i,c,g,E){super(),this.id=i,this.dispatcher=g,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,a.aH(c,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=il(this._options,this.map._requestManager,null,c,(g,E)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new a.y(g)):E&&(Object.assign(this,E),E.raster_layers&&(this.rasterLayers=E.raster_layers,this.rasterLayerIds=this.rasterLayers.map(A=>A.id)),this.tileBounds=Ws.fromTileJSON(E),ct(E.tiles),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(g)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const g=a.o.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);i.request=a.n(this.map._requestManager.transformRequest(E,a.R.Tile),(A,M,D)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(A)return i.state="errored",c(A);if(!M)return c(null);const z=a.aM(D);this.map._refreshExpiredTiles&&i.setExpiryData(z),i.setTexture(M,this.map.painter),i.state="loaded",a.aO(this.dispatcher),c(null)})}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c&&c()}unloadTile(i,c){i.texture&&i.texture instanceof a.T?(i.destroy(!1),i.texture&&i.texture instanceof a.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function oa([m,i],c,g,{scaled:E=!0}={}){const{tileSize:A,buffer:M}=g,{x:D,y:z,z:U}=c;if(!isFinite(D)||!isFinite(z)||!isFinite(U))throw new Error("Invalid MRT header");const $=2**U,ie=$*a.aF(m),K=$*a.aJ(i);return(function([re,he],ce,{scaled:de=!0}={}){if(!ce)throw new Error("bandView is undefined");const{data:ge,tileSize:Ce,buffer:Ae,offset:Ee,scale:Ge,dimension:je}=ce;if(re<-Ae||re>Ce+Ae||he<-Ae||he>Ce+Ae)throw new Error(`Point (${re}, ${he}) out of bounds for tileSize=${Ce}, buffer=${Ae}`);const Ue=(he+Ae)*(Ce+2*Ae)+(re+Ae);if(new Uint32Array(ge.buffer)[Ue]===4294967295)return null;let ze=[];ze=de?[]:new ce.data.constructor(je);for(let Pe=0;Pe<je;Pe++)ze[Pe]=Math.round(1e12*(ge[je*Ue+Pe]*Ge+Ee))/1e12;return ze})([Math.min(Math.max(-M,Math.floor((ie-D)*A)),A-1+M),Math.min(Math.max(-M,Math.floor((K-z)*A)),A-1+M)],g,{scaled:E})}class Zs extends ts{constructor(i,c,g,E){super(i,c,g,E),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(i){const c=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);c&&c.enabled&&g&&c._clearRenderCacheForTile(g.id,i.tileID),this.map.triggerRepaint()}loadTile(i,c){const g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(g,a.R.Tile),A={request:E,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};i.source=this.id,i.scope=this.scope,i.requestParams=E,i.actor||(i.actor=this.dispatcher.getActor());const M=(D,z,U)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(D)return D.name==="AbortError"?void 0:(i.state="errored",c(D));if(this.map._refreshExpiredTiles&&z){const $=a.aM(U);i.setExpiryData($)}if(this.partial&&i.state!=="expired")i.state="empty";else if(!this.partial){if(!z)return c(null);i.state="loaded",i._isHeaderLoaded=!0,i._mrt=z}c(null)};i.request=this.partial?i.fetchHeader(void 0,M.bind(this)):i.actor.send("loadTile",A,M.bind(this),void 0,!0)}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){const g=i.texturePerLayer;if(i.flushAllQueues(),g.size){i.destroy(!1);for(const E of g.values())this.map.painter.saveTileTexture(E)}else i.destroy()}prepareTile(i,c,g,E){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBandForRender(c,g,E,(A,M)=>{if(A)return i.state="errored",this.fire(new a.y(A)),void this.triggerRepaint(i);M&&(i._isHeaderLoaded=!0,i.setTexturePerLayer(g,M,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:A})=>A===i),g=c&&c.fields,E=g&&g.bands&&g.bands;return E?E[0]:0}getTextureDescriptor(i,c,g){if(!i)return;const E=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let A=null;c instanceof a.aR?A=c.paint.get("raster-array-band"):c instanceof a.aS&&(A=c.paint.get("raster-particle-array-band"));const M=A||this.getInitialBand(E);if(M==null)return;if(!i.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(i,E,c.id,M);if(i.updateNeeded(c.id,M)&&!g)return;const D=i.textureDescriptorPerLayer.get(c.id);return Object.assign({},D,{texture:i.texturePerLayer.get(c.id)})}getImages(i,c){const g=new Map;for(const E of i)for(const A of c){const[M,D]=A.split("/"),z=E.getLayer(M);if(!z||!z.hasBand(D)||!z.hasDataForBand(D))continue;const{bytes:U,tileSize:$,buffer:ie}=z.getBandView(D),K=$+2*ie,re={data:new a.q({width:K,height:K},U),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(A,re)}return g}queryRasterArrayValueByBandId(i,c,g){const E=c._mrt;return new Promise(A=>{const M={},D=new Set;for(const[z,U]of Object.entries(E.layers)){if(g.layerName&&z!==g.layerName)continue;const $={};M[z]=$;for(const{bands:ie}of U.dataIndex)for(const K of ie)g.bands&&!g.bands.includes(K)||(D.add(a.B(z,K)),c.fetchBand(z,null,K,re=>{a.o.frame(()=>{$[K]=re?null:oa([i.lng,i.lat],E,U.getBandView(K)),D.delete(a.B(z,K)),D.size===0&&A(M)})},!1))}D.size===0&&A(M)})}_loadTileForQuery(i,c){if(this._loadTileLoaded[i.uid])return void c(null,i._mrt);if(this._loadTilePending[i.uid])return void this._loadTilePending[i.uid].push(c);this._loadTilePending[i.uid]=[c];const g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(g,a.R.Tile);i.actor.send("loadTile",{request:E,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(A,M,D)=>{if(A)return this._loadTilePending[i.uid].forEach(z=>z(A,null)),void delete this._loadTilePending[i.uid];if(!M)return this._loadTilePending[i.uid].forEach(z=>z(null,null)),void delete this._loadTilePending[i.uid];if(this.map._refreshExpiredTiles&&M){const z=a.aM(D);i.setExpiryData(z)}i._mrt=M,i._isHeaderLoaded=!0,i.state="loaded",this._loadTilePending[i.uid].forEach(z=>z(null,M)),this._loadTileLoaded[i.uid]=!0,delete this._loadTilePending[i.uid]},void 0,!0)}queryRasterArrayValueByAllBands(i,c,g){return new Promise((E,A)=>{this._loadTileForQuery(c,(M,D)=>{M?A(M):E(D?this.queryRasterArrayValueByBandId(i,c,g):null)})})}queryRasterArrayValue(i,c){const g=a.aT.convert(i),E=this.findLoadedParent(g);return E&&E._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(g,E,c):this.queryRasterArrayValueByAllBands(g,E,c):Promise.resolve(null)}findLoadedParent(i){const c=a.ae.fromLngLat(i,this.map.transform.tileSize),g=this.maxzoom+1,E=1<<g,A=Math.floor(c.x),M=Math.floor((c.x-A)*E),D=Math.floor(c.y*E),z=this.map.style.getSourceCache(this.id),U=new a.aQ(g,A,g,M,D);return z.findLoadedParent(U,this.minzoom)}}const Mo={vector:lo,raster:ts,"raster-dem":class extends ts{constructor(m,i,c,g){super(m,i,c,g),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(m,i){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(E,A){E&&(m.state="errored",i(E)),A&&(m.dem=A,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",i(null))}m.request=a.n(this.map._requestManager.transformRequest(c,a.R.Tile),(function(E,A,M){if(delete m.request,m.aborted)m.state="unloaded",i(null);else if(E)m.state="errored",i(E);else if(A){const D=a.aM(M);this.map._refreshExpiredTiles&&m.setExpiryData(D);const z=ImageBitmap&&A instanceof ImageBitmap&&a.r(),U=1-(A.width-a.aP(A.width))/2;U<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const $=z?A:a.o.getImageData(A,U),ie={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:$,encoding:this.encoding,padding:U};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",ie,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const i=m.canonical,c=Math.pow(2,i.z),g=(i.x-1+c)%c,E=i.x===0?m.wrap-1:m.wrap,A=(i.x+1+c)%c,M=i.x+1===c?m.wrap+1:m.wrap,D={};return D[new a.aQ(m.overscaledZ,E,i.z,g,i.y).key]={backfilled:!1},D[new a.aQ(m.overscaledZ,M,i.z,A,i.y).key]={backfilled:!1},i.y>0&&(D[new a.aQ(m.overscaledZ,E,i.z,g,i.y-1).key]={backfilled:!1},D[new a.aQ(m.overscaledZ,m.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},D[new a.aQ(m.overscaledZ,M,i.z,A,i.y-1).key]={backfilled:!1}),i.y+1<c&&(D[new a.aQ(m.overscaledZ,E,i.z,g,i.y+1).key]={backfilled:!1},D[new a.aQ(m.overscaledZ,m.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},D[new a.aQ(m.overscaledZ,M,i.z,A,i.y+1).key]={backfilled:!1}),D}},"raster-array":Zs,geojson:class extends a.E{constructor(m,i,c,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=i.data,this._options=Object.assign({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const E=a.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*E,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*E,extent:a.al,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:a.al,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*E,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new a.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new a.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const c of this._data.features)i.set(c.id,c);for(const c of m.features)i.set(c.id,c);this._data.features=[...i.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},i),this}getClusterChildren(m,i){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},i),this}getClusterLeaves(m,i,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:i,offset:c},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=Object.assign({append:m},this.workerOptions);i.scope=this.scope;const c=this._data;typeof c=="string"?(i.request=this.map._requestManager.transformRequest(a.o.resolveURL(c),a.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(g,E)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new a.y(g));else{const A={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(A.resourceTiming=E.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new a.z("data",A)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=a.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,i){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,E=g?{image:g.image.clone()}:null,A=this._partialReload,M={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:E,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:A,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};m.request=this.actor.send(c,M,(D,z)=>A&&!z?(m.state="loaded",i(null)):(delete m.request,m.destroy(!1),m.aborted?i(null):D?i(D):(m.loadVectorData(z,this.map.painter,c==="reloadTile"),i(null))),void 0,c==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,i){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aU{constructor(m,i,c,g){super(m,i,c,g),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const i of m.urls)this.urls.push(this.map._requestManager.transformRequest(i,a.R.Source).url);a.aV(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new a.y(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const i=this.video.seekable;m<i.start(0)||m>i.end(0)?this.fire(new a.y(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,i=m.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(m,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aU,model:a.aX,"batched-model":class extends a.E{constructor(m,i,c,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=il(this._options,this.map._requestManager,i,c,(g,E)=>{this._tileJSONRequest=null,this._loaded=!0,g?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new a.y(g))):E&&(Object.assign(this,E),E.bounds&&(this.tileBounds=new Ws(E.bounds,this.minzoom,this.maxzoom)),ct(E.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,i){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,a.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=i;else{if(m.buckets){const A=Object.values(m.buckets);for(const M of A)M.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,E.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,E.bind(this),void 0,!0);function E(A,M){return m.aborted?i(null):A&&A.status!==404?i(A):(this.map._refreshExpiredTiles&&M&&m.setExpiryData(M),m.loadModelData(M,this.map.painter),m.state="loaded",void i(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends a.aU{constructor(m,i,c,g){super(m,i,c,g),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(A=>typeof A!="number"))||this.fire(new a.y(new a.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.y(new a.V(`sources.${m}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new a.y(new a.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new a.y(new a.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.y(new a.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof a.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends a.E{constructor(m,i,c,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=i,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ws(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,a.aH(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:i,y:c,z:g}=m.canonical;return this._implementation.hasTile({x:i,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,i){const{x:c,y:g,z:E}=m.tileID.canonical,A=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:E},{signal:A.signal})).then((function(M){return delete m.request,m.aborted?(m.state="unloaded",i(null)):M===void 0?(m.state="errored",i(null)):M===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",i(null)):(function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement})(M)?(this.loadTileData(m,M),m.state="loaded",void i(null)):(m.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.name!=="AbortError"&&(m.state="errored",i(M))}),m.request.cancel=()=>A.abort()}loadTileData(m,i){m.setTexture(i,this.map.painter)}unloadTile(m,i){if(m.texture&&m.texture instanceof a.T?(m.destroy(!1),m.texture&&m.texture instanceof a.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:g,z:E}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:E})}i&&i()}abortTile(m,i){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=a.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}}},co=function(m,i,c,g){const E=new Mo[i.type](m,i,c,g);if(E.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${E.id}`);return a.aY(["load","abort","unload","serialize","prepare"],E),E};function ka(m,i,c=""){return`${c}:${i.id||""}:${i.layer.id}:${(function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:E,importId:A}=g;return`featureset:${E}${A?`:import:${A}`:""}`}})(m.target)}`}function Du(m,i,c,g=""){if(m.uniqueFeatureID){const E=ka(m,i,g);if(c.has(E))return!0;c.add(E)}return!1}function rl(m,i,c,g,E=!1,A=void 0){const M=i.sourceCache.transform,D=i.sourceCache.tilesIn(m,i.has3DLayers,E);D.sort(Ud);const z=[];for(const U of D){const $=U.tile.queryRenderedFeatures(i,U,c,g,M,E,A);Object.keys($).length&&z.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:$})}for(const U in i.layers){const $=i.layers[U];if($.styleLayer){const ie=$.styleLayer.queryRenderedFeatures(m,i.sourceCache,g);Object.keys(ie).length&&z.push({wrappedTileID:0,queryResults:ie})}}return z.length===0?{}:(function(U){const $={},ie={};for(const K of U){const re=K.queryResults,he=K.wrappedTileID,ce=ie[he]=ie[he]||{};for(const de in re){const ge=re[de],Ce=ce[de]=ce[de]||{},Ae=$[de]=$[de]||[];for(const Ee of ge)Ce[Ee.featureIndex]||(Ce[Ee.featureIndex]=!0,Ae.push(Ee))}}return $})(z)}function Am(m,i,c,g,E,A){const M={},D=g.queryRenderedSymbols(m),z=[];for(const U of Object.keys(D).map(Number))z.push(E[U]);z.sort(Ud);for(const U of z){const $=U.featureIndex.lookupSymbolFeatures(D[U.bucketInstanceId],U.bucketIndex,U.sourceLayerIndex,i,c,A);for(const ie in $){const K=M[ie]=M[ie]||[],re=$[ie];re.sort((he,ce)=>{const de=U.featureSortOrder;if(de){const ge=de.indexOf(he.featureIndex);return de.indexOf(ce.featureIndex)-ge}return ce.featureIndex-he.featureIndex});for(const he of re)K.push(he)}}return M}function np(m,i){const c=m.getRenderableIds().map(A=>m.getTileByID(A)),g=[],E={};for(let A=0;A<c.length;A++){const M=c[A],D=M.tileID.canonical.key;E[D]||(E[D]=!0,M.querySourceFeatures(g,i))}return g}function Ud(m,i){const c=m.tileID,g=i.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function Fh(m,i){const c={};if(!i)return c;for(const g of m){const E=g.layerIds.map(A=>i.getLayer(A)).filter(Boolean);if(E.length!==0){g.layers=E,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(A=>E.filter(M=>M.id===A)[0]));for(const A of E)c[A.fqid]=g}}return c}const xs=32,Za=33,uo=new Uint16Array(8184);for(let m=0;m<2046;m++){let i=m+2,c=0,g=0,E=0,A=0,M=0,D=0;for(1&i?E=A=M=xs:c=g=D=xs;(i>>=1)>1;){const U=c+E>>1,$=g+A>>1;1&i?(E=c,A=g,c=M,g=D):(c=E,g=A,E=M,A=D),M=U,D=$}const z=4*m;uo[z+0]=c,uo[z+1]=g,uo[z+2]=E,uo[z+3]=A}const cs=new Uint16Array(2178),ho=new Uint8Array(1089),sc=new Uint16Array(1089);function Po(m){return m===0?-.03125:m===32?.03125:0}const fo={type:2,extent:a.al,loadGeometry:()=>[[new a.P(0,0),new a.P(a.al+1,0),new a.P(a.al+1,a.al+1),new a.P(0,a.al+1),new a.P(0,0)]]};class Cl{constructor(i,c,g,E,A,M){this.tileID=i,this.uid=a.b2(),this.uses=0,this.tileSize=c,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=A,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection),this.worldview=M,this._hasAppearances=null}registerFadeDuration(i){const c=i+this.timeAdded;c<a.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,c,g){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Fh(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const A=this.buckets[E];if(A instanceof a.b4){if(this.hasSymbolBuckets=!0,!g)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const A=this.buckets[E];if(A instanceof a.b4&&A.hasRTLText){this.hasRTLText=!0,a.b5();break}}this.queryPadding=0;for(const E in this.buckets){const A=this.buckets[E],M=c.style.getOwnLayer(E);if(!M)continue;const D=M.queryRadius(A);this.queryPadding=Math.max(this.queryPadding,D)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new a.b3}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,c,g){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,Fh(i.buckets,c.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i,c){for(const A in this.buckets){const M=this.buckets[A];if(M.uploadPending()){let D={},z=[],U={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){z=c.style.listImages();const $=M.layers[0],ie=$.sourceLayer||"_geojsonTileLayer",K=c.style.getLayerSourceCache($);K&&(D=K._state.getState(ie,void 0))}U={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}M.upload(i,this.tileID.canonical,D,z,U)}}const g=i.gl,E=this.imageAtlas;E&&!E.uploaded&&(this.imageAtlasTexture=new a.T(i,E.image,g.RGBA8,{useMipmap:!!E.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(i,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(i,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(i,c,g){if(this.imageAtlas&&this.imageAtlasTexture&&c){const A=c.style.getLut(g);this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,g,A)}if(!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||E||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==E),this._lastUpdatedBrightness=E))}evaluateQueryRenderedFeaturePadding(){let i=0;for(const c in this.buckets){const g=this.buckets[c];g.evaluateQueryRenderedFeaturePadding&&(i=Math.max(i,g.evaluateQueryRenderedFeaturePadding()))}return i}queryRenderedFeatures(i,c,g,E,A,M,D){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const z=this.evaluateQueryRenderedFeaturePadding(),U=(function($,ie){const K=a.bq([],[.5*$.width,.5*-$.height,1]);return a.br(K,K,[1,-1,0]),a.aB(K,K,$.calculateProjMatrix(ie.toUnwrapped())),Float32Array.from(K)})(A,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:c,pixelPosMatrix:U,transform:E,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:z,scope:D})}querySourceFeatures(i,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const E=g.loadVTLayers(),A=c?c.sourceLayer:"",M=E._geojsonTileLayer||E[A];if(!M)return;const D=a.b6(c&&c.filter),{z,x:U,y:$}=this.tileID.canonical,ie={z,x:U,y:$};for(let K=0;K<M.length;K++){const re=M.feature(K);if(D.needGeometry){const de=a.b7(re,!0);if(!D.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),de,this.tileID.canonical))continue}else if(!D.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re))continue;const he=g.getId(re,A),ce=new a.b8(re,z,U,$,he);ce.tile=ie,i.push(ce)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const g=a.b9(i.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const g=Date.now();let E=!1;if(this.expirationTime>g)E=!1;else if(c)if(this.expirationTime<c)E=!0;else{const A=this.expirationTime-c;A?this.expirationTime=g+Math.max(A,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}hasAppearances(i){for(const c in this.buckets)if(i.style.hasLayer(c)&&this.buckets[c].layers.some(g=>g.appearances&&g.appearances.length>0))return!0;return!1}updateBuckets(i,c){if(!this.latestFeatureIndex||!i.style)return;const g=i.style.listImages(),E=i.style.getBrightness();for(const A in this.buckets){if(!i.style.hasLayer(A))continue;const M=this.buckets[A],D=M.layers[0],z=D.sourceLayer||"_geojsonTileLayer",U=i.style.getLayerSourceCache(D);let $={};U&&($=U._state.getState(z,void 0));const ie=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},K=Object.keys($).length>0&&!c;M.hasAppearances=M.layers.some(ce=>ce.appearances&&ce.appearances.length>0);const re=K?M.stateDependentLayers:M.layers;if(K&&M.stateDependentLayers.length!==0||c){const ce=this.latestFeatureIndex.loadVTLayers();M.update($,ce[z],g,ie,re,c,E)}if(K&&M.stateDependentLayers.length!==0||c||M.hasAppearances){const ce={zoom:i.transform.zoom,pitch:i.transform.pitch,brightness:i.style.getBrightness()||0,worldview:i.worldview};M.updateAppearances(this.tileID.canonical,$,g,ce,i.imageManager)}(M instanceof a.ba||M instanceof a.bb)&&i._terrain&&i._terrain.enabled&&U&&M.uploadPending()&&i._terrain._clearRenderCacheForTile(U.id,this.tileID);const he=i&&i.style&&i.style.getOwnLayer(A);he&&(this.queryPadding=Math.max(this.queryPadding,he.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=a.o.now()+i}setTexture(i,c){const g=c.context,E=g.gl;this.texture=this.texture||c.getTileTexture(i.width),this.texture&&this.texture instanceof a.T?this.texture.update(i):(this.texture=new a.T(g,i,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(i,c){const g={};for(const E of c)g[E]=!0;this.dependencies[i]=g}hasDependency(i,c){for(const g of i){const E=this.dependencies[g];if(E){for(const A of c)if(E[A])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const g=a.bc(fo,this.tileID.canonical,this.tileTransform)[0],E=new a.bd,A=new a.be;for(let M=0;M<g.length;M++){const{x:D,y:z}=g[M];E.emplaceBack(D,z),A.emplaceBack(M)}A.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(A),this._tileDebugBuffer=i.createVertexBuffer(E,a.bf.members),this._tileDebugSegments=a.bg.simpleSegment(0,0,E.length,A.length)}_makeTileBoundsBuffers(i,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const g=a.bc(fo,this.tileID.canonical,this.tileTransform)[0];let E,A;if(this.isRaster){const M=(function(D,z){const U=a.aZ(D,z),$=Math.pow(2,D.z);for(let de=0;de<Za;de++)for(let ge=0;ge<Za;ge++){const Ce=a.a_((D.x+(ge+Po(ge))/xs)/$),Ae=a.a$((D.y+(de+Po(de))/xs)/$),Ee=z.project(Ce,Ae),Ge=de*Za+ge;cs[2*Ge+0]=Math.round((Ee.x*U.scale-U.x)*a.al),cs[2*Ge+1]=Math.round((Ee.y*U.scale-U.y)*a.al)}ho.fill(0),sc.fill(0);for(let de=2045;de>=0;de--){const ge=4*de,Ce=uo[ge+0],Ae=uo[ge+1],Ee=uo[ge+2],Ge=uo[ge+3],je=Ce+Ee>>1,Ue=Ae+Ge>>1,ze=je+Ue-Ae,Pe=Ue+Ce-je,We=Ae*Za+Ce,Xe=Ge*Za+Ee,Qe=Ue*Za+je,rt=Math.hypot((cs[2*We+0]+cs[2*Xe+0])/2-cs[2*Qe+0],(cs[2*We+1]+cs[2*Xe+1])/2-cs[2*Qe+1])>=16;ho[Qe]=ho[Qe]||(rt?1:0),de<1022&&(ho[Qe]=ho[Qe]||ho[(Ae+Pe>>1)*Za+(Ce+ze>>1)]||ho[(Ge+Pe>>1)*Za+(Ee+ze>>1)])}const ie=new a.b1,K=new a.b0;let re=0;function he(de,ge){const Ce=ge*Za+de;return sc[Ce]===0&&(ie.emplaceBack(cs[2*Ce+0],cs[2*Ce+1],de*a.al/xs,ge*a.al/xs),sc[Ce]=++re),sc[Ce]-1}function ce(de,ge,Ce,Ae,Ee,Ge){const je=de+Ce>>1,Ue=ge+Ae>>1;if(Math.abs(de-Ee)+Math.abs(ge-Ge)>1&&ho[Ue*Za+je])ce(Ee,Ge,de,ge,je,Ue),ce(Ce,Ae,Ee,Ge,je,Ue);else{const ze=he(de,ge),Pe=he(Ce,Ae),We=he(Ee,Ge);K.emplaceBack(ze,Pe,We)}}return ce(0,0,xs,xs,xs,0),ce(xs,xs,0,0,0,xs),{vertices:ie,indices:K}})(this.tileID.canonical,c);E=M.vertices,A=M.indices}else{E=new a.b1,A=new a.b0;for(const{x:D,y:z}of g)E.emplaceBack(D,z,0,0);const M=a.bh(E.int16.subarray(0,4*E.length),void 0,4);for(let D=0;D<M.length;D+=3)A.emplaceBack(M[D],M[D+1],M[D+2])}this._tileBoundsBuffer=i.createVertexBuffer(E,a.bi.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(A),this._tileBoundsSegments=a.bg.simpleSegment(0,0,E.length,A.length)}_makeGlobeTileDebugBuffers(i,c){const g=c.projection;if(!g||g.name!=="globe"||c.freezeTileCoverage)return;const E=this.tileID.canonical,A=a.bj(E,c),M=a.bk(A),D=a.aj(c.zoom);let z;D>0&&(z=a.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,E,c,M,z,D),this._makeGlobeTileDebugTextBuffer(i,E,c,M,z,D)}_globePoint(i,c,g,E,A,M,D){let z=a.bm(i,c,g);if(M){const U=1<<g.z,$=a.aF(E.center.lng),ie=a.aJ(E.center.lat),K=(g.x+.5)/U-$;let re=0;K>.5?re=-1:K<-.5&&(re=1);let he=(i/a.al+g.x)/U+re,ce=(c/a.al+g.y)/U;he=(he-$)*E._pixelsPerMercatorPixel+$,ce=(ce-ie)*E._pixelsPerMercatorPixel+ie;const de=[he*E.worldSize,ce*E.worldSize,0];a.af(de,de,M),z=a.bn(z,de,D)}return a.af(z,z,A)}_makeGlobeTileDebugBorderBuffer(i,c,g,E,A,M){const D=new a.bd,z=new a.be,U=new a.bo,$=(K,re,he,ce,de)=>{const ge=(he-K)/(de-1),Ce=(ce-re)/(de-1),Ae=D.length;for(let Ee=0;Ee<de;Ee++){const Ge=K+Ee*ge,je=re+Ee*Ce;D.emplaceBack(Ge,je);const Ue=this._globePoint(Ge,je,c,g,E,A,M);U.emplaceBack(Ue[0],Ue[1],Ue[2]),z.emplaceBack(Ae+Ee)}},ie=a.al;$(0,0,ie,0,16),$(ie,0,ie,ie,16),$(ie,ie,0,ie,16),$(0,ie,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(z),this._tileDebugBuffer=i.createVertexBuffer(D,a.bf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(U,a.bp.members),this._tileDebugSegments=a.bg.simpleSegment(0,0,D.length,z.length)}_makeGlobeTileDebugTextBuffer(i,c,g,E,A,M){const D=a.al/4,z=new a.bd,U=new a.b0,$=new a.bo,ie=25;U.reserve(32),z.reserve(ie),$.reserve(ie);const K=(re,he)=>ie*re+he;for(let re=0;re<ie;re++){const he=re*D;for(let ce=0;ce<ie;ce++){const de=ce*D;z.emplaceBack(de,he);const ge=this._globePoint(de,he,c,g,E,A,M);$.emplaceBack(ge[0],ge[1],ge[2])}}for(let re=0;re<4;re++)for(let he=0;he<4;he++){const ce=K(re,he),de=K(re,he+1),ge=K(re+1,he),Ce=K(re+1,he+1);U.emplaceBack(ce,de,ge),U.emplaceBack(ge,de,Ce)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(U),this._tileDebugTextBuffer=i.createVertexBuffer(z,a.bf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer($,a.bp.members),this._tileDebugTextSegments=a.bg.simpleSegment(0,0,ie,32)}destroy(i=!0){for(const c in this.buckets)this.buckets[c].destroy(i);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),i&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof a.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bs.setPbf(a.bt);class ku extends Cl{constructor(i,c,g,E,A){super(i,c,g,E,A),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(i){return this._mrt&&this._mrt.getLayer(i)}setTexturePerLayer(i,c,g){const E=g.context,A=E.gl;let M=this.texturePerLayer.get(i)||g.getTileTexture(c.width);M&&M instanceof a.T?M.update(c,{premultiply:!1}):M=new a.T(E,c,A.RGBA8,{premultiply:!1}),this.texturePerLayer.has(i)||this.texturePerLayer.set(i,M)}flushQueues(i){const c=this._workQueuePerLayer.get(i)||[],g=this._fetchQueuePerLayer.get(i)||[];for(;c.length;)c.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const i of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(i)||[];for(;c.length;)c.pop()()}for(const i of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(i)||[];for(;c.length;)c.pop()()}}fetchHeader(i=16384,c){const g=this._mrt=new a.bs(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=a.bu(E,(A,M,D)=>{if(A)c(A);else try{const z=g.getHeaderLength(M);if(z>i)return void(this.request=this.fetchHeader(z,c));g.parseHeader(M),this._isHeaderLoaded=!0;let U=0;for(const $ of Object.values(g.layers))U=Math.max(U,$.dataIndex[$.dataIndex.length-1].lastByte);M.byteLength>=U&&(this.entireBuffer=M),c(null,this.entireBuffer||M,D)}catch(z){c(z)}}),this.request}fetchBandForRender(i,c,g,E){this.fetchBand(i,c,g,A=>{if(A)return void E(A);this.updateTextureDescriptor(i,c,g);const M=this.textureDescriptorPerLayer.get(c);E(null,M?M.img:null)})}fetchBand(i,c,g,E,A=!0){const M=this._mrt;if(!this._isHeaderLoaded||!M)return void E(new Error("Tile header is not ready"));const D=this.actor;if(!D)return void E(new Error("Can't fetch tile band without an actor"));let z;const U=a.B(String(g),a.B(this.tileID.key,i));let $=this._taskQueue.get(U);$?$.add(E):($=new Set,$.add(E),this._taskQueue.set(U,$));const ie=(ce,de)=>{z.complete(ce,de),ce?E(ce):($.forEach(ge=>ge(null,de)),this._taskQueue.delete(U))},K=(ce,de)=>{if(ce)return E(ce);const ge=D.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:de,task:z},ie,void 0,!0);if(c!==null){const Ce=this._workQueuePerLayer.get(c)||[];Ce.push(()=>{ge&&ge.cancel(),z.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,Ce)}};let re;try{re=M.getLayer(i)}catch(ce){if(this.state==="reloading")return;throw ce}if(!re)return void E(new Error(`Unknown sourceLayer "${i}"`));if(re.hasDataForBand(g))return $.forEach(ce=>ce(null,null)),void this._taskQueue.delete(U);const he=re.getDataRange([g]);if(z=M.createDecodingTask(he),!z||z.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)K(null,this.entireBuffer.slice(he.firstByte,he.lastByte+1));else{const ce=Object.assign({},this.requestParams,{headers:{Range:`bytes=${he.firstByte}-${he.lastByte}`}}),de=a.bu(ce,K);if(c!==null){const ge=this._fetchQueuePerLayer.get(c)||[];ge.push(()=>{de.cancel(),z.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,ge)}}}updateNeeded(i,c){return(!this.textureDescriptorPerLayer.get(i)||this.textureDescriptorPerLayer.get(i).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(i,c,g){if(!this._mrt)return;const E=this._mrt.getLayer(i);if(!E||!E.hasBand(g)||!E.hasDataForBand(g))return;const{bytes:A,tileSize:M,buffer:D,offset:z,scale:U}=E.getBandView(g),$=M+2*D,ie=new a.q({width:$,height:$},A),K=this.texturePerLayer.get(c);K&&K instanceof a.T&&K.update(ie,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:i,band:g,img:ie,buffer:D,offset:z,tileSize:M,format:E.pixelFormat,mix:[U,256*U,65536*U,16777216*U]})}destroy(i=!1){if(super.destroy(i),delete this._mrt,!i)for(const c of this.texturePerLayer.values())c&&c instanceof a.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class sp{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,g){const E=i.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const A={value:c,timeout:void 0};if(g!==void 0&&(A.timeout=setTimeout(()=>{this.remove(i,A)},g)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const g=i.wrapped().key,E=c===void 0?0:this.data[g].indexOf(c),A=this.data[g][E];return this.data[g].splice(E,1),A.timeout&&clearTimeout(A.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(A.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const g in this.data)for(const E of this.data[g])i(E.value)||c.push(E);for(const g of c)this.remove(g.value.tileID,g)}}class Lu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,g){const E=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][E]=this.stateChanges[i][E]||{},Object.assign(this.stateChanges[i][E],g),this.deletedStates[i]===null){this.deletedStates[i]={};for(const A in this.state[i])A!==E&&(this.deletedStates[i][A]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][E]===null){this.deletedStates[i][E]={};for(const A in this.state[i][E])g[A]||(this.deletedStates[i][E][A]=null)}else for(const A in g)this.deletedStates[i]&&this.deletedStates[i][E]&&this.deletedStates[i][E][A]===null&&delete this.deletedStates[i][E][A]}removeFeatureState(i,c,g){if(this.deletedStates[i]===null)return;const E=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},g&&c!==void 0)this.deletedStates[i][E]!==null&&(this.deletedStates[i][E]=this.deletedStates[i][E]||{},this.deletedStates[i][E][g]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][E])for(g in this.deletedStates[i][E]={},this.stateChanges[i][E])this.deletedStates[i][E][g]=null;else this.deletedStates[i][E]=null;else this.deletedStates[i]=null}getState(i,c){const g=this.state[i]||{},E=this.stateChanges[i]||{},A=this.deletedStates[i];if(A===null)return{};if(c!==void 0){const D=String(c),z=Object.assign({},g[D],E[D]);if(A){const U=A[c];if(U===null)return{};for(const $ in U)delete z[$]}return z}const M=Object.assign({},g,E);if(A)for(const D in A)delete M[D];return M}initializeTileState(i,c){i.refreshFeatureState(c)}coalesceChanges(i,c){const g={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const A={};for(const M in this.stateChanges[E])this.state[E][M]||(this.state[E][M]={}),Object.assign(this.state[E][M],this.stateChanges[E][M]),A[M]=this.state[E][M];g[E]=A}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const A={};if(this.deletedStates[E]===null)for(const M in this.state[E])A[M]={},this.state[E][M]={};else for(const M in this.deletedStates[E]){if(this.deletedStates[E][M]===null)this.state[E][M]={};else if(this.state[E][M])for(const D of Object.keys(this.deletedStates[E][M]))delete this.state[E][M][D];A[M]=this.state[E][M]}g[E]=g[E]||{},Object.assign(g[E],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const E in i)i[E].refreshFeatureState(c)}}class Kn extends a.E{constructor(i,c,g){super(),this.id=i,this._onlySymbols=g,c.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new sp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Lu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles)if(!this._tiles[i].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,c){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(i,this.map?this.map.painter:void 0),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(jc).map(i=>i.key)}getRenderableIds(i,c){const g=[];for(const E in this._tiles)this._isIdRenderable(+E,i,c)&&g.push(this._tiles[E]);return i?g.sort((E,A)=>{const M=E.tileID,D=A.tileID,z=new a.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle),U=new a.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return M.overscaledZ-D.overscaledZ||U.y-z.y||U.x-z.x}).map(E=>E.tileID.key):g.map(E=>E.tileID).sort(jc).map(E=>E.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c,g){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())&&(g||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,c){const g=this._tiles[i];g&&(g.state!=="loading"&&(g.state=c),this._loadTile(g,this._tileLoaded.bind(this,g,i,c)))}_tileLoaded(i,c,g,E,A){if(E){if(i.state="errored",E.status!==404)this._source.fire(new a.y(E,{tile:i}));else{if(this._source.fire(new a.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const D=this.map.painter.terrain;this.update(this.transform,D.getScaledDemTileSize(),!0),D.resetTileLookupCache(this.id)}else this.update(this.transform)}return}i.timeAdded=a.o.now(),g==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null);let M=new Map;A&&A.responseHeaders&&(M=A.responseHeaders),this._source.fire(new a.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id,responseHeaders:M}))}_backfillDEM(i){const c=this.getRenderableIds();for(let E=0;E<c.length;E++){const A=c[E];if(i.neighboringTiles&&i.neighboringTiles[A]){const M=this.getTileByID(A);g(i,M),g(M,i)}}function g(E,A){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let M=A.tileID.canonical.x-E.tileID.canonical.x;const D=A.tileID.canonical.y-E.tileID.canonical.y,z=Math.pow(2,E.tileID.canonical.z),U=A.tileID.key;M===0&&D===0||Math.abs(D)>1||(Math.abs(M)>1&&(Math.abs(M+z)===1?M+=z:Math.abs(M-z)===1&&(M-=z)),A.dem&&E.dem&&(E.dem.backfillBorder(A.dem,M,D),E.neighboringTiles&&E.neighboringTiles[U]&&(E.neighboringTiles[U].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,g,E){for(const A in this._tiles){let M=this._tiles[A];if(E[A]||!M.hasData()||M.tileID.overscaledZ<=c||M.tileID.overscaledZ>g)continue;let D=M.tileID;for(;M&&M.tileID.overscaledZ>c+1;){const U=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[U.key],M&&M.hasData()&&(D=U)}let z=D;for(;z.overscaledZ>c;)if(z=z.scaledTo(z.overscaledZ-1),i[z.key]){E[D.key]=D;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const g=this._loadedParentTiles[i.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=i.overscaledZ-1;g>=c;g--){const E=i.scaledTo(g),A=this._getLoadedTile(E);if(A)return A}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,c){c=c||this._source.tileSize;const g=Math.ceil(i.width/c)+1,E=Math.ceil(i.height/c)+1,A=Math.floor(g*E*5),M=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,A):A,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(D)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const g={};for(const E in this._tiles){const A=this._tiles[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+c),g[A.tileID.key]=A}this._tiles=g;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(i,c,g,E,A){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(i,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const M=this._source.type==="batched-model";let D,z=this._source.maxzoom;const U=this.map&&this.map.painter?this.map.painter._terrain:null;if(U&&U.sourceCache===this&&U.attenuationRange()){const K=U.attenuationRange()[0],re=Math.floor(K)-Math.log2(U.getDemUpscale());z>re&&(z=re)}if(this.used||this.usedForTerrain){if(this._source.tileID)D=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new a.aQ(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y));else if(this.tileCoverLift!==0){const K=i.clone();K.tileCoverLift=this.tileCoverLift,D=K.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.minzoom<=1&&i.projection.name==="globe"&&(D.push(new a.aQ(1,0,1,0,0)),D.push(new a.aQ(1,0,1,1,0)),D.push(new a.aQ(1,0,1,0,1)),D.push(new a.aQ(1,0,1,1,1)))}else if(D=i.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.hasTile){const K=this._source.hasTile.bind(this._source);D=D.filter(re=>K(re))}}else D=[];if(D.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Rl(this._source.type)){const K=i.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),re=Math.min(K,this._source.maxzoom);if(M){const he=i.extendTileCover(D,re);for(const ce of he)D.push(ce)}else if(A){const he=i.extendTileCoverToNearPlane(D,this.transform.getFrustum(re),re);for(const ce of he)D.push(ce)}else if(this.castsShadows&&E){const he=i.extendTileCover(D,re,E,16);for(const ce of he)this._shadowCasterTiles[ce.key]=!0,D.push(ce)}}const $=this._updateRetainedTiles(D);if(Rl(this._source.type)&&D.length!==0){const K={},re={},he=Object.keys($);for(const de of he){const ge=$[de],Ce=this._tiles[de];if(!Ce||Ce.fadeEndTime&&Ce.fadeEndTime<=a.o.now())continue;const Ae=this.findLoadedParent(ge,Math.max(ge.overscaledZ-Kn.maxOverzooming,this._source.minzoom));Ae&&(this._addTile(Ae.tileID),K[Ae.tileID.key]=Ae.tileID),re[de]=ge}const ce=D[D.length-1].overscaledZ;for(const de in this._tiles){const ge=this._tiles[de];if($[de]||!ge.hasData())continue;let Ce=ge.tileID;for(;Ce.overscaledZ>ce;){Ce=Ce.scaledTo(Ce.overscaledZ-1);const Ae=this._tiles[Ce.key];if(Ae&&Ae.hasData()&&re[Ce.key]){$[de]=ge.tileID;break}}}for(const de in K)$[de]||(this._coveredTiles[de]=!0,$[de]=K[de])}for(const K in $)this._tiles[K].clearFadeHold();const ie=a.bv(this._tiles,$);for(const K of ie){const re=this._tiles[K];re.hasSymbolBuckets&&!re.holdingForFade()?re.setHoldDuration(this.map._fadeDuration):re.hasSymbolBuckets&&!re.symbolFadeFinished()||this._removeTile(+K)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const c={};if(i.length===0)return c;const g={},E=i.reduce((U,$)=>Math.min(U,$.overscaledZ),1/0),A=i[0].overscaledZ,M=Math.max(A-Kn.maxOverzooming,this._source.minzoom),D=Math.max(A+Kn.maxUnderzooming,this._source.minzoom),z={};for(const U of i){const $=this._addTile(U);c[U.key]=U,$.hasData()||E<this._source.maxzoom&&(z[U.key]=U)}this._retainLoadedChildren(z,E,D,c);for(const U of i){let $=this._tiles[U.key];if($.hasData())continue;if(U.canonical.z>=this._source.maxzoom){const K=U.children(this._source.maxzoom)[0],re=this.getTile(K);if(re&&re.hasData()){c[K.key]=K;continue}}else{const K=U.children(this._source.maxzoom);if(c[K[0].key]&&c[K[1].key]&&c[K[2].key]&&c[K[3].key])continue}let ie=$.wasRequested();for(let K=U.overscaledZ-1;K>=M;--K){const re=U.scaledTo(K);if(g[re.key]||(g[re.key]=!0,$=this.getTile(re),!$&&ie&&($=this._addTile(re)),$&&(c[re.key]=re,ie=$.wasRequested(),$.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let g,E=this._tiles[i].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){g=this._loadedParentTiles[E.key];break}c.push(E.key);const A=E.scaledTo(E.overscaledZ-1);if(g=this._getLoadedTile(A),g)break;E=A}for(const A of c)this._loadedParentTiles[A]=g}}_addTile(i){let c=this._tiles[i.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const g=!!c;if(!g){const E=this.map?this.map.painter:null,A=this._source.tileSize*i.overscaleFactor();c=this._source.type==="raster-array"?new ku(i,A,this.transform.tileZoom,E,this._isRaster):new Cl(i,A,this.transform.tileZoom,E,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))}return c.uses++,this._tiles[i.key]=c,g||this._source.fire(new a.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const g=c.getExpiryTimeout();g&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},g))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,c,g){const E=[],A=this.transform;if(!A)return E;const M=A.projection.name==="globe",D=a.aF(A.center.lng);for(const z in this._tiles){const U=this._tiles[z];if(g&&U.clearQueryDebugViz(),U.holdingForFade())continue;let $;if(M){const ie=U.tileID.canonical;if(ie.z===0){const K=[Math.abs(a.aA(D,...la(ie,-1))-D),Math.abs(a.aA(D,...la(ie,1))-D)];$=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(a.aA(D,...la(ie,-1))-D),Math.abs(a.aA(D,...la(ie,0))-D),Math.abs(a.aA(D,...la(ie,1))-D)];$=[K.indexOf(Math.min(...K))-1]}}else $=[0];for(const ie of $){const K=i.containsTile(U,A,c,ie);K&&E.push(K)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,c){const g=this.getRenderableIds(i,c).map(A=>this._tiles[A].tileID),E=this.transform.projection.name==="globe";for(const A of g)A.projMatrix=this.transform.calculateProjMatrix(A.toUnwrapped()),A.expandedProjMatrix=E?this.transform.calculateProjMatrix(A.toUnwrapped(),!1,!0):A.projMatrix;return g}sortCoordinatesByDistance(i){const c=i.slice(),g=this.transform._camera.position,E=this.transform._camera.forward(),A={};for(const M of c){const D=1/(1<<M.canonical.z);A[M.key]=((M.canonical.x+.5)*D+M.wrap-g[0])*E[0]+((M.canonical.y+.5)*D-g[1])*E[1]-g[2]*E[2]}return c.sort((M,D)=>A[M.key]-A[D.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Rl(this._source.type))for(const i in this._tiles){const c=this._tiles[i];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=a.o.now())return!0}return!1}setFeatureState(i,c,g){this._state.updateState(i=i||"_geojsonTileLayer",c,g)}removeFeatureState(i,c,g){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,g)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,g){const E=this._tiles[i];E&&E.setDependencies(c,g)}reloadTilesForDependencies(i,c){for(const g in this._tiles)this._tiles[g].hasDependency(i,c)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(i,c))}_preloadTiles(i,c){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(i,c))};return void this._source.on("data",z)}const g=new Map,E=Array.isArray(i)?i:[i],A=this.map.painter.terrain,M=this.usedForTerrain&&A?A.getScaledDemTileSize():this._source.tileSize;for(const z of E){const U=z.coveringTiles({tileSize:M,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const $ of U)g.set($.key,$);this.usedForTerrain&&z.updateElevation(!1)}const D=Array.from(g.values());a.bw(D,(z,U)=>{const $=new Cl(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile($,ie=>{this._source.type==="raster-dem"&&$.dem&&this._backfillDEM($),U(ie,$)})},c)}}function jc(m,i){const c=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*i.wrap)-+(i.wrap<0);return m.overscaledZ-i.overscaledZ||g-c||i.canonical.y-m.canonical.y||i.canonical.x-m.canonical.x}function Rl(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function la(m,i){const c=1<<m.z;return[m.x/c+i,(m.x+1)/c+i]}Kn.maxOverzooming=10,Kn.maxUnderzooming=3;class Nc{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,c=!1;for(const g in this.style._mergedLayers){const E=this.style._mergedLayers[g];if(E.type==="fill-extrusion"||E.type==="building")this.layers.push({layer:E,visible:i,visibilityChanged:c});else if(E.type==="model"){const A=this.style.getLayerSource(E);A&&A.type==="batched-model"&&this.layers.push({layer:E,visible:i,visibilityChanged:c})}}}onNewFrame(i){this.layersGotHidden=!1;for(const c of this.layers){const g=c.layer;let E=!1;g.type==="fill-extrusion"?E=!g.isHidden(i)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?E=!g.isHidden(i)&&g.paint.get("building-opacity")>0:g.type==="model"&&(E=!g.isHidden(i)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!E&&c.visible,c.visible=E}}updateZOffset(i,c){this.currentBuildingBuckets=[];for(const E of this.layers){const A=E.layer,M=this.style.getLayerSourceCache(A);let D=1;A.type==="fill-extrusion"?D=E.visible?A.paint.get("fill-extrusion-vertical-scale"):0:A.type==="building"&&(D=E.visible?A.paint.get("building-vertical-scale"):0);let z=M?M.getTile(c):null;if(!z&&M)for(const U in M._tiles){const $=M._tiles[U];if(c.canonical.isChildOf($.tileID.canonical)){z=$;break}}this.currentBuildingBuckets.push({bucket:z?z.getBucket(A):null,tileID:z?z.tileID:c,verticalScale:D})}i.hasAnyZOffset=!1;let g=!1;for(let E=0;E<i.symbolInstances.length;E++){const A=i.symbolInstances.get(E),M=A.zOffset,D=this._getHeightAtTileOffset(c,A.tileAnchorX,A.tileAnchorY);A.zOffset=D!==Number.NEGATIVE_INFINITY?D:M,g||M===A.zOffset||(g=!0),i.hasAnyZOffset||A.zOffset===0||(i.hasAnyZOffset=!0)}g&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,c,g,E){let A=c,M=g;if(i.canonical.z!==E.canonical.z){const D=E.canonical,z=1/(1<<i.canonical.z-D.z);A=(c+i.canonical.x*a.al)*z-D.x*a.al|0,M=(g+i.canonical.y*a.al)*z-D.y*a.al|0}return{tileX:A,tileY:M}}_getHeightAtTileOffset(i,c,g){let E,A;for(let M=0;M<this.layers.length;++M){const D=this.layers[M].layer;if(D.type!=="fill-extrusion"&&D.type!=="building")continue;const{bucket:z,tileID:U,verticalScale:$}=this.currentBuildingBuckets[M];if(!z)continue;const{tileX:ie,tileY:K}=this._mapCoordToOverlappingTile(i,c,g,U),re=z.getHeightAtTileCoord(ie,K);re&&re.height!==void 0&&(re.hidden?E=re.height:A=Math.max(re.height*$,A||0))}if(A!==void 0)return A;for(let M=0;M<this.layers.length;++M){const D=this.layers[M];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:z,tileID:U}=this.currentBuildingBuckets[M];if(!z)continue;const{tileX:$,tileY:ie}=this._mapCoordToOverlappingTile(i,c,g,U),K=z.getHeightAtTileCoord($,ie);if(K&&!K.hidden)return K.height===void 0&&E!==void 0?Math.min(K.maxHeight,E)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Gd(m,i){const c={};for(const g in m)g!=="ref"&&(c[g]=m[g]);return a.bx.forEach(g=>{g in i&&(c[g]=i[g])}),c}function $d(m){m=m.slice();const i=Object.create(null);for(let c=0;c<m.length;c++)i[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=Gd(m[c],i[m[c].ref]));return m}const nr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ml(m,i,c){c.push({command:nr.addSource,args:[m,i[m]]})}function Bh(m,i,c){i.push({command:nr.removeSource,args:[m]}),c[m]=!0}function ya(m,i,c,g){Bh(m,c,g),Ml(m,i,c)}function ac(m,i,c){let g;for(g in m[c])if(m[c].hasOwnProperty(g)&&g!=="data"&&!a.by(m[c][g],i[c][g]))return!1;for(g in i[c])if(i[c].hasOwnProperty(g)&&g!=="data"&&!a.by(m[c][g],i[c][g]))return!1;return!0}function oc(m,i,c,g,E,A){let M;for(M in i=i||{},m=m||{})m.hasOwnProperty(M)&&(a.by(m[M],i[M])||c.push({command:A,args:[g,M,i[M],E]}));for(M in i)i.hasOwnProperty(M)&&!m.hasOwnProperty(M)&&(a.by(m[M],i[M])||c.push({command:A,args:[g,M,i[M],E]}))}function po(m){return m.id}function jh(m,i){return m[i.id]=i,m}function Ou(m,i,c){const g=i.createTileMatrix(m,m.worldSize,c.toUnwrapped());return a.aB(new Float32Array(16),m.projMatrix,g)}function ap(m,i,c){if(i.projection.name===c.projection.name)return m.projMatrix;const g=c.clone();return g.setProjection(i.projection),Ou(g,i.getProjection(),m)}function nl(m,i,c){return i.name===c.projection.name?m.projMatrix:Ou(c,i,m)}class mo{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.aA(i,0,1);let c=1,g=this._distances[c];const E=i*this.paddedLength+this.padding;for(;g<E&&c<this._distances.length;)g=this._distances[++c];const A=c-1,M=this._distances[A],D=g-M,z=D>0?(E-M)/D:0;return this.points[A].mult(1-z).add(this.points[c].mult(z))}}class zu{constructor(i,c,g){const E=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(i/g),this.yCellCount=Math.ceil(c/g);for(let M=0;M<this.xCellCount*this.yCellCount;M++)E.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,g,E,A){this._forEachCell(c,g,E,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(E),this.bboxes.push(A)}insertCircle(i,c,g,E){this._forEachCell(c-E,g-E,c+E,g+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(g),this.circles.push(E)}_insertBoxCell(i,c,g,E,A,M){this.boxCells[A].push(M)}_insertCircleCell(i,c,g,E,A,M){this.circleCells[A].push(M)}_query(i,c,g,E,A,M){if(g<0||i>this.width||E<0||c>this.height)return!A&&[];const D=[];if(i<=0&&c<=0&&this.width<=g&&this.height<=E){if(A)return!0;for(let z=0;z<this.boxKeys.length;z++)D.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const U=this.circles[3*z],$=this.circles[3*z+1],ie=this.circles[3*z+2];D.push({key:this.circleKeys[z],x1:U-ie,y1:$-ie,x2:U+ie,y2:$+ie})}return M?D.filter(M):D}return this._forEachCell(i,c,g,E,this._queryCell,D,{hitTest:A,seenUids:{box:{},circle:{}}},M),A?D.length>0:D}_queryCircle(i,c,g,E,A){const M=i-g,D=i+g,z=c-g,U=c+g;if(D<0||M>this.width||U<0||z>this.height)return!E&&[];const $=[];return this._forEachCell(M,z,D,U,this._queryCellCircle,$,{hitTest:E,circle:{x:i,y:c,radius:g},seenUids:{box:{},circle:{}}},A),E?$.length>0:$}query(i,c,g,E,A){return this._query(i,c,g,E,!1,A)}hitTest(i,c,g,E,A){return this._query(i,c,g,E,!0,A)}hitTestCircle(i,c,g,E){return this._queryCircle(i,c,g,!0,E)}_queryCell(i,c,g,E,A,M,D,z){const U=D.seenUids,$=this.boxCells[A];if($!==null){const K=this.bboxes;for(const re of $)if(!U.box[re]){U.box[re]=!0;const he=4*re;if(i<=K[he+2]&&c<=K[he+3]&&g>=K[he+0]&&E>=K[he+1]&&(!z||z(this.boxKeys[re]))){if(D.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[re],x1:K[he],y1:K[he+1],x2:K[he+2],y2:K[he+3]})}}}const ie=this.circleCells[A];if(ie!==null){const K=this.circles;for(const re of ie)if(!U.circle[re]){U.circle[re]=!0;const he=3*re;if(this._circleAndRectCollide(K[he],K[he+1],K[he+2],i,c,g,E)&&(!z||z(this.circleKeys[re]))){if(D.hitTest)return M.push(!0),!0;{const ce=K[he],de=K[he+1],ge=K[he+2];M.push({key:this.circleKeys[re],x1:ce-ge,y1:de-ge,x2:ce+ge,y2:de+ge})}}}}}_queryCellCircle(i,c,g,E,A,M,D,z){const U=D.circle,$=D.seenUids,ie=this.boxCells[A];if(ie!==null){const re=this.bboxes;for(const he of ie)if(!$.box[he]){$.box[he]=!0;const ce=4*he;if(this._circleAndRectCollide(U.x,U.y,U.radius,re[ce+0],re[ce+1],re[ce+2],re[ce+3])&&(!z||z(this.boxKeys[he])))return M.push(!0),!0}}const K=this.circleCells[A];if(K!==null){const re=this.circles;for(const he of K)if(!$.circle[he]){$.circle[he]=!0;const ce=3*he;if(this._circlesCollide(re[ce],re[ce+1],re[ce+2],U.x,U.y,U.radius)&&(!z||z(this.circleKeys[he])))return M.push(!0),!0}}}_forEachCell(i,c,g,E,A,M,D,z){const U=this._convertToXCellCoord(i),$=this._convertToYCellCoord(c),ie=this._convertToXCellCoord(g),K=this._convertToYCellCoord(E);for(let re=U;re<=ie;re++)for(let he=$;he<=K;he++)if(A.call(this,i,c,g,E,this.xCellCount*he+re,M,D,z))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,g,E,A,M){const D=E-i,z=A-c,U=g+M;return U*U>D*D+z*z}_circleAndRectCollide(i,c,g,E,A,M,D){const z=(M-E)/2,U=Math.abs(i-(E+z));if(U>z+g)return!1;const $=(D-A)/2,ie=Math.abs(c-(A+$));if(ie>$+g)return!1;if(U<=z||ie<=$)return!0;const K=U-z,re=ie-$;return K*K+re*re<=g*g}}const Cm=Math.tan(85*Math.PI/180);function Vc(m,i,c,g,E,A,M){const D=a.bC();if(c)if(A.name==="globe"){const z=a.bD(E,i);a.aB(D,D,z)}else{const z=a.bE([],M);D[0]=z[0],D[1]=z[1],D[4]=z[2],D[5]=z[3],g||a.bB(D,D,E.angle)}else a.aB(D,E.labelPlaneMatrix,m);return D}function Pl(m,i,c,g,E,A,M){const D=Vc(m,i,c,g,E,A,M);return A.name==="globe"&&c||(D[2]=D[6]=D[10]=D[14]=0),D}function Xs(m,i,c,g,E,A,M){if(c){if(A.name==="globe"){const D=Vc(m,i,c,g,E,A,M);return a.bl(D,D),a.aB(D,m,D),D}{const D=a.bz(m),z=a.bA([]);return z[0]=M[0],z[1]=M[1],z[4]=M[2],z[5]=M[3],a.aB(D,D,z),g||a.bB(D,D,-E.angle),D}}return E.glCoordMatrix}function go(m,i,c,g){const E=[m,i,c,1];c?a.aC(E,E,g):qd(E,E,g);const A=E[3];return E[0]/=A,E[1]/=A,E[2]/=A,E}function Hd(m,i){return Math.min(.5+m/i*.5,1.5)}function Rm(m,i){const c=m[0]/m[3],g=m[1]/m[3];return c>=-i[0]&&c<=i[0]&&g>=-i[1]&&g<=i[1]}function _r(m,i,c,g,E,A,M,D,z,U,$=1){const ie=c.transform,K=g?m.textSizeData:m.iconSizeData,re=a.bK(K,c.transform.zoom,$),he=ie.projection.name==="globe",ce=[256/c.width*2+1,256/c.height*2+1],de=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;de.clear();let ge=null;he&&(ge=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Ce=m.lineVertexArray,Ae=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ee=c.transform.width/c.transform.height;let Ge,je=!1;for(let Ue=0;Ue<Ae.length;Ue++){const ze=Ae.get(Ue),{numGlyphs:Pe,writingMode:We}=ze;if(We!==a.bL.vertical||je||Ge===a.bL.horizontal||(je=!0),Ge=We,(ze.hidden||We===a.bL.vertical)&&!je){Fs(Pe,de);continue}je=!1;const Xe=new a.P(ze.tileAnchorX,ze.tileAnchorY),Qe=m.elevationType==="road",rt=!!ie.elevation||Qe;let{x:tt,y:pt,z:wt}=ie.projection.projectTilePoint(Xe.x,Xe.y,U.canonical),nt=null;if(rt){const oi=Qe?m.getElevationFeatureForText(Ue):null;nt={getElevation:z,elevation:ie.elevation,elevationFeature:oi};const[_i,Ti,Fi]=z(Xe,ie.elevation,oi);tt+=_i,pt+=Ti,wt+=Fi}const Ze=[tt,pt,wt,1];if(a.aC(Ze,Ze,i),!Rm(Ze,ce)){Fs(Pe,de);continue}const _t=Ze[3],ot=Hd(c.transform.getCameraToCenterDistance(ie.projection),_t),bt=a.bM(K,re,ze),Lt=M?bt/ot:bt*ot,Wt=go(tt,pt,wt,E);if(Wt[3]<=0){Fs(Pe,de);continue}let jt={};const zt=a.an(m.layers[0].layout.get("text-max-angle")),hi=Math.cos(zt),ai=M?null:nt,Xt=Mm(ze,Lt,!1,D,i,E,A,m.glyphOffsetArray,Ce,de,ge,Wt,Xe,jt,Ee,ai,ie.projection,U,M,hi);je=Xt.useVertical,ai&&Xt.needsFlipping&&(jt={}),(Xt.notEnoughRoom||je||Xt.needsFlipping&&Mm(ze,Lt,!0,D,i,E,A,m.glyphOffsetArray,Ce,de,ge,Wt,Xe,jt,Ee,ai,ie.projection,U,M,hi).notEnoughRoom)&&Fs(Pe,de)}g?(m.text.dynamicLayoutVertexBuffer.updateData(de),ge&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ge)):(m.icon.dynamicLayoutVertexBuffer.updateData(de),ge&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ge))}function lp(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de){const{lineStartIndex:ge,glyphStartIndex:Ce,segment:Ae}=D,Ee=Ce+D.numGlyphs,Ge=ge+D.lineLength,je=i.getoffsetX(Ce),Ue=i.getoffsetX(Ee-1),ze=Uc(m*je,c,g,E,A,M,Ae,ge,Ge,z,U,$,ie,K,!0,re,he,ce,de);if(!ze)return null;const Pe=Uc(m*Ue,c,g,E,A,M,Ae,ge,Ge,z,U,$,ie,K,!0,re,he,ce,de);return Pe?{first:ze,last:Pe}:null}function cp(m,i,c,g){return m===a.bL.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:m===a.bL.vertical?g>0?{needsFlipping:!0}:null:i!==0&&(function(E,A){return E===0||Math.abs(A/E)>Cm})(c,g)?i===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Mm(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce,Ae){const Ee=i/24,Ge=m.lineOffsetX*Ee,je=m.lineOffsetY*Ee,{lineStartIndex:Ue,glyphStartIndex:ze,numGlyphs:Pe,segment:We,writingMode:Xe,flipState:Qe}=m,rt=Ue+m.lineLength,tt=pt=>{if($){const[_t,ot,bt]=pt.up,Lt=U.length;a.bN($,Lt+0,_t,ot,bt),a.bN($,Lt+1,_t,ot,bt),a.bN($,Lt+2,_t,ot,bt),a.bN($,Lt+3,_t,ot,bt)}const[wt,nt,Ze]=pt.point;a.bO(U,wt,nt,Ze,pt.angle)};if(Pe>1){const pt=lp(Ee,D,Ge,je,c,ie,K,m,z,A,re,ce,!1,de,ge,Ce,Ae);if(!pt)return{notEnoughRoom:!0};if(g&&!c){let[wt,nt,Ze]=pt.first.point,[_t,ot,bt]=pt.last.point;[wt,nt]=go(wt,nt,Ze,M),[_t,ot]=go(_t,ot,bt,M);const Lt=cp(Xe,Qe,(_t-wt)*he,ot-nt);if(m.flipState=Lt&&Lt.needsFlipping?1:2,Lt)return Lt}tt(pt.first);for(let wt=ze+1;wt<ze+Pe-1;wt++){const nt=Uc(Ee*D.getoffsetX(wt),Ge,je,c,ie,K,We,Ue,rt,z,A,re,ce,!1,!1,de,ge,Ce,Ae);if(!nt)return U.length-=4*(wt-ze),{notEnoughRoom:!0};tt(nt)}tt(pt.last)}else{if(g&&!c){const wt=go(K.x,K.y,0,E),nt=Ue+We+1,Ze=new a.P(z.getx(nt),z.gety(nt)),_t=go(Ze.x,Ze.y,0,E),ot=_t[3]>0?_t:up(K,Ze,wt,1,E,void 0,de,ge.canonical),bt=cp(Xe,Qe,(ot[0]-wt[0])*he,ot[1]-wt[1]);if(m.flipState=bt&&bt.needsFlipping?1:2,bt)return bt}const pt=Uc(Ee*D.getoffsetX(ze),Ge,je,c,ie,K,We,Ue,rt,z,A,re,ce,!1,!1,de,ge,Ce,Ae);if(!pt)return{notEnoughRoom:!0};tt(pt)}return{}}function Ri(m,i,c,g,E){const{x:A,y:M,z:D}=g.projectTilePoint(m.x,m.y,i);if(!E)return go(A,M,D,c);const[z,U,$]=E.getElevation(m,E.elevation,E.elevationFeature);return go(A+z,M+U,D+$,c)}function up(m,i,c,g,E,A,M,D){const z=Ri(m.sub(i)._unit()._add(m),D,E,M,A);return a.av(z,c,z),a.aw(z,z),a.bH(z,c,z,g)}function Uc(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce){const Ae=g?m-i:m+i;let Ee=Ae>0?1:-1,Ge=0;g&&(Ee*=-1,Ge=Math.PI),Ee<0&&(Ge+=Math.PI);let je=D+M+(Ee>0?0:1)|0,Ue=E,ze=E,Pe=0,We=0;const Xe=Math.abs(Ae),Qe=[],rt=[];let tt=A,pt=tt,wt=a.bF([]);const nt=()=>up(pt,tt,ze,Xe-Pe+1,$,K,ce,de.canonical);for(;Pe+We<=Xe;){if(je+=Ee,je<D||je>=z)return null;if(ze=Ue,pt=tt,Qe.push(ze),re&&rt.push(pt),tt=new a.P(U.getx(je),U.gety(je)),Ue=ie[je],!Ue){const ai=Ri(tt,de.canonical,$,ce,K);Ue=ai[3]>0?ie[je]=ai:nt()}Pe+=We;const zt=a.av([],Ue,ze),hi=a.bG(ze,Ue);if(c&&hi>0&&We>0&&a.bJ(wt,zt)/(We*hi)<Ce)return null;We=hi,wt=zt}he&&K&&(ie[je]&&(Ue=nt(),We=a.bG(ze,Ue),wt=a.av([],Ue,ze)),ie[je]=Ue);const Ze=(Xe-Pe)/We,_t=tt.sub(pt)._mult(Ze)._add(pt),ot=a.bH([],ze,wt,Ze);let bt=[0,0,1],Lt=wt[0],Wt=wt[1];if(ge&&(bt=ce.upVector(de.canonical,_t.x,_t.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const zt=[bt[2],0,-bt[0]],hi=a.bI([],bt,zt);a.aw(zt,zt),a.aw(hi,hi),Lt=a.bJ(wt,zt),Wt=a.bJ(wt,hi)}if(c){const zt=a.bI([],bt,wt);a.aw(zt,zt),a.bH(ot,ot,zt,c*Ee)}const jt=Ge+Math.atan2(Wt,Lt);return Qe.push(ot),re&&rt.push(_t),{point:ot,angle:jt,path:Qe,tilePath:rt,up:bt}}function Fs(m,i){const c=i.length,g=c+4*m;i.resize(g),i.float32.fill(-1/0,4*c,4*g)}function qd(m,i,c){const g=i[0],E=i[1];return m[0]=c[0]*g+c[4]*E+c[12],m[1]=c[1]*g+c[5]*E+c[13],m[3]=c[3]*g+c[7]*E+c[15],m}const _a=100;class gi{constructor(i,c,g=new zu(i.width+200,i.height+200,25),E=new zu(i.width+200,i.height+200,25)){this.transform=i,this.grid=g,this.ignoredGrid=E,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+_a,this.screenBottomBoundary=i.height+_a,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,g,E,A,M,D,z,U,$,ie){let K=g.projectedAnchorX,re=g.projectedAnchorY,he=g.projectedAnchorZ;const ce=g.tileAnchorX,de=g.tileAnchorY,ge=g.elevation,Ce=g.tileID,Ae=i.getProjection();if(ge&&Ce){const[rt,tt,pt]=Ae.upVector(Ce.canonical,g.tileAnchorX,g.tileAnchorY),wt=Ae.upVectorScale(Ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=rt*ge*wt,re+=tt*ge*wt,he+=pt*ge*wt}const Ee=i.projection.name==="globe",Ge=i.projection.name==="globe"?a.aj(this.transform.zoom):0;if(Ce&&Ee&&Ge<1&&!M){const rt=1<<Ce.canonical.z,tt=a.bP(ce,de);a.bQ(tt,tt,1/a.al),a.bR(tt,tt,a.bP(Ce.canonical.x,Ce.canonical.y)),a.bQ(tt,tt,1/rt),a.bS(tt,tt,a.bP(E[0],E[1])),tt[0]=a.bT(tt[0],-.5,.5),a.bQ(tt,tt,a.al);const pt=a.bU(tt[0],tt[1],a.al/(2*Math.PI),1);a.aC(pt,pt,A),K=a.ak(K,pt[0],Ge),re=a.ak(re,pt[1],Ge),he=a.ak(he,pt[2],Ge)}const je=this.projectAndGetPerspectiveRatio($,K,re,he,g.tileID,Ae.name==="globe"||!!ge||this.transform.pitch>0,Ae),Ue=U*je.perspectiveRatio,ze=(g.x1*c+D.x-g.padding)*Ue+je.point.x,Pe=(g.y1*c+D.y-g.padding)*Ue+je.point.y,We=(g.x2*c+D.x+g.padding)*Ue+je.point.x,Xe=(g.y2*c+D.y+g.padding)*Ue+je.point.y,Qe=je.perspectiveRatio<=.55||je.occluded;return!this.isInsideGrid(ze,Pe,We,Xe)||!z&&this.grid.hitTest(ze,Pe,We,Xe,ie)||Qe?{box:[],offscreen:!1,occluded:je.occluded}:{box:[ze,Pe,We,Xe],offscreen:this.isOffscreen(ze,Pe,We,Xe),occluded:!1}}placeCollisionCircles(i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de){const ge=[],Ce=this.transform.elevation,Ae=i.getProjection(),Ee=i.elevationType==="road",Ge=!!Ce||Ee,je=a.bV.getAtTileOffsetFunc(de,this.transform.center.lat,this.transform.worldSize,Ae),Ue=new a.P(g.tileAnchorX,g.tileAnchorY),ze=new a.P(g.tileAnchorX,g.tileAnchorY);let{x:Pe,y:We,z:Xe}=Ae.projectTilePoint(ze.x,ze.y,de.canonical),Qe=null;if(Ge){const hi=Ee?i.getElevationFeatureForText(E):null;Qe={getElevation:je,elevation:Ce,elevationFeature:hi};const[ai,Xt,oi]=je(Ue,Ce,hi);Pe+=ai,We+=Xt,Xe+=oi}const rt=Ae.name==="globe",tt=this.projectAndGetPerspectiveRatio(z,Pe,We,Xe,de,rt||!!Ce||this.transform.pitch>0,Ae),{perspectiveRatio:pt}=tt,wt=(K?D/pt:D*pt)/a.bY,nt=go(Pe,We,Xe,U),Ze=g.lineOffsetX*wt,_t=g.lineOffsetY*wt,ot=a.an(i.layers[0].layout.get("text-max-angle")),bt=Math.cos(ot),Lt=tt.signedDistanceFromCamera>0?lp(wt,M,Ze,_t,Ee&&g.flipState===1,nt,ze,g,A,U,{},Ge&&!K?Qe:null,K&&Ge,Ae,de,K,bt):null;let Wt=!1,jt=!1,zt=!0;if(Lt&&!tt.occluded){const hi=.5*he*pt+ce,ai=new a.P(-100,-100),Xt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new mo,{first:_i,last:Ti}=Lt,Fi=_i.path.length;let Yi=[];for(let Di=Fi-1;Di>=1;Di--)Yi.push(_i.path[Di]);for(let Di=1;Di<Ti.path.length;Di++)Yi.push(Ti.path[Di]);const Ai=2.5*hi;$&&(Yi=Yi.map(([Di,ur,sr],vr)=>(Ge&&!rt&&(sr=je(vr<Fi-1?_i.tilePath[Fi-1-vr]:Ti.tilePath[vr-Fi+2],Ce,Qe.elevationFeature)[2]),go(Di,ur,sr,$))),Yi.some(Di=>Di[3]<=0)&&(Yi=[]));let Bi=[];if(Yi.length>0){let Di=1/0,ur=-1/0,sr=1/0,vr=-1/0;for(const er of Yi)Di=Math.min(Di,er[0]),sr=Math.min(sr,er[1]),ur=Math.max(ur,er[0]),vr=Math.max(vr,er[1]);ur>=ai.x&&Di<=Xt.x&&vr>=ai.y&&sr<=Xt.y&&(Bi=[Yi.map(er=>new a.P(er[0],er[1]))],(Di<ai.x||ur>Xt.x||sr<ai.y||vr>Xt.y)&&(Bi=a.bW(Bi,ai.x,ai.y,Xt.x,Xt.y)))}for(const Di of Bi){oi.reset(Di,.25*hi);let ur=0;ur=oi.length<=.5*hi?1:Math.ceil(oi.paddedLength/Ai)+1;for(let sr=0;sr<ur;sr++){const vr=sr/Math.max(ur-1,1),er=oi.lerp(vr),ji=er.x+_a,or=er.y+_a;ge.push(ji,or,hi,0);const Hr=ji-hi,br=or-hi,pr=ji+hi,Oi=or+hi;if(zt=zt&&this.isOffscreen(Hr,br,pr,Oi),jt=jt||this.isInsideGrid(Hr,br,pr,Oi),!c&&this.grid.hitTestCircle(ji,or,hi,re)&&(Wt=!0,!ie))return{circles:[],offscreen:!1,collisionDetected:Wt,occluded:!1}}}}return{circles:!ie&&Wt||!jt?[]:ge,offscreen:zt,collisionDetected:Wt,occluded:tt.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let g=1/0,E=1/0,A=-1/0,M=-1/0;for(const $ of i){const ie=new a.P($.x+_a,$.y+_a);g=Math.min(g,ie.x),E=Math.min(E,ie.y),A=Math.max(A,ie.x),M=Math.max(M,ie.y),c.push(ie)}const D=this.grid.query(g,E,A,M).concat(this.ignoredGrid.query(g,E,A,M)),z={},U={};for(const $ of D){const ie=$.key;if(z[ie.bucketInstanceId]===void 0&&(z[ie.bucketInstanceId]={}),z[ie.bucketInstanceId][ie.featureIndex])continue;const K=[new a.P($.x1,$.y1),new a.P($.x2,$.y1),new a.P($.x2,$.y2),new a.P($.x1,$.y2)];a.bX(c,K)&&(z[ie.bucketInstanceId][ie.featureIndex]=!0,U[ie.bucketInstanceId]===void 0&&(U[ie.bucketInstanceId]=[]),U[ie.bucketInstanceId].push(ie.featureIndex))}return U}insertCollisionBox(i,c,g,E,A){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:E,collisionGroupID:A},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,g,E,A){const M=c?this.ignoredGrid:this.grid,D={bucketInstanceId:g,featureIndex:E,collisionGroupID:A};for(let z=0;z<i.length;z+=4)M.insertCircle(D,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,c,g,E,A,M,D){const z=[c,g,E,1];let U=!1;E||this.transform.pitch>0?(a.aC(z,z,i),this.fogState&&A&&D.name!=="globe"&&(U=(function(K,re,he,ce,de,ge){const Ce=ge.calculateFogTileMatrix(de),Ae=[re,he,ce];return a.af(Ae,Ae,Ce),yi(K,a.ag(Ae),ge.pitch,ge._fov)})(this.fogState,c,g,E,A.toUnwrapped(),this.transform)>.9)):qd(z,z,i);const $=z[3];return{point:new a.P((z[0]/$+1)/2*this.transform.width+_a,(-z[1]/$+1)/2*this.transform.height+_a),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/$*.5,1.5),signedDistanceFromCamera:$,occluded:M&&z[2]>$||U}}isOffscreen(i,c,g,E){return g<_a||i>=this.screenRightBoundary||E<_a||c>this.screenBottomBoundary}isInsideGrid(i,c,g,E){return g>=0&&i<this.gridRightBoundary&&E>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=a.bA([]);return a.br(i,i,[-100,-100,0]),i}}class gr{constructor(i,c,g,E){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):E&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class dr{constructor(i,c,g,E,A,M=!1){this.text=new gr(i?i.text:null,c,g,A),this.icon=new gr(i?i.icon:null,c,E,A),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ca{constructor(i,c,g,E=!1){this.text=i,this.icon=c,this.skipFade=g,this.clipped=E}}class Fu{constructor(){this.invProjMatrix=a.bC(),this.viewportMatrix=a.bC(),this.circles=[]}}class wr{constructor(i,c,g,E,A){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=E,this.tileID=A}}class Wd{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[i]}}function Bu(m,i,c,g,E){const{horizontalAlign:A,verticalAlign:M}=a.c1(m),D=-(A-.5)*i,z=-(M-.5)*c,U=a.c2(m,g);return new a.P(D+U[0]*E,z+U[1]*E)}function Gc(m,i,c,g,E){const A=new a.P(m,i);return c&&A._rotate(g?E:-E),A}class Ys{constructor(i,c,g,E,A,M){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new gi(this.transform,A),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Wd(g),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(i,c,g,E,A=1){const M=g.getBucket(c),D=g.latestFeatureIndex;if(!M||!D||c.fqid!==M.layerIds[0])return;const z=M.layers[0].layout,U=M.layers[0].paint,$=g.collisionBoxArray,ie=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),K=g.tileSize/a.al,re=g.tileID.toUnwrapped();this.transform.setProjection(M.projection);const he=(ce=g.tileID,de=M.getProjection(),ge=this.transform,de.name===this.projection?ge.calculateProjMatrix(ce.toUnwrapped()):Ou(ge,de,ce));var ce,de,ge;const Ce=z.get("text-pitch-alignment")==="map",Ae=z.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const Ee=c.dynamicFilter(),Ge=c.dynamicFilterNeedsFeature(),je=this.transform.calculatePixelsToTileUnitsMatrix(g),Ue=Pl(he,g.tileID.canonical,Ce,Ae,this.transform,M.getProjection(),je);let ze=null;const Pe=M.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(Ce){const Ze=Xs(he,g.tileID.canonical,Ce,Ae,this.transform,M.getProjection(),je);ze=a.aB([],this.transform.labelPlaneMatrix,Ze)}let We=null;Ee&&g.latestFeatureIndex&&(We={unwrappedTileID:re,dynamicFilter:Ee,dynamicFilterNeedsFeature:Ge}),this.retainedQueryData[M.bucketInstanceId]=new wr(M.bucketInstanceId,D,M.sourceLayerIndex,M.index,g.tileID);const[Xe,Qe]=M.layers[0].layout.get("text-size-scale-range"),rt=a.aA(A,Xe,Qe),[tt,pt]=z.get("icon-size-scale-range"),wt=a.aA(A,tt,pt),nt={bucket:M,layout:z,paint:U,posMatrix:he,invMatrix:Pe,mercatorCenter:[a.aF(this.transform.center.lng),a.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ue,labelToScreenMatrix:ze,clippingData:We,scale:ie,textPixelRatio:K,holdingForFade:g.holdingForFade(),collisionBoxArray:$,partiallyEvaluatedTextSize:a.bK(M.textSizeData,this.transform.zoom,rt),partiallyEvaluatedIconSize:a.bK(M.iconSizeData,this.transform.zoom,wt),collisionGroup:this.collisionGroups.get(M.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(E)for(const Ze of M.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:ot,symbolInstanceEnd:bt}=Ze;i.push({sortKey:_t,symbolInstanceStart:ot,symbolInstanceEnd:bt,parameters:nt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce,Ae,Ee,Ge){const{textOffset0:je,textOffset1:Ue,crossTileID:ze}=ce,Pe=[je,Ue],We=Bu(i,M,D,Pe,z),Xe=this.collisionIndex.placeCollisionBox(ge,z,c,g,E,A,Gc(We.x,We.y,U,$,this.transform.angle),he,ie,K,re.predicate);if(Ae){const Qe=ge.getSymbolInstanceIconSize(Ge,this.transform.zoom,ce.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ge,Qe,Ae,g,E,A,Gc(We.x,We.y,U,$,this.transform.angle),he,ie,K,re.predicate).box.length===0)return}if(Xe.box.length>0){let Qe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&(Qe=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:Pe,width:M,height:D,anchor:i,textScale:z,prevAnchor:Qe},this.markUsedJustification(ge,i,ce,Ce),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,Ce,ce),this.placedOrientations[ze]=Ce),{shift:We,placedGlyphBoxes:Xe}}}placeLayerBucketPart(i,c,g,E,A=1){const{bucket:M,layout:D,paint:z,posMatrix:U,textLabelPlaneMatrix:$,labelToScreenMatrix:ie,clippingData:K,textPixelRatio:re,mercatorCenter:he,invMatrix:ce,holdingForFade:de,collisionBoxArray:ge,partiallyEvaluatedTextSize:Ce,partiallyEvaluatedIconSize:Ae,collisionGroup:Ee,latestFeatureIndex:Ge}=i.parameters,je=D.get("text-optional"),Ue=D.get("icon-optional"),ze=D.get("text-allow-overlap"),Pe=D.get("icon-allow-overlap"),We=D.get("text-rotation-alignment")==="map",Xe=D.get("icon-rotation-alignment")==="map",Qe=D.get("text-pitch-alignment")==="map",rt=z.get("symbol-z-offset"),tt=D.get("symbol-elevation-reference")==="sea",pt=D.get("symbol-placement"),[wt,nt]=D.get("text-size-scale-range"),[Ze,_t]=D.get("icon-size-scale-range"),ot=a.aA(A,wt,nt),bt=a.aA(A,Ze,_t),Lt=D.get("text-variable-anchor"),Wt=We&&pt!=="point",jt=Xe&&pt!=="point",zt=Lt&&M.hasTextData(),hi=M.hasIconTextFit()&&zt&&M.hasIconData();this.transform.setProjection(M.projection);const ai=zt||Wt,Xt=jt||hi;let oi=ze&&(Pe||!M.hasIconData()||Ue),_i=Pe&&(ze||!M.hasTextData()||je);const Ti=!rt.isConstant();!M.collisionArrays&&ge&&M.deserializeCollisionBoxes(ge),g&&E&&M.updateCollisionDebugBuffers(this.transform.zoom,ge,ot,bt);const Fi=(Ai,Bi,Di)=>{const{crossTileID:ur,numVerticalGlyphVertices:sr}=Ai;let vr=null;if(K&&K.dynamicFilterNeedsFeature||Ti){const Qr=this.retainedQueryData[M.bucketInstanceId];vr=Ge.loadFeature({featureIndex:Ai.featureIndex,bucketIndex:Qr.bucketIndex,sourceLayerIndex:Qr.sourceLayerIndex,layoutVertexArrayOffset:0});const Cn=vr.properties?vr.properties.worldview:null;if(M.localizable&&M.worldview&&typeof Cn=="string")if(Cn==="all")vr.properties.$localized=!0;else{if(!Cn.split(",").includes(M.worldview))return;vr.properties.$localized=!0,vr.properties.worldview=M.worldview}}if(K&&!(0,K.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:M.worldview},vr,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new a.P(Ai.tileAnchorX,Ai.tileAnchorY),this.transform.calculateDistanceTileData(K.unwrappedTileID)))return this.placements[ur]=new ca(!1,!1,!1,!0),void c.add(ur);const er=rt.evaluate(vr,{});if(c.has(ur))return;if(de)return void(this.placements[ur]=new ca(!1,!1,!1));let ji=!1,or=!1,Hr=!0,br=!1,pr=!1,Oi=null,Ni={box:null,offscreen:null,occluded:null},kr={box:null},sn=null,Er=null,Lr=null,Vs=0,ws=0,ns=0;Di.textFeatureIndex?Vs=Di.textFeatureIndex:Ai.useRuntimeCollisionCircles&&(Vs=Ai.featureIndex),Di.verticalTextFeatureIndex&&(ws=Di.verticalTextFeatureIndex);const mr=M.elevationFeatures?M.elevationFeatures[Ai.elevationFeatureIndex]:void 0,Aa=Qr=>{Qr.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const Cn=this.transform.elevation;Qr.elevation=tt?er:er+a.bV.getAtTileOffset(Qr.tileID,new a.P(Qr.tileAnchorX,Qr.tileAnchorY),Cn,mr),Qr.elevation+=Ai.zOffset},Es=Di.textBox;if(Es){Aa(Es);const Qr=jr=>{let Ln=a.bL.horizontal;if(M.allowVerticalPlacement&&!jr&&this.prevPlacement){const Jn=this.prevPlacement.placedOrientations[ur];Jn&&(this.placedOrientations[ur]=Jn,Ln=Jn,this.markUsedOrientation(M,Ln,Ai))}return Ln},Cn=(jr,Ln)=>{if(M.allowVerticalPlacement&&sr>0&&Di.verticalTextBox){for(const Jn of M.writingModes)if(Jn===a.bL.vertical?(Ni=Ln(),kr=Ni):Ni=jr(),Ni&&Ni.box&&Ni.box.length)break}else Ni=jr()};if(Lt){let jr=Lt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ur]){const tn=this.prevPlacement.variableOffsets[ur];jr.indexOf(tn.anchor)>0&&(jr=jr.filter(Ca=>Ca!==tn.anchor),jr.unshift(tn.anchor))}const Ln=(tn,Ca,bh)=>{const Zo=M.getSymbolInstanceTextSize(Ce,Ai,this.transform.zoom,Bi),vu=(tn.x2-tn.x1)*Zo+2*tn.padding,bu=(tn.y2-tn.y1)*Zo+2*tn.padding,Ra=Ai.hasIconTextFit&&!Pe?Ca:null;Ra&&Aa(Ra);let ro={box:[],offscreen:!1,occluded:!1};const Xo=ze?2*jr.length:jr.length;for(let Ua=0;Ua<Xo;++Ua){const Vr=this.attemptAnchorPlacement(jr[Ua%jr.length],tn,he,ce,ai,vu,bu,Zo,We,Qe,re,U,Ee,Ua>=jr.length,Ai,Bi,M,bh,Ra,Ce,Ae);if(Vr&&(ro=Vr.placedGlyphBoxes,ro&&ro.box&&ro.box.length)){ji=!0,Oi=Vr.shift;break}}return ro};Cn(()=>Ln(Es,Di.iconBox,a.bL.horizontal),()=>{const tn=Di.verticalTextBox;return tn&&Aa(tn),M.allowVerticalPlacement&&!(Ni&&Ni.box&&Ni.box.length)&&sr>0&&tn?Ln(tn,Di.verticalIconBox,a.bL.vertical):{box:null,offscreen:null,occluded:null}}),Ni&&(ji=Ni.box,Hr=Ni.offscreen,br=Ni.occluded);const Jn=Qr(!(!Ni||!Ni.box));if(!ji&&this.prevPlacement){const tn=this.prevPlacement.variableOffsets[ur];tn&&(this.variableOffsets[ur]=tn,this.markUsedJustification(M,tn.anchor,Ai,Jn))}}else{const jr=(Ln,Jn)=>{const tn=M.getSymbolInstanceTextSize(Ce,Ai,this.transform.zoom,Bi),Ca=this.collisionIndex.placeCollisionBox(M,tn,Ln,he,ce,ai,new a.P(0,0),ze,re,U,Ee.predicate);return Ca&&Ca.box&&Ca.box.length&&(this.markUsedOrientation(M,Jn,Ai),this.placedOrientations[ur]=Jn),Ca};Cn(()=>jr(Es,a.bL.horizontal),()=>{const Ln=Di.verticalTextBox;return M.allowVerticalPlacement&&sr>0&&Ln?(Aa(Ln),jr(Ln,a.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Qr(!!(Ni&&Ni.box&&Ni.box.length))}}if(sn=Ni,ji=sn&&sn.box&&sn.box.length>0,Hr=sn&&sn.offscreen,br=sn&&sn.occluded,Ai.useRuntimeCollisionCircles){const Qr=Ai.centerJustifiedTextSymbolIndex>=0?Ai.centerJustifiedTextSymbolIndex:Ai.verticalPlacedTextSymbolIndex,Cn=M.text.placedSymbolArray.get(Qr),jr=a.bM(M.textSizeData,Ce,Cn),Ln=D.get("text-padding");Er=this.collisionIndex.placeCollisionCircles(M,ze,Cn,Qr,M.lineVertexArray,M.glyphOffsetArray,jr,U,$,ie,g,Qe,Ee.predicate,Ai.collisionCircleDiameter*jr/a.bY,Ln,this.retainedQueryData[M.bucketInstanceId].tileID),ji=ze||Er.circles.length>0&&!Er.collisionDetected,Hr=Hr&&Er.offscreen,br=Er.occluded}if(Di.iconFeatureIndex&&(ns=Di.iconFeatureIndex),Di.iconBox){const Qr=Cn=>{Aa(Cn);const jr=Ai.hasIconTextFit&&Oi?Gc(Oi.x,Oi.y,We,Qe,this.transform.angle):new a.P(0,0),Ln=M.getSymbolInstanceIconSize(Ae,this.transform.zoom,Ai.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Ln,Cn,he,ce,Xt,jr,Pe,re,U,Ee.predicate)};kr&&kr.box&&kr.box.length&&Di.verticalIconBox?(Lr=Qr(Di.verticalIconBox),or=Lr.box.length>0):(Lr=Qr(Di.iconBox),or=Lr.box.length>0),Hr=Hr&&Lr.offscreen,pr=Lr.occluded}const Ms=je||Ai.numHorizontalGlyphVertices===0&&sr===0,Va=Ue||Ai.numIconVertices===0;if(Ms||Va?Va?Ms||(or=or&&ji):ji=or&&ji:or=ji=or&&ji,ji&&sn&&sn.box&&this.collisionIndex.insertCollisionBox(sn.box,D.get("text-ignore-placement"),M.bucketInstanceId,kr&&kr.box&&ws?ws:Vs,Ee.ID),or&&Lr&&this.collisionIndex.insertCollisionBox(Lr.box,D.get("icon-ignore-placement"),M.bucketInstanceId,ns,Ee.ID),Er&&(ji&&this.collisionIndex.insertCollisionCircles(Er.circles,D.get("text-ignore-placement"),M.bucketInstanceId,Vs,Ee.ID),g)){const Qr=M.bucketInstanceId;let Cn=this.collisionCircleArrays[Qr];Cn===void 0&&(Cn=this.collisionCircleArrays[Qr]=new Fu);for(let jr=0;jr<Er.circles.length;jr+=4)Cn.circles.push(Er.circles[jr+0]),Cn.circles.push(Er.circles[jr+1]),Cn.circles.push(Er.circles[jr+2]),Cn.circles.push(Er.collisionDetected?1:0)}const pa=M.projection.name!=="globe";oi=oi&&(pa||!br),_i=_i&&(pa||!pr),this.placements[ur]=new ca(ji||oi,or||_i,Hr||M.justReloaded),c.add(ur)},Yi=this.retainedQueryData[M.bucketInstanceId].tileID;if(M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,Yi),M.elevationType==="road"&&M.updateRoadElevation(Yi.canonical),M.updateZOffset(),M.sortFeaturesByY){const Ai=M.getSortedSymbolIndexes(this.transform.angle);for(let Bi=Ai.length-1;Bi>=0;--Bi){const Di=Ai[Bi];Fi(M.symbolInstances.get(Di),Di,M.collisionArrays[Di])}M.hasAnyZOffset&&a.w(`${M.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(M.hasAnyZOffset){const Ai=M.getSortedIndexesByZOffset();for(let Bi=0;Bi<Ai.length;++Bi){const Di=Ai[Bi];Fi(M.symbolInstances.get(Di),Di,M.collisionArrays[Di])}}else for(let Ai=i.symbolInstanceStart;Ai<i.symbolInstanceEnd;Ai++)Fi(M.symbolInstances.get(Ai),Ai,M.collisionArrays[Ai]);if(g&&M.bucketInstanceId in this.collisionCircleArrays){const Ai=this.collisionCircleArrays[M.bucketInstanceId];a.bl(Ai.invProjMatrix,U),Ai.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(i,c,g,E){const{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:z,crossTileID:U}=g,$=a.c3(c),ie=E===a.bL.vertical?z:$==="left"?A:$==="center"?M:$==="right"?D:-1;A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=ie>=0&&A!==ie?0:U),M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=ie>=0&&M!==ie?0:U),D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=ie>=0&&D!==ie?0:U),z>=0&&(i.text.placedSymbolArray.get(z).crossTileID=ie>=0&&z!==ie?0:U)}markUsedOrientation(i,c,g){const E=c===a.bL.horizontal||c===a.bL.horizontalOnly?c:0,A=c===a.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:U}=g,$=i.text.placedSymbolArray;M>=0&&($.get(M).placedOrientation=E),D>=0&&($.get(D).placedOrientation=E),z>=0&&($.get(z).placedOrientation=E),U>=0&&($.get(U).placedOrientation=A)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const E=c?c.symbolFadeChange(i):1,A=c?c.opacities:{},M=c?c.variableOffsets:{},D=c?c.placedOrientations:{};for(const z in this.placements){const U=this.placements[z],$=A[z];$?(this.opacities[z]=new dr($,E,U.text,U.icon,null,U.clipped),g=g||U.text!==$.text.placed||U.icon!==$.icon.placed):(this.opacities[z]=new dr(null,E,U.text,U.icon,U.skipFade,U.clipped),g=g||U.text||U.icon)}for(const z in A){const U=A[z];if(!this.opacities[z]){const $=new dr(U,E,!1,!1);$.isHidden()||(this.opacities[z]=$,g=g||U.text.placed||U.icon.placed)}}for(const z in M)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=M[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);g?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c,g,E){E&&(this.lastReplacementSourceUpdateTime=E.updateTime);const A=new Set;for(const M of c){const D=M.getBucket(i);D&&M.latestFeatureIndex&&i.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,A,M,M.collisionBoxArray,g,E,M.tileID,i.scope),D.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(D,M.tileID),D.elevationType==="road"&&D.updateRoadElevation(M.tileID.canonical),D.updateZOffset())}}updateBucketOpacities(i,c,g,E,A,M,D,z){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const U=i.layers[0].layout,$=i.layers[0].paint,ie=!!i.layers[0].dynamicFilter(),K=new dr(null,0,!1,!1,!0),re=U.get("text-allow-overlap"),he=U.get("icon-allow-overlap"),ce=U.get("text-variable-anchor"),de=U.get("text-rotation-alignment")==="map",ge=U.get("text-pitch-alignment")==="map",Ce=$.get("symbol-z-offset"),Ae=U.get("symbol-elevation-reference")==="sea",Ee=!Ce.isConstant(),Ge=new dr(null,0,re&&(he||!i.hasIconData()||U.get("icon-optional")),he&&(re||!i.hasTextData()||U.get("text-optional")),!0);!i.collisionArrays&&E&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(E);const je=(ze,Pe,We)=>{for(let Xe=0;Xe<Pe/4;Xe++)ze.opacityVertexArray.emplaceBack(We)};let Ue=0;M&&i.updateReplacement(D,M);for(let ze=0;ze<i.symbolInstances.length;ze++){const Pe=i.symbolInstances.get(ze),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:Xe,crossTileID:Qe,numIconVertices:rt,tileAnchorX:tt,tileAnchorY:pt}=Pe;let wt=null;const nt=this.retainedQueryData[i.bucketInstanceId];Ee&&Pe&&nt&&(wt=g.latestFeatureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:nt.bucketIndex,sourceLayerIndex:nt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ze=Ce.evaluate(wt,{}),_t=c.has(Qe);let ot=this.opacities[Qe];_t?ot=K:ot||(ot=Ge,this.opacities[Qe]=ot),c.add(Qe);const bt=We>0||Xe>0,Lt=rt>0,Wt=this.placedOrientations[Qe],jt=Wt===a.bL.vertical,zt=Wt===a.bL.horizontal||Wt===a.bL.horizontalOnly;!bt&&!Lt||ot.isHidden()||Ue++;let hi=!1;if((bt||Lt)&&M)for(const ai of i.activeReplacements){if(a.bZ(ai,A,a.b_.Symbol,z)||ai.min.x>tt||tt>ai.max.x||ai.min.y>pt||pt>ai.max.y)continue;const Xt=a.b$(tt,pt,D.canonical,ai.footprintTileId.canonical);if(hi=a.c0(Xt,ai.footprint),hi)break}if(bt){const ai=hi?vs:Bs(ot.text);je(i.text,We,jt?vs:ai),je(i.text,Xe,zt?vs:ai);const Xt=ot.text.isHidden(),{leftJustifiedTextSymbolIndex:oi,centerJustifiedTextSymbolIndex:_i,rightJustifiedTextSymbolIndex:Ti,verticalPlacedTextSymbolIndex:Fi}=Pe,Yi=i.text.placedSymbolArray,Ai=Xt||jt?1:0;oi>=0&&(Yi.get(oi).hidden=Ai),_i>=0&&(Yi.get(_i).hidden=Ai),Ti>=0&&(Yi.get(Ti).hidden=Ai),Fi>=0&&(Yi.get(Fi).hidden=Xt||zt?1:0);const Bi=this.variableOffsets[Qe];Bi&&this.markUsedJustification(i,Bi.anchor,Pe,Wt);const Di=this.placedOrientations[Qe];Di&&(this.markUsedJustification(i,"left",Pe,Di),this.markUsedOrientation(i,Di,Pe))}if(Lt){const ai=hi?vs:Bs(ot.icon),{placedIconSymbolIndex:Xt,verticalPlacedIconSymbolIndex:oi}=Pe,_i=i.icon.placedSymbolArray,Ti=ot.icon.isHidden()?1:0;Xt>=0&&(je(i.icon,rt,jt?vs:ai),_i.get(Xt).hidden=Ti),oi>=0&&(je(i.icon,Pe.numVerticalIconVertices,zt?vs:ai),_i.get(oi).hidden=Ti)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const ai=i.collisionArrays[ze];if(ai){let Xt=new a.P(0,0),oi=!0;if(ai.textBox||ai.verticalTextBox){if(ce){const Ti=this.variableOffsets[Qe];Ti?(Xt=Bu(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textScale),de&&Xt._rotate(ge?this.transform.angle:-this.transform.angle)):oi=!1}ie&&(oi=!ot.clipped),ai.textBox&&Pn(i.textCollisionBox.collisionVertexArray,ot.text.placed,!oi||jt,Ze,Ae,Xt.x,Xt.y),ai.verticalTextBox&&Pn(i.textCollisionBox.collisionVertexArray,ot.text.placed,!oi||zt,Ze,Ae,Xt.x,Xt.y)}const _i=oi&&!!(!zt&&ai.verticalIconBox);ai.iconBox&&Pn(i.iconCollisionBox.collisionVertexArray,ot.icon.placed,_i,Ze,Ae,Pe.hasIconTextFit?Xt.x:0,Pe.hasIconTextFit?Xt.y:0),ai.verticalIconBox&&Pn(i.iconCollisionBox.collisionVertexArray,ot.icon.placed,!_i,Ze,Ae,Pe.hasIconTextFit?Xt.x:0,Pe.hasIconTextFit?Xt.y:0)}}}if(i.fullyClipped=Ue===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ze.invProjMatrix,i.placementViewportMatrix=ze.viewportMatrix,i.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>i}isStale(){return this.stale}setStale(){this.stale=!0}}function Pn(m,i,c,g,E,A,M){m.emplaceBack(i?1:0,c?1:0,A||0,M||0,g,E?1:0),m.emplaceBack(i?1:0,c?1:0,A||0,M||0,g,E?1:0),m.emplaceBack(i?1:0,c?1:0,A||0,M||0,g,E?1:0),m.emplaceBack(i?1:0,c?1:0,A||0,M||0,g,E?1:0)}const hp=Math.pow(2,25),Il=Math.pow(2,24),dp=Math.pow(2,17),ju=Math.pow(2,16),Nh=Math.pow(2,9),Zd=Math.pow(2,8),Vh=Math.pow(2,1);function Bs(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const i=m.placed?1:0,c=Math.floor(127*m.opacity);return c*hp+i*Il+c*dp+i*ju+c*Nh+i*Zd+c*Vh+i}const vs=0;class xa{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,c,g,E,A,M){const D=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(D,E,i[this._currentTileIndex],this._sortAcrossTiles,M),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((z,U)=>z.sortKey-U.sortKey));this._currentPartIndex<D.length;){const z=D[this._currentPartIndex];if(c.placeLayerBucketPart(z,this._seenCrossTileIDs,g,z.symbolInstanceStart===0,M),this._currentPartIndex++,A())return!0}return!1}}class fp{startNewPlacement(i,c,g,E,A,M,D,z){return this.placement=new Ys(i,E,A,M,D,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=g,this._fadeDuration=E,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(i,c,g,E,A){const M=a.o.now(),D=()=>{const z=a.o.now()-M;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&z>2};for(;this._currentPlacementIndex>=0;){const z=c[i[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&z.visibility!=="none"&&(!z.minzoom||z.minzoom<=U)&&(!z.maxzoom||z.maxzoom>U)){const $=z,ie=$.layout.get("symbol-z-elevate"),K=$.layout.get("symbol-sort-key").constantOr(1)!==void 0,re=$.layout.get("symbol-z-order"),he=re==="viewport-y"||re==="auto"&&!(re!=="viewport-y"&&K),ce=$.layout.get("text-allow-overlap")||$.layout.get("icon-allow-overlap")||$.layout.get("text-ignore-placement")||$.layout.get("icon-ignore-placement"),de=he&&ce,ge=this._inProgressLayer=this._inProgressLayer||new xa($),Ce=a.B(z.source,z.scope);if(ge.continuePlacement(ie||de?E[Ce]:g[Ce],this.placement,this._showCollisionBoxes,z,D,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const lc=512/a.al/2;class Qn{constructor(i,c,g){this.tileID=i,this.bucketInstanceId=g,this.index=new a.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=i.canonical.x*a.al,A=i.canonical.y*a.al;for(let M=0;M<c.length;M++){const{key:D,crossTileID:z,tileAnchorX:U,tileAnchorY:$}=c.get(M),ie=Math.floor((E+U)*lc),K=Math.floor((A+$)*lc);this.index.add(ie,K),this.keys.push(D),this.crossTileIDs.push(z)}this.index.finish()}findMatches(i,c,g){const E=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),A=lc/Math.pow(2,c.canonical.z-this.tileID.canonical.z),M=c.canonical.x*a.al,D=c.canonical.y*a.al;for(let z=0;z<i.length;z++){const U=i.get(z);if(U.crossTileID)continue;const{key:$,tileAnchorX:ie,tileAnchorY:K}=U,re=Math.floor((M+ie)*A),he=Math.floor((D+K)*A),ce=this.index.range(re-E,he-E,re+E,he+E).sort((de,ge)=>de-ge);for(const de of ce){const ge=this.crossTileIDs[de];if(this.keys[de]===$&&!g.has(ge)){g.add(ge),U.crossTileID=ge;break}}}}}class Io{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const g in this.indexes){const E=this.indexes[g],A={};for(const M in E){const D=E[M];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+c),A[D.tileID.key]=D}this.indexes[g]=A}this.lng=i}addBucket(i,c,g){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let A=0;A<c.symbolInstances.length;A++)c.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const E=this.usedCrossTileIDs[i.overscaledZ];for(const A in this.indexes){const M=this.indexes[A];if(Number(A)>i.overscaledZ)for(const D in M){const z=M[D];z.tileID.isChildOf(i)&&z.findMatches(c.symbolInstances,i,E)}else{const D=M[i.scaledTo(Number(A)).key];D&&D.findMatches(c.symbolInstances,i,E)}}for(let A=0;A<c.symbolInstances.length;A++){const M=c.symbolInstances.get(A);M.crossTileID||(M.crossTileID=g.generate(),E.add(M.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Qn(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const g of c.crossTileIDs)this.usedCrossTileIDs[i].delete(g)}removeStaleBuckets(i){let c=!1;for(const g in this.indexes){const E=this.indexes[g];for(const A in E)i[E[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,E[A]),delete E[A],c=!0)}return c}}class In{constructor(){this.layerIndexes={},this.crossTileIDs=new Io,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,g,E){let A=this.layerIndexes[i.fqid];A===void 0&&(A=this.layerIndexes[i.fqid]=new Xa);let M=!1;const D={};E.name!=="globe"&&A.handleWrapJump(g);for(const z of c){const U=z.getBucket(i);U&&i.fqid===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(z.tileID,U,this.crossTileIDs)&&(M=!0),D[U.bucketInstanceId]=!0)}return A.removeStaleBuckets(D)&&(M=!0),M}pruneUnusedLayers(i){const c={};i.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}const cc=771;class Ii{constructor(i,c,g,E){this.blendFunction=i,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=E}}Ii.Replace=[1,0,1,0],Ii.disabled=new Ii(Ii.Replace,a.ao.transparent,[!1,!1,!1,!1]),Ii.unblended=new Ii(Ii.Replace,a.ao.transparent,[!0,!0,!0,!0]),Ii.alphaBlended=new Ii([1,cc,1,cc],a.ao.transparent,[!0,!0,!0,!0]),Ii.alphaBlendedNonPremultiplied=new Ii([770,cc,770,cc],a.ao.transparent,[!0,!0,!0,!0]),Ii.multiply=new Ii([774,0,774,0],a.ao.transparent,[!0,!0,!0,!0]),Ii.additive=new Ii([1,1,1,1],a.ao.transparent,[!0,!0,!0,!0]);class fi{constructor(i,c,g){this.func=i,this.mask=c,this.range=g}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const $c=7680;class Mi{constructor(i,c,g,E,A,M){this.test=i,this.ref=c,this.mask=g,this.fail=E,this.depthFail=A,this.pass=M}}Mi.disabled=new Mi({func:519,mask:0},0,0,$c,$c,$c);const Nu=1029,Vu=2305;class Si{constructor(i,c,g){this.enable=i,this.mode=c,this.frontFace=g}}function Xd(m,i){const c=a.ca(m,3);a.cc(m,i),a.cg(m,3,c)}function pp(m,i){const c=a.c7([]);return a.c8(c,c,-i),a.c9(c,c,-m),c}function sl(m,i){const c=[m[0],m[1],0],g=[i[0],i[1],0];if(a.ag(c)>=1e-15){const M=a.aw([],c);a.c5(g,M,a.bJ(g,M)),i[0]=g[0],i[1]=g[1]}const E=a.bI([],i,m);if(a.c6(E)<1e-15)return null;const A=Math.atan2(-E[1],E[0]);return pp(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),A)}Si.disabled=new Si(!1,Nu,Vu),Si.backCCW=new Si(!0,Nu,Vu),Si.backCW=new Si(!0,Nu,2304),Si.frontCW=new Si(!0,1028,2304),Si.frontCCW=new Si(!0,1028,Vu);class Pm{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){if(i){const c=i instanceof a.ae?i:new a.ae(i[0],i[1],i[2]);this._renderWorldCopies&&(c.x=a.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(i,c,g){if(this.orientation=null,!this.position)return;const E=this.position,A=g||(this._elevation?this._elevation.getAtPointOrZero(a.ae.fromLngLat(i)):0),M=a.ae.fromLngLat(i,A),D=[M.x-E.x,M.y-E.y,M.z-E.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=sl(D,c)}setPitchBearing(i,c){this.orientation=pp(a.an(i),a.an(-c))}}class Uu{constructor(i,c){this._transform=a.bA([]),this.orientation=c,this.position=i}get mercatorPosition(){const i=this.position;return new a.ae(i[0],i[1],i[2])}get position(){const i=a.ca(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var c;i&&a.cg(this._transform,3,[(c=i)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||a.c7([]),i&&Xd(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=pp(i,c),Xd(this._transform,this._orientation)}forward(){const i=a.ca(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=a.ca(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=a.ca(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const g=new Float64Array(16);return a.bl(g,this.getWorldToCamera(i,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,c,g){const E=this.position;a.c5(E,E,-i);const A=new Float64Array(16);return a.bq(A,[g,g,g]),a.br(A,A,E),A[10]*=c,A}getWorldToCamera(i,c){const g=new Float64Array(16),E=new Float64Array(4),A=this.position;return a.cb(E,this._orientation),a.c5(A,A,-i),a.cc(g,E),a.br(g,g,A),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(i,c,g,E){const A=new Float64Array(16);return a.cd(A,i,c,g,E),A}getCameraToClipOrthographic(i,c,g,E,A,M){const D=new Float64Array(16);return a.ce(D,i,c,g,E,A,M),D}getDistanceToElevation(i,c=!1){const g=i===0?0:a.cf(i,c?a.a$(this.position[1]):this.position[1]),E=this.forward();return(g-this.position[2])/E[2]}clone(){return new Uu([...this.position],[...this.orientation])}}const va=(m,i)=>({u_matrix:m,u_ground_shadow_factor:i});class ba{constructor(i=0,c=0,g=0,E=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=g,this.right=E}interpolate(i,c,g){return c.top!=null&&i.top!=null&&(this.top=a.ak(i.top,c.top,g)),c.bottom!=null&&i.bottom!=null&&(this.bottom=a.ak(i.bottom,c.bottom,g)),c.left!=null&&i.left!=null&&(this.left=a.ak(i.left,c.left,g)),c.right!=null&&i.right!=null&&(this.right=a.ak(i.right,c.right,g)),this}getCenter(i,c){const g=a.aA((this.left+i-this.right)/2,0,i),E=a.aA((this.top+c-this.bottom)/2,0,c);return new a.P(g,E)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ba(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const La=15;class Uh{constructor(i,c,g,E,A,M,D){this.tileSize=512,this._renderWorldCopies=A===void 0||A,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=g??0,this._maxPitch=E??60,this.setProjection(M),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new a.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ba,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Uu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const i=new Uh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i._allowWorldUnderZoom=this._allowWorldUnderZoom,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<La}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,c=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(i||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return a.aH(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=a.cm(this.projectionOptions);const g=this.getProjection(),E=!a.by(c,g);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cm({name:"mercator"});const c=i!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bT(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=a.cn(),a.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=a.aA(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=a.an(i),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const i=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let E=0,A=0;for(let M=0;M<c.length;M++){const D=new a.P(c[M][0]*this.width,g+c[M][1]*(this.height-g)),z=i.pointCoordinate(D);if(!z)continue;const U=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);E+=z[3]*U,A+=U}return A===0?NaN:E/A}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,E=this._mercatorZfromZoom(i),A=this._mercatorZfromZoom(this._maxZoom),M=Math.max(E-g,A);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}equals(i){const c=this.elevation,g=i.elevation,E=c!=null!=(g!=null)||c&&g&&c.exaggeration()!==g.exaggeration();return this.width===i.width&&this.height===i.height&&this.center.lng===i.center.lng&&this.center.lat===i.center.lat&&this.zoom===i.zoom&&this.bearing===i.bearing&&this.pitch===i.pitch&&this.fov===i.fov&&this.projection.name===i.projection.name&&this._edgeInsets.equals(i.padding)&&!E}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let g;g=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const E=a.ag(a.av([],this._camera.position,g));return a.aA(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!a.cp(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const g=[i.position.x,i.position.y,i.position.z];a.cq(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new Pm;return c.position=new a.ae(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!a.cr(i))return!1;a.cs(i,i);const c=a.ct([],[0,0,-1],i),g=a.ct([],[0,-1,0],i);if(g[2]<0)return!1;const E=sl(c,g);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;i[2]=a.aA(i[2],E/g,E/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,g){this._unmodified=!1,this._edgeInsets.interpolate(i,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new a.cu(0,i)];if(this.renderWorldCopies){const g=this.pointCoordinate(new a.P(0,0)),E=this.pointCoordinate(new a.P(this.width,0)),A=this.pointCoordinate(new a.P(this.width,this.height)),M=this.pointCoordinate(new a.P(0,this.height)),D=Math.floor(Math.min(g.x,E.x,A.x,M.x)),z=Math.floor(Math.max(g.x,E.x,A.x,M.x)),U=1;for(let $=D-U;$<=z+U;$++)$!==0&&c.push(new a.cu($,i))}return c}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,c,g,E){let A=[];const M=g!=null,D=!M;if(D&&this.zoom<c||M&&g[0]===0&&g[1]===0)return A;const z=new Set,U=(ie,K,re,he,ce)=>{const de=a.cY(K,ie,re,he,ce);z.has(de)||(A.push(new a.aQ(ie,K,re,he,ce)),z.add(de))};for(let ie=0;ie<i.length;ie++){const K=i[ie];if(D&&K.canonical.z!==c||M&&E!==void 0&&E>K.canonical.z)continue;const re=K.canonical,he=K.overscaledZ,ce=K.wrap,de=1<<re.z,ge=re.x+1<de,Ce=re.x>0,Ae=re.y+1<de,Ee=re.y>0,Ge=K.wrap-(Ce?0:1),je=K.wrap+(ge?0:1),Ue=Ce?re.x-1:de-1,ze=ge?re.x+1:0;if(M)g[0]<0?(U(he,je,re.z,ze,re.y),g[1]<0&&Ae&&(U(he,ce,re.z,re.x,re.y+1),U(he,je,re.z,ze,re.y+1)),g[1]>0&&Ee&&(U(he,ce,re.z,re.x,re.y-1),U(he,je,re.z,ze,re.y-1))):g[0]>0?(U(he,Ge,re.z,Ue,re.y),g[1]<0&&Ae&&(U(he,ce,re.z,re.x,re.y+1),U(he,Ge,re.z,Ue,re.y+1)),g[1]>0&&Ee&&(U(he,ce,re.z,re.x,re.y-1),U(he,Ge,re.z,Ue,re.y-1))):g[1]<0&&Ae?U(he,ce,re.z,re.x,re.y+1):Ee&&U(he,ce,re.z,re.x,re.y-1);else{const Pe=K.visibleQuadrants;1&Pe&&(U(he,Ge,re.z,Ue,re.y),Ee&&(U(he,ce,re.z,re.x,re.y-1),U(he,Ge,re.z,Ue,re.y-1))),2&Pe&&(U(he,je,re.z,ze,re.y),Ee&&(U(he,ce,re.z,re.x,re.y-1),U(he,je,re.z,ze,re.y-1))),4&Pe&&(U(he,Ge,re.z,Ue,re.y),Ae&&(U(he,ce,re.z,re.x,re.y+1),U(he,Ge,re.z,Ue,re.y+1))),8&Pe&&(U(he,je,re.z,ze,re.y),Ae&&(U(he,ce,re.z,re.x,re.y+1),U(he,je,re.z,ze,re.y+1)))}}const $=[];for(const ie of A)A.some(K=>ie.isChildOf(K))||$.push(ie);if(A=$.filter(ie=>!i.some(K=>!!(ie.overscaledZ<c&&K.isChildOf(ie))||ie.equals(K)||ie.isChildOf(K))),D){const ie=1<<c,K=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=[ie*K.x,ie*K.y],he=4,ce=he*he;A=A.filter(de=>{const ge=de.canonical.x+.5-re[0],Ce=de.canonical.y+.5-re[1];return ge*ge+Ce*Ce<ce})}return A}extendTileCoverToNearPlane(i,c,g){const E=[],A=new Set;for(const Ce of i)A.add(Ce.key);const M=(Ce,Ae,Ee,Ge,je)=>{const Ue=a.cY(Ae,Ce,Ee,Ge,je);A.has(Ue)||(E.push(new a.aQ(Ce,Ae,Ee,Ge,je)),A.add(Ue))},D=i.reduce((Ce,Ae)=>Math.max(Ce,Ae.overscaledZ),g),z=1<<g,U=[new a.P(0,0),new a.P(a.al,0),new a.P(a.al,a.al),new a.P(0,a.al)],$=new a.P(0,0),ie=new a.P(0,0),K=(Ce,Ae)=>{const Ee=Math.floor(Ce[0]),Ge=Math.floor(Ce[1]),je=(Ce[0]-Ee)*a.al,Ue=(Ce[1]-Ge)*a.al,ze=Math.floor(Ae[0]),Pe=Math.floor(Ae[1]),We=(Ae[0]-ze)*a.al,Xe=(Ae[1]-Pe)*a.al;for(let Qe=-1;Qe<=1;Qe++){const rt=Ee+Qe;if(!(rt<0||rt>=z)){$.x=je-Qe*a.al,ie.x=We-(rt-ze)*a.al;for(let tt=-1;tt<=1;tt++){const pt=Ge+tt;$.y=Ue-tt*a.al,ie.y=Xe-(pt-Pe)*a.al,a.cZ($,ie,U)&&M(D,0,g,rt,pt)}}}},re=c.points,he=re[a.cv],ce=re[a.cw],de=this._projectToGround(he,re[a.cx]),ge=this._projectToGround(ce,re[a.cy]);return K(he,de),K(ce,ge),E}_projectToGround(i,c){return a.cz(a.cA(),i,c,i[2]/(i[2]-c[2]))}coveringTiles(i){let c=this.coveringZoomLevel(i);const g=c,E=this.elevation&&this.elevation.exaggeration(),A=E&&!i.isTerrainDEM,M=this.projection.name==="mercator";if(i.minzoom!==void 0&&c<i.minzoom)return[];i.maxzoom!==void 0&&c>i.maxzoom&&(c=i.maxzoom);const D=this.locationCoordinate(this.center),z=this.center.lat,U=1<<c,$=[U*D.x,U*D.y,0],ie=this.projection.name==="globe",K=!ie,re=a.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,K),he=ie?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ce=U*a.cf(1,this.center.lat),de=this._camera.position[2]/a.cf(1,this.center.lat),ge=[U*he.x,U*he.y,de*(K?1:ce)],Ce=ie||E,Ae=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Ee=this.isLODDisabled(!0)?c:0;let Ge;if(this._elevation&&i.isTerrainDEM)Ge=1e4*this._elevation.exaggeration();else if(this._elevation){const Ze=this._elevation.getMinMaxForVisibleTiles();Ge=Ze?Ze.max:this._centerAltitude}else Ge=this._centerAltitude;const je=i.isTerrainDEM?-Ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ue=this.projection.isReprojectedInTileSpace?a.cC(this):1,ze=Ze=>{const ot=new a.ae(Ze.x+25e-6,Ze.y,Ze.z),bt=new a.ae(Ze.x,Ze.y+25e-6,Ze.z),Lt=Ze.toLngLat(),Wt=ot.toLngLat(),jt=bt.toLngLat(),zt=this.locationCoordinate(Lt),hi=this.locationCoordinate(Wt),ai=this.locationCoordinate(jt),Xt=Math.hypot(hi.x-zt.x,hi.y-zt.y),oi=Math.hypot(ai.x-zt.x,ai.y-zt.y);return Math.sqrt(Xt*oi)*Ue/25e-6},Pe=Ze=>{const _t=Ge,ot=je;return{aabb:a.cF(this,U,0,0,0,Ze,ot,_t,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:_t,wrap:Ze,fullyVisible:!1}},We=[];let Xe=[];const Qe=c,rt=i.reparseOverscaled?g:c,tt=(de-this._centerAltitude)*ce,pt=Ze=>{if(!this._elevation||!Ze.tileID||!M)return;const _t=this._elevation.getMinMaxForTile(Ze.tileID),ot=Ze.aabb;_t?(ot.min[2]=_t.min,ot.max[2]=_t.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(Ze.shouldSplit=nt(Ze),Ze.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},wt=(Ze,_t)=>{if(.707*_t<Ze)return 1;const ot=_t/Ze;return ot/(1.4144271570014144+(Math.pow(1.1,ot-1.4144271570014144+1)-1)/(1.1-1)-1)},nt=Ze=>{if(Ze.zoom<Ee)return!0;if(Ze.zoom===Qe)return!1;if(Ze.shouldSplit!=null)return Ze.shouldSplit;const _t=Ze.aabb.distanceX(ge),ot=Ze.aabb.distanceY(ge);let bt=tt,Lt=1;if(ie){bt=Ze.aabb.distanceZ(ge);const oi=Math.pow(2,Ze.zoom),_i=a.a$((Ze.y+1)/oi),Ti=a.a$(Ze.y/oi),Fi=Math.min(Math.max(z,_i),Ti),Yi=a.d1(Fi)/a.d1(z);if(Lt=Fi===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yi/this._mercatorScaleRatio),this.zoom<=a.c_&&Ze.zoom===Qe-1&&Yi>=.9)return!0}else if(A&&(bt=Ze.aabb.distanceZ(ge)*ce),this.projection.isReprojectedInTileSpace&&g<=5){const oi=Math.pow(2,Ze.zoom),_i=ze(new a.ae((Ze.x+.5)/oi,(Ze.y+.5)/oi));Lt=_i>.85?1:_i}if(!M&&!ie){const oi=Math.sqrt(_t*_t+ot*ot+bt*bt);let _i=(1<<Qe-Ze.zoom)*Ae*Lt;return _i*=wt(Math.max(bt,tt),oi),oi<_i}let Wt=Number.MAX_VALUE,jt=0;const zt=Ze.aabb.getCorners(),hi=[];for(const oi of zt){a.av(hi,oi,ge),ie||(A?hi[2]*=ce:hi[2]=tt);const _i=a.bJ(hi,this._camera.forward());_i<Wt&&(Wt=_i,jt=Math.abs(hi[2]))}let ai=(1<<Qe-Ze.zoom)*Ae*Lt;if(ai*=wt(Math.max(jt,tt),Wt),Wt<ai)return!0;const Xt=Ze.aabb.closestPoint($);return Xt[0]===$[0]&&Xt[1]===$[1]};if(this.renderWorldCopies)for(let Ze=1;Ze<=3;Ze++)We.push(Pe(-Ze)),We.push(Pe(Ze));for(We.push(Pe(0));We.length>0;){const Ze=We.pop(),_t=Ze.x,ot=Ze.y;let bt=Ze.fullyVisible;const Lt=()=>this.projection.name==="globe"&&(Ze.y===0||Ze.y===(1<<Ze.zoom)-1);if(!bt){let Wt=Ce?Ze.aabb.intersects(re):Ze.aabb.intersectsFlat(re);if(Wt===0&&Lt()){const jt=new a.cD(Ze.zoom,_t,ot);Wt=a.cE(this,U,jt,!0).intersects(re)}if(Wt===0)continue;bt=Wt===2}if(Ze.zoom===Qe||!nt(Ze)){const Wt=Ze.zoom===Qe?rt:Ze.zoom;if(i.minzoom&&i.minzoom>Wt)continue;let jt=0;if(!bt){let Xt=Ce?Ze.aabb.intersectsPrecise(re):Ze.aabb.intersectsPreciseFlat(re);if(Xt===0&&Lt()){const oi=new a.cD(Ze.zoom,_t,ot);Xt=a.cE(this,U,oi,!0).intersectsPrecise(re)}if(Xt===0)continue;if(i.calculateQuadrantVisibility)if(re.containsPoint(Ze.aabb.center))jt=15;else for(let oi=0;oi<4;oi++)Ze.aabb.quadrant(oi).intersects(re)!==0&&(jt|=1<<oi)}const zt=$[0]-(.5+_t+(Ze.wrap<<Ze.zoom))*(1<<c-Ze.zoom),hi=$[1]-.5-ot,ai=Ze.tileID?Ze.tileID:new a.aQ(Wt,Ze.wrap,Ze.zoom,_t,ot);i.calculateQuadrantVisibility&&(ai.visibleQuadrants=jt),Xe.push({tileID:ai,distanceSq:zt*zt+hi*hi});continue}for(let Wt=0;Wt<4;Wt++){const jt=(_t<<1)+Wt%2,zt=(ot<<1)+(Wt>>1),hi={aabb:M?Ze.aabb.quadrant(Wt):a.cF(this,U,Ze.zoom+1,jt,zt,Ze.wrap,Ze.minZ,Ze.maxZ,this.projection),zoom:Ze.zoom+1,x:jt,y:zt,wrap:Ze.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ze.minZ,maxZ:Ze.maxZ};A&&!ie&&(hi.tileID=new a.aQ(Ze.zoom+1===Qe?rt:Ze.zoom+1,Ze.wrap,Ze.zoom+1,jt,zt),pt(hi)),We.push(hi)}}if(this.fogCullDistSq){const Ze=this.fogCullDistSq,_t=this.horizonLineFromTop();Xe=Xe.filter(ot=>{const bt=[0,0,0,1],Lt=[a.al,a.al,0,1],Wt=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());a.aC(bt,bt,Wt),a.aC(Lt,Lt,Wt);const jt=a.cG([],bt,Lt),zt=a.cH([],bt,Lt),hi=a.c$(jt,zt);if(hi===0)return!0;let ai=!1;const Xt=this._elevation;if(Xt&&hi>Ze&&_t!==0){const oi=this.calculateProjMatrix(ot.tileID.toUnwrapped());let _i;i.isTerrainDEM||(_i=Xt.getMinMaxForTile(ot.tileID)),_i||(_i={min:je,max:Ge});const Ti=a.cI(this.rotation),Fi=[Ti[0]*a.al,Ti[1]*a.al,_i.max];a.af(Fi,Fi,oi),ai=(1-Fi[1])*this.height*.5<_t}return hi<Ze||ai})}return Xe.sort((Ze,_t)=>Ze.distanceSq-_t.distanceSq).map(Ze=>Ze.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log2(i)}project(i){const c=a.aA(i.lat,-a.cJ,a.cJ),g=this.projection.project(i.lng,c);return new a.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,c){let g,E;const A=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;g=(c.x-A.x)/D,E=(c.y-A.y)/D}else{const D=this.pointCoordinate(c),z=this.pointCoordinate(A);g=D.x-z.x,E=D.y-z.y}const M=this.locationCoordinate(i);this.setLocation(new a.ae(M.x-g,M.y-E))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i,c){return this.projection.locationPoint(this,i,c)}locationPoint3D(i,c){return this.projection.locationPoint(this,i,c,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i,c){return this.coordinateLocation(this.pointCoordinate3D(i,c))}locationCoordinate(i,c){const g=c?a.cf(c,i.lat):void 0,E=this.projection.project(i.lng,i.lat);return new a.ae(E.x,E.y,g)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const g=c??this._centerAltitude,E=[i.x,i.y,0,1],A=[i.x,i.y,1,1];a.aC(E,E,this.pixelMatrixInverse),a.aC(A,A,this.pixelMatrixInverse);const M=A[3];a.cK(E,E,1/E[3]),a.cK(A,A,1/M);const D=E[2],z=A[2];return{p0:E,p1:A,t:D===z?0:(g-D)/(z-D)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],g=[i.x,i.y,1,1];return a.aC(c,c,this.pixelMatrixInverse),a.aC(g,g,this.pixelMatrixInverse),a.cK(c,c,1/c[3]),a.cK(g,g,1/g[3]),c[2]=a.cf(c[2],this._center.lat)*this.worldSize,g[2]=a.cf(g[2],this._center.lat)*this.worldSize,a.cK(c,c,1/this.worldSize),a.cK(g,g,1/this.worldSize),new a.ax([c[0],c[1],c[2]],a.aw([],a.av([],g,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:g,t:E}=i,A=a.cf(c[2],this._center.lat),M=a.cf(g[2],this._center.lat);return new a.ae(a.ak(c[0],g[0],E)/this.worldSize,a.ak(c[1],g[1],E)/this.worldSize,a.ak(A,M,E))}pointCoordinate(i,c=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,c)}pointCoordinate3D(i,c){if(!this.elevation)return this.pointCoordinate(i,c);let g=this.projection.pointCoordinate3D(this,i.x,i.y);if(g)return new a.ae(g[0],g[1],g[2]);let E=0,A=this.horizonLineFromTop();if(i.y>A)return this.pointCoordinate(i,c);const M=.02*A,D=i.clone();for(let z=0;z<10&&A-E>M;z++){D.y=a.ak(E,A,.66);const U=this.projection.pointCoordinate3D(this,D.x,D.y);U?(A=D.y,g=U):E=D.y}return g?new a.ae(g[0],g[1],g[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=a.cL)return!this.isPointAboveHorizon(i);const c=this.pointCoordinate(i);return c.y>=0&&c.y<=1}_coordinatePoint(i,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,E=[i.x*this.worldSize,i.y*this.worldSize,g+i.toAltitude(),1];return a.aC(E,E,this.pixelMatrix),E[3]>0?new a.P(E[0]/E[3],E[1]/E[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,A=this.pointLocation3D(new a.P(c,i)),M=this.pointLocation3D(new a.P(E,i)),D=this.pointLocation3D(new a.P(E,g)),z=this.pointLocation3D(new a.P(c,g));let U=Math.min(A.lng,M.lng,D.lng,z.lng),$=Math.max(A.lng,M.lng,D.lng,z.lng),ie=Math.min(A.lat,M.lat,D.lat,z.lat),K=Math.max(A.lat,M.lat,D.lat,z.lat);const re=Math.pow(2,-this.zoom)/16*270,he=this.projection.name==="globe"?1:4,ce=(de,ge,Ce,Ae,Ee)=>{const Ge=(de+Ce)/2,je=(ge+Ae)/2,Ue=new a.P(Ge,je),{lng:ze,lat:Pe}=this.pointLocation3D(Ue),We=Math.max(0,U-ze,ie-Pe,ze-$,Pe-K);U=Math.min(U,ze),$=Math.max($,ze),ie=Math.min(ie,Pe),K=Math.max(K,Pe),(Ee<he||We>re)&&(ce(de,ge,Ge,je,Ee+1),ce(Ge,je,Ce,Ae,Ee+1))};if(ce(c,i,E,i,1),ce(E,i,E,g,1),ce(E,g,c,g,1),ce(c,g,c,i,1),this.projection.name==="globe"){const[de,ge]=a.cM(this);de?(K=90,$=180,U=-180):ge&&(ie=-90,$=180,U=-180)}return new a.aI(new a.aT(U,ie),new a.aT($,K))}_getBoundsRectangular(i,c){const{top:g,left:E}=this._edgeInsets,A=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,D=new a.P(E,g),z=new a.P(M,g),U=new a.P(M,A),$=new a.P(E,A);let ie=this.pointCoordinate(D,i),K=this.pointCoordinate(z,i);const re=this.pointCoordinate(U,c),he=this.pointCoordinate($,c),ce=(de,ge)=>(ge.y-de.y)/(ge.x-de.x);return ie.y>1&&K.y>=0?ie=new a.ae((1-he.y)/ce(he,ie)+he.x,1):ie.y<0&&K.y<=1&&(ie=new a.ae(-he.y/ce(he,ie)+he.x,0)),K.y>1&&ie.y>=0?K=new a.ae((1-re.y)/ce(re,K)+re.x,1):K.y<0&&ie.y<=1&&(K=new a.ae(-re.y/ce(re,K)+re.x,0)),new a.aI().extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(he)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=i.visibleDemTiles.reduce((g,E)=>{if(E.dem){const A=E.dem.tree;g.min=Math.min(g.min,A.minimums[0]),g.max=Math.max(g.max,A.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-a.cJ,this.maxLat=a.cJ,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aF(this.minLng)*this.tileSize,this.worldMaxX=a.aF(this.maxLng)*this.tileSize,this.worldMinY=a.aJ(this.maxLat)*this.tileSize,this.worldMaxY=a.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileMatrix(this,c,i)}calculateDistanceTileData(i){const c=i.key,g=this._distanceTileDataCache;if(g[c])return g[c];const E=i.canonical,A=1/this.height,M=this.cameraWorldSize,D=M/this.zoomScale(E.z),z=(E.x+Math.pow(2,E.z)*i.wrap)*D,U=E.y*D,$=this.point;$.x*=M/this.worldSize,$.y*=M/this.worldSize;const ie=this.angle,K=Math.sin(-ie),re=-Math.cos(-ie);return g[c]={bearing:[K,re],center:[($.x-z)*A,($.y-U)*A],scale:D/a.al*A},g[c]}calculateFogTileMatrix(i){const c=i.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return a.aB(E,this.worldToFogMatrix,E),g[c]=new Float32Array(E),g[c]}calculateProjMatrix(i,c=!1,g=!1){const E=i.key;let A;if(A=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,A[E])return A[E];const M=this.calculatePosMatrix(i,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,a.aB(M,D,M),A[E]=new Float32Array(M),A[E]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const E=a.cN(i,this);return g[c]=E,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,c=a.bq([],[i,i,i]);return a.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const c=a.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),E=this._camera.forward(),A=a.cf(1,this._center.lat);g[2]/=A,E[2]/=A,a.aw(E,E);const M=i.raycast(g,E,i.exaggeration());if(M){const D=a.bH([],g,E,M),z=new a.ae(D[0],D[1],a.cf(D[2],a.a$(D[1]))),U=(z.z+a.ag([z.x-g[0],z.y-g[1],z.z-g[2]*A]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const c=this._elevation,g=a.cf(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(g),A=c.getAtPointOrZero(new a.ae(...E)),M=this.pixelsPerMeter/this.worldSize*A,D=this._minimumHeightOverTerrain(),z=E[2]-M;if(z<=D)if(z<0||i){const U=this.locationCoordinate(this._center,this._centerAltitude),$=[E[0],E[1],U.z-E[2]],ie=a.ag($);$[2]-=(D-z)/this._pixelsPerMercatorPixel;const K=a.ag($);if(K===0)return;a.c5($,$,ie/K*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],U.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const K=this.center;return K.lat=a.aA(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(K.lng=a.aA(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const c=this._unmodified,{x:g,y:E}=this.point;let A=0,M=g,D=E;const z=this.width/2,U=this.height/2,$=this.worldMinY*this.scale,ie=this.worldMaxY*this.scale;if(E-U<$&&(D=$+U),E+U>ie&&(D=ie-U),ie-$<this.height&&(A=Math.max(A,this.height/(ie-$)),D=(ie+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,he=this.worldSize/2-(K+re)/2;M=(g+he+this.worldSize)%this.worldSize-he,M-z<K&&(M=K+z),M+z>re&&(M=re-z),re-K<this.width&&(A=Math.max(A,this.width/(re-K)),M=(re+K)/2)}M===g&&D===E||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(M,D))),A&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(A)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,c=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.cf(1,this.center.lat)/a.cf(1,a.d2));const E=a.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const A=this.projection.zAxisUnit==="meters"?g:1,M=this._camera.getWorldToCamera(this.worldSize,A);let D;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-i.x/this.width,z[9]=2*i.y/this.height,this.isOrthographic){let Pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=Pe*this.aspect,Xe=-We,Qe=-Pe;We-=i.x,Xe-=i.x,Pe+=i.y,Qe+=i.y,D=this._camera.getCameraToClipOrthographic(Xe,We,Qe,Pe,this._nearZ,this._farZ),((rt,tt,pt,wt)=>{for(let nt=0;nt<16;nt++)rt[nt]=a.ak(tt[nt],pt[nt],wt)})(D,D,z,a.d0(this.pitch>=La?1:this.pitch/La))}else D=z;const U=a.cP([],z,M);let $=a.cP([],D,M);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),We=a.bA([]);a.br(We,We,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),a.aB(We,We,a.cQ(this)),a.br(We,We,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),a.aB($,$,We),a.aB(U,U,We),this.inverseAdjustmentMatrix=a.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cS([],$,[this.worldSize,this.worldSize,this.worldSize/A,1]),this.projMatrix=$,this.invProjMatrix=a.bl(new Float64Array(16),this.projMatrix),c){const Pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Pe[8]=2*-i.x/this.width,Pe[9]=2*i.y/this.height,this.expandedFarZProjMatrix=a.cP([],Pe,M)}else this.expandedFarZProjMatrix=this.projMatrix;const ie=a.bl([],D);this.frustumCorners=a.cT.fromInvProjectionMatrix(ie,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const K=new Float32Array(16);a.bA(K),a.cS(K,K,[1,-1,1]),a.cU(K,K,this._pitch),a.bB(K,K,this.angle);const re=a.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.bz(re);const he=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;re[8]=2*-i.x/this.width,re[9]=2*(i.y+he)/this.height,this.skyboxMatrix=a.aB(K,re,K);const ce=this.point,de=ce.x,ge=ce.y,Ce=this.width%2/2,Ae=this.height%2/2,Ee=Math.cos(this.angle),Ge=Math.sin(this.angle),je=de-Math.round(de)+Ee*Ce+Ge*Ae,Ue=ge-Math.round(ge)+Ee*Ae+Ge*Ce,ze=new Float64Array($);if(a.br(ze,ze,[je>.5?je-1:je,Ue>.5?Ue-1:Ue,0]),this.alignedProjMatrix=ze,$=a.bC(),a.cS($,$,[this.width/2,-this.height/2,1]),a.br($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=a.bC(),a.cS($,$,[1,-1,1]),a.br($,$,[-1,-1,0]),a.cS($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=a.aB(new Float64Array(16),this.labelPlaneMatrix,U),this._calcFogMatrices(),this._distanceTileDataCache={},$=a.bl(new Float64Array(16),this.pixelMatrix),!$)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=$,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cV(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.af(Pe,Pe,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=$;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,A=[i,i,c];a.c5(A,A,E),a.c5(g,g,-1),a.cW(g,g,A);const M=a.bC();a.br(M,M,g),a.cS(M,M,A),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,E)}_computeCameraPosition(i){const c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),E=this.point,A=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-g[0]*A,E.y/this.worldSize-g[1]*A,i/this.worldSize*this._centerAltitude-g[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],E=i[2];let A=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(A=Math.min((c-g)/E,1)),this._camera.position=a.bH([],this._camera.position,i,A),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:E}=this._camera.getPitchBearing(),A=a.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.an(this._maxPitch)),D=Math.max((i[2]-A)/Math.cos(g),M),z=this._zoomFromMercatorZ(D);a.bH(i,i,c,D),this._pitch=a.aA(g,a.an(this.minPitch),a.an(this.maxPitch)),this.angle=a.bT(E,-Math.PI,Math.PI),this._setZoom(a.aA(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ae(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,i)*this.tileSize))}zoomFromMercatorZAdjusted(i){let c=0,g=a.cL,E=0,A=1/0;for(;g-c>1e-6&&g>c;){const M=c+.5*(g-c),D=this.tileSize*Math.pow(2,M),z=this.getCameraToCenterDistance(this.projection,M,D),U=this.scaleZoom(z/(Math.max(0,i)*this.tileSize)),$=Math.abs(M-U);$<A&&(A=$,E=M),M<U?c=M:g=M}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,c){const g=Math.min(i.x,c.x),E=Math.max(i.x,c.x),A=Math.min(i.y,c.y),M=Math.max(i.y,c.y);if(A<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new a.P(g,A),new a.P(E,M),new a.P(g,M),new a.P(E,A)],z=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const $ of D){const ie=this.pointRayIntersection($);if(ie.t<0)return!0;const K=this.rayIntersectionCoordinate(ie);if(K.x<z||K.y<0||K.x>U||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(i,c){const g=a.ag(a.av([],this._camera.position,i)),E=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const i=(function([c,g,E],A){const M=[c,g,E,1];a.aC(M,M,A);const D=M[3]=Math.max(M[3],1e-6);return M[0]/=D,M[1]/=D,M[2]/=D,M})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,i))}}getCameraToCenterDistance(i,c=this.zoom,g=this.worldSize){const E=a.cO(i,c,this.width,this.height,1024),A=i.pixelSpaceConversion(this.center.lat,g,E);let M=.5/Math.tan(.5*this._fov)*this.height*A;return this.isOrthographic&&(M=a.ak(1,M,a.d0(this.pitch>=La?1:this.pitch/La))),M}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.aB(i,i,this.globeMatrix),i}getFrustum(i){return a.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Ya=(m,i)=>{if(i>0&&m.terrain&&a.w("Cutoff is currently disabled on terrain"),i<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,g=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),E=c.isLODDisabled(!1)?a.ah(60,45,c.pitch):a.ah(30,15,c.pitch),A=c._farZ-c._nearZ,M=i*c.height,D=((1-(z=E))*c.cameraToCenterDistance+z*(c._farZ+M))*g;var z;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(D-c._nearZ)/A,(D-M-c._nearZ)/A]}}},Dl=2048;class Im{constructor(i,c){this.aabb=i,this.lastCascade=c}}class Hc{add(i,c){const g=this.receivers[i.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[i.key]=new Im(c,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,c,g){const E=a.d9.fromPoints(i.points);let A=0;for(const M in this.receivers){const D=this.receivers[M];if(!D||!E.intersectsAabb(D.aabb))continue;D.aabb.min=E.closestPoint(D.aabb.min),D.aabb.max=E.closestPoint(D.aabb.max);const z=D.aabb.getCorners();for(let U=0;U<g.length;U++){let $=!0;for(const ie of z){const K=[ie[0]*c,ie[1]*c,ie[2]];if(a.af(K,K,g[U].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){$=!1;break}}if(D.lastCascade=U,A=Math.max(A,U),$)break}}return A+1}}class Gh{constructor(i){this.painter=i,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Hc,this._depthMode=new fi(i.context.gl.LEQUAL,fi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,c){const g=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!c||!c.properties)return;const E=c.properties.get("shadow-intensity"),A=c.properties.get("shadow-draw-before-layer");if(!c.shadowsEnabled()||E<=0)return;let M=-1,D=0;for(const ge of g.style.order){const Ce=g.style._mergedLayers[ge];Ce.hasShadowPass()&&!Ce.isHidden(i.zoom)&&(M=D),A&&A===ge&&(this._drawShadowAfterLayer=D>0?D-1:0),D+=1}if(this._enabled=M>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=M);const z=g.context,U=Dl,$=Dl;if(this._cascades.length===0||Dl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ge=0;ge<2;++ge){const Ce=g._shadowMapDebug,Ae=z.gl,Ee=z.createFramebuffer(U,$,Ce?1:0,"texture"),Ge=new a.T(z,{width:U,height:$,data:null},Ae.DEPTH_COMPONENT16);if(Ee.depthAttachment.set(Ge.texture),Ce){const je=new a.T(z,{width:U,height:$,data:null},Ae.RGBA8);Ee.colorAttachment0.set(je.texture)}this._cascades.push({framebuffer:Ee,texture:Ge,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cB,scale:0})}}this.shadowDirection=Yd(c);let ie=0;if(i.elevation){const ge=i.elevation,Ce=[1e4,-1e4];ge.visibleDemTiles.filter(Ae=>Ae.dem).forEach(Ae=>{const Ee=Ae.dem.tree;Ce[0]=Math.min(Ce[0],Ee.minimums[0]),Ce[1]=Math.max(Ce[1],Ee.maximums[0])}),Ce[0]!==1e4&&(ie=(Ce[1]-Ce[0])*ge.exaggeration())}const K=1.5*i.cameraToCenterDistance,re=3*K,he=new Float64Array(16);for(let ge=0;ge<this._cascades.length;++ge){const Ce=this._cascades[ge];let Ae=i.height/50,Ee=1;ge===0?Ee=K:(Ae=K,Ee=re);const[Ge,je]=Kd(i,this.shadowDirection,Ae,Ee,Dl,ie);Ce.scale=i.scale,Ce.matrix=Ge,Ce.boundingSphereRadius=je,a.bl(he,Ce.matrix),Ce.frustum=a.cB.fromInvProjectionMatrix(he,1,0,!0),Ce.far=Ee}const ce=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ce].far,this._cascades[ce].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Dl,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const de=g.transform.elevation;for(const ge of this._groundShadowTiles){let Ce={min:0,max:0};if(de){const Ae=de.getMinMaxForTile(ge);Ae&&(Ce=Ae)}this.addShadowReceiver(ge.toUnwrapped(),Ce.min,Ce.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,c){if(!this.enabled)return;const g=this.painter,E=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),E.viewport.set([0,0,Dl,Dl]);for(let A=0;A<this._numCascadesToRender;++A){g.currentShadowCascade=A,E.bindFramebuffer.set(this._cascades[A].framebuffer.framebuffer),E.clear({color:a.ao.white,depth:1});for(const M of i.order){const D=i._mergedLayers[M];if(!D.hasShadowPass()||D.isHidden(g.transform.zoom))continue;const z=i.getLayerSourceCache(D),U=z?c[z.id]:void 0;(D.type==="model"||U&&U.length)&&g.renderLayer(g,z,D,U)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,c=i.style,g=i.context,E=g.gl,A=c.directionalLight,M=c.ambientLight;if(!A||!M)return;const D=[],z=Ya(i,i.longestCutoffRange);z.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&D.push("NORMAL_OFFSET");const U=ua(c,A,M),$=new fi(E.LEQUAL,fi.ReadOnly,i.depthRangeFor3D),ie=new Mi({func:E.EQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.KEEP);for(const K of this._groundShadowTiles){const re=K.toUnwrapped(),he=i.isTileAffectedByFog(K),ce=i.getOrCreateProgram("groundShadow",{defines:D,overrideFog:he});this.setupShadows(re,ce),i.uploadCommonUniforms(g,ce,re,null,z);const de=va(i.transform.calculateProjMatrix(re),U);ce.draw(i,E.TRIANGLES,$,ie,Ii.multiply,Si.disabled,de,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,null,i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ii.unblended:Ii.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(i){const c=this.painter.transform,g=c.calculatePosMatrix(i,c.worldSize);return a.aB(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(i){const c=a.bz(i);return a.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,i),c}setupShadows(i,c,g){if(!this.enabled)return;const E=this.painter.transform,A=this.painter.context,M=A.gl,D=this._uniformValues,z=new Float64Array(16),U=E.calculatePosMatrix(i,E.worldSize);for(let $=0;$<this._cascades.length;$++)a.aB(z,this._cascades[$].matrix,U),D[$===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),A.activeTexture.set(M.TEXTURE0+11+$),this._cascades[$].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const $=a.d7(i.canonical),ie=2/E.tileSize*a.al/Dl,K=ie*this._cascades[0].boundingSphereRadius,re=ie*this._cascades[this._cascades.length-1].boundingSphereRadius,he=(g==="vector-tile"?1:3)*(function(ce){const de=a.aA((ce-22)/-22,0,1);return .125*(1-de)+4*de})(E.zoom);D.u_shadow_normal_offset=[$,K*he,re*he],D.u_shadow_bias=[1e-4,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(A,D)}setupShadowsFromMatrix(i,c,g=!1){if(!this.enabled)return;const E=this.painter.context,A=E.gl,M=this._uniformValues,D=new Float64Array(16);for(let z=0;z<2;z++)a.aB(D,this._cascades[z].matrix,i),M[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),E.activeTexture.set(A.TEXTURE0+11+z),this._cascades[z].texture.bindExtraParam(A.LINEAR,A.LINEAR,A.CLAMP_TO_EDGE,A.CLAMP_TO_EDGE,A.GREATER);this.useNormalOffset=g,g?(M.u_shadow_normal_offset=[1,3,3],M.u_shadow_bias=[6e-5,.0012,.012]):M.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(E,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,c,g,E){if(E[2]>=0)return{};const A=(function(z,U,$){const ie=$/(1<<z.canonical.z);return new a.d9([z.canonical.x*ie+z.wrap*$,z.canonical.y*ie+z.wrap*$,0],[(z.canonical.x+1)*ie+z.wrap*$,(z.canonical.y+1)*ie+z.wrap*$,U])})(i,c,g).getCorners(),M=c/-E[2];E[0]<0?(a.d8(A[0],A[0],[E[0]*M,0,0]),a.d8(A[3],A[3],[E[0]*M,0,0])):E[0]>0&&(a.d8(A[1],A[1],[E[0]*M,0,0]),a.d8(A[2],A[2],[E[0]*M,0,0])),E[1]<0?(a.d8(A[0],A[0],[0,E[1]*M,0]),a.d8(A[1],A[1],[0,E[1]*M,0])):E[1]>0&&(a.d8(A[2],A[2],[0,E[1]*M,0]),a.d8(A[3],A[3],[0,E[1]*M,0]));const D={};return D.vertices=A,D.planes=[kl(A[1],A[0],A[4]),kl(A[2],A[1],A[5]),kl(A[3],A[2],A[6]),kl(A[0],A[3],A[7])],D}addShadowReceiver(i,c,g){this._receivers.add(i,a.d9.fromTileIdAndHeight(i,c,g))}getMaxCascadeForTile(i){const c=this._receivers.get(i);return c&&c.lastCascade?c.lastCascade:0}}function kl(m,i,c){const g=a.av([],c,i),E=a.av([],m,i),A=a.bI([],g,E),M=a.ag(A);return M===0?[0,0,1,0]:(a.c5(A,A,1/M),[A[0],A[1],A[2],-a.bJ(A,i)])}function Yd(m){const i=m.properties.get("direction"),c=a.d4(i.x,i.y,i.z);c[2]=a.aA(c[2],0,75);const g=a.d6([c[0],c[1],c[2]]);return a.d5(g.x,g.y,g.z)}function ua(m,i,c){const g=i.properties.get("color-use-theme")==="none",E=i.properties.get("color"),A=i.properties.get("intensity"),M=i.properties.get("direction"),D=[M.x,M.y,M.z],z=c.properties.get("color-use-theme")==="none",U=c.properties.get("color"),$=c.properties.get("intensity"),ie=Math.max(a.bJ([0,0,1],D),0),K=[0,0,0];a.c5(K,U.toPremultipliedRenderColor(z?null:m.getLut(i.scope)).toArray01Linear().slice(0,3),$);const re=[0,0,0];return a.c5(re,E.toPremultipliedRenderColor(g?null:m.getLut(c.scope)).toArray01Linear().slice(0,3),ie*A),a.db([K[0]>0?K[0]/(K[0]+re[0]):0,K[1]>0?K[1]/(K[1]+re[1]):0,K[2]>0?K[2]/(K[2]+re[2]):0])}function Kd(m,i,c,g,E,A){const M=m.zoom,D=m.scale,z=m.worldSize,U=1/z,$=m.aspect,ie=Math.sqrt(1+$*$)*Math.tan(.5*m.fovX),K=ie*ie,re=g-c,he=g+c;let ce,de;K>re/he?(ce=g,de=g*ie):(ce=.5*he*(1+K),de=.5*Math.sqrt(re*re+2*(g*g+c*c)*K+he*he*K*K));const ge=m.projection.pixelsPerMeter(m.center.lat,z),Ce=m._camera.getCameraToWorldMercator(),Ae=[0,0,-ce*U];a.af(Ae,Ae,Ce);let Ee=de*U;const Ge=function(bt){return bt[0]/=D,bt[1]/=D,bt[2]=a.cf(bt[2],m._center.lat),bt},je=m._edgeInsets;if(!(je.left===0&&je.top===0&&je.right===0&&je.bottom===0||je.left===je.right&&je.top===je.bottom)){const bt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ge:1),Lt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,g);Lt[8]=2*-m.centerOffset.x/m.width,Lt[9]=2*m.centerOffset.y/m.height;const Wt=new Float64Array(16);a.cP(Wt,Lt,bt);const jt=new Float64Array(16);a.bl(jt,Wt);const zt=a.cB.fromInvProjectionMatrix(jt,z,M,!0);for(const hi of zt.points){const ai=Ge(hi);Ee=Math.max(Ee,a.c6(a.da([],Ae,ai)))}}Ee*=E/(E-1);const Ue=Math.acos(i[2]),ze=Math.atan2(-i[0],-i[1]),Pe=new Uu;Pe.position=Ae,Pe.setPitchBearing(Ue,ze);const We=Pe.getWorldToCamera(z,ge),Xe=Ee*z,Qe=Math.min(m._mercatorZfromZoom(17)*z*-2,-2*Xe),rt=Pe.getCameraToClipOrthographic(-Xe,Xe,-Xe,Xe,Qe,(Xe+A*ge)/i[2]),tt=new Float64Array(16);a.aB(tt,rt,We);const pt=a.d5(Math.floor(1e6*Ae[0])/1e6*z,Math.floor(1e6*Ae[1])/1e6*z,0),wt=.5*E,nt=[0,0,0];a.af(nt,pt,tt),a.c5(nt,nt,wt);const Ze=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],_t=[0,0,0];a.av(_t,nt,Ze),a.c5(_t,_t,-1/wt);const ot=new Float64Array(16);return a.bA(ot),a.br(ot,ot,_t),a.aB(tt,ot,tt),[tt,Xe]}class $h extends a.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(i,c){return a.dc(this.requestManager.transformRequest(c,a.R.Model).url).then(g=>{if(!g)return;const E=a.dd(g),A=new a.de(i,c,void 0,void 0,E);return A.computeBoundsAndApplyParent(),A}).catch(g=>{if(g&&g.status===404)return null;this.fire(new a.y(new Error(`Could not load model ${i} from ${c}: ${g.message}`)))})}load(i,c,g={forceReload:!1}){this.models[c]||(this.models[c]={});const E=Object.keys(i),A=[],M=[];for(const D of E){const z=i[D];this.hasURLBeenRequested(z)&&!g.forceReload||(this.modelByURL[z]={modelId:D,scope:c},A.push(this.loadModel(D,z)),M.push(D)),this.models[c][D]||(this.models[c][D]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+M.length,Promise.allSettled(A).then(D=>{for(let z=0;z<D.length;z++){const{status:U}=D[z];if(U==="rejected")continue;const{value:$}=D[z];this.models[c][M[z]]||(this.models[c][M[z]]={model:null,numReferences:1}),this.models[c][M[z]].model=$}this.numModelsLoading[c]-=M.length,this.fire(new a.z("data",{dataType:"style"}))}).catch(D=>{this.fire(new a.y(new Error(`Could not load models: ${D.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,c,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(i,c):this.getModelByURL(this.modelUris[c][i]))}getModel(i,c){return this.models[c]||(this.models[c]={}),this.models[c][i]?this.models[c][i].model:void 0}getModelByURL(i){if(!i)return null;const c=this.modelByURL[i];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(i,c){return this.models[c]&&this.models[c][i]!==void 0}getModelURIs(i){return this.modelUris[i]||{}}addModel(i,c,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const E=this.requestManager.normalizeModelURL(c);if((this.hasModel(i,g,{exactIdMatch:!0})||this.hasModelBeenAdded(i,g))&&this.modelUris[g][i]===E)this.models[g][i].numReferences++;else if(this.hasURLBeenRequested(E)){const{scope:A,modelId:M}=this.modelByURL[E];this.models[A][M].numReferences++}else this.modelUris[g][i]=E,this.load({[i]:this.modelUris[g][i]},g)}addModelURLs(i,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const g=this.modelUris[c];for(const E in i)g[E]=this.requestManager.normalizeModelURL(i[E])}reloadModels(i){this.load(this.modelUris[i],i,{forceReload:!0})}addModelsFromBucket(i,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const g={};for(const E of i)this.hasModel(E,c,{exactIdMatch:!0})||this.hasURLBeenRequested(E)?this.models[c][E].numReferences++:this.modelUris[c][E]&&!this.hasURLBeenRequested(E)?g[E]=this.modelUris[c][E]:!this.hasURLBeenRequested(E)&&a.df(E,!1)&&(this.modelUris[c][E]=this.requestManager.normalizeModelURL(E),g[E]=this.modelUris[c][E]);this.load(g,c)}hasURLBeenRequested(i){return this.modelByURL[i]!==void 0}removeModel(i,c,g=!1,E=!1){if(this.models[c]&&this.models[c][i]&&(this.models[c][i].numReferences--,this.models[c][i].numReferences===0||E)){const A=this.modelUris[c][i];g||delete this.modelUris[c][i],delete this.modelByURL[A];const M=this.models[c][i].model;if(!M)return;delete this.models[c][i],M.destroy()}}destroy(){for(const i of Object.keys(this.models))for(const c of Object.keys(this.models[i])){const g=this.models[i][c].model;delete this.models[i][c],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,c){this.models[c]||(this.models[c]={});for(const g in this.models[c])this.models[c][g].model&&this.models[c][g].model.upload(i.context)}}const Do=a.a6.colorTheme,Ka=new a.a9({data:new a.aa(Do.data)});function mp(m){if(!m.metadata||!m.metadata.content_area)return;const i=a.o.devicePixelRatio,{left:c,top:g,width:E,height:A}=m.metadata.content_area,M=c*i,D=g*i;return[M,D,M+E*i,D+A*i]}function gp(m){if(m)return m.map(([i,c])=>[i*a.o.devicePixelRatio,c*a.o.devicePixelRatio])}class qc{constructor(i,c,g){this.id=i,this.scope=c,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(i){this.missingRequests.has(i.name)||this.pendingRequests.has(i.name)||this.pendingRequests.add(i.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const i=new Map;if(!this.sourceCache.loaded())return i;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return i;const g=this.sourceCache.getSource();if(!(g instanceof Zs))return i;const E=c.map(M=>this.sourceCache.getTile(M)),A=g.getImages(E,Array.from(this.pendingRequests));for(const[M,D]of A)i.set(a.I.from({name:M,iconsetId:this.id}),D),this.pendingRequests.delete(M);for(const M of this.pendingRequests)this.missingRequests.add(M);return this.pendingRequests.clear(),i}}class Qd{constructor(){a.aY(["_onIndoorUpdate"],this)}onAdd(i){return this._map=i,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(i,c){const g=Y("button",i,this._container);return g.type="button",g.addEventListener("click",c),g}_createSeparator(){return Y("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(i,c){this._map&&(i.setAttribute("aria-label",c),i.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(i){if(!i||!i.floors)return this._model=i,void(this._container.style.display="none");const c=this._model;this._model=i,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(g=>g.remove()),i.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(i.floors,i.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const i=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Y("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden","true"),i.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&i.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(i),this._createSeparator()}_updateBuildingsButtonState(){const i=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");i&&this._model&&(this._model.activeFloorsVisible?i.classList.remove("mapboxgl-ctrl-level-button-selected"):i.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(i,c){for(let g=0;g<i.length;g++){const E=i[g],A=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(E.id)}),M=(E.name||"").trim(),D=E.zIndex.toString(),z=M?Array.from(M).slice(0,3).join(""):D;this._setButtonTitle(A,z),this._model&&E.id===this._model.selectedFloorId&&c&&A.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(A),g<i.length-1&&this._createSeparator()}}}class Dm extends a.E{constructor(i){super(),this._style=i,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},a.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(i){i===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=i,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(i){this._activeFloorsVisible=i,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(i){for(const[c,g]of Object.entries(i.buildings))if(this._buildings[c])for(const E of g.floorIds)this._buildings[c].floors[E]||(this._buildings[c].floors[E]=g.floors[E]);else this._buildings[c]=g;for(const c of i.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(i,c){const g=this._style.getIndoorSourceLayers(i,c);return g&&this._indoorState?{sourceLayers:g,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Qd,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const i=this._style.map.transform,c=(function(g,E,A,M){let D=null,z=Number.MAX_SAFE_INTEGER;if(M<16)return null;for(const[U,$]of Object.entries(g)){const ie=$.center;if(ie){const K=E.distanceTo(a.aT.convert(ie));K<z&&A.contains(ie)&&(z=K,D=U)}}return D})(this._buildings,i.center,i.getBounds(),i.zoom);c!==this._closestBuildingId&&(this._closestBuildingId=c,this._updateIndoorSelector())}_updateIndoorSelector(){const i=this._buildings,c=this._closestBuildingId,g=c&&i?i[c]:void 0;if(!g)return this._removeIndoorControl(),void this.fire(new a.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let E=null;for(const M of g.floorIds)if(this._activeFloors&&this._activeFloors.has(M)){E=M;break}const A=Array.from(g.floorIds).map(M=>({id:M,name:g.floors[M].name,zIndex:g.floors[M].zIndex})).sort((M,D)=>D.zIndex-M.zIndex).filter((M,D,z)=>D===0||M.zIndex!==z[D-1].zIndex);this.fire(new a.z("selector-update",{selectedFloorId:E,activeFloorsVisible:this._activeFloorsVisible,floors:A}))}_updateActiveFloors(){const i=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:i,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const al=(m,i)=>Ke(m,i&&i.filter(c=>c.identifier!=="source.canvas")),km=a.aH(nr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Lm=a.aH(nr,["setCenter","setZoom","setBearing","setPitch"]),Jd=new Set(["background","sky","slot","custom"]),ef={version:8,layers:[],sources:{}},Ll={duration:300,delay:0};class ha extends a.E{constructor(i,c={}){super(),this.map=i,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Ll),this._buildingIndex=new Nc(this),this.crossTileSymbolIndex=new In,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Sr,this._hasDataDrivenEmissive=!1,this.indoorManager=new Dm(this),this.dispatcher=c.dispatcher?c.dispatcher:new a.D(a.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new es(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new a.di(i._requestManager,c.localFontFamily?a.dj.all:c.localIdeographFontFamily?a.dj.ideographs:a.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new $h(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",a.dk());const g=this;this._rtlTextPluginCallback=ha.registerForPluginStateChange(E=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(A,M)=>{if(a.dl(A),M&&M.every(D=>D))for(const D in g._sourceCaches){const z=g._sourceCaches[D],U=z.getSource().type;U!=="vector"&&U!=="geojson"||z.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const A=this.getOwnSource(E.sourceId);if(A&&A.vectorLayerIds)for(const M in this._layers){const D=this._layers[M];D.source===A.id&&this._validateLayer(D)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(a.h(i))return i;const c=a.dm(i);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${a.dn(JSON.stringify(i))}`}_diffStyle(i,c,g){this.globalId=this._getGlobalId(i);const E=(A,M)=>{try{M(null,this.setState(A,g))}catch(D){M(D,!1)}};if(typeof i=="string"){const A=this.map._requestManager.normalizeStyleURL(i),M=this.map._requestManager.transformRequest(A,a.R.Style);a.m(M,(D,z)=>{D?this.fire(new a.y(D)):z&&E(z,c)})}else typeof i=="object"&&E(i,c)}loadURL(i,c={}){this.fire(new a.z("dataloading",{dataType:"style"}));const g=typeof c.validate=="boolean"?c.validate:!a.h(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,c.accessToken),this.resolvedImports.add(i);const E=this.importsCache.get(i);if(E)return this._load(E,g);const A=this.map._requestManager.transformRequest(i,a.R.Style);this._request=a.m(A,(M,D)=>{if(this._request=null,M)this.fire(new a.y(M));else if(D)return this.importsCache.set(i,D),this._load(D,g)})}loadJSON(i,c={}){this.fire(new a.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=a.o.frame(()=>{this._request=null,this._load(i,c.validate!==!1)})}loadEmpty(){this.fire(new a.z("dataloading",{dataType:"style"})),this._load(ef,!1)}_loadImports(i,c,g){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const A of i){const M=this._createFragmentStyle(A),D=new Promise($=>{M.once("style.import.load",$),M.once("error",$)}).then(()=>this.mergeAll());if(E.push(D),this.resolvedImports.has(A.url)){M.loadEmpty();continue}const z=A.data||this.importsCache.get(A.url);z?(M.loadJSON(z,{validate:c}),this._isInternalStyle(z)&&(M.globalId=null)):A.url?M.loadURL(A.url,{validate:c}):M.loadEmpty();const U={style:M,id:A.id,config:A.config};if(g){const $=this.fragments.findIndex(({id:ie})=>ie===g);this.fragments=this.fragments.slice(0,$).concat(U).concat(this.fragments.slice($))}else this.fragments.push(U)}return Promise.allSettled(E)}getImportGlobalIds(i=this,c=new Set){for(const g of i.fragments)g.style.globalId&&c.add(g.style.globalId),this.getImportGlobalIds(g.style,c);return[...c.values()]}_createFragmentStyle(i){const c=this.scope?a.B(i.id,this.scope):i.id;let g;const E=this._initialConfig&&this._initialConfig[c];(i.config||E)&&(g=Object.assign({},i.config,E));const A=new ha(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return A.setEventedParent(this.map,{style:A}),A}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,c){if(this._isInternalStyle(i)){const A=Object.assign({},ef,{imports:[{id:"basemap",data:i,url:""}]},i.center?{center:i.center}:{},i.bearing?{bearing:i.bearing}:{},i.pitch?{pitch:i.pitch}:{},i.zoom?{zoom:i.zoom}:{},i.light?{light:i.light}:{});return this._importedAsBasemap=!0,void this._load(A,c)}if(this.updateConfig(this._config,i.schema),c&&al(this,Tn(i)))return;this._loaded=!0,this.stylesheet=a.dp(i);const g=()=>{for(const z in i.sources)this.addSource(z,i.sources[z],{validate:!1,isInitialLoad:!0});if(i.iconsets)for(const z in i.iconsets)this.addIconset(z,i.iconsets[z]);i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&i.glyphs&&this.glyphManager.setURL(i.glyphs);const A=$d(this.stylesheet.layers);if(this._order=A.map(z=>z.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new dt(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new dt(this.stylesheet.light)),this._layers={};for(const z of A){const U=a.du(z,this.scope,this._styleColorTheme.lut,this.options);U.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(U.fqid),U.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(U.fqid),this._hasAppearances=this._hasAppearances||U.getAppearances().length!==0,U.setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U;const $=this.getOwnLayerSourceCache(U),ie=!!this.directionalLight&&this.directionalLight.shadowsEnabled();$&&U.canCastShadows()&&ie&&($.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.z("data",{dataType:"style"}));const D=this.isRootStyle();i.imports?this._loadImports(i.imports,c).then(()=>{this._reloadImports(),this.fire(new a.z(D?"style.load":"style.import.load"))}).catch(z=>{this.fire(new a.y(new Error("Failed to load imports",z))),this.fire(new a.z(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.z(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const E=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(E){const A=this._evaluateColorThemeData(E);this._loadColorTheme(A).then(()=>{g()}).catch(M=>{a.w(`Couldn't load color theme from the stylesheet: ${M}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(i=>i.style.hasAppearances())}mergeAll(){let i,c,g,E,A,M,D,z,U,$;const ie={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(K=>{if(K.stylesheet){if(K.light!=null&&(i=K.light),K.stylesheet.lights)for(const re of K.stylesheet.lights)re.type==="ambient"&&K.ambientLight!=null&&(c=K.ambientLight),re.type==="directional"&&K.directionalLight!=null&&(g=K.directionalLight);E=this._prioritizeTerrain(E,K.terrain,K.stylesheet.terrain),K.stylesheet.fog&&K.fog!=null&&(A=K.fog),K.stylesheet.snow&&K.snow!=null&&(M=K.snow),K.stylesheet.rain&&K.rain!=null&&(D=K.rain),K.stylesheet.camera!=null&&($=K.stylesheet.camera),K.stylesheet.projection!=null&&(z=K.stylesheet.projection),K.stylesheet.transition!=null&&(U=K.stylesheet.transition),ie[K.scope]=K._styleColorTheme}}),this.light=i,this.ambientLight=c,this.directionalLight=g,this.fog=A,this.snow=M,this.rain=D,this._styleColorThemeForScope=ie,E===null?delete this.terrain:this.terrain=E,this.camera=$||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=Object.assign({},Ll,U),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(i){const c=g=>{for(const E of g.fragments)c(E.style);i(g)};c(this)}_prioritizeTerrain(i,c,g){const E=i&&i.drapeRenderMode===0;return g===null?c&&c.drapeRenderMode===0?c:E?i:null:c!=null&&(!i||E||c&&c.drapeRenderMode===1)?c:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{i=this._prioritizeTerrain(i,c.terrain,c.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(i=c.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},c={},g={};this.forEachFragmentStyle(E=>{for(const A in E._sourceCaches){const M=a.B(A,E.scope);i[M]=E._sourceCaches[A]}for(const A in E._otherSourceCaches){const M=a.B(A,E.scope);c[M]=E._otherSourceCaches[A]}for(const A in E._symbolSourceCaches){const M=a.B(A,E.scope);g[M]=E._symbolSourceCaches[A]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeIndoor(){this.forEachFragmentStyle(i=>{if(i.stylesheet&&i.stylesheet.indoor)for(const c of Object.values(i.stylesheet.indoor)){const g=c,E=a.B(g.sourceId,i.scope);this._mergedIndoor[E]=new Set(g.sourceLayers||[])}})}mergeLayers(){const i={},c=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const D of M._order){const z=M._layers[D];if(z.type==="slot"){const U=a.dq(D);if(i[U])continue;i[U]=[]}z.slot&&i[z.slot]?i[z.slot].push(z):c.push(z)}}),this._mergedOrder=[];let E=-1;const A=(M=[])=>{for(const D of M)if(D.type==="slot"){const z=a.dq(D.id);i[z]&&A(i[z]),this._mergedSlots.push(z)}else{const z=a.B(D.id,D.scope);this._mergedOrder.push(z),g[z]=D,D.is3D(!!this.terrain)&&(this._has3DLayers=!0,E=this._mergedOrder.length-1),D.type==="circle"&&(this._hasCircleLayers=!0),D.type==="symbol"&&(this._hasSymbolLayers=!0),D.type==="clip"&&(this._clipLayerPresent=!0)}};if(A(c),this._has3DLayers){const M={};for(let D=0;D<this._mergedOrder.length;++D){const z=this._mergedOrder[D];M[z]=D===E?1:D<E?g[z].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((D,z)=>M[D]-M[z])}this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?(function(c,g,E){const A=Object.assign({},g);for(const D of Object.keys(Do))A[D]===void 0&&(A[D]=Do[D].default);const M=new a.a8(Ka,c,new Map(E));return M.setTransitionOrValue(A,E),M.untransitioned().possiblyEvaluate(new a.ac(0,{worldview:void 0}))})(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,E)=>{const A="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let M=i;M.startsWith(A)||(M=A+M);const D=a.I.from("mapbox-reserved-lut"),z=new Image;z.src=M,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void g();this._styleColorTheme.lutLoading=!1;const{width:U,height:$,data:ie}=a.o.getImageData(z);if($>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(U!==$*$)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new a.q({width:U,height:$},ie),pixelRatio:1,sdf:!1,usvg:!1,version:0});const K=this.imageManager.getImage(D,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:i},g()):E(new Error("Missing LUT image."))}})}getLut(i){const c=this._styleColorThemeForScope[i];return c?c.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=(function(c,g,E){let A,M,D;const z=a.o.devicePixelRatio>1?"@2x":"";let U=a.m(g.transformRequest(g.normalizeSpriteURL(c,z,".json"),a.R.SpriteJSON),(K,re)=>{U=null,D||(D=K,A=re,ie())}),$=a.n(g.transformRequest(g.normalizeSpriteURL(c,z,".png"),a.R.SpriteImage),(K,re)=>{$=null,D||(D=K,M=re,ie())});function ie(){if(D)E(D);else if(A&&M){const K=a.o.getImageData(M),re={};for(const he in A){const{width:ce,height:de,x:ge,y:Ce,sdf:Ae,pixelRatio:Ee,stretchX:Ge,stretchY:je,content:Ue}=A[he],ze=new a.q({width:ce,height:de});a.q.copy(K,ze,{x:ge,y:Ce},{x:0,y:0},{width:ce,height:de},null),re[he]={data:ze,pixelRatio:Ee!==void 0?Ee:1,sdf:Ae!==void 0&&Ae,stretchX:Ge,stretchY:je,content:Ue,usvg:!1,version:0}}E(null,re)}}return{cancel(){U&&(U.cancel(),U=null),$&&($.cancel(),$=null)}}})(i,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new a.y(c));else if(g){const E=new Map;for(const A in g)E.set(a.I.from(A),g[A]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))})}addIconset(i,c){if(c.type==="sprite")return void this._loadSprite(c.url);const g=this.getOwnSourceCache(c.source);if(!g)return void this.fire(new a.y(new Error(`Source "${c.source}" as specified by iconset "${i}" does not exist and cannot be used as an iconset source`)));const E=g.getSource();if(E.type!=="raster-array")return void this.fire(new a.y(new Error(`Source "${c.source}" as specified by iconset "${i}" is not a "raster-array" source and cannot be used as an iconset source`)));E.partial=!1;const A=new qc(i,this.scope,g);this.imageManager.addImageProvider(A,this.scope)}removeIconset(i){this.imageManager.removeImageProvider(i,this.scope)}_loadIconset(i){if(!a.h(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const c=this.map._spriteFormat==="auto";var g,E;this._spriteRequest=(E=(A,M)=>{if(this._spriteRequest=null,A)c?this._loadSprite(i):this.fire(new a.y(A));else if(M){const D=new Map;for(const z in M)D.set(a.I.from(z),M[z]);this.addImages(D)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))},a.bu((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(i),a.R.Iconset),(A,M)=>{if(A)return void E(A);const D={},z=a.dg(new a.bt(M));for(const U of z.icons){const $={version:1,pixelRatio:a.o.devicePixelRatio,content:mp(U),stretchX:U.metadata?gp(U.metadata.stretch_x_areas):void 0,stretchY:U.metadata?gp(U.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:U};D[U.name]=$}E(null,D)}))}_validateLayer(i){const c=this.getOwnSource(i.source);if(!c)return;const g=i.sourceLayer;g&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.y(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,c)=>{const g=this.fragments[c];return g&&g.style&&(i.data=g.style.serialize()),i})}_serializeSources(){const i={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();i[g.id]||(i[g.id]=g.serialize())}return i}_serializeLayers(i){const c=[];for(const g of i){const E=this._layers[g];E&&E.type!=="custom"&&c.push(E.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const i in this._mergedLayers){const c=this._mergedLayers[i];if(c._transitionablePaint&&c._transitionablePaint._values){const g=c._transitionablePaint._values["line-emissive-strength"];if(g&&g.value&&g.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const c=this.getOwnLayer(i);if(c)return c;this.fire(new a.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const c=this.getOwnSource(i);if(c)return c;this.fire(new a.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,c){const g=this.map.painter;if(g)for(let E=i.minzoom||0;E<(i.maxzoom||25.5);E++){const A=i.getProgramIds();if(A)for(const M of A){const D=i.getDefaultProgramParams(M,c.zoom,this._styleColorTheme.lut);D&&(g.style=this,this.fog&&(g._fogVisible=!0,D.overrideFog=!0,g.getOrCreateProgram(M,D)),g._fogVisible=!1,D.overrideFog=!1,g.getOrCreateProgram(M,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,g.getOrCreateProgram(M,D)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const c=this.calculateLightsBrightness();i.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),i.worldview!==this._worldview&&(this._worldview=i.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const D=this._changes.getLayerUpdatesByScope();for(const z in D){const{updatedIds:U,removedIds:$}=D[z];(U||$)&&(this._updateWorkerLayers(z,U,$),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const A={};for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D];A[D]=z.used,z.used=!1,z.tileCoverLift=0}for(const D of this._mergedOrder){const z=this._mergedLayers[D];if(z.visibility!=="none"&&z.recalculate(i,this._availableImages),!z.isHidden(i.zoom)){const U=this.getLayerSourceCache(z);U&&(U.used=!0,U.tileCoverLift=Math.max(U.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,i)}):this.precompilePrograms(z,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();const M=this.imageManager.getPendingImageProviders();for(const D of M)D.sourceCache.used=!0;for(const D in A){const z=this._mergedSourceCaches[D];A[D]!==z.used&&z.getSource().fire(new a.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new a.z("data",{dataType:"style"}))}updateImageProviders(){const i=this.imageManager.getPendingImageProviders();for(const c of i){const g=c.resolvePendingRequests(),E=this.getFragmentStyle(c.scope);E&&E.addImages(g)}}_updateTilesForChangedImages(){const i={};for(const c in this._mergedSourceCaches){const g=this._mergedSourceCaches[c].getSource().scope;i[g]=i[g]||this._changes.getUpdatedImages(g),i[g].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i[g])}for(const c in i)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(i,c,g){const E=this.getFragmentStyle(i);E&&this.dispatcher.broadcast("updateLayers",{layers:c?E._serializeLayers(c):[],scope:i,removedIds:g||[],options:E.options})}setState(i,c){if(this._checkLoaded(),al(this,Tn(i)))return!1;(i=a.dp(i)).layers=$d(i.layers);const g=(function(M,D){if(!M)return[{command:nr.setStyle,args:[D]}];let z=[];try{if(!a.by(M.version,D.version))return[{command:nr.setStyle,args:[D]}];if(a.by(M.center,D.center)||z.push({command:nr.setCenter,args:[D.center]}),a.by(M.zoom,D.zoom)||z.push({command:nr.setZoom,args:[D.zoom]}),a.by(M.bearing,D.bearing)||z.push({command:nr.setBearing,args:[D.bearing]}),a.by(M.pitch,D.pitch)||z.push({command:nr.setPitch,args:[D.pitch]}),a.by(M.sprite,D.sprite)||z.push({command:nr.setSprite,args:[D.sprite]}),a.by(M.glyphs,D.glyphs)||z.push({command:nr.setGlyphs,args:[D.glyphs]}),a.by(M.imports,D.imports)||(function(re=[],he=[],ce){he=he||[];const de=(re=re||[]).map(po),ge=he.map(po),Ce=re.reduce(jh,{}),Ae=he.reduce(jh,{}),Ee=de.slice();let Ge,je,Ue,ze;for(Ge=0,je=0;Ge<de.length;Ge++)Ue=de[Ge],Ae.hasOwnProperty(Ue)?je++:(ce.push({command:nr.removeImport,args:[Ue]}),Ee.splice(Ee.indexOf(Ue,je),1));for(Ge=0,je=0;Ge<ge.length;Ge++)Ue=ge[ge.length-1-Ge],Ee[Ee.length-1-Ge]!==Ue&&(Ce.hasOwnProperty(Ue)?(ce.push({command:nr.removeImport,args:[Ue]}),Ee.splice(Ee.lastIndexOf(Ue,Ee.length-je),1)):je++,ze=Ee[Ee.length-Ge],ce.push({command:nr.addImport,args:[Ae[Ue],ze]}),Ee.splice(Ee.length-Ge,0,Ue));for(const Pe of he){const We=Ce[Pe.id];We&&(delete We.data,a.by(We,Pe)||ce.push({command:nr.updateImport,args:[Pe.id,Pe]}))}})(M.imports,D.imports,z),a.by(M.transition,D.transition)||z.push({command:nr.setTransition,args:[D.transition]}),a.by(M.light,D.light)||z.push({command:nr.setLight,args:[D.light]}),a.by(M.fog,D.fog)||z.push({command:nr.setFog,args:[D.fog]}),a.by(M.snow,D.snow)||z.push({command:nr.setSnow,args:[D.snow]}),a.by(M.rain,D.rain)||z.push({command:nr.setRain,args:[D.rain]}),a.by(M.projection,D.projection)||z.push({command:nr.setProjection,args:[D.projection]}),a.by(M.lights,D.lights)||z.push({command:nr.setLights,args:[D.lights]}),a.by(M.camera,D.camera)||z.push({command:nr.setCamera,args:[D.camera]}),a.by(M.iconsets,D.iconsets)||(function(re,he,ce){let de;for(de in he=he||{},re=re||{})re.hasOwnProperty(de)&&(he.hasOwnProperty(de)||ce.push({command:nr.removeIconset,args:[de]}));for(de in he){if(!he.hasOwnProperty(de))continue;const ge=he[de];re.hasOwnProperty(de)?a.by(re[de],ge)||(ce.push({command:nr.removeIconset,args:[de]}),ce.push({command:nr.addIconset,args:[de,ge]})):ce.push({command:nr.addIconset,args:[de,ge]})}})(M.iconsets,D.iconsets,z),!a.by(M["color-theme"],D["color-theme"]))return[{command:nr.setStyle,args:[D]}];const U={},$=[];(function(re,he,ce,de){let ge;for(ge in he=he||{},re=re||{})re.hasOwnProperty(ge)&&(he.hasOwnProperty(ge)||Bh(ge,ce,de));for(ge in he){if(!he.hasOwnProperty(ge))continue;const Ce=he[ge];re.hasOwnProperty(ge)?a.by(re[ge],Ce)||(re[ge].type==="geojson"&&Ce.type==="geojson"&&ac(re,he,ge)?ce.push({command:nr.setGeoJSONSourceData,args:[ge,Ce.data]}):ya(ge,he,ce,de)):Ml(ge,he,ce)}})(M.sources,D.sources,$,U);const ie=[];M.layers&&M.layers.forEach(re=>{re.source&&U[re.source]?z.push({command:nr.removeLayer,args:[re.id]}):ie.push(re)});let K=M.terrain;K&&U[K.source]&&(z.push({command:nr.setTerrain,args:[void 0]}),K=void 0),z=z.concat($),a.by(K,D.terrain)||z.push({command:nr.setTerrain,args:[D.terrain]}),(function(re,he,ce){he=he||[];const de=(re=re||[]).map(po),ge=he.map(po),Ce=re.reduce(jh,{}),Ae=he.reduce(jh,{}),Ee=de.slice(),Ge=Object.create(null);let je,Ue,ze,Pe,We,Xe,Qe;for(je=0,Ue=0;je<de.length;je++)ze=de[je],Ae.hasOwnProperty(ze)?Ue++:(ce.push({command:nr.removeLayer,args:[ze]}),Ee.splice(Ee.indexOf(ze,Ue),1));for(je=0,Ue=0;je<ge.length;je++)ze=ge[ge.length-1-je],Ee[Ee.length-1-je]!==ze&&(Ce.hasOwnProperty(ze)?(ce.push({command:nr.removeLayer,args:[ze]}),Ee.splice(Ee.lastIndexOf(ze,Ee.length-Ue),1)):Ue++,Xe=Ee[Ee.length-je],ce.push({command:nr.addLayer,args:[Ae[ze],Xe]}),Ee.splice(Ee.length-je,0,ze),Ge[ze]=!0);for(je=0;je<ge.length;je++)if(ze=ge[je],Pe=Ce[ze],We=Ae[ze],!Ge[ze]&&!a.by(Pe,We))if(a.by(Pe.source,We.source)&&a.by(Pe["source-layer"],We["source-layer"])&&a.by(Pe.type,We.type)){for(Qe in oc(Pe.layout,We.layout,ce,ze,null,nr.setLayoutProperty),oc(Pe.paint,We.paint,ce,ze,null,nr.setPaintProperty),a.by(Pe.slot,We.slot)||ce.push({command:nr.setSlot,args:[ze,We.slot]}),a.by(Pe.filter,We.filter)||ce.push({command:nr.setFilter,args:[ze,We.filter]}),a.by(Pe.minzoom,We.minzoom)&&a.by(Pe.maxzoom,We.maxzoom)||ce.push({command:nr.setLayerZoomRange,args:[ze,We.minzoom,We.maxzoom]}),Pe)Pe.hasOwnProperty(Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&Qe!=="slot"&&(Qe.indexOf("paint.")===0?oc(Pe[Qe],We[Qe],ce,ze,Qe.slice(6),nr.setPaintProperty):a.by(Pe[Qe],We[Qe])||ce.push({command:nr.setLayerProperty,args:[ze,Qe,We[Qe]]}));for(Qe in We)We.hasOwnProperty(Qe)&&!Pe.hasOwnProperty(Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&Qe!=="slot"&&(Qe.indexOf("paint.")===0?oc(Pe[Qe],We[Qe],ce,ze,Qe.slice(6),nr.setPaintProperty):a.by(Pe[Qe],We[Qe])||ce.push({command:nr.setLayerProperty,args:[ze,Qe,We[Qe]]}))}else ce.push({command:nr.removeLayer,args:[ze]}),Xe=Ee[Ee.lastIndexOf(ze)+1],ce.push({command:nr.addLayer,args:[We,Xe]})})(ie,D.layers,z)}catch(U){console.warn("Unable to compute style diff:",U),z=[{command:nr.setStyle,args:[D]}]}return z})(this.serialize(),i).filter(M=>!(M.command in Lm));if(g.length===0)return!1;const E=g.filter(M=>!(M.command in km));if(E.length>0)throw new Error(`Unimplemented: ${E.map(M=>M.command).join(", ")}.`);const A=[];return g.forEach(M=>{A.push(this[M.command](...M.args))}),c&&Promise.all(A).then(c).catch(c),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(i){if(i.size===0)return this;for(const[c,g]of i.entries()){if(this.getImage(c))return this.fire(new a.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,g),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this}addImage(i,c){return this.getImage(i)?this.fire(new a.y(new Error(`An image with the name "${i.name}" already exists.`))):(this.imageManager.addImage(i,this.scope,c),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this)}updateImage(i,c,g=!1){this.imageManager.updateImage(i,this.scope,c),g&&(this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})))}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(i){return this.modelManager.addModelURLs(i,this.getActualScope()),this._updateWorkerModels(),this.fire(new a.z("data",{dataType:"style"})),this}addModel(i,c,g={}){return this._checkLoaded(),this._validate(qe,`models.${i}`,c,null,g)||(this.modelManager.addModel(i,c,this.getActualScope()),this.fire(new a.z("data",{dataType:"style"}))),this}hasModel(i){return this.modelManager.hasModel(i,this.getActualScope())}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.getActualScope(),!1,!0),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(i,c,g={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(tl,`sources.${i}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const E=co(i,c,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id}));const A=M=>{const D=(M?"symbol:":"other:")+E.id,z=a.B(D,this.scope),U=this._sourceCaches[D]=new Kn(z,E,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=U,U.onAdd(this.map)};A(!1),c.type!=="vector"&&c.type!=="geojson"||A(!0),E.onAdd&&E.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const c=this.getOwnSource(i);if(!c)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===i)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const E=Object.entries(this.stylesheet.iconsets).find(([A,M])=>M.type==="source"&&M.source===i);if(E)return this.fire(new a.y(new Error(`Source "${i}" cannot be removed while iconset "${E[0]}" is using it.`)))}const g=this.getOwnSourceCaches(i);for(const E of g){const A=a.dq(E.id);delete this._sourceCaches[A],this._changes.discardSourceCacheUpdate(E.id),E.fire(new a.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getOwnSource(i).setData(c),this._changes.setDirty()}getOwnSource(i){const c=this.getOwnSourceCache(i);return c&&c.getSource()}getOwnSources(){const i=[];for(const c in this._otherSourceCaches){const g=this.getOwnSourceCache(c);g&&i.push(g.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const c in i){const g=i[c]._tiles;for(const E in g){const A=g[E];if(A.state!=="loaded"&&A.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const A of i){if(this._validate(Pt,"lights",A))return;switch(A.type){case"ambient":if(this.ambientLight){const M=this.ambientLight;M.set(A),M.updateTransitions(c)}else this.ambientLight=new rr(A,Yr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const M=this.directionalLight;M.set(A),M.updateTransitions(c)}else this.directionalLight=new rr(A,Cr(),this.scope,this.options)}}const g=Object.assign(c,{worldview:this.map.getWorldview()}),E=new a.ac(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(E),this.directionalLight&&this.directionalLight.recalculate(E),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,c=this.ambientLight;if(!i||!c)return;const g=K=>.2126*(K[0]<=.03928?K[0]/12.92:Math.pow((K[0]+.055)/1.055,2.4))+.7152*(K[1]<=.03928?K[1]/12.92:Math.pow((K[1]+.055)/1.055,2.4))+.0722*(K[2]<=.03928?K[2]/12.92:Math.pow((K[2]+.055)/1.055,2.4)),E=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),A=i.properties.get("intensity"),M=i.properties.get("direction"),D=1-a.d4(M.x,M.y,M.z)[2]/90,z=g(E)*A*D,U=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),$=c.properties.get("intensity"),ie=g(U)*$;return Number(((z+ie)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(i==null||i===""&&this.isRootStyle())return this;if(a.dr(i)){const c=a.ds(i),g=this.fragments.find(({id:A})=>A===c);if(!g)return;const E=a.dq(i);return g.style.getFragmentStyle(E)}{const c=this.fragments.find(({id:g})=>g===i);return c?c.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const c={},g=(E,A="")=>`${E}::${A}`;this._featuresetSelectors={};for(const E in i){const A=this._featuresetSelectors[E]=[];for(const M of i[E].selectors){if(M.featureNamespace){const z=this.getOwnLayer(M.layer);if(!z){a.w(`Layer is undefined for selector: ${M.layer}`);continue}const U=g(z.source,z.sourceLayer);if(U in c&&c[U]!==M.featureNamespace){a.w(`"featureNamespace ${M.featureNamespace} of featureset ${E}'s selector is not associated to the same source, skip this selector`);continue}c[U]=M.featureNamespace}let D;if(M.properties)for(const z in M.properties){const U=a.U(M.properties[z]);U.result==="success"&&(D=D||{},D[z]=U.value)}A.push({layerId:M.layer,namespace:M.featureNamespace,properties:D,uniqueFeatureID:M._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const c=this.getFragmentStyle(i);if(!c||!c.stylesheet.featuresets)return[];const g=[];for(const E in c.stylesheet.featuresets)g.push({featuresetId:E,importId:c.scope?c.scope:void 0});return g}getFeaturesetLayers(i,c){const g=this.getFragmentStyle(c),E=g.stylesheet.featuresets;if(!E||!E[i])return this.fire(new a.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const A=[];for(const M of E[i].selectors){const D=g.getOwnLayer(M.layer);D&&A.push(D)}return A}getConfigProperty(i,c){const g=this.getFragmentStyle(i);if(!g)return null;const E=a.B(c,g.scope),A=g.options.get(E),M=A?A.value||A.default:null;return M?M.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(i,c){const g=a.B(i,c);return this._mergedIndoor[g]}setIndoorData(i,c){this.indoorManager.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(i,c,g){const E=this.getFragmentStyle(i);if(!E)return;const A=E.stylesheet.schema;if(!A||!A[c])return;const M=a.U(g);if(M.result!=="success")return void al(this,M.value);const D=M.value.expression,z=a.B(c,E.scope),U=E.options.get(z);if(!U)return;let $;const{minValue:ie,maxValue:K,stepValue:re,type:he,values:ce}=A[c],de=a.U(A[c].default);de.result==="success"&&($=de.value.expression),$?(this.options.set(z,Object.assign({},U,{value:D,default:$,minValue:ie,maxValue:K,stepValue:re,type:he,values:ce})),this.updateConfigDependencies(c)):this.fire(new a.y(new Error(`No schema defined for the config option "${c}" in the "${i}" fragment.`)))}getConfig(i){const c=this.getFragmentStyle(i);if(!c)return null;const g=c.stylesheet.schema;if(!g)return null;const E={};for(const A in g){const M=a.B(A,c.scope),D=c.options.get(M),z=D?D.value||D.default:null;E[A]=z?z.serialize():null}return E}setConfig(i,c){const g=this.getFragmentStyle(i);g&&(g.updateConfig(c,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const c=this.getFragmentStyle(i);return c?c.stylesheet.schema:null}setSchema(i,c){const g=this.getFragmentStyle(i);g&&(g.stylesheet.schema=c,g.updateConfig(g._config,c),this.updateConfigDependencies())}updateConfig(i,c){if(this._config=i,i||c)if(c)for(const g in c){let E,A;const M=a.U(c[g].default);if(M.result==="success"&&(E=M.value.expression),i&&i[g]!==void 0){const K=a.U(i[g]);K.result==="success"&&(A=K.value.expression)}const{minValue:D,maxValue:z,stepValue:U,type:$,values:ie}=c[g];if(E){const K=a.B(g,this.scope);this.options.set(K,{default:E,value:A,minValue:D,maxValue:z,stepValue:U,type:$,values:ie})}else this.fire(new a.y(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new a.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(i,c=()=>!0){for(const g of i){const E=this.getLayer(g);E&&c(E)&&(E.possiblyEvaluateVisibility(),this._updateLayer(E),this._changes.setDirty())}}updateConfigDependencies(i){this._updateLayers(this._configDependentLayers,c=>!i||c.expressionDependencies.configDependencies.has(i)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const g=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(g){const E=c._evaluateColorThemeData(g);(!c._styleColorTheme.lut&&E!==""||c._styleColorTheme.lut&&E!==c._styleColorTheme.lut.data)&&c.setColorTheme(g)}}),this._changes.setDirty()}addLayer(i,c,g={}){this._checkLoaded();const E=i.id;if(this._layers[E])return void this.fire(new a.y(new Error(`Layer with id "${E}" already exists on this map`)));let A;if(i.type==="custom"){if(al(this,a.dt(i)))return;A=a.du(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(E,i.source),i=a.dp(i),i=Object.assign(i,{source:E})),this._validate(Je,`layers.${E}`,i,{arrayIndex:-1},g))return;A=a.du(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(A),A.setEventedParent(this,{layer:{id:E}})}const M=a.B(A.source,A.scope);A.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M),A.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M);let D=this._order.length;if(c){const ie=this._order.indexOf(c);if(ie===-1)return void this.fire(new a.y(new Error(`Layer with id "${c}" does not exist on this map.`)));A.slot&&A.slot!==this._layers[c].slot?a.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):D=ie}this._order.splice(D,0,E),this._handleLayerOrderChange(),this._layers[E]=A;const z=this.getOwnLayerSourceCache(A),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&A.canCastShadows()&&U&&(z.castsShadows=!0);const $=this._changes.getRemovedLayer(A);if($&&A.source&&z&&A.type!=="custom"){this._changes.discardLayerRemoval(A);const ie=a.B(A.source,A.scope);$.type!==A.type?this._changes.updateSourceCache(ie,"clear"):(this._changes.updateSourceCache(ie,"reload"),z.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),A.scope=this.scope,this.mergeLayers()}moveLayer(i,c){this._checkLoaded();const g=this._checkLayer(i);if(!g||i===c)return;const E=this._order.indexOf(i);this._order.splice(E,1);let A=this._order.length;if(c){const M=this._order.indexOf(c);if(M===-1)return void this.fire(new a.y(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot&&g.slot!==this._layers[c].slot?a.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):A=M}this._order.splice(A,0,i),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(i){this._checkLoaded();const c=this._checkLayer(i);if(!c)return;c.setEventedParent(null);const g=this._order.indexOf(i);this._order.splice(g,1),delete this._layers[i],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const E=this.getOwnLayerSourceCache(c);if(E&&E.castsShadows){let A=!1;for(const M in this._layers)if(this._layers[M].source===c.source&&this._layers[M].canCastShadows()){A=!0;break}E.castsShadows=A}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,g){this._checkLoaded();const E=this._checkLayer(i);E&&(E.minzoom===c&&E.maxzoom===g||(c!=null&&(E.minzoom=c),g!=null&&(E.maxzoom=g),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,c){this._checkLoaded();const g=this._checkLayer(i);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(i,c,g={}){this._checkLoaded();const E=this._checkLayer(i);if(E&&!a.by(E.filter,c))return c==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(me,`layers.${E.id}.filter`,c,{layerType:E.type},g)||(E.filter=a.dp(c),this._updateLayer(E)))}getFilter(i){const c=this._checkLayer(i);if(c)return a.dp(c.filter)}setLayoutProperty(i,c,g,E={}){this._checkLoaded();const A=this._checkLayer(i);if(A&&!a.by(A.getLayoutProperty(c),g)){if(g!=null&&(!E||E.validate!==!1)&&al(A,De.call(Tn,{key:`layers.${i}.layout.${c}`,layerType:A.type,objectKey:c,value:g,styleSpec:a.a6,style:{glyphs:!0,sprite:!0}})))return;A.setLayoutProperty(c,g),A.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),A.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(A.fqid),this._updateLayer(A)}}setLayerProperty(i,c,g,E={}){this._checkLoaded();const A=this._checkLayer(i);A&&(c==="appearances"?(A.setAppearances(g),this._changes.setDirty()):A.isPaintProperty(c)?this.setPaintProperty(i,c,g,E):this.setLayoutProperty(i,c,g,E))}getLayoutProperty(i,c){const g=this._checkLayer(i);if(g)return g.getLayoutProperty(c)}setPaintProperty(i,c,g,E={}){this._checkLoaded();const A=this._checkLayer(i);if(!A||a.by(A.getPaintProperty(c),g)||g!=null&&(!E||E.validate!==!1)&&al(A,ve.call(Tn,{key:`layers.${i}.paint.${c}`,layerType:A.type,objectKey:c,value:g,styleSpec:a.a6})))return;const M=A.setPaintProperty(c,g);A.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),A.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(A.fqid),M&&this._updateLayer(A),this._changes.updatePaintProperties(A)}getPaintProperty(i,c){const g=this._checkLayer(i);if(g)return g.getPaintProperty(c)}setFeatureState(i,c){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:z,importId:U}=i.target,$=this.getFragmentStyle(U),ie=$.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of ie)$.setFeatureState({id:i.id,source:K,sourceLayer:re},c)}else if("layerId"in i.target){const{layerId:z}=i.target,U=this.getLayer(z);this.setFeatureState({id:i.id,source:U.source,sourceLayer:U.sourceLayer},c)}return}const g=i.source,E=i.sourceLayer,A=this._checkSource(g);if(!A)return;const M=A.type;if(M==="geojson"&&E)return void this.fire(new a.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!E)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(g);for(const z of D)z.setFeatureState(E,i.id,c)}removeFeatureState(i,c){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:z,importId:U}=i.target,$=this.getFragmentStyle(U),ie=$.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of ie)$.removeFeatureState({id:i.id,source:K,sourceLayer:re},c)}else if("layerId"in i.target){const{layerId:z}=i.target,U=this.getLayer(z);this.removeFeatureState({id:i.id,source:U.source,sourceLayer:U.sourceLayer},c)}return}const g=i.source,E=this._checkSource(g);if(!E)return;const A=E.type,M=A==="vector"?i.sourceLayer:void 0;if(A==="vector"&&!M)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new a.y(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(g);for(const z of D)z.removeFeatureState(M,i.id,c)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let A;if("featuresetId"in i.target){const{featuresetId:M,importId:D}=i.target,z=this.getFragmentStyle(D),U=z.getFeaturesetLayers(M);for(const{source:$,sourceLayer:ie}of U){const K=z.getFeatureState({id:i.id,source:$,sourceLayer:ie});if(K&&!A)A=K;else if(!a.by(A,K))return void this.fire(new a.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:M}=i.target,D=this.getLayer(M);A=this.getFeatureState({id:i.id,source:D.source,sourceLayer:D.sourceLayer})}return A}const c=i.source,g=i.sourceLayer,E=this._checkSource(c);if(E){if(E.type!=="vector"||g)return i.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(g,i.id);this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),c=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return a.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(i){for(const c of Object.values(this._mergedLayers))i(c)&&this._updateLayer(c)}_updateLayer(i){this._changes.updateLayer(i);const c=this.getLayerSourceCache(i),g=a.B(i.source,i.scope),E=this._changes.getUpdatedSourceCaches();i.source&&!E[g]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),c.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=D=>this._mergedLayers[D].is3D(!!this.terrain),g=this.order,E={},A=[];for(let D=g.length-1;D>=0;D--){const z=g[D];if(c(z)){E[z]=D;for(const U of i){const $=U[z];if($)for(const ie of $)A.push(ie)}}}A.sort((D,z)=>z.intersectionZ-D.intersectionZ);const M=[];for(let D=g.length-1;D>=0;D--){const z=g[D];if(c(z))for(let U=A.length-1;U>=0;U--){const $=A[U].feature;if($.layer&&E[$.layer.id]<D)break;M.push($),A.pop()}else for(const U of i){const $=U[z];if($)for(const ie of $)M.push(ie.feature)}}return M}queryRasterValue(i,c,g){const E=this.getOwnSource(i);return E?E.type!=="raster-array"?(this.fire(new a.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):E.queryRasterArrayValue(c,g):(this.fire(new a.y(new Error(`Source with id "${i}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(i,c,g){let E;c&&!Array.isArray(c)&&c.filter&&(this._validate(me,"queryRenderedFeatures.filter",c.filter,null,c),E=a.b6(c.filter));const A={},M=$=>{if(Jd.has($.type))return;const ie=this.getOwnLayerSourceCache($),K=A[ie.id]=A[ie.id]||{sourceCache:ie,layers:{},has3DLayers:!1};$.is3D(!!this.terrain)&&(K.has3DLayers=!0),K.layers[$.fqid]=K.layers[$.fqid]||{styleLayer:$,targets:[]},K.layers[$.fqid].targets.push({filter:E})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new a.y(new Error("parameters.layers must be an Array."))),[];for(const $ of c.layers){const ie=this._layers[$];if(!ie)return this.fire(new a.y(new Error(`The layer '${$}' does not exist in the map's style and cannot be queried for features.`))),[];M(ie)}}else for(const $ in this._layers)M(this._layers[$]);const D=this._queryRenderedFeatures(i,A,g),z=this._flattenAndSortRenderedFeatures(D),U=[];for(const $ of z)a.dw($.layer.id)===this.scope&&U.push($);return U}queryRenderedFeatureset(i,c,g){let E;c&&!Array.isArray(c)&&c.filter&&(this._validate(me,"queryRenderedFeatures.filter",c.filter,null,c),E=a.b6(c.filter));const A="mock",M=[];if(c&&c.target)M.push(Object.assign({},c,{targetId:A,filter:E}));else{const $=this.getFeaturesetDescriptors();for(const ie of $)M.push({targetId:A,filter:E,target:ie});for(const{style:ie}of this.fragments){const K=ie.getFeaturesetDescriptors();for(const re of K)M.push({targetId:A,filter:E,target:re})}}const D=this.queryRenderedTargets(i,M,g),z=[],U=new Set;for(const $ of D)for(const ie of $.variants[A])Du(ie,$,U)||z.push(new a.dx($,ie));return z}queryRenderedTargets(i,c,g){const E={},A=(D,z,U,$)=>{const ie=E[z.id]=E[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};if(ie.layers[D.fqid]=ie.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D(!!this.terrain)&&(ie.has3DLayers=!0),!$)return U.uniqueFeatureID=!1,void ie.layers[D.fqid].targets.push(U);ie.layers[D.fqid].targets.push(Object.assign({},U,{namespace:$.namespace,properties:$.properties,uniqueFeatureID:$.uniqueFeatureID}))};for(const D of c)if("featuresetId"in D.target){const{featuresetId:z,importId:U}=D.target,$=this.getFragmentStyle(U);if(!$||!$._featuresetSelectors)continue;const ie=$._featuresetSelectors[z];if(!ie){this.fire(new a.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const K of ie){const re=$.getOwnLayer(K.layerId);re&&!Jd.has(re.type)&&A(re,$.getOwnLayerSourceCache(re),D,K)}}else if("layerId"in D.target){const{layerId:z}=D.target,U=this.getLayer(z);if(!U||Jd.has(U.type))continue;A(U,this.getLayerSourceCache(U),D)}const M=this._queryRenderedFeatures(i,E,g);return this._flattenAndSortRenderedFeatures(M)}_queryRenderedFeatures(i,c,g){const E=[],A=!!this.map._showQueryGeometry,M=Br.createFromScreenPoints(i,g);for(const D in c){const z=rl(M,c[D],this._availableImages,g,A,this.getActualScope());Object.keys(z).length&&E.push(z)}if(this.placement)for(const D in c){if(!c[D].sourceCache._onlySymbols)continue;const z=Am(M.screenGeometry,c[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(z).length&&E.push(z)}return E}querySourceFeatures(i,c){const g=c&&c.filter;g&&this._validate(me,"querySourceFeatures.filter",g,null,c);let E=[];const A=this.getOwnSourceCaches(i);for(const M of A)E=E.concat(np(M,c));return E}addSourceType(i,c,g){return ha.getSourceType(i)?g(new Error(`A source type called "${i}" already exists.`)):(ha.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,c,g={}){this._checkLoaded();const E=this.light.getLight();let A=!1;for(const D in i)if(!a.by(i[D],E[D])){A=!0;break}if(!A)return;const M=this._getTransitionParameters();this.light.setLight(i,c,g),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,c=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=i;const E=!("source"in i)||i.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in g&&typeof g.source=="object"){const D="terrain-dem-src";this.addSource(D,g.source),g=a.dp(g),g=Object.assign(g,{source:D})}const A=Object.assign({},g),M={};if(this.terrain&&E){A.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(M.style=D.serialize())}if(this._validate(ga,"terrain",A,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new a.z("data",{dataType:"style"}))}else{const A=this.terrain,M=A.get();for(const D of Object.keys(a.a6.terrain))!g.hasOwnProperty(D)&&a.a6.terrain[D].default&&(g[D]=a.a6.terrain[D].default);for(const D in i)if(!a.by(i[D],M[D])){A.set(i,this.options),this.stylesheet.terrain=i;const z=this._getTransitionParameters({duration:0});A.updateTransitions(z),this.fire(new a.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const c=this.fog=new Pi(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_createSnow(i){const c=this.snow=new wn(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_createRain(i){const c=this.rain=new qr(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!a.by(c.get(),i)){c.set(i,this.options),this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!a.by(c.get(),i)){c.set(i,this.options),this.stylesheet.snow=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!a.by(c.get(),i)){c.set(i,this.options),this.stylesheet.rain=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void i();const g=this._evaluateColorThemeData(c);this._loadColorTheme(g).then(()=>{this.fire(new a.z("colorthemeset")),i()}).catch(E=>{a.w(`Couldn't set color theme: ${E}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,c){const g=this.getFragmentStyle(i);g&&(g._styleColorTheme.colorThemeOverride=c,g._reloadColorTheme())}_getTransitionParameters(i){return{now:a.o.now(),transition:Object.assign(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],c=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?i.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){const g=this.terrain=new It(i,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});g.updateTransitions(E)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="symbol"&&this._updateLayer(c)}}_validate(i,c,g,E,A={}){if(A&&A.validate===!1)return!1;const M=Object.assign({},this.serialize());return al(this,i.call(Tn,Object.assign({key:c,style:M,value:g,styleSpec:a.a6},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(i){const c=this.getSourceCaches(i);for(const g of c)g.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}clearLayers(){for(const i in this._mergedLayers){const c=this._mergedLayers[i];c._clear&&c._clear()}}reloadSource(i){const c=this.getSourceCaches(i);for(const g of c)g.resume(),g.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let c;this.directionalLight&&(c=Yd(this.directionalLight));const g=new Set,E=new Set;for(const A in this._mergedLayers){const M=this._mergedLayers[A];M.type==="building"&&g.add(M.source),M.hasElevation()&&!E.has(M.source)&&E.add(M.source)}for(const A in this._mergedSourceCaches){const M=this._mergedSourceCaches[A],D=E.has(M._source.id);g.has(M._source.id)&&(M._source.reparseOverscaled=!1),M.update(i,void 0,void 0,c,D)}}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new a.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new fp),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(i,c,g,E,A){this.pauseablePlacement||(this.pauseablePlacement=new fp);let M=!1,D=!1;const z={},U={};for(const ce of this._mergedOrder){const de=this._mergedLayers[ce];if(de.type!=="symbol")continue;const ge=a.B(de.source,de.scope);let Ce=z[ge];if(!Ce){const Ee=this.getLayerSourceCache(de);if(!Ee)continue;const Ge=Ee.getRenderableIds(!0).map(je=>Ee.getTileByID(je));U[ge]=Ge.slice(),Ce=z[ge]=Ge.sort((je,Ue)=>Ue.tileID.overscaledZ-je.tileID.overscaledZ||(je.tileID.isLessThan(Ue.tileID)?-1:1))}const Ae=this.crossTileSymbolIndex.addLayer(de,Ce,i.center.lng,i.projection);M=M||Ae}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const $=!!(this.placement&&!i.equals(this.placement.transform)),ie=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!A||this.placement.lastReplacementSourceUpdateTime!==A.updateTime)),K=$||ie||M,re=(K||this.pauseablePlacement.isStale())&&g===0,he=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.o.now(),i.zoom)&&g!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||re||he)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(i,this._mergedOrder,c,g,E,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?K&&g!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.o.now()),D=!0),M&&this.pauseablePlacement.setStale()),D||M){this._buildingIndex.onNewFrame(i.zoom);for(let ce=0;ce<this._mergedOrder.length;ce++){const de=this._mergedLayers[this._mergedOrder[ce]];if(de.type!=="symbol"||de.visibility==="none")continue;const ge=this.isLayerClipped(de);this.placement.updateLayerOpacities(de,z[a.B(de.source,de.scope)],ce,ge?A:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(a.o.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,c){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:A})=>A===i.id)!==-1)return void this.fire(new a.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!c)return g.push(i),this._loadImports([i],!0);const E=g.findIndex(({id:A})=>A===c);return E===-1&&this.fire(new a.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,E).concat(i).concat(g.slice(E)),this._loadImports([i],!0,c)}updateImport(i,c){this._checkLoaded();const g=this.stylesheet.imports||[],E=this.getImportIndex(i);return E===-1?this:typeof c=="string"?(this.setImportUrl(i,c),this):(c.url&&c.url!==g[E].url&&this.setImportUrl(i,c.url),a.by(c.config,g[E].config)||this.setImportConfig(i,c.config,c.data.schema),a.by(c.data,g[E].data)||this.setImportData(i,c.data),this)}moveImport(i,c){this._checkLoaded();let g=this.stylesheet.imports||[];const E=this.getImportIndex(i);if(E===-1)return this;const A=this.getImportIndex(c);if(A===-1)return this;const M=g[E],D=this.fragments[E];return g=g.filter(({id:z})=>z!==i),this.fragments=this.fragments.filter(({id:z})=>z!==i),this.stylesheet.imports=g.slice(0,A).concat(M).concat(g.slice(A)),this.fragments=this.fragments.slice(0,A).concat(D).concat(this.fragments.slice(A)),this.mergeLayers(),this}setImportUrl(i,c){this._checkLoaded();const g=this.stylesheet.imports||[],E=this.getImportIndex(i);if(E===-1)return this;g[E].url=c;const A=this.fragments[E];return A.style=this._createFragmentStyle(g[E]),A.style.on("style.import.load",()=>this.mergeAll()),A.style.loadURL(c),this}setImportData(i,c){this._checkLoaded();const g=this.getImportIndex(i),E=this.stylesheet.imports||[];return g===-1?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete E[g].data,this.setImportUrl(i,E[g].url))}setImportConfig(i,c,g){this._checkLoaded();const E=this.getImportIndex(i),A=this.stylesheet.imports||[];if(E===-1)return this;c?A[E].config=c:delete A[E].config;const M=this.fragments[E];g&&M.style.stylesheet&&(M.style.stylesheet.schema=g);const D=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=c,M.style.updateConfig(c,D),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(i);g!==-1&&(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(i){const c=(this.stylesheet.imports||[]).findIndex(g=>g.id===i);return c===-1&&this.fire(new a.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),c}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const c in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[c];g&&i.push(g.getSource())}return i}getSource(i,c){const g=this.getSourceCache(i,c);return g&&g.getSource()}getLayerSource(i){const c=this.getLayerSourceCache(i);return c&&c.getSource()}getSourceCache(i,c){const g=a.B(i,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(i){const c=a.B(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[i]&&c.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&c.push(this._mergedSymbolSourceCaches[i]),c}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const c in i){const g=i[c];g==="reload"?this.reloadSource(c):g==="clear"&&this.clearSource(c)}}updateLayers(i){const c=this._changes.getUpdatedPaintProperties();for(const g of c){const E=this.getLayer(g);E&&E.updateTransitions(i)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(i){this.stylesheet.glyphs=i,this.glyphManager.setURL(i)}getImages(i,c,g){this.imageManager.getImages(c.images,c.scope,g),this._updateTilesForChangedImages();const E=M=>{if(M){const D=c.images.map(z=>a.I.toString(z));M.setDependencies(c.tileID.key,c.type,D)}},A=a.B(c.source,c.scope);E(this._mergedOtherSourceCaches[A]),E(this._mergedSymbolSourceCaches[A]),c.images.some(M=>M.iconsetId)&&this.fire(new a.z("data",{dataType:"style"}))}rasterizeImages(i,c,g){this.imageManager.rasterizeImages(c,g)}getGlyphs(i,c,g){this.glyphManager.getGlyphs(c.stacks,g)}getResource(i,c,g){return a.dz(c,g)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}_isSourceCacheLoaded(i){const c=this.getOwnSourceCaches(i);return c.length===0?(this.fire(new a.y(new Error(`There is no source with ID '${i}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,c){if(!this._clipLayerPresent&&i.type!=="fill-extrusion"&&i.type!=="building")return!1;const g=i.type==="fill-extrusion"&&(i.sourceLayer==="building"||i.sourceLayer==="procedural_buildings"),E=i.type==="building";if(i.is3D(!!this.terrain)){if(g||E||c&&c.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ha.getSourceType=function(m){return Mo[m]},ha.setSourceType=function(m,i){Mo[m]=i},ha.registerForPluginStateChange=a.dA;var Qa=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gu=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ks=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ko="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Hh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Wc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,da=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Zc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,$t=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,tf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,$u=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ol=/#include\s+"([^"]+)"/g,ll=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,wa=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Ol=new Set(["ifdef","ifndef","elif","if","defined"]),Ea=new Set;Cs(Qa,Ea),Cs(Ks,Ea),Cs(Gu,Ea);const zl={"_prelude_fog.vertex.glsl":Wc,"_prelude_terrain.vertex.glsl":Hh,"_prelude_shadow.vertex.glsl":tf,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":da,"_prelude_shadow.fragment.glsl":$u,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Zc,"_prelude_raster_particle.glsl":$t},Xc={};Ji("",Hh),Ji(da,Wc),Ji($u,tf),Ji(Zc,""),Ji($t,"");const uc=Ji(Gu,Ks),Hu=Qa,Om=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Hu,uc.fragmentSource].join(`
`),rf=["precision highp float;",Hu,uc.vertexSource].join(`
`);var nf={background:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Ji(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ji("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ji(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ji("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ji("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ji(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ji(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ji(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ji(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ji(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ji("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ji("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ji(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ji(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ji("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ji(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ko),skyboxGradient:Ji(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ko),skyboxCapture:Ji(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ji(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ji(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ji("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ji("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ji("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ji("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Cs(m,i){const c=m.split(`
`);for(let g of c){if(g=g.trimStart(),g[0]!=="#"||!g.includes("if")||g.startsWith("#endif"))continue;const E=g.match(wa);if(E)for(const A of E)Ol.has(A)||i.add(A)}}function Ji(m,i){const c=new Set,g=[],E=[];m=m.replace(ol,(M,D)=>(E.push(D),"")),i=i.replace(ol,(M,D)=>(g.push(D),""));let A=new Set(Ea);Cs(m,A),Cs(i,A);for(const M of[...g,...E])Xc[M]||(Xc[M]=new Set,Cs(zl[M],Xc[M])),A=new Set([...A,...Xc[M]]);return{fragmentSource:m=m.replace(ll,(M,D,z,U,$)=>(c.add($),D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${z} ${U} ${$};
#else
uniform ${z} ${U} u_${$};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${$}
    ${z} ${U} ${$} = u_${$};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${z} ${U} ${$};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(ll,(M,D,z,U,$)=>{const ie=`MATERIAL_ATTRIBUTE_OFFSET_${$}`,K=U==="float"?"vec2":U,re=`GET_ATTRIBUTE_${K}(a_${$}, materialInfo, ${ie})`,he=$.match(/color/)?"color":K;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${$}
in ${z} ${U} a_${$};
#endif
`:c.has($)?D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
    #if !defined(${ie})
        in ${z} ${K} a_${$};
    #endif
out ${z} ${U} ${$};
#else
uniform ${z} ${U} u_${$};
#endif
`:D==="initialize"?he==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${z} ${U} ${$} = u_${$};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${$})
    #ifdef ${ie}
        ${$} = unpack_mix_${he}(${re}, u_${$}_t);
    #else
        ${$} = unpack_mix_${he}(a_${$}, u_${$}_t);
    #endif
#else
    ${z} ${U} ${$} = u_${$};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${z} ${U} a_${$};
    out ${z} ${U} ${$};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${$} = a_${$};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
    #if !defined(${ie})
        in ${z} ${K} a_${$};
    #endif
#else
uniform ${z} ${U} u_${$};
#endif
`:D==="define-instanced"?he==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${$}0;
in vec4 a_${$}1;
in vec4 a_${$}2;
in vec4 a_${$}3;
#else
uniform ${z} ${U} u_${$};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${K} a_${$};
#else
uniform ${z} ${U} u_${$};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${z} ${U} ${$} = a_${$};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    #ifdef ${ie}
        ${z} ${U} ${$} = ${re};
    #else
        ${z} ${U} ${$} = a_${$};
    #endif
#else
    ${z} ${U} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    #ifdef ${ie}
        ${z} ${U} ${$} = unpack_mix_${he}(${re}, u_${$}_t);
    #else
        ${z} ${U} ${$} = unpack_mix_${he}(a_${$}, u_${$}_t);
    #endif
#else
    ${z} ${U} ${$} = u_${$};
#endif
`}),usedDefines:A,vertexIncludes:g,fragmentIncludes:E}}class qu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,c,g,E,A,M,D,z){this.context=i;let U=this.boundPaintVertexBuffers.length!==E.length;for(let ie=0;!U&&ie<E.length;ie++)this.boundPaintVertexBuffers[ie]!==E[ie]&&(U=!0);let $=this.boundDynamicVertexBuffers.length!==D.length;for(let ie=0;!$&&ie<D.length;ie++)this.boundDynamicVertexBuffers[ie]!==D[ie]&&($=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||U||$||this.boundIndexBuffer!==A||this.boundVertexOffset!==M)this.freshBind(c,g,E,A,M,D,z);else{i.bindVertexArrayOES.set(this.vao);for(const ie of D)ie&&(ie.bind(),z&&ie.instanceCount&&ie.setVertexAttribDivisor(i.gl,c,z));A&&A.dynamicDraw&&A.bind()}}freshBind(i,c,g,E,A,M,D){const z=this.context,U=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=E,this.boundVertexOffset=A,this.boundDynamicVertexBuffers=M,c.enableAttributes(U,i),c.bind(),c.setVertexAttribPointers(U,i,A);for(const $ of g)$.enableAttributes(U,i),$.bind(),$.setVertexAttribPointers(U,i,A);for(const $ of M)$&&($.enableAttributes(U,i),$.bind(),$.setVertexAttribPointers(U,i,A),D&&$.instanceCount&&$.setVertexAttribDivisor(U,i,D));E&&E.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function sf(m,i){const c=Math.pow(2,i.canonical.z),g=i.canonical.y;return[new a.ae(0,g/c).toLngLat().lat,new a.ae(0,(g+1)/c).toLngLat().lat]}function qh(m,i,c,g,E,A,M){const D=m.context,z=D.gl,U=c.hillshadeFBO;if(!U)return;m.prepareDrawTile();const $=m.isTileAffectedByFog(i),ie=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&ie.push("USE_MRT1");const K=m.getOrCreateProgram("hillshade",{overrideFog:$,defines:ie});D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,U.colorAttachment0.get());const re=((ge,Ce,Ae,Ee)=>{const Ge=Ae.paint.get("hillshade-shadow-color"),je=Ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ue=Ae.paint.get("hillshade-highlight-color"),ze=Ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Pe=Ae.paint.get("hillshade-accent-color"),We=Ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Xe=Ae.paint.get("hillshade-emissive-strength");let Qe=a.an(Ae.paint.get("hillshade-illumination-direction"));if(Ae.paint.get("hillshade-illumination-anchor")==="viewport")Qe-=ge.transform.angle;else if(ge.style&&ge.style.enable3dLights()&&ge.style.directionalLight){const tt=ge.style.directionalLight.properties.get("direction"),pt=a.d4(tt.x,tt.y,tt.z);Qe=a.an(pt[1])}const rt=!ge.options.moving;return{u_matrix:Ee||ge.transform.calculateProjMatrix(Ce.tileID.toUnwrapped(),rt),u_image:0,u_latrange:sf(0,Ce.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Qe],u_shadow:Ge.toPremultipliedRenderColor(je?null:Ae.lut),u_highlight:Ue.toPremultipliedRenderColor(ze?null:Ae.lut),u_emissive_strength:Xe,u_accent:Pe.toPremultipliedRenderColor(We?null:Ae.lut)}})(m,c,g,m.terrain?i.projMatrix:null);m.uploadCommonUniforms(D,K,i.toUnwrapped());const{tileBoundsBuffer:he,tileBoundsIndexBuffer:ce,tileBoundsSegments:de}=m.getTileBoundsBuffers(c);K.draw(m,z.TRIANGLES,E,A,M,Si.disabled,re,g.id,he,ce,de)}function Oa(m,i,c){if(!i.needsDEMTextureUpload)return;const g=m.context,E=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||m.getTileTexture(c.stride);const A=c.getPixels();i.demTexture?i.demTexture.update(A,{premultiply:!1}):i.demTexture=new a.T(g,A,E.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function yo(m,i,c){const g=m.context,E=g.gl;if(!i.dem)return;const A=i.dem;if(g.activeTexture.set(E.TEXTURE1),Oa(m,i,A),!i.demTexture)return;i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const M=A.dim;g.activeTexture.set(E.TEXTURE0);let D=i.hillshadeFBO;if(!D){const K=new a.T(g,{width:M,height:M,data:null},E.RGBA8);K.bind(E.LINEAR,E.CLAMP_TO_EDGE),D=i.hillshadeFBO=g.createFramebuffer(M,M,1,"renderbuffer"),D.colorAttachment0.set(K.texture)}g.bindFramebuffer.set(D.framebuffer),g.viewport.set([0,0,M,M]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=m.getMercatorTileBoundsBuffers(),ie=[];m.linearFloatFilteringSupported()&&ie.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&ie.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:ie}).draw(m,E.TRIANGLES,fi.disabled,Mi.disabled,Ii.unblended,Si.disabled,((K,re)=>{const he=re.stride,ce=a.bC();return a.ce(ce,0,a.al,-a.al,0,0,1),a.br(ce,ce,[0,-a.al,0]),{u_matrix:ce,u_image:1,u_dimension:[he,he],u_zoom:K.overscaledZ}})(i.tileID,A),c.id,z,U,$),i.needsHillshadePrepare=!1}class Mr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cl extends Mr{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Lo extends Mr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Oo extends Mr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Wh extends Mr{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Zh extends Mr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Fl extends Mr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Yc extends Mr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class us extends Mr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class mn extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class Gr extends Mr{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ul extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class Ja extends Mr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class hc extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class zo extends Mr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Xh extends Mr{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class af extends Mr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Bl extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class Fo extends Mr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class of extends Mr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Wu=class extends Mr{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class lf extends Mr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class _o extends Mr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class hl extends Mr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class dc extends Mr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class jl extends Mr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class yp extends Mr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Yh extends Mr{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class fc extends Mr{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class Zu extends Mr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Nl extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class js extends Mr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Kc extends Mr{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Kh extends Kc{constructor(i,c,g=0){super(i,c),this.attachmentPoint=i.gl.COLOR_ATTACHMENT0+g}setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Xu extends Kc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Qh extends Kc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class zm extends Xu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const en=(m,i,c,g)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:i,u_ground_shadow_factor:c,u_emissive_texture_available:g}),Yu=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:E,u_merc_center:A,u_image0:0,u_image1:1,u_frustum_tl:M,u_frustum_tr:D,u_frustum_br:z,u_frustum_bl:U,u_globe_pos:$,u_globe_radius:ie,u_viewport:K,u_grid_matrix:de?Float32Array.from(de):new Float32Array(9),u_skirt_height:re,u_far_z_cutoff:he,u_emissive_texture_available:ce});function Vl(m,i){return m!=null&&i!=null&&!(!m.hasData()||!i.hasData())&&m.demTexture!=null&&i.demTexture!=null&&m.tileID.key!==i.tileID.key}const eo=new class{constructor(){this.operations={}}newMorphing(m,i,c,g,E){if(m in this.operations){const A=this.operations[m];A.to.tileID.key!==c.tileID.key&&(A.queued=c)}else this.operations[m]={startTime:g,phase:0,duration:E,from:i,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const i=this.operations[m];return{from:i.from,to:i.to,phase:i.phase}}update(m){for(const i in this.operations){const c=this.operations[i];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[i];break}}}_nextOp(m,i){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=i,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Ku={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ul(m,i,c){if(i===0)return 0;const g=i<1&&c===514?.25/i:1;return 6*Math.pow(1.5,22-m)*Math.max(i,1)*g}function pc(m,i){const c=1<<m.z;return!i&&(m.x===0||m.x===c-1)||m.y===0||m.y===c-1}function Qu(m,i){if(!m.style||!m.style.enable3dLights())return;const c=m.context,g=c.gl;c.activeTexture.set(g.TEXTURE1),i?i.bind(g.LINEAR,g.CLAMP_TO_EDGE):m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}const Ju=m=>({u_matrix:m});function Jh(m,i,c,g,E){if(E>0){const A=a.o.now(),M=(A-m.timeAdded)/E,D=i?(A-i.timeAdded)/E:-1,z=c.getSource(),U=g.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),$=!i||Math.abs(i.tileID.overscaledZ-U)>Math.abs(m.tileID.overscaledZ-U),ie=$&&m.refreshedUponExpiration?1:a.aA($?M:1-D,0,1);return i?{opacity:1,mix:1-ie,isFading:M<1}:{opacity:ie,mix:0,isFading:M<1}}return{opacity:1,mix:0,isFading:!1}}class ed extends Kn{constructor(i){const c=co("mock-dem",{type:"raster-dem",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class Gl extends Kn{constructor(i){const c=co("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,g){if(i.freezeTileCoverage)return;this.transform=i;const E=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,M)=>{if(A[M.key]="",!this._tiles[M.key]){const D=new Cl(M,this._source.tileSize*M.overscaleFactor(),i.tileZoom,void 0,void 0,this._source.worldview);D.state="loaded",this._tiles[M.key]=D}return A},{});for(const A in this._tiles)A in E||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(i){const c=this.proxyCachedFBO[i];if(c!==void 0){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class td extends a.aQ{constructor(i,c,g){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class eh extends a.bV{constructor(i,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,E,A]=(function(){const z=new a.bd,U=new a.b0,$=131;z.reserve(17161),U.reserve(33800);const ie=a.al/128,K=a.al+ie/2,re=K+ie;for(let ce=-ie;ce<re;ce+=ie)for(let de=-ie;de<re;de+=ie){const ge=de<0||de>K||ce<0||ce>K?24575:0,Ce=a.aA(Math.round(de),0,a.al),Ae=a.aA(Math.round(ce),0,a.al);z.emplaceBack(Ce+ge,Ae)}const he=(ce,de)=>{const ge=de*$+ce;U.emplaceBack(ge+1,ge,ge+$),U.emplaceBack(ge+$,ge+$+1,ge+1)};for(let ce=1;ce<129;ce++)for(let de=1;de<129;de++)he(de,ce);return[0,129].forEach(ce=>{for(let de=0;de<130;de++)he(de,ce),he(ce,de)}),[z,U,32768]})(),M=i.context;this.gridBuffer=M.createVertexBuffer(g,a.bf.members),this.gridIndexBuffer=M.createIndexBuffer(E),this.gridSegments=a.bg.simpleSegment(0,0,g.length,E.length),this.gridNoSkirtSegments=a.bg.simpleSegment(0,0,g.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gl(c.map),this.orthoMatrix=a.bC(),a.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.al,0,a.al,0,1);const D=M.gl;this._overlapStencilMode=new Mi({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ed(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,c,g){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const E=i.terrain.properties,A=i.terrain.drapeRenderMode===0,M=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.o.now();const D=i.terrain&&i.terrain.scope,z=E.get("source"),U=A?this._mockSourceCache:i.getSourceCache(z,D);if(!U)return void a.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=U,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=M?this.calculateExaggeration(c):E.get("exaggeration"),!c.projection.requiresDraping&&M&&this._exaggeration===0)return void this._disable();this.enabled=!0;const $=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ie=this.getScaledDemTileSize();this.sourceCache.update(c,ie,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,$(),this._initializing=!0),$(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const c=this._previousCameraAltitude,g=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=g;const E=c!=null?g-c:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const A=i.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(A);let D=A-this._previousZoom;const z=this._previousUpdateTimestamp;let U=A;this._evaluationZoom!=null&&(U=this._evaluationZoom,Math.abs(A-U)>.5&&(D=.5*(A-U+D)),D*E<0&&(U+=D)),this._evaluationZoom=U;const $=M.getExaggeration(U),ie=$===M.getExaggeration(Math.max(0,U-.1));if(ie&&Math.abs($-this._exaggeration)<.01)return $;let K=Math.min(.1,.00375*(this._updateTimestamp-z));return(ie||$<.1||Math.abs(D)<1e-4)&&(K=Math.min(.2,4*K)),a.ak(this._exaggeration,$,K)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.dataType==="source"&&i.coord?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(a.ae.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=c.getIds().map(z=>{const U=c.getTileByID(z).tileID;return U.projMatrix=g.calculateProjMatrix(U.toUnwrapped()),U});(function(z,U){const $=U.transform.pointCoordinate(U.transform.getCameraPoint()),ie=new a.P($.x,$.y);z.sort((K,re)=>{if(re.overscaledZ-K.overscaledZ)return re.overscaledZ-K.overscaledZ;const he=new a.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ce=new a.P(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),de=ie.mult(1<<K.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(he)-de.distSqr(ce)})})(E,this.painter);const A=this.proxyToSource||{};this.proxyToSource={},E.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const z in M){const U=M[z];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,i[z],A),U.usedForTerrain))continue;const $=i[z];U.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[c.id]=E.map(z=>new td(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const U=this.terrainTileForTile[z.key];if(!U)continue;const $=U.tileID.key;$ in D||(this._visibleDemTiles.push(U),D[$]=$)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const g in this.terrainTileForTile){const E=this.terrainTileForTile[g],A=E.dem;!A||E.demTexture&&!E.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),Oa(this.painter,E,A))}}_prepareDemTileUniforms(i,c,g,E){if(!c||c.demTexture==null)return!1;const A=i.tileID.canonical,M=Math.pow(2,c.tileID.canonical.z-A.z),D=E||"";return g[`u_dem_tl${D}`]=[A.x*M%1,A.y*M%1],g[`u_dem_scale${D}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const c=this._visibleDemTiles.reduce((g,E)=>{if(!E.dem)return g;const A=E.dem.tree.minimums[0];return A>0&&i++,g+A},0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),E=new a.dL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(E,{premultiply:!1}):A=this._emptyDEMTexture=new a.T(i,E,c.R32F,{premultiply:!1}),A}setupElevationDraw(i,c,g){const E=this.painter.context,A=E.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};M.u_exaggeration=this.exaggeration();let D=null,z=null,U=1;if(g&&g.morphing&&this._useVertexMorphing){const re=g.morphing.srcDemTile,he=g.morphing.dstDemTile;U=g.morphing.phase,re&&he&&(this._prepareDemTileUniforms(i,re,M,"_prev")&&(z=re),this._prepareDemTileUniforms(i,he,M)&&(D=he))}const $=re=>re&&re.demTexture&&this.painter.linearFloatFilteringSupported()?A.LINEAR:A.NEAREST;let ie=null;var K;if(this.enabled?z&&D?(ie=D.demTexture,E.activeTexture.set(A.TEXTURE4),z.demTexture.bind($(z),A.CLAMP_TO_EDGE),M.u_dem_lerp=U):(D=this.terrainTileForTile[i.tileID.key],ie=this._prepareDemTileUniforms(i,D,M)?D.demTexture:this.emptyDEMTexture):ie=this.emptyDEMTexture,E.activeTexture.set(A.TEXTURE2),ie&&(M.u_dem_size=(K=ie).size[0]===1?1:K.size[0]-2,ie.bind($(D),A.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,c,M),g&&g.useMeterToDem&&D){const re=(1<<D.tileID.canonical.z)*a.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=re}if(g&&g.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(E,M),this.painter.transform.projection.name==="globe"){const re=this.globeUniformValues(this.painter.transform,i.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(E,re)}}globeUniformValues(i,c,g){const E=i.projection;return{u_tile_tl_up:E.upVector(c,0,0),u_tile_tr_up:E.upVector(c,a.al,0),u_tile_br_up:E.upVector(c,a.al,a.al),u_tile_bl_up:E.upVector(c,0,a.al),u_tile_up_scale:g?a.dM(1):E.upVectorScale(c,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const c=this.painter,g=this.painter.context;i.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(E,A,M,D,z){if(E.transform.projection.name==="globe")(function(U,$,ie,K,re){const he=U.context,ce=he.gl;let de,ge;const Ce=U.transform,Ae=a.dE(U,he,Ce),Ee=(rt,tt)=>{if(ge===tt)return;const pt=[Ku[tt],"PROJECTION_GLOBE_VIEW"];Ae&&pt.push("CUSTOM_ANTIALIASING");const wt=U.isTileAffectedByFog(rt);de=U.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:wt}),ge=tt},Ge=U.colorModeForRenderPass(),je=new fi(ce.LEQUAL,fi.ReadWrite,U.depthRangeFor3D);eo.update(re);const Ue=a.dF(Ce),ze=[a.aF(Ce.center.lng),a.aJ(Ce.center.lat)],Pe=U.globeSharedBuffers,We=[Ce.width*a.o.devicePixelRatio,Ce.height*a.o.devicePixelRatio],Xe=Float32Array.from(Ce.globeMatrix),Qe={useDenormalizedUpVectorScale:!0};{const rt=U.transform,tt=Ul(rt.zoom,$.exaggeration(),$.sourceCache._source.tileSize);ge=-1;const pt=ce.TRIANGLES;for(const wt of K){const nt=ie.getTile(wt),Ze=Mi.disabled,_t=$.prevTerrainTileForTile[wt.key],ot=$.terrainTileForTile[wt.key];Vl(_t,ot)&&eo.newMorphing(wt.key,_t,ot,re,250),Qu(U,nt.emissiveTexture),he.activeTexture.set(ce.TEXTURE0),nt.texture&&nt.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const bt=eo.getMorphValuesForProxy(wt.key),Lt=bt?1:0;bt&&Object.assign(Qe,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:a.dD(bt.phase)}});const Wt=a.dG(wt.canonical),jt=a.dH(Wt.getCenter().lat),zt=a.dI(wt.canonical,Wt,jt,rt.worldSize/rt._pixelsPerMercatorPixel),hi=a.bk(a.dJ(wt.canonical)),ai=U.emissiveMode==="mrt-fallback"?1:0,Xt=Yu(rt.expandedFarZProjMatrix,Xe,Ue,hi,a.aj(rt.zoom),ze,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,We,tt,rt._farZ,ai,zt);if(Ee(wt,Lt),de&&($.setupElevationDraw(nt,de,Qe),U.uploadCommonUniforms(he,de,wt.toUnwrapped()),Pe)){const[oi,_i,Ti]=Pe.getGridBuffers(jt,tt!==0);de.draw(U,pt,je,Ze,Ge,Si.backCCW,Xt,"globe_raster",oi,_i,Ti)}}}if(Pe&&(U.renderDefaultNorthPole||U.renderDefaultSouthPole)){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ae&&rt.push("CUSTOM_ANTIALIASING"),de=U.getOrCreateProgram("globeRaster",{defines:rt});for(const tt of K){const{x:pt,y:wt,z:nt}=tt.canonical,Ze=wt===0,_t=wt===(1<<nt)-1,[ot,bt,Lt,Wt]=Pe.getPoleBuffers(nt,!1);if(Wt&&(Ze||_t)){const jt=ie.getTile(tt);Qu(U,jt.emissiveTexture),he.activeTexture.set(ce.TEXTURE0),jt.texture&&jt.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let zt=a.dK(nt,pt,Ce);const hi=a.bk(a.dJ(tt.canonical)),ai=U.emissiveMode==="mrt-fallback"?1:0,Xt=(oi,_i)=>oi.draw(U,ce.TRIANGLES,je,Mi.disabled,Ge,Si.disabled,Yu(Ce.expandedFarZProjMatrix,zt,zt,hi,0,ze,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,We,0,Ce._farZ,ai),"globe_pole_raster",_i,Lt,Wt);$.setupElevationDraw(jt,de,Qe),U.uploadCommonUniforms(he,de,tt.toUnwrapped()),Ze&&U.renderDefaultNorthPole&&Xt(de,ot),_t&&U.renderDefaultSouthPole&&(zt=a.cS(a.bC(),zt,[1,-1,1]),Xt(de,bt))}}}})(E,A,M,D,z);else{const U=E.context,$=U.gl;let ie,K;const re=E.shadowRenderer,he=Ya(E,E.longestCutoffRange),ce=Ge=>{if(K===Ge)return;const je=[];je.push(Ku[Ge]),he.shouldRenderCutoff&&je.push("RENDER_CUTOFF"),re&&(je.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&je.push("NORMAL_OFFSET")),ie=E.getOrCreateProgram("terrainRaster",{defines:je}),K=Ge},de=E.colorModeForRenderPass(),ge=new fi($.LEQUAL,fi.ReadWrite,E.depthRangeFor3D);eo.update(z);const Ce=E.transform,Ae=Ul(Ce.zoom,A.exaggeration(),A.sourceCache._source.tileSize);let Ee=[0,0,0];if(re){const Ge=E.style.directionalLight,je=E.style.ambientLight;Ge&&je&&(Ee=ua(E.style,Ge,je))}{K=-1;const Ge=$.TRIANGLES,[je,Ue]=[A.gridIndexBuffer,A.gridSegments];for(const ze of D){const Pe=M.getTile(ze),We=Mi.disabled,Xe=A.prevTerrainTileForTile[ze.key],Qe=A.terrainTileForTile[ze.key];Vl(Xe,Qe)&&eo.newMorphing(ze.key,Xe,Qe,z,250),Qu(E,Pe.emissiveTexture),U.activeTexture.set($.TEXTURE0),Pe.texture&&Pe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const rt=eo.getMorphValuesForProxy(ze.key),tt=rt?1:0;let pt;rt&&(pt={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:a.dD(rt.phase)}});const wt=E.emissiveMode==="mrt-fallback"?1:0,nt=en(ze.projMatrix,pc(ze.canonical,Ce.renderWorldCopies)?Ae/10:Ae,Ee,wt);if(ce(tt),!ie)continue;A.setupElevationDraw(Pe,ie,pt);const Ze=ze.toUnwrapped();re&&re.setupShadows(Ze,ie),E.uploadCommonUniforms(U,ie,Ze,null,he),ie.draw(E,Ge,ge,We,de,Si.backCCW,nt,"terrain_raster",A.gridBuffer,je,Ue)}}}})(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,E=this.proxySourceCache,A=this.proxiedCoords[E.id],M=this._drapedRenderBatches.shift(),D=c.style.order,z=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let U=0;for(const $ of A){const ie=E.getTileByID($.proxyTileKey),K=E.proxyCachedFBO[$.key]?E.proxyCachedFBO[$.key][i]:void 0,re=K!==void 0?E.renderCache[K]:this.pool[U++],he=K!==void 0;if(ie.texture=re.tex,ie.emissiveTexture=re.emissiveTex,he&&!re.dirty){z.push(ie.tileID);continue}g.bindFramebuffer.set(re.fb.framebuffer);const ce=g.gl;let de;ce.drawBuffers(c.emissiveMode==="mrt-fallback"?[ce.COLOR_ATTACHMENT0,ce.COLOR_ATTACHMENT1]:[ce.COLOR_ATTACHMENT0]),this.renderedToTile=!1,re.dirty&&(g.clear({color:a.ao.transparent,stencil:0}),re.dirty=!1);for(let ge=M.start;ge<=M.end;++ge){const Ce=c.style._mergedLayers[D[ge]];if(Ce.isHidden(c.transform.zoom))continue;const Ae=c.style.getLayerSourceCache(Ce),Ee=Ae?this.proxyToSource[$.key][Ae.id]:[$];if(!Ee)continue;const Ge=Ee;g.viewport.set([0,0,re.fb.width,re.fb.height]),de!==(Ae?Ae.id:null)&&(this._setupStencil(re,Ee,Ce,Ae),de=Ae?Ae.id:null),c.renderLayer(c,Ae,Ce,Ge)}if(ce.drawBuffers([ce.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ge of this._pendingGroundEffectLayers){const Ce=c.style._mergedLayers[D[ge]];if(Ce.isHidden(c.transform.zoom))continue;const Ae=c.style.getLayerSourceCache(Ce),Ee=Ae?this.proxyToSource[$.key][Ae.id]:[$];if(!Ee)continue;const Ge=Ee;g.viewport.set([0,0,re.fb.width,re.fb.height]),de!==(Ae?Ae.id:null)&&(this._setupStencil(re,Ee,Ce,Ae),de=Ae?Ae.id:null),c.renderLayer(c,Ae,Ce,Ge)}this.renderedToTile?(re.dirty=!0,z.push(ie.tileID)):he||--U,U===5&&(U=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),M.end+1}postRender(){}isLayerOrderingCorrect(i){const c=i.order.length;let g=-1,E=c;for(let A=0;A<c;++A)this._style.isLayerDraped(i._mergedLayers[i.order[A]])?g=Math.max(g,A):E=Math.min(E,A);return E>g}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,c,g){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const M=A.tileID,D=1<<M.overscaledZ,{x:z,y:U}=M.canonical,$=z/D,ie=(z+1)/D,K=U/D,re=(U+1)/D;return{minx:$,miny:K,maxx:ie,maxy:re,t:A.dem.tree.raycastRoot($,K,ie,re,i,c,g),tile:A}});E.sort((A,M)=>(A.t!==null?A.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const A of E){if(A.t==null)return null;const M=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,i,c,g);if(M!=null)return M}return null}_createFBO(){const i=this.painter.context,c=i.gl,g=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const E=new a.T(i,{width:g[0],height:g[1],data:null},c.RGBA8);E.bind(c.LINEAR,c.CLAMP_TO_EDGE);const A=i.createFramebuffer(g[0],g[1],1,null);let M;return A.colorAttachment0.set(E.texture),this._emissiveTexture&&(M=new a.T(i,{width:g[0],height:g[1],data:null},c.R8),M.bind(c.LINEAR,c.CLAMP_TO_EDGE),A.createColorAttachment(i,1),A.colorAttachment1.set(M.texture)),A.depthAttachment=new zm(i,A.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:A,tex:E,emissiveTex:M,dirty:!1}}_updateFBOs(i){if(this._emissiveTexture!==i){for(const c of this.pool)this._updateFBO(c,i);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,i);this._emissiveTexture=i}}_updateFBO(i,c){const g=i.fb,E=this.painter.context,A=E.gl,M=this.drapeBufferSize;if(c){const D=new a.T(E,{width:M[0],height:M[1],data:null},A.R8);D.bind(A.LINEAR,A.CLAMP_TO_EDGE),i.emissiveTex=D,g.createColorAttachment(E,1),g.colorAttachment1.set(D.texture)}else i.emissiveTex=void 0,g.removeColorAttachment(E,1);i.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const c=this._style._mergedLayers[i],g=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const g of this._style.getSources())if(g instanceof lo){i=!0;break}if(!i)return;const c={};for(let g=0;g<this._style.order.length;++g){const E=this._style._mergedLayers[this._style.order[g]],A=this._style.getLayerSourceCache(E);if(!A||c[A.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="line")continue;const M=E.widthExpression(),D=E.emissiveStrengthExpression();if(M instanceof a.ad||D instanceof a.ad){c[A.id]=!0;for(const z of this.proxyCoords){const U=this.proxyToSource[z.key][A.id];if(U)for(const $ of U)this._clearRenderCacheForTile(A.id,$)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof ts){i=!0;break}if(!i)return;const c={};for(let g=0;g<this._style.order.length;++g){const E=this._style._mergedLayers[this._style.order[g]],A=this._style.getLayerSourceCache(E);if(!A||c[A.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const M=E.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const z=this.proxyToSource[D.key][A.id];if(z)for(const U of z){const $=Jh(A.getTile(U),A.findLoadedParent(U,0),A,this.painter.transform,M);($.opacity!==1||$.mix!==0)&&this._clearRenderCacheForTile(A.id,U)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,c=i.length;if(c===0)return;const g=[];this._pendingGroundEffectLayers=[];let E,A=0,M=this._style._mergedLayers[i[A]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++A<c;)M=this._style._mergedLayers[i[A]];for(;A<c;++A){const D=this._style._mergedLayers[i[A]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?E===void 0&&(E=A):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(A),E!==void 0&&(g.push({start:E,end:A-1}),E=void 0)))}if(E!==void 0&&g.push({start:E,end:A-1}),g.length!==0){const D=g[g.length-1];this._pendingGroundEffectLayers.every(z=>z>D.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const M=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let D=0;D<M.length;++D){const z=Object.values(M[D]);c.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,E=this._tilesDirty;for(let M=g.length-1;M>=0;M--){const D=g[M];if(c.getTileByID(D.key),c.proxyCachedFBO[D.key]!==void 0){const z=i[D.key],U=this.proxyToSource[D.key];let $=0;for(const ie in U){const K=U[ie],re=z[ie];if(!re||re.length!==K.length||K.some((he,ce)=>he!==re[ce]||E[ie]&&E[ie].hasOwnProperty(he.key))){$=-1;break}++$}for(const ie in c.proxyCachedFBO[D.key])c.renderCache[c.proxyCachedFBO[D.key][ie]].dirty=$<0||$!==Object.values(z).length}}const A=[...this._drapedRenderBatches];A.sort((M,D)=>D.end-D.start-(M.end-M.start));for(const M of A)for(const D of g){if(c.proxyCachedFBO[D.key])continue;let z=c.renderCachePool.pop();z===void 0&&c.renderCache.length<50&&(z=c.renderCache.length,c.renderCache.push(this._createFBO())),z!==void 0&&(c.proxyCachedFBO[D.key]={},c.proxyCachedFBO[D.key][M.start]=z,c.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,g,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,M=A.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let D;if(g.isTileClipped())D=c.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):Mi.disabled}_renderTileClippingMasks(i,c){const g=this.painter,E=this.painter.context,A=E.gl;g._tileClippingMaskIDs={},E.setColorMode(Ii.disabled),E.setDepthMode(fi.disabled);const M=g.getOrCreateProgram("clippingMask");for(const D of i){const z=g._tileClippingMaskIDs[D.key]=--c;M.draw(g,A.TRIANGLES,fi.disabled,new Mi({func:A.ALWAYS,mask:0},z,255,A.KEEP,A.KEEP,A.REPLACE),Ii.disabled,Si.disabled,Ju(D.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const g=[i.x,i.y,1,1];a.aC(g,g,c.pixelMatrixInverse),a.cK(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const E=c._camera.position,A=a.cf(1,c.center.lat),M=[E[0],E[1],E[2]/A,0],D=a.da([],g.slice(0,3),M);a.aw(D,D);const z=this.raycast(M,D,this._exaggeration);return z!==null&&z?(a.bH(M,M,D,z),M[3]=M[2],M[2]*=A,M):null}_setupProxiedCoordsForOrtho(i,c,g){if(i.getSource()instanceof a.aU)return this._setupProxiedCoordsForImageSource(i,c,g);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const E=this.proxiedCoords[i.id]=[],A=this.proxyCoords;for(let z=0;z<A.length;z++){const U=A[z],$=this._findTileCoveringTileID(U,i);if($){const ie=this._createProxiedId(U,$,g[U.key]&&g[U.key][i.id]);E.push(ie),this.proxyToSource[U.key][i.id]=[ie]}}let M=!1;const D=new Set;for(let z=0;z<c.length;z++){const U=i.getTile(c[z]);if(!U||!U.hasData())continue;const $=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==U.tileID.canonical.z){const ie=this.proxyToSource[$.tileID.key][i.id],K=this._createProxiedId($.tileID,U,g[$.tileID.key]&&g[$.tileID.key][i.id]);ie?ie.splice(ie.length-1,0,K):this.proxyToSource[$.tileID.key][i.id]=[K];const re=this.proxyToSource[$.tileID.key][i.id];D.has(re)||D.add(re),E.push(K),M=!0}}if(this._sourceTilesOverlap[i.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const z of D)z.sort((U,$)=>$.overscaledZ-U.overscaledZ)}_setupProxiedCoordsForImageSource(i,c,g){if(!i.getSource().loaded())return;const E=this.proxiedCoords[i.id]=[],A=this.proxyCoords,M=i.getSource(),D=M.tileID;if(!D)return;const z=new a.P(D.x,D.y)._div(1<<D.z),U=M.coordinates.map(a.ae.fromLngLat).reduce((ie,K)=>(ie.min.x=Math.min(ie.min.x,K.x-z.x),ie.min.y=Math.min(ie.min.y,K.y-z.y),ie.max.x=Math.max(ie.max.x,K.x-z.x),ie.max.y=Math.max(ie.max.y,K.y-z.y),ie),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(ie,K)=>{const re=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),he=ie.canonical.y/(1<<ie.canonical.z),ce=a.al/(1<<ie.canonical.z),de=K.wrap+K.canonical.x/(1<<K.canonical.z),ge=K.canonical.y/(1<<K.canonical.z);return re+ce<de+U.min.x||re>de+U.max.x||he+ce<ge+U.min.y||he>ge+U.max.y};for(let ie=0;ie<A.length;ie++){const K=A[ie];for(let re=0;re<c.length;re++){const he=i.getTile(c[re]);if(!he||!he.hasData()||$(K,he.tileID))continue;const ce=this._createProxiedId(K,he,g[K.key]&&g[K.key][i.id]),de=this.proxyToSource[K.key][i.id];de?de.push(ce):this.proxyToSource[K.key][i.id]=[ce],E.push(ce)}}}_createProxiedId(i,c,g){let E=this.orthoMatrix;if(g){const A=g.find(M=>M.key===c.tileID.key);if(A)return A}if(c.tileID.key!==i.key){const A=i.canonical.z-c.tileID.canonical.z;let M,D,z;E=a.bC();const U=c.tileID.wrap-i.wrap<<i.overscaledZ;A>0?(M=a.al>>A,D=M*((c.tileID.canonical.x<<A)-i.canonical.x+U),z=M*((c.tileID.canonical.y<<A)-i.canonical.y)):(M=a.al<<-A,D=a.al*(c.tileID.canonical.x-(i.canonical.x+U<<-A)),z=a.al*(c.tileID.canonical.y-(i.canonical.y<<-A))),a.ce(E,0,M,0,M,0,1),a.br(E,E,[D,z,0])}return new td(c.tileID,i.key,E)}_findTileCoveringTileID(i,c){let g=c.getTile(i);if(g&&g.hasData())return g;const E=this._findCoveringTileCache[c.id],A=E[i.key];if(g=A?c.getTileByID(A):null,g&&g.hasData()||A===null)return g;let M=g?g.tileID:i,D=M.overscaledZ;const z=c.getSource().minzoom,U=[];if(!A){const ie=c.getSource().maxzoom;if(i.canonical.z>=ie){const K=i.canonical.z-ie;c.getSource().reparseOverscaled?(D=Math.max(i.canonical.z+2,c.transform.tileZoom),M=new a.aQ(D,i.wrap,ie,i.canonical.x>>K,i.canonical.y>>K)):K!==0&&(D=ie,M=new a.aQ(D,i.wrap,ie,i.canonical.x>>K,i.canonical.y>>K))}M.key!==i.key&&(U.push(M.key),g=c.getTile(M))}const $=ie=>{U.forEach(K=>{E[K]=ie}),U.length=0};for(D-=1;D>=z&&(!g||!g.hasData());D--){g&&$(g.tileID.key);const ie=M.calculateScaledKey(D);if(g=c.getTileByID(ie),g&&g.hasData())break;const K=E[ie];if(K===null)break;K===void 0?U.push(ie):g=c.getTileByID(K)}return $(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let g=this._tilesDirty[i];g||(g=this._tilesDirty[i]={}),g[c.key]=!0}}function Qc(m,i,c){const g=(function(D,z,U){const $=a.bJ(z,D),ie=a.bJ(U,[.2126,.7152,.0722]),K=(he,ce,de)=>(1-de)*he+de*ce,re=K(1-.3*Math.min(ie,1),1,Math.min($+1,1));return K(.92,1,Math.asin(a.aA(z[2],-1,1))/Math.PI+.5)*re})(m,[0,0,1],i),E=[0,0,0];a.c5(E,c.slice(0,3),g);const A=[0,0,0];a.c5(A,i.slice(0,3),m[2]);const M=[0,0,0];return a.d8(M,E,A),a.db(M)}const th=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],_p=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class rd{static cacheKey(i,c,g,E){const A=[c];E&&A.push(E.cacheKey);for(const M of g)i.usedDefines.has(M)&&A.push(M);return A.join("/")}constructor(i,c,g,E,A,M){const D=i.gl;this.program=D.createProgram(),this.configuration=E,this.name=c,this.fixedDefines=[...M];const z=`#version 300 es
${(E?E.defines():[]).concat(M.map(ce=>`#define ${ce}`)).join(`
`)}`,U=[z,Om];for(const ce of g.fragmentIncludes)U.push(zl[ce]);U.push(g.fragmentSource);const $=U.join(`
`),ie=[z,rf];for(const ce of g.vertexIncludes)ie.push(zl[ce]);this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&g.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&ie.push("uniform int u_instanceID;"),ie.push(g.vertexSource);let K=ie.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(K=K.replaceAll("gl_InstanceID","u_instanceID"));const re=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(re,$),D.compileShader(re),D.attachShader(this.program,re);const he=D.createShader(D.VERTEX_SHADER);D.isContextLost()?this.failedToCreate=!0:(D.shaderSource(he,K),D.compileShader(he),D.attachShader(this.program,he),this.attributes={},D.linkProgram(this.program),D.deleteShader(he),D.deleteShader(re),this.fixedUniforms=A(i),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=E?E.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ce=>({u_instanceID:new a.ch(ce)}))(i)),(M.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(ce=>({u_dem:new a.ch(ce),u_dem_prev:new a.ch(ce),u_dem_tl:new a.ck(ce),u_dem_scale:new a.cj(ce),u_dem_tl_prev:new a.ck(ce),u_dem_scale_prev:new a.cj(ce),u_dem_size:new a.cj(ce),u_dem_lerp:new a.cj(ce),u_exaggeration:new a.cj(ce),u_depth:new a.ch(ce),u_depth_size_inv:new a.ck(ce),u_depth_range_unpack:new a.ck(ce),u_occluder_half_size:new a.cj(ce),u_occlusion_depth_offset:new a.cj(ce),u_meter_to_dem:new a.cj(ce),u_label_plane_matrix_inv:new a.cl(ce)}))(i)),M.includes("GLOBE")&&(this.globeUniforms=(ce=>({u_tile_tl_up:new a.ci(ce),u_tile_tr_up:new a.ci(ce),u_tile_br_up:new a.ci(ce),u_tile_bl_up:new a.ci(ce),u_tile_up_scale:new a.cj(ce)}))(i)),M.includes("FOG")&&(this.fogUniforms=(ce=>({u_fog_matrix:new a.cl(ce),u_fog_range:new a.ck(ce),u_fog_color:new a.d3(ce),u_fog_horizon_blend:new a.cj(ce),u_fog_vertical_limit:new a.ck(ce),u_fog_temporal_offset:new a.cj(ce),u_frustum_tl:new a.ci(ce),u_frustum_tr:new a.ci(ce),u_frustum_br:new a.ci(ce),u_frustum_bl:new a.ci(ce),u_globe_pos:new a.ci(ce),u_globe_radius:new a.cj(ce),u_globe_transition:new a.cj(ce),u_is_globe:new a.ch(ce),u_viewport:new a.ck(ce)}))(i)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ce=>({u_cutoff_params:new a.d3(ce)}))(i)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ce=>({u_lighting_ambient_color:new a.ci(ce),u_lighting_directional_dir:new a.ci(ce),u_lighting_directional_color:new a.ci(ce),u_ground_radiance:new a.ci(ce)}))(i)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ce=>({u_light_matrix_0:new a.cl(ce),u_light_matrix_1:new a.cl(ce),u_fade_range:new a.ck(ce),u_shadow_normal_offset:new a.ci(ce),u_shadow_intensity:new a.cj(ce),u_shadow_texel_size:new a.cj(ce),u_shadow_map_resolution:new a.cj(ce),u_shadow_direction:new a.ci(ce),u_shadow_bias:new a.ci(ce),u_shadowmap_0:new a.ch(ce),u_shadowmap_1:new a.ch(ce)}))(i)))}getAttributeLocation(i,c){let g=this.attributes[c];return g===void 0&&(g=this.attributes[c]=i.getAttribLocation(this.program,c)),g}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in c)g[E]&&g[E].set(this.program,E,c[E])}}setGlobeUniformValues(i,c){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in c)g[E]&&g[E].set(this.program,E,c[E])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in c)g[E].set(this.program,E,c[E])}}setCutoffUniformValues(i,c){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in c)g[E].set(this.program,E,c[E])}}setLightsUniformValues(i,c){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in c)g[E].set(this.program,E,c[E])}}setShadowUniformValues(i,c){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;i.program.set(this.program);for(const E in c)g[E].set(this.program,E,c[E])}_drawDebugWireframe(i,c,g,E,A,M,D,z,U,$){const ie=i.options.wireframe;if(ie.terrain===!1&&ie.layers2D===!1&&ie.layers3D===!1)return;const K=i.context;if(!(!(!ie.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ie.layers2D||i._terrain&&i._terrain.renderingToTexture||!th.includes(this.name))||!(!ie.layers3D||!_p.includes(this.name))))return;const re=K.gl,he=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,A,K);if(!he)return;const ce=[...this.fixedDefines,"DEBUG_WIREFRAME"],de=i.getOrCreateProgram(this.name,{config:this.configuration,defines:ce});K.program.set(de.program);const ge=(Ee,Ge,je)=>{if(Ge[Ee]&&je[Ee])for(const Ue in Ge[Ee])je[Ee][Ue]&&je[Ee][Ue].set(je.program,Ue,Ge[Ee][Ue].current)};U&&U.setUniforms(de.program,K,de.binderUniforms,D,{zoom:z}),ge("fixedUniforms",this,de),ge("terrainUniforms",this,de),ge("globeUniforms",this,de),ge("fogUniforms",this,de),ge("lightsUniforms",this,de),ge("shadowUniforms",this,de),he.bind(),K.setColorMode(new Ii([re.ONE,re.ONE_MINUS_SRC_ALPHA,re.ZERO,re.ONE],a.ao.transparent,[!0,!0,!0,!1])),K.setDepthMode(new fi(c.func===re.LESS?re.LEQUAL:c.func,fi.ReadOnly,c.range)),K.setStencilMode(Mi.disabled);const Ce=3*M.primitiveLength*2,Ae=3*M.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ee=$||1;for(let Ge=0;Ge<Ee;++Ge)de.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ge),re.drawElements(re.LINES,Ce,re.UNSIGNED_SHORT,Ae)}else $&&$>1?re.drawElementsInstanced(re.LINES,Ce,re.UNSIGNED_SHORT,Ae,$):re.drawElements(re.LINES,Ce,re.UNSIGNED_SHORT,Ae);A.bind(),K.program.set(this.program),K.setDepthMode(c),K.setStencilMode(g),K.setColorMode(E)}checkUniforms(i,c,g){if(this.fixedDefines.includes(c)){for(const E of Object.keys(g))if(!g[E].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${E} not set but required by ${c} being defined`)}}draw(i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de){const ge=i.context,Ce=ge.gl;if(this.failedToCreate)return;ge.program.set(this.program),ge.setDepthMode(g),ge.setStencilMode(E),ge.setColorMode(A),ge.setCullFace(M);for(const[ze,Pe]of this.fixedUniformsEntries)Pe.set(this.program,ze,D[ze]);he&&he.setUniforms(this.program,ge,this.binderUniforms,K,{zoom:re});const Ae={[Ce.POINTS]:1,[Ce.LINES]:2,[Ce.TRIANGLES]:3,[Ce.LINE_STRIP]:1}[c];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const Ee=ce||[],Ge=he?he.getPaintVertexBuffers():[],je=c===Ce.TRIANGLES&&$,Ue=de&&de>0?1:void 0;for(const ze of ie.get()){const Pe=ze.vaos||(ze.vaos={});if((Pe[z]||(Pe[z]=new qu)).bind(ge,this,U,Ge,$,ze.vertexOffset,Ee,Ue),this.forceManualRenderingForInstanceIDShaders){const We=de||1;for(let Xe=0;Xe<We;++Xe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Xe),$?Ce.drawElements(c,ze.primitiveLength*Ae,Ce.UNSIGNED_SHORT,ze.primitiveOffset*Ae*2):Ce.drawArrays(c,ze.vertexOffset,ze.vertexLength)}else de&&de>1?Ce.drawElementsInstanced(c,ze.primitiveLength*Ae,Ce.UNSIGNED_SHORT,ze.primitiveOffset*Ae*2,de):$?Ce.drawElements(c,ze.primitiveLength*Ae,Ce.UNSIGNED_SHORT,ze.primitiveOffset*Ae*2):Ce.drawArrays(c,ze.vertexOffset,ze.vertexLength);je&&this._drawDebugWireframe(i,g,E,A,$,ze,K,re,he,de)}}}function nd(m,i,c=0){const g=Math.pow(2,i.tileID.overscaledZ),E=i.tileSize*Math.pow(2,m.transform.tileZoom)/g,A=E*(i.tileID.canonical.x+i.tileID.wrap*g),M=E*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(i,1,m.transform.tileZoom),u_pixel_coord_upper:[A>>16,M>>16],u_pixel_coord_lower:[65535&A,65535&M],u_pattern_transition:c}}const sd={terrain:0,flat:1},Fm=a.bC(),dl=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge)=>{const Ce=i.style.light,Ae=Ce.properties.get("position"),Ee=[Ae.x,Ae.y,Ae.z],Ge=a.dO();Ce.properties.get("anchor")==="viewport"&&(a.dP(Ge,-i.transform.angle),a.dQ(Ee,Ee,Ge));const je=Ce.properties.get("color").toPremultipliedRenderColor(null),Ue=i.transform,ze={u_matrix:m,u_lightpos:Ee,u_lightintensity:Ce.properties.get("intensity"),u_lightcolor:[je.r,je.g,je.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:sd[U],u_base_type:sd[$],u_ao:E,u_edge_radius:A,u_width_scale:M,u_flood_light_color:he,u_vertical_scale:ce,u_flood_light_intensity:de,u_ground_shadow_factor:ge};return Ue.projection.name==="globe"&&(ze.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],ze.u_zoom_transition=ie,ze.u_inv_rot_matrix=re,ze.u_merc_center=K,ze.u_up_dir=Ue.projection.upVector(new a.cD(0,0,0),K[0]*a.al,K[1]*a.al),ze.u_height_lift=z),ze},$l=(m,i,c,g,E,A)=>({u_matrix:m,u_edge_radius:i,u_width_scale:c,u_vertical_scale:g,u_height_type:sd[E],u_base_type:sd[A]}),xp=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge)=>{const Ce=dl(m,i,c,g,E,A,M,D,U,$,ie,K,re,he,ce,de,1,[0,0,0]),Ae={u_height_factor:-Math.pow(2,D.overscaledZ)/z.tileSize/8};return Object.assign(Ce,nd(i,z,ge),Ae)},mc=(m,i,c)=>({u_matrix:m,u_emissive_strength:i,u_ground_shadow_factor:c}),gc=(m,i,c,g,E,A=0)=>Object.assign(mc(m,i,E),nd(c,g,A)),ih=(m,i,c,g)=>({u_matrix:m,u_world:c,u_emissive_strength:i,u_ground_shadow_factor:g}),ad=(m,i,c,g,E,A,M=0)=>Object.assign(gc(m,i,c,g,A,M),{u_world:E}),Jc=(m,i)=>({u_matrix:m,u_depth_bias:i}),Bo=(m,i)=>({u_matrix:m,u_ground_shadow_factor:i}),yc=(m,i,c,g,E)=>({u_matrix:m,u_camera_pos:[i[0],i[1],i[2]],u_depth_bias:c,u_height_scale:g,u_reset_depth:E}),fl=(m,i,c,g,E,A,M,D,z)=>({u_matrix:m,u_normal_matrix:i,u_opacity:c,u_faux_facade_ao_intensity:g,u_camera_pos:E,u_tile_to_meter:A,u_facade_emissive_chance:M,u_flood_light_color:D,u_flood_light_intensity:z}),vp=m=>({u_matrix:m}),Sa=m=>({u_matrix:m}),od=(m,i,c,g,E,A,M,D)=>{const z=a.al/A.tileSize;return{u_matrix:m,u_inv_rot_matrix:i,u_camera_to_center_distance:c.getCameraToCenterDistance(D),u_extrude_scale:[c.pixelsToGLUnits[0]/z,c.pixelsToGLUnits[1]/z],u_zoom_transition:g,u_tile_id:M,u_merc_center:E}},rh=(m,i,c,g)=>({u_matrix:m,u_inv_matrix:i,u_camera_to_center_distance:c.getCameraToCenterDistance(g),u_viewport_size:[c.width,c.height]}),pl=(m,i,c=1)=>({u_matrix:m,u_color:i,u_overlay:0,u_overlay_scale:c}),Hl=a.bC(),eu=(m,i,c,g,E,A,M)=>{const D=m.transform,z=D.projection.name==="globe",U=z?a.dR(D.zoom,i.canonical)*D._pixelsPerMercatorPixel:a.ay(c,1,A),$={u_matrix:i.projMatrix,u_extrude_scale:U,u_intensity:M,u_inv_rot_matrix:Hl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){$.u_inv_rot_matrix=g,$.u_merc_center=E,$.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],$.u_zoom_transition=a.aj(D.zoom);const ie=E[0]*a.al,K=E[1]*a.al;$.u_up_dir=D.projection.upVector(new a.cD(0,0,0),ie,K)}return $};function nh(m,[i,c,g,E],[A,M]){if(A===M)return[0,0,0,0];const D=255*(m-1)/(m*(M-A));return[i*D,c*D,g*D,E*D]}function cf(m,i,[c,g]){return c===g?0:.5/m+(i-c)*(m-1)/(m*(g-c))}const tu=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce,Ae,Ee)=>({u_matrix:m,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:E,u_tl_parent:A,u_scale_parent:U,u_fade_t:$.mix,u_opacity:$.opacity*ie.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ie.paint.get("raster-brightness-min"),u_brightness_high:ie.paint.get("raster-brightness-max"),u_saturation_factor:a.dT(ie.paint.get("raster-saturation")),u_contrast_factor:a.dS(ie.paint.get("raster-contrast")),u_spin_weights:ql(ie.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:re,u_zoom_transition:M,u_merc_center:D,u_cutoff_params:z,u_colorization_mix:nh(a.dU,ce,ge),u_colorization_offset:cf(a.dU,de,ge),u_color_ramp:he,u_texture_offset:[Ae/(Ce+2*Ae),Ce/(Ce+2*Ae)],u_texture_res:[Ce+2*Ae,Ce+2*Ae],u_emissive_strength:Ee});function ql(m){m*=Math.PI/180;const i=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const iu=.05,Bm=(m,i,c,g,E,A,M,D,z,U,$,ie)=>({u_matrix:m,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:E,u_tl_parent:A,u_scale_parent:U,u_fade_t:$.mix,u_opacity:$.opacity,u_image0:0,u_image1:1,u_raster_elevation:ie,u_zoom_transition:M,u_merc_center:D,u_cutoff_params:z}),ru=(m,i,c,g,E,A,M,D,z,U)=>({u_particle_texture:m,u_particle_texture_side_len:i,u_tile_offset:c,u_velocity:g,u_color_ramp:A,u_velocity_res:E,u_max_speed:M,u_uv_offset:D,u_data_scale:[255*z[0],255*z[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[iu,iu]}),uf=(m,i,c,g,E,A,M,D,z,U)=>({u_particle_texture:m,u_particle_texture_side_len:i,u_velocity:c,u_velocity_res:g,u_max_speed:E,u_speed_factor:A,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*z[0],255*z[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[iu,iu]}),ld=a.bC(),nu=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce,Ae,Ee,Ge,je,Ue)=>{const ze=E.transform,Pe={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ze.getCameraToCenterDistance(Ce),u_rotate_symbol:+c,u_aspect_ratio:ze.width/ze.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:M,u_coord_matrix:D,u_is_text:+U,u_elevation_from_sea:z?1:0,u_pitch_with_map:+g,u_texsize:$,u_texsize_icon:ie,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ld,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ld,u_up_vector:[0,-1,0],u_color_adj_mat:Ge,u_icon_transition:je||0,u_gamma_scale:g?E.transform.getCameraToCenterDistance(Ce)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:a.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ue||1,u_ground_shadow_factor:Ae,u_inv_matrix:a.bl(a.bC(),M),u_normal_scale:Ee,u_lutTexture:10};return Ce.name==="globe"&&(Pe.u_tile_id=[re.canonical.x,re.canonical.y,1<<re.canonical.z],Pe.u_zoom_transition=he,Pe.u_inv_rot_matrix=de,Pe.u_merc_center=ce,Pe.u_camera_forward=ze._camera.forward(),Pe.u_ecef_origin=a.dV(ze.globeMatrix,re.toUnwrapped()),Pe.u_tile_matrix=Float32Array.from(ze.globeMatrix),Pe.u_up_vector=ge),Pe},ml=(m,i,c,g)=>({u_matrix:m,u_emissive_strength:i,u_opacity:c,u_color:g}),Qs=(m,i,c,g,E,A,M,D,z)=>Object.assign((function(U,$,ie,K,re,he){const{width:ce,height:de}=K.imageManager.getPixelSize($),ge=Math.pow(2,he.tileID.overscaledZ),Ce=he.tileSize*Math.pow(2,K.transform.tileZoom)/ge,Ae=Ce*(he.tileID.canonical.x+he.tileID.wrap*ge),Ee=Ce*he.tileID.canonical.y;return{u_image:0,u_pattern_tl:ie.tl,u_pattern_br:ie.br,u_texsize:[ce,de],u_pattern_size:ie.displaySize,u_pattern_units_to_pixels:re?[K.transform.width,-1*K.transform.height]:[1/a.ay(he,1,K.transform.tileZoom),1/a.ay(he,1,K.transform.tileZoom)],u_pixel_coord_upper:[Ae>>16,Ee>>16],u_pixel_coord_lower:[65535&Ae,65535&Ee]}})(0,A,M,g,D,z),{u_matrix:m,u_emissive_strength:i,u_opacity:c}),Ns=new Float32Array(a.bA([])),jo=(m,i,c,g,E,A,M,D,z,U,$,ie,K,re=[0,0,0],he,ce,de)=>{const ge=E.style.light,Ce=ge.properties.get("position"),Ae=[-Ce.x,-Ce.y,Ce.z],Ee=a.dO();ge.properties.get("anchor")==="viewport"&&(a.dP(Ee,-E.transform.angle),a.dQ(Ae,Ae,Ee));const Ge=$.alphaMode==="MASK",je=ge.properties.get("color").toNonPremultipliedRenderColor(null),Ue=K.paint.get("model-ambient-occlusion-intensity"),ze=K.paint.get("model-color").constantOr(a.ao.white).toNonPremultipliedRenderColor(null);return ze.a=K.paint.get("model-color-mix-intensity").constantOr(0),de&&(ze.r=de[0],ze.g=de[1],ze.b=de[2],ze.a=de[3]),ce&&(ze.r=ce.color.r,ze.g=ce.color.g,ze.b=ce.color.b,ze.a=ce.colorMix,ie=ce.emissionStrength,A*=ce.opacity),{u_matrix:m,u_lighting_matrix:i,u_normal_matrix:c,u_node_matrix:g||Ns,u_lightpos:Ae,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[je.r,je.g,je.b],u_camera_pos:re,u_opacity:A,u_baseTextureIsAlpha:0,u_alphaMask:+Ge,u_alphaCutoff:$.alphaCutoff,u_baseColorFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:D.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:z,u_roughnessFactor:U,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:ze.toArray01(),u_aoIntensity:Ue,u_emissive_strength:ie,u_occlusionTextureTransform:he||[0,0,0,0]}},su=(m,i=Ns,c=Ns)=>({u_matrix:m,u_instance:i,u_node_matrix:c}),cd={fillExtrusion:m=>({u_matrix:new a.cl(m),u_lightpos:new a.ci(m),u_lightintensity:new a.cj(m),u_lightcolor:new a.ci(m),u_vertical_gradient:new a.cj(m),u_opacity:new a.cj(m),u_edge_radius:new a.cj(m),u_width_scale:new a.cj(m),u_ao:new a.ck(m),u_height_type:new a.ch(m),u_base_type:new a.ch(m),u_tile_id:new a.ci(m),u_zoom_transition:new a.cj(m),u_inv_rot_matrix:new a.cl(m),u_merc_center:new a.ck(m),u_up_dir:new a.ci(m),u_height_lift:new a.cj(m),u_flood_light_color:new a.ci(m),u_vertical_scale:new a.cj(m),u_flood_light_intensity:new a.cj(m),u_ground_shadow_factor:new a.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new a.cl(m),u_edge_radius:new a.cj(m),u_width_scale:new a.cj(m),u_vertical_scale:new a.cj(m),u_height_type:new a.ch(m),u_base_type:new a.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new a.cl(m),u_lightpos:new a.ci(m),u_lightintensity:new a.cj(m),u_lightcolor:new a.ci(m),u_vertical_gradient:new a.cj(m),u_height_factor:new a.cj(m),u_edge_radius:new a.cj(m),u_width_scale:new a.cj(m),u_ao:new a.ck(m),u_height_type:new a.ch(m),u_base_type:new a.ch(m),u_tile_id:new a.ci(m),u_zoom_transition:new a.cj(m),u_inv_rot_matrix:new a.cl(m),u_merc_center:new a.ck(m),u_up_dir:new a.ci(m),u_height_lift:new a.cj(m),u_image:new a.ch(m),u_texsize:new a.ck(m),u_pixel_coord_upper:new a.ck(m),u_pixel_coord_lower:new a.ck(m),u_tile_units_to_pixels:new a.cj(m),u_opacity:new a.cj(m),u_pattern_transition:new a.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new a.cl(m),u_opacity:new a.cj(m),u_ao_pass:new a.cj(m),u_meter_to_tile:new a.cj(m),u_ao:new a.ck(m),u_flood_light_intensity:new a.cj(m),u_flood_light_color:new a.ci(m),u_attenuation:new a.cj(m),u_edge_radius:new a.cj(m),u_fb:new a.ch(m),u_fb_size:new a.cj(m),u_dynamic_offset:new a.cj(m)}),fill:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_ground_shadow_factor:new a.ci(m)}),fillPattern:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_image:new a.ch(m),u_texsize:new a.ck(m),u_pixel_coord_upper:new a.ck(m),u_pixel_coord_lower:new a.ck(m),u_tile_units_to_pixels:new a.cj(m),u_ground_shadow_factor:new a.ci(m),u_pattern_transition:new a.cj(m)}),fillOutline:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_world:new a.ck(m),u_ground_shadow_factor:new a.ci(m)}),fillOutlinePattern:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_world:new a.ck(m),u_image:new a.ch(m),u_texsize:new a.ck(m),u_pixel_coord_upper:new a.ck(m),u_pixel_coord_lower:new a.ck(m),u_tile_units_to_pixels:new a.cj(m),u_ground_shadow_factor:new a.ci(m),u_pattern_transition:new a.cj(m)}),building:m=>({u_matrix:new a.cl(m),u_normal_matrix:new a.cl(m),u_opacity:new a.cj(m),u_faux_facade_ao_intensity:new a.cj(m),u_camera_pos:new a.ci(m),u_tile_to_meter:new a.cj(m),u_facade_emissive_chance:new a.cj(m),u_flood_light_color:new a.ci(m),u_flood_light_intensity:new a.cj(m)}),buildingBloom:m=>({u_matrix:new a.cl(m)}),buildingDepth:m=>({u_matrix:new a.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new a.cl(m),u_depth_bias:new a.cj(m)}),elevatedStructures:m=>({u_matrix:new a.cl(m),u_ground_shadow_factor:new a.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new a.cl(m),u_camera_pos:new a.ci(m),u_depth_bias:new a.cj(m),u_height_scale:new a.cj(m),u_reset_depth:new a.cj(m)}),circle:a.dY,collisionBox:m=>({u_matrix:new a.cl(m),u_inv_rot_matrix:new a.cl(m),u_camera_to_center_distance:new a.cj(m),u_extrude_scale:new a.ck(m),u_zoom_transition:new a.cj(m),u_merc_center:new a.ck(m),u_tile_id:new a.ci(m)}),collisionCircle:m=>({u_matrix:new a.cl(m),u_inv_matrix:new a.cl(m),u_camera_to_center_distance:new a.cj(m),u_viewport_size:new a.ck(m)}),debug:m=>({u_color:new a.dB(m),u_matrix:new a.cl(m),u_overlay:new a.ch(m),u_overlay_scale:new a.cj(m)}),clippingMask:m=>({u_matrix:new a.cl(m)}),heatmap:m=>({u_extrude_scale:new a.cj(m),u_intensity:new a.cj(m),u_matrix:new a.cl(m),u_inv_rot_matrix:new a.cl(m),u_merc_center:new a.ck(m),u_tile_id:new a.ci(m),u_zoom_transition:new a.cj(m),u_up_dir:new a.ci(m)}),heatmapTexture:m=>({u_image:new a.ch(m),u_color_ramp:new a.ch(m),u_opacity:new a.cj(m)}),hillshade:m=>({u_matrix:new a.cl(m),u_image:new a.ch(m),u_latrange:new a.ck(m),u_light:new a.ck(m),u_shadow:new a.dB(m),u_highlight:new a.dB(m),u_emissive_strength:new a.cj(m),u_accent:new a.dB(m)}),hillshadePrepare:m=>({u_matrix:new a.cl(m),u_image:new a.ch(m),u_dimension:new a.ck(m),u_zoom:new a.cj(m)}),line:a.dX,linePattern:a.dW,raster:m=>({u_matrix:new a.cl(m),u_normalize_matrix:new a.cl(m),u_globe_matrix:new a.cl(m),u_merc_matrix:new a.cl(m),u_grid_matrix:new a.dC(m),u_tl_parent:new a.ck(m),u_scale_parent:new a.cj(m),u_fade_t:new a.cj(m),u_opacity:new a.cj(m),u_image0:new a.ch(m),u_image1:new a.ch(m),u_brightness_low:new a.cj(m),u_brightness_high:new a.cj(m),u_saturation_factor:new a.cj(m),u_contrast_factor:new a.cj(m),u_spin_weights:new a.ci(m),u_perspective_transform:new a.ck(m),u_raster_elevation:new a.cj(m),u_zoom_transition:new a.cj(m),u_merc_center:new a.ck(m),u_cutoff_params:new a.d3(m),u_colorization_mix:new a.d3(m),u_colorization_offset:new a.cj(m),u_color_ramp:new a.ch(m),u_texture_offset:new a.ck(m),u_texture_res:new a.ck(m),u_emissive_strength:new a.cj(m)}),rasterParticle:m=>({u_matrix:new a.cl(m),u_normalize_matrix:new a.cl(m),u_globe_matrix:new a.cl(m),u_merc_matrix:new a.cl(m),u_grid_matrix:new a.dC(m),u_tl_parent:new a.ck(m),u_scale_parent:new a.cj(m),u_fade_t:new a.cj(m),u_opacity:new a.cj(m),u_image0:new a.ch(m),u_image1:new a.ch(m),u_raster_elevation:new a.cj(m),u_zoom_transition:new a.cj(m),u_merc_center:new a.ck(m),u_cutoff_params:new a.d3(m)}),rasterParticleTexture:m=>({u_texture:new a.ch(m),u_opacity:new a.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new a.ch(m),u_particle_texture_side_len:new a.cj(m),u_tile_offset:new a.ck(m),u_velocity:new a.ch(m),u_color_ramp:new a.ch(m),u_velocity_res:new a.ck(m),u_max_speed:new a.cj(m),u_uv_offset:new a.ck(m),u_data_scale:new a.ck(m),u_data_offset:new a.cj(m),u_particle_pos_scale:new a.cj(m),u_particle_pos_offset:new a.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new a.ch(m),u_particle_texture_side_len:new a.cj(m),u_velocity:new a.ch(m),u_velocity_res:new a.ck(m),u_max_speed:new a.cj(m),u_speed_factor:new a.cj(m),u_reset_rate:new a.cj(m),u_rand_seed:new a.cj(m),u_uv_offset:new a.ck(m),u_data_scale:new a.ck(m),u_data_offset:new a.cj(m),u_particle_pos_scale:new a.cj(m),u_particle_pos_offset:new a.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new a.ch(m),u_is_size_feature_constant:new a.ch(m),u_size_t:new a.cj(m),u_size:new a.cj(m),u_camera_to_center_distance:new a.cj(m),u_rotate_symbol:new a.ch(m),u_aspect_ratio:new a.cj(m),u_fade_change:new a.cj(m),u_matrix:new a.cl(m),u_label_plane_matrix:new a.cl(m),u_coord_matrix:new a.cl(m),u_is_text:new a.ch(m),u_elevation_from_sea:new a.ch(m),u_pitch_with_map:new a.ch(m),u_texsize:new a.ck(m),u_texsize_icon:new a.ck(m),u_texture:new a.ch(m),u_texture_icon:new a.ch(m),u_gamma_scale:new a.cj(m),u_device_pixel_ratio:new a.cj(m),u_tile_id:new a.ci(m),u_zoom_transition:new a.cj(m),u_inv_rot_matrix:new a.cl(m),u_merc_center:new a.ck(m),u_camera_forward:new a.ci(m),u_tile_matrix:new a.cl(m),u_up_vector:new a.ci(m),u_ecef_origin:new a.ci(m),u_is_halo:new a.ch(m),u_icon_transition:new a.cj(m),u_color_adj_mat:new a.cl(m),u_scale_factor:new a.cj(m),u_ground_shadow_factor:new a.ci(m),u_inv_matrix:new a.cl(m),u_normal_scale:new a.cj(m),u_lutTexture:new a.ch(m)}),background:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_opacity:new a.cj(m),u_color:new a.dB(m)}),backgroundPattern:m=>({u_matrix:new a.cl(m),u_emissive_strength:new a.cj(m),u_opacity:new a.cj(m),u_image:new a.ch(m),u_pattern_tl:new a.ck(m),u_pattern_br:new a.ck(m),u_texsize:new a.ck(m),u_pattern_size:new a.ck(m),u_pixel_coord_upper:new a.ck(m),u_pixel_coord_lower:new a.ck(m),u_pattern_units_to_pixels:new a.ck(m)}),terrainRaster:m=>({u_matrix:new a.cl(m),u_image0:new a.ch(m),u_image1:new a.ch(m),u_skirt_height:new a.cj(m),u_ground_shadow_factor:new a.ci(m),u_emissive_texture_available:new a.cj(m)}),skybox:m=>({u_matrix:new a.cl(m),u_sun_direction:new a.ci(m),u_cubemap:new a.ch(m),u_opacity:new a.cj(m),u_temporal_offset:new a.cj(m)}),skyboxGradient:m=>({u_matrix:new a.cl(m),u_color_ramp:new a.ch(m),u_center_direction:new a.ci(m),u_radius:new a.cj(m),u_opacity:new a.cj(m),u_temporal_offset:new a.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new a.dC(m),u_sun_direction:new a.ci(m),u_sun_intensity:new a.cj(m),u_color_tint_r:new a.d3(m),u_color_tint_m:new a.d3(m),u_luminance:new a.cj(m)}),globeRaster:m=>({u_proj_matrix:new a.cl(m),u_globe_matrix:new a.cl(m),u_normalize_matrix:new a.cl(m),u_merc_matrix:new a.cl(m),u_zoom_transition:new a.cj(m),u_merc_center:new a.ck(m),u_image0:new a.ch(m),u_image1:new a.ch(m),u_grid_matrix:new a.dC(m),u_skirt_height:new a.cj(m),u_far_z_cutoff:new a.cj(m),u_frustum_tl:new a.ci(m),u_frustum_tr:new a.ci(m),u_frustum_br:new a.ci(m),u_frustum_bl:new a.ci(m),u_globe_pos:new a.ci(m),u_globe_radius:new a.cj(m),u_viewport:new a.ck(m),u_emissive_texture_available:new a.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new a.ci(m),u_frustum_tr:new a.ci(m),u_frustum_br:new a.ci(m),u_frustum_bl:new a.ci(m),u_horizon:new a.cj(m),u_transition:new a.cj(m),u_fadeout_range:new a.cj(m),u_atmosphere_fog_color:new a.d3(m),u_high_color:new a.d3(m),u_space_color:new a.d3(m),u_temporal_offset:new a.cj(m),u_horizon_angle:new a.cj(m)}),model:m=>({u_matrix:new a.cl(m),u_lighting_matrix:new a.cl(m),u_normal_matrix:new a.cl(m),u_node_matrix:new a.cl(m),u_lightpos:new a.ci(m),u_lightintensity:new a.cj(m),u_lightcolor:new a.ci(m),u_camera_pos:new a.ci(m),u_opacity:new a.cj(m),u_baseColorFactor:new a.d3(m),u_emissiveFactor:new a.d3(m),u_metallicFactor:new a.cj(m),u_roughnessFactor:new a.cj(m),u_baseTextureIsAlpha:new a.ch(m),u_alphaMask:new a.ch(m),u_alphaCutoff:new a.cj(m),u_baseColorTexture:new a.ch(m),u_metallicRoughnessTexture:new a.ch(m),u_normalTexture:new a.ch(m),u_occlusionTexture:new a.ch(m),u_emissionTexture:new a.ch(m),u_lutTexture:new a.ch(m),u_color_mix:new a.d3(m),u_aoIntensity:new a.cj(m),u_emissive_strength:new a.cj(m),u_occlusionTextureTransform:new a.d3(m)}),modelDepth:m=>({u_matrix:new a.cl(m),u_instance:new a.cl(m),u_node_matrix:new a.cl(m)}),groundShadow:m=>({u_matrix:new a.cl(m),u_ground_shadow_factor:new a.ci(m)}),stars:m=>({u_matrix:new a.cl(m),u_up:new a.ci(m),u_right:new a.ci(m),u_intensity_multiplier:new a.cj(m)}),snowParticle:m=>({u_modelview:new a.cl(m),u_projection:new a.cl(m),u_time:new a.cj(m),u_cam_pos:new a.ci(m),u_velocityConeAperture:new a.cj(m),u_velocity:new a.cj(m),u_horizontalOscillationRadius:new a.cj(m),u_horizontalOscillationRate:new a.cj(m),u_boxSize:new a.cj(m),u_billboardSize:new a.cj(m),u_simpleShapeParameters:new a.ck(m),u_screenSize:new a.ck(m),u_thinningCenterPos:new a.ck(m),u_thinningShape:new a.ci(m),u_thinningAffectedRatio:new a.cj(m),u_thinningParticleOffset:new a.cj(m),u_particleColor:new a.d3(m),u_direction:new a.ci(m)}),rainParticle:m=>({u_modelview:new a.cl(m),u_projection:new a.cl(m),u_time:new a.cj(m),u_cam_pos:new a.ci(m),u_texScreen:new a.ch(m),u_velocityConeAperture:new a.cj(m),u_velocity:new a.cj(m),u_boxSize:new a.cj(m),u_rainDropletSize:new a.ck(m),u_distortionStrength:new a.cj(m),u_rainDirection:new a.ci(m),u_color:new a.d3(m),u_screenSize:new a.ck(m),u_thinningCenterPos:new a.ck(m),u_thinningShape:new a.ci(m),u_thinningAffectedRatio:new a.cj(m),u_thinningParticleOffset:new a.cj(m),u_shapeDirectionalPower:new a.cj(m),u_shapeNormalPower:new a.cj(m),u_mode:new a.cj(m)}),vignette:m=>({u_vignetteShape:new a.ci(m),u_vignetteColor:new a.d3(m)}),occlusion:m=>({u_matrix:new a.cl(m),u_anchorPos:new a.ci(m),u_screenSizePx:new a.ck(m),u_occluderSizePx:new a.ck(m),u_color:new a.d3(m)})};class Js{constructor(i,c,g,E){this.id=Js.uniqueIdxCounter,Js.uniqueIdxCounter++,this.context=i;const A=i.gl;this.buffer=A.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||E||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Js.uniqueIdxCounter,Js.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Js.uniqueIdxCounter=0;const za={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hs{constructor(i,c,g,E,A,M){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=E,this.instanceCount=M,this.context=i;const D=i.gl;this.buffer=D.createBuffer(),i.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||A||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let g=0;g<this.attributes.length;g++){const E=c.getAttributeLocation(i,this.attributes[g].name);E!==-1&&i.enableVertexAttribArray(E)}}setVertexAttribPointers(i,c,g){for(let E=0;E<this.attributes.length;E++){const A=this.attributes[E],M=c.getAttributeLocation(i,A.name);M!==-1&&i.vertexAttribPointer(M,A.components,i[za[A.type]],!1,this.itemSize,A.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(i,c,g){for(let E=0;E<this.attributes.length;E++){const A=c.getAttributeLocation(i,this.attributes[E].name);A!==-1&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(A,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gl{constructor(i,c,g,E,A){this.context=i,this.width=c,this.height=g;const M=this.framebuffer=i.gl.createFramebuffer();E>0&&(this.colorAttachment0=new Kh(i,M,0)),E>1&&(this.colorAttachment1=new Kh(i,M,1)),A&&(this.depthAttachmentType=A,this.depthAttachment=A==="renderbuffer"?new Xu(i,M):new Qh(i,M))}createColorAttachment(i,c){c===0?this.colorAttachment0=new Kh(i,this.framebuffer,0):c===1&&(this.colorAttachment1=new Kh(i,this.framebuffer,1))}removeColorAttachment(i,c){const g=this.context.gl;let E;c===0?(E=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(E=this.colorAttachment1.get(),this.colorAttachment1=void 0),E&&g.deleteTexture(E)}destroy(){const i=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&i.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&i.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&i.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&i.deleteTexture(c)}i.deleteFramebuffer(this.framebuffer)}}class xo{constructor(i,c){this.gl=i,this.clearColor=new cl(this),this.clearDepth=new Lo(this),this.clearStencil=new Oo(this),this.colorMask=new Wh(this),this.depthMask=new Zh(this),this.stencilMask=new Fl(this),this.stencilFunc=new Yc(this),this.stencilOp=new us(this),this.stencilTest=new mn(this),this.depthRange=new Gr(this),this.depthTest=new ul(this),this.depthFunc=new Ja(this),this.blend=new hc(this),this.blendFunc=new zo(this),this.blendColor=new Xh(this),this.blendEquation=new af(this),this.cullFace=new Bl(this),this.cullFaceSide=new Fo(this),this.frontFace=new of(this),this.program=new Wu(this),this.activeTexture=new lf(this),this.viewport=new _o(this),this.bindFramebuffer=new hl(this),this.bindRenderbuffer=new dc(this),this.bindTexture=new jl(this),this.bindVertexBuffer=new yp(this),this.bindElementBuffer=new Yh(this),this.bindVertexArrayOES=new fc(this),this.pixelStoreUnpack=new Zu(this),this.pixelStoreUnpackPremultiplyAlpha=new Nl(this),this.pixelStoreUnpackFlipY=new js(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=i.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c,g){return new Js(this,i,c,g)}createVertexBuffer(i,c,g,E,A){return new hs(this,i,c,g,E,A)}createRenderbuffer(i,c,g){const E=this.gl,A=E.createRenderbuffer();return this.bindRenderbuffer.set(A),E.renderbufferStorage(E.RENDERBUFFER,i,c,g),this.bindRenderbuffer.set(null),A}createFramebuffer(i,c,g,E){return new gl(this,i,c,g,E)}clear({color:i,depth:c,stencil:g,colorMask:E}){const A=this.gl;let M=0;i&&(M|=A.COLOR_BUFFER_BIT,this.clearColor.set(i.toNonPremultipliedRenderColor(null)),this.colorMask.set(E||[!0,!0,!0,!0])),c!==void 0&&(M|=A.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),g!==void 0&&(M|=A.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),A.clear(M)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.by(i.blendFunction,Ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ut;function gn(m,i,c,g,E,A,M){const D=m.context,z=D.gl,U=m.transform,$=[a.aF(U.center.lng),a.aJ(U.center.lat)],ie=c.layout.get("symbol-placement"),K=c.layout.get("text-variable-anchor"),re=c.layout.get("icon-rotation-alignment")==="map",he=c.layout.get("text-rotation-alignment")==="map",ce=ie!=="point",de=[];let ge=0,Ce=0;for(let ze=0;ze<g.length;ze++){const Pe=g[ze],We=i.getTile(Pe),Xe=We.getBucket(c);if(!Xe)continue;const Qe=Xe.getProjection().createInversionMatrix(U,Pe.canonical),rt=[],tt=ap(Pe,Xe,U),pt=!M&&re&&ce,wt=M&&he&&ce,nt=K&&Xe.hasTextData(),Ze=Xe.hasIconTextFit()&&nt&&Xe.hasIconData(),_t=pt||wt||M&&nt||Ze,ot=Xe.projection.name==="globe",bt=ot?a.aj(U.zoom):0;ot&&(rt.push("PROJECTION_GLOBE_VIEW"),_t&&rt.push("PROJECTED_POS_ON_VIEWPORT"));const Lt=m.getOrCreateProgram("collisionBox",{defines:rt});let Wt=tt;E[0]===0&&E[1]===0||(Wt=m.translatePosMatrix(tt,We,E,A));const jt=M?Xe.textCollisionBox:Xe.iconCollisionBox,zt=Xe.collisionCircleArray;if(zt.length>0){const ai=a.bC(),Xt=Wt;a.cP(ai,Xe.placementInvProjMatrix,U.glCoordMatrix),a.cP(ai,ai,Xe.placementViewportMatrix),de.push({circleArray:zt,circleOffset:Ce,transform:Xt,invTransform:ai,projection:Xe.getProjection()}),ge+=zt.length/4,Ce=ge}if(!jt)continue;m.terrain&&m.terrain.setupElevationDraw(We,Lt);const hi=ot?[Pe.canonical.x,Pe.canonical.y,1<<Pe.canonical.z]:[0,0,0];Lt.draw(m,z.LINES,fi.disabled,Mi.disabled,m.colorModeForRenderPass(),Si.disabled,od(Wt,Qe,U,bt,$,We,hi,Xe.getProjection()),c.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,null,U.zoom,null,[jt.collisionVertexBuffer,jt.collisionVertexBufferExt])}if(!M||!de.length)return;const Ae=m.getOrCreateProgram("collisionCircle"),Ee=new a.dZ;Ee.resize(4*ge),Ee._trim();let Ge=0;for(const ze of de)for(let Pe=0;Pe<ze.circleArray.length/4;Pe++){const We=4*Pe,Xe=ze.circleArray[We+0],Qe=ze.circleArray[We+1],rt=ze.circleArray[We+2],tt=ze.circleArray[We+3];Ee.emplace(Ge++,Xe,Qe,rt,tt,0),Ee.emplace(Ge++,Xe,Qe,rt,tt,1),Ee.emplace(Ge++,Xe,Qe,rt,tt,2),Ee.emplace(Ge++,Xe,Qe,rt,tt,3)}(!Ut||Ut.length<2*ge)&&(Ut=(function(ze){const Pe=2*ze,We=new a.b0;We.resize(Pe),We._trim();for(let Xe=0;Xe<Pe;Xe++){const Qe=6*Xe;We.uint16[Qe+0]=4*Xe+0,We.uint16[Qe+1]=4*Xe+1,We.uint16[Qe+2]=4*Xe+2,We.uint16[Qe+3]=4*Xe+2,We.uint16[Qe+4]=4*Xe+3,We.uint16[Qe+5]=4*Xe+0}return We})(ge));const je=D.createIndexBuffer(Ut,!0),Ue=D.createVertexBuffer(Ee,a.d_.members,!0);for(const ze of de){const Pe=rh(ze.transform,ze.invTransform,U,ze.projection);Ae.draw(m,z.TRIANGLES,fi.disabled,Mi.disabled,m.colorModeForRenderPass(),Si.disabled,Pe,c.id,Ue,je,a.bg.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,U.zoom)}Ue.destroy(),je.destroy()}const yn=a.bC();function vo(m){const i=m._camera.getWorldToCamera(m.worldSize,1),c=a.aB([],i,m.globeMatrix);a.bl(c,c);const g=[0,0,0],E=[0,1,0,0];return a.aC(E,E,c),g[0]=E[0],g[1]=E[1],g[2]=E[2],a.aw(g,g),g}function au({width:m,height:i,anchor:c,textOffset:g,textScale:E},A){const{horizontalAlign:M,verticalAlign:D}=a.c1(c),z=-(M-.5)*m,U=-(D-.5)*i,$=a.c2(c,g);return new a.P((z/E+$[0])*A,(U/E+$[1])*A)}function _c(m,i,c,g,E,A,M,D,z,U){const $=m.text.placedSymbolArray,ie=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,re={},he=m.getProjection(),ce=nl(M,he,E),de=E.elevation,ge=he.upVectorScale(M.canonical,E.center.lat,E.worldSize).metersToTile;ie.clear();for(let Ce=0;Ce<$.length;Ce++){const Ae=$.get(Ce),{tileAnchorX:Ee,tileAnchorY:Ge,numGlyphs:je}=Ae,Ue=Ae.hidden||!Ae.crossTileID||m.allowVerticalPlacement&&!Ae.placedOrientation?null:g[Ae.crossTileID];if(Ue){let ze=0,Pe=0,We=0;const Xe=m.elevationType==="road";if(de||Xe){const ot=Xe?m.getElevationFeatureForText(Ce):null,bt=a.bV.getAtTileOffset(M,new a.P(Ee,Ge),de,ot),[Lt,Wt,jt]=he.upVector(M.canonical,Ee,Ge);ze=bt*Lt*ge,Pe=bt*Wt*ge,We=bt*jt*ge}let[Qe,rt,tt,pt]=go(Ae.projectedAnchorX+ze,Ae.projectedAnchorY+Pe,Ae.projectedAnchorZ+We,c?ce:A);const wt=Hd(E.getCameraToCenterDistance(he),pt);let nt=a.bM(m.textSizeData,z,Ae)*wt/a.bY;c&&(nt*=m.tilePixelRatio/D);const Ze=au(Ue,nt);c?({x:Qe,y:rt,z:tt}=he.projectTilePoint(Ee+Ze.x,Ge+Ze.y,M.canonical),[Qe,rt,tt]=go(Qe+ze,rt+Pe,tt+We,A)):(i&&Ze._rotate(-E.angle),Qe+=Ze.x,rt+=Ze.y,tt=0);const _t=m.allowVerticalPlacement&&Ae.placedOrientation===a.bL.vertical?Math.PI/2:0;for(let ot=0;ot<je;ot++)a.bO(ie,Qe,rt,tt,_t);U&&Ae.associatedIconIndex>=0&&(re[Ae.associatedIconIndex]={x:Qe,y:rt,z:tt,angle:_t})}else Fs(je,ie)}if(U){K.clear();const Ce=m.icon.placedSymbolArray;for(let Ae=0;Ae<Ce.length;Ae++){const Ee=Ce.get(Ae),{numGlyphs:Ge}=Ee,je=re[Ae];if(Ee.hidden||!je)Fs(Ge,K);else{const{x:Ue,y:ze,z:Pe,angle:We}=je;for(let Xe=0;Xe<Ge;Xe++)a.bO(K,Ue,ze,Pe,We)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(ie)}function ou(m,i,c,g,E,A,M={}){const D=c.paint.get("icon-translate"),z=c.paint.get("text-translate"),U=c.paint.get("icon-translate-anchor"),$=c.paint.get("text-translate-anchor"),ie=c.layout.get("icon-rotation-alignment"),K=c.layout.get("text-rotation-alignment"),re=c.layout.get("icon-pitch-alignment"),he=c.layout.get("text-pitch-alignment"),ce=c.layout.get("icon-keep-upright"),de=c.layout.get("text-keep-upright"),ge=c.paint.get("icon-color-saturation"),Ce=c.paint.get("icon-color-contrast"),Ae=c.paint.get("icon-color-brightness-min"),Ee=c.paint.get("icon-color-brightness-max"),Ge=c.layout.get("symbol-elevation-reference")==="sea",je=c.layout.get("icon-image-use-theme")==="none",Ue=m.context,ze=Ue.gl,Pe=m.transform,We=ie==="map",Xe=K==="map",Qe=re==="map",rt=he==="map",tt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const wt=m.depthModeForSublayer(0,fi.ReadOnly),nt=new fi(m.context.gl.LEQUAL,fi.ReadOnly,m.depthRangeFor3D),Ze=[a.aF(Pe.center.lng),a.aJ(Pe.center.lat)],_t=c.layout.get("text-variable-anchor"),ot=Pe.projection.name==="globe",bt=[],Lt=[0,-1,0];for(const Wt of g){const jt=i.getTile(Wt),zt=jt.getBucket(c);if(!zt||zt.projection.name==="mercator"&&ot||zt.fullyClipped)continue;const hi=zt.projection.name==="globe",ai=hi?a.aj(Pe.zoom):0,Xt=nl(Wt,zt.getProjection(),Pe),oi=Pe.calculatePixelsToTileUnitsMatrix(jt),_i=_t&&zt.hasTextData(),Ti=zt.hasIconTextFit()&&_i&&zt.hasIconData(),Fi=zt.getProjection().createInversionMatrix(Pe,Wt.canonical),Yi=(1<<jt.tileID.canonical.z)*a.al/m.transform.worldSize,Ai=pr=>{let Oi=[0,0,0];if(pr){const Ni=m.style.directionalLight,kr=m.style.ambientLight;Ni&&kr&&(Oi=ua(m.style,Ni,kr))}return Oi},Bi=pr=>{Pe.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||m.terrain)&&(pr.push("DEPTH_D24"),pr.push("DEPTH_OCCLUSION"))},Di=pr=>{c.lut&&!je&&(c.lut.texture||(c.lut.texture=new a.d$(m.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ue.gl.RGBA8)),Ue.activeTexture.set(Ue.gl.TEXTURE0+10),c.lut.texture&&c.lut.texture.bind(Ue.gl.LINEAR,Ue.gl.CLAMP_TO_EDGE),pr.push("APPLY_LUT_ON_GPU"))},ur=()=>{const pr=We&&c.layout.get("symbol-placement")!=="point",Oi=[];Bi(Oi),Di(Oi);const Ni=pr||Ti,kr=zt.elevationType==="road",sn=m.shadowRenderer,Er=kr&&Qe&&!!sn&&sn.enabled,Lr=Ai(Er),Vs=kr&&Qe&&!m.terrain?nt:wt,ws=c.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Qe&&Oi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Oi.push("PROJECTION_GLOBE_VIEW"),Ni&&Oi.push("PROJECTED_POS_ON_VIEWPORT")),ws>0&&zt.hasAnySecondaryIcon&&Oi.push("ICON_TRANSITION"),!zt.icon.zOffsetVertexBuffer||kr&&m.terrain||Oi.push("Z_OFFSET"),ge===0&&Ce===0&&Ae===0&&Ee===1||Oi.push("COLOR_ADJUSTMENT"),zt.sdfIcons&&Oi.push("RENDER_SDF"),Er&&Oi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),kr&&Qe&&!m.terrain&&zt.icon.orientationVertexBuffer&&Oi.push("ELEVATED_ROADS");const ns=zt.icon.programConfigurations.get(c.id),mr=m.getOrCreateProgram("symbol",{config:ns,defines:Oi}),Aa=jt.imageAtlasTexture?jt.imageAtlasTexture.size:[0,0],Es=zt.iconSizeData,Ms=a.bK(Es,Pe.zoom),Va=Qe||!Pe.isOrthographic,pa=Vc(Xt,jt.tileID.canonical,Qe,We,Pe,zt.getProjection(),oi),Qr=Xs(Xt,jt.tileID.canonical,Qe,We,Pe,zt.getProjection(),oi),Cn=m.translatePosMatrix(Qr,jt,D,U,!0),jr=m.translatePosMatrix(Xt,jt,D,U),Ln=Ni?yn:pa,Jn=We&&!Qe&&!pr;let tn=Lt;!ot&&!Pe.mercatorFromTransition||We||(tn=vo(Pe));const Ca=hi?tn:Lt,bh=c.getColorAdjustmentMatrix(ge,Ce,Ae,Ee),Zo=nu(Es.kind,Ms,Jn,Qe,m,jr,Ln,Cn,Ge,!1,Aa,[0,0],0,Wt,ai,Ze,Fi,Ca,zt.getProjection(),Lr,Yi,bh,ws,null),vu=jt.imageAtlasTexture?jt.imageAtlasTexture:null,bu=c.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear,Ra=zt.sdfIcons||m.options.rotating||m.options.zooming||bu||Va?ze.LINEAR:ze.NEAREST,ro=zt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Xo=m.terrain&&Qe&&pr?a.bl(a.bC(),pa):yn;if(pr&&zt.icon){const Ua=a.bV.getAtTileOffsetFunc(Wt,Pe.center.lat,Pe.worldSize,zt.getProjection()),Vr=Pl(Xt,jt.tileID.canonical,Qe,We,Pe,zt.getProjection(),oi),Jl=c.layout.get("icon-size-scale-range"),Df=a.aA(m.scaleFactor,Jl[0],Jl[1]);_r(zt,Xt,m,!1,Vr,Qr,Qe,ce,Ua,Wt,Df)}return{program:mr,buffers:zt.icon,uniformValues:Zo,atlasTexture:vu,atlasTextureIcon:null,atlasInterpolation:Ra,atlasInterpolationIcon:null,isSDF:zt.sdfIcons,hasHalo:ro,depthMode:Vs,tile:jt,renderWithShadows:Er,labelPlaneMatrixInv:Xo}},sr=()=>{const pr=Xe&&c.layout.get("symbol-placement")!=="point",Oi=[],Ni=pr||_t||Ti,kr=zt.elevationType==="road",sn=m.shadowRenderer,Er=kr&&rt&&!!sn&&sn.enabled,Lr=Ai(Er),Vs=kr&&rt&&!m.terrain?nt:wt;m.terrainRenderModeElevated()&&rt&&Oi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Oi.push("PROJECTION_GLOBE_VIEW"),Ni&&Oi.push("PROJECTED_POS_ON_VIEWPORT")),!zt.text.zOffsetVertexBuffer||kr&&m.terrain||Oi.push("Z_OFFSET"),zt.iconsInText&&Oi.push("RENDER_TEXT_AND_SYMBOL"),Oi.push("RENDER_SDF"),Er&&Oi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),kr&&rt&&!m.terrain&&zt.text.orientationVertexBuffer&&Oi.push("ELEVATED_ROADS"),Bi(Oi);const ws=zt.text.programConfigurations.get(c.id),ns=m.getOrCreateProgram("symbol",{config:ws,defines:Oi});let mr,Aa=[0,0],Es=null;const Ms=zt.textSizeData;zt.iconsInText&&(Aa=jt.imageAtlasTexture?jt.imageAtlasTexture.size:[0,0],Es=jt.imageAtlasTexture?jt.imageAtlasTexture:null,mr=rt||!Pe.isOrthographic||m.options.rotating||m.options.zooming||Ms.kind==="composite"||Ms.kind==="camera"?ze.LINEAR:ze.NEAREST);const Va=jt.glyphAtlasTexture?jt.glyphAtlasTexture.size:[0,0],pa=c.layout.get("text-size-scale-range"),Qr=a.aA(m.scaleFactor,pa[0],pa[1]),Cn=a.bK(Ms,Pe.zoom,Qr),jr=Vc(Xt,jt.tileID.canonical,rt,Xe,Pe,zt.getProjection(),oi),Ln=Xs(Xt,jt.tileID.canonical,rt,Xe,Pe,zt.getProjection(),oi),Jn=m.translatePosMatrix(Ln,jt,z,$,!0),tn=m.translatePosMatrix(Xt,jt,z,$),Ca=Ni?yn:jr,bh=Xe&&!rt&&!pr;let Zo=Lt;!ot&&!Pe.mercatorFromTransition||Xe||(Zo=vo(Pe));const vu=nu(Ms.kind,Cn,bh,rt,m,tn,Ca,Jn,Ge,!0,Va,Aa,0,Wt,ai,Ze,Fi,hi?Zo:Lt,zt.getProjection(),Lr,Yi,null,null,Qr),bu=jt.glyphAtlasTexture?jt.glyphAtlasTexture:null,Ra=ze.LINEAR,ro=c.paint.get("text-halo-width").constantOr(1)!==0,Xo=m.terrain&&rt&&pr?a.bl(a.bC(),jr):yn;if(pr&&zt.text){const Ua=a.bV.getAtTileOffsetFunc(Wt,Pe.center.lat,Pe.worldSize,zt.getProjection()),Vr=Pl(Xt,jt.tileID.canonical,rt,Xe,Pe,zt.getProjection(),oi);_r(zt,Xt,m,!0,Vr,Ln,rt,de,Ua,Wt,Qr)}return{program:ns,buffers:zt.text,uniformValues:vu,atlasTexture:bu,atlasTextureIcon:Es,atlasInterpolation:Ra,atlasInterpolationIcon:mr,isSDF:!0,hasHalo:ro,depthMode:Vs,tile:jt,renderWithShadows:Er,labelPlaneMatrixInv:Xo}},vr=zt.icon.segments.get().length,er=zt.text.segments.get().length,ji=vr&&!M.onlyText?ur():null,or=er&&!M.onlyIcons?sr():null,Hr=c.paint.get("icon-opacity").constantOr(1),br=c.paint.get("text-opacity").constantOr(1);if(tt&&zt.canOverlap){pt=!0;const pr=Hr&&!M.onlyText?zt.icon.segments.get():[],Oi=br&&!M.onlyIcons?zt.text.segments.get():[];for(const Ni of pr)bt.push({segments:new a.bg([Ni]),sortKey:Ni.sortKey,state:ji});for(const Ni of Oi)bt.push({segments:new a.bg([Ni]),sortKey:Ni.sortKey,state:or})}else M.onlyText||bt.push({segments:Hr?zt.icon.segments:new a.bg([]),sortKey:0,state:ji}),M.onlyIcons||bt.push({segments:br?zt.text.segments:new a.bg([]),sortKey:0,state:or})}pt&&bt.sort((Wt,jt)=>Wt.sortKey-jt.sortKey);for(const Wt of bt){const jt=Wt.state;if(jt)if(m.terrain?m.terrain.setupElevationDraw(jt.tile,jt.program,{useDepthForOcclusion:Pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:jt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Pe.depthOcclusionForSymbolsAndCircles,jt.program),Ue.activeTexture.set(ze.TEXTURE0),jt.atlasTexture&&jt.atlasTexture.bind(jt.atlasInterpolation,ze.CLAMP_TO_EDGE,!0),jt.atlasTextureIcon&&(Ue.activeTexture.set(ze.TEXTURE1),jt.atlasTextureIcon&&jt.atlasTextureIcon.bind(jt.atlasInterpolationIcon,ze.CLAMP_TO_EDGE,!0)),jt.renderWithShadows&&m.shadowRenderer.setupShadows(jt.tile.tileID.toUnwrapped(),jt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,jt.program),jt.hasHalo){const zt=jt.uniformValues;zt.u_is_halo=1,xc(jt.buffers,Wt.segments,c,m,jt.program,jt.depthMode,E,A,zt,2),zt.u_is_halo=0}else{if(jt.isSDF){const zt=jt.uniformValues;jt.hasHalo&&(zt.u_is_halo=1,xc(jt.buffers,Wt.segments,c,m,jt.program,jt.depthMode,E,A,zt,1)),zt.u_is_halo=0}xc(jt.buffers,Wt.segments,c,m,jt.program,jt.depthMode,E,A,jt.uniformValues,1)}}}function xc(m,i,c,g,E,A,M,D,z,U){const $=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];E.draw(g,g.context.gl.TRIANGLES,A,M,D,Si.disabled,z,c.id,m.layoutVertexBuffer,m.indexBuffer,i,c.paint,g.transform.zoom,m.programConfigurations.get(c.id),$,U)}function vc(m,i){const c=1<<m.canonical.z,g=(i.x*c-m.canonical.x-m.wrap*c)*a.al,E=(i.y*c-m.canonical.y)*a.al,A=a.e8(i.z,i.y);return a.d5(g,E,A)}function bp(m,i,c,g,E){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const A=m.context.gl,M=new fi(m.context.gl.LEQUAL,fi.ReadWrite,m.depthRangeFor3D),D=new fi(m.context.gl.GREATER,fi.ReadWrite,m.depthRangeFor3D),z=(function(re){let he=.01;return re.isOrthographic&&(he=a.ak(1e-4,he,a.d0(re.pitch>=La?1:re.pitch/La))),2*he})(m.transform),U=m.transform.getFreeCameraOptions().position,$="elevatedStructuresDepthReconstruct",ie=m.getOrCreateProgram($,{defines:["DEPTH_RECONSTRUCTION"]}),K=m.getOrCreateProgram($);for(const re of g){const he=i.getTile(re),ce=he.getBucket(c);if(!ce)continue;const de=ce.elevatedStructures;if(!de)continue;const ge=ce.elevationBufferData.heightRange,Ce=vc(re.toUnwrapped(),U),Ae=m.translatePosMatrix(re.projMatrix,he,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let Ee,Ge,je,Ue;if(E==="initialize"){if(!ge||ge.min>=1||de.depthSegments.segments[0].primitiveLength===0)continue;Ee=yc(Ae,Ce,z,1,0),Ge=M,je=de.depthSegments,Ue=ie}else if(E==="reset"){if(!ge||ge.min>=0||de.maskSegments.segments[0].primitiveLength===0)continue;Ee=yc(Ae,Ce,0,0,1),Ge=D,je=de.maskSegments,Ue=ie}else if(E==="geometry"){if(de.depthSegments.segments[0].primitiveLength===0)continue;Ee=yc(Ae,Ce,z,1,0),Ge=M,je=de.depthSegments,Ue=K}Ue.draw(m,A.TRIANGLES,Ge,Mi.disabled,Ii.disabled,Si.disabled,Ee,c.id,de.vertexBuffer,de.indexBuffer,je,c.paint,m.transform.zoom)}}function Dn(m,i,c,g){const{painter:E,sourceCache:A,layer:M,coords:D,colorMode:z,elevationType:U,terrainEnabled:$,pass:ie}=m,K=E.context.gl,re=M.paint.get("fill-pattern"),he=M.paint.get("fill-pattern-cross-fade"),ce=re.constantOr(null);let de=U;U!=="road"||i&&!$||(de="none");const ge=de==="road",Ce=m.painter.shadowRenderer,Ae=ge&&!!Ce&&Ce.enabled,Ee=new fi(E.context.gl.LEQUAL,fi.ReadOnly,E.depthRangeFor3D);let Ge=[0,0,0];if(Ae){const Pe=E.style.directionalLight,We=E.style.ambientLight;Pe&&We&&(Ge=ua(E.style,Pe,We))}const je=re&&re.constantOr(1),Ue=E.terrain&&E.terrain.renderingToTexture,ze=(Pe,We)=>{let Xe,Qe,rt,tt,pt;We?(Xe=je&&!M.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",rt=K.LINES):(Xe=je?"fillPattern":"fill",rt=K.TRIANGLES);for(const wt of D){const nt=A.getTile(wt);if(je&&!nt.patternsLoaded())continue;const Ze=nt.getBucket(M);if(!Ze)continue;const _t=i?Ze.elevationBufferData:Ze.bufferData;if(_t.isEmpty())continue;E.prepareDrawTile();const ot=_t.programConfigurations.get(M.id),bt=E.isTileAffectedByFog(wt),Lt=[],Wt=[];ge&&(Lt.push("ELEVATED_ROADS"),Wt.push(_t.elevatedLayoutVertexBuffer)),Ae&&Lt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ue&&c&&Lt.push("USE_MRT1"),je&&(E.context.activeTexture.set(K.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ot.updatePaintBuffers());let jt=!1;if(ce&&nt.imageAtlas){const oi=nt.imageAtlas,_i=a.e3.from(ce),Ti=_i.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Fi=_i.getSecondary(),Yi=oi.patternPositions.get(Ti),Ai=Fi?oi.patternPositions.get(Fi.scaleSelf(a.o.devicePixelRatio).toString()):null;jt=!!Yi&&!!Ai,Yi&&ot.setConstantPatternPositions(Yi,Ai)}he>0&&(jt||ot.getPatternTransitionVertexBuffer("fill-pattern"))&&Lt.push("FILL_PATTERN_TRANSITION");const zt=E.getOrCreateProgram(Xe,{config:ot,overrideFog:bt,defines:Lt}),hi=E.translatePosMatrix(wt.projMatrix,nt,M.paint.get("fill-translate"),M.paint.get("fill-translate-anchor"));Ae&&Ce.setupShadows(nt.tileID.toUnwrapped(),zt,"vector-tile");const ai=M.paint.get("fill-emissive-strength");if(We){tt=_t.lineIndexBuffer,pt=_t.lineSegments;const oi=E.terrain&&E.terrain.renderingToTexture?E.terrain.drapeBufferSize:[K.drawingBufferWidth,K.drawingBufferHeight];Qe=Xe==="fillOutlinePattern"&&je?ad(hi,ai,E,nt,oi,Ge,he):ih(hi,ai,oi,Ge)}else tt=_t.indexBuffer,pt=_t.triangleSegments,Qe=je?gc(hi,ai,E,nt,Ge,he):mc(hi,ai,Ge);E.uploadCommonUniforms(E.context,zt,wt.toUnwrapped());let Xt=Pe;(U==="road"&&!$||U==="offset")&&(Xt=Ee),zt.draw(E,rt,Xt,g||E.stencilModeForClipping(wt),z,Si.disabled,Qe,M.id,_t.layoutVertexBuffer,tt,pt,M.paint,E.transform.zoom,ot,Wt)}};E.renderPass===ie&&ze(E.depthModeForSublayer(1,E.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly),!1),de==="none"&&E.renderPass==="translucent"&&M.paint.get("fill-antialias")&&ze(E.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly),!0)}function bc(m,i,c,g,E,A,M,D){c.resetLayerRenderingStats(m);const z=m.context,U=z.gl,$=m.transform,ie=c.paint.get("fill-extrusion-pattern"),K=c.paint.get("fill-extrusion-pattern-cross-fade"),re=ie.constantOr(null),he=ie.constantOr(1),ce=c.paint.get("fill-extrusion-opacity"),de=m.style.enable3dLights(),ge=c.paint.get(de&&!he?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ce=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ge],Ae=c.layout.get("fill-extrusion-edge-radius"),Ee=Ae>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ge=Ee?0:Ae,je=$.projection.name==="globe"?a.eb():0,Ue=$.projection.name==="globe",ze=Ue?a.aj($.zoom):0,Pe=[a.aF($.center.lng),a.aJ($.center.lat)],We=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(We?null:c.lut).toArray01().slice(0,3),Qe=c.paint.get("fill-extrusion-flood-light-intensity"),rt=c.paint.get("fill-extrusion-vertical-scale"),tt=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=c.paint.get("fill-extrusion-height-alignment"),wt=c.paint.get("fill-extrusion-base-alignment"),nt=Ya(m,c.paint.get("fill-extrusion-cutoff-fade-range")),Ze=[];let _t;Ue&&Ze.push("PROJECTION_GLOBE_VIEW"),Ce[0]>0&&Ze.push("FAUX_AO"),Ee&&Ze.push("ZERO_ROOF_RADIUS"),D&&Ze.push("HAS_CENTROID"),Qe>0&&Ze.push("FLOOD_LIGHT"),nt.shouldRenderCutoff&&Ze.push("RENDER_CUTOFF"),tt&&Ze.push("RENDER_WALL_MODE");const ot=m.renderPass==="shadow",bt=m.shadowRenderer,Lt=ot&&!!bt,Wt=ot?Si.disabled:Si.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let jt=[0,0,0];if(bt){const ai=m.style.directionalLight,Xt=m.style.ambientLight;ai&&Xt&&(jt=ua(m.style,ai,Xt)),ot||(Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bt.useNormalOffset&&Ze.push("NORMAL_OFFSET")),_t=Ze.concat(["SHADOWS_SINGLE_CASCADE"])}const zt=Lt?"fillExtrusionDepth":he?"fillExtrusionPattern":"fillExtrusion",hi=c.getLayerRenderingStats();for(const ai of g){const Xt=i.getTile(ai),oi=Xt.getBucket(c);if(!oi||oi.projection.name!==$.projection.name)continue;let _i=!1;bt&&(_i=bt.getMaxCascadeForTile(ai.toUnwrapped())===0);const Ti=m.isTileAffectedByFog(ai),Fi=oi.programConfigurations.get(c.id);let Yi=!1;if(re&&Xt.imageAtlas){const er=Xt.imageAtlas,ji=a.e3.from(re),or=ji.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Hr=ji.getSecondary(),br=er.patternPositions.get(or),pr=Hr?er.patternPositions.get(Hr.scaleSelf(a.o.devicePixelRatio).toString()):null;Yi=!!br&&!!pr,br&&Fi.setConstantPatternPositions(br,pr)}K>0&&(Yi||Fi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ze.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ai=m.getOrCreateProgram(zt,{config:Fi,defines:_i?_t:Ze,overrideFog:Ti});if(m.terrain&&m.terrain.setupElevationDraw(Xt,Ai,{useMeterToDem:!0}),!oi.centroidVertexBuffer){const er=Ai.getAttributeLocation(U,"a_centroid_pos");er!==-1&&U.vertexAttrib2f(er,0,0)}!ot&&bt&&bt.setupShadows(Xt.tileID.toUnwrapped(),Ai,"vector-tile"),he&&(m.context.activeTexture.set(U.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Fi.updatePaintBuffers());const Bi=c.paint.get("fill-extrusion-vertical-gradient"),Di=1/oi.tileToMeter;let ur;if(ot&&bt){if(ud(Xt.tileID,oi.maxHeight,m))continue;const er=bt.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());ur=$l(er,Ge,Di,rt,pt,wt)}else{const er=m.translatePosMatrix(ai.expandedProjMatrix,Xt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ji=$.projection.createInversionMatrix($,ai.canonical);ur=he?xp(er,m,Bi,ce,Ce,Ge,Di,ai,Xt,je,pt,wt,ze,Pe,ji,Xe,rt,K):dl(er,m,Bi,ce,Ce,Ge,Di,ai,je,pt,wt,ze,Pe,ji,Xe,rt,Qe,jt)}m.uploadCommonUniforms(z,Ai,ai.toUnwrapped(),null,nt);let sr=oi.segments;if($.projection.name==="mercator"&&!ot&&(sr=oi.getVisibleSegments(Xt.tileID,m.terrain,m.transform.getFrustum(0)),!sr.get().length))continue;if(hi)if(ot)for(const er of sr.get())hi.numRenderedVerticesInShadowPass+=er.primitiveLength;else for(const er of sr.get())hi.numRenderedVerticesInTransparentPass+=er.primitiveLength;const vr=[];(m.terrain||D)&&vr.push(oi.centroidVertexBuffer),Ue&&vr.push(oi.layoutVertexExtBuffer),tt&&vr.push(oi.wallVertexBuffer),Ai.draw(m,z.gl.TRIANGLES,E,A,M,Wt,ur,c.id,oi.layoutVertexBuffer,oi.indexBuffer,sr,c.paint,m.transform.zoom,Fi,vr)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class lu{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function No(m,i,c,g,E,A,M,D,z,U,$,ie,K,re,he,ce,de,ge,Ce,Ae){const Ee=i.context,Ge=Ee.gl,je=i.transform,Ue=i.transform.zoom,ze=[],Pe=m.translate,We=m.translateAnchor,Xe=m.edgeRadius,Qe=Ya(i,m.cutoffFadeRange);$==="clear"?(ze.push("CLEAR_SUBPASS"),Ae&&(ze.push("CLEAR_FROM_TEXTURE"),Ee.activeTexture.set(Ge.TEXTURE0),Ae.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE))):$==="sdf"?ze.push("SDF_SUBPASS"):$==="emissive"&&(ze.push("USE_MRT1"),Ee.activeTexture.set(Ge.TEXTURE0),Ae.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)),ge&&ze.push("HAS_CENTROID"),Qe.shouldRenderCutoff&&ze.push("RENDER_CUTOFF");const rt=(tt,pt,wt,nt,Ze)=>{let _t=ze;pt.groundRadiusBuffer!=null&&(_t=ze.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ot=pt.programConfigurations.get(g.id),bt=i.isTileAffectedByFog(tt),Lt=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:ot,defines:_t,overrideFog:bt}),Wt=((zt,hi,ai,Xt,oi,_i,Ti,Fi,Yi,Ai,Bi)=>({u_matrix:hi,u_opacity:ai,u_ao_pass:Xt?1:0,u_meter_to_tile:oi,u_ao:_i,u_flood_light_intensity:Ti,u_flood_light_color:Fi,u_attenuation:Yi,u_edge_radius:Ai,u_fb:0,u_fb_size:Bi,u_dynamic_offset:1}))(0,nt,ie,U,Ze,[K,re*Ze],he,ce,de,Ue>=17?0:Xe*Ze,Ae?Ae.size[0]:0),jt=[];ge&&jt.push(pt.hiddenByLandmarkVertexBuffer),pt.groundRadiusBuffer!=null&&jt.push(pt.groundRadiusBuffer),i.uploadCommonUniforms(Ee,Lt,tt.toUnwrapped(),null,Qe),Lt.draw(i,Ee.gl.TRIANGLES,A,M,D,z,Wt,g.id,pt.vertexBuffer,pt.indexBuffer,wt,g.paint,Ue,ot,jt)};for(const tt of E){const pt=c.getTile(tt),wt=pt.getBucket(g);if(!wt||wt.projection.name!==je.projection.name||!wt.groundEffect||wt.groundEffect&&!wt.groundEffect.hasData())continue;const nt=wt.groundEffect,Ze=1/wt.tileToMeter;{const _t=i.translatePosMatrix(tt.projMatrix,pt,Pe,We),ot=nt.getDefaultSegment();rt(tt,nt,ot,_t,Ze)}if(Ce)for(let _t=0;_t<4;_t++){const ot=a.e9[_t](tt),bt=c.getTile(ot);if(!bt)continue;const Lt=bt.getBucket(g);if(!Lt||Lt.projection.name!==je.projection.name||!Lt.groundEffect||Lt.groundEffect&&!Lt.groundEffect.hasData())continue;const Wt=Lt.groundEffect;let jt,zt;_t===0?(jt=[-a.al,0,0],zt=1):_t===1?(jt=[a.al,0,0],zt=0):_t===2?(jt=[0,-a.al,0],zt=3):(jt=[0,a.al,0],zt=2);const hi=Wt.regionSegments[zt];if(!hi)continue;const ai=new Float32Array(16);a.br(ai,tt.projMatrix,jt),rt(tt,Wt,hi,i.translatePosMatrix(ai,pt,Pe,We),Ze)}}}function wp(m,i,c,g,E,A,M){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const D=A?A.findDEMTileFor(c):null;if(!(D&&D.dem||M))return;A&&D&&D.dem&&g.selfDEMTileTimestamp!==D.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=D.dem._timestamp);const z=(de,ge)=>{(de.flags|ge.flags)&a.ec?(de.flags|=a.ec,ge.flags|=a.ec):(de.flags&=~a.ec,ge.flags&=~a.ec)},U=de=>new a.P(Math.ceil((de+a.ed)*a.ee),0),$=de=>{const ge=i.getSource().minzoom,Ce=Ee=>{const Ge=i.getTileByID(Ee);if(Ge&&Ge.hasData())return Ge.getBucket(E)},Ae=[0,-1,1];for(const Ee of Ae){if(de.overscaledZ+Ee<ge)continue;const Ge=Ce(de.calculateScaledKey(de.overscaledZ+Ee));if(Ge)return Ge}},ie=[0,0,0],K=(de,ge)=>(ie[0]=Math.min(de.min.y,ge.min.y),ie[1]=Math.max(de.max.y,ge.max.y),ie[2]=a.al-ge.min.x>de.max.x?ge.min.x-a.al:de.max.x,ie),re=(de,ge)=>(ie[0]=Math.min(de.min.x,ge.min.x),ie[1]=Math.max(de.max.x,ge.max.x),ie[2]=a.al-ge.min.y>de.max.y?ge.min.y-a.al:de.max.y,ie),he=[(de,ge)=>K(de,ge),(de,ge)=>K(ge,de),(de,ge)=>re(de,ge),(de,ge)=>re(ge,de)],ce=(de,ge,Ce,Ae,Ee,Ge,je)=>{if(!A)return 0;const Ue=[[Ge?Ce:de,Ge?de:Ce,0],[Ge?Ce:ge,Ge?ge:Ce,0]],ze=je<0?a.al+je:je,Pe=[Ge?ze:(de+ge)/2,Ge?(de+ge)/2:ze,0];return Ce===0&&je<0||Ce!==0&&je>0?A.getForTilePoints(Ee,[Pe],!0,Ae):Ue.push(Pe),A.getForTilePoints(c,Ue,!0,D),Math.max(Ue[0][2],Ue[1][2],Pe[2])/A.exaggeration()};for(let de=0;de<4;de++){const ge=g.borderFeatureIndices[de];if(ge.length===0)continue;const Ce=a.e9[de](c),Ae=$(Ce);if(!(Ae&&Ae instanceof a.ea))continue;const Ee=A?A.findDEMTileFor(Ce):null;if(!(Ee&&Ee.dem||M)||(A&&Ee&&Ee.dem&&g.borderDEMTileTimestamp[de]!==Ee.dem._timestamp&&(g.borderDoneWithNeighborZ[de]=-1,g.borderDEMTileTimestamp[de]=Ee.dem._timestamp),g.borderDoneWithNeighborZ[de]===Ae.canonical.z))continue;Ae.centroidVertexArray.length===0&&Ae.createCentroidsBuffer();const Ge=(de<2?1:5)-de,je=Ae.borderDoneWithNeighborZ[Ge]!==g.canonical.z,Ue=Ae.borderFeatureIndices[Ge];let ze=0;if(g.canonical.z!==Ae.canonical.z){for(const Pe of ge)g.showCentroid(g.featuresOnBorder[Pe]);if(je)for(const Pe of Ue)Ae.showCentroid(Ae.featuresOnBorder[Pe]);g.borderDoneWithNeighborZ[de]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Ge]=g.canonical.z}for(const Pe of ge){const We=g.featuresOnBorder[Pe],Xe=g.centroidData[We.centroidDataIndex],Qe=We.borders[de];let rt;for(;ze<Ue.length;){rt=Ae.featuresOnBorder[Ue[ze]];const tt=rt.borders[Ge];if(tt[1]>Qe[0]+3||tt[0]>Qe[0]-3)break;Ae.showCentroid(rt),ze++}if(rt&&ze<Ue.length){const tt=ze;let pt=0;for(;!(rt.borders[Ge][0]>Qe[1]-3)&&(pt++,++ze!==Ue.length);)rt=Ae.featuresOnBorder[Ue[ze]];rt=Ae.featuresOnBorder[Ue[tt]];let wt=!1;if(pt>=1){const _t=rt.borders[Ge];Math.abs(Qe[0]-_t[0])<3&&Math.abs(Qe[1]-_t[1])<3&&(pt=1,wt=!0,ze=tt+1)}else if(pt===0){g.showCentroid(We);continue}const nt=Ae.centroidData[rt.centroidDataIndex];M&&wt&&z(Xe,nt);const Ze=We.intersectsCount()>1||rt.intersectsCount()>1;if(pt>1)ze=tt,Xe.centroidXY=nt.centroidXY=new a.P(0,0);else if(Ee&&Ee.dem&&!Ze){const _t=he[de](Xe,nt),ot=de%2?a.al-1:0,bt=ce(_t[0],Math.min(a.al-1,_t[1]),ot,Ee,Ce,de<2,_t[2]);Xe.centroidXY=nt.centroidXY=U(bt)}else Ze?Xe.centroidXY=nt.centroidXY=new a.P(0,0):(Xe.centroidXY=g.encodeBorderCentroid(We),nt.centroidXY=Ae.encodeBorderCentroid(rt));g.writeCentroidToBuffer(Xe),Ae.writeCentroidToBuffer(nt)}else g.showCentroid(We)}g.borderDoneWithNeighborZ[de]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Ge]=g.canonical.z}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const jm=[1,0,0],hf=[0,1,0],df=[0,0,1];function ud(m,i,c){const g=c.transform,E=c.shadowRenderer;if(!E)return!0;const A=m.toUnwrapped(),M=g.tileSize*E._cascades[c.currentShadowCascade].scale;let D=i;if(g.elevation){const ce=g.elevation.getMinMaxForTile(m);ce&&(D+=ce.max)}const z=[...E.shadowDirection];z[2]=-z[2];const U=E.computeSimplifiedTileShadowVolume(A,D,M,z);if(!U)return!1;const $=[jm,hf,df,z,[z[0],0,z[2]],[0,z[1],z[2]]],ie=g.projection.name==="globe",K=g.scaleZoom(M),re=a.cB.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,K,!ie),he=E.getCurrentCascadeFrustum();return re.intersectsPrecise(U.vertices,U.planes,$)===0||he.intersectsPrecise(U.vertices,U.planes,$)===0}function bs(m){const{painter:i,source:c,layer:g,coords:E}=m;let A=m.defines;const M=i.context,D=i.renderPass==="shadow",z=i.renderPass==="light-beam",U=i.shadowRenderer,$=a.ef(i.transform.center.lat,i.transform.zoom),ie=Ya(i,g.paint.get("building-cutoff-fade-range"));ie.shouldRenderCutoff&&(A=A.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(A=A.concat("FLOOD_LIGHT"));for(const K of E){const re=c.getTile(K),he=re.getBucket(g);if(!he)continue;U&&U.getMaxCascadeForTile(K.toUnwrapped())===0&&(A=A.concat("SHADOWS_SINGLE_CASCADE"));const ce=he.programConfigurations.get(g.id);let de,ge,Ce,Ae=i.translatePosMatrix(K.expandedProjMatrix,re,[0,0],"map");if(Ae=a.cS(a.bC(),Ae,[1,1,m.verticalScale]),D&&U){if(ud(re.tileID,he.maxHeight*$,i))continue;let Ge=U.calculateShadowPassMatrixFromTile(re.tileID.toUnwrapped());Ge=a.cS(a.bC(),Ge,[1,1,m.verticalScale]),Ce=Sa(Ge),de=ge=i.getOrCreateProgram("buildingDepth",{config:ce,defines:A,overrideFog:!1})}else if(z)de=ge=i.getOrCreateProgram("buildingBloom",{config:ce,defines:A,overrideFog:!1}),Ce=vp(Ae);else{const Ge=i.transform.calculatePosMatrix(K.toUnwrapped(),i.transform.worldSize);a.cS(Ge,Ge,[1,1,m.verticalScale]);const je=a.bC();a.cS(je,Ge,[1,-1,1/$]),a.bl(je,je),a.eg(je,je);const Ue=i.transform.getFreeCameraOptions().position,ze=1<<K.canonical.z;if(Ce=fl(Ae,je,m.opacity,m.facadeAOIntensity,[((Ue.x-K.wrap)*ze-K.canonical.x)*a.al,(Ue.y*ze-K.canonical.y)*a.al,Ue.z*ze*a.al],he.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),ge=i.getOrCreateProgram("building",{config:ce,defines:A,overrideFog:!1}),m.depthOnly===!0)de=ge;else{const Pe=A.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);de=i.getOrCreateProgram("building",{config:ce,defines:Pe,overrideFog:!1})}U&&(U.setupShadowsFromMatrix(Ge,ge,!0),de!==ge&&U.setupShadowsFromMatrix(Ge,de,!0))}const Ee=(Ge,je)=>{if(z){const Ue=Ge.entranceBloom;je.draw(i,M.gl.TRIANGLES,m.depthMode,Mi.disabled,m.blendMode,Si.disabled,Ce,g.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segmentsBucket,g.paint,i.transform.zoom,ce,[Ue.layoutAttenuationBuffer,Ue.layoutColorBuffer])}else{const Ue=Ge.segmentsBucket;let ze=[Ge.layoutNormalBuffer,Ge.layoutCentroidBuffer,Ge.layoutColorBuffer,Ge.layoutFloodLightDataBuffer];Ge.layoutFacadePaintBuffer&&(ze=ze.concat([Ge.layoutFacadeDataBuffer,Ge.layoutFacadeVerticalRangeBuffer,Ge.layoutFacadePaintBuffer])),je.draw(i,M.gl.TRIANGLES,m.depthMode,Mi.disabled,m.blendMode,D?Si.disabled:Si.backCW,Ce,g.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ue,g.paint,i.transform.zoom,ce,ze)}};i.uploadCommonUniforms(M,ge,K.toUnwrapped(),null,ie),he.buildingWithoutFacade&&Ee(he.buildingWithoutFacade,ge),he.buildingWithFacade&&(de!==ge&&i.uploadCommonUniforms(M,de,K.toUnwrapped(),null,ie),Ee(he.buildingWithFacade,de))}}function Hn(m,i,c,g,E,A,M,D,z,U,$,ie,K){const re=m.context.gl,he=m.depthModeForSublayer(1,fi.ReadOnly,re.LEQUAL,!0),ce=.1*(1-(de=$))+3*de;var de;const ge=m._showOverdrawInspector,Ce=ie,Ae=new lu;ge||No(Ae,m,i,c,g,he,new Mi({func:re.ALWAYS,mask:255},255,255,re.KEEP,re.KEEP,re.REPLACE),new Ii([re.ONE,re.ONE,re.ONE,re.ONE],a.ao.transparent,[!1,!1,!1,!0],re.MIN),Si.disabled,E,"sdf",A,M,D,z,U,ce,Ce,!1);{const Ee=ge?Mi.disabled:new Mi({func:re.EQUAL,mask:255},255,255,re.KEEP,re.DECR,re.DECR),Ge=ge?m.colorModeForRenderPass():new Ii([re.ONE_MINUS_DST_ALPHA,re.DST_ALPHA,re.ONE,re.ONE],a.ao.transparent,[!0,!0,!0,!0]);No(Ae,m,i,c,g,he,Ee,Ge,Si.disabled,E,"color",A,M,D,z,U,ce,Ce,!1)}}function sh(m){return[m[0]*a.eh,m[1]*a.eh,m[2]*a.eh,0]}function wc(m,i,c,g,E,A,M,D,z){const U=g.getSource(),$=c.globeSharedBuffers;if(!$)return;let ie,K,re;if(i&&(ie=g.getTile(i)),U instanceof a.aU?(K=U.texture,re=a.dK(0,0,c.transform)):ie&&i&&(K=ie.texture,re=a.dK(i.canonical.z,i.canonical.x,c.transform)),!K||!re)return;m||(re=a.cS(a.bC(),re,[1,-1,1]));const he=c.context,ce=he.gl,de=E.paint.get("raster-resampling")==="nearest"?ce.NEAREST:ce.LINEAR,ge=c.colorModeForDrapableLayerRenderPass(A),Ce=M.defines;Ce.push("GLOBE_POLES");const Ae=new fi(ce.LEQUAL,fi.ReadWrite,c.depthRangeFor3D),Ee=Float32Array.from(c.transform.expandedFarZProjMatrix),Ge=Float32Array.from(a.bk(a.dJ(new a.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),he.activeTexture.set(ce.TEXTURE0),K.bind(de,ce.CLAMP_TO_EDGE),he.activeTexture.set(ce.TEXTURE1),K.bind(de,ce.CLAMP_TO_EDGE),"useMipmap"in K&&he.extTextureFilterAnisotropic&&c.transform.pitch>20&&ce.texParameterf(ce.TEXTURE_2D,he.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,he.extTextureFilterAnisotropicMax);const[je,Ue,ze,Pe]=i?$.getPoleBuffers(i.canonical.z,!1):$.getPoleBuffers(0,!0),We=E.paint.get("raster-elevation");let Xe;m?(Xe=je,c.renderDefaultNorthPole=We!==0):(Xe=Ue,c.renderDefaultSouthPole=We!==0);const Qe=sh(M.mix),rt=((pt,wt,nt,Ze,_t,ot,bt,Lt,Wt,jt,zt,hi,ai)=>tu(pt,wt,nt,new Float32Array(16),new Float32Array(9),[0,0],Ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ot,[0,0],Lt,2,jt,zt,hi,1,0,ai))(Ee,Ge,re,a.aj(c.transform.zoom),0,E,0,We,0,Qe,M.offset,M.range,A),tt=c.getOrCreateProgram("raster",{defines:Ce});c.uploadCommonUniforms(he,tt,null),tt.draw(c,ce.TRIANGLES,Ae,z,ge,D,rt,E.id,Xe,ze,Pe)}function hd(m){if(m.isOrthographic)return[0,0,0,0];const i=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-i,E=.2*m.height,A=i+E;return[i,c,(A-E-i)/g,(A-i)/g]}function ff(m,i,c,g){if(m)return i instanceof Zs&&m instanceof ku?i.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:sh(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Vo=a.ei([{name:"a_index",type:"Int16",components:1}]);class dd{constructor(i,c,g,E){const A={width:g[0],height:g[1],data:null},M=i.gl;this.targetColorTexture=new a.T(i,A,M.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(i,A,M.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(c,E),this.lastInvalidatedAt=0}updateParticleTexture(i,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,E=c.width*c.height;this.particleTexture0=new a.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1});const A=new a.ej;A.reserve(E);for(let M=0;M<E;M++)A.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(A,Vo.members,!0),this.particleSegment=a.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=a.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fd(m,i,c){if(!m)return null;const g=i.getTextureDescriptor(m,c,!0);if(!g)return null;let{texture:E,mix:A,offset:M,tileSize:D,buffer:z,format:U}=g;if(!E||!U)return null;let $=!1;return U==="uint32"&&($=!0,A[3]=0,A=nh(a.ek,A,[0,c.paint.get("raster-particle-max-speed")]),M=cf(a.ek,M,[0,c.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[z/(D+2*z),D/(D+2*z)],tileSize:D,scalarData:$,scale:A,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[U]]}}function pf(m){const i=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-i,E=.2*m.height,A=i+E;return[i,c,(A-E-i)/g,(A-i)/g]}const mf=new a.ao(1,0,0,1),gf=new a.ao(0,1,0,1),yf=new a.ao(0,0,1,1),Nm=new a.ao(1,0,1,1),Vm=new a.ao(0,1,1,1);function Ep(m,i,c,g,E,A){for(let M=0;M<c.length;M++)if(E){const U=new a.ao(g.r*.8,g.g*.8,g.b*.8,1);yl(m,i,c[M],g,-1,-1,A),yl(m,i,c[M],g,-1,1,A),yl(m,i,c[M],g,1,1,A),yl(m,i,c[M],g,1,-1,A),yl(m,i,c[M],U,0,0,A)}else yl(m,i,c[M],g,0,0,A)}function yl(m,i,c,g,E,A,M){const D=m.context,z=m.transform,U=D.gl,$=z.projection.name==="globe",ie=$?["PROJECTION_GLOBE_VIEW"]:[];let K=a.bz(c.projMatrix);if($&&a.aj(z.zoom)>0){const Qe=a.bj(c.canonical,z),rt=a.el(Qe);K=a.aB(new Float32Array(16),z.globeMatrix,rt),a.aB(K,z.projMatrix,K)}const re=a.bC();re[12]+=2*E/(a.o.devicePixelRatio*z.width),re[13]+=2*A/(a.o.devicePixelRatio*z.height),a.aB(K,re,K);const he=m.getOrCreateProgram("debug",{defines:ie}),ce=i.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(ce,he);const de=fi.disabled,ge=Mi.disabled,Ce=m.colorModeForRenderPass(),Ae="$debug";D.activeTexture.set(U.TEXTURE0),m.emptyTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$?ce._makeGlobeTileDebugBuffers(m.context,z):ce._makeDebugTileBoundsBuffers(m.context,z.projection);const Ee=ce._tileDebugBuffer||m.debugBuffer,Ge=ce._tileDebugIndexBuffer||m.debugIndexBuffer,je=ce._tileDebugSegments||m.debugSegments;if(he.draw(m,U.LINE_STRIP,de,ge,Ce,Si.disabled,pl(K,g.toPremultipliedRenderColor(null)),Ae,Ee,Ge,je,null,null,null,[ce._globeTileDebugBorderBuffer]),M){const Qe=ce.latestRawTileData,rt=Math.floor((Qe&&Qe.byteLength||0)/1024);let tt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(tt+=` => ${c.overscaledZ}`),tt+=` ${ce.state}`,tt+=` ${rt}kb`,(function(pt,wt){pt.initDebugOverlayCanvas();const nt=pt.debugOverlayCanvas,Ze=pt.context.gl,_t=pt.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,nt.width,nt.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(wt,5,5),_t.strokeText(wt,5,5),pt.debugOverlayTexture.update(nt),pt.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)})(m,tt)}const Ue=i.getTile(c).tileSize,ze=512/Math.min(Ue,512)*(c.overscaledZ/z.zoom)*.5,Pe=ce._tileDebugTextBuffer||m.debugBuffer,We=ce._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Xe=ce._tileDebugTextSegments||m.debugSegments;he.draw(m,U.TRIANGLES,de,ge,Ii.alphaBlended,Si.disabled,pl(K,a.ao.transparent.toPremultipliedRenderColor(null),ze),Ae,Pe,We,Xe,null,null,null,[ce._globeTileDebugTextBuffer])}function Sp(m,i,c,g){pd(m,0,i+c/2,m.transform.width,c,g)}function Tp(m,i,c,g){pd(m,i-c/2,0,c,m.transform.height,g)}function pd(m,i,c,g,E,A){const M=m.context,D=M.gl;D.enable(D.SCISSOR_TEST),D.scissor(i*a.o.devicePixelRatio,c*a.o.devicePixelRatio,g*a.o.devicePixelRatio,E*a.o.devicePixelRatio),M.clear({color:A}),D.disable(D.SCISSOR_TEST)}const Ap=a.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Um}=Ap;function _l(m,i,c,g){m.emplaceBack(i,c,g)}class fa{constructor(i){this.vertexArray=new a.em,this.indices=new a.b0,_l(this.vertexArray,-1,-1,1),_l(this.vertexArray,1,-1,1),_l(this.vertexArray,-1,1,1),_l(this.vertexArray,1,1,1),_l(this.vertexArray,-1,-1,-1),_l(this.vertexArray,1,-1,-1),_l(this.vertexArray,-1,1,-1),_l(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Um),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=a.bg.simpleSegment(0,0,36,12)}}function Wl(m,i,c,g,E,A){const M=m.context.gl,D=i.paint.get("sky-atmosphere-color"),z=i.paint.get("sky-atmosphere-halo-color"),U=i.paint.get("sky-atmosphere-sun-intensity"),$=((ie,K,re,he,ce)=>({u_matrix_3f:ie,u_sun_direction:K,u_sun_intensity:re,u_color_tint_r:[he.r,he.g,he.b,he.a],u_color_tint_m:[ce.r,ce.g,ce.b,ce.a],u_luminance:5e-5}))(a.eo(a.dO(),g),E,U,D.toPremultipliedRenderColor(null),z.toPremultipliedRenderColor(null));M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+A,i.skyboxTexture,0),c.draw(m,M.TRIANGLES,fi.disabled,Mi.disabled,Ii.unblended,Si.frontCW,$,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const ea=a.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zl{constructor(i){const c=new a.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const g=new a.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(c,ea.members),this.indexBuffer=i.createIndexBuffer(g),this.segments=a.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Cp=a.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Rp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _f{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Ii([1,cc,1,cc],a.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ii([1,0,1,0],a.ao.transparent,[!1,!1,!1,!0]),this.params=new Rp,this.updateNeeded=!0}update(i){const c=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zl(c);const g=this.params.sizeRange,E=this.params.intensityRange,A=(function($){const ie=a.eq(30),K=[];for(let re=0;re<$;++re){const he=2*Math.PI*ie(),ce=Math.acos(1-2*ie())-.5*Math.PI;K.push(a.d5(Math.cos(ce)*Math.cos(he),Math.cos(ce)*Math.sin(he),Math.sin(ce)))}return K})(this.params.starsCount),M=a.eq(300),D=new a.er,z=new a.b0;let U=0;for(let $=0;$<A.length;++$){const ie=a.c5([],A[$],200),K=Math.max(0,1+.01*g*(1*M()-.5)),re=Math.max(0,1+.01*E*(1*M()-.5));D.emplaceBack(ie[0],ie[1],ie[2],-1,-1,K,re),D.emplaceBack(ie[0],ie[1],ie[2],1,-1,K,re),D.emplaceBack(ie[0],ie[1],ie[2],1,1,K,re),D.emplaceBack(ie[0],ie[1],ie[2],-1,1,K,re),z.emplaceBack(U+0,U+1,U+2),z.emplaceBack(U+0,U+2,U+3),U+=4}this.starsVx=c.createVertexBuffer(D,Cp.members),this.starsIdx=c.createIndexBuffer(z),this.starsSegments=a.bg.simpleSegment(0,0,D.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,c){const g=i.context,E=g.gl,A=i.transform,M=new fi(E.LEQUAL,fi.ReadOnly,[0,1]),D=a.aj(A.zoom),z=i.style.getLut(c.scope),U=c.properties.get("color-use-theme")==="none",$=c.properties.get("color").toNonPremultipliedRenderColor(U?null:z),ie=c.properties.get("high-color-use-theme")==="none",K=c.properties.get("high-color").toNonPremultipliedRenderColor(ie?null:z),re=c.properties.get("space-color-use-theme")==="none",he=c.properties.get("space-color").toNonPremultipliedRenderColor(re?null:z),ce=5e-4,de=a.es(c.properties.get("horizon-blend"),0,1,ce,.25),ge=a.dE(i,g,A)&&de===ce?A.worldSize/(2*Math.PI*1.025)-1:A.globeRadius,Ce=i.frameCounter/1e3%1,Ae=a.ag(A.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Ae,2)-Math.pow(ge,2)),Ge=Math.acos(Ee/Ae),je=Ue=>{const ze=A.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ue&&ze.push("ALPHA_PASS");const Pe=i.getOrCreateProgram("globeAtmosphere",{defines:ze}),We=((Qe,rt,tt,pt,wt,nt,Ze,_t,ot,bt,Lt,Wt)=>({u_frustum_tl:Qe,u_frustum_tr:rt,u_frustum_br:tt,u_frustum_bl:pt,u_horizon:wt,u_transition:nt,u_fadeout_range:Ze,u_atmosphere_fog_color:_t.toArray01(),u_high_color:ot.toArray01(),u_space_color:bt.toArray01(),u_temporal_offset:Lt,u_horizon_angle:Wt}))(A.frustumCorners.TL,A.frustumCorners.TR,A.frustumCorners.BR,A.frustumCorners.BL,A.frustumCorners.horizon,D,de,$,K,he,Ce,Ge);i.uploadCommonUniforms(g,Pe);const Xe=this.atmosphereBuffer;Xe&&Pe.draw(i,E.TRIANGLES,M,Mi.disabled,Ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Si.backCW,We,Ue?"atmosphere_glow_alpha":"atmosphere_glow",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)};je(!1),je(!0)}drawStars(i,c){const g=a.aA(c.properties.get("star-intensity"),0,1);if(g===0)return;const E=i.context,A=E.gl,M=i.transform,D=i.getOrCreateProgram("stars"),z=a.c7([]);a.c9(z,z,-M._pitch),a.c8(z,z,-M.angle),a.c9(z,z,a.an(M._center.lat)),a.et(z,z,-a.an(M._center.lng));const U=a.cc(new Float32Array(16),z),$=a.aB([],M.starsProjMatrix,U),ie=a.eo([],U),K=a.eu([],ie),re=[0,1,0];a.dQ(re,re,K),a.c5(re,re,this.params.sizeMultiplier);const he=[1,0,0];a.dQ(he,he,K),a.c5(he,he,this.params.sizeMultiplier);const ce=(de=re,ge=he,Ce=g,{u_matrix:Float32Array.from($),u_up:de,u_right:ge,u_intensity_multiplier:Ce});var de,ge,Ce;i.uploadCommonUniforms(E,D),this.starsVx&&this.starsIdx&&D.draw(i,A.TRIANGLES,fi.disabled,Mi.disabled,this.colorModeAlphaBlendedWriteRGB,Si.disabled,ce,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ec{constructor(){this.visibleTiles=[]}updateBorders(i,c){const g=[],E=[],A=i._getRenderableCoordinates(!1,!0);for(const z of A){const U=i.getTile(z);if(!U.hasData())continue;const $=U.getBucket(c);$&&($.isEmpty()||(g.push(z.key),E.push({bucket:$,tileID:z.canonical})))}let M=g.length!==this.visibleTiles.length;if(!M){g.sort();for(let z=0;z<g.length;z++)if(g[z]!==this.visibleTiles[z]){M=!0;break}}if(!M)return;const D=new Set;this.visibleTiles=g,E.sort((z,U)=>z.tileID.z-U.tileID.z||z.tileID.x-U.tileID.x||z.tileID.y-U.tileID.y);for(const z of E){const U=new Array,$=new Array,ie=z.bucket;for(const K of ie.featuresOnBorder)D.has(K.featureId)?$.push(K.footprintIndex):(D.add(K.featureId),U.push(K.footprintIndex));ie.updateFootprintHiddenFlags(U,a.ev,!1),ie.updateFootprintHiddenFlags($,a.ev,!0)}}}function xf(m,i){const c=[...m],g=i.cameraWorldSizeForFog/i.worldSize,E=a.bA([]);return a.cS(E,E,[g,g,1]),a.aB(c,E,c),a.aB(c,i.worldToFogMatrix,c),c}function Fa(m,i,c,g,E){const A=c.material,M=g.context,{baseColorTexture:D,metallicRoughnessTexture:z}=A.pbrMetallicRoughness,{normalTexture:U,occlusionTexture:$,emissionTexture:ie}=A;function K(he,ce,de){if(he&&(m.push(ce),M.activeTexture.set(M.gl.TEXTURE0+de),he.gfxTexture)){const{minFilter:ge,magFilter:Ce,wrapS:Ae,wrapT:Ee}=he.sampler;he.gfxTexture.bindExtraParam(ge,Ce,Ae,Ee)}}K(D,"HAS_TEXTURE_u_baseColorTexture",5),K(z,"HAS_TEXTURE_u_metallicRoughnessTexture",6),K(U,"HAS_TEXTURE_u_normalTexture",7),K($,"HAS_TEXTURE_u_occlusionTexture",8),K(ie,"HAS_TEXTURE_u_emissionTexture",9),E&&(E.texture||(E.texture=new a.d$(g.context,E.image,[E.image.height,E.image.height,E.image.height],M.gl.RGBA8)),M.activeTexture.set(M.gl.TEXTURE0+10),E.texture&&E.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(c.pbrBuffer)),A.alphaMode!=="OPAQUE"&&A.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),A.defined||m.push("DIFFUSE_SHADED");const re=g.shadowRenderer;re&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&m.push("NORMAL_OFFSET"))}function xr(m,i,c,g,E,A){const M=m.modelOpacity,D=i.context,z=new fi(i.context.gl.LEQUAL,m.isLightMesh?fi.ReadOnly:fi.ReadWrite,i.depthRangeFor3D),U=i.transform,$=m.mesh,ie=$.material,K=ie.pbrMetallicRoughness,re=i.style.fog;let he;he=i.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:a.aB([],g.zScaleMatrix,m.nodeModelMatrix),a.aB(he,g.negCameraPosMatrix,he);const ce=a.bl([],he);a.eg(ce,ce);const de=c.paint.get("model-color-use-theme").constantOr("default")==="none",ge=c.paint.get("model-emissive-strength").constantOr(0),Ce=jo(new Float32Array(m.worldViewProjection),new Float32Array(he),new Float32Array(ce),null,i,M,K.baseColorFactor,ie.emissiveFactor,K.metallicFactor,K.roughnessFactor,ie,ge,c,void 0,void 0,m.materialOverride,m.modelColor),Ae={defines:[]},Ee=[],Ge=i.shadowRenderer;Ge&&(Ge.useNormalOffset=!1),Fa(Ae.defines,Ee,$,i,de?null:c.lut);let je=null;if(re){const Pe=xf(m.nodeModelMatrix,i.transform);if(je=new Float32Array(Pe),U.projection.name!=="globe"){const We=$.aabb.min,Xe=$.aabb.max,[Qe,rt]=re.getOpacityForBounds(Pe,We[0],We[1],Xe[0],Xe[1]);Ae.overrideFog=Qe>=ii||rt>=ii}}const Ue=Ya(i,c.paint.get("model-cutoff-fade-range"));Ue.shouldRenderCutoff&&Ae.defines.push("RENDER_CUTOFF");const ze=i.getOrCreateProgram("model",Ae);i.uploadCommonUniforms(D,ze,null,je,Ue),i.renderPass!=="shadow"&&Ge&&Ge.setupShadowsFromMatrix(m.nodeModelMatrix,ze),ze.draw(i,D.gl.TRIANGLES,z,E,A,$.material.doubleSided?Si.disabled:Si.backCCW,Ce,c.id,$.vertexBuffer,$.indexBuffer,$.segments,c.paint,i.transform.zoom,void 0,Ee)}function ah(m,i){return m.style._importedAsBasemap?"basemap":i.scope}function cu(m,i,c,g,E,A,M,D,z,U){const $=m.transform,ie=!!i.isGeometryBloom&&i.isGeometryBloom;if(ie&&m.renderPass==="shadow")return;const K=$.projection.name==="globe"?a.eD(c,$):[...c];a.aB(K,K,i.globalMatrix);const re=a.aB([],g,K);if(i.meshes)for(const he of i.meshes){const ce=D.get(he.material.name);if(ce&&ce.opacity<=0)continue;if(he.material.alphaMode!=="BLEND"){M.push({mesh:he,depth:0,modelIndex:E,worldViewProjection:re,nodeModelMatrix:K,isLightMesh:ie,materialOverride:ce,modelOpacity:z,modelColor:U});continue}const de=a.af([],he.centroid,re);!$.isOrthographic&&de[2]<=0||A.push({mesh:he,depth:de[2],modelIndex:E,worldViewProjection:re,nodeModelMatrix:K,isLightMesh:ie,materialOverride:ce,modelOpacity:z,modelColor:U})}if(i.children)for(const he of i.children)cu(m,he,c,g,E,A,M,D,z,U)}function oh(m,i,c,g){const E=c.shadowRenderer;if(!E)return;const A=E.getShadowPassDepthMode(),M=E.getShadowPassColorMode(),D=E.calculateShadowPassMatrixFromMatrix(i),z=su(D);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,A,Mi.disabled,M,Si.disabled,z,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,c.transform.zoom,void 0,void 0)}function Mp(m,i,c,g,E,A){for(const M of E){const D=Object.assign({},g);D.part=M;const z={type:"Unknown",id:i,properties:D},U={orientation:m.paint.get("model-rotation").evaluate(z,c)};A.set(M,U)}}function Pp(m,i,c,g,E,A){for(const M of E){const D=Object.assign({},g);D.part=M;const z={type:"Unknown",id:i,properties:D},U={color:m.paint.get("model-color").evaluate(z,c),colorMix:m.paint.get("model-color-mix-intensity").evaluate(z,c),opacity:m.paint.get("model-opacity").evaluate(z,c),emissionStrength:m.paint.get("model-emissive-strength").evaluate(z,c)};A.set(M,U)}}function vf(m,i,c,g,E){let A=!1;for(const D of g)D.modelOpacity!==1&&(xr(D,m,i,E[D.modelIndex],Mi.disabled,Ii.disabled),A=!0);for(const D of g)xr(D,m,i,E[D.modelIndex],D.modelOpacity!==1?m.stencilModeFor3D():Mi.disabled,m.colorModeForRenderPass());A&&m.resetStencilClippingMasks();const M=Ii.additive;for(const D of c)xr(D,m,i,E[D.modelIndex],Mi.disabled,D.isLightMesh?M:m.colorModeForRenderPass())}function Sc(m,i,c){const g=i.updateZoomBasedPaintProperties(),E=(function(A,M,D){let z,U,$,ie=A.terrain?A.terrain.exaggeration():0;if(A.terrain&&ie>0){const K=A.terrain,re=K.findDEMTileFor(D);re&&re.dem?z=a.eF.create(K,D,re):ie=0}if(ie===0&&(M.terrainElevationMin=0,M.terrainElevationMax=0),ie===M.validForExaggeration&&(ie===0||z&&z._demTile&&z._demTile.tileID===M.validForDEMTile.id&&z._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const K in M.instancesPerModel){const re=M.instancesPerModel[K];for(let he=0;he<re.instancedDataArray.length;++he){const ce=(z?ie*z.getElevationAt(0|re.instancedDataArray.float32[16*he],0|re.instancedDataArray.float32[16*he+1],!0,!0):0)+re.instancesEvaluatedElevation[he];re.instancedDataArray.float32[16*he+6]=ce,U=U?Math.min(M.terrainElevationMin,ce):ce,$=$?Math.max(M.terrainElevationMax,ce):ce}}return M.terrainElevationMin=U||0,M.terrainElevationMax=$||0,M.validForExaggeration=ie,M.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0})(m,i,c);(g||E)&&(i.uploaded=!1,i.upload(m.context))}const ta={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d9([0,0,0],[a.al,a.al,0])};function Nt(m,i){const c=1<<m.canonical.z,g=i.getFreeCameraOptions().position,E=i.elevation,A=m.canonical.x/c,M=(m.canonical.x+1)/c,D=m.canonical.y/c,z=(m.canonical.y+1)/c;let U=i._centerAltitude;if(E){const re=E.getMinMaxForTile(m);re&&re.max>U&&(U=re.max)}const $=a.aA(g.x,A,M)-g.x,ie=a.aA(g.y,D,z)-g.y,K=a.cf(U,i.center.lat)-g.z;return i._zoomFromMercatorZ(Math.sqrt($*$+ie*ie+K*K))}function Qt(m,i,c,g,E,A,M){const D=m.context,z=m.renderPass==="shadow",U=m.shadowRenderer,$=z&&U?U.getShadowPassDepthMode():new fi(D.gl.LEQUAL,fi.ReadWrite,m.depthRangeFor3D),ie=m.isTileAffectedByFog(A),K=m.transform.projection.name==="globe";if(c.meshes)for(const re of c.meshes){const he=K?[]:["MODEL_POSITION_ON_GPU"],ce=[];let de,ge,Ce;const Ae=!K&&g.instancedDataArray.length>20;Ae&&he.push("INSTANCED_ARRAYS");const Ee=Ya(m,i.paint.get("model-cutoff-fade-range"));if(Ee.shouldRenderCutoff&&he.push("RENDER_CUTOFF"),z&&U)de=m.getOrCreateProgram("modelDepth",{defines:he}),ge=su(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(c.globalMatrix)),Ce=U.getShadowPassColorMode();else{Fa(he,ce,re,m,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),de=m.getOrCreateProgram("model",{defines:he,overrideFog:ie});const je=re.material,Ue=je.pbrMetallicRoughness,ze=i.paint.get("model-opacity").constantOr(1),Pe=i.paint.get("model-emissive-strength").constantOr(0);ge=jo(A.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,m,ze,Ue.baseColorFactor,je.emissiveFactor,Ue.metallicFactor,Ue.roughnessFactor,je,Pe,i,E),U&&(M.shadowUniformsInitialized?de.setShadowUniformValues(D,U.getShadowUniformValues()):(U.setupShadows(A.toUnwrapped(),de,"model-tile"),M.shadowUniformsInitialized=!0)),Ce=Ee.shouldRenderCutoff||ze<1||je.alphaMode!=="OPAQUE"?Ii.alphaBlended:Ii.unblended}m.uploadCommonUniforms(D,de,A.toUnwrapped(),null,Ee);const Ge=re.material.doubleSided?Si.disabled:Si.backCCW;if(Ae)ce.push(g.instancedDataBuffer),de.draw(m,D.gl.TRIANGLES,$,Mi.disabled,Ce,Ge,ge,i.id,re.vertexBuffer,re.indexBuffer,re.segments,i.paint,m.transform.zoom,void 0,ce,g.instancedDataArray.length);else{const je=z?"u_instance":"u_normal_matrix";for(let Ue=0;Ue<g.instancedDataArray.length;++Ue)ge[je]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Ue,16),de.draw(m,D.gl.TRIANGLES,$,Mi.disabled,Ce,Ge,ge,i.id,re.vertexBuffer,re.indexBuffer,re.segments,i.paint,m.transform.zoom,void 0,ce)}}if(c.children)for(const re of c.children)Qt(m,i,re,g,E,A,M)}const uu=[1,-1,1];function Kr(m,i,c,g){if(!c.modelManager)return!0;const E=c.modelManager;if(!c.shadowRenderer)return!0;const A=c.shadowRenderer,M=i.aabb;let D=!0,z=m.maxHeight;if(z===0){let $=0;for(const ie in m.instancesPerModel){const K=E.getModel(ie,g);K?$=Math.max($,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):D=!1}z=m.maxScale*$*1.41+m.maxVerticalOffset,D&&(m.maxHeight=z)}M.max[2]=z,M.min[2]+=m.terrainElevationMin,M.max[2]+=m.terrainElevationMax,a.af(M.min,M.min,i.tileMatrix),a.af(M.max,M.max,i.tileMatrix);const U=M.intersects(A.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=U===2),U===0}function it(m,i){const c=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],E=m.uniformValues.u_cutoff_params[2],A=m.uniformValues.u_cutoff_params[3];return g===c||A===E?1:a.aA(((i-c)/(g-c)-E)/(A-E),0,1)}function Ip(m,i,c,g){if(i.pitch<20)return 1;const E=i.getWorldToCameraMatrix();a.aB(E,E,m);const A=a.bU(c.min[0],c.min[1],c.min[2],1);let M=a.aC(a.eG(),A,E),D=M,z=M;A[1]=c.max[1],M=a.aC(a.eG(),A,E),D=M[1]<D[1]?M:D,z=M[1]>z[1]?M:z,A[0]=c.max[0],M=a.aC(a.eG(),A,E),D=M[1]<D[1]?M:D,z=M[1]>z[1]?M:z,A[1]=c.min[1],M=a.aC(a.eG(),A,E),D=M[1]<D[1]?M:D,z=M[1]>z[1]?M:z;const U=a.aA(g[0],0,1),$=100*i.pixelsPerMeter*a.aA(g[1],0,1),ie=a.aA(g[2],0,1),K=a.eH(a.eG(),D,z,U),re=Math.tan(.5*i.fovX),he=-K[2]*re;if($===0)return K[1]<-Math.abs(he)?ie:1;const ce=(-Math.abs(he)-K[1])/$,de=(Ce,Ae,Ee)=>(1-Ee)*Ce+Ee*Ae,ge=a.aA(de(1,ie,ce),ie,1);return de(1,ge,a.aA((i.pitch-20)/20,0,1))}class bf{}class md{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,c,g){{const ie=this._storage.get(c.id);if(ie)return ie.lastUsedFrameIdx=i,ie.buf}const E=g.gl,A=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),M=new ArrayBuffer(A),D=new Int16Array(M);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const z=new a.eJ;for(let ie=0;ie<A/2;ie+=3){const K=D[ie],re=D[ie+1],he=D[ie+2];z.emplaceBack(K,re),z.emplaceBack(re,he),z.emplaceBack(he,K)}const U=g.bindVertexArrayOES.current,$=new bf;return $.buf=new Js(g,z),$.lastUsedFrameIdx=i,this._storage.set(c.id,$),g.bindVertexArrayOES.set(U),$.buf}update(i){for(const[c,g]of this._storage)i-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(const[i,c]of this._storage)c.buf.destroy(),this._storage.delete(i)}}class wf{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Dp=a.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class gd{constructor(i){this.revealStart=11,this.revealRange=2}}const hu=a.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Gm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,c){const g=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const M=new a.eK,D=new a.b0;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(1,1),M.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(M,hu.members),this.vignetteIdx=i.context.createIndexBuffer(D)}const E=a.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,g);const M={u_vignetteShape:(A={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:A.vignetteColor};g.draw(i,i.context.gl.TRIANGLES,fi.disabled,Mi.disabled,Ii.alphaBlended,Si.disabled,M,"vignette",this.vignetteVx,this.vignetteIdx,E)}var A}}class zg{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,c){const g=i.getFreeCameraOptions().position,E=g.toAltitude(),A=g.toLngLat(),M=a.an(A.lng),D=a.an(A.lat),z=i.pixelsPerMeter/c,U=M*a.eM,$=a.eM*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ie=-this._offsetYPrev+$,K=-this._elevationPrev+E;this._accumulatedOffsetX+=(-this._offsetXPrev+U)*z,this._accumulatedOffsetY+=ie*z,this._accumulatedElevation+=K*z,this._offsetXPrev=U,this._offsetYPrev=$,this._elevationPrev=E}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function kp(m,i){return[-(m[0]-Math.floor(m[0]/i)*i),-(m[1]-Math.floor(m[1]/i)*i),-(m[2]-Math.floor(m[2]/i)*i)]}function lh(m){const i=a.eq(1323123451230),c=[];for(let g=0;g<m;++g){const E=2*i()-1,A=2*i()-1,M=2*i()-1;c.push(a.d5(E,A,M))}return c}function Ba(m,i,c,g,E){const A=a.aA((E-c)/(g-c),0,1);return(1-A)*m+A*i}class yd{constructor(i){this._movement=new zg,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Gm,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,c){const g=i.transform;this._movement.update(g,this._ppmScaleFactor);const E=g.starsProjMatrix,A=a.c7([]);a.c9(A,A,a.an(90)-g._pitch),a.c8(A,A,-g.angle);const M=a.cc(new Float32Array(16),A),D=a.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=a.eg([],D),U=a.aB([],z,M),$=Date.now()/1e3;return this._accumulatedTimeFromStart+=($-this._prevTime)*c,this._prevTime=$,{projectionMatrix:E,modelviewMatrix:U}}}class _d extends yd{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gd("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const c=i.context;if(!this.particlesVx){const g=lh(this.particlesCount),E=new a.eN,A=new a.b0;let M=0;const D=a.eq(1323123451230);for(let z=0;z<g.length;++z){const U=g[z],$=[2*D()-1,D(),D(),D()];E.emplaceBack(U[0],U[1],U[2],-1,-1,...$),E.emplaceBack(U[0],U[1],U[2],1,-1,...$),E.emplaceBack(U[0],U[1],U[2],1,1,...$),E.emplaceBack(U[0],U[1],U[2],-1,1,...$),A.emplaceBack(M+0,M+1,M+2),A.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=c.createVertexBuffer(E,Dp.members),this.particlesIdx=c.createIndexBuffer(A)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=i.transform.zoom;if(c.revealStart>g)return;const E=Ba(0,1,c.revealStart,c.revealStart+c.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const A=structuredClone(this._params);let M=[-A.direction.x,A.direction.y,-100];a.aw(M,M);const D=structuredClone(this._vignetteParams);D.strength*=E,A.overrideStyleParameters||(A.intensity=i.style.rain.state.density,A.timeFactor=i.style.rain.state.intensity,A.color=structuredClone(i.style.rain.state.color),M=structuredClone(i.style.rain.state.direction),A.screenThinning.intensity=i.style.rain.state.centerThinning,A.dropletSizeX=i.style.rain.state.dropletSize[0],A.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],A.distortionStrength=100*i.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(i.style.rain.state.vignetteColor));const z=this.updateOnRender(i,A.timeFactor),U=i.context,$=U.gl,ie=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new a.T(U,{width:i.width,height:i.height,data:null},$.RGBA8)),A.distortionStrength>0&&(U.activeTexture.set($.TEXTURE0),this.screenTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),$.copyTexSubImage2D($.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const K=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(U,K),U.activeTexture.set($.TEXTURE0),this.screenTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const re=[A.color.r,A.color.g,A.color.b,A.color.a],he=(ce,de)=>{const ge=kp(this._movement.getPosition(),ce),Ce=A.dropletSizeX,Ae=A.dropletSizeX*A.dropletSizeYScale,Ee=i.width/2,Ge=i.height/2,je=Ba(0,A.screenThinning.start,0,1,A.screenThinning.intensity),Ue=Ba(.001,A.screenThinning.range,0,1,A.screenThinning.intensity),ze=Ba(0,A.screenThinning.particleOffset,0,1,A.screenThinning.intensity),Pe=(We={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ge,velocityConeAperture:A.velocityConeAperture,velocity:A.velocity,boxSize:ce,rainDropletSize:[Ce,Ae],distortionStrength:A.distortionStrength,rainDirection:M,color:re,screenSize:[ie.width,ie.height],thinningCenterPos:[Ee,Ge],thinningShape:[je,Ue,Math.pow(10,A.screenThinning.fadePower)],thinningAffectedRatio:A.screenThinning.affectedRatio,thinningParticleOffset:ze,shapeDirectionalPower:A.shapeDirPower,shapeNormalPower:A.shapeNormalPower,mode:de?0:1},{u_modelview:Float32Array.from(We.modelview),u_projection:Float32Array.from(We.projection),u_time:We.time,u_cam_pos:We.camPos,u_texScreen:0,u_velocityConeAperture:We.velocityConeAperture,u_velocity:We.velocity,u_boxSize:We.boxSize,u_rainDropletSize:We.rainDropletSize,u_distortionStrength:We.distortionStrength,u_rainDirection:We.rainDirection,u_color:We.color,u_screenSize:We.screenSize,u_thinningCenterPos:We.thinningCenterPos,u_thinningShape:We.thinningShape,u_thinningAffectedRatio:We.thinningAffectedRatio,u_thinningParticleOffset:We.thinningParticleOffset,u_shapeDirectionalPower:We.shapeDirectionalPower,u_shapeNormalPower:We.shapeNormalPower,u_mode:We.mode});var We;const Xe=Math.round(A.intensity*this.particlesCount),Qe=a.bg.simpleSegment(0,0,4*Xe,2*Xe);K.draw(i,$.TRIANGLES,fi.disabled,Mi.disabled,Ii.alphaBlended,Si.disabled,Pe,"rain_particles",this.particlesVx,this.particlesIdx,Qe)};A.distortionStrength>0&&he(A.boxSize,!0),he(A.boxSize,!1),this._vignette.draw(i,D)}}const xd=a.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ch extends yd{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gd("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const c=i.context;if(!this.particlesVx){const g=lh(this.particlesCount),E=new a.eO,A=new a.b0;let M=0;const D=a.eq(1323123451230);for(let z=0;z<g.length;++z){const U=g[z],$=D(),ie=D(),K=D(),re=[z/g.length,$,ie,K],he=[D(),D()];E.emplaceBack(U[0],U[1],U[2],-1,-1,...re,...he),E.emplaceBack(U[0],U[1],U[2],1,-1,...re,...he),E.emplaceBack(U[0],U[1],U[2],1,1,...re,...he),E.emplaceBack(U[0],U[1],U[2],-1,1,...re,...he),A.emplaceBack(M+0,M+1,M+2),A.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=c.createVertexBuffer(E,xd.members),this.particlesIdx=c.createIndexBuffer(A)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const c=structuredClone(this._params);let g=[-c.direction.x,c.direction.y,-100];a.aw(g,g);const E=structuredClone(this._vignetteParams),A=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},M=i.transform.zoom;if(A.revealStart>M)return;const D=Ba(0,1,A.revealStart,A.revealStart+A.revealRange,M);E.strength*=D,c.overrideStyleParameters||(c.intensity=i.style.snow.state.density,c.timeFactor=i.style.snow.state.intensity,c.color=structuredClone(i.style.snow.state.color),g=structuredClone(i.style.snow.state.direction),c.screenThinning.intensity=i.style.snow.state.centerThinning,c.billboardSize=2.79*i.style.snow.state.flakeSize,E.strength=1,E.color=structuredClone(i.style.snow.state.vignetteColor));const z=this.updateOnRender(i,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const U=i.context,$=U.gl,ie=i.transform,K=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(U,K),((re,he,ce)=>{const de=kp(this._movement.getPosition(),re),ge=ie.width/2,Ce=ie.height/2,Ae=Ba(0,ce.screenThinning.start,0,1,ce.screenThinning.intensity),Ee=Ba(.001,ce.screenThinning.range,0,1,ce.screenThinning.intensity),Ge=Ba(0,ce.screenThinning.particleOffset,0,1,ce.screenThinning.intensity),je=(Ue={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:ce.velocityConeAperture,velocity:ce.velocity,horizontalOscillationRadius:ce.horizontalOscillationRadius,horizontalOscillationRate:ce.horizontalOscillationRate,boxSize:re,billboardSize:1*ce.billboardSize,simpleShapeParameters:[ce.shapeFadeStart,ce.shapeFadePower],screenSize:[ie.width,ie.height],thinningCenterPos:[ge,Ce],thinningShape:[Ae,Ee,Math.pow(10,ce.screenThinning.fadePower)],thinningAffectedRatio:ce.screenThinning.affectedRatio,thinningParticleOffset:Ge,color:[ce.color.r,ce.color.g,ce.color.b,ce.color.a],direction:g},{u_modelview:Float32Array.from(Ue.modelview),u_projection:Float32Array.from(Ue.projection),u_time:Ue.time,u_cam_pos:Ue.camPos,u_velocityConeAperture:Ue.velocityConeAperture,u_velocity:Ue.velocity,u_horizontalOscillationRadius:Ue.horizontalOscillationRadius,u_horizontalOscillationRate:Ue.horizontalOscillationRate,u_boxSize:Ue.boxSize,u_billboardSize:Ue.billboardSize,u_simpleShapeParameters:Ue.simpleShapeParameters,u_screenSize:Ue.screenSize,u_thinningCenterPos:Ue.thinningCenterPos,u_thinningShape:Ue.thinningShape,u_thinningAffectedRatio:Ue.thinningAffectedRatio,u_thinningParticleOffset:Ue.thinningParticleOffset,u_particleColor:Ue.color,u_direction:Ue.direction});var Ue;const ze=Math.round(ce.intensity*this.particlesCount),Pe=a.bg.simpleSegment(0,0,4*ze,2*ze);this.particlesVx&&this.particlesIdx&&K.draw(i,$.TRIANGLES,fi.disabled,Mi.disabled,Ii.alphaBlended,Si.disabled,je,"snow_particles",this.particlesVx,this.particlesIdx,Pe)})(c.boxSize,0,c),this._vignette.draw(i,E)}}const Uo={symbol:function(m,i,c,g,E){if(m.renderPass!=="translucent")return;const A=Mi.disabled,M=m.colorModeForRenderPass(),D=c.layout.get("text-variable-anchor"),z=c.layout.get("text-size-scale-range"),U=a.aA(m.scaleFactor,z[0],z[1]);D&&(function(K,re,he,ce,de,ge,Ce,Ae){const Ee=re.transform,Ge=de==="map",je=ge==="map";for(const Ue of K){const ze=ce.getTile(Ue),Pe=ze.getBucket(he);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const We=a.bK(Pe.textSizeData,Ee.zoom,Ae),Xe=nl(Ue,Pe.getProjection(),Ee),Qe=Ee.calculatePixelsToTileUnitsMatrix(ze),rt=Vc(Xe,ze.tileID.canonical,je,Ge,Ee,Pe.getProjection(),Qe),tt=Pe.hasIconTextFit()&&Pe.hasIconData();We&&_c(Pe,Ge,je,Ce,Ee,rt,Ue,Math.pow(2,Ee.zoom-ze.tileID.overscaledZ),We,tt)}})(g,m,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E,U);const $=c.paint.get("icon-opacity").constantOr(1)!==0,ie=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&($||ie)?ou(m,i,c,g,A,M):($&&ou(m,i,c,g,A,M,{onlyIcons:!0}),ie&&ou(m,i,c,g,A,M,{onlyText:!0})),i.map.showCollisionBoxes&&(gn(m,i,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),gn(m,i,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,i,c,g){if(m.renderPass!=="translucent")return;const E=c.paint.get("circle-opacity"),A=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),D=c.layout.get("circle-sort-key").constantOr(1)!==void 0,z=c.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const U=m.context,$=U.gl,ie=m.transform,K=!(!m.terrain||!m.terrain.enabled),re=c.layout.get("circle-elevation-reference"),he=m.depthModeForSublayer(0,fi.ReadOnly),ce=new fi(m.context.gl.LEQUAL,fi.ReadOnly,m.depthRangeFor3D),de=re==="none"||K?he:ce,ge=Mi.disabled,Ce=m.colorModeForDrapableLayerRenderPass(z),Ae=ie.projection.name==="globe",Ee=[a.aF(ie.center.lng),a.aJ(ie.center.lat)],Ge=[];for(let Ue=0;Ue<g.length;Ue++){const ze=g[Ue],Pe=i.getTile(ze),We=Pe.getBucket(c);if(!We||We.projection.name!==ie.projection.name)continue;const Xe=We.programConfigurations.get(c.id),Qe=We.layoutVertexBuffer,rt=We.globeExtVertexBuffer,tt=We.indexBuffer,pt=a.e0(c),wt=[rt],nt=m.isTileAffectedByFog(ze);Ae&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),m.terrain&&ie.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),We.hasElevation&&!m.terrain&&(pt.push("ELEVATED_ROADS"),wt.push(We.elevatedLayoutVertexBuffer));const Ze=m.getOrCreateProgram("circle",{config:Xe,defines:pt,overrideFog:nt}),_t=ie.projection.createInversionMatrix(ie,ze.canonical),ot={programConfiguration:Xe,program:Ze,layoutVertexBuffer:Qe,dynamicBuffers:wt,indexBuffer:tt,uniformValues:a.e1(m,ze,Pe,_t,Ee,c),tile:Pe};if(D){const bt=We.segments.get();for(const Lt of bt)Ge.push({segments:new a.bg([Lt]),sortKey:Lt.sortKey,state:ot})}else Ge.push({segments:We.segments,sortKey:0,state:ot})}D&&Ge.sort((Ue,ze)=>Ue.sortKey-ze.sortKey);const je={useDepthForOcclusion:ie.depthOcclusionForSymbolsAndCircles};for(const Ue of Ge){const{programConfiguration:ze,program:Pe,layoutVertexBuffer:We,dynamicBuffers:Xe,indexBuffer:Qe,uniformValues:rt,tile:tt}=Ue.state,pt=Ue.segments;m.terrain&&m.terrain.setupElevationDraw(tt,Pe,je),m.uploadCommonUniforms(U,Pe,tt.tileID.toUnwrapped()),Pe.draw(m,$.TRIANGLES,de,ge,Ce,Si.disabled,rt,c.id,We,Qe,pt,c.paint,ie.zoom,ze,Xe)}},heatmap:function(m,i,c,g){if(c.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const E=m.context,A=E.gl,M=Mi.disabled,D=new Ii([A.ONE,A.ONE,A.ONE,A.ONE],a.ao.transparent,[!0,!0,!0,!0]);(function(re,he,ce,de){const ge=re.gl,Ce=he.width*de,Ae=he.height*de;re.activeTexture.set(ge.TEXTURE1),re.viewport.set([0,0,Ce,Ae]);let Ee=ce.heatmapFbo;if(!Ee||Ee&&(Ee.width!==Ce||Ee.height!==Ae)){Ee&&Ee.destroy();const Ge=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Ge),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Ee=ce.heatmapFbo=re.createFramebuffer(Ce,Ae,1,null),(function(je,Ue,ze,Pe,We,Xe){const Qe=je.gl;Qe.texImage2D(Qe.TEXTURE_2D,0,je.extRenderToTextureHalfFloat?Qe.RGBA16F:Qe.RGBA,We,Xe,0,Qe.RGBA,je.extRenderToTextureHalfFloat?Qe.HALF_FLOAT:Qe.UNSIGNED_BYTE,null),Pe.colorAttachment0.set(ze)})(re,0,Ge,Ee,Ce,Ae)}else ge.bindTexture(ge.TEXTURE_2D,Ee.colorAttachment0.get()),re.bindFramebuffer.set(Ee.framebuffer)})(E,m,c,m.transform.projection.name==="globe"?.5:.25),E.clear({color:a.ao.transparent});const z=m.transform,U=z.projection.name==="globe",$=U?["PROJECTION_GLOBE_VIEW"]:[],ie=U?Si.frontCCW:Si.disabled,K=[a.aF(z.center.lng),a.aJ(z.center.lat)];for(let re=0;re<g.length;re++){const he=g[re];if(i.hasRenderableParent(he))continue;const ce=i.getTile(he),de=ce.getBucket(c);if(!de||de.projection.name!==z.projection.name)continue;const ge=m.isTileAffectedByFog(he),Ce=de.programConfigurations.get(c.id),Ae=m.getOrCreateProgram("heatmap",{config:Ce,defines:$,overrideFog:ge}),{zoom:Ee}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ce,Ae),m.uploadCommonUniforms(E,Ae,he.toUnwrapped());const Ge=z.projection.createInversionMatrix(z,he.canonical);Ae.draw(m,A.TRIANGLES,fi.disabled,M,D,ie,eu(m,he,ce,Ge,K,Ee,c.paint.get("heatmap-intensity")),c.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,c.paint,m.transform.zoom,Ce,U?[de.globeExtVertexBuffer]:null)}E.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),(function(E,A){const M=E.context,D=M.gl,z=A.heatmapFbo;if(!z)return;M.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,z.colorAttachment0.get()),M.activeTexture.set(D.TEXTURE1);let U=A.colorRampTexture;U||(U=A.colorRampTexture=new a.T(M,A.colorRamp,D.RGBA8)),U.bind(D.LINEAR,D.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,D.TRIANGLES,fi.disabled,Mi.disabled,E.colorModeForRenderPass(),Si.disabled,(($,ie)=>({u_image:0,u_color_ramp:1,u_opacity:ie.paint.get("heatmap-opacity")}))(0,A),A.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,A.paint,E.transform.zoom)})(m,c))},line:function(m,i,c,g){if(m.renderPass!=="translucent")return;const E=c.paint.get("line-opacity"),A=c.paint.get("line-width");if(E.constantOr(1)===0||A.constantOr(1)===0)return;const M=c.paint.get("line-emissive-strength").isConstant(),D=c.paint.get("line-emissive-strength").constantOr(0),z=c.paint.get("line-occlusion-opacity"),U=c.layout.get("line-elevation-reference"),$=c.layout.get("line-width-unit")==="meters",ie=U==="sea",K=!(!m.terrain||!m.terrain.enabled),re=m.context,he=re.gl;if(c.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const ce=c.layout.get("line-cross-slope"),de=ce!==void 0,ge=ce<1,Ce=m.colorModeForDrapableLayerRenderPass(M?D:null),Ae=m.terrain&&m.terrain.renderingToTexture,Ee=Ae?1:a.o.devicePixelRatio,Ge=c.paint.get("line-dasharray"),je=Ge.constantOr(1),Ue=c.layout.get("line-cap"),ze=Ge.constantOr(null),Pe=Ue.constantOr(null),We=c.paint.get("line-pattern"),Xe=We.constantOr(1),Qe=c.paint.get("line-pattern-cross-fade"),rt=We.constantOr(null),tt=c.paint.get("line-opacity").constantOr(1);let pt=!Xe&&tt!==1||m.depthOcclusion&&z>0&&z<1;const wt=c.paint.get("line-gradient"),nt=Xe?"linePattern":"line",Ze=a.e2(c);let _t;if(Ae&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(pt=!1),z!==0&&m.depthOcclusion){const Wt=c.paint._values["line-opacity"];Wt&&Wt.value&&Wt.value.kind==="constant"?_t=Wt.value:a.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}A.value.kind!=="constant"&&A.value.isLineProgressConstant===!1&&Ze.push("VARIABLE_LINE_WIDTH"),Ae&&(m.emissiveMode!=="dual-source-blending"||M?m.emissiveMode==="mrt-fallback"&&Ze.push("USE_MRT1"):Ze.push("DUAL_SOURCE_BLENDING"));const ot=(Wt,jt,zt,hi,ai,Xt)=>{for(const oi of Wt){const _i=i.getTile(oi);if(Xe&&!_i.patternsLoaded())continue;const Ti=_i.getBucket(c);if(!Ti||Ti.elevationType!=="none"&&!ai||Ti.elevationType==="none"&&ai)continue;m.prepareDrawTile();const Fi=[...jt],Yi=m.shadowRenderer,Ai=Ti.elevationType==="road"&&!!Yi&&Yi.enabled;let Bi=[0,0,0];if(Ai){const Ni=m.style.directionalLight,kr=m.style.ambientLight;Ni&&kr&&(Bi=ua(m.style,Ni,kr)),Fi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Di=Ti.programConfigurations.get(c.id);let ur=!1;if(rt&&_i.imageAtlas){const Ni=a.e3.from(rt),kr=Ni.getPrimary().scaleSelf(Ee).toString(),sn=_i.imageAtlas.patternPositions.get(kr),Er=Ni.getSecondary(),Lr=Er?_i.imageAtlas.patternPositions.get(Er.scaleSelf(Ee).toString()):null;ur=!!sn&&!!Lr,sn&&Di.setConstantPatternPositions(sn,Lr)}Qe>0&&(ur||Di.getPatternTransitionVertexBuffer("line-pattern"))&&Fi.push("LINE_PATTERN_TRANSITION");const sr=m.isTileAffectedByFog(oi),vr=m.getOrCreateProgram(nt,{config:Di,defines:Fi,overrideFog:sr});if(!Xe&&ze&&Pe&&_i.lineAtlas){const Ni=_i.lineAtlas.getDash(ze,Pe);Ni&&Di.setConstantPatternPositions(Ni)}Ai&&Yi.setupShadows(_i.tileID.toUnwrapped(),vr,"vector-tile");let[er,ji]=c.paint.get("line-trim-offset");(Pe==="round"||Pe==="square")&&er!==ji&&(er===0&&(er-=1),ji===1&&(ji+=1));const or=Ae?oi.projMatrix:null,Hr=$?1/Ti.tileToMeter/a.ay(_i,1,m.transform.zoom):1,br=$?1/Ti.tileToMeter/a.ay(_i,1,Math.floor(m.transform.zoom)):1,pr=Xe?a.e4(m,_i,c,or,Ee,Hr,br,[er,ji],Bi,Qe):a.e5(m,_i,c,or,Ti.lineClipsArray.length,Ee,Hr,br,[er,ji],Bi);if(wt){const Ni=Ti.gradients[c.id];let kr=Ni.texture;if(c.gradientVersion!==Ni.version){let sn=256;if(c.stepInterpolant){const Er=i.getSource().maxzoom,Lr=oi.canonical.z===Er?Math.ceil(1<<m.transform.maxZoom-oi.canonical.z):1;sn=a.aA(a.e6(Ti.maxLineLength/a.al*1024*Lr),256,re.maxTextureSize)}Ni.gradient=a.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:sn,image:Ni.gradient||void 0,clips:Ti.lineClipsArray}),Ni.texture?Ni.texture.update(Ni.gradient):Ni.texture=new a.T(re,Ni.gradient,he.RGBA8),Ni.version=c.gradientVersion,kr=Ni.texture}re.activeTexture.set(he.TEXTURE1),kr.bind(c.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}je&&(re.activeTexture.set(he.TEXTURE0),_i.lineAtlasTexture&&_i.lineAtlasTexture.bind(he.LINEAR,he.REPEAT),Di.updatePaintBuffers()),Xe&&(re.activeTexture.set(he.TEXTURE0),_i.imageAtlasTexture&&_i.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Di.updatePaintBuffers()),ai&&!ie&&m.terrain.setupElevationDraw(_i,vr),m.uploadCommonUniforms(re,vr,oi.toUnwrapped());const Oi=Ni=>{_t!=null&&(_t.value=tt*z),vr.draw(m,he.TRIANGLES,zt,Ni,Ce,Si.disabled,pr,c.id,Ti.layoutVertexBuffer,Ti.indexBuffer,Ti.segments,c.paint,m.transform.zoom,Di,[Ti.layoutVertexBuffer2,Ti.patternVertexBuffer,Ti.zOffsetVertexBuffer]),_t!=null&&(_t.value=tt)};if(pt&&!ai){const Ni=m.stencilModeForClipping(oi).ref;Ni===0&&Ae&&re.clear({stencil:0});const kr={func:he.EQUAL,mask:255};pr.u_alpha_discard_threshold=.8,Oi(new Mi(kr,Ni,255,he.KEEP,he.KEEP,he.INVERT)),pr.u_alpha_discard_threshold=0,Oi(new Mi(kr,Ni,255,he.KEEP,he.KEEP,he.KEEP))}else pr.u_alpha_discard_threshold=pt&&ai&&Xt?.8:0,Oi(ai?hi:m.stencilModeForClipping(oi))}};let bt=m.depthModeForSublayer(0,fi.ReadOnly);const Lt=new fi(m.depthOcclusion?he.GREATER:he.LEQUAL,fi.ReadOnly,m.depthRangeFor3D);if(c.hasNonElevatedBuckets){const Wt=!Ae&&m.terrain;z!==0&&Wt?a.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Wt?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):ot(g,Ze,bt,Mi.disabled,!1,!0)}if(c.hasElevatedBuckets){U==="hd-road-markup"?K||(bt=Lt,Ze.push("ELEVATED_ROADS")):(Ze.push("ELEVATED"),bt=Lt,de&&Ze.push(ge?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ie&&Ze.push("ELEVATION_REFERENCE_SEA"));const Wt=pt?m.stencilModeFor3D():Mi.disabled;m.forceTerrainMode=!0,ot(g,Ze,bt,Wt,!0,!0),pt&&ot(g,Ze,bt,Wt,!0,!1),m.forceTerrainMode=!1}pt&&(m.resetStencilClippingMasks(),Ae&&re.clear({stencil:0})),z===0||m.depthOcclusion||Ae||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,i,c,g){const E=c.paint.get("fill-color"),A=c.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=c.paint.get("fill-emissive-strength"),D=m.colorModeForDrapableLayerRenderPass(M),z=c.paint.get("fill-pattern"),U=m.opaquePassEnabledForLayer()&&!z.constantOr(1)&&E.constantOr(a.ao.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";let $="none";c.layout.get("fill-elevation-reference")!=="none"?$="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&($="offset");const ie=!(!m.terrain||!m.terrain.enabled),K={painter:m,sourceCache:i,layer:c,coords:g,colorMode:D,elevationType:$,terrainEnabled:ie,pass:U};if(m.renderPass==="shadow")return void(m.shadowRenderer&&$==="road"&&!ie&&(function(he){const{painter:ce,sourceCache:de,layer:ge,coords:Ce}=he,Ae=ce.context.gl,Ee=he.painter.shadowRenderer;for(const Ge of Ce){const je=de.getTile(Ge),Ue=je.getBucket(ge);if(!Ue)continue;const ze=Ue.elevatedStructures;if(!ze||!ze.shadowCasterSegments||ze.shadowCasterSegments.segments[0].primitiveLength===0)continue;ce.prepareDrawTile();const Pe=Ue.bufferData.programConfigurations.get(ge.id),We=ce.isTileAffectedByFog(Ge),Xe=ce.getOrCreateProgram("elevatedStructuresDepth",{config:Pe,overrideFog:We}),Qe=Ee.calculateShadowPassMatrixFromTile(je.tileID.toUnwrapped());ce.uploadCommonUniforms(ce.context,Xe,Ge.toUnwrapped());const rt=Jc(Qe,0);Xe.draw(ce,Ae.TRIANGLES,Ee.getShadowPassDepthMode(),Mi.disabled,Ee.getShadowPassColorMode(),Si.disabled,rt,ge.id,ze.vertexBuffer,ze.indexBuffer,ze.shadowCasterSegments,ge.paint,ce.transform.zoom,Pe)}})(K));const re=m.emissiveMode==="mrt-fallback";if($!=="offset"){if(Dn(K,!1,re),$==="road"){const he=!ie&&m.renderPass==="translucent";he&&bp(m,i,c,g,"geometry"),Dn(K,!0,re,Mi.disabled),he&&(function(ce){const{painter:de,sourceCache:ge,layer:Ce,coords:Ae,colorMode:Ee}=ce,Ge=de.context.gl,je=ce.painter.shadowRenderer,Ue=!!je&&je.enabled,ze=new fi(de.context.gl.LEQUAL,fi.ReadOnly,de.depthRangeFor3D);let Pe=[0,0,0];if(Ue){const Xe=de.style.directionalLight,Qe=de.style.ambientLight;Xe&&Qe&&(Pe=ua(de.style,Xe,Qe))}const We=Xe=>{for(const Qe of Ae){const rt=ge.getTile(Qe),tt=rt.getBucket(Ce);if(!tt)continue;const pt=tt.elevatedStructures;if(!pt)continue;let wt,nt;if(Xe?(wt=pt.renderableBridgeSegments,nt=pt.bridgeProgramConfigurations.get(Ce.id)):(wt=pt.renderableTunnelSegments,nt=pt.tunnelProgramConfigurations.get(Ce.id)),!wt||wt.segments[0].primitiveLength===0)continue;nt.updatePaintBuffers(),de.prepareDrawTile();const Ze=de.isTileAffectedByFog(Qe),_t=[];Ue&&_t.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ot=de.getOrCreateProgram("elevatedStructures",{config:nt,overrideFog:Ze,defines:_t}),bt=de.translatePosMatrix(Qe.projMatrix,rt,Ce.paint.get("fill-translate"),Ce.paint.get("fill-translate-anchor"));Ue&&je.setupShadows(rt.tileID.toUnwrapped(),ot,"vector-tile");const Lt=Bo(bt,Pe);de.uploadCommonUniforms(de.context,ot,Qe.toUnwrapped()),ot.draw(de,Ge.TRIANGLES,ze,Mi.disabled,Ee,Si.backCCW,Lt,Ce.id,pt.vertexBuffer,pt.indexBuffer,wt,Ce.paint,de.transform.zoom,nt,[pt.vertexBufferNormal])}};We(!0),We(!1)})(K)}}else Dn(K,!1,re,m.stencilModeFor3D())},"fill-extrusion":function(m,i,c,g){const E=c.paint.get("fill-extrusion-opacity"),A=m.context,M=A.gl,D=m.terrain,z=D&&D.renderingToTexture;if(E===0)return;const U=m.emissiveMode==="mrt-fallback",$=m.conflationActive&&m.style.isLayerClipped(c,i.getSource()),ie=m.style.order.indexOf(c.fqid);if($&&(function(K,re,he,ce,de){for(const ge of ce){const Ce=re.getTile(ge).getBucket(he);Ce&&(Ce.updateReplacement(ge,K.replacementSource,de),Ce.uploadCentroid(K.context))}})(m,i,c,g,ie),D||$)for(const K of g){const re=i.getTile(K).getBucket(c);re&&wp(m.context,i,K,re,c,D,$)}if(m.renderPass==="shadow"&&m.shadowRenderer){const K=m.shadowRenderer;if(D&&E<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ad)return;const re=K.getShadowPassDepthMode(),he=K.getShadowPassColorMode();bc(m,i,c,g,re,Mi.disabled,he,$)}else if(m.renderPass==="translucent"){const K=!c.paint.get("fill-extrusion-pattern").constantOr(1),re=c.paint.get("fill-extrusion-color").constantOr(a.ao.white);if(!z&&re.a!==0){const he=new fi(m.context.gl.LEQUAL,fi.ReadWrite,m.depthRangeFor3D);E===1&&K?bc(m,i,c,g,he,Mi.disabled,Ii.unblended,$):(bc(m,i,c,g,he,Mi.disabled,Ii.disabled,$),bc(m,i,c,g,he,m.stencilModeFor3D(),m.colorModeForRenderPass(),$),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&K&&(!D&&m.transform.projection.name!=="globe"||z)){const he=c.paint.get("fill-extrusion-opacity"),ce=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),de=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ge=c.paint.get("fill-extrusion-flood-light-intensity"),Ce=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ae=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:c.lut).toArray01().slice(0,3),Ee=ce>0&&de>0,Ge=ge>0,je=(Pe,We,Xe)=>(1-Xe)*Pe+Xe*We,Ue=new lu;Ue.translate=c.paint.get("fill-extrusion-translate"),Ue.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ue.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ue.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const ze=Pe=>{const We=m.depthModeForSublayer(1,fi.ReadOnly,M.LEQUAL,!0),Xe=c.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=je(.1,3,Xe),rt=m._showOverdrawInspector;if(!rt){const tt=new Mi({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),pt=new Ii([M.ONE,M.ONE,M.ONE,M.ONE],a.ao.transparent,[!1,!1,!1,!0],M.MIN);No(Ue,m,i,c,g,We,tt,pt,Si.disabled,Pe,"sdf",he,ce,de,ge,Ae,Qe,$,!1)}{const tt=rt?Mi.disabled:new Mi({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),pt=rt?m.colorModeForRenderPass():new Ii([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],a.ao.transparent,[!0,!0,!0,!0]);No(Ue,m,i,c,g,We,tt,pt,Si.disabled,Pe,"color",he,ce,de,ge,Ae,Qe,$,!1)}};if(z){const Pe=()=>{const Xe=D.drapeBufferSize[0],Qe=D.drapeBufferSize[1];let rt=D.framebufferCopyTexture;return rt&&(!rt||rt.size[0]===Xe&&rt.size[1]===Qe)||(rt&&rt.destroy(),rt=D.framebufferCopyTexture=new a.T(A,new a.q({width:Xe,height:Qe}),M.RGBA8)),rt.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,Xe,Qe),rt},We=(Xe,Qe,rt)=>{const tt=m.depthModeForSublayer(1,fi.ReadOnly,M.LEQUAL,!1),pt=c.paint.get(Xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),wt=je(.1,3,pt);{const nt=new Ii([M.ONE,M.ONE,M.ONE,M.ONE],a.ao.transparent,[!1,!1,!1,!0]);No(Ue,m,i,c,g,tt,Mi.disabled,nt,Si.disabled,Xe,"clear",he,ce,de,ge,Ae,wt,$,Qe)}{const nt=new Mi({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Ze=new Ii([M.ONE,M.ONE,M.ONE,M.ONE],a.ao.transparent,[!1,!1,!1,!0],M.MIN);No(Ue,m,i,c,g,tt,nt,Ze,Si.disabled,Xe,"sdf",he,ce,de,ge,Ae,wt,$,Qe)}U&&!Xe&&(rt=Pe());{const nt=Xe?M.ZERO:M.ONE_MINUS_DST_ALPHA,Ze=new Mi({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),_t=new Ii([nt,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],a.ao.transparent,[!0,!0,!0,!0]);No(Ue,m,i,c,g,tt,Ze,_t,Si.disabled,Xe,"color",he,ce,de,ge,Ae,wt,$,Qe)}if(!U||Xe){const nt=new Ii([M.ONE,M.ONE,M.ONE,Xe?M.ZERO:M.ONE],a.ao.transparent,[!1,!1,!1,!0],Xe?M.FUNC_ADD:M.MAX);No(Ue,m,i,c,g,tt,Mi.disabled,nt,Si.disabled,Xe,"clear",he,ce,de,ge,Ae,wt,$,Qe,rt)}else{M.drawBuffers([M.NONE,M.COLOR_ATTACHMENT1]);const nt=new Mi({func:M.EQUAL,mask:255},254,255,M.KEEP,M.DECR,M.DECR),Ze=new Ii([M.ONE,M.ONE,M.ONE,M.ONE],a.ao.transparent,[!0,!1,!1,!1],M.MAX);No(Ue,m,i,c,g,tt,nt,Ze,Si.disabled,Xe,"emissive",he,ce,de,ge,Ae,wt,$,Qe,rt),M.drawBuffers([M.COLOR_ATTACHMENT0])}};if(Ee||Ge){let Xe;m.prepareDrawTile(),U&&!Ee||(Xe=Pe()),Ee&&We(!0,!1,Xe),Ge&&We(!1,!0,Xe)}}else Ee&&ze(!0),Ge&&ze(!1),(Ee||Ge)&&m.resetStencilClippingMasks()}}},building:function(m,i,c,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const E=c.paint.get("building-ambient-occlusion-ground-intensity"),A=c.paint.get("building-ambient-occlusion-ground-radius"),M=c.paint.get("building-ambient-occlusion-ground-attenuation"),D=c.paint.get("building-opacity");if(D<=0)return;let z=E>0&&A>0,U=!0;const $=c.paint.get("building-vertical-scale");if($<=0)return;m.shadowRenderer||(U=!1);const ie=m.conflationActive&&m.style.isLayerClipped(c,i.getSource()),K=m.style.order.indexOf(c.fqid);if((function(re,he,ce,de,ge,Ce){for(const Ae of Ce){const Ee=he.getTile(Ae).getBucket(ce);Ee&&(ge&&Ee.updateReplacement(Ae,re.replacementSource,de),Ee.uploadUpdatedIndexBuffer(re.context))}})(m,i,c,K,ie,g),(function(re,he,ce,de){for(const ge of de){const Ce=he.getTile(ge).getBucket(ce);Ce&&Ce.needsEvaluation()&&Ce.uploadUpdatedColorBuffer(re.context)}})(m,i,c,g),c.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const re=m.shadowRenderer,he=[],ce=re.getShadowPassDepthMode();bs({painter:m,source:i,layer:c,coords:g,defines:he,blendMode:re.getShadowPassColorMode(),depthMode:ce,opacity:D,verticalScale:$,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let re=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];U&&(re=re.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(re=re.concat("NORMAL_OFFSET"));const he=c.paint.get("building-facade-emissive-chance"),ce=c.paint.get("building-ambient-occlusion-intensity"),de=c.paint.get("building-flood-light-intensity"),ge=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Ce=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ge?null:c.lut).toArray01().slice(0,3),Ae=c.paint.get("building-flood-light-ground-attenuation"),Ee=de>0,Ge=new fi(m.context.gl.LEQUAL,fi.ReadWrite,m.depthRangeFor3D);D<1&&bs({painter:m,source:i,layer:c,coords:g,defines:re,blendMode:Ii.disabled,depthMode:Ge,opacity:D,verticalScale:$,facadeEmissiveChance:he,facadeAOIntensity:ce,floodLightIntensity:de,floodLightColor:Ce,depthOnly:!0});const je=m.colorModeForRenderPass();bs({painter:m,source:i,layer:c,coords:g,defines:re,blendMode:je,depthMode:Ge,opacity:D,verticalScale:$,facadeEmissiveChance:he,facadeAOIntensity:ce,floodLightIntensity:de,floodLightColor:Ce}),z&&Hn(m,i,c,g,!0,D,E,A,de,Ce,M,ie),Ee&&Hn(m,i,c,g,!1,D,E,A,de,Ce,Ae,ie)}else if(m.renderPass==="light-beam"){const re=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],he=new fi(m.context.gl.LEQUAL,fi.ReadOnly,m.depthRangeFor3D);bs({painter:m,source:i,layer:c,coords:g,defines:re,blendMode:Ii.alphaBlended,depthMode:he,opacity:D,verticalScale:$,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,i,c,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const E=m.context,A=m.terrain&&m.terrain.renderingToTexture,[M,D]=m.renderPass!=="translucent"||A?[{},g]:m.stencilConfigForOverlap(g);for(const z of D){const U=i.getTile(z);if(U.needsHillshadePrepare&&m.renderPass==="offscreen")yo(m,U,c);else if(m.renderPass==="translucent"){const $=m.depthModeForSublayer(0,fi.ReadOnly),ie=c.paint.get("hillshade-emissive-strength"),K=m.colorModeForDrapableLayerRenderPass(ie),re=A&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):M[z.overscaledZ];qh(m,z,U,c,$,re,K)}}E.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,i,c,g,E,A){if(m.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const M=m.transform.projection.name==="globe",D=c.paint.get("raster-elevation")!==0,z=D&&M;if(m.renderElevatedRasterBackface&&!z)return;const U=m.context,$=U.gl,ie=i.getSource(),K=(function(je,Ue,ze,Pe,We){const Xe=Ue.paint.get("raster-color"),Qe=je.type==="raster-array",rt=[],tt=Ue.paint.get("raster-resampling"),pt=Ue.paint.get("raster-color-mix");let wt=Ue.paint.get("raster-color-range");const nt=[pt[0],pt[1],pt[2],0],Ze=pt[3];let _t=tt==="nearest"?Pe.NEAREST:Pe.LINEAR;if(Qe&&(rt.push("RASTER_ARRAY"),Xe||rt.push("RASTER_COLOR"),tt==="linear"&&rt.push("RASTER_ARRAY_LINEAR"),_t=Pe.NEAREST,!wt&&je.rasterLayers)){const ot=je.rasterLayers.find(({id:bt})=>bt===Ue.sourceLayer);ot&&ot.fields&&ot.fields.range&&(wt=ot.fields.range)}if(wt=wt||[0,1],Xe){rt.push("RASTER_COLOR"),ze.activeTexture.set(Pe.TEXTURE2),Ue.updateColorRamp(wt);let ot=Ue.colorRampTexture;ot||(ot=Ue.colorRampTexture=new a.T(ze,Ue.colorRamp,Pe.RGBA8)),ot.bind(_t,Pe.CLAMP_TO_EDGE)}return We&&rt.push("USE_MRT1"),{mix:nt,range:wt,offset:Ze,defines:rt,resampling:_t}})(ie,c,U,$,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(ie instanceof a.aU&&!g.length&&!M)return;const re=c.paint.get("raster-emissive-strength"),he=m.colorModeForDrapableLayerRenderPass(re),ce=m.terrain&&m.terrain.renderingToTexture,de=!m.options.moving,ge=c.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;if(ie instanceof a.aU&&!g.length&&(ie.onNorthPole||ie.onSouthPole)){const je=D?m.stencilModeFor3D():Mi.disabled;return void wc(!!ie.onNorthPole,null,m,i,c,re,K,Si.disabled,je)}if(!g.length)return;const[Ce,Ae]=ie instanceof a.aU||ce?[{},g]:m.stencilConfigForOverlap(g),Ee=Ae[Ae.length-1].overscaledZ;z&&K.defines.push("PROJECTION_GLOBE_VIEW"),D&&K.defines.push("RENDER_CUTOFF");const Ge=(je,Ue,ze)=>{for(const Pe of je){const We=Pe.toUnwrapped(),Xe=i.getTile(Pe);if(ce&&(!Xe||!Xe.hasData()))continue;U.activeTexture.set($.TEXTURE0);const Qe=ff(Xe,ie,c,K);if(!Qe||!Qe.texture)continue;const{texture:rt,mix:tt,offset:pt,tileSize:wt,buffer:nt}=Qe;let Ze,_t;ce?(Ze=fi.disabled,_t=Pe.projMatrix):D?(Ze=new fi($.LEQUAL,fi.ReadWrite,m.depthRangeFor3D),_t=M?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(We,de)):(Ze=m.depthModeForSublayer(Pe.overscaledZ-Ee,c.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,$.LESS),_t=m.transform.calculateProjMatrix(We,de));const ot=m.terrain&&ce?m.terrain.stencilModeForRTTOverlap(Pe):Ce[Pe.overscaledZ],bt=A?0:c.paint.get("raster-fade-duration");Xe.registerFadeDuration(bt);const Lt=i.findLoadedParent(Pe,0),Wt=Jh(Xe,Lt,i,m.transform,bt);let jt,zt;!Wt.isFading&&Xe.refreshedUponExpiration&&(Xe.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),U.activeTexture.set($.TEXTURE0),rt.bind(ge,$.CLAMP_TO_EDGE),U.activeTexture.set($.TEXTURE1),Lt?(Lt.texture&&Lt.texture.bind(ge,$.CLAMP_TO_EDGE),jt=Math.pow(2,Lt.tileID.overscaledZ-Xe.tileID.overscaledZ),zt=[Xe.tileID.canonical.x*jt%1,Xe.tileID.canonical.y*jt%1]):rt.bind(ge,$.CLAMP_TO_EDGE),"useMipmap"in rt&&U.extTextureFilterAnisotropic&&m.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const hi=m.transform;let ai;const Xt=D?hd(hi):[0,0,0,0];let oi,_i,Ti,Fi,Yi,Ai=0;if(z&&ie instanceof a.aU&&ie.coordinates.length>3)oi=Float32Array.from(a.bk(a.dJ(new a.cD(0,0,0)))),_i=Float32Array.from(hi.globeMatrix),Ti=Float32Array.from(a.dF(hi)),Fi=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ai=ie.elevatedGlobePerspectiveTransform,Yi=ie.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const sr=a.dG(Pe.canonical);Ai=a.dH(sr.getCenter().lat),oi=Float32Array.from(a.bk(a.dJ(Pe.canonical))),_i=Float32Array.from(hi.globeMatrix),Ti=Float32Array.from(a.dF(hi)),Fi=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ai=[0,0],Yi=Float32Array.from(a.dI(Pe.canonical,sr,Ai,hi.worldSize/hi._pixelsPerMercatorPixel))}else ai=ie instanceof a.aU?ie.perspectiveTransform:[0,0],oi=new Float32Array(16),_i=new Float32Array(9),Ti=new Float32Array(16),Fi=[0,0],Yi=new Float32Array(9);const Bi=tu(_t,oi,_i,Ti,Yi,zt||[0,0],a.aj(m.transform.zoom),Fi,Xt,jt||1,Wt,c,ai,D?c.paint.get("raster-elevation"):0,2,tt,pt,K.range,wt,nt,re),Di=m.isTileAffectedByFog(Pe),ur=m.getOrCreateProgram("raster",{defines:K.defines,overrideFog:Di});if(m.uploadCommonUniforms(U,ur,We),ie instanceof a.aU){const sr=ie.elevatedGlobeVertexBuffer,vr=ie.elevatedGlobeIndexBuffer;if(ce||!M)ie.boundsBuffer&&ie.boundsSegments&&ur.draw(m,$.TRIANGLES,Ze,Mi.disabled,he,Si.disabled,Bi,c.id,ie.boundsBuffer,m.quadTriangleIndexBuffer,ie.boundsSegments);else if(sr&&vr){const er=hi.zoom<=a.c_?ie.elevatedGlobeSegments:ie.getSegmentsForLongitude(hi.center.lng);er&&ur.draw(m,$.TRIANGLES,Ze,Mi.disabled,he,Ue,Bi,c.id,sr,vr,er)}}else if(z){Ze=new fi($.LEQUAL,fi.ReadOnly,m.depthRangeFor3D);const sr=m.globeSharedBuffers;if(sr){const[vr,er,ji]=sr.getGridBuffers(Ai,!1);ur.draw(m,$.TRIANGLES,Ze,ze||ot,m.colorModeForRenderPass(),Ue,Bi,c.id,vr,er,ji)}}else{const{tileBoundsBuffer:sr,tileBoundsIndexBuffer:vr,tileBoundsSegments:er}=m.getTileBoundsBuffers(Xe);ur.draw(m,$.TRIANGLES,Ze,ot,he,Si.disabled,Bi,c.id,sr,vr,er)}}if(!(ie instanceof a.aU)&&z)for(const Pe of je){const We=Pe.canonical.y===(1<<Pe.canonical.z)-1;Pe.canonical.y===0&&wc(!0,Pe,m,i,c,re,K,Ue,ze||Mi.disabled),We&&wc(!1,Pe,m,i,c,re,K,Ue===Si.frontCW?Si.backCW:Si.frontCW,ze||Mi.disabled)}};z?Ge(Ae,m.renderElevatedRasterBackface?Si.backCW:Si.frontCW,m.stencilModeFor3D()):Ge(Ae,Si.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,i,c,g,E,A){m.renderPass==="offscreen"&&(function(M,D,z,U){if(!U.length)return;const $=M.context,ie=$.gl,K=D.getSource();if(!(K instanceof Zs))return;const re=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let he=z.particlePositionRGBAImage;if(!he||he.width!==re){const Ae=(function(Ee){const Ge=Ee*Ee,je=new Uint8Array(4*Ge),Ue=function(Pe){return Pe|=0,Pe=Math.imul(2747636419^Pe,2654435769),Pe=Math.imul(Pe^Pe>>>16,2654435769),((Pe=Math.imul(Pe^Pe>>>16,2654435769))>>>0)/4294967296},ze=.9090909090909091;for(let Pe=0;Pe<Ge;Pe++){const We=ze*(Ue(2*Pe+0)+iu),Xe=ze*(Ue(2*Pe+1)+iu),Qe=255*We%1,rt=255*Xe%1,tt=Qe,pt=Xe-rt/255,wt=rt;je[4*Pe+0]=255*(We-Qe/255),je[4*Pe+1]=255*tt,je[4*Pe+2]=255*pt,je[4*Pe+3]=255*wt}return je})(re);he=z.particlePositionRGBAImage=new a.q({width:re,height:re},Ae)}let ce=z.particleFramebuffer;ce?ce.width!==re&&(ce.destroy(),ce=z.particleFramebuffer=$.createFramebuffer(re,re,1,null)):ce=z.particleFramebuffer=$.createFramebuffer(re,re,1,null);const de=[];for(const Ae of U){const Ee=D.getTile(Ae);if(!(Ee instanceof ku))continue;const Ge=fd(Ee,K,z);if(!Ge)continue;const je=[Ee.tileSize,Ee.tileSize];let Ue=z.tileFramebuffer;Ue||(Ue=z.tileFramebuffer=$.createFramebuffer(je[0],je[1],1,null));let ze=Ee.rasterParticleState;ze||(ze=Ee.rasterParticleState=new dd($,Ae,je,he));const Pe=ze.update(z.lastInvalidatedAt);ze.particleTextureDimension!==re&&ze.updateParticleTexture(Ae,he);const We=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=We;const Xe=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=Xe,de.push([Ae,Ge,ze,Pe])}if(de.length===0)return;const ge=a.o.now(),Ce=z.previousDrawTimestamp?.001*(ge-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=ge,z.hasColorMap()){$.activeTexture.set(ie.TEXTURE0+2);let Ae=z.colorRampTexture;Ae||(Ae=z.colorRampTexture=new a.T($,z.colorRamp,ie.RGBA8)),Ae.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}$.bindFramebuffer.set(z.tileFramebuffer.framebuffer),(function(Ae,Ee,Ge){const je=Ae.context,Ue=je.gl,ze=Ee.tileFramebuffer;je.activeTexture.set(Ue.TEXTURE0);const Pe={u_texture:0,u_opacity:1.05*(Xe=Ee.paint.get("raster-particle-fade-opacity-factor"))/(Xe+.05)},We=Ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xe;for(const Qe of Ge){const[,,rt,tt]=Qe;ze.colorAttachment0.set(rt.targetColorTexture.texture),je.viewport.set([0,0,ze.width,ze.height]),je.clear({color:a.ao.transparent}),tt&&(rt.backgroundColorTexture.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE),We.draw(Ae,Ue.TRIANGLES,fi.disabled,Mi.disabled,Ii.alphaBlended,Si.disabled,Pe,Ee.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments))}})(M,z,de),(function(Ae,Ee,Ge,je){const Ue=Ae.context,ze=Ue.gl,Pe=Ge.tileFramebuffer,We=Ae.transform.projection.name==="globe",Xe=Ge.paint.get("raster-particle-max-speed");for(const Qe of je){const[rt,tt,pt]=Qe;Ue.activeTexture.set(ze.TEXTURE0+0),tt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Pe.colorAttachment0.set(pt.targetColorTexture.texture);const wt=Ae.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});Ue.activeTexture.set(ze.TEXTURE0+1);const nt=tt.scalarData?[]:[0,1,2,3].map(ot=>a.e9[ot](rt));nt.push(rt);const Ze=rt.canonical.x,_t=rt.canonical.y;for(const ot of nt){const bt=Ee.getTile(We?ot.wrapped():ot);if(!bt)continue;const Lt=bt.rasterParticleState;if(!Lt)continue;const Wt=ot.canonical.x+(1<<ot.canonical.z)*(ot.wrap-rt.wrap),jt=ot.canonical.y;Lt.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const zt=ru(1,Lt.particleTexture0.size[0],[Wt-Ze,jt-_t],0,tt.texture.size,2,Xe,tt.textureOffset,tt.scale,tt.offset);wt.draw(Ae,ze.POINTS,fi.disabled,Mi.disabled,Ii.alphaBlended,Si.disabled,zt,Ge.id,Lt.particleIndexBuffer,void 0,Lt.particleSegment)}}})(M,D,z,de),$.bindFramebuffer.set(z.particleFramebuffer.framebuffer),(function(Ae,Ee,Ge,je){const Ue=Ae.context,ze=Ue.gl,Pe=Ee.paint.get("raster-particle-max-speed"),We=je*Ee.paint.get("raster-particle-speed-factor")*.15,Xe=(function(rt){return Math.pow(rt,6)})(.01+1*Ee.paint.get("raster-particle-reset-rate-factor")),Qe=Ee.particleFramebuffer;Ue.viewport.set([0,0,Qe.width,Qe.height]);for(const rt of Ge){const[,tt,pt]=rt;Ue.activeTexture.set(ze.TEXTURE0+0),tt.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ue.activeTexture.set(ze.TEXTURE0+1);const wt=pt.particleTexture0;wt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const nt=uf(1,wt.size[0],0,tt.texture.size,Pe,We,Xe,tt.textureOffset,tt.scale,tt.offset);Qe.colorAttachment0.set(pt.particleTexture1.texture),Ue.clear({color:a.ao.transparent}),Ae.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(Ae,ze.TRIANGLES,fi.disabled,Mi.disabled,Ii.unblended,Si.disabled,nt,Ee.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments)}})(M,z,de,Ce)})(m,i,c,g),m.renderPass==="translucent"&&((function(M,D,z,U){const $=M.context,ie=$.gl,K=D.getSource().tileSize,re=5*(1-a.ah(a.cL,a.cL+1,M.transform.zoom))*K+z.paint.get("raster-particle-elevation"),he=!M.options.moving,ce=M.transform.projection.name==="globe";if(!U.length)return;const[de,ge]=M.stencilConfigForOverlap(U),Ce=[];ce&&Ce.push("PROJECTION_GLOBE_VIEW");const Ae=M.stencilModeFor3D();for(const Ee of ge){const Ge=Ee.toUnwrapped(),je=D.getTile(Ee);if(!je.rasterParticleState)continue;const Ue=je.rasterParticleState,ze=100;je.registerFadeDuration(ze);const Pe=D.findLoadedParent(Ee,0),We=Jh(je,Pe,D,M.transform,ze);let Xe,Qe;M.terrain&&M.terrain.prepareDrawTile(),$.activeTexture.set(ie.TEXTURE0),Ue.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),$.activeTexture.set(ie.TEXTURE1),Pe&&Pe.rasterParticleState?(Pe.rasterParticleState.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Xe=Math.pow(2,Pe.tileID.overscaledZ-je.tileID.overscaledZ),Qe=[je.tileID.canonical.x*Xe%1,je.tileID.canonical.y*Xe%1]):Ue.targetColorTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const rt=ce?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(Ge,he),tt=M.transform,pt=pf(tt),wt=a.dG(Ee.canonical),nt=a.dH(wt.getCenter().lat);let Ze,_t,ot,bt,Lt;ce?(Ze=Float32Array.from(a.bk(a.dJ(Ee.canonical))),_t=Float32Array.from(tt.globeMatrix),ot=Float32Array.from(a.dF(tt)),bt=[a.aF(tt.center.lng),a.aJ(tt.center.lat)],Lt=Float32Array.from(a.dI(Ee.canonical,wt,nt,tt.worldSize/tt._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),_t=new Float32Array(9),ot=new Float32Array(16),bt=[0,0],Lt=new Float32Array(9));const Wt=Bm(rt,Ze,_t,ot,Lt,Qe||[0,0],a.aj(M.transform.zoom),bt,pt,Xe||1,We,re),jt=M.isTileAffectedByFog(Ee),zt=M.getOrCreateProgram("rasterParticle",{defines:Ce,overrideFog:jt});if(M.uploadCommonUniforms($,zt,Ge),ce){const hi=new fi(ie.LEQUAL,fi.ReadOnly,M.depthRangeFor3D),ai=0,Xt=M.globeSharedBuffers;if(Xt){const[oi,_i,Ti]=Xt.getGridBuffers(nt,ai!==0);zt.draw(M,ie.TRIANGLES,hi,Ae,Ii.alphaBlended,M.renderElevatedRasterBackface?Si.frontCCW:Si.backCCW,Wt,z.id,oi,_i,Ti)}}else{const hi=M.depthModeForSublayer(0,fi.ReadOnly),ai=de[Ee.overscaledZ],{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:oi,tileBoundsSegments:_i}=M.getTileBoundsBuffers(je);zt.draw(M,ie.TRIANGLES,hi,ai,Ii.alphaBlended,Si.disabled,Wt,z.id,Xt,oi,_i)}}M.resetStencilClippingMasks()})(m,i,c,g),m.style.map.triggerRepaint())},background:function(m,i,c,g){const E=c.paint.get("background-color"),A=c.paint.get("background-color-use-theme").constantOr("default")==="none",M=c.paint.get("background-opacity"),D=c.paint.get("background-emissive-strength"),z=c.paint.get("background-pitch-alignment")==="viewport";if(M===0)return;const U=m.context,$=U.gl,ie=m.transform,K=ie.tileSize,re=c.paint.get("background-pattern");let he;if(re!==void 0&&(re===null||(he=m.imageManager.getPattern(a.I.from(re.toString()),c.scope,m.style.getLut(c.scope)),!he)))return;const ce=!re&&E.a===1&&M===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ce)return;const de=Mi.disabled,ge=m.depthModeForSublayer(0,ce==="opaque"?fi.ReadWrite:fi.ReadOnly),Ce=m.colorModeForDrapableLayerRenderPass(D),Ae=re?"backgroundPattern":"background";let Ee,Ge=g;Ge||(Ee=m.getBackgroundTiles(),Ge=Object.values(Ee).map(Ue=>Ue.tileID)),re&&(U.activeTexture.set($.TEXTURE0),m.imageManager.bind(m.context,c.scope));const je=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&je.push("USE_MRT1"),z){const Ue=m.getOrCreateProgram(Ae,{overrideFog:!1,overrideRtt:!0,defines:je}),ze=new Float32Array(a.bA([])),Pe=new a.aQ(0,0,0,0,0),We=re?Qs(ze,D,M,m,0,c.scope,he,z,{tileID:Pe,tileSize:K}):ml(ze,D,M,E.toPremultipliedRenderColor(A?null:c.lut));return void Ue.draw(m,$.TRIANGLES,ge,de,Ce,Si.disabled,We,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}for(const Ue of Ge){const ze=m.isTileAffectedByFog(Ue),Pe=m.getOrCreateProgram(Ae,{overrideFog:ze,defines:je}),We=Ue.toUnwrapped(),Xe=g?Ue.projMatrix:m.transform.calculateProjMatrix(We);m.prepareDrawTile();const Qe=i?i.getTile(Ue):Ee?Ee[Ue.key]:new Cl(Ue,K,ie.zoom,m),rt=re?Qs(Xe,D,M,m,0,c.scope,he,z,{tileID:Ue,tileSize:K}):ml(Xe,D,M,E.toPremultipliedRenderColor(A?null:c.lut));m.uploadCommonUniforms(U,Pe,We);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:pt,tileBoundsSegments:wt}=m.getTileBoundsBuffers(Qe);Pe.draw(m,$.TRIANGLES,ge,de,Ce,Si.disabled,rt,c.id,tt,pt,wt)}},sky:function(m,i,c){const g=m._atmosphere?a.aj(m.transform.zoom):1,E=c.paint.get("sky-opacity")*g;if(E===0)return;const A=m.context,M=c.paint.get("sky-type"),D=new fi(A.gl.LEQUAL,fi.ReadOnly,[0,1]),z=m.frameCounter/1e3%1;M==="atmosphere"?m.renderPass==="offscreen"?c.needsSkyboxCapture(m)&&((function(U,$){const ie=U.context,K=ie.gl;let re=$.skyboxFbo;if(!re){re=$.skyboxFbo=ie.createFramebuffer(32,32,1,null),$.skyboxGeometry=new fa(ie),$.skyboxTexture=ie.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,$.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ge=0;ge<6;++ge)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(re.framebuffer),ie.viewport.set([0,0,32,32]);const he=$.getCenter(U,!0),ce=U.getOrCreateProgram("skyboxCapture"),de=new Float64Array(16);a.bA(de),a.en(de,de,.5*-Math.PI),Wl(U,$,ce,de,he,0),a.bA(de),a.en(de,de,.5*Math.PI),Wl(U,$,ce,de,he,1),a.bA(de),a.cU(de,de,.5*-Math.PI),Wl(U,$,ce,de,he,2),a.bA(de),a.cU(de,de,.5*Math.PI),Wl(U,$,ce,de,he,3),a.bA(de),Wl(U,$,ce,de,he,4),a.bA(de),a.en(de,de,Math.PI),Wl(U,$,ce,de,he,5),ie.viewport.set([0,0,U.width,U.height])})(m,c),c.markSkyboxValid(m)):m.renderPass==="sky"&&(function(U,$,ie,K,re){const he=U.context,ce=he.gl,de=U.transform,ge=U.getOrCreateProgram("skybox");he.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,$.skyboxTexture);const Ce=((Ae,Ee,Ge,je,Ue)=>({u_matrix:Ae,u_sun_direction:Ee,u_cubemap:0,u_opacity:je,u_temporal_offset:Ue}))(de.skyboxMatrix,$.getCenter(U,!1),0,K,re);U.uploadCommonUniforms(he,ge),ge.draw(U,ce.TRIANGLES,ie,Mi.disabled,U.colorModeForRenderPass(),Si.backCW,Ce,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)})(m,c,D,E,z):M==="gradient"&&m.renderPass==="sky"&&(function(U,$,ie,K,re){const he=U.context,ce=he.gl,de=U.transform,ge=U.getOrCreateProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new fa(he)),he.activeTexture.set(ce.TEXTURE0);let Ce=$.colorRampTexture;Ce||(Ce=$.colorRampTexture=new a.T(he,$.colorRamp,ce.RGBA8)),Ce.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Ae=((Ee,Ge,je,Ue,ze)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:Ge,u_radius:a.an(je),u_opacity:Ue,u_temporal_offset:ze}))(de.skyboxMatrix,$.getCenter(U,!1),$.paint.get("sky-gradient-radius"),K,re);U.uploadCommonUniforms(he,ge),ge.draw(U,ce.TRIANGLES,ie,Mi.disabled,U.colorModeForRenderPass(),Si.backCW,Ae,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)})(m,c,D,E,z)},custom:function(m,i,c,g){const E=m.context,A=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&c.isDraped(i)){if(m.renderPass==="offscreen"){const M=A.prerender;if(M){if(m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;M.call(A,E.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),a.aj(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else M.call(A,E.gl,m.transform.customLayerMatrix());E.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const D=A.renderToTile;if(D){const z=g[0].canonical,U={x:z.x+g[0].wrap*(A.wrapTileId?0:1<<z.z),y:z.y,z:z.z};E.setDepthMode(fi.disabled),E.setStencilMode(Mi.disabled),E.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),D.call(A,E.gl,U),E.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),E.setStencilMode(Mi.disabled);const M=A.renderingMode==="3d"?new fi(m.context.gl.LEQUAL,fi.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,fi.ReadOnly);if(E.setDepthMode(M),m.transform.projection.name==="globe"){const D=m.transform.pointMerc;A.render(E.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),a.aj(m.transform.zoom),[D.x,D.y],m.transform.pixelsPerMeterRatio)}else A.render(E.gl,m.transform.customLayerMatrix());E.setDirty(),m.setBaseState(),E.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,i,c,g){if(m.renderPass==="opaque")return;const E=c.paint.get("model-opacity").constantOr(1),A=c.paint.get("model-elevation-reference"),M=A==="ground",D=A==="ground";if(E===0)return;const z=c.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!z||m.terrain&&E<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof a.ad))return;const U=m.shadowRenderer,$=c.paint.get("model-receive-shadows");U&&(U.useNormalOffset=!0,$||(U.enabled=!1));const ie=()=>{U&&(U.useNormalOffset=!0,$||(U.enabled=!0))},K=i.getSource();if(m.renderPass==="light-beam"&&K.type!=="batched-model")return;if(K.type==="vector"||K.type==="geojson")return(function(Ee,Ge,je,Ue,ze){const Pe=Ee.transform,We=Pe.projection.name==="globe",Xe=Pe.getFreeCameraOptions().position;if(!Ee.modelManager)return;const Qe=Ee.modelManager;je.modelManager=Qe;const rt=Ee.shadowRenderer;if(!je._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const tt=je._unevaluatedLayout._values["model-id"],pt=Object.assign({},je.layout.get("model-id").parameters),wt=Ee.style.order.indexOf(je.fqid),nt=je.paint.get("model-opacity").constantOr(1);for(const Ze of Ue){const _t=Ge.getTile(Ze).getBucket(je);if(!_t||_t.projection.name!==Pe.projection.name)continue;const ot=_t.getModelUris();if(ot&&!_t.modelsRequested&&(Qe.addModelsFromBucket(ot,ze),_t.modelsRequested=!0),We)pt.zoom=Ze.overscaledZ;else{const Xt=Nt(Ze,Pe);pt.zoom=Xt}const bt=tt.possiblyEvaluate(pt);if(Sc(Ee,_t,Ze),ta.shadowUniformsInitialized=!1,ta.useSingleShadowCascade=!!rt&&rt.getMaxCascadeForTile(Ze.toUnwrapped())===0,Ee.renderPass==="shadow"&&rt){if(Ee.currentShadowCascade===1&&_t.isInsideFirstShadowMapFrustum)continue;const Xt=Pe.calculatePosMatrix(Ze.toUnwrapped(),Pe.worldSize);if(ta.tileMatrix.set(Xt),ta.shadowTileMatrix=Float32Array.from(rt.calculateShadowPassMatrixFromMatrix(Xt)),ta.aabb.min=[0,0,0],ta.aabb.max[0]=ta.aabb.max[1]=a.al,ta.aabb.max[2]=0,Kr(_t,ta,Ee,je.scope))continue}const Lt=1<<Ze.canonical.z,Wt=[((Xe.x-Ze.wrap)*Lt-Ze.canonical.x)*a.al,(Xe.y*Lt-Ze.canonical.y)*a.al,Xe.z*Lt*a.al];Ee.conflationActive&&Object.keys(_t.instancesPerModel).length>0&&Ee.style.isLayerClipped(je,Ge.getSource())&&_t.updateReplacement(Ze,Ee.replacementSource,wt,je.scope)&&(_t.uploaded=!1,_t.upload(Ee.context));let jt=0;const zt=new Array,hi=new Array,ai=new Array;for(let Xt in _t.instancesPerModel){const oi=_t.instancesPerModel[Xt];oi.features.length>0&&!We&&(Xt=bt.evaluate(oi.features[0].feature,{}));const _i=Qe.getModel(Xt,ze);if(_i||Qe.hasURLBeenRequested(Xt)||_t.modelUris.includes(Xt)||(_t.modelUris.push(Xt),_t.modelsRequested=!1),_i&&_i.uploaded)if(We){const Ti=a.c5([],[Xe.x,Xe.y,Xe.z],Ee.transform.worldSize);a.ew(Ti,Ti);for(let Fi=0;Fi<oi.instancedDataArray.length;++Fi){const Yi=[0,0,0],Ai=[1,1,1],Bi=a.ex(),Di=oi.tileCoordinatesForInstance(Fi),ur=oi.transformForInstance(Fi);a.ey(Ai,ur),a.ez(Bi,ur),a.eA(Yi,Bi);const sr=oi.translationForInstance(Fi),vr=new a.aT(0,0);a.eB(_t.canonical,vr,Di.x,Di.y);const er=a.bC();a.eC(er,_i,Ee.transform,vr,Yi,Ai,sr,!0,!1,!1);const ji=oi.colorForInstance(Fi),or=a.bA([]),Hr=a.ef(vr.lat,Ee.transform.zoom),br=a.bq([],[1,1,1/Hr]);a.br(or,or,Ti),ai.push({zScaleMatrix:br,negCameraPosMatrix:or});for(const pr of _i.nodes)cu(Ee,pr,er,Ee.transform.expandedFarZProjMatrix,jt,zt,hi,_i.materialOverrides,nt,ji);++jt}}else for(const Ti of _i.nodes)Qt(Ee,je,Ti,oi,Wt,Ze,ta)}if(We)if(Ee.renderPass==="shadow"){for(const Xt of hi)oh(Xt.mesh,Xt.nodeModelMatrix,Ee,je);for(const Xt of zt)oh(Xt.mesh,Xt.nodeModelMatrix,Ee,je)}else vf(Ee,je,zt,hi,ai)}})(m,i,c,g,ah(m,c)),void ie();if(!K.loaded())return;if(K.type==="batched-model")return(function(Ee,Ge,je,Ue){je.resetLayerRenderingStats(Ee);const ze=Ee.context,Pe=Ee.transform,We=Ee.style.fog,Xe=Ee.shadowRenderer;if(Pe.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Pe.projection.name} projection is not yet implemented`);const Qe=Ee.transform.getFreeCameraOptions().position,rt=a.c5([],[Qe.x,Qe.y,Qe.z],Ee.transform.worldSize),tt=a.ew([],rt),pt=a.bA([]),wt=a.ef(Pe.center.lat,Pe.zoom),nt=a.bq([],[1,1,1/wt]);a.br(pt,pt,tt);const Ze=je.paint.get("model-opacity").constantOr(1),_t=new fi(ze.gl.LEQUAL,fi.ReadWrite,Ee.depthRangeFor3D),ot=new fi(ze.gl.LEQUAL,fi.ReadOnly,Ee.depthRangeFor3D),bt=new a.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Lt=Ee.renderPass==="shadow",Wt=Lt&&Xe?Xe.getCurrentCascadeFrustum():Pe.getFrustum(Pe.scaleZoom(Pe.worldSize)),jt=je.paint.get("model-front-cutoff"),zt=jt[2]<1,hi=Ya(Ee,je.paint.get("model-cutoff-fade-range")),ai=je.getLayerRenderingStats();(function(Xt,oi,_i,Ti){const Fi=Xt.terrain?Xt.terrain.exaggeration():0,Yi=Xt.transform.zoom;for(const Ai of Ti){const Bi=oi.getTile(Ai).getBucket(_i);Bi&&(Bi.setFilter(_i.filter),Xt.conflationActive&&Bi.updateReplacement(Ai,Xt.replacementSource),Bi.evaluateTransform(Xt,_i),Xt.terrain&&Fi>0&&Bi.elevationUpdate(Xt.terrain,Fi,Ai,_i.source),Bi.needsReEvaluation(Xt,Yi,_i)&&Bi.evaluate(_i))}})(Ee,Ge,je,Ue),(function(){let Xt,oi,_i;zt?(Xt=Ue.length-1,oi=-1,_i=-1):(Xt=0,oi=Ue.length,_i=1);const Ti=new Float64Array(16),Fi=a.cA(),Yi=new a.P(0,0);for(let Ai=Xt;Ai!==oi;Ai+=_i){const Bi=Ue[Ai],Di=Ge.getTile(Bi).getBucket(je);if(!Di||!Di.uploaded)continue;let ur=!1;Xe&&(ur=Xe.getMaxCascadeForTile(Bi.toUnwrapped())===0);const sr=Pe.calculatePosMatrix(Bi.toUnwrapped(),Pe.worldSize),vr=Di.modelTraits;!Lt&&zt&&(a.bl(Ti,sr),a.af(Fi,rt,Ti),Yi.x=Fi[0],Yi.y=Fi[1]);const er=[];Di.setFilter(je.filter);for(const ji of Di.getNodesInfo()){if(ji.hiddenByReplacement||!ji.node.meshes)continue;const or=ji.node;let Hr=0;Ee.terrain&&or.elevation&&(Hr=or.elevation*Ee.terrain.exaggeration());const br=(()=>{const mr=ji.aabb;return bt.min=[...mr.min],bt.max=[...mr.max],bt.min[2]+=Hr,bt.max[2]+=Hr,a.af(bt.min,bt.min,sr),a.af(bt.max,bt.max,sr),bt})(),pr=ji.evaluatedScale;if(pr[0]<=1&&pr[1]<=1&&pr[2]<=1&&br.intersects(Wt)===0)continue;if(!Lt&&zt){const mr=.16666666666666666;ji.cameraCollisionOpacity=rt[0]>br.min[0]&&rt[0]<br.max[0]&&rt[1]>br.min[1]&&rt[1]<br.max[1]&&rt[2]*wt<br.max[2]&&or.footprint&&a.c0(Yi,or.footprint)?Math.max(ji.cameraCollisionOpacity-mr,0):Math.min(1,ji.cameraCollisionOpacity+mr)}const Oi=[...sr],Ni=1/a.d7(Bi.canonical),kr=or.anchor?or.anchor[0]:0,sn=or.anchor?or.anchor[1]:0;a.br(Oi,Oi,[kr*(pr[0]-1)+ji.evaluatedTranslation[0]*Ni,sn*(pr[1]-1)+ji.evaluatedTranslation[1]*Ni,Hr+ji.evaluatedTranslation[2]]),a.cq(pr,a.eE)||a.cS(Oi,Oi,pr);const Er=a.aB([],Oi,or.globalMatrix),Lr=a.aB([],Pe.expandedFarZProjMatrix,Er),Vs=a.aB([],Pe.expandedFarZProjMatrix,Oi),ws=a.aC([],[kr,sn,Hr,1],Lr)[2];or.hidden=!1;let ns=Ze;Lt||(zt&&(ns*=ji.cameraCollisionOpacity,ns*=Ip(Oi,Pe,ji.aabb,jt)),ns*=it(hi,ws)),ns!==0?er.push({nodeInfo:ji,depth:ws,opacity:ns,wvpForNode:Lr,wvpForTile:Vs,nodeModelMatrix:Er,tileModelMatrix:Oi}):or.hidden=!0}Lt||er.sort((ji,or)=>!zt||ji.opacity===1&&or.opacity===1?ji.depth<or.depth?-1:1:ji.opacity===1?-1:or.opacity===1?1:ji.depth>or.depth?-1:1);for(const ji of er){const or=ji.nodeInfo,Hr=or.node;let br=a.aB([],nt,ji.tileModelMatrix);a.aB(br,pt,br);const pr=a.bl([],br);a.eg(pr,pr),a.cS(pr,pr,uu),br=a.aB(br,br,Hr.globalMatrix);const Oi=Ee.renderPass==="light-beam",Ni=je.paint.get("model-color-use-theme").constantOr("default")==="none",kr=vr&a.eI.HasMapboxMeshFeatures,sn=kr?0:or.evaluatedRMEA[0][2];for(let Er=0;Er<Hr.meshes.length;++Er){const Lr=Hr.meshes[Er],Vs=Er===Hr.lightMeshIndex;let ws=ji.wvpForNode;if(Vs){if(!Oi&&!Ee.terrain&&Ee.shadowRenderer){Ee.currentLayer<Ee.firstLightBeamLayer&&(Ee.firstLightBeamLayer=Ee.currentLayer);continue}ws=ji.wvpForTile}else if(Oi)continue;const ns={defines:[]},mr=[];if(!Lt&&Xe&&(Xe.useNormalOffset=!!Lr.normalBuffer),Fa(ns.defines,mr,Lr,Ee,Ni?null:je.lut),kr||ns.defines.push("DIFFUSE_SHADED"),ur&&ns.defines.push("SHADOWS_SINGLE_CASCADE"),ai&&(Lt?ai.numRenderedVerticesInShadowPass+=Lr.vertexArray.length:ai.numRenderedVerticesInTransparentPass+=Lr.vertexArray.length),Lt){oh(Lr,ji.nodeModelMatrix,Ee,je);continue}let Aa=null;if(We){const Cn=xf(ji.nodeModelMatrix,Ee.transform);if(Aa=new Float32Array(Cn),Pe.projection.name!=="globe"){const jr=Lr.aabb.min,Ln=Lr.aabb.max,[Jn,tn]=We.getOpacityForBounds(Cn,jr[0],jr[1],Ln[0],Ln[1]);ns.overrideFog=Jn>=ii||tn>=ii}}const Es=Lr.material;let Ms;Es.occlusionTexture&&Es.occlusionTexture.offsetScale&&(Ms=Es.occlusionTexture.offsetScale,ns.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Va=Ee.getOrCreateProgram("model",ns);!Lt&&Xe&&Xe.setupShadowsFromMatrix(ji.tileModelMatrix,Va,Xe.useNormalOffset),Ee.uploadCommonUniforms(ze,Va,null,Aa);const pa=Es.pbrMetallicRoughness;pa.metallicFactor=.9,pa.roughnessFactor=.5;const Qr=jo(new Float32Array(ws),new Float32Array(br),new Float32Array(pr),new Float32Array(Hr.globalMatrix),Ee,ji.opacity,pa.baseColorFactor,Es.emissiveFactor,pa.metallicFactor,pa.roughnessFactor,Es,sn,je,[0,0,0],Ms);!Vs&&(or.hasTranslucentParts||ji.opacity<1)&&Va.draw(Ee,ze.gl.TRIANGLES,_t,Mi.disabled,Ii.disabled,Si.backCCW,Qr,je.id,Lr.vertexBuffer,Lr.indexBuffer,Lr.segments,je.paint,Ee.transform.zoom,void 0,mr),Va.draw(Ee,ze.gl.TRIANGLES,Vs?ot:_t,Mi.disabled,Vs||ji.opacity<1||or.hasTranslucentParts?Ii.alphaBlended:Ii.unblended,Si.backCCW,Qr,je.id,Lr.vertexBuffer,Lr.indexBuffer,Lr.segments,je.paint,Ee.transform.zoom,void 0,mr)}}}})()})(m,i,c,g),void ie();if(K.type!=="model")return;const re=K.getModels(),he=[],ce=m.transform.getFreeCameraOptions().position,de=a.c5([],[ce.x,ce.y,ce.z],m.transform.worldSize);a.ew(de,de);const ge=[],Ce=[];let Ae=0;for(const Ee of re){const Ge=i.getFeatureState("",Ee.id),je={type:"Unknown",id:Ee.id,properties:Ee.featureProperties},Ue=c.paint.get("model-rotation").evaluate(je,Ge),ze=c.paint.get("model-scale").evaluate(je,Ge),Pe=c.paint.get("model-translation").evaluate(je,Ge),We=c.paint.get("model-opacity").evaluate(je,Ge);Mp(c,Ee.id,Ge,Ee.featureProperties,Ee.nodeOverrideNames,Ee.nodeOverrides),Pp(c,Ee.id,Ge,Ee.featureProperties,Ee.materialOverrideNames,Ee.materialOverrides),Ee.nodeOverrides.size>0&&Ee.computeBoundsAndApplyParent(),Ee.computeModelMatrix(m,Ue,ze,Pe,D,M,!1);const Xe=a.bA([]),Qe=a.ef(Ee.position.lat,m.transform.zoom),rt=a.bq([],[1,1,1/Qe]);a.br(Xe,Xe,de),he.push({zScaleMatrix:rt,negCameraPosMatrix:Xe});for(const tt of Ee.nodes)cu(m,tt,Ee.matrix,m.transform.expandedFarZProjMatrix,Ae,ge,Ce,Ee.materialOverrides,We);Ae++}if(ge.sort((Ee,Ge)=>Ge.depth-Ee.depth),m.renderPass!=="shadow")vf(m,c,ge,Ce,he),ie();else{for(const Ee of Ce)oh(Ee.mesh,Ee.nodeModelMatrix,m,c);for(const Ee of ge)oh(Ee.mesh,Ee.nodeModelMatrix,m,c);ie()}}},Ef={line:function(m,i,c){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const g=i.getVisibleCoordinates();for(const E of g){const A=i.getTile(E).getBucket(m);if(A&&(A.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,i,c){const g=i.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,ah(c,m)));if(g.type==="batched-model"||g.type!=="model")return;const E=g.getModels();for(const A of E)A.upload(c.context)},raster:function(m,i,c){const g=i.getSource();if(!(g instanceof Zs&&g.loaded()))return;const E=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!E)return;const A=m.paint.get("raster-array-band")||g.getInitialBand(E);if(A==null)return;const M=i.getIds().map(D=>i.getTileByID(D));for(const D of M)D.updateNeeded(m.id,A)&&g.prepareTile(D,E,m.id,A)},"raster-particle":function(m,i,c){const g=i.getSource();if(!(g instanceof Zs&&g.loaded()))return;const E=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!E)return;const A=m.paint.get("raster-particle-array-band")||g.getInitialBand(E);if(A==null)return;const M=i.getIds().map(D=>i.getTileByID(D));for(const D of M)D.updateNeeded(m.id,A)&&g.prepareTile(D,E,m.id,A)}},vd={fill:bp},Lp={fill:function(m,i,c,g){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const E=m.context.gl,A=new fi(E.LEQUAL,fi.ReadOnly,m.depthRangeFor3D),M=new Mi({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),D=m.transform.getFreeCameraOptions().position,z=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const U of g){const $=i.getTile(U),ie=$.getBucket(c);if(!ie)continue;const K=ie.elevatedStructures;if(!K||K.depthSegments.segments[0].primitiveLength===0)continue;const re=vc(U.toUnwrapped(),D),he=m.translatePosMatrix(U.projMatrix,$,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),ce=yc(he,re,0,1,0);z.draw(m,E.TRIANGLES,A,M,Ii.disabled,Si.disabled,ce,c.id,K.vertexBuffer,K.indexBuffer,K.depthSegments,c.paint,m.transform.zoom)}}};class Sf{constructor(i,c,g,E,A){this.context=new xo(i,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=a.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of M)this._debugParams.enabledLayers[z]=!0;for(const z of M);this.occlusionParams=new wf,this.setup(),this.numSublayers=Kn.maxUnderzooming+Kn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Gh(this),this._wireframeDebugCache=new md,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new a.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,D,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=E,this.worldview=A,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(i,c){const g=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new eh(this,i));const E=this._terrain;this.transform.elevation=g?E:null,E.update(i,this.transform,c),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(i){const c=i.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,E]=c.getFovAdjustedRange(this.transform._fov);if(g>E)return void(this.transform.fogCullDistSq=null);const A=g+.78*(E-g);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new eh(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,c){if(this.width=i*a.o.devicePixelRatio,this.height=c*a.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const i=this.context,c=new a.bd;c.emplaceBack(0,0),c.emplaceBack(a.al,0),c.emplaceBack(0,a.al),c.emplaceBack(a.al,a.al),this.tileExtentBuffer=i.createVertexBuffer(c,a.bf.members),this.tileExtentSegments=a.bg.simpleSegment(0,0,4,2);const g=new a.bd;g.emplaceBack(0,0),g.emplaceBack(a.al,0),g.emplaceBack(0,a.al),g.emplaceBack(a.al,a.al),this.debugBuffer=i.createVertexBuffer(g,a.bf.members),this.debugSegments=a.bg.simpleSegment(0,0,4,5);const E=new a.bd;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(E,a.bf.members),this.viewportSegments=a.bg.simpleSegment(0,0,4,2);const A=new a.b1;A.emplaceBack(0,0,0,0),A.emplaceBack(a.al,0,a.al,0),A.emplaceBack(0,a.al,0,a.al),A.emplaceBack(a.al,a.al,a.al,a.al),this.mercatorBoundsBuffer=i.createVertexBuffer(A,a.bi.members),this.mercatorBoundsSegments=a.bg.simpleSegment(0,0,4,2);const M=new a.b0;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(M);const D=new a.be;for(const U of[0,1,3,2,0])D.emplaceBack(U);this.debugIndexBuffer=i.createIndexBuffer(D),this.emptyTexture=new a.T(i,new a.q({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=a.bC();const z=this.context.gl;this.stencilClearMode=new Mi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,fi.disabled,this.stencilClearMode,Ii.disabled,Si.disabled,Ju(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,g){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const z of g)if(this._tileClippingMaskIDs[z.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=c.id;const E=this.context,A=E.gl;this.nextStencilID+g.length>256&&this.clearStencil(),E.setColorMode(Ii.disabled),E.setDepthMode(fi.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of g){const z=c.getTile(D),U=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:ie,tileBoundsSegments:K}=this.getTileBoundsBuffers(z);M.draw(this,A.TRIANGLES,fi.disabled,new Mi({func:A.ALWAYS,mask:0},U,255,A.KEEP,A.KEEP,A.REPLACE),Ii.disabled,Si.disabled,Ju(D.projMatrix),"$clipping",$,ie,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new Mi({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new Mi({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,g=i.sort((M,D)=>D.overscaledZ-M.overscaledZ),E=g[g.length-1].overscaledZ,A=g[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const M={};for(let D=0;D<A;D++)M[D+E]=new Mi({func:c.GEQUAL,mask:255},D+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=A,[M,g]}return[{[E]:Mi.disabled},g]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ii([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new a.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ii.unblended:Ii.alphaBlended}colorModeForDrapableLayerRenderPass(i){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?i!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Ii([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new a.ao(0,0,0,i??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Ii([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],a.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(i,c,g,E=!1){if(this.depthOcclusion)return new fi(this.context.gl.GREATER,fi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return fi.disabled;const A=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new fi(g||this.context.gl.LEQUAL,c,[A,A])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,c=Math.ceil(this.width),g=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),A=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&g!==0&&(this.depthFBO=new gl(this.context,c,g,0,"texture"),this.depthTexture=new a.T(this.context,{width:c,height:g,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),i.bindTexture(i.TEXTURE_2D,A),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,c,g,0,0,c,g,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,c)=>i+c/this._fpsHistory.length,0))}render(i,c){const g=a.o.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=c;const E=this.style._mergedLayers,A=!(!this.terrain||!this.terrain.enabled),M=()=>this.style._getOrder(A).filter(nt=>{const Ze=E[nt];return!(Ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ze.type]});let D=M(),z=!1,U=!1,$=null,ie=0,K=!1;for(const nt of D){const Ze=E[nt];Ze.visibility!=="none"&&(Ze.type==="circle"?z=!0:Ze.type==="building"?($=Ze,++ie):Ze.type==="symbol"&&(Ze.hasOcclusionOpacityProperties?U=!0:z=!0))}this.updateEmissiveMode();let re=D.map(nt=>E[nt]);const he=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(a.o.now()),this.imageManager.beginFrame();for(const nt in he){const Ze=he[nt];Ze.used&&(Ze.prepare(this.context),Ze.getSource().usedInConflation&&++ie)}let ce=!1;for(const nt of re)nt.isHidden(this.transform.zoom)||(nt.type==="clip"&&(ce=!0),this.prepareLayer(nt));const de={},ge={},Ce={},Ae={},Ee={};for(const nt in he){const Ze=he[nt];de[nt]=Ze.getVisibleCoordinates(),ge[nt]=de[nt].slice().reverse(),Ce[nt]=Ze.getVisibleCoordinates(!0).reverse(),Ae[nt]=Ze.getShadowCasterCoordinates(),Ee[nt]=Ze.sortCoordinatesByDistance(de[nt])}const Ge=nt=>{const Ze=this.style.getLayerSourceCache(nt);return Ze&&Ze.used?Ze.getSource():null};if(ie||ce||this._clippingActiveLastFrame){const nt=[],Ze=[];let _t=0;for(const ot of re)this.isSourceForClippingOrConflation(ot,Ge(ot))&&(nt.push(ot),Ze.push(_t)),_t++;if(nt&&(ce||nt.length>1)||this._clippingActiveLastFrame){ce=!1;const ot=[];for(let bt=0;bt<nt.length;bt++){const Lt=nt[bt],Wt=Ze[bt],jt=this.style.getLayerSourceCache(Lt);if(!jt||!jt.used||!jt.getSource().usedInConflation&&Lt.type!=="clip"&&Lt.type!=="building")continue;let zt=a.eQ,hi=a.b_.None;const ai=[];let Xt=!0;if(Lt.type==="building")zt=a.eS;else if(Lt.type==="clip")if(zt=Wt,Lt.isHidden(this.transform.zoom))Xt=!1;else{if(!Lt.layout){Xt=!1;continue}for(const oi of Lt.layout.get("clip-layer-types"))hi|=oi==="model"?a.b_.Model:oi==="symbol"?a.b_.Symbol:a.b_.FillExtrusion;for(const oi of Lt.layout.get("clip-layer-scope"))ai.push(oi);ce=!0}Xt&&ot.push({layer:Lt.fqid,cache:jt,order:zt,clipMask:hi,clipScope:ai})}this.replacementSource.setSources(ot),K=!0}}this._clippingActiveLastFrame=ce,K||this.replacementSource.clear(),this.conflationActive=K,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let nt=0;nt<re.length;nt++){const Ze=re[nt];if(Ze.visibility==="none")continue;const _t=Ze.cutoffRange();if(this.longestCutoffRange=Math.max(_t,this.longestCutoffRange),_t>0){const ot=Ge(Ze);ot&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom)),Ze.minzoom&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom))}Ze.is3D(A)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=nt),this._lastOcclusionLayer=nt)}const je=this.style&&this.style.fog;je?(this._fogVisible=je.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=je.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ce),this.opaquePassCutoff=0,D=M(),re=D.map(nt=>E[nt]));const Ue=this._shadowRenderer;if(Ue){Ue.updateShadowParameters(this.transform,this.style.directionalLight);for(const nt in he)for(const Ze of de[nt]){let _t={min:0,max:0};this.terrain&&(_t=this.terrain.getMinMaxForTile(Ze)||_t),Ue.addShadowReceiver(Ze.toUnwrapped(),_t.min,_t.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _f(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ze=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ze&&!this._snow&&(this._snow=new ch(this)),!ze&&this._snow&&(this._snow.destroy(),delete this._snow),Pe&&!this._rain&&(this._rain=new _d(this)),!Pe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),$){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ec);const nt=this.style.getLayerSourceCache($);this.buildingTileBorderManager.updateBorders(nt,$)}if(!Wn.has(this.context.gl))return;this.renderPass="offscreen";for(const nt of re){const Ze=i.getLayerSourceCache(nt);if(!nt.hasOffscreenPass()||nt.isHidden(this.transform.zoom))continue;const _t=Ze?ge[Ze.id]:void 0;(nt.type==="custom"||nt.type==="raster"||nt.type==="raster-particle"||nt.isSky()||_t&&_t.length)&&this.renderLayer(this,Ze,nt,_t)}this.depthRangeFor3D=[0,1-(re.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const We=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Xe=(()=>{if(c.showOverdrawInspector)return a.ao.black;const nt=this.style.fog;if(nt&&this.transform.projection.supportsFog){const Ze=this.style.getLut(nt.scope);if(!We){const _t=nt.properties.get("color-use-theme")==="none",ot=nt.properties.get("color").toNonPremultipliedRenderColor(_t?null:Ze).toArray01();return new a.ao(...ot)}if(We){const _t=nt.properties.get("space-color-use-theme")==="none",ot=nt.properties.get("space-color").toNonPremultipliedRenderColor(_t?null:Ze).toArray01();return new a.ao(...ot)}}return a.ao.transparent})();if(this.context.clear({color:Xe,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const nt=re[this.currentLayer],Ze=i.getLayerSourceCache(nt);if(nt.isSky())continue;const _t=Ze?(nt.is3D(A)?Ee:ge)[Ze.id]:void 0;this._renderTileClippingMasks(nt,Ze,_t),this.renderLayer(this,Ze,nt,_t)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const nt=re[this.currentLayer],Ze=i.getLayerSourceCache(nt);nt.isSky()&&this.renderLayer(this,Ze,nt,Ze?ge[Ze.id]:void 0)}function Qe(nt,Ze){let _t;return Ze&&(_t=(nt.type==="symbol"?Ce:nt.is3D(A)?Ee:ge)[Ze.id]),_t}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const nt=re[this.currentLayer];if(nt.type==="raster"||nt.type==="raster-particle"){const Ze=i.getLayerSourceCache(nt);this.renderLayer(this,Ze,nt,Qe(nt,Ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const rt=Ue?Ue.getGroundShadowLayerIndex():-1;let tt=!1,pt=-1;for(let nt=0;nt<D.length;++nt){const Ze=re[nt];Ze.isHidden(this.transform.zoom)||Ze.is3D(A)&&(pt=nt)}U&&pt===-1&&(z=!0);let wt=!1;for(;this.currentLayer<D.length;){const nt=re[this.currentLayer],Ze=i.getLayerSourceCache(nt);if(nt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(nt)){if(nt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!wt&&nt.is3D(A)&&!A){const _t=this.currentLayer,ot=bt=>{for(this.currentLayer=0;this.currentLayer<re.length;this.currentLayer++){const Lt=re[this.currentLayer];if(vd[Lt.type]){const Wt=this.style.getLayerSourceCache(Lt);vd[Lt.type](this,Wt,Lt,Qe(Lt,Wt),bt)}}};ot("initialize"),ot("reset"),this.currentLayer=_t,wt=!0}if(z&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),U&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(nt,Ze,Ze?de[Ze.id]:void 0),this.renderLayer(this,Ze,nt,Qe(nt,Ze)),!this.terrain&&Ue&&this.currentLayer===rt){{this.clearStencil(),this.resetStencilClippingMasks();const _t=this.currentLayer;for(this.currentLayer=0;this.currentLayer<re.length;this.currentLayer++){const ot=re[this.currentLayer];if(Lp[ot.type]){const bt=this.style.getLayerSourceCache(ot);Lp[ot.type](this,bt,ot,Qe(ot,bt))}}this.currentLayer=_t}if(Ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const _t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=_t;this.currentLayer++){const ot=re[this.currentLayer];if(!ot.hasLightBeamPass())continue;const bt=i.getLayerSourceCache(ot);this.renderLayer(this,bt,ot,bt?ge[bt.id]:void 0)}this.currentLayer=_t,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const _t=this.currentLayer;this.depthOcclusion=!0;for(const ot of this.layersWithOcclusionOpacity){this.currentLayer=ot;const bt=re[this.currentLayer],Lt=i.getLayerSourceCache(bt),Wt=Lt?ge[Lt.id]:void 0;this.terrain||this._renderTileClippingMasks(bt,Lt,Lt?de[Lt.id]:void 0),this.renderLayer(this,Lt,bt,Wt)}this.depthOcclusion=!1,this.currentLayer=_t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let nt=null;re.forEach(Ze=>{const _t=i.getLayerSourceCache(Ze);_t&&!Ze.isHidden(this.transform.zoom)&&_t.getVisibleCoordinates().length&&(!nt||nt.getSource().maxzoom<_t.getSource().maxzoom)&&(nt=_t)}),nt&&this.options.showTileBoundaries&&Ep(this,nt,nt.getVisibleCoordinates(),a.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ep(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(nt){const Ze=nt.transform.padding;Sp(nt,nt.transform.height-(Ze.top||0),3,mf),Sp(nt,Ze.bottom||0,3,gf),Tp(nt,Ze.left||0,3,yf),Tp(nt,nt.transform.width-(Ze.right||0),3,Nm);const _t=nt.transform.centerPoint;(function(ot,bt,Lt,Wt){pd(ot,bt-1,Lt-10,2,20,Wt),pd(ot,bt-10,Lt-1,20,2,Wt)})(nt,_t.x,nt.transform.height-_t.y,Vm)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),K||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:c}=this.transform.projection,g=!c||!c.includes(i.type);if(Ef[i.type]&&(g||this.terrain&&i.type==="custom")){const E=this.style.getLayerSourceCache(i);Ef[i.type](i,E,this)}this.gpuTimingEnd()}renderLayer(i,c,g,E){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||E&&E.length)&&(this.id=g.id,this.gpuTimingStart(g),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(g.type)&&(!i.terrain||g.type!=="custom")||g.type==="clip"||Uo[g.type](i,c,g,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,g=this.context.gl;let E=this.gpuTimers[i.id];E||(E=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:g.createQuery()}),E.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(i.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const c={};for(const g in i){const E=i[g],A=this.context.extTimerQuery,M=A.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;A.deleteQueryEXT(E.query),c[g]=M}return c}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let g=0;for(const E of i)g+=c.getQueryParameter(E,c.QUERY_RESULT)/1e6,c.deleteQuery(E);return g}translatePosMatrix(i,c,g,E,A){if(!g[0]&&!g[1])return i;const M=A?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(M){const U=Math.sin(M),$=Math.cos(M);g=[g[0]*$-g[1]*U,g[0]*U+g[1]*$]}const D=[A?g[0]:a.ay(c,g[0],this.transform.zoom),A?g[1]:a.ay(c,g[1],this.transform.zoom),0],z=new Float32Array(16);return a.br(z,i,D),z}saveTileTexture(i){if(i.context!==this.context)return;const c=i.size[0],g=this._tileTextures[c];g?g.push(i):this._tileTextures[c]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,c,g){const E=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,A=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||A.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||E||c!==void 0&&!c||A.push("FOG"),E&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(i,c){this.cache=this.cache||{};const g=c&&c.defines||[],E=c&&c.config,A=this.currentGlobalDefines(i,c&&c.overrideFog,c&&c.overrideRtt).concat(g),M=rd.cacheKey(nf[i],i,A,E);return this.cache[M]||(this.cache[M]=new rd(this.context,i,nf[i],E,cd[i],A)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,c){if(this.style.enable3dLights()){const g=this.style.directionalLight,E=this.style.ambientLight;if(g&&E){const A=((M,D,z)=>{const U=M.properties.get("direction"),$=M.properties.get("color-use-theme")==="none",ie=M.properties.get("color").toNonPremultipliedRenderColor($?null:z.getLut(M.scope)).toArray01(),K=M.properties.get("intensity"),re=D.properties.get("color-use-theme")==="none",he=D.properties.get("color").toNonPremultipliedRenderColor(re?null:z.getLut(D.scope)).toArray01(),ce=D.properties.get("intensity"),de=[U.x,U.y,U.z],ge=a.dN(he,ce),Ce=a.dN(ie,K);return{u_lighting_ambient_color:ge,u_lighting_directional_dir:de,u_lighting_directional_color:Ce,u_ground_radiance:Qc(de,Ce,ge)}})(g,E,this.style);c.setLightsUniformValues(i,A)}}}uploadCommonUniforms(i,c,g,E,A){if(this.uploadCommonLightUniforms(i,c),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const D=M.getOpacity(this.transform.pitch),z=((U,$,ie,K,re,he,ce,de,ge,Ce,Ae,Ee)=>{const Ge=U.transform,je=$.properties.get("color-use-theme")==="none",Ue=$.properties.get("color").toNonPremultipliedRenderColor(je?null:U.style.getLut($.scope)).toArray01();Ue[3]=K;const ze=U.frameCounter/1e3%1,[Pe,We]=$.properties.get("vertical-range");return{u_fog_matrix:ie?Ge.calculateFogTileMatrix(ie):Ee||U.identityMat,u_fog_range:$.getFovAdjustedRange(Ge._fov),u_fog_color:Ue,u_fog_horizon_blend:$.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Pe,We),We],u_fog_temporal_offset:ze,u_frustum_tl:re,u_frustum_tr:he,u_frustum_br:ce,u_frustum_bl:de,u_globe_pos:ge,u_globe_radius:Ce,u_viewport:Ae,u_globe_transition:a.aj(Ge.zoom),u_is_globe:+(Ge.projection.name==="globe")}})(this,M,g,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.o.devicePixelRatio,this.transform.height*a.o.devicePixelRatio],E);c.setFogUniformValues(i,z)}A&&c.setCutoffUniformValues(i,A.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const E of g)c[E.key]=i[E.key]||new Cl(E,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,c){return!(!i.is3D(!(!this.terrain||!this.terrain.enabled))||i.type!=="clip"&&i.type!=="building"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building"&&i.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[i.key];return c||(this._cachedTileFogOpacities[i.key]=c=this.style.fog.getOpacityForTile(i)),c[0]>=ii||c[1]>=ii}setupDepthForOcclusion(i,c,g){const E=this.context,A=E.gl,M=!!g;var D;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(A.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),E.activeTexture.set(A.TEXTURE0),M||c.setTerrainUniformValues(E,g)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const i=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=i?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Tf(m,i){let c=!1,g=null;const E=()=>{g=null,c&&(m(),g=setTimeout(E,i),c=!1)};return()=>(c=!0,g||E(),g)}class ia{constructor(i){this._hashName=i&&encodeURIComponent(i),a.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Tf(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const c=Op(i);if(this._hashName){const g=this._hashName;let E=!1;const A=location.hash.slice(1).split("&").map(M=>{const D=M.split("=")[0];return D===g?(E=!0,`${D}=${c}`):M}).filter(M=>M);return E||A.push(`${g}=${c}`),`#${A.join("&")}`}return`#${c}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(Number(g)))){const g=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(c[3]||0):i.getBearing();return i.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Op(m,i){const c=m.getCenter(),g=Math.round(100*m.getZoom())/100,E=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,E),M=Math.round(c.lng*A)/A,D=Math.round(c.lat*A)/A,z=m.getBearing(),U=m.getPitch();let $=i?`/${M}/${D}/${g}`:`${g}/${D}/${M}`;return(z||U)&&($+="/"+Math.round(10*z)/10),U&&($+=`/${Math.round(U)}`),$}const ja={linearity:.3,easing:a.eT(0,0,.3,1)},$m=Object.assign({deceleration:2500,maxSpeed:1400},ja),Nr=Object.assign({deceleration:20,maxSpeed:1400},ja),Xi=Object.assign({deceleration:1e3,maxSpeed:360},ja),bd=Object.assign({deceleration:1e3,maxSpeed:90},ja);class Xl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.o.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=a.o.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)c.zoom+=A.zoomDelta||0,c.bearing+=A.bearingDelta||0,c.pitch+=A.pitchDelta||0,A.panDelta&&c.pan._add(A.panDelta),A.around&&(c.around=A.around),A.pinchAround&&(c.pinchAround=A.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(c.pan.mag()){const A=xl(c.pan.mag(),g,Object.assign({},$m,i||{}));E.offset=c.pan.mult(A.amount/c.pan.mag()),E.center=this._map.transform.center,Go(E,A)}if(c.zoom){const A=xl(c.zoom,g,Nr);E.zoom=this._map.transform.zoom+A.amount,Go(E,A)}if(c.bearing){const A=xl(c.bearing,g,Xi);E.bearing=this._map.transform.bearing+a.aA(A.amount,-179,179),Go(E,A)}if(c.pitch){const A=xl(c.pitch,g,bd);E.pitch=this._map.transform.pitch+A.amount,Go(E,A)}if(E.zoom||E.bearing){const A=c.pinchAround===void 0?c.around:c.pinchAround;E.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function Go(m,i){(!m.duration||m.duration<i.duration)&&(m.duration=i.duration,m.easing=i.easing)}function xl(m,i,c){const{maxSpeed:g,linearity:E,deceleration:A}=c,M=a.aA(m*E/(i/1e3),-g,g),D=Math.abs(M)/(A*E);return{easing:c.easing,duration:1e3*D,amount:M*(D/2)}}class ds extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g,E={}){const A=Le(c.getCanvasContainer(),g),M=c.unproject(A);super(i,Object.assign({point:A,lngLat:M,originalEvent:g},E)),this._defaultPrevented=!1,this.target=c}}class uh extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g){const E=i==="touchend"?g.changedTouches:g.touches,A=lt(c.getCanvasContainer(),E),M=A.map(z=>c.unproject(z)),D=A.reduce((z,U,$,ie)=>z.add(U.div(ie.length)),new a.P(0,0));super(i,{points:A,point:D,lngLats:M,lngLat:c.unproject(D),originalEvent:g}),this._defaultPrevented=!1}}class wd extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class is{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new wd(this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new ds(i.type,this._map,i))}mouseup(i){this._map.fire(new ds(i.type,this._map,i))}preclick(i){const c=new MouseEvent("preclick",i);this._map.fire(new ds(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new ds(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new ds(i.type,this._map,i))}mouseover(i){this._map.fire(new ds(i.type,this._map,i))}mouseout(i){this._map.fire(new ds(i.type,this._map,i))}touchstart(i){return this._firePreventable(new uh(i.type,this._map,i))}touchmove(i){this._map.fire(new uh(i.type,this._map,i))}touchend(i){this._map.fire(new uh(i.type,this._map,i))}touchcancel(i){this._map.fire(new uh(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rs{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new ds(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ds(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class to{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(oe(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const g=c,E=this._startPos,A=this._lastPos;if(!E||!A||A.equals(g)||!this._box&&g.dist(E)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const M=Math.min(E.x,g.x),D=Math.max(E.x,g.x),z=Math.min(E.y,g.y),U=Math.max(E.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${z}px)`,this._box.style.width=D-M+"px",this._box.style.height=U-z+"px")})}mouseupWindow(i,c){if(!this._active)return;const g=this._startPos,E=c;if(g&&i.button===0){if(this.reset(),ke(),g.x!==E.x||g.y!==E.y)return this._map.fire(new a.z("boxzoomend",{originalEvent:i})),{cameraAnimation:A=>A.fitScreenCoordinates(g,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_e(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new a.z(i,{originalEvent:c}))}}function $o(m,i){const c={};for(let g=0;g<m.length;g++)c[m[g].identifier]=i[g];return c}class du{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),g.length===this.numTouches&&(this.centroid=(function(E){const A=new a.P(0,0);for(const M of E)A._add(M);return A.div(E.length)})(c),this.touches=$o(g,c)))}touchmove(i,c,g){if(this.aborted||!this.centroid)return;const E=$o(g,c);for(const A in this.touches){const M=E[A];(!M||M.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(i,c,g){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class fu{constructor(i){this.singleTap=new du(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,c,g){this.singleTap.touchstart(i,c,g)}touchmove(i,c,g){this.singleTap.touchmove(i,c,g)}touchend(i,c,g){const E=this.singleTap.touchend(i,c,g);if(E){const A=i.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(E)<30;if(A&&M||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class pu{constructor(){this._zoomIn=new fu({numTouches:1,numTaps:2}),this._zoomOut=new fu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,g){this._zoomIn.touchstart(i,c,g),this._zoomOut.touchstart(i,c,g)}touchmove(i,c,g){this._zoomIn.touchmove(i,c,g),this._zoomOut.touchmove(i,c,g)}touchend(i,c,g){const E=this._zoomIn.touchend(i,c,g),A=this._zoomOut.touchend(i,c,g);return E?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:i})}):A?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(A)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Af=0,Ho=2,Cf={[Af]:1,[Ho]:2},io={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Tc{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const g=qt(i);this._correctButton(i,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(i,c){const g=this._lastPoint;if(g){if(i.preventDefault(),this._eventButton!=null&&(function(E,A){const M=Cf[A];return E.buttons===void 0||(E.buttons&M)!==M})(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}}mouseupWindow(i){this._lastPoint&&qt(i)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh extends Tc{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return c===0&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class Ed extends Tc{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?io[i.pitchRotateKey]:void 0}_correctButton(i,c){return this._pitchRotateKey?c===0&&i[this._pitchRotateKey]:c===0&&i.ctrlKey||c===2}_move(i,c){const g=.8*(c.x-i.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class Sd extends Tc{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?io[i.pitchRotateKey]:void 0}_correctButton(i,c){return this._pitchRotateKey?c===0&&i[this._pitchRotateKey]:c===0&&i.ctrlKey||c===2}_move(i,c){const g=-.5*(c.y-i.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class qn{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),a.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(i,c,g){return this._calculateTransform(i,c,g)}touchmove(i,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!a.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,c,g)}}touchend(i,c,g){this._calculateTransform(i,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,g){g.length>0&&(this._active=!0);const E=$o(g,c),A=new a.P(0,0),M=new a.P(0,0);let D=0;for(const U in E){const $=E[U],ie=this._touches[U];ie&&(A._add($),M._add($.sub(ie)),D++,E[U]=$)}if(this._touches=E,D<this._minTouches||!M.mag())return;const z=M.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class mu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,c,g){return{}}touchstart(i,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,g){const E=this._firstTwoTouches;if(!E)return;i.preventDefault();const[A,M]=E,D=Ac(g,c,A),z=Ac(g,c,M);if(!D||!z)return;const U=this._aroundCenter?null:D.add(z).div(2);return this._move([D,z],U,i)}touchend(i,c,g){if(!this._firstTwoTouches)return;const[E,A]=this._firstTwoTouches,M=Ac(g,c,E),D=Ac(g,c,A);M&&D||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ac(m,i,c){for(let g=0;g<m.length;g++)if(m[g].identifier===c)return i[g]}function dh(m,i){return Math.log2(m/i)}class Cc extends mu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(dh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dh(this._distance,g),pinchAround:c}}}function fh(m,i){return 180*m.angleWith(i)/Math.PI}class ph extends mu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const g=this._vector;if(this._vector=i[0].sub(i[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fh(this._vector,g),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const E=fh(i,g);return Math.abs(E)<c}}function gu(m){return Math.abs(m.y)>Math.abs(m.x)}class Rc extends mu{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,gu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,g){const E=this._lastPoints;if(!E)return;const A=i[0].sub(E[0]),M=i[1].sub(E[1]);return this._map._cooperativeGestures&&!a.eU()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(A,M,g.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(A.y+M.y)/2*-.5})}gestureBeginsVertically(i,c,g){if(this._valid!==void 0)return this._valid;const E=i.mag()>=2,A=c.mag()>=2;if(!E&&!A)return;if(!E||!A)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const M=i.y>0==c.y>0;return gu(i)&&gu(c)&&M}}const Td={panStep:100,bearingStep:15,pitchStep:10};class mh{constructor(){const i=Td;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,g=0,E=0,A=0,M=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?g=-1:(i.preventDefault(),A=-1);break;case 39:i.shiftKey?g=1:(i.preventDefault(),A=1);break;case 38:i.shiftKey?E=1:(i.preventDefault(),M=-1);break;case 40:i.shiftKey?E=-1:(i.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(g=0,E=0),{cameraAnimation:D=>{const z=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:qo,zoom:c?Math.round(z)+c*(i.shiftKey?2:1):z,bearing:D.getBearing()+g*this._bearingStep,pitch:D.getPitch()+E*this._pitchStep,offset:[-A*this._panStep,-M*this._panStep],center:D.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qo(m){return m*(2-m)}const yu=4.000244140625,zp=1/450;class Ad{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=zp,a.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||a.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const g=a.o.now(),E=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,c!==0&&c%yu===0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(E*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Le(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const U=this._type==="wheel"&&Math.abs(this._delta)>yu?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&$!==0&&($=1/$);const ie=c(),K=Math.pow(2,ie),re=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(re*$))),this._type==="wheel"&&(this._startZoom=ie,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:c(),E=this._startZoom,A=this._easing;let M,D=!1;if(this._type==="wheel"&&E&&A){const U=Math.min((a.o.now()-this._lastWheelEventTime)/200,1),$=A(U);M=a.ak(E,g,$),U<1?this._frameId||(this._frameId=!0):D=!0}else M=g,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=M-c();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=a.eV;if(this._prevEase){const g=this._prevEase,E=(a.o.now()-g.start)/g.duration,A=g.easing(E+.01)-g.easing(E),M=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-M*M);c=a.eT(M,D,.25,1)}return this._prevEase={start:a.o.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class vl{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(i.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp{constructor(){this._tap=new fu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,c,g){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(i,c,g))}touchmove(i,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const E=c[0],A=E.y-this._swipePoint.y;return this._swipePoint=E,i.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(i,c,g)}touchend(i,c,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(i,c,g)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cd{constructor(i,c,g){this._el=i,this._mousePan=c,this._touchPan=g}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gh{constructor(i,c,g){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nn{constructor(i,c,g,E){this._el=i,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Rd=m=>m.zoom||m.drag||m.pitch||m.rotate;class Hm extends a.z{}class Bp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const g=a.av([],c,i);this.radius=a.ag(g[2]<0?a.eX([],g,this.constants):[g[0],g[1],0])}projectRay(i){a.eX(i,i,this.constants),a.aw(i,i),a.eY(i,i,this.constants);const c=a.c5([],i,this.radius);if(c[2]>0){const g=a.c5([],[0,0,1],a.bJ(c,[0,0,1])),E=a.c5([],a.aw([],[c[0],c[1],0]),this.radius),A=a.d8([],c,a.c5([],a.av([],a.d8([],E,g),c),2));c[0]=A[0],c[1]=A[1]}return c}}function Yl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Kl{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xl(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),a.aY(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,A,M]of this._listeners){const D=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(A,D,M)}}destroy(){for(const[i,c,g]of this._listeners){const E=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(c,E,g)}}_addDefaultHandlers(i){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new is(c,i));const E=c.boxZoom=new to(c,i);this._add("boxZoom",E);const A=new pu,M=new Rf;c.doubleClickZoom=new vl(M,A),this._add("tapZoom",A),this._add("clickZoom",M);const D=new Fp;this._add("tapDragZoom",D);const z=c.touchPitch=new Rc(c);this._add("touchPitch",z);const U=new Ed(i),$=new Sd(i);c.dragRotate=new gh(i,U,$),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const ie=new hh(i),K=new qn(c,i);c.dragPan=new Cd(g,ie,K),this._add("mousePan",ie),this._add("touchPan",K,["touchZoom","touchRotate"]);const re=new ph,he=new Cc;c.touchZoomRotate=new Nn(g,he,re,D),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rs(c));const ce=c.scrollZoom=new Ad(c,this);this._add("scrollZoom",ce,["mousePan"]);const de=c.keyboard=new mh;this._add("keyboard",de);for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ge]&&c[ge].enable(i[ge])}_add(i,c,g){this._handlers.push({handlerName:i,handler:c,allowed:g}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Rd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,c,g){for(const E in i)if(E!==g&&(!c||c.indexOf(E)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const g of i)this._el.contains(g.target)&&c.push(g);return c}handleEvent(i,c){this._updatingCamera=!0;const g=i.type==="renderFrame",E=g?void 0:i,A={needsRenderFrame:!1},M={},D={},z=i.touches?this._getMapTouches(i.touches):void 0,U=z?lt(this._el,z):g?void 0:Le(this._el,i);for(const{handlerName:K,handler:re,allowed:he}of this._handlers){if(!re.isEnabled())continue;let ce;this._blockedByActive(D,he,K)?re.reset():re[c||i.type]&&(ce=re[c||i.type](i,U,z),this.mergeHandlerResult(A,M,ce,K,E),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||re.isActive())&&(D[K]=re)}const $={};for(const K in this._previousActiveHandlers)D[K]||($[K]=E);this._previousActiveHandlers=D,(Object.keys($).length||Yl(A))&&(this._changes.push([A,M,$]),this._triggerRenderFrame()),(Object.keys(D).length||Yl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ie}=A;ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ie(this._map))}mergeHandlerResult(i,c,g,E,A){if(!g)return;Object.assign(i,g);const M={handlerName:E,originalEvent:g.originalEvent||A};g.zoomDelta!==void 0&&(c.zoom=M),g.panDelta!==void 0&&(c.drag=M),g.pitchDelta!==void 0&&(c.pitch=M),g.bearingDelta!==void 0&&(c.rotate=M)}_applyChanges(){const i={},c={},g={};for(const[E,A,M]of this._changes)E.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(E.panDelta)),E.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(i.around=E.around),E.aroundCoord!==void 0&&(i.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(i.pinchAround=E.pinchAround),E.noInertia&&(i.noInertia=E.noInertia),Object.assign(c,A),Object.assign(g,M);this._updateMapTransform(i,c,g),this._changes=[]}_updateMapTransform(i,c,g){const E=this._map,A=E.transform,M=Ce=>[Ce.x,Ce.y,Ce.z];if((()=>{const Ce=this._eventsInProgress.drag;return Ce&&!this._handlersById[Ce.handlerName].isActive()})()&&!Yl(i)){const Ce=A.zoom;A.cameraElevationReference="sea",this._originalZoom!=null&&A._orthographicProjectionAtLowPitch&&A.projection.name!=="globe"&&A.pitch===0?(A.cameraElevationReference="ground",A.zoom=this._originalZoom):(A.recenterOnTerrain(),A.cameraElevationReference="ground"),Ce!==A.zoom&&this._map._update(!0)}if(A._isCameraConstrained&&E._stop(!0),!Yl(i))return void this._fireEvents(c,g,!0);let{panDelta:D,zoomDelta:z,bearingDelta:U,pitchDelta:$,around:ie,aroundCoord:K,pinchAround:re}=i;A._isCameraConstrained&&(z>0&&(z=0),A._isCameraConstrained=!1),re!==void 0&&(ie=re),(z||(Ce=>c[Ce]&&!this._eventsInProgress[Ce])("drag"))&&ie&&(this._dragOrigin=M(A.pointCoordinate3D(ie)),this._originalZoom=A.zoom,this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",E._stop(!0),ie=ie||E.transform.centerPoint,U&&(A.bearing+=U),$&&(A.pitch+=$),A._updateCameraState();const he=[0,0,0];if(D)if(A.projection.name==="mercator"){const Ce=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(ie).dir),Ae=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(ie.sub(D)).dir);he[0]=Ae[0]-Ce[0],he[1]=Ae[1]-Ce[1]}else{const Ce=A.pointCoordinate(ie);if(A.projection.name==="globe"){D=D.rotate(-A.angle);const Ae=A._pixelsPerMercatorPixel/A.worldSize;he[0]=-D.x*a.eW(a.a$(Ce.y))*Ae,he[1]=-D.y*a.eW(A.center.lat)*Ae}else{const Ae=A.pointCoordinate(ie.sub(D));Ce&&Ae&&(he[0]=Ae.x-Ce.x,he[1]=Ae.y-Ce.y)}}const ce=A.zoom,de=[0,0,0];if(z){const Ce=M(K||A.pointCoordinate3D(ie)),Ae={dir:a.aw([],a.av([],Ce,A._camera.position))};if(Ae.dir[2]<0){const Ee=A.zoomDeltaToMovement(Ce,z);a.c5(de,Ae.dir,Ee)}}const ge=a.d8(he,he,de);A._translateCameraConstrained(ge),z&&Math.abs(A.zoom-ce)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,g,!0)}_fireEvents(i,c,g){const E=Rd(this._eventsInProgress),A=Rd(i),M={};for(const $ in i){const{originalEvent:ie}=i[$];this._eventsInProgress[$]||(M[`${$}start`]=ie),this._eventsInProgress[$]=i[$]}!E&&A&&this._fireEvent("movestart",A.originalEvent);for(const $ in M)this._fireEvent($,M[$]);A&&this._fireEvent("move",A.originalEvent);for(const $ in i){const{originalEvent:ie}=i[$];this._fireEvent($,ie)}const D={};let z;for(const $ in this._eventsInProgress){const{handlerName:ie,originalEvent:K}=this._eventsInProgress[$];this._handlersById[ie].isActive()||(delete this._eventsInProgress[$],z=c[ie]||K,D[`${$}end`]=z)}for(const $ in D)this._fireEvent($,D[$]);const U=Rd(this._eventsInProgress);if(g&&(E||A)&&!U){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;$?(ie($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:z})):(this._map.fire(new a.z("moveend",{originalEvent:z})),ie(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new a.z(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Hm("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Mf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jp extends a.E{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,a.aY(["_renderFrameCallback"],this)}getCenter(){return new a.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,g){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,Object.assign({offset:i},c),g)}panTo(i,c,g){return this.easeTo(Object.assign({center:i},c),g)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,g){return this.easeTo(Object.assign({zoom:i},c),g)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,g){return this.easeTo(Object.assign({bearing:i},c),g)}resetNorth(i,c){return this.rotateTo(0,Object.assign({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=a.aI.convert(i);const g=c&&c.bearing||0,E=c&&c.pitch||0,A=i.getNorthWest(),M=i.getSouthEast();return this._cameraForBounds(this.transform,A,M,g,E,c)}_extendPadding(i){const c={top:0,right:0,bottom:0,left:0};return i==null?Object.assign({},c,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:Object.assign({},c,i)}_extendCameraOptions(i){return(i=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,c){const g=c.max[0]-c.min[0],E=c.max[1]-c.min[1];return g/E>i.aspect?g/(2*Math.tan(.5*i.fovX)*i.aspect):E/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,c,g,E,A,M){const D=i.clone(),z=this._extendCameraOptions(M);D.bearing=E,D.pitch=A;const U=a.aT.convert(c),$=a.aT.convert(g),ie=.5*(U.lat+$.lat),K=.5*(U.lng+$.lng),re=a.eZ(ie,K),he=a.aw([],re),ce=a.aw([],a.bI([],he,[0,1,0])),de=a.bI([],ce,he),ge=[ce[0],ce[1],ce[2],0,de[0],de[1],de[2],0,he[0],he[1],he[2],0,0,0,0,1],Ce=[re,a.eZ(U.lat,U.lng),a.eZ($.lat,U.lng),a.eZ($.lat,$.lng),a.eZ(U.lat,$.lng),a.eZ(ie,U.lng),a.eZ(ie,$.lng),a.eZ(U.lat,K),a.eZ($.lat,K)];let Ae=a.d9.fromPoints(Ce.map(ot=>[a.bJ(ce,ot),a.bJ(de,ot),a.bJ(he,ot)]));const Ee=a.af([],Ae.center,ge);a.e_(Ee)===0&&a.e$(Ee,0,0,1),a.aw(Ee,Ee),a.c5(Ee,Ee,a.aD),D.center=a.f0(Ee);const Ge=D.getWorldToCameraMatrix(),je=a.bl(new Float64Array(16),Ge);Ae=a.d9.applyTransform(Ae,a.aB([],Ge,ge));const Ue=this._extendAABB(Ae,D,z,E);if(!Ue)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ae=Ue,a.af(Ee,Ee,Ge);const ze=.5*(Ae.max[2]-Ae.min[2]),Pe=this._minimumAABBFrustumDistance(D,Ae),We=a.c5([],[0,0,1],ze),Xe=a.d8(We,Ee,We),Qe=Pe+(D.pitch===0?0:a.bG(Ee,Xe)),rt=D.globeCenterInViewSpace,tt=a.av([],Ee,[rt[0],rt[1],rt[2]]);a.aw(tt,tt),a.c5(tt,tt,Qe);const pt=a.d8([],Ee,tt);a.af(pt,pt,je);const wt=a.eM/a.aD,nt=a.ag(pt),Ze=a.cf(Math.max(nt*wt-a.eM,Number.EPSILON),0),_t=Math.min(D.zoomFromMercatorZAdjusted(Ze),z.maxZoom);return _t>.5*(a.c_+a.cL)?(D.setProjection({name:"mercator"}),D.zoom=_t,this._cameraForBounds(D,c,g,E,A,M)):{center:D.center,zoom:_t,bearing:E,pitch:A}}_extendAABB(i,c,g,E){const A=.5*((g.padding.left||0)+(g.padding.right||0)),M=.5*((g.padding.top||0)+(g.padding.bottom||0)),D=M,z=A,U=A,$=M,ie=c.width-(z+U),K=c.height-(D+$),re=a.av([],i.max,i.min),he=Math.min(ie/re[0],K/re[1]),ce=Math.min(c.scaleZoom(c.scale*he),g.maxZoom);if(isNaN(ce))return null;const de=c.scale/c.zoomScale(ce),ge=new a.d9([i.min[0]-z*de,i.min[1]-$*de,i.min[2]],[i.max[0]+U*de,i.max[1]+D*de,i.max[2]]),Ce=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new a.P(g.offset.x,g.offset.y):a.P.convert(g.offset)).rotate(-a.an(E));return ge.center[0]-=Ce.x*de,ge.center[1]+=Ce.y*de,ge}queryTerrainElevation(i,c){const g=this.transform.elevation;return g?(c=Object.assign({},{exaggerated:!0},c),g.getAtPoint(a.ae.fromLngLat(i),null,c.exaggerated)):null}_cameraForBounds(i,c,g,E,A,M){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,c,g,E,A,M);const D=i.clone(),z=this._extendCameraOptions(M);D.bearing=E,D.pitch=A;const U=a.aT.convert(c),$=a.aT.convert(g),ie=new a.aT(U.lng,$.lat),K=new a.aT($.lng,U.lat),re=D.project(U),he=D.project($),ce=this.queryTerrainElevation(U),de=this.queryTerrainElevation($),ge=this.queryTerrainElevation(ie),Ce=this.queryTerrainElevation(K),Ae=[[re.x,re.y,Math.min(ce||0,de||0,ge||0,Ce||0)],[he.x,he.y,Math.max(ce||0,de||0,ge||0,Ce||0)]];let Ee=a.d9.fromPoints(Ae);const Ge=D.getWorldToCameraMatrix(),je=a.bl(new Float64Array(16),Ge);Ee=a.d9.applyTransform(Ee,Ge);const Ue=this._extendAABB(Ee,D,z,E);if(!Ue)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ee=Ue;const ze=.5*a.av([],Ee.max,Ee.min)[2],Pe=this._minimumAABBFrustumDistance(D,Ee),We=[0,0,1,0];a.aC(We,We,Ge),a.f1(We,We);const Xe=a.c5([],We,Pe+ze),Qe=a.d8([],Ee.center,Xe);a.af(Ee.center,Ee.center,je),a.af(Qe,Qe,je);const rt=D.unproject(new a.P(Ee.center[0],Ee.center[1])),tt=a.f2(D.projection,rt),pt=Math.pow(2,tt),wt=Math.min(D._zoomFromMercatorZ(Qe[2]*D.pixelsPerMeter*pt/D.worldSize),z.maxZoom);return D.mercatorFromTransition&&wt<.5*(a.c_+a.cL)?(D.setProjection({name:"globe"}),D.zoom=wt,this._cameraForBounds(D,c,g,E,A,M)):{center:rt,zoom:wt,bearing:E,pitch:A}}fitBounds(i,c,g){const E=this.cameraForBounds(i,c);return this._fitInternal(E,c,g)}fitScreenCoordinates(i,c,g,E,A){const M=a.P.convert(i),D=a.P.convert(c),z=new a.P(Math.min(M.x,D.x),Math.min(M.y,D.y)),U=new a.P(Math.max(M.x,D.x),Math.max(M.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,D))return this;const $=this.transform.pointLocation3D(z),ie=this.transform.pointLocation3D(U),K=this.transform.pointLocation3D(new a.P(z.x,U.y)),re=this.transform.pointLocation3D(new a.P(U.x,z.y)),he=[Math.min($.lng,ie.lng,K.lng,re.lng),Math.min($.lat,ie.lat,K.lat,re.lat)],ce=[Math.max($.lng,ie.lng,K.lng,re.lng),Math.max($.lat,ie.lat,K.lat,re.lat)],de=E&&E.pitch?E.pitch:this.getPitch(),ge=this._cameraForBounds(this.transform,he,ce,g,de,E);return this._fitInternal(ge,E,A)}_fitInternal(i,c,g){return i?(c=Object.assign(i,c)).linear?this.easeTo(c,g):this.flyTo(c,g):this}jumpTo(i,c){this.stop();const g=i.preloadOnly?this.transform.clone():this.transform;let E=!1,A=!1,M=!1;"zoom"in i&&g.zoom!==+i.zoom&&(E=!0,g.zoom=+i.zoom),i.center!==void 0&&(g.center=a.aT.convert(i.center)),"bearing"in i&&g.bearing!==+i.bearing&&(A=!0,g.bearing=+i.bearing),"pitch"in i&&g.pitch!==+i.pitch&&(M=!0,g.pitch=+i.pitch);const D=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!g.isPaddingEqual(D))if(i.retainPadding===!1){const z=g.clone();z.padding=D,g.setLocationAtPoint(g.center,z.centerPoint)}else g.padding=D;return i.preloadOnly?(this._preloadTiles(g),this):(this.fire(new a.z("movestart",c)).fire(new a.z("move",c)),E&&this.fire(new a.z("zoomstart",c)).fire(new a.z("zoom",c)).fire(new a.z("zoomend",c)),A&&this.fire(new a.z("rotatestart",c)).fire(new a.z("rotate",c)).fire(new a.z("rotateend",c)),M&&this.fire(new a.z("pitchstart",c)).fire(new a.z("pitch",c)).fire(new a.z("pitchend",c)),this.fire(new a.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(Mf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return a.w(Mf),this;this.stop();const E=g.zoom,A=g.pitch,M=g.bearing;g.setFreeCameraOptions(i);const D=E!==g.zoom,z=A!==g.pitch,U=M!==g.bearing;return this.fire(new a.z("movestart",c)).fire(new a.z("move",c)),D&&this.fire(new a.z("zoomstart",c)).fire(new a.z("zoom",c)).fire(new a.z("zoomend",c)),U&&this.fire(new a.z("rotatestart",c)).fire(new a.z("rotate",c)).fire(new a.z("rotateend",c)),z&&this.fire(new a.z("pitchstart",c)).fire(new a.z("pitch",c)).fire(new a.z("pitchend",c)),this.fire(new a.z("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),((i=Object.assign({offset:[0,0],duration:500,easing:a.eV},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const g=this.transform,E=this.getZoom(),A=this.getBearing(),M=this.getPitch(),D=this.getPadding(),z="zoom"in i?+i.zoom:E,U="bearing"in i?this._normalizeBearing(i.bearing,A):A,$="pitch"in i?+i.pitch:M,ie=this._extendPadding(i.padding),K=a.P.convert(i.offset);let re,he,ce;if(g.projection.name==="globe"){const We=a.ae.fromLngLat(g.center),Xe=K.rotate(-g.angle);We.x+=Xe.x/g.worldSize,We.y+=Xe.y/g.worldSize;const Qe=We.toLngLat(),rt=a.aT.convert(i.center||Qe);this._normalizeCenter(rt),re=g.centerPoint.add(Xe),he=new a.P(We.x,We.y).mult(g.worldSize),ce=new a.P(a.aF(rt.lng),a.aJ(rt.lat)).mult(g.worldSize).sub(he)}else{re=g.centerPoint.add(K);const We=g.pointLocation(re),Xe=a.aT.convert(i.center||We);this._normalizeCenter(Xe),he=g.project(We),ce=g.project(Xe).sub(he)}const de=g.zoomScale(z-E);let ge,Ce;i.around&&(ge=a.aT.convert(i.around),Ce=g.locationPoint(ge));const Ae=this._zooming||z!==E,Ee=this._rotating||A!==U,Ge=this._pitching||$!==M,je=!g.isPaddingEqual(ie),Ue=i.retainPadding===!1?g.clone():g,ze=We=>Xe=>{if(Ae&&(We.zoom=a.ak(E,z,Xe)),Ee&&(We.bearing=a.ak(A,U,Xe)),Ge&&(We.pitch=a.ak(M,$,Xe)),je&&(Ue.interpolatePadding(D,ie,Xe),re=Ue.centerPoint.add(K)),ge)We.setLocationAtPoint(ge,Ce);else{const Qe=We.zoomScale(We.zoom-E),rt=z>E?Math.min(2,de):Math.max(.5,de),tt=Math.pow(rt,1-Xe),pt=We.unproject(he.add(ce.mult(Xe*tt)).mult(Qe));We.setLocationAtPoint(We.renderWorldCopies?pt.wrap():pt,re)}return i.preloadOnly||this._fireMoveEvents(c),We};if(i.preloadOnly){const We=this._emulate(ze,i.duration,g);return this._preloadTiles(We),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ae,this._rotating=Ee,this._pitching=Ge,this._padding=je,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,Pe),this._ease(ze(g),We=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(c,We)},i),this}_prepareEase(i,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new a.z("movestart",i)),this._zooming&&!g.zooming&&this.fire(new a.z("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new a.z("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new a.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new a.z("move",i)),this._zooming&&this.fire(new a.z("zoom",i)),this._rotating&&this.fire(new a.z("rotate",i)),this._pitching&&this.fire(new a.z("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,E=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.z("zoomend",i)),E&&this.fire(new a.z("rotateend",i)),A&&this.fire(new a.z("pitchend",i)),this.fire(new a.z("moveend",i))}flyTo(i,c){if(this._prefersReducedMotion(i)){const ot=a.aH(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ot,c)}this.stop(),i=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:a.eV},i);const g=this.transform,E=this.getZoom(),A=this.getBearing(),M=this.getPitch(),D=this.getPadding(),z="zoom"in i?a.aA(+i.zoom,g.minZoom,g.maxZoom):E,U="bearing"in i?this._normalizeBearing(i.bearing,A):A,$="pitch"in i?+i.pitch:M,ie=this._extendPadding(i.padding),K=g.zoomScale(z-E),re=a.P.convert(i.offset);let he=g.centerPoint.add(re);const ce=g.pointLocation(he),de=a.aT.convert(i.center||ce);this._normalizeCenter(de);const ge=g.project(ce),Ce=g.project(de).sub(ge);let Ae=i.curve;const Ee=Math.max(g.width,g.height),Ge=Ee/K,je=Ce.mag();if("minZoom"in i){const ot=a.aA(Math.min(i.minZoom,E,z),g.minZoom,g.maxZoom),bt=Ee/g.zoomScale(ot-E);Ae=Math.sqrt(bt/je*2)}const Ue=Ae*Ae;function ze(ot){const bt=(Ge*Ge-Ee*Ee+(ot?-1:1)*Ue*Ue*je*je)/(2*(ot?Ge:Ee)*Ue*je);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Pe(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function We(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const Xe=ze(0);let Qe=function(ot){return We(Xe)/We(Xe+Ae*ot)},rt=function(ot){return Ee*((We(Xe)*(Pe(bt=Xe+Ae*ot)/We(bt))-Pe(Xe))/Ue)/je;var bt},tt=(ze(1)-Xe)/Ae;if(Math.abs(je)<1e-6||!isFinite(tt)){if(Math.abs(Ee-Ge)<1e-6)return this.easeTo(i,c);const ot=Ge<Ee?-1:1;tt=Math.abs(Math.log(Ge/Ee))/Ae,rt=function(){return 0},Qe=function(bt){return Math.exp(ot*Ae*bt)}}i.duration="duration"in i?+i.duration:1e3*tt/("screenSpeed"in i?+i.screenSpeed/Ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const pt=A!==U,wt=$!==M,nt=!g.isPaddingEqual(ie),Ze=i.retainPadding===!1?g.clone():g,_t=ot=>bt=>{const Lt=bt*tt,Wt=1/Qe(Lt);ot.zoom=bt===1?z:E+ot.scaleZoom(Wt),pt&&(ot.bearing=a.ak(A,U,bt)),wt&&(ot.pitch=a.ak(M,$,bt)),nt&&(Ze.interpolatePadding(D,ie,bt),he=Ze.centerPoint.add(re));const jt=bt===1?de:ot.unproject(ge.add(Ce.mult(rt(Lt))).mult(Wt));return ot.setLocationAtPoint(ot.renderWorldCopies?jt.wrap():jt,he),ot._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(c),ot};if(i.preloadOnly){const ot=this._emulate(_t,i.duration,g);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=pt,this._pitching=wt,this._padding=nt,this._prepareEase(c,!1),this._ease(_t(g),()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!i){const g=this.handlers;g&&g.stop(!1)}return this}_ease(i,c,g){g.animate===!1||g.duration===0?(i(1),c()):(this._easeStart=a.o.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((a.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=a.bT(i,-180,180);const g=Math.abs(i-c);return Math.abs(i-360-c)<g&&(i-=360),Math.abs(i+360-c)<g&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const g=i.lng-c.center.lng;i.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&a.o.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,c,g){const E=Math.ceil(15*c/1e3),A=[],M=i(g.clone());for(let D=0;D<=E;D++){const z=M(D/E);A.push(z.clone())}return A}_preloadTiles(i,c){}}class yh{constructor(i={}){this.options=i,a.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact,g=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const E=Y("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",g),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(i){const g=c.reduce((E,A,M)=>(A.value&&(E+=`${A.key}=${A.value}${M<c.length-1?"&":""}`),E),"?");i.href=`${a.e.FEEDBACK_URL}/${g}#${Op(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||(i.dataType!=="source"||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility")&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const c=this._map.style._mergedSourceCaches;for(const E in c){const A=c[E];if(A.used){const M=A.getSource();M.attribution&&i.indexOf(M.attribution)<0&&i.push(M.attribution)}}i.sort((E,A)=>E.length-A.length),i=i.filter((E,A)=>{for(let M=A+1;M<i.length;M++)if(i[M].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const g=i.map(E=>(function(A){const M=new DOMParser().parseFromString(A,"text/html");return Array.from(M.body.querySelectorAll("*")).reverse().forEach(D=>{const z=D.textContent||"";if(D.tagName!=="A")return void D.replaceWith(...D.childNodes);const U=D.getAttribute("href");if(!U||!/^(https?:|mailto:)/i.test(U))return void D.replaceWith(M.createTextNode(z));const $=M.createElement("a");$.href=U,$.textContent=z,$.rel="noopener nofollow";const ie=D.getAttribute("class");ie&&($.className=ie),D.replaceWith($)}),M.body.innerHTML})(E)).join(" | ");g!==this._attribHTML&&(this._attribHTML=g,i.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wo{constructor(){a.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Y("div","mapboxgl-ctrl");const c=Y("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const c in i){const g=i[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Np{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const E of g)if(E.id===i)return void(E.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class $r{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=a.dD((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,g){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+g}}const Vp={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Pf extends a.z{constructor(i,c,g,E){const{point:A,lngLat:M,originalEvent:D,target:z}=i;super(i.type,{point:A,lngLat:M,originalEvent:D,target:z}),this.preventDefault=()=>{i.preventDefault()},this.id=c,this.interaction=g,this.feature=E}}class Up{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,c){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const g=c.filter;let E=c.type;g&&this.filters.set(i,a.b6(g)),E==="mouseover"&&(E="mouseenter"),E==="mouseout"&&(E="mouseleave");const A=this.interactionsByType.get(E)||new Map;E==="mouseenter"||E==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,c)):A.size===0&&this.map.on(E,this.handleType),A.size===0&&this.interactionsByType.set(E,A),A.set(i,c),this.typeById.set(i,E)}get(i){const c=this.typeById.get(i);if(!c)return;const g=this.interactionsByType.get(c);return g?g.get(i):void 0}remove(i){const c=this.typeById.get(i);if(!c)return;this.typeById.delete(i),this.filters.delete(i);const g=this.interactionsByType.get(c);g&&(g.delete(i),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(c,this.handleType))}queryTargets(i,c){const g=[];for(const[E,A]of c)A.target&&g.push({targetId:E,target:A.target,filter:this.filters.get(E)});return this.map.style.queryRenderedTargets(i,g,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());c.length&&(i.type="mouseenter",this.handleType(i,c));const g=new Map;for(const[E,{feature:A}]of this.prevHoveredFeatures)this.hoveredFeatures.has(E)||g.set(A.id,A);g.size&&(i.type="mouseleave",this.handleType(i,Array.from(g.values())))}handleOut(i){const c=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);c.length&&(i.type="mouseleave",this.handleType(i,c)),this.hoveredFeatures.clear()}handleType(i,c){const g=i.type==="mouseenter";if(g&&!this.interactionsByType.has(i.type))return void a.w("mouseenter interaction required for mouseleave to work.");const E=Array.from(this.interactionsByType.get(i.type)).reverse(),A=!!c;c=c||this.queryTargets(i.point,E);let M=!1;const D=new Set;for(const z of c){for(const[U,$]of E){if(!$.target)continue;const ie=z.variants?z.variants[U]:null;if(ie){for(const K of ie){if(Du(K,z,D,U))continue;const re=new a.dx(z,K),he=ka(K,z,U);A&&re.id!==void 0&&(re.state=this.map.getFeatureState(re));const ce=g?this.prevHoveredFeatures.get(he):null,de=new Pf(i,U,$,re),ge=ce?ce.stop:$.handler(de);if(g&&this.hoveredFeatures.set(he,{feature:z,stop:ge}),ge!==!1){M=!0;break}}if(M)break}}if(M)break}if(!M)for(const[z,U]of E){const{handler:$,target:ie}=U;if(!ie&&$(new Pf(i,z,U,null))!==!1)break}}}function If(m,i){if(Array.isArray(m)&&Array.isArray(i)){const c=new Set(m),g=new Set(i);return c.size===g.size&&m.every(E=>g.has(E))}return a.by(m,i)}const _h={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},bl={showCompass:!0,showZoom:!0,visualizePitch:!1};class rs{constructor(i,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ed({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,g&&(this.mousePitch=new Sd({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),a.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),oe()}move(i,c){const g=this.map,E=this.mouseRotate.mousemoveWindow(i,c),A=E&&E.bearingDelta;if(A&&g.setBearing(g.getBearing()+A),this.mousePitch){const M=this.mousePitch.mousemoveWindow(i,c),D=M&&M.pitchDelta;D&&g.setPitch(g.getPitch()+D)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_e(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(Object.assign({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Le(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Le(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function _u(m,i,c){if(m=new a.aT(m.lng,m.lat),i){const g=new a.aT(m.lng-360,m.lat),E=new a.aT(m.lng+360,m.lat),A=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),M=c.locationPoint3D(m).distSqr(i),D=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint3D(g).distSqr(i)<M&&(D||Math.abs(g.lng-c.center.lng)<A)?m=g:c.locationPoint3D(E).distSqr(i)<M&&(D||Math.abs(E.lng-c.center.lng)<A)&&(m=E)}for(;Math.abs(m.lng-c.center.lng)>180;){const g=c.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const bo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},_n={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Vn extends a.E{constructor(i,c){super(),(i instanceof HTMLElement||c)&&(i=Object.assign({element:i},c)),a.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:E="#3FB1CE",scale:A=1,draggable:M=!1,clickTolerance:D=0,rotation:z=_n.rotation,rotationAlignment:U=_n.rotationAlignment,pitchAlignment:$=_n.pitchAlignment,occludedOpacity:ie=_n.occludedOpacity,altitude:K=_n.altitude}=i||{};this._anchor=g,this._color=E,this._scale=A,this._draggable=M,this._clickTolerance=D,this._rotation=z,this._rotationAlignment=U,this._pitchAlignment=$,this._occludedOpacity=ie,this._altitude=K,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),i&&i.element?(this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(i&&i.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ce=>{ce.preventDefault()}),this._element.addEventListener("mousedown",ce=>{ce.preventDefault()});const re=this._element.classList;for(const ce in bo)re.remove(`mapboxgl-marker-anchor-${ce}`);re.add(`mapboxgl-marker-anchor-${this._anchor}`);const he=i&&i.className?i.className.trim().split(/\s+/):[];re.add(...he),this._popup=null}_createDefaultMarker(){const i=Y("div"),c=le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},i);if(this._altitude===0){const g=le("radialGradient",{id:"shadowGradient"},le("defs",{},c));le("stop",{offset:"10%","stop-opacity":.4},g),le("stop",{offset:"100%","stop-opacity":.05},g),le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),i}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.aT.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(i){return i===this._altitude||(this._defaultMarker&&(this._altitude===0&&i!==0||this._altitude!==0&&i===0)&&(this._element=this._createDefaultMarker()),this._altitude=i||_n.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,i._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,g=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,c=this._pos;if(!i||!c)return!1;const g=i.unproject(c,this._altitude),E=i.getFreeCameraOptions();if(!E.position)return!1;const A=E.position.toLngLat();return A.distanceTo(g)<.9*A.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const c=this._pos;if(!c||c.x<0||c.x>i.transform.width||c.y<0||c.y>i.transform.height)return void this._clearFadeTimer();const g=i.unproject(c,this._altitude);let E;i._showingGlobe()&&a.f5(i.transform,this._lngLat)?E=0:(E=1-i._queryFogOpacity(g),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${bo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const i=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!i||g!=="map")return"";if(!c._showingGlobe()){const z=c.getPitch();return z?`rotateX(${z}deg)`:""}const E=a.cX(a.f6(c.transform,this._lngLat)),A=i.sub(a.f7(c.transform)),M=Math.abs(A.x)+Math.abs(A.y);if(M===0)return"";const D=E/M;return`rotateX(${-A.y*D}deg) rotateY(${A.x*D}deg)`}_calculateZTransform(){const i=this._pos,c=this._map;if(!c||!i)return"";let g=0;const E=this.getRotationAlignment();if(E==="map")if(c._showingGlobe()){const A=c.project(new a.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),M=c.project(new a.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(A);g=a.cX(Math.atan2(M.y,M.x))-90}else g=-c.getBearing();else if(E==="horizon"){const A=a.ah(4,6,c.getZoom()),M=a.f7(c.transform);M.y+=A*c.transform.height;const D=i.sub(M),z=a.cX(Math.atan2(D.y,D.x));g=(z>90?z-270:z+90)*(1-A)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=_u(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const c=this._map;if(!c)return;const g=this._pointerdownPos,E=this._positionDelta;if(g&&E){if(!this._isDragging){const A=this._clickTolerance||c._clickTolerance;if(i.point.dist(g)<A)return;this._isDragging=!0}this._pos=i.point.sub(E),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.z("dragstart"))),this.fire(new a.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.z("dragend")),this._state="inactive"}_addDragHandler(i){const c=this._map,g=this._pos;c&&g&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(g),this._pointerdownPos=i.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const c=this._map;return c&&(i?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||_n.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||_n.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||_n.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||_n.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Na={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},xh={maxWidth:100,unit:"metric"},kn={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ta={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ql=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xu(m=new a.P(0,0),i="bottom"){if(typeof m=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(i){case"top":return new a.P(0,m);case"top-left":return new a.P(c,c);case"top-right":return new a.P(-c,c);case"bottom":return new a.P(0,-m);case"bottom-left":return new a.P(c,-c);case"bottom-right":return new a.P(-c,-c);case"left":return new a.P(m,0);case"right":return new a.P(-m,0)}return new a.P(0,0)}return m instanceof a.P||Array.isArray(m)?a.P.convert(m):a.P.convert(m[i]||[0,0])}return{version:k,supported:Z.supported,setRTLTextPlugin:a.fb,getRTLTextPluginStatus:a.fa,Map:class extends jp{constructor(m){j.mark(O.create);const i=m;if((m=Object.assign({},_h,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&a.f3(window)&&(m.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Uh(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Np,this._domRenderTaskQueue=new Np,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.b2(),this._locale=Object.assign({},Vp,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $r(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new si(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,a.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Kl(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||a.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new ia(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new yh({customAttribution:m.customAttribution})),this._logoControl=new Wo,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new a.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new a.z(`${c.dataType}dataloading`,c))}),this._interactions=new Up(this)}_getMapId(){return this._mapId}addControl(m,i){if(i===void 0&&(i=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new a.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[i];return i.indexOf("bottom")!==-1?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new a.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(m);return i>-1&&this._controls.splice(i,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new a.z("movestart",m)).fire(new a.z("move",m)),this.fire(new a.z("resize",m)),i&&this.fire(new a.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(a.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(i=>i==="auto"?navigator.language:i):m}setLanguage(m){const i=this._parseLanguage(m);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,i=m.projection.name;let c;i==="globe"&&m.zoom>=a.cL?(m.setMercatorFromTransition(),c=!0):i==="mercator"&&m.zoom<a.cL&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,i){return this._updateProjection(m||i||{name:"mercator"})}_updateProjection(m){let i;const c=this.transform.mercatorFromTransition;i=m.name==="globe"&&this.transform.zoom>=a.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const g=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(i||g)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,i){return this.transform.locationPoint3D(a.aT.convert(m),i)}unproject(m,i){return this.transform.pointLocation3D(a.P.convert(m),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,i,c){const g=E=>{let A=[];if(Array.isArray(i)){const M=i.filter(D=>this.getLayer(D));A=M.length?this.queryRenderedFeatures(E,{layers:M}):[]}else A=this.queryRenderedFeatures(E,{target:i});return A};if(m==="mouseenter"||m==="mouseover"){let E=!1;return{listener:c,targets:i,delegates:{mousemove:M=>{const D=g(M.point);D.length?E||(E=!0,c.call(this,new ds(m,this,M.originalEvent,{features:D}))):E=!1},mouseout:()=>{E=!1}}}}if(m==="mouseleave"||m==="mouseout"){let E=!1;return{listener:c,targets:i,delegates:{mousemove:D=>{g(D.point).length?E=!0:E&&(E=!1,c.call(this,new ds(m,this,D.originalEvent)))},mouseout:D=>{E&&(E=!1,c.call(this,new ds(m,this,D.originalEvent)))}}}}{const E=A=>{const M=g(A.point);M.length&&(A.features=M,c.call(this,A),delete A.features)};return{listener:c,targets:i,delegates:{[m]:E}}}}on(m,i,c){if(typeof i=="function"||c===void 0)return super.on(m,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const g=this._createDelegatedListener(m,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const E in g.delegates)this.on(E,g.delegates[E]);return this}once(m,i,c){if(typeof i=="function"||c===void 0)return super.once(m,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const g=this._createDelegatedListener(m,i,c);for(const E in g.delegates)this.once(E,g.delegates[E]);return this}off(m,i,c){if(typeof i=="function"||c===void 0)return super.off(m,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(E=>{for(let A=0;A<E.length;A++){const M=E[A];if(M.listener===c&&If(M.targets,i)){for(const D in M.delegates)this.off(D,M.delegates[D]);return E.splice(A,1),this}}})(g),this}queryRenderedFeatures(m,i){if(!this.style)return[];if(m===void 0||m instanceof a.P||Array.isArray(m)||i!==void 0||(i=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!i){const A=this.style.queryRenderedFeatures(m,void 0,this.transform),M=this.style.queryRenderedFeatureset(m,void 0,this.transform);return A.concat(M)}let c=!0;if(i.target&&(c=this._isTargetValid(i.target),c&&!i.layers))return this.style.queryRenderedFeatureset(m,i,this.transform);let g=!0;if(i.layers&&Array.isArray(i.layers)){for(const A of i.layers)if(!this._isValidId(A)){g=!1;break}if(g&&!i.target)return this.style.queryRenderedFeatures(m,i,this.transform)}let E=[];return g&&(E=E.concat(this.style.queryRenderedFeatures(m,i,this.transform))),c&&(E=E.concat(this.style.queryRenderedFeatureset(m,i,this.transform))),E}querySourceFeatures(m,i){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,i)}queryRasterValue(m,i,c){return this._isValidId(m)?this.style.queryRasterValue(m,i,c):Promise.resolve(null)}isPointOnSurface(m){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&a.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(m))}addInteraction(m,i){return this._interactions.add(m,i),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,i){return i=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&m&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(m,(c,g)=>{if(c){const E=typeof c=="string"?c:c instanceof Error?c.message:c.error;a.w(`Unable to perform style diff: ${E}. Rebuilding the style from scratch.`),this._updateStyle(m,i)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(m,i))}_getUIString(m){const i=this._locale[m];if(i==null)throw new Error(`Missing UI string '${m}'`);return i}_updateStyle(m,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=Object.assign({},i);i&&i.config&&(c.initialConfig=i.config,delete c.config),this.style=new ha(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new a.y(new Error("IDs can't be empty."))),!1):!a.dr(m)||(this.fire(new a.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const i of m)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(m)}addSource(m,i){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,i),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,i,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,i,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,i,{pixelRatio:c=1,sdf:g=!1,stretchX:E,stretchY:A,content:M}={}){this._lazyInitEmptyStyle();const D=a.I.from(m);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:z,height:U,data:$}=a.o.getImageData(i);this.style.addImage(D,{data:new a.q({width:z,height:U},$),pixelRatio:c,stretchX:E,stretchY:A,content:M,sdf:g,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new a.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:U}=i,$=i;this.style.addImage(D,{data:new a.q({width:z,height:U},new Uint8Array($.data)),pixelRatio:c,stretchX:E,stretchY:A,content:M,sdf:g,usvg:!1,version:0,userImage:$}),$.onAdd&&$.onAdd(this,m)}}updateImage(m,i){this._lazyInitEmptyStyle();const c=a.I.from(m),g=this.style.getImage(c);if(!g)return void this.fire(new a.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?a.o.getImageData(i):i,{width:A,height:M,data:D}=E;if(A===void 0||M===void 0)return void this.fire(new a.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(A!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||M!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new a.y(new Error(`The width and height of the updated image (${A}, ${M})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const z=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let U=!1;g.usvg?(g.data=new a.q({width:A,height:M},new Uint8Array(D)),g.usvg=!1,g.icon=void 0,U=!0):g.data.replace(D,z),this.style.updateImage(c,g,U)}hasImage(m){return m?!!this.style&&!!this.style.getImage(a.I.from(m)):(this.fire(new a.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(a.I.from(m))}loadImage(m,i){a.n(this._requestManager.transformRequest(m,a.R.Image),(c,g)=>{i(c,g instanceof HTMLImageElement?a.o.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,i){this._lazyInitEmptyStyle(),this.style.addModel(m,i)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new a.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,i){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,i),this._update(!0)):this}getSlot(m){const i=this.getLayer(m);return i&&i.slot||null}setSlot(m,i){return this.style.setSlot(m,i),this.style.mergeLayers(),this._update(!0)}addImport(m,i){return this.style.addImport(m,i).catch(c=>this.fire(new a.y(new Error("Failed to add import",c)))),this}updateImport(m,i){return typeof i!="string"&&i.id!==m?(this.removeImport(m),this.addImport(i)):(this.style.updateImport(m,i),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,i){return this.style.moveImport(m,i),this._update(!0)}moveLayer(m,i){return this._isValidId(m)?(this.style.moveLayer(m,i),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const i=this.style.getOwnLayer(m);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,i,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,i,c),this._update(!0)):this}setFilter(m,i,c={}){return this._isValidId(m)?(this.style.setFilter(m,i,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,i,c,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,i,c,g),this._update(!0)):this}getPaintProperty(m,i){return this._isValidId(m)?this.style.getPaintProperty(m,i):null}setLayoutProperty(m,i,c,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,i,c,g),this._update(!0)):this}getLayoutProperty(m,i){return this._isValidId(m)?this.style.getLayoutProperty(m,i):null}setLayerProperty(m,i,c,g={}){return this._isValidId(m)?(i==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,i,c,g),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,i){return this.style.setSchema(m,i),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,i){return this.style.setConfig(m,i),this._update(!0)}getConfigProperty(m,i){return this.style.getConfigProperty(m,i)}setConfigProperty(m,i,c){return this.style.setConfigProperty(m,i,c),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const i=m[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,i),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aT.convert(m),this.transform):0}setFeatureState(m,i){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,i),this._update())}removeFeatureState(m,i){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,i),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.style.indoorManager.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.style.indoorManager.setActiveFloorsVisibility(m)}getIndoorTileOptions(m,i){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(m,i):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let c,g,E,A=this._container;for(;A&&(!g||!E);){const M=window.getComputedStyle(A).transform;M&&M!=="none"&&(c=M.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(g=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(E=c[3])),A=A.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=E?Math.abs(i/E):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Y("div","mapboxgl-canvas-container",m);this._canvas=Y("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Y("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(E=>{g[E]=Y("div",`mapboxgl-ctrl-${E}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,i){const c=a.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${i}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const i=this._markers.indexOf(m);i!==-1&&this._markers.splice(i,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const i=this._popups.indexOf(m);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const m=Object.assign({},Z.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",m);i?(vn(i,!0),this.painter=new Sf(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{if(c.dataType==="source"){const g=this.transform.elevation?this.transform.elevation._source():null;g&&c.sourceCacheId===g.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),a.k.testSupport(i)):this.fire(new a.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let i;this.fire(new a.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,g=a.o.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=E.createQuery(),E.beginQuery(c.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const A=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,U=this.transform.pitch,$=a.o.now(),ie=new a.ac(z,{now:$,fadeDuration:A,pitch:U,transition:this.style.transition,worldview:this._worldview});this.style.update(ie)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(g),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,j.mark(O.load),this.fire(new a.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const z=a.o.now()-g;E.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const U=E.getQueryParameter(i,E.QUERY_RESULT)/1e6;E.deleteQuery(i),this.fire(new a.z("gpu-timing-frame",{cpuTime:z,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(z);this.fire(new a.z("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(z);this.fire(new a.z("gpu-timing-deferred-render",{gpuTime:U}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(D||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(M=this._updateAverageElevation(g,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new a.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new a.z("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,j.mark(O.fullLoad),this._performanceMetricsCollection&&Ui(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const i of this._markers)m&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!m||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(m,i=!1){const c=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(i||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const E=this.transform.averageElevation;let A=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(A)?A=0:this._averageElevationLastSampledAt=m;const M=Math.abs(E-A);if(M>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(A),c(A);this._averageElevation.easeTo(A,m,300)}else if(M>1e-4)return this._averageElevation.jumpTo(A),c(A)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){Gn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Bt||m.status===401)){const i=this.painter.context.gl;vn(i,!1),this._logoControl instanceof Wo&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),li(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&bi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&vi(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){lr(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function E(A){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,A,0);const M=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,M),M}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(E(m),i.canvasCopies.map(E),i.timeStamps)}_canvasPixelComparison(m,i,c){let g=c[1]-c[0];const E=m.length/4;for(let A=0;A<i.length;A++){const M=i[A];let D=0;for(let z=0;z<M.length;z+=4)M[z]===m[z]&&M[z+1]===m[z+1]&&M[z+2]===m[z+2]&&M[z+3]===m[z+3]&&(D+=1);g+=(c[A+2]-c[A+1])*(1-D/E)}return g}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Wn.delete(this.painter.context.gl),Ci.remove(),Ct.remove(),this._removed=!0,this.fire(new a.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=a.o.frame(i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_preloadTiles(m){const i=this.style?this.style.getSourceCaches():[];return a.bw(i,(c,g)=>c._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,i){a.f4(m,i)}get version(){return k}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},bl,m),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(a.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:i}):c.resetNorth({},{originalEvent:i}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const i=m.getZoom(),c=i===m.getMaxZoom(),g=i===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rs(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,i){const c=Y("button",m,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(m,i){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${i}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends a.E{constructor(m={}){super();const i=navigator.geolocation;this.options=Object.assign({geolocation:i},Na,m),a.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Tf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const i=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>i(c.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(m){const i=this._map.getMaxBounds(),c=m.coords;return!!i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new a.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const i=new a.aT(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,g=this._map.getBearing(),E=Object.assign({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),E,{geolocateSource:!0})}_updateMarker(m){if(m){const i=new a.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,i=a.cf(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("error",{code:m.code,message:m.message,PERMISSION_DENIED:m.PERMISSION_DENIED,POSITION_UNAVAILABLE:m.POSITION_UNAVAILABLE,TIMEOUT:m.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const m=this.options.positionOptions.timeout;m&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},m))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Vn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(m){return this.options.followUserLocation=m??Na.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new a.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const m=()=>{const i="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(i,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yh,ScaleControl:class{constructor(m={}){this.options=Object.assign({},xh,m),a.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,i=this._map,c=i._containerHeight/2,g=i._containerWidth/2-m/2,E=i.unproject([g,c]),A=i.unproject([g+m,c]),M=E.distanceTo(A);if(this.options.unit==="imperial"){const D=3.2808*M;D>5280?this._setScale(m,D/5280,"mile"):this._setScale(m,D,"foot")}else this.options.unit==="nautical"?this._setScale(m,M/1852,"nautical-mile"):M>=1e3?this._setScale(m,M/1e3,"kilometer"):this._setScale(m,M,"meter")}_setScale(m,i,c){this._map._requestDomTask(()=>{const g=(function(A){const M=Math.pow(10,`${Math.floor(A)}`.length-1);let D=A/M;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:(function(z){const U=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*U)/U})(D),M*D})(i),E=g/i;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${kn[c]}`,this._container.style.width=m*E+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:a.w("Full screen control 'container' must be a DOM element.")),a.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Qd,Popup:class extends a.E{constructor(m){super(),this.options=Object.assign(Object.create(Ta),m),this._altitude=this.options.altitude,a.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new a.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new a.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=a.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const i=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=m;g=c.firstChild,g;)i.appendChild(g);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(m),this.options.closeButton){const c=this._closeButton=Y("button","mapboxgl-popup-close-button",i);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let i;return this._classList.delete(m)?i=!1:(this._classList.add(m),i=!0),this._updateClassList(),i}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const i=this._map,c=this._container,g=this._pos;if(!i||!c||!g)return"bottom";const E=c.offsetWidth,A=c.offsetHeight,M=g.x<E/2,D=g.x>i.transform.width-E/2;if(g.y+m<A)return M?"top-left":D?"top-right":"top";if(g.y>i.transform.height-A){if(M)return"bottom-left";if(D)return"bottom-right"}return M?"left":D?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),m.className=i.join(" ")}_update(m){const i=this._map,c=this._content;if(!i||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=Y("div","mapboxgl-popup",i.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_u(this._lngLat,this._pos,i.transform)),!this._trackPointer||m){const E=this._pos=this._trackPointer&&m instanceof a.P?m:i.project(this._lngLat,this._altitude),A=xu(this.options.offset),M=this._anchor=this._getAnchor(A.y),D=xu(this.options.offset,M),z=E.add(D).round();i._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${bo[M]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&i._showingGlobe()){const E=a.f5(i.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Ql);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Vn,Style:ha,LngLat:a.aT,LngLatBounds:a.aI,Point:a.P,MercatorCoordinate:a.ae,FreeCameraOptions:Pm,Evented:a.E,config:a.e,prewarm:a.f9,clearPrewarmedResources:a.f8,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(m){a.e.ACCESS_TOKEN=m},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(m){a.e.API_URL=m},get workerCount(){return a.fi.workerCount},set workerCount(m){a.fi.workerCount=m},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){a.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){a.fh(m)},get workerUrl(){return a.fg.workerUrl},set workerUrl(m){a.fg.workerUrl=m},get workerClass(){return a.fg.workerClass},set workerClass(m){a.fg.workerClass=m},get workerParams(){return a.fg.workerParams},set workerParams(m){a.fg.workerParams=m},get dracoUrl(){return a.ff()},set dracoUrl(m){a.fe(m)},get meshoptUrl(){return a.fd()},set meshoptUrl(m){a.fc(m)},setNow:a.o.setNow,restoreNow:a.o.restoreNow}});var R=_;return R}))})(mapboxGl$1)),mapboxGl$1.exports}var mapboxGlExports=requireMapboxGl();const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);mapboxgl.accessToken="pk.eyJ1IjoiY2l2aXhjYW1lcm9vbiIsImEiOiJjbTYyOWo0cXkwMDAwMm5zdjA2NHhhYWVqIn0.abc123placeholder";const CAMEROON_CITIES={yaounde:{lat:3.8667,lng:11.5167,name:"Yaound"},douala:{lat:4.0511,lng:9.7679,name:"Douala"}},CAMEROON_CENTER={lat:3.848,lng:11.5021},MapComponent=({onLocationSelect:t,defaultLocation:s={lat:CAMEROON_CENTER.lat,lng:CAMEROON_CENTER.lng,name:"Cameroon"}})=>{const u=reactExports.useRef(null),d=reactExports.useRef(null),_=reactExports.useRef(null);reactExports.useEffect(()=>{if(u.current)return _.current&&(_.current.remove(),_.current=null,d.current=null),_.current=new mapboxgl.Map({container:u.current,style:"mapbox://styles/mapbox/streets-v12",center:[s.lng,s.lat],zoom:s.name==="Cameroon"?6:13}),_.current.on("mouseenter",()=>{_.current.getCanvas().style.cursor="crosshair"}),_.current.on("mouseleave",()=>{_.current.getCanvas().style.cursor=""}),_.current.on("click",async R=>{const{lng:a,lat:k}=R.lngLat;d.current?d.current.setLngLat([a,k]):(d.current=new mapboxgl.Marker({draggable:!0}).setLngLat([a,k]).addTo(_.current),d.current.on("dragstart",()=>{_.current&&(_.current.getCanvas().style.cursor="grabbing")}),d.current.on("dragend",async()=>{_.current&&(_.current.getCanvas().style.cursor="crosshair");const G=d.current.getLngLat(),J=await S(G.lng,G.lat);t(G.lat,G.lng,J)}));const j=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${a},${k}.json?access_token=${mapboxgl.accessToken}`)).json(),V=j.features&&j.features[0]?j.features[0].place_name:`Lat: ${k}, Lng: ${a}`;t(k,a,V)}),()=>{var R;(R=_.current)==null||R.remove(),_.current=null,d.current=null}},[t,s]);async function S(R,a){try{const O=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${R},${a}.json?access_token=${mapboxgl.accessToken}`)).json();return O.features&&O.features[0]?O.features[0].place_name:`${a.toFixed(6)}, ${R.toFixed(6)}`}catch{return`${a.toFixed(6)}, ${R.toFixed(6)}`}}return jsxRuntimeExports.jsx("div",{ref:u,style:{width:"100%",height:"100%"}})},ReportIssue=()=>{const t=useNavigate(),[s,u]=reactExports.useState("yaounde"),[d,_]=reactExports.useState({title:"",issueDescription:"",issueLocation:"",issueType:"Road Infrastructure",location:{address:"",latitude:CAMEROON_CITIES.yaounde.lat,longitude:CAMEROON_CITIES.yaounde.lng}}),[S,R]=reactExports.useState(null),[a,k]=reactExports.useState(!1),O=(Z,Y)=>{_(le=>({...le,[Z]:Y}))},j=reactExports.useCallback((Z,Y,le)=>{_(ee=>({...ee,location:{address:le,latitude:Z,longitude:Y},issueLocation:le}))},[]),V=Z=>{var le;const Y=(le=Z.target.files)==null?void 0:le[0];Y&&R(Y)},G=async Z=>{if(Z.preventDefault(),!d.title||!d.issueDescription||!d.issueLocation){toast.error("Please fill all required fields");return}k(!0);try{const Y=localStorage.getItem("auth_token");if(!Y){toast.error("You must be logged in");return}const le=new FormData;le.append("title",d.title),le.append("description",d.issueDescription),le.append("issueType",d.issueType);const ee={address:d.issueLocation,latitude:d.location.latitude||3.8667,longitude:d.location.longitude||11.5167};le.append("location",JSON.stringify(ee)),S&&le.append("files",S);const se=await fetch(`${VITE_BACKEND_URL}/api/v1/citizen/create-issue`,{method:"POST",headers:{Authorization:`Bearer ${Y}`},body:le}),Q=await se.json();se.ok?(toast.success("Issue reported successfully!"),t("/citizen")):toast.error(Q.message||"Failed to report issue")}catch(Y){console.error("Error reporting issue:",Y),toast.error("Something went wrong")}finally{k(!1)}},J=[{value:"Road Infrastructure",label:"Road Infrastructure"},{value:"Waste Management",label:"Waste Management"},{value:"Environmental Issues",label:"Environmental Issues"},{value:"Utilities & Infrastructure",label:"Utilities & Infrastructure"},{value:"Public Safety",label:"Public Safety"},{value:"Other",label:"Other"}];return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#f3f6f8]",children:[jsxRuntimeExports.jsx("header",{className:"w-full border-b bg-white/10 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50",children:jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:jsxRuntimeExports.jsxs("div",{className:"flex h-16 items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-4",children:jsxRuntimeExports.jsx(Link,{to:"/citizen",children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",className:"flex items-center space-x-2 text-slate-500",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-4 w-4 text-blue-600"}),jsxRuntimeExports.jsx("span",{children:"Back to Dashboard"})]})})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-cyan-600",children:"Report New Issue"})}),jsxRuntimeExports.jsx("div",{className:"w-24"})]})})}),jsxRuntimeExports.jsx("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-2",children:jsxRuntimeExports.jsxs(Card,{className:"shadow-lg bg-white/80  text-slate-600",children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsx(CardTitle,{children:"Report New Issue"})}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsxs("form",{onSubmit:G,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"title",children:"Issue Title *"}),jsxRuntimeExports.jsx(Input,{id:"title",type:"text",value:d.title,onChange:Z=>O("title",Z.target.value),placeholder:"Enter your issue title",required:!0,className:"shadow-sm"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 p-4 border-2 border-green-200 bg-green-50 rounded-lg",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"issueLocation",className:"font-bold text-green-700",children:" Location Name *"}),jsxRuntimeExports.jsx(Input,{id:"issueLocation",type:"text",value:d.issueLocation,onChange:Z=>O("issueLocation",Z.target.value),placeholder:"e.g., Downtown Yaound, Rue Foch, Douala",className:"shadow-sm bg-white",required:!0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:" This name will be displayed in issue reports"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-medium",children:"Issue Information"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{children:"Issue Type *"}),jsxRuntimeExports.jsx(RadioGroup$1,{value:d.issueType,onValueChange:Z=>O("issueType",Z),className:"grid grid-cols-2 gap-4",children:J.map(Z=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(RadioGroupItem,{value:Z.value,id:Z.value}),jsxRuntimeExports.jsx(Label$1,{htmlFor:Z.value,className:"text-sm",children:Z.label})]},Z.value))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"issueDescription",children:"Issue Description *"}),jsxRuntimeExports.jsx(Textarea,{id:"issueDescription",value:d.issueDescription,onChange:Z=>O("issueDescription",Z.target.value),placeholder:"Describe the issue in detail...",className:"min-h-24 shadow-sm",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-medium",children:"Upload Media"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"file",children:"Upload Image/Video"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx(Input,{id:"file",type:"file",accept:"image/*,video/*",onChange:V,className:"flex-1"}),jsxRuntimeExports.jsx(Upload,{className:"h-5 w-5 text-blue-600"})]}),S&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Selected: ",S.name," (",(S.size/1024/1024).toFixed(2)," MB)"]})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full civic-gradient border-0 text-white hover:opacity-70",disabled:a,size:"lg",children:a?"Submitting...":jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Send,{className:"h-5 w-5 mr-2"})," Submit Issue"]})})]})})]})}),jsxRuntimeExports.jsxs(Card,{className:"shadow-lg bg-white/80 h-fit",children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center space-x-2 text-slate-600",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-5 w-5 text-blue-600"}),jsxRuntimeExports.jsx("span",{children:"Map Reference"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{className:"text-sm font-medium",children:"City"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{type:"button",variant:s==="yaounde"?"default":"outline",onClick:()=>u("yaounde"),className:"flex-1 text-xs",children:"Yaound"}),jsxRuntimeExports.jsx(Button,{type:"button",variant:s==="douala"?"default":"outline",onClick:()=>u("douala"),className:"flex-1 text-xs",children:"Douala"})]})]})]}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx("div",{className:"h-64 rounded-lg overflow-hidden border",children:jsxRuntimeExports.jsx(MapComponent,{onLocationSelect:j,defaultLocation:s==="yaounde"?{...CAMEROON_CITIES.yaounde,name:"Yaound"}:{...CAMEROON_CITIES.douala,name:"Douala"}})}),d.location.latitude&&d.location.longitude&&jsxRuntimeExports.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded text-xs",children:jsxRuntimeExports.jsx("p",{className:"text-blue-600 font-semibold",children:"Coordinates captured"})})]})]})]})})]})};function Table({className:t,...s}){return jsxRuntimeExports.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:jsxRuntimeExports.jsx("table",{"data-slot":"table",className:cn("w-full caption-bottom text-sm",t),...s})})}function TableHeader({className:t,...s}){return jsxRuntimeExports.jsx("thead",{"data-slot":"table-header",className:cn("[&_tr]:border-b",t),...s})}function TableBody({className:t,...s}){return jsxRuntimeExports.jsx("tbody",{"data-slot":"table-body",className:cn("[&_tr:last-child]:border-0",t),...s})}function TableRow({className:t,...s}){return jsxRuntimeExports.jsx("tr",{"data-slot":"table-row",className:cn("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function TableHead({className:t,...s}){return jsxRuntimeExports.jsx("th",{"data-slot":"table-head",className:cn("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function TableCell({className:t,...s}){return jsxRuntimeExports.jsx("td",{"data-slot":"table-cell",className:cn("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function TableCaption({className:t,...s}){return jsxRuntimeExports.jsx("caption",{"data-slot":"table-caption",className:cn("text-muted-foreground mt-4 text-sm",t),...s})}function createContextScope$4(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$4(_,...s)]}function composeContextScopes$4(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$8(t){const s=createSlotClone$8(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$8);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$8(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$8(_),a=mergeProps$8(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$8=Symbol("radix.slottable");function isSlottable$8(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$8}function mergeProps$8(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$8(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$8=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$8=NODES$8.reduce((t,s)=>{const u=createSlot$8(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{});function createContextScope$3(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$3(_,...s)]}function composeContextScopes$3(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$7(t){const s=createSlotClone$7(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$7);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$7(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$7(_),a=mergeProps$7(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$7=Symbol("radix.slottable");function isSlottable$7(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$7}function mergeProps$7(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$7(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$7=NODES$7.reduce((t,s)=>{const u=createSlot$7(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{});function dispatchDiscreteCustomEvent$1(t,s){t&&reactDomExports.flushSync(()=>t.dispatchEvent(s))}function useEscapeKeydown(t,s=globalThis==null?void 0:globalThis.document){const u=useCallbackRef$1(t);reactExports.useEffect(()=>{const d=_=>{_.key==="Escape"&&u(_)};return s.addEventListener("keydown",d,{capture:!0}),()=>s.removeEventListener("keydown",d,{capture:!0})},[u,s])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((t,s)=>{const{disableOutsidePointerEvents:u=!1,onEscapeKeyDown:d,onPointerDownOutside:_,onFocusOutside:S,onInteractOutside:R,onDismiss:a,...k}=t,O=reactExports.useContext(DismissableLayerContext),[j,V]=reactExports.useState(null),G=(j==null?void 0:j.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,J]=reactExports.useState({}),Z=useComposedRefs(s,ke=>V(ke)),Y=Array.from(O.layers),[le]=[...O.layersWithOutsidePointerEventsDisabled].slice(-1),ee=Y.indexOf(le),se=j?Y.indexOf(j):-1,Q=O.layersWithOutsidePointerEventsDisabled.size>0,oe=se>=ee,_e=usePointerDownOutside(ke=>{const Le=ke.target,lt=[...O.branches].some(qt=>qt.contains(Le));!oe||lt||(_==null||_(ke),R==null||R(ke),ke.defaultPrevented||a==null||a())},G),Se=useFocusOutside(ke=>{const Le=ke.target;[...O.branches].some(qt=>qt.contains(Le))||(S==null||S(ke),R==null||R(ke),ke.defaultPrevented||a==null||a())},G);return useEscapeKeydown(ke=>{se===O.layers.size-1&&(d==null||d(ke),!ke.defaultPrevented&&a&&(ke.preventDefault(),a()))},G),reactExports.useEffect(()=>{if(j)return u&&(O.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=G.body.style.pointerEvents,G.body.style.pointerEvents="none"),O.layersWithOutsidePointerEventsDisabled.add(j)),O.layers.add(j),dispatchUpdate(),()=>{u&&O.layersWithOutsidePointerEventsDisabled.size===1&&(G.body.style.pointerEvents=originalBodyPointerEvents)}},[j,G,u,O]),reactExports.useEffect(()=>()=>{j&&(O.layers.delete(j),O.layersWithOutsidePointerEventsDisabled.delete(j),dispatchUpdate())},[j,O]),reactExports.useEffect(()=>{const ke=()=>J({});return document.addEventListener(CONTEXT_UPDATE,ke),()=>document.removeEventListener(CONTEXT_UPDATE,ke)},[]),jsxRuntimeExports.jsx(Primitive$7.div,{...k,ref:Z,style:{pointerEvents:Q?oe?"auto":"none":void 0,...t.style},onFocusCapture:composeEventHandlers(t.onFocusCapture,Se.onFocusCapture),onBlurCapture:composeEventHandlers(t.onBlurCapture,Se.onBlurCapture),onPointerDownCapture:composeEventHandlers(t.onPointerDownCapture,_e.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((t,s)=>{const u=reactExports.useContext(DismissableLayerContext),d=reactExports.useRef(null),_=useComposedRefs(s,d);return reactExports.useEffect(()=>{const S=d.current;if(S)return u.branches.add(S),()=>{u.branches.delete(S)}},[u.branches]),jsxRuntimeExports.jsx(Primitive$7.div,{...t,ref:_})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(t,s=globalThis==null?void 0:globalThis.document){const u=useCallbackRef$1(t),d=reactExports.useRef(!1),_=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const S=a=>{if(a.target&&!d.current){let k=function(){handleAndDispatchCustomEvent(POINTER_DOWN_OUTSIDE,u,O,{discrete:!0})};const O={originalEvent:a};a.pointerType==="touch"?(s.removeEventListener("click",_.current),_.current=k,s.addEventListener("click",_.current,{once:!0})):k()}else s.removeEventListener("click",_.current);d.current=!1},R=window.setTimeout(()=>{s.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),s.removeEventListener("pointerdown",S),s.removeEventListener("click",_.current)}},[s,u]),{onPointerDownCapture:()=>d.current=!0}}function useFocusOutside(t,s=globalThis==null?void 0:globalThis.document){const u=useCallbackRef$1(t),d=reactExports.useRef(!1);return reactExports.useEffect(()=>{const _=S=>{S.target&&!d.current&&handleAndDispatchCustomEvent(FOCUS_OUTSIDE,u,{originalEvent:S},{discrete:!1})};return s.addEventListener("focusin",_),()=>s.removeEventListener("focusin",_)},[s,u]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function dispatchUpdate(){const t=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(t)}function handleAndDispatchCustomEvent(t,s,u,{discrete:d}){const _=u.originalEvent.target,S=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:u});s&&_.addEventListener(t,s,{once:!0}),d?dispatchDiscreteCustomEvent$1(_,S):_.dispatchEvent(S)}var count=0;function useFocusGuards(){reactExports.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",t[1]??createFocusGuard()),count++,()=>{count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),count--}},[])}function createFocusGuard(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}function createSlot$6(t){const s=createSlotClone$6(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$6);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$6(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$6(_),a=mergeProps$6(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$6=Symbol("radix.slottable");function isSlottable$6(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$6}function mergeProps$6(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$6(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$6=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$6=NODES$6.reduce((t,s)=>{const u=createSlot$6(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((t,s)=>{const{loop:u=!1,trapped:d=!1,onMountAutoFocus:_,onUnmountAutoFocus:S,...R}=t,[a,k]=reactExports.useState(null),O=useCallbackRef$1(_),j=useCallbackRef$1(S),V=reactExports.useRef(null),G=useComposedRefs(s,Y=>k(Y)),J=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(d){let Y=function(Q){if(J.paused||!a)return;const oe=Q.target;a.contains(oe)?V.current=oe:focus(V.current,{select:!0})},le=function(Q){if(J.paused||!a)return;const oe=Q.relatedTarget;oe!==null&&(a.contains(oe)||focus(V.current,{select:!0}))},ee=function(Q){if(document.activeElement===document.body)for(const _e of Q)_e.removedNodes.length>0&&focus(a)};document.addEventListener("focusin",Y),document.addEventListener("focusout",le);const se=new MutationObserver(ee);return a&&se.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Y),document.removeEventListener("focusout",le),se.disconnect()}}},[d,a,J.paused]),reactExports.useEffect(()=>{if(a){focusScopesStack.add(J);const Y=document.activeElement;if(!a.contains(Y)){const ee=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS);a.addEventListener(AUTOFOCUS_ON_MOUNT,O),a.dispatchEvent(ee),ee.defaultPrevented||(focusFirst$1(removeLinks(getTabbableCandidates(a)),{select:!0}),document.activeElement===Y&&focus(a))}return()=>{a.removeEventListener(AUTOFOCUS_ON_MOUNT,O),setTimeout(()=>{const ee=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS);a.addEventListener(AUTOFOCUS_ON_UNMOUNT,j),a.dispatchEvent(ee),ee.defaultPrevented||focus(Y??document.body,{select:!0}),a.removeEventListener(AUTOFOCUS_ON_UNMOUNT,j),focusScopesStack.remove(J)},0)}}},[a,O,j,J]);const Z=reactExports.useCallback(Y=>{if(!u&&!d||J.paused)return;const le=Y.key==="Tab"&&!Y.altKey&&!Y.ctrlKey&&!Y.metaKey,ee=document.activeElement;if(le&&ee){const se=Y.currentTarget,[Q,oe]=getTabbableEdges(se);Q&&oe?!Y.shiftKey&&ee===oe?(Y.preventDefault(),u&&focus(Q,{select:!0})):Y.shiftKey&&ee===Q&&(Y.preventDefault(),u&&focus(oe,{select:!0})):ee===se&&Y.preventDefault()}},[u,d,J.paused]);return jsxRuntimeExports.jsx(Primitive$6.div,{tabIndex:-1,...R,ref:G,onKeyDown:Z})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst$1(t,{select:s=!1}={}){const u=document.activeElement;for(const d of t)if(focus(d,{select:s}),document.activeElement!==u)return}function getTabbableEdges(t){const s=getTabbableCandidates(t),u=findVisible(s,t),d=findVisible(s.reverse(),t);return[u,d]}function getTabbableCandidates(t){const s=[],u=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const _=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||_?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;u.nextNode();)s.push(u.currentNode);return s}function findVisible(t,s){for(const u of t)if(!isHidden(u,{upTo:s}))return u}function isHidden(t,{upTo:s}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(s!==void 0&&t===s)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function isSelectableInput(t){return t instanceof HTMLInputElement&&"select"in t}function focus(t,{select:s=!1}={}){if(t&&t.focus){const u=document.activeElement;t.focus({preventScroll:!0}),t!==u&&isSelectableInput(t)&&s&&t.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let t=[];return{add(s){const u=t[0];s!==u&&(u==null||u.pause()),t=arrayRemove(t,s),t.unshift(s)},remove(s){var u;t=arrayRemove(t,s),(u=t[0])==null||u.resume()}}}function arrayRemove(t,s){const u=[...t],d=u.indexOf(s);return d!==-1&&u.splice(d,1),u}function removeLinks(t){return t.filter(s=>s.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=t=>({x:t,y:t}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(t,s,u){return max(t,min(s,u))}function evaluate(t,s){return typeof t=="function"?t(s):t}function getSide(t){return t.split("-")[0]}function getAlignment(t){return t.split("-")[1]}function getOppositeAxis(t){return t==="x"?"y":"x"}function getAxisLength(t){return t==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(t){return yAxisSides.has(getSide(t))?"y":"x"}function getAlignmentAxis(t){return getOppositeAxis(getSideAxis(t))}function getAlignmentSides(t,s,u){u===void 0&&(u=!1);const d=getAlignment(t),_=getAlignmentAxis(t),S=getAxisLength(_);let R=_==="x"?d===(u?"end":"start")?"right":"left":d==="start"?"bottom":"top";return s.reference[S]>s.floating[S]&&(R=getOppositePlacement(R)),[R,getOppositePlacement(R)]}function getExpandedPlacements(t){const s=getOppositePlacement(t);return[getOppositeAlignmentPlacement(t),s,getOppositeAlignmentPlacement(s)]}function getOppositeAlignmentPlacement(t){return t.replace(/start|end/g,s=>oppositeAlignmentMap[s])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(t,s,u){switch(t){case"top":case"bottom":return u?s?rlPlacement:lrPlacement:s?lrPlacement:rlPlacement;case"left":case"right":return s?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(t,s,u,d){const _=getAlignment(t);let S=getSideList(getSide(t),u==="start",d);return _&&(S=S.map(R=>R+"-"+_),s&&(S=S.concat(S.map(getOppositeAlignmentPlacement)))),S}function getOppositePlacement(t){return t.replace(/left|right|bottom|top/g,s=>oppositeSideMap[s])}function expandPaddingObject(t){return{top:0,right:0,bottom:0,left:0,...t}}function getPaddingObject(t){return typeof t!="number"?expandPaddingObject(t):{top:t,right:t,bottom:t,left:t}}function rectToClientRect(t){const{x:s,y:u,width:d,height:_}=t;return{width:d,height:_,top:u,left:s,right:s+d,bottom:u+_,x:s,y:u}}function computeCoordsFromPlacement(t,s,u){let{reference:d,floating:_}=t;const S=getSideAxis(s),R=getAlignmentAxis(s),a=getAxisLength(R),k=getSide(s),O=S==="y",j=d.x+d.width/2-_.width/2,V=d.y+d.height/2-_.height/2,G=d[a]/2-_[a]/2;let J;switch(k){case"top":J={x:j,y:d.y-_.height};break;case"bottom":J={x:j,y:d.y+d.height};break;case"right":J={x:d.x+d.width,y:V};break;case"left":J={x:d.x-_.width,y:V};break;default:J={x:d.x,y:d.y}}switch(getAlignment(s)){case"start":J[R]-=G*(u&&O?-1:1);break;case"end":J[R]+=G*(u&&O?-1:1);break}return J}async function detectOverflow(t,s){var u;s===void 0&&(s={});const{x:d,y:_,platform:S,rects:R,elements:a,strategy:k}=t,{boundary:O="clippingAncestors",rootBoundary:j="viewport",elementContext:V="floating",altBoundary:G=!1,padding:J=0}=evaluate(s,t),Z=getPaddingObject(J),le=a[G?V==="floating"?"reference":"floating":V],ee=rectToClientRect(await S.getClippingRect({element:(u=await(S.isElement==null?void 0:S.isElement(le)))==null||u?le:le.contextElement||await(S.getDocumentElement==null?void 0:S.getDocumentElement(a.floating)),boundary:O,rootBoundary:j,strategy:k})),se=V==="floating"?{x:d,y:_,width:R.floating.width,height:R.floating.height}:R.reference,Q=await(S.getOffsetParent==null?void 0:S.getOffsetParent(a.floating)),oe=await(S.isElement==null?void 0:S.isElement(Q))?await(S.getScale==null?void 0:S.getScale(Q))||{x:1,y:1}:{x:1,y:1},_e=rectToClientRect(S.convertOffsetParentRelativeRectToViewportRelativeRect?await S.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:se,offsetParent:Q,strategy:k}):se);return{top:(ee.top-_e.top+Z.top)/oe.y,bottom:(_e.bottom-ee.bottom+Z.bottom)/oe.y,left:(ee.left-_e.left+Z.left)/oe.x,right:(_e.right-ee.right+Z.right)/oe.x}}const computePosition$1=async(t,s,u)=>{const{placement:d="bottom",strategy:_="absolute",middleware:S=[],platform:R}=u,a=S.filter(Boolean),k=await(R.isRTL==null?void 0:R.isRTL(s));let O=await R.getElementRects({reference:t,floating:s,strategy:_}),{x:j,y:V}=computeCoordsFromPlacement(O,d,k),G=d,J={},Z=0;for(let le=0;le<a.length;le++){var Y;const{name:ee,fn:se}=a[le],{x:Q,y:oe,data:_e,reset:Se}=await se({x:j,y:V,initialPlacement:d,placement:G,strategy:_,middlewareData:J,rects:O,platform:{...R,detectOverflow:(Y=R.detectOverflow)!=null?Y:detectOverflow},elements:{reference:t,floating:s}});j=Q??j,V=oe??V,J={...J,[ee]:{...J[ee],..._e}},Se&&Z<=50&&(Z++,typeof Se=="object"&&(Se.placement&&(G=Se.placement),Se.rects&&(O=Se.rects===!0?await R.getElementRects({reference:t,floating:s,strategy:_}):Se.rects),{x:j,y:V}=computeCoordsFromPlacement(O,G,k)),le=-1)}return{x:j,y:V,placement:G,strategy:_,middlewareData:J}},arrow$3=t=>({name:"arrow",options:t,async fn(s){const{x:u,y:d,placement:_,rects:S,platform:R,elements:a,middlewareData:k}=s,{element:O,padding:j=0}=evaluate(t,s)||{};if(O==null)return{};const V=getPaddingObject(j),G={x:u,y:d},J=getAlignmentAxis(_),Z=getAxisLength(J),Y=await R.getDimensions(O),le=J==="y",ee=le?"top":"left",se=le?"bottom":"right",Q=le?"clientHeight":"clientWidth",oe=S.reference[Z]+S.reference[J]-G[J]-S.floating[Z],_e=G[J]-S.reference[J],Se=await(R.getOffsetParent==null?void 0:R.getOffsetParent(O));let ke=Se?Se[Q]:0;(!ke||!await(R.isElement==null?void 0:R.isElement(Se)))&&(ke=a.floating[Q]||S.floating[Z]);const Le=oe/2-_e/2,lt=ke/2-Y[Z]/2-1,qt=min(V[ee],lt),Yt=min(V[se],lt),Ot=qt,Bt=ke-Y[Z]-Yt,si=ke/2-Y[Z]/2+Le,kt=clamp(Ot,si,Bt),xe=!k.arrow&&getAlignment(_)!=null&&si!==kt&&S.reference[Z]/2-(si<Ot?qt:Yt)-Y[Z]/2<0,Fe=xe?si<Ot?si-Ot:si-Bt:0;return{[J]:G[J]+Fe,data:{[J]:kt,centerOffset:si-kt-Fe,...xe&&{alignmentOffset:Fe}},reset:xe}}}),flip$2=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(s){var u,d;const{placement:_,middlewareData:S,rects:R,initialPlacement:a,platform:k,elements:O}=s,{mainAxis:j=!0,crossAxis:V=!0,fallbackPlacements:G,fallbackStrategy:J="bestFit",fallbackAxisSideDirection:Z="none",flipAlignment:Y=!0,...le}=evaluate(t,s);if((u=S.arrow)!=null&&u.alignmentOffset)return{};const ee=getSide(_),se=getSideAxis(a),Q=getSide(a)===a,oe=await(k.isRTL==null?void 0:k.isRTL(O.floating)),_e=G||(Q||!Y?[getOppositePlacement(a)]:getExpandedPlacements(a)),Se=Z!=="none";!G&&Se&&_e.push(...getOppositeAxisPlacements(a,Y,Z,oe));const ke=[a,..._e],Le=await k.detectOverflow(s,le),lt=[];let qt=((d=S.flip)==null?void 0:d.overflows)||[];if(j&&lt.push(Le[ee]),V){const si=getAlignmentSides(_,R,oe);lt.push(Le[si[0]],Le[si[1]])}if(qt=[...qt,{placement:_,overflows:lt}],!lt.every(si=>si<=0)){var Yt,Ot;const si=(((Yt=S.flip)==null?void 0:Yt.index)||0)+1,kt=ke[si];if(kt&&(!(V==="alignment"?se!==getSideAxis(kt):!1)||qt.every(pe=>getSideAxis(pe.placement)===se?pe.overflows[0]>0:!0)))return{data:{index:si,overflows:qt},reset:{placement:kt}};let xe=(Ot=qt.filter(Fe=>Fe.overflows[0]<=0).sort((Fe,pe)=>Fe.overflows[1]-pe.overflows[1])[0])==null?void 0:Ot.placement;if(!xe)switch(J){case"bestFit":{var Bt;const Fe=(Bt=qt.filter(pe=>{if(Se){const Te=getSideAxis(pe.placement);return Te===se||Te==="y"}return!0}).map(pe=>[pe.placement,pe.overflows.filter(Te=>Te>0).reduce((Te,st)=>Te+st,0)]).sort((pe,Te)=>pe[1]-Te[1])[0])==null?void 0:Bt[0];Fe&&(xe=Fe);break}case"initialPlacement":xe=a;break}if(_!==xe)return{reset:{placement:xe}}}return{}}}};function getSideOffsets(t,s){return{top:t.top-s.height,right:t.right-s.width,bottom:t.bottom-s.height,left:t.left-s.width}}function isAnySideFullyClipped(t){return sides.some(s=>t[s]>=0)}const hide$2=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(s){const{rects:u,platform:d}=s,{strategy:_="referenceHidden",...S}=evaluate(t,s);switch(_){case"referenceHidden":{const R=await d.detectOverflow(s,{...S,elementContext:"reference"}),a=getSideOffsets(R,u.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:isAnySideFullyClipped(a)}}}case"escaped":{const R=await d.detectOverflow(s,{...S,altBoundary:!0}),a=getSideOffsets(R,u.floating);return{data:{escapedOffsets:a,escaped:isAnySideFullyClipped(a)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(t,s){const{placement:u,platform:d,elements:_}=t,S=await(d.isRTL==null?void 0:d.isRTL(_.floating)),R=getSide(u),a=getAlignment(u),k=getSideAxis(u)==="y",O=originSides.has(R)?-1:1,j=S&&k?-1:1,V=evaluate(s,t);let{mainAxis:G,crossAxis:J,alignmentAxis:Z}=typeof V=="number"?{mainAxis:V,crossAxis:0,alignmentAxis:null}:{mainAxis:V.mainAxis||0,crossAxis:V.crossAxis||0,alignmentAxis:V.alignmentAxis};return a&&typeof Z=="number"&&(J=a==="end"?Z*-1:Z),k?{x:J*j,y:G*O}:{x:G*O,y:J*j}}const offset$2=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(s){var u,d;const{x:_,y:S,placement:R,middlewareData:a}=s,k=await convertValueToCoords(s,t);return R===((u=a.offset)==null?void 0:u.placement)&&(d=a.arrow)!=null&&d.alignmentOffset?{}:{x:_+k.x,y:S+k.y,data:{...k,placement:R}}}}},shift$2=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(s){const{x:u,y:d,placement:_,platform:S}=s,{mainAxis:R=!0,crossAxis:a=!1,limiter:k={fn:ee=>{let{x:se,y:Q}=ee;return{x:se,y:Q}}},...O}=evaluate(t,s),j={x:u,y:d},V=await S.detectOverflow(s,O),G=getSideAxis(getSide(_)),J=getOppositeAxis(G);let Z=j[J],Y=j[G];if(R){const ee=J==="y"?"top":"left",se=J==="y"?"bottom":"right",Q=Z+V[ee],oe=Z-V[se];Z=clamp(Q,Z,oe)}if(a){const ee=G==="y"?"top":"left",se=G==="y"?"bottom":"right",Q=Y+V[ee],oe=Y-V[se];Y=clamp(Q,Y,oe)}const le=k.fn({...s,[J]:Z,[G]:Y});return{...le,data:{x:le.x-u,y:le.y-d,enabled:{[J]:R,[G]:a}}}}}},limitShift$2=function(t){return t===void 0&&(t={}),{options:t,fn(s){const{x:u,y:d,placement:_,rects:S,middlewareData:R}=s,{offset:a=0,mainAxis:k=!0,crossAxis:O=!0}=evaluate(t,s),j={x:u,y:d},V=getSideAxis(_),G=getOppositeAxis(V);let J=j[G],Z=j[V];const Y=evaluate(a,s),le=typeof Y=="number"?{mainAxis:Y,crossAxis:0}:{mainAxis:0,crossAxis:0,...Y};if(k){const Q=G==="y"?"height":"width",oe=S.reference[G]-S.floating[Q]+le.mainAxis,_e=S.reference[G]+S.reference[Q]-le.mainAxis;J<oe?J=oe:J>_e&&(J=_e)}if(O){var ee,se;const Q=G==="y"?"width":"height",oe=originSides.has(getSide(_)),_e=S.reference[V]-S.floating[Q]+(oe&&((ee=R.offset)==null?void 0:ee[V])||0)+(oe?0:le.crossAxis),Se=S.reference[V]+S.reference[Q]+(oe?0:((se=R.offset)==null?void 0:se[V])||0)-(oe?le.crossAxis:0);Z<_e?Z=_e:Z>Se&&(Z=Se)}return{[G]:J,[V]:Z}}}},size$2=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(s){var u,d;const{placement:_,rects:S,platform:R,elements:a}=s,{apply:k=()=>{},...O}=evaluate(t,s),j=await R.detectOverflow(s,O),V=getSide(_),G=getAlignment(_),J=getSideAxis(_)==="y",{width:Z,height:Y}=S.floating;let le,ee;V==="top"||V==="bottom"?(le=V,ee=G===(await(R.isRTL==null?void 0:R.isRTL(a.floating))?"start":"end")?"left":"right"):(ee=V,le=G==="end"?"top":"bottom");const se=Y-j.top-j.bottom,Q=Z-j.left-j.right,oe=min(Y-j[le],se),_e=min(Z-j[ee],Q),Se=!s.middlewareData.shift;let ke=oe,Le=_e;if((u=s.middlewareData.shift)!=null&&u.enabled.x&&(Le=Q),(d=s.middlewareData.shift)!=null&&d.enabled.y&&(ke=se),Se&&!G){const qt=max(j.left,0),Yt=max(j.right,0),Ot=max(j.top,0),Bt=max(j.bottom,0);J?Le=Z-2*(qt!==0||Yt!==0?qt+Yt:max(j.left,j.right)):ke=Y-2*(Ot!==0||Bt!==0?Ot+Bt:max(j.top,j.bottom))}await k({...s,availableWidth:Le,availableHeight:ke});const lt=await R.getDimensions(a.floating);return Z!==lt.width||Y!==lt.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(t){return isNode(t)?(t.nodeName||"").toLowerCase():"#document"}function getWindow(t){var s;return(t==null||(s=t.ownerDocument)==null?void 0:s.defaultView)||window}function getDocumentElement(t){var s;return(s=(isNode(t)?t.ownerDocument:t.document)||window.document)==null?void 0:s.documentElement}function isNode(t){return hasWindow()?t instanceof Node||t instanceof getWindow(t).Node:!1}function isElement(t){return hasWindow()?t instanceof Element||t instanceof getWindow(t).Element:!1}function isHTMLElement(t){return hasWindow()?t instanceof HTMLElement||t instanceof getWindow(t).HTMLElement:!1}function isShadowRoot(t){return!hasWindow()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof getWindow(t).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(t){const{overflow:s,overflowX:u,overflowY:d,display:_}=getComputedStyle$1(t);return/auto|scroll|overlay|hidden|clip/.test(s+d+u)&&!invalidOverflowDisplayValues.has(_)}const tableElements=new Set(["table","td","th"]);function isTableElement(t){return tableElements.has(getNodeName(t))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(t){return topLayerSelectors.some(s=>{try{return t.matches(s)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(t){const s=isWebKit(),u=isElement(t)?getComputedStyle$1(t):t;return transformProperties.some(d=>u[d]?u[d]!=="none":!1)||(u.containerType?u.containerType!=="normal":!1)||!s&&(u.backdropFilter?u.backdropFilter!=="none":!1)||!s&&(u.filter?u.filter!=="none":!1)||willChangeValues.some(d=>(u.willChange||"").includes(d))||containValues.some(d=>(u.contain||"").includes(d))}function getContainingBlock(t){let s=getParentNode(t);for(;isHTMLElement(s)&&!isLastTraversableNode(s);){if(isContainingBlock(s))return s;if(isTopLayer(s))return null;s=getParentNode(s)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(t){return lastTraversableNodeNames.has(getNodeName(t))}function getComputedStyle$1(t){return getWindow(t).getComputedStyle(t)}function getNodeScroll(t){return isElement(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function getParentNode(t){if(getNodeName(t)==="html")return t;const s=t.assignedSlot||t.parentNode||isShadowRoot(t)&&t.host||getDocumentElement(t);return isShadowRoot(s)?s.host:s}function getNearestOverflowAncestor(t){const s=getParentNode(t);return isLastTraversableNode(s)?t.ownerDocument?t.ownerDocument.body:t.body:isHTMLElement(s)&&isOverflowElement(s)?s:getNearestOverflowAncestor(s)}function getOverflowAncestors(t,s,u){var d;s===void 0&&(s=[]),u===void 0&&(u=!0);const _=getNearestOverflowAncestor(t),S=_===((d=t.ownerDocument)==null?void 0:d.body),R=getWindow(_);if(S){const a=getFrameElement(R);return s.concat(R,R.visualViewport||[],isOverflowElement(_)?_:[],a&&u?getOverflowAncestors(a):[])}return s.concat(_,getOverflowAncestors(_,[],u))}function getFrameElement(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function getCssDimensions(t){const s=getComputedStyle$1(t);let u=parseFloat(s.width)||0,d=parseFloat(s.height)||0;const _=isHTMLElement(t),S=_?t.offsetWidth:u,R=_?t.offsetHeight:d,a=round(u)!==S||round(d)!==R;return a&&(u=S,d=R),{width:u,height:d,$:a}}function unwrapElement(t){return isElement(t)?t:t.contextElement}function getScale(t){const s=unwrapElement(t);if(!isHTMLElement(s))return createCoords(1);const u=s.getBoundingClientRect(),{width:d,height:_,$:S}=getCssDimensions(s);let R=(S?round(u.width):u.width)/d,a=(S?round(u.height):u.height)/_;return(!R||!Number.isFinite(R))&&(R=1),(!a||!Number.isFinite(a))&&(a=1),{x:R,y:a}}const noOffsets=createCoords(0);function getVisualOffsets(t){const s=getWindow(t);return!isWebKit()||!s.visualViewport?noOffsets:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function shouldAddVisualOffsets(t,s,u){return s===void 0&&(s=!1),!u||s&&u!==getWindow(t)?!1:s}function getBoundingClientRect(t,s,u,d){s===void 0&&(s=!1),u===void 0&&(u=!1);const _=t.getBoundingClientRect(),S=unwrapElement(t);let R=createCoords(1);s&&(d?isElement(d)&&(R=getScale(d)):R=getScale(t));const a=shouldAddVisualOffsets(S,u,d)?getVisualOffsets(S):createCoords(0);let k=(_.left+a.x)/R.x,O=(_.top+a.y)/R.y,j=_.width/R.x,V=_.height/R.y;if(S){const G=getWindow(S),J=d&&isElement(d)?getWindow(d):d;let Z=G,Y=getFrameElement(Z);for(;Y&&d&&J!==Z;){const le=getScale(Y),ee=Y.getBoundingClientRect(),se=getComputedStyle$1(Y),Q=ee.left+(Y.clientLeft+parseFloat(se.paddingLeft))*le.x,oe=ee.top+(Y.clientTop+parseFloat(se.paddingTop))*le.y;k*=le.x,O*=le.y,j*=le.x,V*=le.y,k+=Q,O+=oe,Z=getWindow(Y),Y=getFrameElement(Z)}}return rectToClientRect({width:j,height:V,x:k,y:O})}function getWindowScrollBarX(t,s){const u=getNodeScroll(t).scrollLeft;return s?s.left+u:getBoundingClientRect(getDocumentElement(t)).left+u}function getHTMLOffset(t,s){const u=t.getBoundingClientRect(),d=u.left+s.scrollLeft-getWindowScrollBarX(t,u),_=u.top+s.scrollTop;return{x:d,y:_}}function convertOffsetParentRelativeRectToViewportRelativeRect(t){let{elements:s,rect:u,offsetParent:d,strategy:_}=t;const S=_==="fixed",R=getDocumentElement(d),a=s?isTopLayer(s.floating):!1;if(d===R||a&&S)return u;let k={scrollLeft:0,scrollTop:0},O=createCoords(1);const j=createCoords(0),V=isHTMLElement(d);if((V||!V&&!S)&&((getNodeName(d)!=="body"||isOverflowElement(R))&&(k=getNodeScroll(d)),isHTMLElement(d))){const J=getBoundingClientRect(d);O=getScale(d),j.x=J.x+d.clientLeft,j.y=J.y+d.clientTop}const G=R&&!V&&!S?getHTMLOffset(R,k):createCoords(0);return{width:u.width*O.x,height:u.height*O.y,x:u.x*O.x-k.scrollLeft*O.x+j.x+G.x,y:u.y*O.y-k.scrollTop*O.y+j.y+G.y}}function getClientRects(t){return Array.from(t.getClientRects())}function getDocumentRect(t){const s=getDocumentElement(t),u=getNodeScroll(t),d=t.ownerDocument.body,_=max(s.scrollWidth,s.clientWidth,d.scrollWidth,d.clientWidth),S=max(s.scrollHeight,s.clientHeight,d.scrollHeight,d.clientHeight);let R=-u.scrollLeft+getWindowScrollBarX(t);const a=-u.scrollTop;return getComputedStyle$1(d).direction==="rtl"&&(R+=max(s.clientWidth,d.clientWidth)-_),{width:_,height:S,x:R,y:a}}const SCROLLBAR_MAX=25;function getViewportRect(t,s){const u=getWindow(t),d=getDocumentElement(t),_=u.visualViewport;let S=d.clientWidth,R=d.clientHeight,a=0,k=0;if(_){S=_.width,R=_.height;const j=isWebKit();(!j||j&&s==="fixed")&&(a=_.offsetLeft,k=_.offsetTop)}const O=getWindowScrollBarX(d);if(O<=0){const j=d.ownerDocument,V=j.body,G=getComputedStyle(V),J=j.compatMode==="CSS1Compat"&&parseFloat(G.marginLeft)+parseFloat(G.marginRight)||0,Z=Math.abs(d.clientWidth-V.clientWidth-J);Z<=SCROLLBAR_MAX&&(S-=Z)}else O<=SCROLLBAR_MAX&&(S+=O);return{width:S,height:R,x:a,y:k}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(t,s){const u=getBoundingClientRect(t,!0,s==="fixed"),d=u.top+t.clientTop,_=u.left+t.clientLeft,S=isHTMLElement(t)?getScale(t):createCoords(1),R=t.clientWidth*S.x,a=t.clientHeight*S.y,k=_*S.x,O=d*S.y;return{width:R,height:a,x:k,y:O}}function getClientRectFromClippingAncestor(t,s,u){let d;if(s==="viewport")d=getViewportRect(t,u);else if(s==="document")d=getDocumentRect(getDocumentElement(t));else if(isElement(s))d=getInnerBoundingClientRect(s,u);else{const _=getVisualOffsets(t);d={x:s.x-_.x,y:s.y-_.y,width:s.width,height:s.height}}return rectToClientRect(d)}function hasFixedPositionAncestor(t,s){const u=getParentNode(t);return u===s||!isElement(u)||isLastTraversableNode(u)?!1:getComputedStyle$1(u).position==="fixed"||hasFixedPositionAncestor(u,s)}function getClippingElementAncestors(t,s){const u=s.get(t);if(u)return u;let d=getOverflowAncestors(t,[],!1).filter(a=>isElement(a)&&getNodeName(a)!=="body"),_=null;const S=getComputedStyle$1(t).position==="fixed";let R=S?getParentNode(t):t;for(;isElement(R)&&!isLastTraversableNode(R);){const a=getComputedStyle$1(R),k=isContainingBlock(R);!k&&a.position==="fixed"&&(_=null),(S?!k&&!_:!k&&a.position==="static"&&!!_&&absoluteOrFixed.has(_.position)||isOverflowElement(R)&&!k&&hasFixedPositionAncestor(t,R))?d=d.filter(j=>j!==R):_=a,R=getParentNode(R)}return s.set(t,d),d}function getClippingRect(t){let{element:s,boundary:u,rootBoundary:d,strategy:_}=t;const R=[...u==="clippingAncestors"?isTopLayer(s)?[]:getClippingElementAncestors(s,this._c):[].concat(u),d],a=R[0],k=R.reduce((O,j)=>{const V=getClientRectFromClippingAncestor(s,j,_);return O.top=max(V.top,O.top),O.right=min(V.right,O.right),O.bottom=min(V.bottom,O.bottom),O.left=max(V.left,O.left),O},getClientRectFromClippingAncestor(s,a,_));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function getDimensions(t){const{width:s,height:u}=getCssDimensions(t);return{width:s,height:u}}function getRectRelativeToOffsetParent(t,s,u){const d=isHTMLElement(s),_=getDocumentElement(s),S=u==="fixed",R=getBoundingClientRect(t,!0,S,s);let a={scrollLeft:0,scrollTop:0};const k=createCoords(0);function O(){k.x=getWindowScrollBarX(_)}if(d||!d&&!S)if((getNodeName(s)!=="body"||isOverflowElement(_))&&(a=getNodeScroll(s)),d){const J=getBoundingClientRect(s,!0,S,s);k.x=J.x+s.clientLeft,k.y=J.y+s.clientTop}else _&&O();S&&!d&&_&&O();const j=_&&!d&&!S?getHTMLOffset(_,a):createCoords(0),V=R.left+a.scrollLeft-k.x-j.x,G=R.top+a.scrollTop-k.y-j.y;return{x:V,y:G,width:R.width,height:R.height}}function isStaticPositioned(t){return getComputedStyle$1(t).position==="static"}function getTrueOffsetParent(t,s){if(!isHTMLElement(t)||getComputedStyle$1(t).position==="fixed")return null;if(s)return s(t);let u=t.offsetParent;return getDocumentElement(t)===u&&(u=u.ownerDocument.body),u}function getOffsetParent(t,s){const u=getWindow(t);if(isTopLayer(t))return u;if(!isHTMLElement(t)){let _=getParentNode(t);for(;_&&!isLastTraversableNode(_);){if(isElement(_)&&!isStaticPositioned(_))return _;_=getParentNode(_)}return u}let d=getTrueOffsetParent(t,s);for(;d&&isTableElement(d)&&isStaticPositioned(d);)d=getTrueOffsetParent(d,s);return d&&isLastTraversableNode(d)&&isStaticPositioned(d)&&!isContainingBlock(d)?u:d||getContainingBlock(t)||u}const getElementRects=async function(t){const s=this.getOffsetParent||getOffsetParent,u=this.getDimensions,d=await u(t.floating);return{reference:getRectRelativeToOffsetParent(t.reference,await s(t.floating),t.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function isRTL(t){return getComputedStyle$1(t).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function rectsAreEqual(t,s){return t.x===s.x&&t.y===s.y&&t.width===s.width&&t.height===s.height}function observeMove(t,s){let u=null,d;const _=getDocumentElement(t);function S(){var a;clearTimeout(d),(a=u)==null||a.disconnect(),u=null}function R(a,k){a===void 0&&(a=!1),k===void 0&&(k=1),S();const O=t.getBoundingClientRect(),{left:j,top:V,width:G,height:J}=O;if(a||s(),!G||!J)return;const Z=floor(V),Y=floor(_.clientWidth-(j+G)),le=floor(_.clientHeight-(V+J)),ee=floor(j),Q={rootMargin:-Z+"px "+-Y+"px "+-le+"px "+-ee+"px",threshold:max(0,min(1,k))||1};let oe=!0;function _e(Se){const ke=Se[0].intersectionRatio;if(ke!==k){if(!oe)return R();ke?R(!1,ke):d=setTimeout(()=>{R(!1,1e-7)},1e3)}ke===1&&!rectsAreEqual(O,t.getBoundingClientRect())&&R(),oe=!1}try{u=new IntersectionObserver(_e,{...Q,root:_.ownerDocument})}catch{u=new IntersectionObserver(_e,Q)}u.observe(t)}return R(!0),S}function autoUpdate(t,s,u,d){d===void 0&&(d={});const{ancestorScroll:_=!0,ancestorResize:S=!0,elementResize:R=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:k=!1}=d,O=unwrapElement(t),j=_||S?[...O?getOverflowAncestors(O):[],...getOverflowAncestors(s)]:[];j.forEach(ee=>{_&&ee.addEventListener("scroll",u,{passive:!0}),S&&ee.addEventListener("resize",u)});const V=O&&a?observeMove(O,u):null;let G=-1,J=null;R&&(J=new ResizeObserver(ee=>{let[se]=ee;se&&se.target===O&&J&&(J.unobserve(s),cancelAnimationFrame(G),G=requestAnimationFrame(()=>{var Q;(Q=J)==null||Q.observe(s)})),u()}),O&&!k&&J.observe(O),J.observe(s));let Z,Y=k?getBoundingClientRect(t):null;k&&le();function le(){const ee=getBoundingClientRect(t);Y&&!rectsAreEqual(Y,ee)&&u(),Y=ee,Z=requestAnimationFrame(le)}return u(),()=>{var ee;j.forEach(se=>{_&&se.removeEventListener("scroll",u),S&&se.removeEventListener("resize",u)}),V==null||V(),(ee=J)==null||ee.disconnect(),J=null,k&&cancelAnimationFrame(Z)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(t,s,u)=>{const d=new Map,_={platform,...u},S={..._.platform,_c:d};return computePosition$1(t,s,{..._,platform:S})};var isClient=typeof document<"u",noop=function t(){},index=isClient?reactExports.useLayoutEffect:noop;function deepEqual(t,s){if(t===s)return!0;if(typeof t!=typeof s)return!1;if(typeof t=="function"&&t.toString()===s.toString())return!0;let u,d,_;if(t&&s&&typeof t=="object"){if(Array.isArray(t)){if(u=t.length,u!==s.length)return!1;for(d=u;d--!==0;)if(!deepEqual(t[d],s[d]))return!1;return!0}if(_=Object.keys(t),u=_.length,u!==Object.keys(s).length)return!1;for(d=u;d--!==0;)if(!{}.hasOwnProperty.call(s,_[d]))return!1;for(d=u;d--!==0;){const S=_[d];if(!(S==="_owner"&&t.$$typeof)&&!deepEqual(t[S],s[S]))return!1}return!0}return t!==t&&s!==s}function getDPR(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(t,s){const u=getDPR(t);return Math.round(s*u)/u}function useLatestRef(t){const s=reactExports.useRef(t);return index(()=>{s.current=t}),s}function useFloating(t){t===void 0&&(t={});const{placement:s="bottom",strategy:u="absolute",middleware:d=[],platform:_,elements:{reference:S,floating:R}={},transform:a=!0,whileElementsMounted:k,open:O}=t,[j,V]=reactExports.useState({x:0,y:0,strategy:u,placement:s,middlewareData:{},isPositioned:!1}),[G,J]=reactExports.useState(d);deepEqual(G,d)||J(d);const[Z,Y]=reactExports.useState(null),[le,ee]=reactExports.useState(null),se=reactExports.useCallback(pe=>{pe!==Se.current&&(Se.current=pe,Y(pe))},[]),Q=reactExports.useCallback(pe=>{pe!==ke.current&&(ke.current=pe,ee(pe))},[]),oe=S||Z,_e=R||le,Se=reactExports.useRef(null),ke=reactExports.useRef(null),Le=reactExports.useRef(j),lt=k!=null,qt=useLatestRef(k),Yt=useLatestRef(_),Ot=useLatestRef(O),Bt=reactExports.useCallback(()=>{if(!Se.current||!ke.current)return;const pe={placement:s,strategy:u,middleware:G};Yt.current&&(pe.platform=Yt.current),computePosition(Se.current,ke.current,pe).then(Te=>{const st={...Te,isPositioned:Ot.current!==!1};si.current&&!deepEqual(Le.current,st)&&(Le.current=st,reactDomExports.flushSync(()=>{V(st)}))})},[G,s,u,Yt,Ot]);index(()=>{O===!1&&Le.current.isPositioned&&(Le.current.isPositioned=!1,V(pe=>({...pe,isPositioned:!1})))},[O]);const si=reactExports.useRef(!1);index(()=>(si.current=!0,()=>{si.current=!1}),[]),index(()=>{if(oe&&(Se.current=oe),_e&&(ke.current=_e),oe&&_e){if(qt.current)return qt.current(oe,_e,Bt);Bt()}},[oe,_e,Bt,qt,lt]);const kt=reactExports.useMemo(()=>({reference:Se,floating:ke,setReference:se,setFloating:Q}),[se,Q]),xe=reactExports.useMemo(()=>({reference:oe,floating:_e}),[oe,_e]),Fe=reactExports.useMemo(()=>{const pe={position:u,left:0,top:0};if(!xe.floating)return pe;const Te=roundByDPR(xe.floating,j.x),st=roundByDPR(xe.floating,j.y);return a?{...pe,transform:"translate("+Te+"px, "+st+"px)",...getDPR(xe.floating)>=1.5&&{willChange:"transform"}}:{position:u,left:Te,top:st}},[u,a,xe.floating,j.x,j.y]);return reactExports.useMemo(()=>({...j,update:Bt,refs:kt,elements:xe,floatingStyles:Fe}),[j,Bt,kt,xe,Fe])}const arrow$1=t=>{function s(u){return{}.hasOwnProperty.call(u,"current")}return{name:"arrow",options:t,fn(u){const{element:d,padding:_}=typeof t=="function"?t(u):t;return d&&s(d)?d.current!=null?arrow$2({element:d.current,padding:_}).fn(u):{}:d?arrow$2({element:d,padding:_}).fn(u):{}}}},offset=(t,s)=>({...offset$1(t),options:[t,s]}),shift=(t,s)=>({...shift$1(t),options:[t,s]}),limitShift=(t,s)=>({...limitShift$1(t),options:[t,s]}),flip=(t,s)=>({...flip$1(t),options:[t,s]}),size=(t,s)=>({...size$1(t),options:[t,s]}),hide=(t,s)=>({...hide$1(t),options:[t,s]}),arrow=(t,s)=>({...arrow$1(t),options:[t,s]});function createSlot$5(t){const s=createSlotClone$5(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$5);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$5(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$5(_),a=mergeProps$5(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$5=Symbol("radix.slottable");function isSlottable$5(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$5}function mergeProps$5(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$5(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$5=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$5=NODES$5.reduce((t,s)=>{const u=createSlot$5(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),NAME="Arrow",Arrow$1=reactExports.forwardRef((t,s)=>{const{children:u,width:d=10,height:_=5,...S}=t;return jsxRuntimeExports.jsx(Primitive$5.svg,{...S,ref:s,width:d,height:_,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?u:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME;var Root=Arrow$1;function createContextScope$2(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$2(_,...s)]}function composeContextScopes$2(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$4(t){const s=createSlotClone$4(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$4);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$4(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$4(_),a=mergeProps$4(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$4=Symbol("radix.slottable");function isSlottable$4(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$4}function mergeProps$4(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$4(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$4=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$4=NODES$4.reduce((t,s)=>{const u=createSlot$4(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope$2(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),Popper=t=>{const{__scopePopper:s,children:u}=t,[d,_]=reactExports.useState(null);return jsxRuntimeExports.jsx(PopperProvider,{scope:s,anchor:d,onAnchorChange:_,children:u})};Popper.displayName=POPPER_NAME;var ANCHOR_NAME$1="PopperAnchor",PopperAnchor=reactExports.forwardRef((t,s)=>{const{__scopePopper:u,virtualRef:d,..._}=t,S=usePopperContext(ANCHOR_NAME$1,u),R=reactExports.useRef(null),a=useComposedRefs(s,R),k=reactExports.useRef(null);return reactExports.useEffect(()=>{const O=k.current;k.current=(d==null?void 0:d.current)||R.current,O!==k.current&&S.onAnchorChange(k.current)}),d?null:jsxRuntimeExports.jsx(Primitive$4.div,{..._,ref:a})});PopperAnchor.displayName=ANCHOR_NAME$1;var CONTENT_NAME$3="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$3),PopperContent=reactExports.forwardRef((t,s)=>{var bi,zi,vi,Gi,lr,zr;const{__scopePopper:u,side:d="bottom",sideOffset:_=0,align:S="center",alignOffset:R=0,arrowPadding:a=0,avoidCollisions:k=!0,collisionBoundary:O=[],collisionPadding:j=0,sticky:V="partial",hideWhenDetached:G=!1,updatePositionStrategy:J="optimized",onPlaced:Z,...Y}=t,le=usePopperContext(CONTENT_NAME$3,u),[ee,se]=reactExports.useState(null),Q=useComposedRefs(s,Ui=>se(Ui)),[oe,_e]=reactExports.useState(null),Se=useSize(oe),ke=(Se==null?void 0:Se.width)??0,Le=(Se==null?void 0:Se.height)??0,lt=d+(S!=="center"?"-"+S:""),qt=typeof j=="number"?j:{top:0,right:0,bottom:0,left:0,...j},Yt=Array.isArray(O)?O:[O],Ot=Yt.length>0,Bt={padding:qt,boundary:Yt.filter(isNotNull),altBoundary:Ot},{refs:si,floatingStyles:kt,placement:xe,isPositioned:Fe,middlewareData:pe}=useFloating({strategy:"fixed",placement:lt,whileElementsMounted:(...Ui)=>autoUpdate(...Ui,{animationFrame:J==="always"}),elements:{reference:le.anchor},middleware:[offset({mainAxis:_+Le,alignmentAxis:R}),k&&shift({mainAxis:!0,crossAxis:!1,limiter:V==="partial"?limitShift():void 0,...Bt}),k&&flip({...Bt}),size({...Bt,apply:({elements:Ui,rects:Ci,availableWidth:Gn,availableHeight:Wn})=>{const{width:vn,height:Sr}=Ci.reference,Xr=Ui.floating.style;Xr.setProperty("--radix-popper-available-width",`${Gn}px`),Xr.setProperty("--radix-popper-available-height",`${Wn}px`),Xr.setProperty("--radix-popper-anchor-width",`${vn}px`),Xr.setProperty("--radix-popper-anchor-height",`${Sr}px`)}}),oe&&arrow({element:oe,padding:a}),transformOrigin({arrowWidth:ke,arrowHeight:Le}),G&&hide({strategy:"referenceHidden",...Bt})]}),[Te,st]=getSideAndAlignFromPlacement(xe),Me=useCallbackRef$1(Z);useLayoutEffect2(()=>{Fe&&(Me==null||Me())},[Fe,Me]);const at=(bi=pe.arrow)==null?void 0:bi.x,ct=(zi=pe.arrow)==null?void 0:zi.y,Ct=((vi=pe.arrow)==null?void 0:vi.centerOffset)!==0,[li,mi]=reactExports.useState();return useLayoutEffect2(()=>{ee&&mi(window.getComputedStyle(ee).zIndex)},[ee]),jsxRuntimeExports.jsx("div",{ref:si.setFloating,"data-radix-popper-content-wrapper":"",style:{...kt,transform:Fe?kt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:li,"--radix-popper-transform-origin":[(Gi=pe.transformOrigin)==null?void 0:Gi.x,(lr=pe.transformOrigin)==null?void 0:lr.y].join(" "),...((zr=pe.hide)==null?void 0:zr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:u,placedSide:Te,onArrowChange:_e,arrowX:at,arrowY:ct,shouldHideArrow:Ct,children:jsxRuntimeExports.jsx(Primitive$4.div,{"data-side":Te,"data-align":st,...Y,ref:Q,style:{...Y.style,animation:Fe?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$3;var ARROW_NAME$2="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function t(s,u){const{__scopePopper:d,..._}=s,S=useContentContext(ARROW_NAME$2,d),R=OPPOSITE_SIDE[S.placedSide];return jsxRuntimeExports.jsx("span",{ref:S.onArrowChange,style:{position:"absolute",left:S.arrowX,top:S.arrowY,[R]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[S.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[S.placedSide],visibility:S.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root,{..._,ref:u,style:{..._.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$2;function isNotNull(t){return t!==null}var transformOrigin=t=>({name:"transformOrigin",options:t,fn(s){var le,ee,se;const{placement:u,rects:d,middlewareData:_}=s,R=((le=_.arrow)==null?void 0:le.centerOffset)!==0,a=R?0:t.arrowWidth,k=R?0:t.arrowHeight,[O,j]=getSideAndAlignFromPlacement(u),V={start:"0%",center:"50%",end:"100%"}[j],G=(((ee=_.arrow)==null?void 0:ee.x)??0)+a/2,J=(((se=_.arrow)==null?void 0:se.y)??0)+k/2;let Z="",Y="";return O==="bottom"?(Z=R?V:`${G}px`,Y=`${-k}px`):O==="top"?(Z=R?V:`${G}px`,Y=`${d.floating.height+k}px`):O==="right"?(Z=`${-k}px`,Y=R?V:`${J}px`):O==="left"&&(Z=`${d.floating.width+k}px`,Y=R?V:`${J}px`),{data:{x:Z,y:Y}}}});function getSideAndAlignFromPlacement(t){const[s,u="center"]=t.split("-");return[s,u]}var Root2$2=Popper,Anchor=PopperAnchor,Content$1=PopperContent,Arrow=PopperArrow;function createSlot$3(t){const s=createSlotClone$3(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$3);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$3(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$3(_),a=mergeProps$3(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$3=Symbol("radix.slottable");function isSlottable$3(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$3}function mergeProps$3(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$3(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$3=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$3=NODES$3.reduce((t,s)=>{const u=createSlot$3(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),PORTAL_NAME$2="Portal",Portal$1=reactExports.forwardRef((t,s)=>{var a;const{container:u,...d}=t,[_,S]=reactExports.useState(!1);useLayoutEffect2(()=>S(!0),[]);const R=u||_&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return R?ReactDOM.createPortal(jsxRuntimeExports.jsx(Primitive$3.div,{...d,ref:s}),R):null});Portal$1.displayName=PORTAL_NAME$2;function createSlot$2(t){const s=createSlotClone$2(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$2);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$2(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$2(_),a=mergeProps$2(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$2=Symbol("radix.slottable");function isSlottable$2(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$2}function mergeProps$2(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$2(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$2=NODES$2.reduce((t,s)=>{const u=createSlot$2(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{});function dispatchDiscreteCustomEvent(t,s){t&&reactDomExports.flushSync(()=>t.dispatchEvent(s))}var getDefaultParent=function(t){if(typeof document>"u")return null;var s=Array.isArray(t)?t[0]:t;return s.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(t){return t&&(t.host||unwrapHost(t.parentNode))},correctTargets=function(t,s){return s.map(function(u){if(t.contains(u))return u;var d=unwrapHost(u);return d&&t.contains(d)?d:(console.error("aria-hidden",u,"in not contained inside",t,". Doing nothing"),null)}).filter(function(u){return!!u})},applyAttributeToOthers=function(t,s,u,d){var _=correctTargets(s,Array.isArray(t)?t:[t]);markerMap[u]||(markerMap[u]=new WeakMap);var S=markerMap[u],R=[],a=new Set,k=new Set(_),O=function(V){!V||a.has(V)||(a.add(V),O(V.parentNode))};_.forEach(O);var j=function(V){!V||k.has(V)||Array.prototype.forEach.call(V.children,function(G){if(a.has(G))j(G);else try{var J=G.getAttribute(d),Z=J!==null&&J!=="false",Y=(counterMap.get(G)||0)+1,le=(S.get(G)||0)+1;counterMap.set(G,Y),S.set(G,le),R.push(G),Y===1&&Z&&uncontrolledNodes.set(G,!0),le===1&&G.setAttribute(u,"true"),Z||G.setAttribute(d,"true")}catch(ee){console.error("aria-hidden: cannot operate on ",G,ee)}})};return j(s),a.clear(),lockCount++,function(){R.forEach(function(V){var G=counterMap.get(V)-1,J=S.get(V)-1;counterMap.set(V,G),S.set(V,J),G||(uncontrolledNodes.has(V)||V.removeAttribute(d),uncontrolledNodes.delete(V)),J||V.removeAttribute(u)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(t,s,u){u===void 0&&(u="data-aria-hidden");var d=Array.from(Array.isArray(t)?t:[t]),_=getDefaultParent(t);return _?(d.push.apply(d,Array.from(_.querySelectorAll("[aria-live], script"))),applyAttributeToOthers(d,_,u,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(s){for(var u,d=1,_=arguments.length;d<_;d++){u=arguments[d];for(var S in u)Object.prototype.hasOwnProperty.call(u,S)&&(s[S]=u[S])}return s},__assign.apply(this,arguments)};function __rest(t,s){var u={};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&s.indexOf(d)<0&&(u[d]=t[d]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,d=Object.getOwnPropertySymbols(t);_<d.length;_++)s.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(t,d[_])&&(u[d[_]]=t[d[_]]);return u}function __spreadArray(t,s,u){if(u||arguments.length===2)for(var d=0,_=s.length,S;d<_;d++)(S||!(d in s))&&(S||(S=Array.prototype.slice.call(s,0,d)),S[d]=s[d]);return t.concat(S||Array.prototype.slice.call(s))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(t,s){return typeof t=="function"?t(s):t&&(t.current=s),t}function useCallbackRef(t,s){var u=reactExports.useState(function(){return{value:t,callback:s,facade:{get current(){return u.value},set current(d){var _=u.value;_!==d&&(u.value=d,u.callback(d,_))}}}})[0];return u.callback=s,u.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(t,s){var u=useCallbackRef(null,function(d){return t.forEach(function(_){return assignRef(_,d)})});return useIsomorphicLayoutEffect(function(){var d=currentValues.get(u);if(d){var _=new Set(d),S=new Set(t),R=u.current;_.forEach(function(a){S.has(a)||assignRef(a,null)}),S.forEach(function(a){_.has(a)||assignRef(a,R)})}currentValues.set(u,t)},[t]),u}function ItoI(t){return t}function innerCreateMedium(t,s){s===void 0&&(s=ItoI);var u=[],d=!1,_={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return u.length?u[u.length-1]:t},useMedium:function(S){var R=s(S,d);return u.push(R),function(){u=u.filter(function(a){return a!==R})}},assignSyncMedium:function(S){for(d=!0;u.length;){var R=u;u=[],R.forEach(S)}u={push:function(a){return S(a)},filter:function(){return u}}},assignMedium:function(S){d=!0;var R=[];if(u.length){var a=u;u=[],a.forEach(S),R=u}var k=function(){var j=R;R=[],j.forEach(S)},O=function(){return Promise.resolve().then(k)};O(),u={push:function(j){R.push(j),O()},filter:function(j){return R=R.filter(j),u}}}};return _}function createSidecarMedium(t){t===void 0&&(t={});var s=innerCreateMedium(null);return s.options=__assign({async:!0,ssr:!1},t),s}var SideCar$1=function(t){var s=t.sideCar,u=__rest(t,["sideCar"]);if(!s)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=s.read();if(!d)throw new Error("Sidecar medium not found");return reactExports.createElement(d,__assign({},u))};SideCar$1.isSideCarExport=!0;function exportSidecar(t,s){return t.useMedium(s),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(t,s){var u=reactExports.useRef(null),d=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),_=d[0],S=d[1],R=t.forwardProps,a=t.children,k=t.className,O=t.removeScrollBar,j=t.enabled,V=t.shards,G=t.sideCar,J=t.noRelative,Z=t.noIsolation,Y=t.inert,le=t.allowPinchZoom,ee=t.as,se=ee===void 0?"div":ee,Q=t.gapMode,oe=__rest(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_e=G,Se=useMergeRefs([u,s]),ke=__assign(__assign({},oe),_);return reactExports.createElement(reactExports.Fragment,null,j&&reactExports.createElement(_e,{sideCar:effectCar,removeScrollBar:O,shards:V,noRelative:J,noIsolation:Z,inert:Y,setCallbacks:S,allowPinchZoom:!!le,lockRef:u,gapMode:Q}),R?reactExports.cloneElement(reactExports.Children.only(a),__assign(__assign({},ke),{ref:Se})):reactExports.createElement(se,__assign({},ke,{className:k,ref:Se}),a))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var s=getNonce();return s&&t.setAttribute("nonce",s),t}function injectStyles(t,s){t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s))}function insertStyleTag(t){var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(t)}var stylesheetSingleton=function(){var t=0,s=null;return{add:function(u){t==0&&(s=makeStyleTag())&&(injectStyles(s,u),insertStyleTag(s)),t++},remove:function(){t--,!t&&s&&(s.parentNode&&s.parentNode.removeChild(s),s=null)}}},styleHookSingleton=function(){var t=stylesheetSingleton();return function(s,u){reactExports.useEffect(function(){return t.add(s),function(){t.remove()}},[s&&u])}},styleSingleton=function(){var t=styleHookSingleton(),s=function(u){var d=u.styles,_=u.dynamic;return t(d,_),null};return s},zeroGap={left:0,top:0,right:0,gap:0},parse=function(t){return parseInt(t||"",10)||0},getOffset=function(t){var s=window.getComputedStyle(document.body),u=s[t==="padding"?"paddingLeft":"marginLeft"],d=s[t==="padding"?"paddingTop":"marginTop"],_=s[t==="padding"?"paddingRight":"marginRight"];return[parse(u),parse(d),parse(_)]},getGapWidth=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return zeroGap;var s=getOffset(t),u=document.documentElement.clientWidth,d=window.innerWidth;return{left:s[0],top:s[1],right:s[2],gap:Math.max(0,d-u+s[2]-s[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(t,s,u,d){var _=t.left,S=t.top,R=t.right,a=t.gap;return u===void 0&&(u="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(a,"px ").concat(d,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([s&&"position: relative ".concat(d,";"),u==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat(S,`px;
    padding-right: `).concat(R,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(d,`;
    `),u==="padding"&&"padding-right: ".concat(a,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(a,"px ").concat(d,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(a,"px ").concat(d,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(a,`px;
  }
`)},getCurrentUseCounter=function(){var t=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(t)?t:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var t=getCurrentUseCounter()-1;t<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,t.toString())}},[])},RemoveScrollBar=function(t){var s=t.noRelative,u=t.noImportant,d=t.gapMode,_=d===void 0?"margin":d;useLockAttribute();var S=reactExports.useMemo(function(){return getGapWidth(_)},[_]);return reactExports.createElement(Style,{styles:getStyles(S,!s,_,u?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(t){return t.tagName==="TEXTAREA"},elementCanBeScrolled=function(t,s){if(!(t instanceof Element))return!1;var u=window.getComputedStyle(t);return u[s]!=="hidden"&&!(u.overflowY===u.overflowX&&!alwaysContainsScroll(t)&&u[s]==="visible")},elementCouldBeVScrolled=function(t){return elementCanBeScrolled(t,"overflowY")},elementCouldBeHScrolled=function(t){return elementCanBeScrolled(t,"overflowX")},locationCouldBeScrolled=function(t,s){var u=s.ownerDocument,d=s;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var _=elementCouldBeScrolled(t,d);if(_){var S=getScrollVariables(t,d),R=S[1],a=S[2];if(R>a)return!0}d=d.parentNode}while(d&&d!==u.body);return!1},getVScrollVariables=function(t){var s=t.scrollTop,u=t.scrollHeight,d=t.clientHeight;return[s,u,d]},getHScrollVariables=function(t){var s=t.scrollLeft,u=t.scrollWidth,d=t.clientWidth;return[s,u,d]},elementCouldBeScrolled=function(t,s){return t==="v"?elementCouldBeVScrolled(s):elementCouldBeHScrolled(s)},getScrollVariables=function(t,s){return t==="v"?getVScrollVariables(s):getHScrollVariables(s)},getDirectionFactor=function(t,s){return t==="h"&&s==="rtl"?-1:1},handleScroll=function(t,s,u,d,_){var S=getDirectionFactor(t,window.getComputedStyle(s).direction),R=S*d,a=u.target,k=s.contains(a),O=!1,j=R>0,V=0,G=0;do{if(!a)break;var J=getScrollVariables(t,a),Z=J[0],Y=J[1],le=J[2],ee=Y-le-S*Z;(Z||ee)&&elementCouldBeScrolled(t,a)&&(V+=ee,G+=Z);var se=a.parentNode;a=se&&se.nodeType===Node.DOCUMENT_FRAGMENT_NODE?se.host:se}while(!k&&a!==document.body||k&&(s.contains(a)||s===a));return(j&&Math.abs(V)<1||!j&&Math.abs(G)<1)&&(O=!0),O},getTouchXY=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(t){return[t.deltaX,t.deltaY]},extractRef=function(t){return t&&"current"in t?t.current:t},deltaCompare=function(t,s){return t[0]===s[0]&&t[1]===s[1]},generateStyle=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(t){var s=reactExports.useRef([]),u=reactExports.useRef([0,0]),d=reactExports.useRef(),_=reactExports.useState(idCounter++)[0],S=reactExports.useState(styleSingleton)[0],R=reactExports.useRef(t);reactExports.useEffect(function(){R.current=t},[t]),reactExports.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(_));var Y=__spreadArray([t.lockRef.current],(t.shards||[]).map(extractRef),!0).filter(Boolean);return Y.forEach(function(le){return le.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),Y.forEach(function(le){return le.classList.remove("allow-interactivity-".concat(_))})}}},[t.inert,t.lockRef.current,t.shards]);var a=reactExports.useCallback(function(Y,le){if("touches"in Y&&Y.touches.length===2||Y.type==="wheel"&&Y.ctrlKey)return!R.current.allowPinchZoom;var ee=getTouchXY(Y),se=u.current,Q="deltaX"in Y?Y.deltaX:se[0]-ee[0],oe="deltaY"in Y?Y.deltaY:se[1]-ee[1],_e,Se=Y.target,ke=Math.abs(Q)>Math.abs(oe)?"h":"v";if("touches"in Y&&ke==="h"&&Se.type==="range")return!1;var Le=window.getSelection(),lt=Le&&Le.anchorNode,qt=lt?lt===Se||lt.contains(Se):!1;if(qt)return!1;var Yt=locationCouldBeScrolled(ke,Se);if(!Yt)return!0;if(Yt?_e=ke:(_e=ke==="v"?"h":"v",Yt=locationCouldBeScrolled(ke,Se)),!Yt)return!1;if(!d.current&&"changedTouches"in Y&&(Q||oe)&&(d.current=_e),!_e)return!0;var Ot=d.current||_e;return handleScroll(Ot,le,Y,Ot==="h"?Q:oe)},[]),k=reactExports.useCallback(function(Y){var le=Y;if(!(!lockStack.length||lockStack[lockStack.length-1]!==S)){var ee="deltaY"in le?getDeltaXY(le):getTouchXY(le),se=s.current.filter(function(_e){return _e.name===le.type&&(_e.target===le.target||le.target===_e.shadowParent)&&deltaCompare(_e.delta,ee)})[0];if(se&&se.should){le.cancelable&&le.preventDefault();return}if(!se){var Q=(R.current.shards||[]).map(extractRef).filter(Boolean).filter(function(_e){return _e.contains(le.target)}),oe=Q.length>0?a(le,Q[0]):!R.current.noIsolation;oe&&le.cancelable&&le.preventDefault()}}},[]),O=reactExports.useCallback(function(Y,le,ee,se){var Q={name:Y,delta:le,target:ee,should:se,shadowParent:getOutermostShadowParent(ee)};s.current.push(Q),setTimeout(function(){s.current=s.current.filter(function(oe){return oe!==Q})},1)},[]),j=reactExports.useCallback(function(Y){u.current=getTouchXY(Y),d.current=void 0},[]),V=reactExports.useCallback(function(Y){O(Y.type,getDeltaXY(Y),Y.target,a(Y,t.lockRef.current))},[]),G=reactExports.useCallback(function(Y){O(Y.type,getTouchXY(Y),Y.target,a(Y,t.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(S),t.setCallbacks({onScrollCapture:V,onWheelCapture:V,onTouchMoveCapture:G}),document.addEventListener("wheel",k,nonPassive),document.addEventListener("touchmove",k,nonPassive),document.addEventListener("touchstart",j,nonPassive),function(){lockStack=lockStack.filter(function(Y){return Y!==S}),document.removeEventListener("wheel",k,nonPassive),document.removeEventListener("touchmove",k,nonPassive),document.removeEventListener("touchstart",j,nonPassive)}},[]);var J=t.removeScrollBar,Z=t.inert;return reactExports.createElement(reactExports.Fragment,null,Z?reactExports.createElement(S,{styles:generateStyle(_)}):null,J?reactExports.createElement(RemoveScrollBar,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function getOutermostShadowParent(t){for(var s=null;t!==null;)t instanceof ShadowRoot&&(s=t.host,t=t.host),t=t.parentNode;return s}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(t,s){return reactExports.createElement(RemoveScroll,__assign({},t,{ref:s,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;var SELECTION_KEYS=["Enter"," "],FIRST_KEYS=["ArrowDown","PageUp","Home"],LAST_KEYS=["ArrowUp","PageDown","End"],FIRST_LAST_KEYS=[...FIRST_KEYS,...LAST_KEYS],SUB_OPEN_KEYS={ltr:[...SELECTION_KEYS,"ArrowRight"],rtl:[...SELECTION_KEYS,"ArrowLeft"]},SUB_CLOSE_KEYS={ltr:["ArrowLeft"],rtl:["ArrowRight"]},MENU_NAME="Menu",[Collection,useCollection,createCollectionScope]=createCollection(MENU_NAME),[createMenuContext,createMenuScope]=createContextScope$3(MENU_NAME,[createCollectionScope,createPopperScope,createRovingFocusGroupScope]),usePopperScope=createPopperScope(),useRovingFocusGroupScope$1=createRovingFocusGroupScope(),[MenuProvider,useMenuContext]=createMenuContext(MENU_NAME),[MenuRootProvider,useMenuRootContext]=createMenuContext(MENU_NAME),Menu=t=>{const{__scopeMenu:s,open:u=!1,children:d,dir:_,onOpenChange:S,modal:R=!0}=t,a=usePopperScope(s),[k,O]=reactExports.useState(null),j=reactExports.useRef(!1),V=useCallbackRef$1(S),G=useDirection(_);return reactExports.useEffect(()=>{const J=()=>{j.current=!0,document.addEventListener("pointerdown",Z,{capture:!0,once:!0}),document.addEventListener("pointermove",Z,{capture:!0,once:!0})},Z=()=>j.current=!1;return document.addEventListener("keydown",J,{capture:!0}),()=>{document.removeEventListener("keydown",J,{capture:!0}),document.removeEventListener("pointerdown",Z,{capture:!0}),document.removeEventListener("pointermove",Z,{capture:!0})}},[]),jsxRuntimeExports.jsx(Root2$2,{...a,children:jsxRuntimeExports.jsx(MenuProvider,{scope:s,open:u,onOpenChange:V,content:k,onContentChange:O,children:jsxRuntimeExports.jsx(MenuRootProvider,{scope:s,onClose:reactExports.useCallback(()=>V(!1),[V]),isUsingKeyboardRef:j,dir:G,modal:R,children:d})})})};Menu.displayName=MENU_NAME;var ANCHOR_NAME="MenuAnchor",MenuAnchor=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,...d}=t,_=usePopperScope(u);return jsxRuntimeExports.jsx(Anchor,{..._,...d,ref:s})});MenuAnchor.displayName=ANCHOR_NAME;var PORTAL_NAME$1="MenuPortal",[PortalProvider,usePortalContext]=createMenuContext(PORTAL_NAME$1,{forceMount:void 0}),MenuPortal=t=>{const{__scopeMenu:s,forceMount:u,children:d,container:_}=t,S=useMenuContext(PORTAL_NAME$1,s);return jsxRuntimeExports.jsx(PortalProvider,{scope:s,forceMount:u,children:jsxRuntimeExports.jsx(Presence,{present:u||S.open,children:jsxRuntimeExports.jsx(Portal$1,{asChild:!0,container:_,children:d})})})};MenuPortal.displayName=PORTAL_NAME$1;var CONTENT_NAME$2="MenuContent",[MenuContentProvider,useMenuContentContext]=createMenuContext(CONTENT_NAME$2),MenuContent=reactExports.forwardRef((t,s)=>{const u=usePortalContext(CONTENT_NAME$2,t.__scopeMenu),{forceMount:d=u.forceMount,..._}=t,S=useMenuContext(CONTENT_NAME$2,t.__scopeMenu),R=useMenuRootContext(CONTENT_NAME$2,t.__scopeMenu);return jsxRuntimeExports.jsx(Collection.Provider,{scope:t.__scopeMenu,children:jsxRuntimeExports.jsx(Presence,{present:d||S.open,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:t.__scopeMenu,children:R.modal?jsxRuntimeExports.jsx(MenuRootContentModal,{..._,ref:s}):jsxRuntimeExports.jsx(MenuRootContentNonModal,{..._,ref:s})})})})}),MenuRootContentModal=reactExports.forwardRef((t,s)=>{const u=useMenuContext(CONTENT_NAME$2,t.__scopeMenu),d=reactExports.useRef(null),_=useComposedRefs(s,d);return reactExports.useEffect(()=>{const S=d.current;if(S)return hideOthers(S)},[]),jsxRuntimeExports.jsx(MenuContentImpl,{...t,ref:_,trapFocus:u.open,disableOutsidePointerEvents:u.open,disableOutsideScroll:!0,onFocusOutside:composeEventHandlers(t.onFocusOutside,S=>S.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>u.onOpenChange(!1)})}),MenuRootContentNonModal=reactExports.forwardRef((t,s)=>{const u=useMenuContext(CONTENT_NAME$2,t.__scopeMenu);return jsxRuntimeExports.jsx(MenuContentImpl,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>u.onOpenChange(!1)})}),Slot=createSlot$2("MenuContent.ScrollLock"),MenuContentImpl=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,loop:d=!1,trapFocus:_,onOpenAutoFocus:S,onCloseAutoFocus:R,disableOutsidePointerEvents:a,onEntryFocus:k,onEscapeKeyDown:O,onPointerDownOutside:j,onFocusOutside:V,onInteractOutside:G,onDismiss:J,disableOutsideScroll:Z,...Y}=t,le=useMenuContext(CONTENT_NAME$2,u),ee=useMenuRootContext(CONTENT_NAME$2,u),se=usePopperScope(u),Q=useRovingFocusGroupScope$1(u),oe=useCollection(u),[_e,Se]=reactExports.useState(null),ke=reactExports.useRef(null),Le=useComposedRefs(s,ke,le.onContentChange),lt=reactExports.useRef(0),qt=reactExports.useRef(""),Yt=reactExports.useRef(0),Ot=reactExports.useRef(null),Bt=reactExports.useRef("right"),si=reactExports.useRef(0),kt=Z?ReactRemoveScroll:reactExports.Fragment,xe=Z?{as:Slot,allowPinchZoom:!0}:void 0,Fe=Te=>{var bi,zi;const st=qt.current+Te,Me=oe().filter(vi=>!vi.disabled),at=document.activeElement,ct=(bi=Me.find(vi=>vi.ref.current===at))==null?void 0:bi.textValue,Ct=Me.map(vi=>vi.textValue),li=getNextMatch(Ct,st,ct),mi=(zi=Me.find(vi=>vi.textValue===li))==null?void 0:zi.ref.current;(function vi(Gi){qt.current=Gi,window.clearTimeout(lt.current),Gi!==""&&(lt.current=window.setTimeout(()=>vi(""),1e3))})(st),mi&&setTimeout(()=>mi.focus())};reactExports.useEffect(()=>()=>window.clearTimeout(lt.current),[]),useFocusGuards();const pe=reactExports.useCallback(Te=>{var Me,at;return Bt.current===((Me=Ot.current)==null?void 0:Me.side)&&isPointerInGraceArea(Te,(at=Ot.current)==null?void 0:at.area)},[]);return jsxRuntimeExports.jsx(MenuContentProvider,{scope:u,searchRef:qt,onItemEnter:reactExports.useCallback(Te=>{pe(Te)&&Te.preventDefault()},[pe]),onItemLeave:reactExports.useCallback(Te=>{var st;pe(Te)||((st=ke.current)==null||st.focus(),Se(null))},[pe]),onTriggerLeave:reactExports.useCallback(Te=>{pe(Te)&&Te.preventDefault()},[pe]),pointerGraceTimerRef:Yt,onPointerGraceIntentChange:reactExports.useCallback(Te=>{Ot.current=Te},[]),children:jsxRuntimeExports.jsx(kt,{...xe,children:jsxRuntimeExports.jsx(FocusScope,{asChild:!0,trapped:_,onMountAutoFocus:composeEventHandlers(S,Te=>{var st;Te.preventDefault(),(st=ke.current)==null||st.focus({preventScroll:!0})}),onUnmountAutoFocus:R,children:jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:O,onPointerDownOutside:j,onFocusOutside:V,onInteractOutside:G,onDismiss:J,children:jsxRuntimeExports.jsx(Root$1,{asChild:!0,...Q,dir:ee.dir,orientation:"vertical",loop:d,currentTabStopId:_e,onCurrentTabStopIdChange:Se,onEntryFocus:composeEventHandlers(k,Te=>{ee.isUsingKeyboardRef.current||Te.preventDefault()}),preventScrollOnEntryFocus:!0,children:jsxRuntimeExports.jsx(Content$1,{role:"menu","aria-orientation":"vertical","data-state":getOpenState(le.open),"data-radix-menu-content":"",dir:ee.dir,...se,...Y,ref:Le,style:{outline:"none",...Y.style},onKeyDown:composeEventHandlers(Y.onKeyDown,Te=>{const Me=Te.target.closest("[data-radix-menu-content]")===Te.currentTarget,at=Te.ctrlKey||Te.altKey||Te.metaKey,ct=Te.key.length===1;Me&&(Te.key==="Tab"&&Te.preventDefault(),!at&&ct&&Fe(Te.key));const Ct=ke.current;if(Te.target!==Ct||!FIRST_LAST_KEYS.includes(Te.key))return;Te.preventDefault();const mi=oe().filter(bi=>!bi.disabled).map(bi=>bi.ref.current);LAST_KEYS.includes(Te.key)&&mi.reverse(),focusFirst(mi)}),onBlur:composeEventHandlers(t.onBlur,Te=>{Te.currentTarget.contains(Te.target)||(window.clearTimeout(lt.current),qt.current="")}),onPointerMove:composeEventHandlers(t.onPointerMove,whenMouse(Te=>{const st=Te.target,Me=si.current!==Te.clientX;if(Te.currentTarget.contains(st)&&Me){const at=Te.clientX>si.current?"right":"left";Bt.current=at,si.current=Te.clientX}}))})})})})})})});MenuContent.displayName=CONTENT_NAME$2;var GROUP_NAME$1="MenuGroup",MenuGroup=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,...d}=t;return jsxRuntimeExports.jsx(Primitive$2.div,{role:"group",...d,ref:s})});MenuGroup.displayName=GROUP_NAME$1;var LABEL_NAME$1="MenuLabel",MenuLabel=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,...d}=t;return jsxRuntimeExports.jsx(Primitive$2.div,{...d,ref:s})});MenuLabel.displayName=LABEL_NAME$1;var ITEM_NAME$1="MenuItem",ITEM_SELECT="menu.itemSelect",MenuItem=reactExports.forwardRef((t,s)=>{const{disabled:u=!1,onSelect:d,..._}=t,S=reactExports.useRef(null),R=useMenuRootContext(ITEM_NAME$1,t.__scopeMenu),a=useMenuContentContext(ITEM_NAME$1,t.__scopeMenu),k=useComposedRefs(s,S),O=reactExports.useRef(!1),j=()=>{const V=S.current;if(!u&&V){const G=new CustomEvent(ITEM_SELECT,{bubbles:!0,cancelable:!0});V.addEventListener(ITEM_SELECT,J=>d==null?void 0:d(J),{once:!0}),dispatchDiscreteCustomEvent(V,G),G.defaultPrevented?O.current=!1:R.onClose()}};return jsxRuntimeExports.jsx(MenuItemImpl,{..._,ref:k,disabled:u,onClick:composeEventHandlers(t.onClick,j),onPointerDown:V=>{var G;(G=t.onPointerDown)==null||G.call(t,V),O.current=!0},onPointerUp:composeEventHandlers(t.onPointerUp,V=>{var G;O.current||(G=V.currentTarget)==null||G.click()}),onKeyDown:composeEventHandlers(t.onKeyDown,V=>{const G=a.searchRef.current!=="";u||G&&V.key===" "||SELECTION_KEYS.includes(V.key)&&(V.currentTarget.click(),V.preventDefault())})})});MenuItem.displayName=ITEM_NAME$1;var MenuItemImpl=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,disabled:d=!1,textValue:_,...S}=t,R=useMenuContentContext(ITEM_NAME$1,u),a=useRovingFocusGroupScope$1(u),k=reactExports.useRef(null),O=useComposedRefs(s,k),[j,V]=reactExports.useState(!1),[G,J]=reactExports.useState("");return reactExports.useEffect(()=>{const Z=k.current;Z&&J((Z.textContent??"").trim())},[S.children]),jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:u,disabled:d,textValue:_??G,children:jsxRuntimeExports.jsx(Item,{asChild:!0,...a,focusable:!d,children:jsxRuntimeExports.jsx(Primitive$2.div,{role:"menuitem","data-highlighted":j?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,...S,ref:O,onPointerMove:composeEventHandlers(t.onPointerMove,whenMouse(Z=>{d?R.onItemLeave(Z):(R.onItemEnter(Z),Z.defaultPrevented||Z.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:composeEventHandlers(t.onPointerLeave,whenMouse(Z=>R.onItemLeave(Z))),onFocus:composeEventHandlers(t.onFocus,()=>V(!0)),onBlur:composeEventHandlers(t.onBlur,()=>V(!1))})})})}),CHECKBOX_ITEM_NAME$1="MenuCheckboxItem",MenuCheckboxItem=reactExports.forwardRef((t,s)=>{const{checked:u=!1,onCheckedChange:d,..._}=t;return jsxRuntimeExports.jsx(ItemIndicatorProvider,{scope:t.__scopeMenu,checked:u,children:jsxRuntimeExports.jsx(MenuItem,{role:"menuitemcheckbox","aria-checked":isIndeterminate$1(u)?"mixed":u,..._,ref:s,"data-state":getCheckedState(u),onSelect:composeEventHandlers(_.onSelect,()=>d==null?void 0:d(isIndeterminate$1(u)?!0:!u),{checkForDefaultPrevented:!1})})})});MenuCheckboxItem.displayName=CHECKBOX_ITEM_NAME$1;var RADIO_GROUP_NAME$1="MenuRadioGroup",[RadioGroupProvider,useRadioGroupContext]=createMenuContext(RADIO_GROUP_NAME$1,{value:void 0,onValueChange:()=>{}}),MenuRadioGroup=reactExports.forwardRef((t,s)=>{const{value:u,onValueChange:d,..._}=t,S=useCallbackRef$1(d);return jsxRuntimeExports.jsx(RadioGroupProvider,{scope:t.__scopeMenu,value:u,onValueChange:S,children:jsxRuntimeExports.jsx(MenuGroup,{..._,ref:s})})});MenuRadioGroup.displayName=RADIO_GROUP_NAME$1;var RADIO_ITEM_NAME$1="MenuRadioItem",MenuRadioItem=reactExports.forwardRef((t,s)=>{const{value:u,...d}=t,_=useRadioGroupContext(RADIO_ITEM_NAME$1,t.__scopeMenu),S=u===_.value;return jsxRuntimeExports.jsx(ItemIndicatorProvider,{scope:t.__scopeMenu,checked:S,children:jsxRuntimeExports.jsx(MenuItem,{role:"menuitemradio","aria-checked":S,...d,ref:s,"data-state":getCheckedState(S),onSelect:composeEventHandlers(d.onSelect,()=>{var R;return(R=_.onValueChange)==null?void 0:R.call(_,u)},{checkForDefaultPrevented:!1})})})});MenuRadioItem.displayName=RADIO_ITEM_NAME$1;var ITEM_INDICATOR_NAME="MenuItemIndicator",[ItemIndicatorProvider,useItemIndicatorContext]=createMenuContext(ITEM_INDICATOR_NAME,{checked:!1}),MenuItemIndicator=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,forceMount:d,..._}=t,S=useItemIndicatorContext(ITEM_INDICATOR_NAME,u);return jsxRuntimeExports.jsx(Presence,{present:d||isIndeterminate$1(S.checked)||S.checked===!0,children:jsxRuntimeExports.jsx(Primitive$2.span,{..._,ref:s,"data-state":getCheckedState(S.checked)})})});MenuItemIndicator.displayName=ITEM_INDICATOR_NAME;var SEPARATOR_NAME$1="MenuSeparator",MenuSeparator=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,...d}=t;return jsxRuntimeExports.jsx(Primitive$2.div,{role:"separator","aria-orientation":"horizontal",...d,ref:s})});MenuSeparator.displayName=SEPARATOR_NAME$1;var ARROW_NAME$1="MenuArrow",MenuArrow=reactExports.forwardRef((t,s)=>{const{__scopeMenu:u,...d}=t,_=usePopperScope(u);return jsxRuntimeExports.jsx(Arrow,{..._,...d,ref:s})});MenuArrow.displayName=ARROW_NAME$1;var SUB_NAME="MenuSub",[MenuSubProvider,useMenuSubContext]=createMenuContext(SUB_NAME),SUB_TRIGGER_NAME$1="MenuSubTrigger",MenuSubTrigger=reactExports.forwardRef((t,s)=>{const u=useMenuContext(SUB_TRIGGER_NAME$1,t.__scopeMenu),d=useMenuRootContext(SUB_TRIGGER_NAME$1,t.__scopeMenu),_=useMenuSubContext(SUB_TRIGGER_NAME$1,t.__scopeMenu),S=useMenuContentContext(SUB_TRIGGER_NAME$1,t.__scopeMenu),R=reactExports.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:k}=S,O={__scopeMenu:t.__scopeMenu},j=reactExports.useCallback(()=>{R.current&&window.clearTimeout(R.current),R.current=null},[]);return reactExports.useEffect(()=>j,[j]),reactExports.useEffect(()=>{const V=a.current;return()=>{window.clearTimeout(V),k(null)}},[a,k]),jsxRuntimeExports.jsx(MenuAnchor,{asChild:!0,...O,children:jsxRuntimeExports.jsx(MenuItemImpl,{id:_.triggerId,"aria-haspopup":"menu","aria-expanded":u.open,"aria-controls":_.contentId,"data-state":getOpenState(u.open),...t,ref:composeRefs(s,_.onTriggerChange),onClick:V=>{var G;(G=t.onClick)==null||G.call(t,V),!(t.disabled||V.defaultPrevented)&&(V.currentTarget.focus(),u.open||u.onOpenChange(!0))},onPointerMove:composeEventHandlers(t.onPointerMove,whenMouse(V=>{S.onItemEnter(V),!V.defaultPrevented&&!t.disabled&&!u.open&&!R.current&&(S.onPointerGraceIntentChange(null),R.current=window.setTimeout(()=>{u.onOpenChange(!0),j()},100))})),onPointerLeave:composeEventHandlers(t.onPointerLeave,whenMouse(V=>{var J,Z;j();const G=(J=u.content)==null?void 0:J.getBoundingClientRect();if(G){const Y=(Z=u.content)==null?void 0:Z.dataset.side,le=Y==="right",ee=le?-5:5,se=G[le?"left":"right"],Q=G[le?"right":"left"];S.onPointerGraceIntentChange({area:[{x:V.clientX+ee,y:V.clientY},{x:se,y:G.top},{x:Q,y:G.top},{x:Q,y:G.bottom},{x:se,y:G.bottom}],side:Y}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>S.onPointerGraceIntentChange(null),300)}else{if(S.onTriggerLeave(V),V.defaultPrevented)return;S.onPointerGraceIntentChange(null)}})),onKeyDown:composeEventHandlers(t.onKeyDown,V=>{var J;const G=S.searchRef.current!=="";t.disabled||G&&V.key===" "||SUB_OPEN_KEYS[d.dir].includes(V.key)&&(u.onOpenChange(!0),(J=u.content)==null||J.focus(),V.preventDefault())})})})});MenuSubTrigger.displayName=SUB_TRIGGER_NAME$1;var SUB_CONTENT_NAME$1="MenuSubContent",MenuSubContent=reactExports.forwardRef((t,s)=>{const u=usePortalContext(CONTENT_NAME$2,t.__scopeMenu),{forceMount:d=u.forceMount,..._}=t,S=useMenuContext(CONTENT_NAME$2,t.__scopeMenu),R=useMenuRootContext(CONTENT_NAME$2,t.__scopeMenu),a=useMenuSubContext(SUB_CONTENT_NAME$1,t.__scopeMenu),k=reactExports.useRef(null),O=useComposedRefs(s,k);return jsxRuntimeExports.jsx(Collection.Provider,{scope:t.__scopeMenu,children:jsxRuntimeExports.jsx(Presence,{present:d||S.open,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:t.__scopeMenu,children:jsxRuntimeExports.jsx(MenuContentImpl,{id:a.contentId,"aria-labelledby":a.triggerId,..._,ref:O,align:"start",side:R.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:j=>{var V;R.isUsingKeyboardRef.current&&((V=k.current)==null||V.focus()),j.preventDefault()},onCloseAutoFocus:j=>j.preventDefault(),onFocusOutside:composeEventHandlers(t.onFocusOutside,j=>{j.target!==a.trigger&&S.onOpenChange(!1)}),onEscapeKeyDown:composeEventHandlers(t.onEscapeKeyDown,j=>{R.onClose(),j.preventDefault()}),onKeyDown:composeEventHandlers(t.onKeyDown,j=>{var J;const V=j.currentTarget.contains(j.target),G=SUB_CLOSE_KEYS[R.dir].includes(j.key);V&&G&&(S.onOpenChange(!1),(J=a.trigger)==null||J.focus(),j.preventDefault())})})})})})});MenuSubContent.displayName=SUB_CONTENT_NAME$1;function getOpenState(t){return t?"open":"closed"}function isIndeterminate$1(t){return t==="indeterminate"}function getCheckedState(t){return isIndeterminate$1(t)?"indeterminate":t?"checked":"unchecked"}function focusFirst(t){const s=document.activeElement;for(const u of t)if(u===s||(u.focus(),document.activeElement!==s))return}function wrapArray(t,s){return t.map((u,d)=>t[(s+d)%t.length])}function getNextMatch(t,s,u){const _=s.length>1&&Array.from(s).every(O=>O===s[0])?s[0]:s,S=u?t.indexOf(u):-1;let R=wrapArray(t,Math.max(S,0));_.length===1&&(R=R.filter(O=>O!==u));const k=R.find(O=>O.toLowerCase().startsWith(_.toLowerCase()));return k!==u?k:void 0}function isPointInPolygon(t,s){const{x:u,y:d}=t;let _=!1;for(let S=0,R=s.length-1;S<s.length;R=S++){const a=s[S],k=s[R],O=a.x,j=a.y,V=k.x,G=k.y;j>d!=G>d&&u<(V-O)*(d-j)/(G-j)+O&&(_=!_)}return _}function isPointerInGraceArea(t,s){if(!s)return!1;const u={x:t.clientX,y:t.clientY};return isPointInPolygon(u,s)}function whenMouse(t){return s=>s.pointerType==="mouse"?t(s):void 0}var Root3=Menu,Anchor2=MenuAnchor,Portal=MenuPortal,Content2$1=MenuContent,Group=MenuGroup,Label=MenuLabel,Item2=MenuItem,CheckboxItem=MenuCheckboxItem,RadioGroup=MenuRadioGroup,RadioItem=MenuRadioItem,ItemIndicator=MenuItemIndicator,Separator=MenuSeparator,Arrow2=MenuArrow,SubTrigger=MenuSubTrigger,SubContent=MenuSubContent,DROPDOWN_MENU_NAME="DropdownMenu",[createDropdownMenuContext]=createContextScope$4(DROPDOWN_MENU_NAME,[createMenuScope]),useMenuScope=createMenuScope(),[DropdownMenuProvider,useDropdownMenuContext]=createDropdownMenuContext(DROPDOWN_MENU_NAME),DropdownMenu$1=t=>{const{__scopeDropdownMenu:s,children:u,dir:d,open:_,defaultOpen:S,onOpenChange:R,modal:a=!0}=t,k=useMenuScope(s),O=reactExports.useRef(null),[j,V]=useControllableState({prop:_,defaultProp:S??!1,onChange:R,caller:DROPDOWN_MENU_NAME});return jsxRuntimeExports.jsx(DropdownMenuProvider,{scope:s,triggerId:useId(),triggerRef:O,contentId:useId(),open:j,onOpenChange:V,onOpenToggle:reactExports.useCallback(()=>V(G=>!G),[V]),modal:a,children:jsxRuntimeExports.jsx(Root3,{...k,open:j,onOpenChange:V,dir:d,modal:a,children:u})})};DropdownMenu$1.displayName=DROPDOWN_MENU_NAME;var TRIGGER_NAME$2="DropdownMenuTrigger",DropdownMenuTrigger$1=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,disabled:d=!1,..._}=t,S=useDropdownMenuContext(TRIGGER_NAME$2,u),R=useMenuScope(u);return jsxRuntimeExports.jsx(Anchor2,{asChild:!0,...R,children:jsxRuntimeExports.jsx(Primitive$8.button,{type:"button",id:S.triggerId,"aria-haspopup":"menu","aria-expanded":S.open,"aria-controls":S.open?S.contentId:void 0,"data-state":S.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,..._,ref:composeRefs(s,S.triggerRef),onPointerDown:composeEventHandlers(t.onPointerDown,a=>{!d&&a.button===0&&a.ctrlKey===!1&&(S.onOpenToggle(),S.open||a.preventDefault())}),onKeyDown:composeEventHandlers(t.onKeyDown,a=>{d||(["Enter"," "].includes(a.key)&&S.onOpenToggle(),a.key==="ArrowDown"&&S.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});DropdownMenuTrigger$1.displayName=TRIGGER_NAME$2;var PORTAL_NAME="DropdownMenuPortal",DropdownMenuPortal=t=>{const{__scopeDropdownMenu:s,...u}=t,d=useMenuScope(s);return jsxRuntimeExports.jsx(Portal,{...d,...u})};DropdownMenuPortal.displayName=PORTAL_NAME;var CONTENT_NAME$1="DropdownMenuContent",DropdownMenuContent$1=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useDropdownMenuContext(CONTENT_NAME$1,u),S=useMenuScope(u),R=reactExports.useRef(!1);return jsxRuntimeExports.jsx(Content2$1,{id:_.contentId,"aria-labelledby":_.triggerId,...S,...d,ref:s,onCloseAutoFocus:composeEventHandlers(t.onCloseAutoFocus,a=>{var k;R.current||(k=_.triggerRef.current)==null||k.focus(),R.current=!1,a.preventDefault()}),onInteractOutside:composeEventHandlers(t.onInteractOutside,a=>{const k=a.detail.originalEvent,O=k.button===0&&k.ctrlKey===!0,j=k.button===2||O;(!_.modal||j)&&(R.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DropdownMenuContent$1.displayName=CONTENT_NAME$1;var GROUP_NAME="DropdownMenuGroup",DropdownMenuGroup=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(Group,{..._,...d,ref:s})});DropdownMenuGroup.displayName=GROUP_NAME;var LABEL_NAME="DropdownMenuLabel",DropdownMenuLabel=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(Label,{..._,...d,ref:s})});DropdownMenuLabel.displayName=LABEL_NAME;var ITEM_NAME="DropdownMenuItem",DropdownMenuItem=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(Item2,{..._,...d,ref:s})});DropdownMenuItem.displayName=ITEM_NAME;var CHECKBOX_ITEM_NAME="DropdownMenuCheckboxItem",DropdownMenuCheckboxItem$1=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(CheckboxItem,{..._,...d,ref:s})});DropdownMenuCheckboxItem$1.displayName=CHECKBOX_ITEM_NAME;var RADIO_GROUP_NAME="DropdownMenuRadioGroup",DropdownMenuRadioGroup=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(RadioGroup,{..._,...d,ref:s})});DropdownMenuRadioGroup.displayName=RADIO_GROUP_NAME;var RADIO_ITEM_NAME="DropdownMenuRadioItem",DropdownMenuRadioItem=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(RadioItem,{..._,...d,ref:s})});DropdownMenuRadioItem.displayName=RADIO_ITEM_NAME;var INDICATOR_NAME$1="DropdownMenuItemIndicator",DropdownMenuItemIndicator=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(ItemIndicator,{..._,...d,ref:s})});DropdownMenuItemIndicator.displayName=INDICATOR_NAME$1;var SEPARATOR_NAME="DropdownMenuSeparator",DropdownMenuSeparator=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(Separator,{..._,...d,ref:s})});DropdownMenuSeparator.displayName=SEPARATOR_NAME;var ARROW_NAME="DropdownMenuArrow",DropdownMenuArrow=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(Arrow2,{..._,...d,ref:s})});DropdownMenuArrow.displayName=ARROW_NAME;var SUB_TRIGGER_NAME="DropdownMenuSubTrigger",DropdownMenuSubTrigger=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(SubTrigger,{..._,...d,ref:s})});DropdownMenuSubTrigger.displayName=SUB_TRIGGER_NAME;var SUB_CONTENT_NAME="DropdownMenuSubContent",DropdownMenuSubContent=reactExports.forwardRef((t,s)=>{const{__scopeDropdownMenu:u,...d}=t,_=useMenuScope(u);return jsxRuntimeExports.jsx(SubContent,{..._,...d,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DropdownMenuSubContent.displayName=SUB_CONTENT_NAME;var Root2$1=DropdownMenu$1,Trigger$1=DropdownMenuTrigger$1,Portal2=DropdownMenuPortal,Content2=DropdownMenuContent$1,CheckboxItem2=DropdownMenuCheckboxItem$1,ItemIndicator2=DropdownMenuItemIndicator;function DropdownMenu({...t}){return jsxRuntimeExports.jsx(Root2$1,{"data-slot":"dropdown-menu",...t})}function DropdownMenuTrigger({...t}){return jsxRuntimeExports.jsx(Trigger$1,{"data-slot":"dropdown-menu-trigger",...t})}function DropdownMenuContent({className:t,sideOffset:s=4,...u}){return jsxRuntimeExports.jsx(Portal2,{children:jsxRuntimeExports.jsx(Content2,{"data-slot":"dropdown-menu-content",sideOffset:s,className:cn("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...u})})}function DropdownMenuCheckboxItem({className:t,children:s,checked:u,...d}){return jsxRuntimeExports.jsxs(CheckboxItem2,{"data-slot":"dropdown-menu-checkbox-item",className:cn("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),checked:u,...d,children:[jsxRuntimeExports.jsx("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator2,{children:jsxRuntimeExports.jsx(Check,{className:"size-4"})})}),s]})}const AdminHome=()=>{const[t,s]=reactExports.useState(""),[u,d]=reactExports.useState(null),[_,S]=reactExports.useState("asc"),[R,a]=reactExports.useState([]),[k,O]=reactExports.useState(!0),[j,V]=reactExports.useState([]),{hideLoader:G}=useLoader();reactExports.useEffect(()=>{(async()=>{try{const _e=await(await fetch(`${VITE_BACKEND_URL}/api/v1/all-issues`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();Array.isArray(_e.issues)?V(_e.issues):V([])}catch(oe){console.error("Error fetching issues:",oe),V([])}finally{O(!1),G()}})()},[G]);const J=async(Q,oe)=>{try{const _e=await fetch(`${VITE_BACKEND_URL}/api/v1/admin/issue/${Q}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({status:oe})}),Se=await _e.json();_e.ok?V(ke=>ke.map(Le=>Le._id===Q?{...Le,status:oe}:Le)):alert(Se.message)}catch(_e){console.error("Error updating issue status:",_e)}},Z=async Q=>{if(window.confirm("Are you sure you want to delete this issue?"))try{const oe=await fetch(`${VITE_BACKEND_URL}/api/v1/issue/admin/${Q}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),_e=await oe.json();oe.ok?V(Se=>Se.filter(ke=>ke._id!==Q)):alert(_e.message)}catch(oe){console.error("Error deleting issue:",oe)}},Y=Q=>{u===Q?S(_==="asc"?"desc":"asc"):(d(Q),S("asc"))},ee=[...j].sort((Q,oe)=>{if(!u)return 0;const _e=Q[u],Se=oe[u];return _==="asc"?_e.localeCompare(Se):Se.localeCompare(_e)}).filter(Q=>{const oe=Q.title.toLowerCase().includes(t.toLowerCase())||Q.description.toLowerCase().includes(t.toLowerCase())||Q.location.address.toLowerCase().includes(t.toLowerCase()),_e=R.length===0||R.includes(Q.status);return oe&&_e}),se=Q=>{switch(Q){case"Resolved":return"bg-green-100 text-green-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Rejected":return"bg-red-100 text-red-800";case"Pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return k?jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-white",children:[jsxRuntimeExports.jsx(Lottie,{autoplay:!0,loop:!0,animationData:starloader,style:{height:"200px",width:"200px"}}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-4",children:"Fetching issues..."})]}):jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"min-h-screen bg-[#f3f6f8]",children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#f3f6f8]",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("div",{className:"pt-20 container mx-auto px-4 py-8 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-[#0577b7] ",children:"Admin Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and resolve community issues"})]}),jsxRuntimeExports.jsx(Link,{to:"/admin/profile",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"flex items-center space-x-2 shadow-sm text-slate-500 ",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 text-purple-700"}),jsxRuntimeExports.jsx("span",{children:"My Profile"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 ",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 rounded-lg border shadow-lg bg-card  hover:scale-[1.02] transition-transform hover:shadow-xl transition-shadow duration-300  ",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-foreground  ",children:j.length}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Issues"})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 rounded-lg border shadow-lg bg-card hover:scale-[1.02] transition-transform hover:shadow-xl transition-shadow duration-300 ",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.filter(Q=>Q.status==="Resolved").length}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved Issues"})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 rounded-lg border shadow-lg bg-card hover:scale-[1.02] transition-transform hover:shadow-xl transition-shadow duration-300 ",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.filter(Q=>Q.status==="In Progress").length}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Issues In Progress"})]}),jsxRuntimeExports.jsxs("div",{className:"p-6 rounded-lg border shadow-lg bg-card hover:scale-[1.02] transition-transform hover:shadow-xl transition-shadow duration-300 ",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:j.filter(Q=>Q.status==="Pending").length}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 ",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-full md:w-80 shadow-sm rounded",children:[jsxRuntimeExports.jsx(Search,{className:"absolute  left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"Search issues...",value:t,onChange:Q=>s(Q.target.value),className:"pl-10 bg-white"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-2",children:jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"gap-2 shadow-sm text-slate-600",children:["Status ",jsxRuntimeExports.jsx(ChevronsUpDown,{className:"h-4 w-4 text-gray-500 "})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",className:"w-[200px]",children:[jsxRuntimeExports.jsx(DropdownMenuCheckboxItem,{checked:R.includes("Rejected"),onCheckedChange:Q=>a(oe=>Q?[...oe,"Rejected"]:oe.filter(_e=>_e!=="Rejected")),children:"Rejected"}),jsxRuntimeExports.jsx(DropdownMenuCheckboxItem,{checked:R.includes("In Progress"),onCheckedChange:Q=>a(oe=>Q?[...oe,"In Progress"]:oe.filter(_e=>_e!=="In Progress")),children:"In Progress"}),jsxRuntimeExports.jsx(DropdownMenuCheckboxItem,{checked:R.includes("Resolved"),onCheckedChange:Q=>a(oe=>Q?[...oe,"Resolved"]:oe.filter(_e=>_e!=="Resolved")),children:"Resolved"}),jsxRuntimeExports.jsx(DropdownMenuCheckboxItem,{checked:R.includes("Pending"),onCheckedChange:Q=>a(oe=>Q?[...oe,"Pending"]:oe.filter(_e=>_e!=="Pending")),children:"Pending"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"rounded-md border bg-white shadow-lg text-slate-500 pl-6 pr-6 hover:shadow-xl transition-shadow duration-300 ",children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableCaption,{children:"A list of all reported issues."}),jsxRuntimeExports.jsx(TableHeader,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",onClick:()=>Y("title"),className:"w-full text-gray-700",children:["Title",u==="title"&&(_==="asc"?jsxRuntimeExports.jsx(ArrowUp,{className:"ml-2 h-4 w-4 text-gray-500 "}):jsxRuntimeExports.jsx(ArrowDown,{className:"ml-2 h-4 w-4 text-gray-500 "}))]})}),jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",onClick:()=>Y("location"),className:"w-full text-gray-700 ",children:["Location",u==="location"&&(_==="asc"?jsxRuntimeExports.jsx(ArrowUp,{className:"ml-2 h-4 w-4 text-gray-500 "}):jsxRuntimeExports.jsx(ArrowDown,{className:"ml-2 h-4 w-4 text-gray-500 "}))]})}),jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",onClick:()=>Y("status"),className:"w-full text-gray-700",children:["Status",u==="status"&&(_==="asc"?jsxRuntimeExports.jsx(ArrowUp,{className:"ml-2 h-4 w-4 text-gray-500 "}):jsxRuntimeExports.jsx(ArrowDown,{className:"ml-2 h-4 w-4 text-gray-500 "}))]})}),jsxRuntimeExports.jsx(TableHead,{className:"text-right text-gray-700",children:"Actions"})]})}),jsxRuntimeExports.jsxs(TableBody,{children:[ee.map(Q=>jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{className:"font-medium",children:Q.title}),jsxRuntimeExports.jsx(TableCell,{children:Q.location.address}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Badge,{className:se(Q.status),children:Q.status})}),jsxRuntimeExports.jsx(TableCell,{className:"text-right",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-2",children:[jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",children:jsxRuntimeExports.jsx(SquarePen,{className:"h-4 w-4 text-blue-600"})})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsx("button",{onClick:()=>J(Q._id,"Resolved"),className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Resolved"}),jsxRuntimeExports.jsx("button",{onClick:()=>J(Q._id,"In Progress"),className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"In Progress"}),jsxRuntimeExports.jsx("button",{onClick:()=>J(Q._id,"Rejected"),className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Rejected"}),jsxRuntimeExports.jsx("button",{onClick:()=>J(Q._id,"Pending"),className:"block w-full text-left px-4 py-2 hover:bg-gray-100",children:"Pending"})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>Z(Q._id),children:jsxRuntimeExports.jsx(Trash2,{className:"h-4 w-4 text-gray-500 "})})]})})]},Q._id)),ee.length===0&&jsxRuntimeExports.jsx(TableRow,{children:jsxRuntimeExports.jsx(TableCell,{colSpan:5,className:"text-center",children:"No issues found."})})]})]})})]})]})})},v="4.7.0",fr=25,ip=0,op=50,w=120,h=120,nm="Comp 1",ddd=0,assets=[],layers=[{ddd:0,ind:1,ty:4,nm:"ruoi",ks:{o:{a:1,k:[{i:{x:[.833],y:[.967]},o:{x:[.167],y:[.033]},n:["0p833_0p967_0p167_0p033"],t:35,s:[100],e:[0]},{t:49}]},r:{a:0,k:0},p:{a:1,k:[{i:{x:.833,y:.833},o:{x:0,y:0},n:"0p833_0p833_0_0",t:0,s:[57.361,61.016,0],e:[57.699,41.796,0],to:[-4.67500305175781,-4.12800598144531,0],ti:[-13.9099960327148,5.27300262451172,0]},{i:{x:.833,y:.833},o:{x:.167,y:.167},n:"0p833_0p833_0p167_0p167",t:10.219,s:[57.699,41.796,0],e:[79.084,33.982,0],to:[12.8159942626953,-4.85800170898438,0],ti:[-4.54498291015625,3.73400115966797,0]},{i:{x:.833,y:.833},o:{x:.167,y:.167},n:"0p833_0p833_0p167_0p167",t:19.445,s:[79.084,33.982,0],e:[59.691,9.121,0],to:[6.61601257324219,-5.43799591064453,0],ti:[20.0290069580078,1.20700073242188,0]},{t:35}]},a:{a:0,k:[60.531,10.945,0]},s:{a:0,k:[100,100,100]}},ao:0,shapes:[{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.994,0],[0,-.994],[.995,0],[0,.994]],o:[[.995,0],[0,.994],[-.994,0],[0,-.994]],v:[[-.001,-1.801],[1.801,-.001],[-.001,1.801],[-1.801,-.001]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"fl",c:{a:0,k:[.4235294117647059,.4235294117647059,.4235294117647059,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[62.4,13.144],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group"},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.422,0],[0,-1.422],[1.421,0],[0,1.422]],o:[[1.421,0],[0,1.422],[-1.422,0],[0,-1.422]],v:[[.001,-2.574],[2.574,0],[.001,2.574],[-2.574,0]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"st",c:{a:0,k:[.4235294117647059,.4235294117647059,.4235294117647059,1]},o:{a:0,k:100},w:{a:0,k:.7},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke"},{ty:"fl",c:{a:0,k:[1,1,1,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[64.145,9.606],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:3,cix:2,ix:2,mn:"ADBE Vector Group"},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.996,0],[0,-1.996],[1.996,0],[0,1.996]],o:[[1.996,0],[0,1.996],[-1.996,0],[0,-1.996]],v:[[0,-3.614],[3.614,0],[0,3.614],[-3.614,0]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"st",c:{a:0,k:[.4235294117647059,.4235294117647059,.4235294117647059,1]},o:{a:0,k:100},w:{a:0,k:.7},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke"},{ty:"fl",c:{a:0,k:[1,1,1,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[57.957,10.552],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:3,cix:2,ix:3,mn:"ADBE Vector Group"},{ty:"tr",p:{a:0,k:[60.531,10.941],ix:2},a:{a:0,k:[60.531,10.941],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"ruoi",np:3,cix:2,ix:1,mn:"ADBE Vector Group"}],ip:0,op:50,st:0,bm:0,sr:1},{ddd:0,ind:2,ty:4,nm:"Shape Layer 2",ks:{o:{a:1,k:[{i:{x:[.833],y:[.967]},o:{x:[.167],y:[.033]},n:["0p833_0p967_0p167_0p033"],t:35,s:[100],e:[0]},{t:49}]},r:{a:0,k:0},p:{a:0,k:[-.75,-.75,0]},a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-13.91,5.273],[-4.545,3.734],[20.029,1.207]],o:[[-4.675,-4.128],[12.816,-4.858],[6.616,-5.438],[0,0]],v:[[-7.383,24.76],[-7.046,5.54],[14.34,-2.273],[-3.178,-24.76]],c:!1}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"st",c:{a:0,k:[.34901960784313724,.3686274509803922,.4,1]},o:{a:0,k:100},w:{a:0,k:1},lc:2,lj:2,d:[{n:"d",nm:"dash",v:{a:0,k:2.028}},{n:"g",nm:"gap",v:{a:0,k:2.028}},{n:"o",nm:"offset",v:{a:0,k:0}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke"},{ty:"tr",p:{a:0,k:[67.87,37.631],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,ix:1,mn:"ADBE Vector Group"},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[.833],y:[.953]},o:{x:[.167],y:[.033]},n:["0p833_0p953_0p167_0p033"],t:0,s:[0],e:[100]},{t:35}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim"}],ip:0,op:50,st:0,bm:0,sr:1},{ddd:0,ind:3,ty:4,nm:"im_emptyBox Outlines",ks:{o:{a:0,k:100},r:{a:0,k:0},p:{a:0,k:[60,60,0]},a:{a:0,k:[60,60,0]},s:{a:0,k:[100,100,100]}},ao:0,shapes:[{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-.001,-16.607],[-32.143,-.002],[-.001,16.607],[32.144,-.002]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"fl",c:{a:0,k:[.8,.82,.851,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[60,55.75],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,ix:1,mn:"ADBE Vector Group"},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[12.856,-23.249],[0,-16.605],[-12.857,-23.249],[-45,-6.641],[-32.144,.001],[-45,6.645],[-12.857,23.249],[0,16.609],[12.856,23.249],[45,6.645],[32.143,.001],[45,-6.641]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"fl",c:{a:0,k:[.9372549019607843,.9372549019607843,.9372549019607843,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[60,55.748],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,ix:2,mn:"ADBE Vector Group"},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-16.072,24.171],[16.072,11.312],[16.072,-24.171],[-16.072,-24.171]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"fl",c:{a:0,k:[.9529411764705882,.9529411764705882,.9529411764705882,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[76.072,83.33],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,ix:3,mn:"ADBE Vector Group"},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-32.143,-24.171],[-32.143,11.311],[-.001,24.171],[32.144,11.311],[32.144,-24.171]],c:!0}},nm:"Path 1",mn:"ADBE Vector Shape - Group"},{ty:"fl",c:{a:0,k:[.8,.82,.851,1]},o:{a:0,k:100},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill"},{ty:"tr",p:{a:0,k:[60,83.33],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:2,cix:2,ix:4,mn:"ADBE Vector Group"},{ty:"tr",p:{a:0,k:[60,60.186],ix:2},a:{a:0,k:[60,60.186],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"box",np:4,cix:2,ix:1,mn:"ADBE Vector Group"}],ip:0,op:50,st:0,bm:0,sr:1}],emptyAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers},AdminProfile=()=>{const{user:t,updateUserProfile:s,token:u,isLoading:d}=useAuth(),[_,S]=reactExports.useState(!1),[R,a]=reactExports.useState([]),[k,O]=reactExports.useState(!0),[j,V]=reactExports.useState({fullName:(t==null?void 0:t.fullName)||"",email:(t==null?void 0:t.email)||"",phonenumber:(t==null?void 0:t.phonenumber)||"",department:(t==null?void 0:t.department)||""});if(d)return jsxRuntimeExports.jsx("p",{className:"text-center mt-10",children:"Loading profile..."});if(!t)return jsxRuntimeExports.jsx("p",{className:"text-center mt-10",children:"Loading profile..."});const G=async()=>{try{await s({fullName:j.fullName,email:j.email,phonenumber:j.phonenumber,department:j.department}),toast.success("Profile updated successfully!"),S(!1)}catch(Z){console.error("Update error:",Z),toast.error("Failed to update profile")}};reactExports.useEffect(()=>{if(!u)return;(async()=>{O(!0);try{const Y=await fetch(`${VITE_BACKEND_URL}/api/v1/admin/handled-issues`,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});if(Y.status===401){toast.error("Unauthorized! Please log in again.");return}const le=await Y.json();Y.ok&&Array.isArray(le.issues)?a(le.issues):(console.error("Failed to fetch issues:",le.message),toast.error(le.message||"Failed to load issues"))}catch(Y){console.error("Error fetching my issues:",Y),toast.error("Error loading your issues")}finally{O(!1)}})()},[u]);const J=Z=>{switch(Z){case"Resolved":return"bg-green-100 text-green-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return k?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Loading handled issues..."})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#f3f6f8]",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("div",{className:"pt-20 container mx-auto my-9 max-w-4xl space-y-6 px-4",children:[jsxRuntimeExports.jsxs(Card,{className:`bg-white/80 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10\r
  hover:shadow-xl transition-shadow duration-300 \r
  `,children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsxs(Avatar,{className:"h-20 w-20 ",children:[jsxRuntimeExports.jsx(AvatarImage,{src:"/placeholder.svg"}),jsxRuntimeExports.jsx(AvatarFallback,{className:"text-lg bg-[#bedbff] ",children:j.fullName.split(" ").map(Z=>Z[0]).join("")})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(CardTitle,{className:"text-2xl text-slate-600",children:"Administrator Profile"}),jsxRuntimeExports.jsx(Shield,{className:"h-5 w-5 text-blue-600"})]}),jsxRuntimeExports.jsx(CardDescription,{children:"Manage your profile and view your resolved issues"})]})]}),jsxRuntimeExports.jsxs(Button,{variant:_?"default":"outline",className:"text-slate-500 active:bg-gray-200 focus:bg-gray-200 active:ring-0 focus:ring-0 ",onClick:_?G:()=>S(!0),children:[jsxRuntimeExports.jsx(SquarePen,{className:"h-4 w-4  text-purple-700"}),jsxRuntimeExports.jsx("div",{className:"hidden sm:block",children:_?"Save Changes":"Edit Profile"})]})]})}),jsxRuntimeExports.jsx(CardContent,{className:"space-y-4",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"name",children:"Full Name"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"name",value:j.fullName,onChange:Z=>V({...j,fullName:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.fullName||"Not Provided"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"email",children:"Email"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Mail,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"email",type:"email",value:j.email,onChange:Z=>V({...j,email:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.email||"Not Provided"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"phonenumber",children:"Phone Number"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Phone,{className:"h-4 w-4 text-blue-600 hover:text-blue-800  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"phonenumber",value:j.phonenumber,onChange:Z=>V({...j,phonenumber:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.phonenumber||"Not assigned"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"department",children:"Department"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Shield,{className:"h-4 w-4 text-yellow-500 hover:text-yellow-700  transition duration-300"}),_?jsxRuntimeExports.jsx(Input,{id:"department",value:j.department,onChange:Z=>V({...j,department:Z.target.value})}):jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:j.department||"Not assigned"})]})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
 `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6 ",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold",children:R.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Issues Handled"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
  `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.filter(Z=>Z.status==="Resolved").length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Successfully Resolved"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
  `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl font-bold text-blue-600",children:R.filter(Z=>Z.status==="In Progress").length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently Working On"})]})}),jsxRuntimeExports.jsx(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  hover:scale-[1.02] transition-transform\r
 `,children:jsxRuntimeExports.jsxs(CardContent,{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-2xl font-bold",children:[R.filter(Z=>Z.resolvedDate).length>0?Math.round(R.filter(Z=>Z.resolvedDate).reduce((Z,Y)=>{const le=new Date(Y.reportDate??""),ee=new Date(Y.resolvedDate);return Z+(ee.getTime()-le.getTime())/(1e3*60*60*24)},0)/R.filter(Z=>Z.resolvedDate).length):0,"d"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg. Resolution Time"})]})})]}),jsxRuntimeExports.jsxs(Card,{className:`bg-white/70 \r
  border border-white/20 \r
  shadow-lg \r
  rounded-xl \r
  p-6 \r
  ring-1 ring-white/10 \r
  hover:shadow-xl transition-shadow duration-300 \r
  `,children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500 hover:text-green-700  transition duration-300"}),jsxRuntimeExports.jsx("span",{children:"Issues I've Handled"})]}),jsxRuntimeExports.jsx(CardDescription,{children:"Track all issues you've responded to and resolved"})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx("div",{className:"space-y-4",children:R.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center mt-10 ",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 ",children:jsxRuntimeExports.jsx(Lottie,{autoplay:!0,loop:!0,animationData:emptyAnimation,style:{width:"100%",height:"100%"}})}),jsxRuntimeExports.jsx("p",{className:"text-center mt-4 text-muted-foreground text-lg font-medium",children:"You haven't handled any issues yet."})]}):R.map(Z=>{var Y;return jsxRuntimeExports.jsxs("div",{className:"border rounded-lg p-4 space-y-3 shadow-sm bg-blue-50 ",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold",children:Z.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Z.description}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Reported by:"," ",jsxRuntimeExports.jsx("span",{className:"font-medium",children:Z.citizenName})]})]}),jsxRuntimeExports.jsx("div",{className:"flex space-x-2",children:jsxRuntimeExports.jsx(Badge,{className:J(Z.status),children:Z.status})})]}),jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded",children:jsxRuntimeExports.jsxs("p",{className:"text-sm",children:[jsxRuntimeExports.jsx("strong",{children:"Your Response:"})," ",Z.adminResponse]})}),jsxRuntimeExports.jsx(Separator$1,{}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1  gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-4 w-4 text-blue-600"}),jsxRuntimeExports.jsx("span",{children:(Y=Z.location)==null?void 0:Y.address})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-4 w-4 text-pink-500"}),jsxRuntimeExports.jsxs("span",{children:["Reported:"," ",Z.reportDate?new Date(Z.reportDate).toLocaleDateString():"N/A"]})]}),Z.resolvedDate&&jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-4 w-4 text-green-600"}),jsxRuntimeExports.jsxs("span",{children:["Resolved: ",Z.resolvedDate]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(FileText,{className:"h-4 w-4 text-purple-600"}),jsxRuntimeExports.jsxs("span",{children:["Category: ",Z.category]})]})]})]},Z._id)})})})]})]})]})},NotFound=()=>{const t=useLocation();return reactExports.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),jsxRuntimeExports.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function createContextScope$1(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes$1(_,...s)]}function composeContextScopes$1(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot$1(t){const s=createSlotClone$1(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable$1);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone$1(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef$1(_),a=mergeProps$1(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER$1=Symbol("radix.slottable");function isSlottable$1(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER$1}function mergeProps$1(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef$1(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES$1=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive$1=NODES$1.reduce((t,s)=>{const u=createSlot$1(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),TABS_NAME="Tabs",[createTabsContext]=createContextScope$1(TABS_NAME,[createRovingFocusGroupScope]),useRovingFocusGroupScope=createRovingFocusGroupScope(),[TabsProvider,useTabsContext]=createTabsContext(TABS_NAME),Tabs$1=reactExports.forwardRef((t,s)=>{const{__scopeTabs:u,value:d,onValueChange:_,defaultValue:S,orientation:R="horizontal",dir:a,activationMode:k="automatic",...O}=t,j=useDirection(a),[V,G]=useControllableState({prop:d,onChange:_,defaultProp:S??"",caller:TABS_NAME});return jsxRuntimeExports.jsx(TabsProvider,{scope:u,baseId:useId(),value:V,onValueChange:G,orientation:R,dir:j,activationMode:k,children:jsxRuntimeExports.jsx(Primitive$1.div,{dir:j,"data-orientation":R,...O,ref:s})})});Tabs$1.displayName=TABS_NAME;var TAB_LIST_NAME="TabsList",TabsList$1=reactExports.forwardRef((t,s)=>{const{__scopeTabs:u,loop:d=!0,..._}=t,S=useTabsContext(TAB_LIST_NAME,u),R=useRovingFocusGroupScope(u);return jsxRuntimeExports.jsx(Root$1,{asChild:!0,...R,orientation:S.orientation,dir:S.dir,loop:d,children:jsxRuntimeExports.jsx(Primitive$1.div,{role:"tablist","aria-orientation":S.orientation,..._,ref:s})})});TabsList$1.displayName=TAB_LIST_NAME;var TRIGGER_NAME$1="TabsTrigger",TabsTrigger$1=reactExports.forwardRef((t,s)=>{const{__scopeTabs:u,value:d,disabled:_=!1,...S}=t,R=useTabsContext(TRIGGER_NAME$1,u),a=useRovingFocusGroupScope(u),k=makeTriggerId(R.baseId,d),O=makeContentId(R.baseId,d),j=d===R.value;return jsxRuntimeExports.jsx(Item,{asChild:!0,...a,focusable:!_,active:j,children:jsxRuntimeExports.jsx(Primitive$1.button,{type:"button",role:"tab","aria-selected":j,"aria-controls":O,"data-state":j?"active":"inactive","data-disabled":_?"":void 0,disabled:_,id:k,...S,ref:s,onMouseDown:composeEventHandlers(t.onMouseDown,V=>{!_&&V.button===0&&V.ctrlKey===!1?R.onValueChange(d):V.preventDefault()}),onKeyDown:composeEventHandlers(t.onKeyDown,V=>{[" ","Enter"].includes(V.key)&&R.onValueChange(d)}),onFocus:composeEventHandlers(t.onFocus,()=>{const V=R.activationMode!=="manual";!j&&!_&&V&&R.onValueChange(d)})})})});TabsTrigger$1.displayName=TRIGGER_NAME$1;var CONTENT_NAME="TabsContent",TabsContent$1=reactExports.forwardRef((t,s)=>{const{__scopeTabs:u,value:d,forceMount:_,children:S,...R}=t,a=useTabsContext(CONTENT_NAME,u),k=makeTriggerId(a.baseId,d),O=makeContentId(a.baseId,d),j=d===a.value,V=reactExports.useRef(j);return reactExports.useEffect(()=>{const G=requestAnimationFrame(()=>V.current=!1);return()=>cancelAnimationFrame(G)},[]),jsxRuntimeExports.jsx(Presence,{present:_||j,children:({present:G})=>jsxRuntimeExports.jsx(Primitive$1.div,{"data-state":j?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":k,hidden:!G,id:O,tabIndex:0,...R,ref:s,style:{...t.style,animationDuration:V.current?"0s":void 0},children:G&&S})})});TabsContent$1.displayName=CONTENT_NAME;function makeTriggerId(t,s){return`${t}-trigger-${s}`}function makeContentId(t,s){return`${t}-content-${s}`}var Root2=Tabs$1,List=TabsList$1,Trigger=TabsTrigger$1,Content=TabsContent$1;function Tabs({className:t,...s}){return jsxRuntimeExports.jsx(Root2,{"data-slot":"tabs",className:cn("flex flex-col gap-2",t),...s})}function TabsList({className:t,...s}){return jsxRuntimeExports.jsx(List,{"data-slot":"tabs-list",className:cn("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function TabsTrigger({className:t,...s}){return jsxRuntimeExports.jsx(Trigger,{"data-slot":"tabs-trigger",className:cn("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function TabsContent({className:t,...s}){return jsxRuntimeExports.jsx(Content,{"data-slot":"tabs-content",className:cn("flex-1 outline-none",t),...s})}const SignIn=()=>{const[t,s]=reactExports.useState(!1),[u,d]=reactExports.useState({email:"",password:""}),[_,S]=reactExports.useState({email:"",password:"",adminAccessCode:""}),[R,a]=reactExports.useState("citizen"),k=useNavigate(),{login:O}=useAuth(),{showLoader:j,hideLoader:V}=useLoader(),G=async J=>{J.preventDefault(),j();const Z=new Promise(Y=>setTimeout(Y,2e3));try{let Y;R==="citizen"?Y=await Promise.all([O(u.email,u.password,"citizen"),Z]).then(([le])=>le):Y=await Promise.all([O(_.email,_.password,"admin",_.adminAccessCode),Z]).then(([le])=>le),Y===!0?(toast.success("Sign In Successful!",{description:R==="citizen"?"Welcome back!":"Welcome back, Administrator!"}),k(R==="citizen"?"/citizen":"/admin",{replace:!0})):(toast.error("Sign In Failed!",{description:"Invalid credentials"}),V())}catch(Y){console.error(Y),toast.error("Sign In Failed!",{description:"Something went wrong"}),V()}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-[#f0f7f5]"}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md",children:[jsxRuntimeExports.jsx("div",{className:"text-center mb-8",children:jsxRuntimeExports.jsxs(Link,{to:"/",className:"inline-flex items-center space-x-2 mb-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-white shadow",children:jsxRuntimeExports.jsx("img",{src:civicIssueLogo,alt:"civicIssueLogo",className:"w-15 h-15 object-contain"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-[#016dd0] to-[#159e52] bg-clip-text text-transparent",children:"CivicReport"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Building Better Communities"})]})]})}),jsxRuntimeExports.jsxs(Card,{className:"rounded-2xl shadow-2xl bg-white border-0",children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsx(CardTitle,{children:jsxRuntimeExports.jsx("center",{children:"Sign In"})}),jsxRuntimeExports.jsx(CardDescription,{children:"Access your account to report issues or manage community reports"})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsxs(Tabs,{value:R,onValueChange:J=>a(J),children:[jsxRuntimeExports.jsxs(TabsList,{className:"grid w-full grid-cols-2 rounded-full bg-gray-100 p-1",children:[jsxRuntimeExports.jsx(TabsTrigger,{value:"citizen",className:"rounded-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-[#016dd0] data-[state=active]:to-[#159e52] data-[state=active]:text-white",children:"Citizen"}),jsxRuntimeExports.jsx(TabsTrigger,{value:"admin",className:"rounded-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-[#016dd0] data-[state=active]:to-[#159e52] data-[state=active]:text-white",children:"Administrator"})]}),jsxRuntimeExports.jsxs(AnimatePresence,{mode:"wait",children:[R==="citizen"&&jsxRuntimeExports.jsx(TabsContent,{value:"citizen",forceMount:!0,children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"mt-6",children:jsxRuntimeExports.jsxs("form",{onSubmit:G,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-email",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"citizen-email",type:"email",value:u.email,onChange:J=>d({...u,email:J.target.value}),required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-password",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"citizen-password",type:t?"text":"password",value:u.password,onChange:J=>d({...u,password:J.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2",onClick:()=>s(!t),children:t?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full bg-gradient-to-r from-[#016dd0] to-[#159e52] text-white hover:opacity-70",children:"Sign In as Citizen"})]})},"citizen")}),R==="admin"&&jsxRuntimeExports.jsx(TabsContent,{value:"admin",forceMount:!0,children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"mt-6",children:jsxRuntimeExports.jsxs("form",{onSubmit:G,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-email",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"admin-email",type:"email",value:_.email,onChange:J=>S({..._,email:J.target.value}),required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-password",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"admin-password",type:t?"text":"password",value:_.password,onChange:J=>S({..._,password:J.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2",onClick:()=>s(!t),children:t?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-code",children:"Admin Code"}),jsxRuntimeExports.jsx(Input,{id:"admin-code",value:_.adminAccessCode,onChange:J=>S({..._,adminAccessCode:J.target.value}),required:!0})]}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full bg-gradient-to-r from-[#016dd0] to-[#159e52] text-white hover:opacity-70",children:"Sign In as Administrator"})]})},"admin")})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don","'","t have an account?"," ",jsxRuntimeExports.jsx(Link,{to:"/signup",className:"text-primary hover:underline",children:"Sign up here"})]}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-sm text-muted-foreground hover:text-primary",children:" Back to Home"})]})]})})]})]})]})};function createContextScope(t,s=[]){let u=[];function d(S,R){const a=reactExports.createContext(R),k=u.length;u=[...u,R];const O=V=>{var ee;const{scope:G,children:J,...Z}=V,Y=((ee=G==null?void 0:G[t])==null?void 0:ee[k])||a,le=reactExports.useMemo(()=>Z,Object.values(Z));return jsxRuntimeExports.jsx(Y.Provider,{value:le,children:J})};O.displayName=S+"Provider";function j(V,G){var Y;const J=((Y=G==null?void 0:G[t])==null?void 0:Y[k])||a,Z=reactExports.useContext(J);if(Z)return Z;if(R!==void 0)return R;throw new Error(`\`${V}\` must be used within \`${S}\``)}return[O,j]}const _=()=>{const S=u.map(R=>reactExports.createContext(R));return function(a){const k=(a==null?void 0:a[t])||S;return reactExports.useMemo(()=>({[`__scope${t}`]:{...a,[t]:k}}),[a,k])}};return _.scopeName=t,[d,composeContextScopes(_,...s)]}function composeContextScopes(...t){const s=t[0];if(t.length===1)return s;const u=()=>{const d=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(S){const R=d.reduce((a,{useScope:k,scopeName:O})=>{const V=k(S)[`__scope${O}`];return{...a,...V}},{});return reactExports.useMemo(()=>({[`__scope${s.scopeName}`]:R}),[R])}};return u.scopeName=s.scopeName,u}function createSlot(t){const s=createSlotClone(t),u=reactExports.forwardRef((d,_)=>{const{children:S,...R}=d,a=reactExports.Children.toArray(S),k=a.find(isSlottable);if(k){const O=k.props.children,j=a.map(V=>V===k?reactExports.Children.count(O)>1?reactExports.Children.only(null):reactExports.isValidElement(O)?O.props.children:null:V);return jsxRuntimeExports.jsx(s,{...R,ref:_,children:reactExports.isValidElement(O)?reactExports.cloneElement(O,void 0,j):null})}return jsxRuntimeExports.jsx(s,{...R,ref:_,children:S})});return u.displayName=`${t}.Slot`,u}function createSlotClone(t){const s=reactExports.forwardRef((u,d)=>{const{children:_,...S}=u;if(reactExports.isValidElement(_)){const R=getElementRef(_),a=mergeProps(S,_.props);return _.type!==reactExports.Fragment&&(a.ref=d?composeRefs(d,R):R),reactExports.cloneElement(_,a)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function isSlottable(t){return reactExports.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(t,s){const u={...s};for(const d in s){const _=t[d],S=s[d];/^on[A-Z]/.test(d)?_&&S?u[d]=(...a)=>{const k=S(...a);return _(...a),k}:_&&(u[d]=_):d==="style"?u[d]={..._,...S}:d==="className"&&(u[d]=[_,S].filter(Boolean).join(" "))}return{...t,...u}}function getElementRef(t){var d,_;let s=(d=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:d.get,u=s&&"isReactWarning"in s&&s.isReactWarning;return u?t.ref:(s=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,u=s&&"isReactWarning"in s&&s.isReactWarning,u?t.props.ref:t.props.ref||t.ref)}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive=NODES.reduce((t,s)=>{const u=createSlot(`Primitive.${s}`),d=reactExports.forwardRef((_,S)=>{const{asChild:R,...a}=_,k=R?u:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(k,{...a,ref:S})});return d.displayName=`Primitive.${s}`,{...t,[s]:d}},{}),CHECKBOX_NAME="Checkbox",[createCheckboxContext]=createContextScope(CHECKBOX_NAME),[CheckboxProviderImpl,useCheckboxContext]=createCheckboxContext(CHECKBOX_NAME);function CheckboxProvider(t){const{__scopeCheckbox:s,checked:u,children:d,defaultChecked:_,disabled:S,form:R,name:a,onCheckedChange:k,required:O,value:j="on",internal_do_not_use_render:V}=t,[G,J]=useControllableState({prop:u,defaultProp:_??!1,onChange:k,caller:CHECKBOX_NAME}),[Z,Y]=reactExports.useState(null),[le,ee]=reactExports.useState(null),se=reactExports.useRef(!1),Q=Z?!!R||!!Z.closest("form"):!0,oe={checked:G,disabled:S,setChecked:J,control:Z,setControl:Y,name:a,form:R,value:j,hasConsumerStoppedPropagationRef:se,required:O,defaultChecked:isIndeterminate(_)?!1:_,isFormControl:Q,bubbleInput:le,setBubbleInput:ee};return jsxRuntimeExports.jsx(CheckboxProviderImpl,{scope:s,...oe,children:isFunction(V)?V(oe):d})}var TRIGGER_NAME="CheckboxTrigger",CheckboxTrigger=reactExports.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:u,...d},_)=>{const{control:S,value:R,disabled:a,checked:k,required:O,setControl:j,setChecked:V,hasConsumerStoppedPropagationRef:G,isFormControl:J,bubbleInput:Z}=useCheckboxContext(TRIGGER_NAME,t),Y=useComposedRefs(_,j),le=reactExports.useRef(k);return reactExports.useEffect(()=>{const ee=S==null?void 0:S.form;if(ee){const se=()=>V(le.current);return ee.addEventListener("reset",se),()=>ee.removeEventListener("reset",se)}},[S,V]),jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"checkbox","aria-checked":isIndeterminate(k)?"mixed":k,"aria-required":O,"data-state":getState(k),"data-disabled":a?"":void 0,disabled:a,value:R,...d,ref:Y,onKeyDown:composeEventHandlers(s,ee=>{ee.key==="Enter"&&ee.preventDefault()}),onClick:composeEventHandlers(u,ee=>{V(se=>isIndeterminate(se)?!0:!se),Z&&J&&(G.current=ee.isPropagationStopped(),G.current||ee.stopPropagation())})})});CheckboxTrigger.displayName=TRIGGER_NAME;var Checkbox$1=reactExports.forwardRef((t,s)=>{const{__scopeCheckbox:u,name:d,checked:_,defaultChecked:S,required:R,disabled:a,value:k,onCheckedChange:O,form:j,...V}=t;return jsxRuntimeExports.jsx(CheckboxProvider,{__scopeCheckbox:u,checked:_,defaultChecked:S,disabled:a,required:R,onCheckedChange:O,name:d,form:j,value:k,internal_do_not_use_render:({isFormControl:G})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CheckboxTrigger,{...V,ref:s,__scopeCheckbox:u}),G&&jsxRuntimeExports.jsx(CheckboxBubbleInput,{__scopeCheckbox:u})]})})});Checkbox$1.displayName=CHECKBOX_NAME;var INDICATOR_NAME="CheckboxIndicator",CheckboxIndicator=reactExports.forwardRef((t,s)=>{const{__scopeCheckbox:u,forceMount:d,..._}=t,S=useCheckboxContext(INDICATOR_NAME,u);return jsxRuntimeExports.jsx(Presence,{present:d||isIndeterminate(S.checked)||S.checked===!0,children:jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState(S.checked),"data-disabled":S.disabled?"":void 0,..._,ref:s,style:{pointerEvents:"none",...t.style}})})});CheckboxIndicator.displayName=INDICATOR_NAME;var BUBBLE_INPUT_NAME="CheckboxBubbleInput",CheckboxBubbleInput=reactExports.forwardRef(({__scopeCheckbox:t,...s},u)=>{const{control:d,hasConsumerStoppedPropagationRef:_,checked:S,defaultChecked:R,required:a,disabled:k,name:O,value:j,form:V,bubbleInput:G,setBubbleInput:J}=useCheckboxContext(BUBBLE_INPUT_NAME,t),Z=useComposedRefs(u,J),Y=usePrevious(S),le=useSize(d);reactExports.useEffect(()=>{const se=G;if(!se)return;const Q=window.HTMLInputElement.prototype,_e=Object.getOwnPropertyDescriptor(Q,"checked").set,Se=!_.current;if(Y!==S&&_e){const ke=new Event("click",{bubbles:Se});se.indeterminate=isIndeterminate(S),_e.call(se,isIndeterminate(S)?!1:S),se.dispatchEvent(ke)}},[G,Y,S,_]);const ee=reactExports.useRef(isIndeterminate(S)?!1:S);return jsxRuntimeExports.jsx(Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:R??ee.current,required:a,disabled:k,name:O,value:j,form:V,...s,tabIndex:-1,ref:Z,style:{...s.style,...le,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});CheckboxBubbleInput.displayName=BUBBLE_INPUT_NAME;function isFunction(t){return typeof t=="function"}function isIndeterminate(t){return t==="indeterminate"}function getState(t){return isIndeterminate(t)?"indeterminate":t?"checked":"unchecked"}function Checkbox({className:t,...s}){return jsxRuntimeExports.jsx(Checkbox$1,{"data-slot":"checkbox",className:cn("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:jsxRuntimeExports.jsx(CheckboxIndicator,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:jsxRuntimeExports.jsx(Check,{className:"size-3.5"})})})}const SignUp=()=>{const[t,s]=reactExports.useState(!1),[u,d]=reactExports.useState(!1),[_,S]=reactExports.useState({fullName:"",email:"",phonenumber:"",password:"",confirmPassword:"",agreeToTerms:!1}),[R,a]=reactExports.useState({fullName:"",email:"",phonenumber:"",department:"",adminAccessCode:"",password:"",confirmPassword:"",agreeToTerms:!1}),[k,O]=reactExports.useState({}),[j,V]=reactExports.useState({}),[G,J]=reactExports.useState("citizen"),Z=useNavigate(),Y=se=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(se),le=async se=>{if(se.preventDefault(),O({}),!Y(_.password)){toast.error("Password must be at least 8 characters, include uppercase, lowercase, number and special character.");return}if(_.password!==_.confirmPassword){toast.error("Passwords do not match.");return}if(!_.agreeToTerms){toast.error("Please agree to the terms and conditions.");return}if(_.phonenumber.trim().length!==10||!/^\d{10}$/.test(_.phonenumber.trim())){toast.error("Phone number must be exactly 10 digits.");return}try{const Q=await fetch(`${VITE_BACKEND_URL}/api/v1/citizen/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:_.fullName,email:_.email,password:_.password,phonenumber:_.phonenumber})}),oe=await Q.json();if(Q.ok)toast.success("Registration Successful! You can now sign in."),Z("/signin");else if(oe.errors&&Array.isArray(oe.errors)){const _e={};oe.errors.forEach(Se=>{Se.path&&Se.path.length>0&&(_e[Se.path[0]]=Se.message)}),O(_e)}else toast.error(oe.message||"Something went wrong! Please try again.")}catch(Q){toast.error("Something went wrong! Please try again."),console.error(Q)}},ee=async se=>{if(se.preventDefault(),V({}),!Y(R.password)){toast.error("Password must be at least 8 characters, include uppercase, lowercase, number and special character.");return}if(R.password!==R.confirmPassword){toast.error("Passwords do not match.");return}if(!R.agreeToTerms){toast.error("Please agree to the terms and conditions.");return}if(!R.fullName.trim()||!R.email.trim()||!R.phonenumber.trim()||!R.department.trim()||!R.adminAccessCode.trim()){toast.error("Please fill all required fields.");return}if(R.phonenumber.trim().length!==10||!/^\d{10}$/.test(R.phonenumber.trim())){toast.error("Phone number must be exactly 10 digits.");return}if(!/^\d{4,}$/.test(R.adminAccessCode)){toast.error("Admin access code must be at least 4 digits.");return}try{const Q=await fetch(`${VITE_BACKEND_URL}/api/v1/admin/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:R.fullName,email:R.email,password:R.password,phonenumber:R.phonenumber,department:R.department,adminAccessCode:Number(R.adminAccessCode.trim())})}),oe=await Q.json();if(Q.ok)toast.success("Admin Registration Successful! Pending approval."),Z("/signin");else if(oe.errors&&Array.isArray(oe.errors)){const _e={};oe.errors.forEach(Se=>{Se.path&&Se.path.length>0&&(_e[Se.path[0]]=Se.message)}),V(_e)}else toast.error(oe.message||"Signup failed")}catch(Q){toast.error("Something went wrong! Please try again."),console.error(Q)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-[#f0f7f5]"}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md",children:[jsxRuntimeExports.jsx("div",{className:"text-center mb-8",children:jsxRuntimeExports.jsxs(Link,{to:"/",className:"inline-flex items-center space-x-2 mb-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-white shadow",children:jsxRuntimeExports.jsx("img",{src:civicIssueLogo,alt:"civicIssueLogo",className:"w-15 h-15 object-contain"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-[#016dd0] to-[#159e52] bg-clip-text text-transparent",children:"CivicReport"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Building Better Communities"})]})]})}),jsxRuntimeExports.jsxs(Card,{className:"rounded-2xl shadow-2xl bg-white border-0",children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsx(CardTitle,{children:jsxRuntimeExports.jsx("center",{children:"Create Account"})}),jsxRuntimeExports.jsx(CardDescription,{children:"Join our community to report issues and help build better cities"})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsxs(Tabs,{value:G,onValueChange:J,children:[jsxRuntimeExports.jsxs(TabsList,{className:"grid w-full grid-cols-2 rounded-full bg-gray-200/80 p-1",children:[jsxRuntimeExports.jsx(TabsTrigger,{value:"citizen",className:"rounded-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-[#016dd0] data-[state=active]:to-[#159e52] data-[state=active]:text-white opacity-80",children:"Citizen"}),jsxRuntimeExports.jsx(TabsTrigger,{value:"admin",className:"rounded-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-[#016dd0] data-[state=active]:to-[#159e52] data-[state=active]:text-white opacity-80",children:"Administrator"})]}),jsxRuntimeExports.jsx(TabsContent,{value:"citizen",children:jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:G==="citizen"&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:32},animate:{opacity:1,x:0},exit:{opacity:0,x:-32},transition:{duration:.33,ease:"easeOut"},className:"mt-6",children:jsxRuntimeExports.jsxs("form",{onSubmit:le,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-fullName",children:"Full Name"}),jsxRuntimeExports.jsx(Input,{id:"citizen-fullName",placeholder:"John Doe",value:_.fullName,onChange:se=>S({..._,fullName:se.target.value}),required:!0}),k.fullName&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:k.fullName})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-email",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"citizen-email",type:"email",placeholder:"citizen@example.com",value:_.email,onChange:se=>S({..._,email:se.target.value}),required:!0}),k.email&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:k.email})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-phone",children:"Phone Number"}),jsxRuntimeExports.jsx(Input,{id:"citizen-phone",type:"tel",placeholder:"0123456789",value:_.phonenumber,onChange:se=>S({..._,phonenumber:se.target.value}),required:!0}),k.phonenumber&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:k.phonenumber})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-password",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"citizen-password",type:t?"text":"password",placeholder:"Create a strong password",value:_.password,onChange:se=>S({..._,password:se.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!t),children:t?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]}),k.password&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:k.password})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"citizen-confirmPassword",children:"Confirm Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"citizen-confirmPassword",type:u?"text":"password",placeholder:"Confirm your password",value:_.confirmPassword,onChange:se=>S({..._,confirmPassword:se.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>d(!u),children:u?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Checkbox,{id:"citizen-terms",checked:_.agreeToTerms,onCheckedChange:se=>S({..._,agreeToTerms:se})}),jsxRuntimeExports.jsxs(Label$1,{htmlFor:"citizen-terms",className:"text-sm",children:["I agree to the"," ",jsxRuntimeExports.jsx(Link,{to:"/terms",className:"text-primary hover:underline",children:"Terms and Conditions"})]}),k.agreeToTerms&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:k.agreeToTerms})]}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full bg-gradient-to-r from-[#016dd0] to-[#159e52] text-white font-bold shadow-md hover:opacity-70 transition",children:"Create Citizen Account"})]})},"citizen-motion")})}),jsxRuntimeExports.jsx(TabsContent,{value:"admin",children:jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:G==="admin"&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,x:32},animate:{opacity:1,x:0},exit:{opacity:0,x:-32},transition:{duration:.33,ease:"easeOut"},className:"mt-6",children:jsxRuntimeExports.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-fullName",children:"Full Name"}),jsxRuntimeExports.jsx(Input,{id:"admin-fullName",placeholder:"Narendra Modi",value:R.fullName,onChange:se=>a({...R,fullName:se.target.value}),required:!0}),j.fullName&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.fullName})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-email",children:"Official Email"}),jsxRuntimeExports.jsx(Input,{id:"admin-email",type:"email",placeholder:"admin@city.gov",value:R.email,onChange:se=>a({...R,email:se.target.value}),required:!0}),j.email&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.email})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-phone",children:"Phone Number"}),jsxRuntimeExports.jsx(Input,{id:"admin-phone",type:"tel",placeholder:"0123456789",value:R.phonenumber,onChange:se=>a({...R,phonenumber:se.target.value}),required:!0}),j.phonenumber&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.phonenumber})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-department",children:"Department"}),jsxRuntimeExports.jsx(Input,{id:"admin-department",placeholder:"Public Works",value:R.department,onChange:se=>a({...R,department:se.target.value}),required:!0}),j.department&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.department})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-code",children:"Admin Access Code"}),jsxRuntimeExports.jsx(Input,{id:"admin-code",type:"text",placeholder:"Contact your supervisor for the code",value:R.adminAccessCode,onChange:se=>a({...R,adminAccessCode:se.target.value}),required:!0}),j.adminAccessCode&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.adminAccessCode})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-password",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"admin-password",type:t?"text":"password",placeholder:"Create a strong password",value:R.password,onChange:se=>a({...R,password:se.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!t),children:t?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]}),j.password&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.password})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"admin-confirmPassword",children:"Confirm Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{id:"admin-confirmPassword",type:u?"text":"password",placeholder:"Confirm your password",value:R.confirmPassword,onChange:se=>a({...R,confirmPassword:se.target.value}),required:!0}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>d(!u),children:u?jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"})})]}),j.confirmPassword&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.confirmPassword})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Checkbox,{id:"admin-terms",checked:R.agreeToTerms,onCheckedChange:se=>a({...R,agreeToTerms:se})}),jsxRuntimeExports.jsxs(Label$1,{htmlFor:"admin-terms",className:"text-sm",children:["I agree to the"," ",jsxRuntimeExports.jsx(Link,{to:"/terms",className:"text-primary hover:underline",children:"Terms and Conditions"})]}),j.agreeToTerms&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm",children:j.agreeToTerms})]}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full bg-gradient-to-r from-[#016dd0] to-[#159e52] text-white font-bold shadow-md hover:opacity-70 transition",children:"Create Admin Account"})]})},"admin-motion")})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",jsxRuntimeExports.jsx(Link,{to:"/signin",className:"text-primary hover:underline",children:"Sign in here"})]}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-sm text-muted-foreground hover:text-primary",children:" Back to Home"})]})]})})]})]})]})},ProtectedRoute=({children:t,requiredRole:s})=>{const{user:u,isLoading:d}=useAuth(),_=useLocation();return d?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center",children:jsxRuntimeExports.jsx(Loader,{className:"h-8 w-8 animate-spin"})}):u?s&&u.role!==s?jsxRuntimeExports.jsx(Navigate,{to:"/",replace:!0}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:t}):jsxRuntimeExports.jsx(Navigate,{to:"/signin",state:{from:_},replace:!0})},pageTransition={initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:-40},transition:{duration:.32,ease:"easeInOut"}};function MotionWrapper({children:t}){return jsxRuntimeExports.jsx(motion.div,{initial:pageTransition.initial,animate:pageTransition.animate,exit:pageTransition.exit,transition:pageTransition.transition,style:{height:"100%"},children:t})}function AnimatedRoutes(){const t=useLocation();return jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:jsxRuntimeExports.jsxs(Routes,{location:t,children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(Index,{})})}),jsxRuntimeExports.jsx(Route,{path:"/signin",element:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(SignIn,{})})}),jsxRuntimeExports.jsx(Route,{path:"/signup",element:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(SignUp,{})})}),jsxRuntimeExports.jsx(Route,{path:"/citizen",element:jsxRuntimeExports.jsx(ProtectedRoute,{requiredRole:"citizen",children:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(CitizenHome,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/citizen/create-issue",element:jsxRuntimeExports.jsx(ProtectedRoute,{requiredRole:"citizen",children:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(ReportIssue,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/citizen/profile",element:jsxRuntimeExports.jsx(ProtectedRoute,{requiredRole:"citizen",children:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(CitizenProfile,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/admin",element:jsxRuntimeExports.jsx(ProtectedRoute,{requiredRole:"admin",children:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(AdminHome,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/profile",element:jsxRuntimeExports.jsx(ProtectedRoute,{requiredRole:"admin",children:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(AdminProfile,{})})})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(MotionWrapper,{children:jsxRuntimeExports.jsx(NotFound,{})})})]},t.pathname)})}const queryClient=new QueryClient,App=()=>jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsxs(LoaderProvider,{children:[" ",jsxRuntimeExports.jsx(LoaderOverlay,{})," ",jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(AnimatedRoutes,{})})]})})});clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(App,{})})}));
